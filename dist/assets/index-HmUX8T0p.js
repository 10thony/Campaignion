var oW=Object.defineProperty;var dI=s=>{throw TypeError(s)};var lW=(s,e,t)=>e in s?oW(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var Ce=(s,e,t)=>lW(s,typeof e!="symbol"?e+"":e,t),Yk=(s,e,t)=>e.has(s)||dI("Cannot "+t);var u=(s,e,t)=>(Yk(s,e,"read from private field"),t?t.call(s):e.get(s)),E=(s,e,t)=>e.has(s)?dI("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t),N=(s,e,t,n)=>(Yk(s,e,"write to private field"),n?n.call(s,t):e.set(s,t),t),F=(s,e,t)=>(Yk(s,e,"access private method"),t);var Fs=(s,e,t,n)=>({set _(r){N(s,e,r,t)},get _(){return u(s,e,n)}});function cW(s,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const r in n)if(r!=="default"&&!(r in s)){const a=Object.getOwnPropertyDescriptor(n,r);a&&Object.defineProperty(s,r,a.get?a:{enumerable:!0,get:()=>n[r]})}}}return Object.freeze(Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}})();function pE(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var c4={exports:{}},hj={},d4={exports:{}},It={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Y0=Symbol.for("react.element"),dW=Symbol.for("react.portal"),uW=Symbol.for("react.fragment"),hW=Symbol.for("react.strict_mode"),fW=Symbol.for("react.profiler"),mW=Symbol.for("react.provider"),pW=Symbol.for("react.context"),gW=Symbol.for("react.forward_ref"),xW=Symbol.for("react.suspense"),yW=Symbol.for("react.memo"),vW=Symbol.for("react.lazy"),uI=Symbol.iterator;function bW(s){return s===null||typeof s!="object"?null:(s=uI&&s[uI]||s["@@iterator"],typeof s=="function"?s:null)}var u4={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},h4=Object.assign,f4={};function Ix(s,e,t){this.props=s,this.context=e,this.refs=f4,this.updater=t||u4}Ix.prototype.isReactComponent={};Ix.prototype.setState=function(s,e){if(typeof s!="object"&&typeof s!="function"&&s!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,s,e,"setState")};Ix.prototype.forceUpdate=function(s){this.updater.enqueueForceUpdate(this,s,"forceUpdate")};function m4(){}m4.prototype=Ix.prototype;function gE(s,e,t){this.props=s,this.context=e,this.refs=f4,this.updater=t||u4}var xE=gE.prototype=new m4;xE.constructor=gE;h4(xE,Ix.prototype);xE.isPureReactComponent=!0;var hI=Array.isArray,p4=Object.prototype.hasOwnProperty,yE={current:null},g4={key:!0,ref:!0,__self:!0,__source:!0};function x4(s,e,t){var n,r={},a=null,o=null;if(e!=null)for(n in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(a=""+e.key),e)p4.call(e,n)&&!g4.hasOwnProperty(n)&&(r[n]=e[n]);var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];r.children=c}if(s&&s.defaultProps)for(n in l=s.defaultProps,l)r[n]===void 0&&(r[n]=l[n]);return{$$typeof:Y0,type:s,key:a,ref:o,props:r,_owner:yE.current}}function wW(s,e){return{$$typeof:Y0,type:s.type,key:e,ref:s.ref,props:s.props,_owner:s._owner}}function vE(s){return typeof s=="object"&&s!==null&&s.$$typeof===Y0}function CW(s){var e={"=":"=0",":":"=2"};return"$"+s.replace(/[=:]/g,function(t){return e[t]})}var fI=/\/+/g;function Kk(s,e){return typeof s=="object"&&s!==null&&s.key!=null?CW(""+s.key):e.toString(36)}function p1(s,e,t,n,r){var a=typeof s;(a==="undefined"||a==="boolean")&&(s=null);var o=!1;if(s===null)o=!0;else switch(a){case"string":case"number":o=!0;break;case"object":switch(s.$$typeof){case Y0:case dW:o=!0}}if(o)return o=s,r=r(o),s=n===""?"."+Kk(o,0):n,hI(r)?(t="",s!=null&&(t=s.replace(fI,"$&/")+"/"),p1(r,e,t,"",function(d){return d})):r!=null&&(vE(r)&&(r=wW(r,t+(!r.key||o&&o.key===r.key?"":(""+r.key).replace(fI,"$&/")+"/")+s)),e.push(r)),1;if(o=0,n=n===""?".":n+":",hI(s))for(var l=0;l<s.length;l++){a=s[l];var c=n+Kk(a,l);o+=p1(a,e,t,c,r)}else if(c=bW(s),typeof c=="function")for(s=c.call(s),l=0;!(a=s.next()).done;)a=a.value,c=n+Kk(a,l++),o+=p1(a,e,t,c,r);else if(a==="object")throw e=String(s),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function bw(s,e,t){if(s==null)return s;var n=[],r=0;return p1(s,n,"","",function(a){return e.call(t,a,r++)}),n}function SW(s){if(s._status===-1){var e=s._result;e=e(),e.then(function(t){(s._status===0||s._status===-1)&&(s._status=1,s._result=t)},function(t){(s._status===0||s._status===-1)&&(s._status=2,s._result=t)}),s._status===-1&&(s._status=0,s._result=e)}if(s._status===1)return s._result.default;throw s._result}var Or={current:null},g1={transition:null},jW={ReactCurrentDispatcher:Or,ReactCurrentBatchConfig:g1,ReactCurrentOwner:yE};function y4(){throw Error("act(...) is not supported in production builds of React.")}It.Children={map:bw,forEach:function(s,e,t){bw(s,function(){e.apply(this,arguments)},t)},count:function(s){var e=0;return bw(s,function(){e++}),e},toArray:function(s){return bw(s,function(e){return e})||[]},only:function(s){if(!vE(s))throw Error("React.Children.only expected to receive a single React element child.");return s}};It.Component=Ix;It.Fragment=uW;It.Profiler=fW;It.PureComponent=gE;It.StrictMode=hW;It.Suspense=xW;It.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=jW;It.act=y4;It.cloneElement=function(s,e,t){if(s==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+s+".");var n=h4({},s.props),r=s.key,a=s.ref,o=s._owner;if(e!=null){if(e.ref!==void 0&&(a=e.ref,o=yE.current),e.key!==void 0&&(r=""+e.key),s.type&&s.type.defaultProps)var l=s.type.defaultProps;for(c in e)p4.call(e,c)&&!g4.hasOwnProperty(c)&&(n[c]=e[c]===void 0&&l!==void 0?l[c]:e[c])}var c=arguments.length-2;if(c===1)n.children=t;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];n.children=l}return{$$typeof:Y0,type:s.type,key:r,ref:a,props:n,_owner:o}};It.createContext=function(s){return s={$$typeof:pW,_currentValue:s,_currentValue2:s,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},s.Provider={$$typeof:mW,_context:s},s.Consumer=s};It.createElement=x4;It.createFactory=function(s){var e=x4.bind(null,s);return e.type=s,e};It.createRef=function(){return{current:null}};It.forwardRef=function(s){return{$$typeof:gW,render:s}};It.isValidElement=vE;It.lazy=function(s){return{$$typeof:vW,_payload:{_status:-1,_result:s},_init:SW}};It.memo=function(s,e){return{$$typeof:yW,type:s,compare:e===void 0?null:e}};It.startTransition=function(s){var e=g1.transition;g1.transition={};try{s()}finally{g1.transition=e}};It.unstable_act=y4;It.useCallback=function(s,e){return Or.current.useCallback(s,e)};It.useContext=function(s){return Or.current.useContext(s)};It.useDebugValue=function(){};It.useDeferredValue=function(s){return Or.current.useDeferredValue(s)};It.useEffect=function(s,e){return Or.current.useEffect(s,e)};It.useId=function(){return Or.current.useId()};It.useImperativeHandle=function(s,e,t){return Or.current.useImperativeHandle(s,e,t)};It.useInsertionEffect=function(s,e){return Or.current.useInsertionEffect(s,e)};It.useLayoutEffect=function(s,e){return Or.current.useLayoutEffect(s,e)};It.useMemo=function(s,e){return Or.current.useMemo(s,e)};It.useReducer=function(s,e,t){return Or.current.useReducer(s,e,t)};It.useRef=function(s){return Or.current.useRef(s)};It.useState=function(s){return Or.current.useState(s)};It.useSyncExternalStore=function(s,e,t){return Or.current.useSyncExternalStore(s,e,t)};It.useTransition=function(){return Or.current.useTransition()};It.version="18.3.1";d4.exports=It;var C=d4.exports;const V=pE(C),bE=cW({__proto__:null,default:V},[C]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kW=C,NW=Symbol.for("react.element"),AW=Symbol.for("react.fragment"),_W=Object.prototype.hasOwnProperty,TW=kW.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,EW={key:!0,ref:!0,__self:!0,__source:!0};function v4(s,e,t){var n,r={},a=null,o=null;t!==void 0&&(a=""+t),e.key!==void 0&&(a=""+e.key),e.ref!==void 0&&(o=e.ref);for(n in e)_W.call(e,n)&&!EW.hasOwnProperty(n)&&(r[n]=e[n]);if(s&&s.defaultProps)for(n in e=s.defaultProps,e)r[n]===void 0&&(r[n]=e[n]);return{$$typeof:NW,type:s,key:a,ref:o,props:r,_owner:TW.current}}hj.Fragment=AW;hj.jsx=v4;hj.jsxs=v4;c4.exports=hj;var i=c4.exports,IA={},b4={exports:{}},Qi={},w4={exports:{}},C4={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(s){function e(M,$){var W=M.length;M.push($);e:for(;0<W;){var ee=W-1>>>1,Z=M[ee];if(0<r(Z,$))M[ee]=$,M[W]=Z,W=ee;else break e}}function t(M){return M.length===0?null:M[0]}function n(M){if(M.length===0)return null;var $=M[0],W=M.pop();if(W!==$){M[0]=W;e:for(var ee=0,Z=M.length,z=Z>>>1;ee<z;){var se=2*(ee+1)-1,de=M[se],ne=se+1,H=M[ne];if(0>r(de,W))ne<Z&&0>r(H,de)?(M[ee]=H,M[ne]=W,ee=ne):(M[ee]=de,M[se]=W,ee=se);else if(ne<Z&&0>r(H,W))M[ee]=H,M[ne]=W,ee=ne;else break e}}return $}function r(M,$){var W=M.sortIndex-$.sortIndex;return W!==0?W:M.id-$.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;s.unstable_now=function(){return a.now()}}else{var o=Date,l=o.now();s.unstable_now=function(){return o.now()-l}}var c=[],d=[],h=1,f=null,m=3,p=!1,x=!1,g=!1,b=typeof setTimeout=="function"?setTimeout:null,v=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(M){for(var $=t(d);$!==null;){if($.callback===null)n(d);else if($.startTime<=M)n(d),$.sortIndex=$.expirationTime,e(c,$);else break;$=t(d)}}function S(M){if(g=!1,w(M),!x)if(t(c)!==null)x=!0,I(j);else{var $=t(d);$!==null&&U(S,$.startTime-M)}}function j(M,$){x=!1,g&&(g=!1,v(_),_=-1),p=!0;var W=m;try{for(w($),f=t(c);f!==null&&(!(f.expirationTime>$)||M&&!P());){var ee=f.callback;if(typeof ee=="function"){f.callback=null,m=f.priorityLevel;var Z=ee(f.expirationTime<=$);$=s.unstable_now(),typeof Z=="function"?f.callback=Z:f===t(c)&&n(c),w($)}else n(c);f=t(c)}if(f!==null)var z=!0;else{var se=t(d);se!==null&&U(S,se.startTime-$),z=!1}return z}finally{f=null,m=W,p=!1}}var A=!1,k=null,_=-1,L=5,D=-1;function P(){return!(s.unstable_now()-D<L)}function T(){if(k!==null){var M=s.unstable_now();D=M;var $=!0;try{$=k(!0,M)}finally{$?B():(A=!1,k=null)}}else A=!1}var B;if(typeof y=="function")B=function(){y(T)};else if(typeof MessageChannel<"u"){var R=new MessageChannel,O=R.port2;R.port1.onmessage=T,B=function(){O.postMessage(null)}}else B=function(){b(T,0)};function I(M){k=M,A||(A=!0,B())}function U(M,$){_=b(function(){M(s.unstable_now())},$)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(M){M.callback=null},s.unstable_continueExecution=function(){x||p||(x=!0,I(j))},s.unstable_forceFrameRate=function(M){0>M||125<M?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):L=0<M?Math.floor(1e3/M):5},s.unstable_getCurrentPriorityLevel=function(){return m},s.unstable_getFirstCallbackNode=function(){return t(c)},s.unstable_next=function(M){switch(m){case 1:case 2:case 3:var $=3;break;default:$=m}var W=m;m=$;try{return M()}finally{m=W}},s.unstable_pauseExecution=function(){},s.unstable_requestPaint=function(){},s.unstable_runWithPriority=function(M,$){switch(M){case 1:case 2:case 3:case 4:case 5:break;default:M=3}var W=m;m=M;try{return $()}finally{m=W}},s.unstable_scheduleCallback=function(M,$,W){var ee=s.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?ee+W:ee):W=ee,M){case 1:var Z=-1;break;case 2:Z=250;break;case 5:Z=1073741823;break;case 4:Z=1e4;break;default:Z=5e3}return Z=W+Z,M={id:h++,callback:$,priorityLevel:M,startTime:W,expirationTime:Z,sortIndex:-1},W>ee?(M.sortIndex=W,e(d,M),t(c)===null&&M===t(d)&&(g?(v(_),_=-1):g=!0,U(S,W-ee))):(M.sortIndex=Z,e(c,M),x||p||(x=!0,I(j))),M},s.unstable_shouldYield=P,s.unstable_wrapCallback=function(M){var $=m;return function(){var W=m;m=$;try{return M.apply(this,arguments)}finally{m=W}}}})(C4);w4.exports=C4;var PW=w4.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var MW=C,Gi=PW;function Te(s){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+s,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+s+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var S4=new Set,pv={};function vm(s,e){dx(s,e),dx(s+"Capture",e)}function dx(s,e){for(pv[s]=e,s=0;s<e.length;s++)S4.add(e[s])}var Pc=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),RA=Object.prototype.hasOwnProperty,IW=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,mI={},pI={};function RW(s){return RA.call(pI,s)?!0:RA.call(mI,s)?!1:IW.test(s)?pI[s]=!0:(mI[s]=!0,!1)}function DW(s,e,t,n){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:t!==null?!t.acceptsBooleans:(s=s.toLowerCase().slice(0,5),s!=="data-"&&s!=="aria-");default:return!1}}function LW(s,e,t,n){if(e===null||typeof e>"u"||DW(s,e,t,n))return!0;if(n)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Fr(s,e,t,n,r,a,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=r,this.mustUseProperty=t,this.propertyName=s,this.type=e,this.sanitizeURL=a,this.removeEmptyString=o}var Kn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(s){Kn[s]=new Fr(s,0,!1,s,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(s){var e=s[0];Kn[e]=new Fr(e,1,!1,s[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(s){Kn[s]=new Fr(s,2,!1,s.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(s){Kn[s]=new Fr(s,2,!1,s,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(s){Kn[s]=new Fr(s,3,!1,s.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(s){Kn[s]=new Fr(s,3,!0,s,null,!1,!1)});["capture","download"].forEach(function(s){Kn[s]=new Fr(s,4,!1,s,null,!1,!1)});["cols","rows","size","span"].forEach(function(s){Kn[s]=new Fr(s,6,!1,s,null,!1,!1)});["rowSpan","start"].forEach(function(s){Kn[s]=new Fr(s,5,!1,s.toLowerCase(),null,!1,!1)});var wE=/[\-:]([a-z])/g;function CE(s){return s[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(s){var e=s.replace(wE,CE);Kn[e]=new Fr(e,1,!1,s,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(s){var e=s.replace(wE,CE);Kn[e]=new Fr(e,1,!1,s,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(s){var e=s.replace(wE,CE);Kn[e]=new Fr(e,1,!1,s,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(s){Kn[s]=new Fr(s,1,!1,s.toLowerCase(),null,!1,!1)});Kn.xlinkHref=new Fr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(s){Kn[s]=new Fr(s,1,!1,s.toLowerCase(),null,!0,!0)});function SE(s,e,t,n){var r=Kn.hasOwnProperty(e)?Kn[e]:null;(r!==null?r.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(LW(e,t,r,n)&&(t=null),n||r===null?RW(e)&&(t===null?s.removeAttribute(e):s.setAttribute(e,""+t)):r.mustUseProperty?s[r.propertyName]=t===null?r.type===3?!1:"":t:(e=r.attributeName,n=r.attributeNamespace,t===null?s.removeAttribute(e):(r=r.type,t=r===3||r===4&&t===!0?"":""+t,n?s.setAttributeNS(n,e,t):s.setAttribute(e,t))))}var Hc=MW.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ww=Symbol.for("react.element"),ep=Symbol.for("react.portal"),tp=Symbol.for("react.fragment"),jE=Symbol.for("react.strict_mode"),DA=Symbol.for("react.profiler"),j4=Symbol.for("react.provider"),k4=Symbol.for("react.context"),kE=Symbol.for("react.forward_ref"),LA=Symbol.for("react.suspense"),OA=Symbol.for("react.suspense_list"),NE=Symbol.for("react.memo"),ad=Symbol.for("react.lazy"),N4=Symbol.for("react.offscreen"),gI=Symbol.iterator;function Hx(s){return s===null||typeof s!="object"?null:(s=gI&&s[gI]||s["@@iterator"],typeof s=="function"?s:null)}var Os=Object.assign,Xk;function fy(s){if(Xk===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Xk=e&&e[1]||""}return`
`+Xk+s}var Qk=!1;function Zk(s,e){if(!s||Qk)return"";Qk=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var n=d}Reflect.construct(s,[],e)}else{try{e.call()}catch(d){n=d}s.call(e.prototype)}else{try{throw Error()}catch(d){n=d}s()}}catch(d){if(d&&n&&typeof d.stack=="string"){for(var r=d.stack.split(`
`),a=n.stack.split(`
`),o=r.length-1,l=a.length-1;1<=o&&0<=l&&r[o]!==a[l];)l--;for(;1<=o&&0<=l;o--,l--)if(r[o]!==a[l]){if(o!==1||l!==1)do if(o--,l--,0>l||r[o]!==a[l]){var c=`
`+r[o].replace(" at new "," at ");return s.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",s.displayName)),c}while(1<=o&&0<=l);break}}}finally{Qk=!1,Error.prepareStackTrace=t}return(s=s?s.displayName||s.name:"")?fy(s):""}function OW(s){switch(s.tag){case 5:return fy(s.type);case 16:return fy("Lazy");case 13:return fy("Suspense");case 19:return fy("SuspenseList");case 0:case 2:case 15:return s=Zk(s.type,!1),s;case 11:return s=Zk(s.type.render,!1),s;case 1:return s=Zk(s.type,!0),s;default:return""}}function FA(s){if(s==null)return null;if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case tp:return"Fragment";case ep:return"Portal";case DA:return"Profiler";case jE:return"StrictMode";case LA:return"Suspense";case OA:return"SuspenseList"}if(typeof s=="object")switch(s.$$typeof){case k4:return(s.displayName||"Context")+".Consumer";case j4:return(s._context.displayName||"Context")+".Provider";case kE:var e=s.render;return s=s.displayName,s||(s=e.displayName||e.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case NE:return e=s.displayName||null,e!==null?e:FA(s.type)||"Memo";case ad:e=s._payload,s=s._init;try{return FA(s(e))}catch{}}return null}function FW(s){var e=s.type;switch(s.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return s=e.render,s=s.displayName||s.name||"",e.displayName||(s!==""?"ForwardRef("+s+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return FA(e);case 8:return e===jE?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Pu(s){switch(typeof s){case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function A4(s){var e=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function BW(s){var e=A4(s)?"checked":"value",t=Object.getOwnPropertyDescriptor(s.constructor.prototype,e),n=""+s[e];if(!s.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var r=t.get,a=t.set;return Object.defineProperty(s,e,{configurable:!0,get:function(){return r.call(this)},set:function(o){n=""+o,a.call(this,o)}}),Object.defineProperty(s,e,{enumerable:t.enumerable}),{getValue:function(){return n},setValue:function(o){n=""+o},stopTracking:function(){s._valueTracker=null,delete s[e]}}}}function Cw(s){s._valueTracker||(s._valueTracker=BW(s))}function _4(s){if(!s)return!1;var e=s._valueTracker;if(!e)return!0;var t=e.getValue(),n="";return s&&(n=A4(s)?s.checked?"true":"false":s.value),s=n,s!==t?(e.setValue(s),!0):!1}function SC(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}function BA(s,e){var t=e.checked;return Os({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??s._wrapperState.initialChecked})}function xI(s,e){var t=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;t=Pu(e.value!=null?e.value:t),s._wrapperState={initialChecked:n,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function T4(s,e){e=e.checked,e!=null&&SE(s,"checked",e,!1)}function $A(s,e){T4(s,e);var t=Pu(e.value),n=e.type;if(t!=null)n==="number"?(t===0&&s.value===""||s.value!=t)&&(s.value=""+t):s.value!==""+t&&(s.value=""+t);else if(n==="submit"||n==="reset"){s.removeAttribute("value");return}e.hasOwnProperty("value")?UA(s,e.type,t):e.hasOwnProperty("defaultValue")&&UA(s,e.type,Pu(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(s.defaultChecked=!!e.defaultChecked)}function yI(s,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+s._wrapperState.initialValue,t||e===s.value||(s.value=e),s.defaultValue=e}t=s.name,t!==""&&(s.name=""),s.defaultChecked=!!s._wrapperState.initialChecked,t!==""&&(s.name=t)}function UA(s,e,t){(e!=="number"||SC(s.ownerDocument)!==s)&&(t==null?s.defaultValue=""+s._wrapperState.initialValue:s.defaultValue!==""+t&&(s.defaultValue=""+t))}var my=Array.isArray;function vp(s,e,t,n){if(s=s.options,e){e={};for(var r=0;r<t.length;r++)e["$"+t[r]]=!0;for(t=0;t<s.length;t++)r=e.hasOwnProperty("$"+s[t].value),s[t].selected!==r&&(s[t].selected=r),r&&n&&(s[t].defaultSelected=!0)}else{for(t=""+Pu(t),e=null,r=0;r<s.length;r++){if(s[r].value===t){s[r].selected=!0,n&&(s[r].defaultSelected=!0);return}e!==null||s[r].disabled||(e=s[r])}e!==null&&(e.selected=!0)}}function zA(s,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Te(91));return Os({},e,{value:void 0,defaultValue:void 0,children:""+s._wrapperState.initialValue})}function vI(s,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(Te(92));if(my(t)){if(1<t.length)throw Error(Te(93));t=t[0]}e=t}e==null&&(e=""),t=e}s._wrapperState={initialValue:Pu(t)}}function E4(s,e){var t=Pu(e.value),n=Pu(e.defaultValue);t!=null&&(t=""+t,t!==s.value&&(s.value=t),e.defaultValue==null&&s.defaultValue!==t&&(s.defaultValue=t)),n!=null&&(s.defaultValue=""+n)}function bI(s){var e=s.textContent;e===s._wrapperState.initialValue&&e!==""&&e!==null&&(s.value=e)}function P4(s){switch(s){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function HA(s,e){return s==null||s==="http://www.w3.org/1999/xhtml"?P4(e):s==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":s}var Sw,M4=function(s){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction(function(){return s(e,t,n,r)})}:s}(function(s,e){if(s.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in s)s.innerHTML=e;else{for(Sw=Sw||document.createElement("div"),Sw.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Sw.firstChild;s.firstChild;)s.removeChild(s.firstChild);for(;e.firstChild;)s.appendChild(e.firstChild)}});function gv(s,e){if(e){var t=s.firstChild;if(t&&t===s.lastChild&&t.nodeType===3){t.nodeValue=e;return}}s.textContent=e}var Yy={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},$W=["Webkit","ms","Moz","O"];Object.keys(Yy).forEach(function(s){$W.forEach(function(e){e=e+s.charAt(0).toUpperCase()+s.substring(1),Yy[e]=Yy[s]})});function I4(s,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Yy.hasOwnProperty(s)&&Yy[s]?(""+e).trim():e+"px"}function R4(s,e){s=s.style;for(var t in e)if(e.hasOwnProperty(t)){var n=t.indexOf("--")===0,r=I4(t,e[t],n);t==="float"&&(t="cssFloat"),n?s.setProperty(t,r):s[t]=r}}var UW=Os({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function VA(s,e){if(e){if(UW[s]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Te(137,s));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Te(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Te(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Te(62))}}function WA(s,e){if(s.indexOf("-")===-1)return typeof e.is=="string";switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var qA=null;function AE(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var GA=null,bp=null,wp=null;function wI(s){if(s=Q0(s)){if(typeof GA!="function")throw Error(Te(280));var e=s.stateNode;e&&(e=xj(e),GA(s.stateNode,s.type,e))}}function D4(s){bp?wp?wp.push(s):wp=[s]:bp=s}function L4(){if(bp){var s=bp,e=wp;if(wp=bp=null,wI(s),e)for(s=0;s<e.length;s++)wI(e[s])}}function O4(s,e){return s(e)}function F4(){}var Jk=!1;function B4(s,e,t){if(Jk)return s(e,t);Jk=!0;try{return O4(s,e,t)}finally{Jk=!1,(bp!==null||wp!==null)&&(F4(),L4())}}function xv(s,e){var t=s.stateNode;if(t===null)return null;var n=xj(t);if(n===null)return null;t=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(s=s.type,n=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!n;break e;default:s=!1}if(s)return null;if(t&&typeof t!="function")throw Error(Te(231,e,typeof t));return t}var YA=!1;if(Pc)try{var Vx={};Object.defineProperty(Vx,"passive",{get:function(){YA=!0}}),window.addEventListener("test",Vx,Vx),window.removeEventListener("test",Vx,Vx)}catch{YA=!1}function zW(s,e,t,n,r,a,o,l,c){var d=Array.prototype.slice.call(arguments,3);try{e.apply(t,d)}catch(h){this.onError(h)}}var Ky=!1,jC=null,kC=!1,KA=null,HW={onError:function(s){Ky=!0,jC=s}};function VW(s,e,t,n,r,a,o,l,c){Ky=!1,jC=null,zW.apply(HW,arguments)}function WW(s,e,t,n,r,a,o,l,c){if(VW.apply(this,arguments),Ky){if(Ky){var d=jC;Ky=!1,jC=null}else throw Error(Te(198));kC||(kC=!0,KA=d)}}function bm(s){var e=s,t=s;if(s.alternate)for(;e.return;)e=e.return;else{s=e;do e=s,e.flags&4098&&(t=e.return),s=e.return;while(s)}return e.tag===3?t:null}function $4(s){if(s.tag===13){var e=s.memoizedState;if(e===null&&(s=s.alternate,s!==null&&(e=s.memoizedState)),e!==null)return e.dehydrated}return null}function CI(s){if(bm(s)!==s)throw Error(Te(188))}function qW(s){var e=s.alternate;if(!e){if(e=bm(s),e===null)throw Error(Te(188));return e!==s?null:s}for(var t=s,n=e;;){var r=t.return;if(r===null)break;var a=r.alternate;if(a===null){if(n=r.return,n!==null){t=n;continue}break}if(r.child===a.child){for(a=r.child;a;){if(a===t)return CI(r),s;if(a===n)return CI(r),e;a=a.sibling}throw Error(Te(188))}if(t.return!==n.return)t=r,n=a;else{for(var o=!1,l=r.child;l;){if(l===t){o=!0,t=r,n=a;break}if(l===n){o=!0,n=r,t=a;break}l=l.sibling}if(!o){for(l=a.child;l;){if(l===t){o=!0,t=a,n=r;break}if(l===n){o=!0,n=a,t=r;break}l=l.sibling}if(!o)throw Error(Te(189))}}if(t.alternate!==n)throw Error(Te(190))}if(t.tag!==3)throw Error(Te(188));return t.stateNode.current===t?s:e}function U4(s){return s=qW(s),s!==null?z4(s):null}function z4(s){if(s.tag===5||s.tag===6)return s;for(s=s.child;s!==null;){var e=z4(s);if(e!==null)return e;s=s.sibling}return null}var H4=Gi.unstable_scheduleCallback,SI=Gi.unstable_cancelCallback,GW=Gi.unstable_shouldYield,YW=Gi.unstable_requestPaint,Zs=Gi.unstable_now,KW=Gi.unstable_getCurrentPriorityLevel,_E=Gi.unstable_ImmediatePriority,V4=Gi.unstable_UserBlockingPriority,NC=Gi.unstable_NormalPriority,XW=Gi.unstable_LowPriority,W4=Gi.unstable_IdlePriority,fj=null,ml=null;function QW(s){if(ml&&typeof ml.onCommitFiberRoot=="function")try{ml.onCommitFiberRoot(fj,s,void 0,(s.current.flags&128)===128)}catch{}}var yo=Math.clz32?Math.clz32:eq,ZW=Math.log,JW=Math.LN2;function eq(s){return s>>>=0,s===0?32:31-(ZW(s)/JW|0)|0}var jw=64,kw=4194304;function py(s){switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return s&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return s}}function AC(s,e){var t=s.pendingLanes;if(t===0)return 0;var n=0,r=s.suspendedLanes,a=s.pingedLanes,o=t&268435455;if(o!==0){var l=o&~r;l!==0?n=py(l):(a&=o,a!==0&&(n=py(a)))}else o=t&~r,o!==0?n=py(o):a!==0&&(n=py(a));if(n===0)return 0;if(e!==0&&e!==n&&!(e&r)&&(r=n&-n,a=e&-e,r>=a||r===16&&(a&4194240)!==0))return e;if(n&4&&(n|=t&16),e=s.entangledLanes,e!==0)for(s=s.entanglements,e&=n;0<e;)t=31-yo(e),r=1<<t,n|=s[t],e&=~r;return n}function tq(s,e){switch(s){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function sq(s,e){for(var t=s.suspendedLanes,n=s.pingedLanes,r=s.expirationTimes,a=s.pendingLanes;0<a;){var o=31-yo(a),l=1<<o,c=r[o];c===-1?(!(l&t)||l&n)&&(r[o]=tq(l,e)):c<=e&&(s.expiredLanes|=l),a&=~l}}function XA(s){return s=s.pendingLanes&-1073741825,s!==0?s:s&1073741824?1073741824:0}function q4(){var s=jw;return jw<<=1,!(jw&4194240)&&(jw=64),s}function eN(s){for(var e=[],t=0;31>t;t++)e.push(s);return e}function K0(s,e,t){s.pendingLanes|=e,e!==536870912&&(s.suspendedLanes=0,s.pingedLanes=0),s=s.eventTimes,e=31-yo(e),s[e]=t}function nq(s,e){var t=s.pendingLanes&~e;s.pendingLanes=e,s.suspendedLanes=0,s.pingedLanes=0,s.expiredLanes&=e,s.mutableReadLanes&=e,s.entangledLanes&=e,e=s.entanglements;var n=s.eventTimes;for(s=s.expirationTimes;0<t;){var r=31-yo(t),a=1<<r;e[r]=0,n[r]=-1,s[r]=-1,t&=~a}}function TE(s,e){var t=s.entangledLanes|=e;for(s=s.entanglements;t;){var n=31-yo(t),r=1<<n;r&e|s[n]&e&&(s[n]|=e),t&=~r}}var Zt=0;function G4(s){return s&=-s,1<s?4<s?s&268435455?16:536870912:4:1}var Y4,EE,K4,X4,Q4,QA=!1,Nw=[],yu=null,vu=null,bu=null,yv=new Map,vv=new Map,dd=[],rq="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function jI(s,e){switch(s){case"focusin":case"focusout":yu=null;break;case"dragenter":case"dragleave":vu=null;break;case"mouseover":case"mouseout":bu=null;break;case"pointerover":case"pointerout":yv.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":vv.delete(e.pointerId)}}function Wx(s,e,t,n,r,a){return s===null||s.nativeEvent!==a?(s={blockedOn:e,domEventName:t,eventSystemFlags:n,nativeEvent:a,targetContainers:[r]},e!==null&&(e=Q0(e),e!==null&&EE(e)),s):(s.eventSystemFlags|=n,e=s.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),s)}function iq(s,e,t,n,r){switch(e){case"focusin":return yu=Wx(yu,s,e,t,n,r),!0;case"dragenter":return vu=Wx(vu,s,e,t,n,r),!0;case"mouseover":return bu=Wx(bu,s,e,t,n,r),!0;case"pointerover":var a=r.pointerId;return yv.set(a,Wx(yv.get(a)||null,s,e,t,n,r)),!0;case"gotpointercapture":return a=r.pointerId,vv.set(a,Wx(vv.get(a)||null,s,e,t,n,r)),!0}return!1}function Z4(s){var e=xh(s.target);if(e!==null){var t=bm(e);if(t!==null){if(e=t.tag,e===13){if(e=$4(t),e!==null){s.blockedOn=e,Q4(s.priority,function(){K4(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){s.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}s.blockedOn=null}function x1(s){if(s.blockedOn!==null)return!1;for(var e=s.targetContainers;0<e.length;){var t=ZA(s.domEventName,s.eventSystemFlags,e[0],s.nativeEvent);if(t===null){t=s.nativeEvent;var n=new t.constructor(t.type,t);qA=n,t.target.dispatchEvent(n),qA=null}else return e=Q0(t),e!==null&&EE(e),s.blockedOn=t,!1;e.shift()}return!0}function kI(s,e,t){x1(s)&&t.delete(e)}function aq(){QA=!1,yu!==null&&x1(yu)&&(yu=null),vu!==null&&x1(vu)&&(vu=null),bu!==null&&x1(bu)&&(bu=null),yv.forEach(kI),vv.forEach(kI)}function qx(s,e){s.blockedOn===e&&(s.blockedOn=null,QA||(QA=!0,Gi.unstable_scheduleCallback(Gi.unstable_NormalPriority,aq)))}function bv(s){function e(r){return qx(r,s)}if(0<Nw.length){qx(Nw[0],s);for(var t=1;t<Nw.length;t++){var n=Nw[t];n.blockedOn===s&&(n.blockedOn=null)}}for(yu!==null&&qx(yu,s),vu!==null&&qx(vu,s),bu!==null&&qx(bu,s),yv.forEach(e),vv.forEach(e),t=0;t<dd.length;t++)n=dd[t],n.blockedOn===s&&(n.blockedOn=null);for(;0<dd.length&&(t=dd[0],t.blockedOn===null);)Z4(t),t.blockedOn===null&&dd.shift()}var Cp=Hc.ReactCurrentBatchConfig,_C=!0;function oq(s,e,t,n){var r=Zt,a=Cp.transition;Cp.transition=null;try{Zt=1,PE(s,e,t,n)}finally{Zt=r,Cp.transition=a}}function lq(s,e,t,n){var r=Zt,a=Cp.transition;Cp.transition=null;try{Zt=4,PE(s,e,t,n)}finally{Zt=r,Cp.transition=a}}function PE(s,e,t,n){if(_C){var r=ZA(s,e,t,n);if(r===null)dN(s,e,n,TC,t),jI(s,n);else if(iq(r,s,e,t,n))n.stopPropagation();else if(jI(s,n),e&4&&-1<rq.indexOf(s)){for(;r!==null;){var a=Q0(r);if(a!==null&&Y4(a),a=ZA(s,e,t,n),a===null&&dN(s,e,n,TC,t),a===r)break;r=a}r!==null&&n.stopPropagation()}else dN(s,e,n,null,t)}}var TC=null;function ZA(s,e,t,n){if(TC=null,s=AE(n),s=xh(s),s!==null)if(e=bm(s),e===null)s=null;else if(t=e.tag,t===13){if(s=$4(e),s!==null)return s;s=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;s=null}else e!==s&&(s=null);return TC=s,null}function J4(s){switch(s){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(KW()){case _E:return 1;case V4:return 4;case NC:case XW:return 16;case W4:return 536870912;default:return 16}default:return 16}}var hu=null,ME=null,y1=null;function eF(){if(y1)return y1;var s,e=ME,t=e.length,n,r="value"in hu?hu.value:hu.textContent,a=r.length;for(s=0;s<t&&e[s]===r[s];s++);var o=t-s;for(n=1;n<=o&&e[t-n]===r[a-n];n++);return y1=r.slice(s,1<n?1-n:void 0)}function v1(s){var e=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&e===13&&(s=13)):s=e,s===10&&(s=13),32<=s||s===13?s:0}function Aw(){return!0}function NI(){return!1}function Zi(s){function e(t,n,r,a,o){this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=a,this.target=o,this.currentTarget=null;for(var l in s)s.hasOwnProperty(l)&&(t=s[l],this[l]=t?t(a):a[l]);return this.isDefaultPrevented=(a.defaultPrevented!=null?a.defaultPrevented:a.returnValue===!1)?Aw:NI,this.isPropagationStopped=NI,this}return Os(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Aw)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Aw)},persist:function(){},isPersistent:Aw}),e}var Rx={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},IE=Zi(Rx),X0=Os({},Rx,{view:0,detail:0}),cq=Zi(X0),tN,sN,Gx,mj=Os({},X0,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:RE,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Gx&&(Gx&&s.type==="mousemove"?(tN=s.screenX-Gx.screenX,sN=s.screenY-Gx.screenY):sN=tN=0,Gx=s),tN)},movementY:function(s){return"movementY"in s?s.movementY:sN}}),AI=Zi(mj),dq=Os({},mj,{dataTransfer:0}),uq=Zi(dq),hq=Os({},X0,{relatedTarget:0}),nN=Zi(hq),fq=Os({},Rx,{animationName:0,elapsedTime:0,pseudoElement:0}),mq=Zi(fq),pq=Os({},Rx,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),gq=Zi(pq),xq=Os({},Rx,{data:0}),_I=Zi(xq),yq={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},vq={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},bq={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function wq(s){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(s):(s=bq[s])?!!e[s]:!1}function RE(){return wq}var Cq=Os({},X0,{key:function(s){if(s.key){var e=yq[s.key]||s.key;if(e!=="Unidentified")return e}return s.type==="keypress"?(s=v1(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?vq[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:RE,charCode:function(s){return s.type==="keypress"?v1(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?v1(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),Sq=Zi(Cq),jq=Os({},mj,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),TI=Zi(jq),kq=Os({},X0,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:RE}),Nq=Zi(kq),Aq=Os({},Rx,{propertyName:0,elapsedTime:0,pseudoElement:0}),_q=Zi(Aq),Tq=Os({},mj,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),Eq=Zi(Tq),Pq=[9,13,27,32],DE=Pc&&"CompositionEvent"in window,Xy=null;Pc&&"documentMode"in document&&(Xy=document.documentMode);var Mq=Pc&&"TextEvent"in window&&!Xy,tF=Pc&&(!DE||Xy&&8<Xy&&11>=Xy),EI=" ",PI=!1;function sF(s,e){switch(s){case"keyup":return Pq.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function nF(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var sp=!1;function Iq(s,e){switch(s){case"compositionend":return nF(e);case"keypress":return e.which!==32?null:(PI=!0,EI);case"textInput":return s=e.data,s===EI&&PI?null:s;default:return null}}function Rq(s,e){if(sp)return s==="compositionend"||!DE&&sF(s,e)?(s=eF(),y1=ME=hu=null,sp=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return tF&&e.locale!=="ko"?null:e.data;default:return null}}var Dq={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function MI(s){var e=s&&s.nodeName&&s.nodeName.toLowerCase();return e==="input"?!!Dq[s.type]:e==="textarea"}function rF(s,e,t,n){D4(n),e=EC(e,"onChange"),0<e.length&&(t=new IE("onChange","change",null,t,n),s.push({event:t,listeners:e}))}var Qy=null,wv=null;function Lq(s){pF(s,0)}function pj(s){var e=ip(s);if(_4(e))return s}function Oq(s,e){if(s==="change")return e}var iF=!1;if(Pc){var rN;if(Pc){var iN="oninput"in document;if(!iN){var II=document.createElement("div");II.setAttribute("oninput","return;"),iN=typeof II.oninput=="function"}rN=iN}else rN=!1;iF=rN&&(!document.documentMode||9<document.documentMode)}function RI(){Qy&&(Qy.detachEvent("onpropertychange",aF),wv=Qy=null)}function aF(s){if(s.propertyName==="value"&&pj(wv)){var e=[];rF(e,wv,s,AE(s)),B4(Lq,e)}}function Fq(s,e,t){s==="focusin"?(RI(),Qy=e,wv=t,Qy.attachEvent("onpropertychange",aF)):s==="focusout"&&RI()}function Bq(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return pj(wv)}function $q(s,e){if(s==="click")return pj(e)}function Uq(s,e){if(s==="input"||s==="change")return pj(e)}function zq(s,e){return s===e&&(s!==0||1/s===1/e)||s!==s&&e!==e}var So=typeof Object.is=="function"?Object.is:zq;function Cv(s,e){if(So(s,e))return!0;if(typeof s!="object"||s===null||typeof e!="object"||e===null)return!1;var t=Object.keys(s),n=Object.keys(e);if(t.length!==n.length)return!1;for(n=0;n<t.length;n++){var r=t[n];if(!RA.call(e,r)||!So(s[r],e[r]))return!1}return!0}function DI(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function LI(s,e){var t=DI(s);s=0;for(var n;t;){if(t.nodeType===3){if(n=s+t.textContent.length,s<=e&&n>=e)return{node:t,offset:e-s};s=n}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=DI(t)}}function oF(s,e){return s&&e?s===e?!0:s&&s.nodeType===3?!1:e&&e.nodeType===3?oF(s,e.parentNode):"contains"in s?s.contains(e):s.compareDocumentPosition?!!(s.compareDocumentPosition(e)&16):!1:!1}function lF(){for(var s=window,e=SC();e instanceof s.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)s=e.contentWindow;else break;e=SC(s.document)}return e}function LE(s){var e=s&&s.nodeName&&s.nodeName.toLowerCase();return e&&(e==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||e==="textarea"||s.contentEditable==="true")}function Hq(s){var e=lF(),t=s.focusedElem,n=s.selectionRange;if(e!==t&&t&&t.ownerDocument&&oF(t.ownerDocument.documentElement,t)){if(n!==null&&LE(t)){if(e=n.start,s=n.end,s===void 0&&(s=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(s,t.value.length);else if(s=(e=t.ownerDocument||document)&&e.defaultView||window,s.getSelection){s=s.getSelection();var r=t.textContent.length,a=Math.min(n.start,r);n=n.end===void 0?a:Math.min(n.end,r),!s.extend&&a>n&&(r=n,n=a,a=r),r=LI(t,a);var o=LI(t,n);r&&o&&(s.rangeCount!==1||s.anchorNode!==r.node||s.anchorOffset!==r.offset||s.focusNode!==o.node||s.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),s.removeAllRanges(),a>n?(s.addRange(e),s.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),s.addRange(e)))}}for(e=[],s=t;s=s.parentNode;)s.nodeType===1&&e.push({element:s,left:s.scrollLeft,top:s.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)s=e[t],s.element.scrollLeft=s.left,s.element.scrollTop=s.top}}var Vq=Pc&&"documentMode"in document&&11>=document.documentMode,np=null,JA=null,Zy=null,e_=!1;function OI(s,e,t){var n=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;e_||np==null||np!==SC(n)||(n=np,"selectionStart"in n&&LE(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Zy&&Cv(Zy,n)||(Zy=n,n=EC(JA,"onSelect"),0<n.length&&(e=new IE("onSelect","select",null,e,t),s.push({event:e,listeners:n}),e.target=np)))}function _w(s,e){var t={};return t[s.toLowerCase()]=e.toLowerCase(),t["Webkit"+s]="webkit"+e,t["Moz"+s]="moz"+e,t}var rp={animationend:_w("Animation","AnimationEnd"),animationiteration:_w("Animation","AnimationIteration"),animationstart:_w("Animation","AnimationStart"),transitionend:_w("Transition","TransitionEnd")},aN={},cF={};Pc&&(cF=document.createElement("div").style,"AnimationEvent"in window||(delete rp.animationend.animation,delete rp.animationiteration.animation,delete rp.animationstart.animation),"TransitionEvent"in window||delete rp.transitionend.transition);function gj(s){if(aN[s])return aN[s];if(!rp[s])return s;var e=rp[s],t;for(t in e)if(e.hasOwnProperty(t)&&t in cF)return aN[s]=e[t];return s}var dF=gj("animationend"),uF=gj("animationiteration"),hF=gj("animationstart"),fF=gj("transitionend"),mF=new Map,FI="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Vu(s,e){mF.set(s,e),vm(e,[s])}for(var oN=0;oN<FI.length;oN++){var lN=FI[oN],Wq=lN.toLowerCase(),qq=lN[0].toUpperCase()+lN.slice(1);Vu(Wq,"on"+qq)}Vu(dF,"onAnimationEnd");Vu(uF,"onAnimationIteration");Vu(hF,"onAnimationStart");Vu("dblclick","onDoubleClick");Vu("focusin","onFocus");Vu("focusout","onBlur");Vu(fF,"onTransitionEnd");dx("onMouseEnter",["mouseout","mouseover"]);dx("onMouseLeave",["mouseout","mouseover"]);dx("onPointerEnter",["pointerout","pointerover"]);dx("onPointerLeave",["pointerout","pointerover"]);vm("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));vm("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));vm("onBeforeInput",["compositionend","keypress","textInput","paste"]);vm("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));vm("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));vm("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var gy="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Gq=new Set("cancel close invalid load scroll toggle".split(" ").concat(gy));function BI(s,e,t){var n=s.type||"unknown-event";s.currentTarget=t,WW(n,e,void 0,s),s.currentTarget=null}function pF(s,e){e=(e&4)!==0;for(var t=0;t<s.length;t++){var n=s[t],r=n.event;n=n.listeners;e:{var a=void 0;if(e)for(var o=n.length-1;0<=o;o--){var l=n[o],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==a&&r.isPropagationStopped())break e;BI(r,l,d),a=c}else for(o=0;o<n.length;o++){if(l=n[o],c=l.instance,d=l.currentTarget,l=l.listener,c!==a&&r.isPropagationStopped())break e;BI(r,l,d),a=c}}}if(kC)throw s=KA,kC=!1,KA=null,s}function vs(s,e){var t=e[i_];t===void 0&&(t=e[i_]=new Set);var n=s+"__bubble";t.has(n)||(gF(e,s,2,!1),t.add(n))}function cN(s,e,t){var n=0;e&&(n|=4),gF(t,s,n,e)}var Tw="_reactListening"+Math.random().toString(36).slice(2);function Sv(s){if(!s[Tw]){s[Tw]=!0,S4.forEach(function(t){t!=="selectionchange"&&(Gq.has(t)||cN(t,!1,s),cN(t,!0,s))});var e=s.nodeType===9?s:s.ownerDocument;e===null||e[Tw]||(e[Tw]=!0,cN("selectionchange",!1,e))}}function gF(s,e,t,n){switch(J4(e)){case 1:var r=oq;break;case 4:r=lq;break;default:r=PE}t=r.bind(null,e,t,s),r=void 0,!YA||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),n?r!==void 0?s.addEventListener(e,t,{capture:!0,passive:r}):s.addEventListener(e,t,!0):r!==void 0?s.addEventListener(e,t,{passive:r}):s.addEventListener(e,t,!1)}function dN(s,e,t,n,r){var a=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var o=n.tag;if(o===3||o===4){var l=n.stateNode.containerInfo;if(l===r||l.nodeType===8&&l.parentNode===r)break;if(o===4)for(o=n.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===r||c.nodeType===8&&c.parentNode===r))return;o=o.return}for(;l!==null;){if(o=xh(l),o===null)return;if(c=o.tag,c===5||c===6){n=a=o;continue e}l=l.parentNode}}n=n.return}B4(function(){var d=a,h=AE(t),f=[];e:{var m=mF.get(s);if(m!==void 0){var p=IE,x=s;switch(s){case"keypress":if(v1(t)===0)break e;case"keydown":case"keyup":p=Sq;break;case"focusin":x="focus",p=nN;break;case"focusout":x="blur",p=nN;break;case"beforeblur":case"afterblur":p=nN;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=AI;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=uq;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=Nq;break;case dF:case uF:case hF:p=mq;break;case fF:p=_q;break;case"scroll":p=cq;break;case"wheel":p=Eq;break;case"copy":case"cut":case"paste":p=gq;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=TI}var g=(e&4)!==0,b=!g&&s==="scroll",v=g?m!==null?m+"Capture":null:m;g=[];for(var y=d,w;y!==null;){w=y;var S=w.stateNode;if(w.tag===5&&S!==null&&(w=S,v!==null&&(S=xv(y,v),S!=null&&g.push(jv(y,S,w)))),b)break;y=y.return}0<g.length&&(m=new p(m,x,null,t,h),f.push({event:m,listeners:g}))}}if(!(e&7)){e:{if(m=s==="mouseover"||s==="pointerover",p=s==="mouseout"||s==="pointerout",m&&t!==qA&&(x=t.relatedTarget||t.fromElement)&&(xh(x)||x[Mc]))break e;if((p||m)&&(m=h.window===h?h:(m=h.ownerDocument)?m.defaultView||m.parentWindow:window,p?(x=t.relatedTarget||t.toElement,p=d,x=x?xh(x):null,x!==null&&(b=bm(x),x!==b||x.tag!==5&&x.tag!==6)&&(x=null)):(p=null,x=d),p!==x)){if(g=AI,S="onMouseLeave",v="onMouseEnter",y="mouse",(s==="pointerout"||s==="pointerover")&&(g=TI,S="onPointerLeave",v="onPointerEnter",y="pointer"),b=p==null?m:ip(p),w=x==null?m:ip(x),m=new g(S,y+"leave",p,t,h),m.target=b,m.relatedTarget=w,S=null,xh(h)===d&&(g=new g(v,y+"enter",x,t,h),g.target=w,g.relatedTarget=b,S=g),b=S,p&&x)t:{for(g=p,v=x,y=0,w=g;w;w=Am(w))y++;for(w=0,S=v;S;S=Am(S))w++;for(;0<y-w;)g=Am(g),y--;for(;0<w-y;)v=Am(v),w--;for(;y--;){if(g===v||v!==null&&g===v.alternate)break t;g=Am(g),v=Am(v)}g=null}else g=null;p!==null&&$I(f,m,p,g,!1),x!==null&&b!==null&&$I(f,b,x,g,!0)}}e:{if(m=d?ip(d):window,p=m.nodeName&&m.nodeName.toLowerCase(),p==="select"||p==="input"&&m.type==="file")var j=Oq;else if(MI(m))if(iF)j=Uq;else{j=Bq;var A=Fq}else(p=m.nodeName)&&p.toLowerCase()==="input"&&(m.type==="checkbox"||m.type==="radio")&&(j=$q);if(j&&(j=j(s,d))){rF(f,j,t,h);break e}A&&A(s,m,d),s==="focusout"&&(A=m._wrapperState)&&A.controlled&&m.type==="number"&&UA(m,"number",m.value)}switch(A=d?ip(d):window,s){case"focusin":(MI(A)||A.contentEditable==="true")&&(np=A,JA=d,Zy=null);break;case"focusout":Zy=JA=np=null;break;case"mousedown":e_=!0;break;case"contextmenu":case"mouseup":case"dragend":e_=!1,OI(f,t,h);break;case"selectionchange":if(Vq)break;case"keydown":case"keyup":OI(f,t,h)}var k;if(DE)e:{switch(s){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else sp?sF(s,t)&&(_="onCompositionEnd"):s==="keydown"&&t.keyCode===229&&(_="onCompositionStart");_&&(tF&&t.locale!=="ko"&&(sp||_!=="onCompositionStart"?_==="onCompositionEnd"&&sp&&(k=eF()):(hu=h,ME="value"in hu?hu.value:hu.textContent,sp=!0)),A=EC(d,_),0<A.length&&(_=new _I(_,s,null,t,h),f.push({event:_,listeners:A}),k?_.data=k:(k=nF(t),k!==null&&(_.data=k)))),(k=Mq?Iq(s,t):Rq(s,t))&&(d=EC(d,"onBeforeInput"),0<d.length&&(h=new _I("onBeforeInput","beforeinput",null,t,h),f.push({event:h,listeners:d}),h.data=k))}pF(f,e)})}function jv(s,e,t){return{instance:s,listener:e,currentTarget:t}}function EC(s,e){for(var t=e+"Capture",n=[];s!==null;){var r=s,a=r.stateNode;r.tag===5&&a!==null&&(r=a,a=xv(s,t),a!=null&&n.unshift(jv(s,a,r)),a=xv(s,e),a!=null&&n.push(jv(s,a,r))),s=s.return}return n}function Am(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5);return s||null}function $I(s,e,t,n,r){for(var a=e._reactName,o=[];t!==null&&t!==n;){var l=t,c=l.alternate,d=l.stateNode;if(c!==null&&c===n)break;l.tag===5&&d!==null&&(l=d,r?(c=xv(t,a),c!=null&&o.unshift(jv(t,c,l))):r||(c=xv(t,a),c!=null&&o.push(jv(t,c,l)))),t=t.return}o.length!==0&&s.push({event:e,listeners:o})}var Yq=/\r\n?/g,Kq=/\u0000|\uFFFD/g;function UI(s){return(typeof s=="string"?s:""+s).replace(Yq,`
`).replace(Kq,"")}function Ew(s,e,t){if(e=UI(e),UI(s)!==e&&t)throw Error(Te(425))}function PC(){}var t_=null,s_=null;function n_(s,e){return s==="textarea"||s==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var r_=typeof setTimeout=="function"?setTimeout:void 0,Xq=typeof clearTimeout=="function"?clearTimeout:void 0,zI=typeof Promise=="function"?Promise:void 0,Qq=typeof queueMicrotask=="function"?queueMicrotask:typeof zI<"u"?function(s){return zI.resolve(null).then(s).catch(Zq)}:r_;function Zq(s){setTimeout(function(){throw s})}function uN(s,e){var t=e,n=0;do{var r=t.nextSibling;if(s.removeChild(t),r&&r.nodeType===8)if(t=r.data,t==="/$"){if(n===0){s.removeChild(r),bv(e);return}n--}else t!=="$"&&t!=="$?"&&t!=="$!"||n++;t=r}while(t);bv(e)}function wu(s){for(;s!=null;s=s.nextSibling){var e=s.nodeType;if(e===1||e===3)break;if(e===8){if(e=s.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return s}function HI(s){s=s.previousSibling;for(var e=0;s;){if(s.nodeType===8){var t=s.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return s;e--}else t==="/$"&&e++}s=s.previousSibling}return null}var Dx=Math.random().toString(36).slice(2),ll="__reactFiber$"+Dx,kv="__reactProps$"+Dx,Mc="__reactContainer$"+Dx,i_="__reactEvents$"+Dx,Jq="__reactListeners$"+Dx,e9="__reactHandles$"+Dx;function xh(s){var e=s[ll];if(e)return e;for(var t=s.parentNode;t;){if(e=t[Mc]||t[ll]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(s=HI(s);s!==null;){if(t=s[ll])return t;s=HI(s)}return e}s=t,t=s.parentNode}return null}function Q0(s){return s=s[ll]||s[Mc],!s||s.tag!==5&&s.tag!==6&&s.tag!==13&&s.tag!==3?null:s}function ip(s){if(s.tag===5||s.tag===6)return s.stateNode;throw Error(Te(33))}function xj(s){return s[kv]||null}var a_=[],ap=-1;function Wu(s){return{current:s}}function ws(s){0>ap||(s.current=a_[ap],a_[ap]=null,ap--)}function fs(s,e){ap++,a_[ap]=s.current,s.current=e}var Mu={},fr=Wu(Mu),ai=Wu(!1),Zf=Mu;function ux(s,e){var t=s.type.contextTypes;if(!t)return Mu;var n=s.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var r={},a;for(a in t)r[a]=e[a];return n&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=e,s.__reactInternalMemoizedMaskedChildContext=r),r}function oi(s){return s=s.childContextTypes,s!=null}function MC(){ws(ai),ws(fr)}function VI(s,e,t){if(fr.current!==Mu)throw Error(Te(168));fs(fr,e),fs(ai,t)}function xF(s,e,t){var n=s.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return t;n=n.getChildContext();for(var r in n)if(!(r in e))throw Error(Te(108,FW(s)||"Unknown",r));return Os({},t,n)}function IC(s){return s=(s=s.stateNode)&&s.__reactInternalMemoizedMergedChildContext||Mu,Zf=fr.current,fs(fr,s),fs(ai,ai.current),!0}function WI(s,e,t){var n=s.stateNode;if(!n)throw Error(Te(169));t?(s=xF(s,e,Zf),n.__reactInternalMemoizedMergedChildContext=s,ws(ai),ws(fr),fs(fr,s)):ws(ai),fs(ai,t)}var $l=null,yj=!1,hN=!1;function yF(s){$l===null?$l=[s]:$l.push(s)}function t9(s){yj=!0,yF(s)}function qu(){if(!hN&&$l!==null){hN=!0;var s=0,e=Zt;try{var t=$l;for(Zt=1;s<t.length;s++){var n=t[s];do n=n(!0);while(n!==null)}$l=null,yj=!1}catch(r){throw $l!==null&&($l=$l.slice(s+1)),H4(_E,qu),r}finally{Zt=e,hN=!1}}return null}var op=[],lp=0,RC=null,DC=0,wa=[],Ca=0,Jf=null,jc=1,kc="";function rh(s,e){op[lp++]=DC,op[lp++]=RC,RC=s,DC=e}function vF(s,e,t){wa[Ca++]=jc,wa[Ca++]=kc,wa[Ca++]=Jf,Jf=s;var n=jc;s=kc;var r=32-yo(n)-1;n&=~(1<<r),t+=1;var a=32-yo(e)+r;if(30<a){var o=r-r%5;a=(n&(1<<o)-1).toString(32),n>>=o,r-=o,jc=1<<32-yo(e)+r|t<<r|n,kc=a+s}else jc=1<<a|t<<r|n,kc=s}function OE(s){s.return!==null&&(rh(s,1),vF(s,1,0))}function FE(s){for(;s===RC;)RC=op[--lp],op[lp]=null,DC=op[--lp],op[lp]=null;for(;s===Jf;)Jf=wa[--Ca],wa[Ca]=null,kc=wa[--Ca],wa[Ca]=null,jc=wa[--Ca],wa[Ca]=null}var Vi=null,Hi=null,Ts=!1,lo=null;function bF(s,e){var t=ka(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=s,e=s.deletions,e===null?(s.deletions=[t],s.flags|=16):e.push(t)}function qI(s,e){switch(s.tag){case 5:var t=s.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(s.stateNode=e,Vi=s,Hi=wu(e.firstChild),!0):!1;case 6:return e=s.pendingProps===""||e.nodeType!==3?null:e,e!==null?(s.stateNode=e,Vi=s,Hi=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Jf!==null?{id:jc,overflow:kc}:null,s.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=ka(18,null,null,0),t.stateNode=e,t.return=s,s.child=t,Vi=s,Hi=null,!0):!1;default:return!1}}function o_(s){return(s.mode&1)!==0&&(s.flags&128)===0}function l_(s){if(Ts){var e=Hi;if(e){var t=e;if(!qI(s,e)){if(o_(s))throw Error(Te(418));e=wu(t.nextSibling);var n=Vi;e&&qI(s,e)?bF(n,t):(s.flags=s.flags&-4097|2,Ts=!1,Vi=s)}}else{if(o_(s))throw Error(Te(418));s.flags=s.flags&-4097|2,Ts=!1,Vi=s}}}function GI(s){for(s=s.return;s!==null&&s.tag!==5&&s.tag!==3&&s.tag!==13;)s=s.return;Vi=s}function Pw(s){if(s!==Vi)return!1;if(!Ts)return GI(s),Ts=!0,!1;var e;if((e=s.tag!==3)&&!(e=s.tag!==5)&&(e=s.type,e=e!=="head"&&e!=="body"&&!n_(s.type,s.memoizedProps)),e&&(e=Hi)){if(o_(s))throw wF(),Error(Te(418));for(;e;)bF(s,e),e=wu(e.nextSibling)}if(GI(s),s.tag===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(Te(317));e:{for(s=s.nextSibling,e=0;s;){if(s.nodeType===8){var t=s.data;if(t==="/$"){if(e===0){Hi=wu(s.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}s=s.nextSibling}Hi=null}}else Hi=Vi?wu(s.stateNode.nextSibling):null;return!0}function wF(){for(var s=Hi;s;)s=wu(s.nextSibling)}function hx(){Hi=Vi=null,Ts=!1}function BE(s){lo===null?lo=[s]:lo.push(s)}var s9=Hc.ReactCurrentBatchConfig;function Yx(s,e,t){if(s=t.ref,s!==null&&typeof s!="function"&&typeof s!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(Te(309));var n=t.stateNode}if(!n)throw Error(Te(147,s));var r=n,a=""+s;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===a?e.ref:(e=function(o){var l=r.refs;o===null?delete l[a]:l[a]=o},e._stringRef=a,e)}if(typeof s!="string")throw Error(Te(284));if(!t._owner)throw Error(Te(290,s))}return s}function Mw(s,e){throw s=Object.prototype.toString.call(e),Error(Te(31,s==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":s))}function YI(s){var e=s._init;return e(s._payload)}function CF(s){function e(v,y){if(s){var w=v.deletions;w===null?(v.deletions=[y],v.flags|=16):w.push(y)}}function t(v,y){if(!s)return null;for(;y!==null;)e(v,y),y=y.sibling;return null}function n(v,y){for(v=new Map;y!==null;)y.key!==null?v.set(y.key,y):v.set(y.index,y),y=y.sibling;return v}function r(v,y){return v=ku(v,y),v.index=0,v.sibling=null,v}function a(v,y,w){return v.index=w,s?(w=v.alternate,w!==null?(w=w.index,w<y?(v.flags|=2,y):w):(v.flags|=2,y)):(v.flags|=1048576,y)}function o(v){return s&&v.alternate===null&&(v.flags|=2),v}function l(v,y,w,S){return y===null||y.tag!==6?(y=vN(w,v.mode,S),y.return=v,y):(y=r(y,w),y.return=v,y)}function c(v,y,w,S){var j=w.type;return j===tp?h(v,y,w.props.children,S,w.key):y!==null&&(y.elementType===j||typeof j=="object"&&j!==null&&j.$$typeof===ad&&YI(j)===y.type)?(S=r(y,w.props),S.ref=Yx(v,y,w),S.return=v,S):(S=N1(w.type,w.key,w.props,null,v.mode,S),S.ref=Yx(v,y,w),S.return=v,S)}function d(v,y,w,S){return y===null||y.tag!==4||y.stateNode.containerInfo!==w.containerInfo||y.stateNode.implementation!==w.implementation?(y=bN(w,v.mode,S),y.return=v,y):(y=r(y,w.children||[]),y.return=v,y)}function h(v,y,w,S,j){return y===null||y.tag!==7?(y=qf(w,v.mode,S,j),y.return=v,y):(y=r(y,w),y.return=v,y)}function f(v,y,w){if(typeof y=="string"&&y!==""||typeof y=="number")return y=vN(""+y,v.mode,w),y.return=v,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case ww:return w=N1(y.type,y.key,y.props,null,v.mode,w),w.ref=Yx(v,null,y),w.return=v,w;case ep:return y=bN(y,v.mode,w),y.return=v,y;case ad:var S=y._init;return f(v,S(y._payload),w)}if(my(y)||Hx(y))return y=qf(y,v.mode,w,null),y.return=v,y;Mw(v,y)}return null}function m(v,y,w,S){var j=y!==null?y.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return j!==null?null:l(v,y,""+w,S);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case ww:return w.key===j?c(v,y,w,S):null;case ep:return w.key===j?d(v,y,w,S):null;case ad:return j=w._init,m(v,y,j(w._payload),S)}if(my(w)||Hx(w))return j!==null?null:h(v,y,w,S,null);Mw(v,w)}return null}function p(v,y,w,S,j){if(typeof S=="string"&&S!==""||typeof S=="number")return v=v.get(w)||null,l(y,v,""+S,j);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case ww:return v=v.get(S.key===null?w:S.key)||null,c(y,v,S,j);case ep:return v=v.get(S.key===null?w:S.key)||null,d(y,v,S,j);case ad:var A=S._init;return p(v,y,w,A(S._payload),j)}if(my(S)||Hx(S))return v=v.get(w)||null,h(y,v,S,j,null);Mw(y,S)}return null}function x(v,y,w,S){for(var j=null,A=null,k=y,_=y=0,L=null;k!==null&&_<w.length;_++){k.index>_?(L=k,k=null):L=k.sibling;var D=m(v,k,w[_],S);if(D===null){k===null&&(k=L);break}s&&k&&D.alternate===null&&e(v,k),y=a(D,y,_),A===null?j=D:A.sibling=D,A=D,k=L}if(_===w.length)return t(v,k),Ts&&rh(v,_),j;if(k===null){for(;_<w.length;_++)k=f(v,w[_],S),k!==null&&(y=a(k,y,_),A===null?j=k:A.sibling=k,A=k);return Ts&&rh(v,_),j}for(k=n(v,k);_<w.length;_++)L=p(k,v,_,w[_],S),L!==null&&(s&&L.alternate!==null&&k.delete(L.key===null?_:L.key),y=a(L,y,_),A===null?j=L:A.sibling=L,A=L);return s&&k.forEach(function(P){return e(v,P)}),Ts&&rh(v,_),j}function g(v,y,w,S){var j=Hx(w);if(typeof j!="function")throw Error(Te(150));if(w=j.call(w),w==null)throw Error(Te(151));for(var A=j=null,k=y,_=y=0,L=null,D=w.next();k!==null&&!D.done;_++,D=w.next()){k.index>_?(L=k,k=null):L=k.sibling;var P=m(v,k,D.value,S);if(P===null){k===null&&(k=L);break}s&&k&&P.alternate===null&&e(v,k),y=a(P,y,_),A===null?j=P:A.sibling=P,A=P,k=L}if(D.done)return t(v,k),Ts&&rh(v,_),j;if(k===null){for(;!D.done;_++,D=w.next())D=f(v,D.value,S),D!==null&&(y=a(D,y,_),A===null?j=D:A.sibling=D,A=D);return Ts&&rh(v,_),j}for(k=n(v,k);!D.done;_++,D=w.next())D=p(k,v,_,D.value,S),D!==null&&(s&&D.alternate!==null&&k.delete(D.key===null?_:D.key),y=a(D,y,_),A===null?j=D:A.sibling=D,A=D);return s&&k.forEach(function(T){return e(v,T)}),Ts&&rh(v,_),j}function b(v,y,w,S){if(typeof w=="object"&&w!==null&&w.type===tp&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case ww:e:{for(var j=w.key,A=y;A!==null;){if(A.key===j){if(j=w.type,j===tp){if(A.tag===7){t(v,A.sibling),y=r(A,w.props.children),y.return=v,v=y;break e}}else if(A.elementType===j||typeof j=="object"&&j!==null&&j.$$typeof===ad&&YI(j)===A.type){t(v,A.sibling),y=r(A,w.props),y.ref=Yx(v,A,w),y.return=v,v=y;break e}t(v,A);break}else e(v,A);A=A.sibling}w.type===tp?(y=qf(w.props.children,v.mode,S,w.key),y.return=v,v=y):(S=N1(w.type,w.key,w.props,null,v.mode,S),S.ref=Yx(v,y,w),S.return=v,v=S)}return o(v);case ep:e:{for(A=w.key;y!==null;){if(y.key===A)if(y.tag===4&&y.stateNode.containerInfo===w.containerInfo&&y.stateNode.implementation===w.implementation){t(v,y.sibling),y=r(y,w.children||[]),y.return=v,v=y;break e}else{t(v,y);break}else e(v,y);y=y.sibling}y=bN(w,v.mode,S),y.return=v,v=y}return o(v);case ad:return A=w._init,b(v,y,A(w._payload),S)}if(my(w))return x(v,y,w,S);if(Hx(w))return g(v,y,w,S);Mw(v,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,y!==null&&y.tag===6?(t(v,y.sibling),y=r(y,w),y.return=v,v=y):(t(v,y),y=vN(w,v.mode,S),y.return=v,v=y),o(v)):t(v,y)}return b}var fx=CF(!0),SF=CF(!1),LC=Wu(null),OC=null,cp=null,$E=null;function UE(){$E=cp=OC=null}function zE(s){var e=LC.current;ws(LC),s._currentValue=e}function c_(s,e,t){for(;s!==null;){var n=s.alternate;if((s.childLanes&e)!==e?(s.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),s===t)break;s=s.return}}function Sp(s,e){OC=s,$E=cp=null,s=s.dependencies,s!==null&&s.firstContext!==null&&(s.lanes&e&&(ni=!0),s.firstContext=null)}function Ma(s){var e=s._currentValue;if($E!==s)if(s={context:s,memoizedValue:e,next:null},cp===null){if(OC===null)throw Error(Te(308));cp=s,OC.dependencies={lanes:0,firstContext:s}}else cp=cp.next=s;return e}var yh=null;function HE(s){yh===null?yh=[s]:yh.push(s)}function jF(s,e,t,n){var r=e.interleaved;return r===null?(t.next=t,HE(e)):(t.next=r.next,r.next=t),e.interleaved=t,Ic(s,n)}function Ic(s,e){s.lanes|=e;var t=s.alternate;for(t!==null&&(t.lanes|=e),t=s,s=s.return;s!==null;)s.childLanes|=e,t=s.alternate,t!==null&&(t.childLanes|=e),t=s,s=s.return;return t.tag===3?t.stateNode:null}var od=!1;function VE(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function kF(s,e){s=s.updateQueue,e.updateQueue===s&&(e.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,effects:s.effects})}function Nc(s,e){return{eventTime:s,lane:e,tag:0,payload:null,callback:null,next:null}}function Cu(s,e,t){var n=s.updateQueue;if(n===null)return null;if(n=n.shared,Bt&2){var r=n.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),n.pending=e,Ic(s,t)}return r=n.interleaved,r===null?(e.next=e,HE(n)):(e.next=r.next,r.next=e),n.interleaved=e,Ic(s,t)}function b1(s,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var n=e.lanes;n&=s.pendingLanes,t|=n,e.lanes=t,TE(s,t)}}function KI(s,e){var t=s.updateQueue,n=s.alternate;if(n!==null&&(n=n.updateQueue,t===n)){var r=null,a=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};a===null?r=a=o:a=a.next=o,t=t.next}while(t!==null);a===null?r=a=e:a=a.next=e}else r=a=e;t={baseState:n.baseState,firstBaseUpdate:r,lastBaseUpdate:a,shared:n.shared,effects:n.effects},s.updateQueue=t;return}s=t.lastBaseUpdate,s===null?t.firstBaseUpdate=e:s.next=e,t.lastBaseUpdate=e}function FC(s,e,t,n){var r=s.updateQueue;od=!1;var a=r.firstBaseUpdate,o=r.lastBaseUpdate,l=r.shared.pending;if(l!==null){r.shared.pending=null;var c=l,d=c.next;c.next=null,o===null?a=d:o.next=d,o=c;var h=s.alternate;h!==null&&(h=h.updateQueue,l=h.lastBaseUpdate,l!==o&&(l===null?h.firstBaseUpdate=d:l.next=d,h.lastBaseUpdate=c))}if(a!==null){var f=r.baseState;o=0,h=d=c=null,l=a;do{var m=l.lane,p=l.eventTime;if((n&m)===m){h!==null&&(h=h.next={eventTime:p,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var x=s,g=l;switch(m=e,p=t,g.tag){case 1:if(x=g.payload,typeof x=="function"){f=x.call(p,f,m);break e}f=x;break e;case 3:x.flags=x.flags&-65537|128;case 0:if(x=g.payload,m=typeof x=="function"?x.call(p,f,m):x,m==null)break e;f=Os({},f,m);break e;case 2:od=!0}}l.callback!==null&&l.lane!==0&&(s.flags|=64,m=r.effects,m===null?r.effects=[l]:m.push(l))}else p={eventTime:p,lane:m,tag:l.tag,payload:l.payload,callback:l.callback,next:null},h===null?(d=h=p,c=f):h=h.next=p,o|=m;if(l=l.next,l===null){if(l=r.shared.pending,l===null)break;m=l,l=m.next,m.next=null,r.lastBaseUpdate=m,r.shared.pending=null}}while(!0);if(h===null&&(c=f),r.baseState=c,r.firstBaseUpdate=d,r.lastBaseUpdate=h,e=r.shared.interleaved,e!==null){r=e;do o|=r.lane,r=r.next;while(r!==e)}else a===null&&(r.shared.lanes=0);tm|=o,s.lanes=o,s.memoizedState=f}}function XI(s,e,t){if(s=e.effects,e.effects=null,s!==null)for(e=0;e<s.length;e++){var n=s[e],r=n.callback;if(r!==null){if(n.callback=null,n=t,typeof r!="function")throw Error(Te(191,r));r.call(n)}}}var Z0={},pl=Wu(Z0),Nv=Wu(Z0),Av=Wu(Z0);function vh(s){if(s===Z0)throw Error(Te(174));return s}function WE(s,e){switch(fs(Av,e),fs(Nv,s),fs(pl,Z0),s=e.nodeType,s){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:HA(null,"");break;default:s=s===8?e.parentNode:e,e=s.namespaceURI||null,s=s.tagName,e=HA(e,s)}ws(pl),fs(pl,e)}function mx(){ws(pl),ws(Nv),ws(Av)}function NF(s){vh(Av.current);var e=vh(pl.current),t=HA(e,s.type);e!==t&&(fs(Nv,s),fs(pl,t))}function qE(s){Nv.current===s&&(ws(pl),ws(Nv))}var Ms=Wu(0);function BC(s){for(var e=s;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===s)break;for(;e.sibling===null;){if(e.return===null||e.return===s)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var fN=[];function GE(){for(var s=0;s<fN.length;s++)fN[s]._workInProgressVersionPrimary=null;fN.length=0}var w1=Hc.ReactCurrentDispatcher,mN=Hc.ReactCurrentBatchConfig,em=0,Is=null,gn=null,_n=null,$C=!1,Jy=!1,_v=0,n9=0;function Jn(){throw Error(Te(321))}function YE(s,e){if(e===null)return!1;for(var t=0;t<e.length&&t<s.length;t++)if(!So(s[t],e[t]))return!1;return!0}function KE(s,e,t,n,r,a){if(em=a,Is=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,w1.current=s===null||s.memoizedState===null?o9:l9,s=t(n,r),Jy){a=0;do{if(Jy=!1,_v=0,25<=a)throw Error(Te(301));a+=1,_n=gn=null,e.updateQueue=null,w1.current=c9,s=t(n,r)}while(Jy)}if(w1.current=UC,e=gn!==null&&gn.next!==null,em=0,_n=gn=Is=null,$C=!1,e)throw Error(Te(300));return s}function XE(){var s=_v!==0;return _v=0,s}function Lo(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return _n===null?Is.memoizedState=_n=s:_n=_n.next=s,_n}function Ia(){if(gn===null){var s=Is.alternate;s=s!==null?s.memoizedState:null}else s=gn.next;var e=_n===null?Is.memoizedState:_n.next;if(e!==null)_n=e,gn=s;else{if(s===null)throw Error(Te(310));gn=s,s={memoizedState:gn.memoizedState,baseState:gn.baseState,baseQueue:gn.baseQueue,queue:gn.queue,next:null},_n===null?Is.memoizedState=_n=s:_n=_n.next=s}return _n}function Tv(s,e){return typeof e=="function"?e(s):e}function pN(s){var e=Ia(),t=e.queue;if(t===null)throw Error(Te(311));t.lastRenderedReducer=s;var n=gn,r=n.baseQueue,a=t.pending;if(a!==null){if(r!==null){var o=r.next;r.next=a.next,a.next=o}n.baseQueue=r=a,t.pending=null}if(r!==null){a=r.next,n=n.baseState;var l=o=null,c=null,d=a;do{var h=d.lane;if((em&h)===h)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),n=d.hasEagerState?d.eagerState:s(n,d.action);else{var f={lane:h,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=f,o=n):c=c.next=f,Is.lanes|=h,tm|=h}d=d.next}while(d!==null&&d!==a);c===null?o=n:c.next=l,So(n,e.memoizedState)||(ni=!0),e.memoizedState=n,e.baseState=o,e.baseQueue=c,t.lastRenderedState=n}if(s=t.interleaved,s!==null){r=s;do a=r.lane,Is.lanes|=a,tm|=a,r=r.next;while(r!==s)}else r===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function gN(s){var e=Ia(),t=e.queue;if(t===null)throw Error(Te(311));t.lastRenderedReducer=s;var n=t.dispatch,r=t.pending,a=e.memoizedState;if(r!==null){t.pending=null;var o=r=r.next;do a=s(a,o.action),o=o.next;while(o!==r);So(a,e.memoizedState)||(ni=!0),e.memoizedState=a,e.baseQueue===null&&(e.baseState=a),t.lastRenderedState=a}return[a,n]}function AF(){}function _F(s,e){var t=Is,n=Ia(),r=e(),a=!So(n.memoizedState,r);if(a&&(n.memoizedState=r,ni=!0),n=n.queue,QE(PF.bind(null,t,n,s),[s]),n.getSnapshot!==e||a||_n!==null&&_n.memoizedState.tag&1){if(t.flags|=2048,Ev(9,EF.bind(null,t,n,r,e),void 0,null),Pn===null)throw Error(Te(349));em&30||TF(t,e,r)}return r}function TF(s,e,t){s.flags|=16384,s={getSnapshot:e,value:t},e=Is.updateQueue,e===null?(e={lastEffect:null,stores:null},Is.updateQueue=e,e.stores=[s]):(t=e.stores,t===null?e.stores=[s]:t.push(s))}function EF(s,e,t,n){e.value=t,e.getSnapshot=n,MF(e)&&IF(s)}function PF(s,e,t){return t(function(){MF(e)&&IF(s)})}function MF(s){var e=s.getSnapshot;s=s.value;try{var t=e();return!So(s,t)}catch{return!0}}function IF(s){var e=Ic(s,1);e!==null&&vo(e,s,1,-1)}function QI(s){var e=Lo();return typeof s=="function"&&(s=s()),e.memoizedState=e.baseState=s,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Tv,lastRenderedState:s},e.queue=s,s=s.dispatch=a9.bind(null,Is,s),[e.memoizedState,s]}function Ev(s,e,t,n){return s={tag:s,create:e,destroy:t,deps:n,next:null},e=Is.updateQueue,e===null?(e={lastEffect:null,stores:null},Is.updateQueue=e,e.lastEffect=s.next=s):(t=e.lastEffect,t===null?e.lastEffect=s.next=s:(n=t.next,t.next=s,s.next=n,e.lastEffect=s)),s}function RF(){return Ia().memoizedState}function C1(s,e,t,n){var r=Lo();Is.flags|=s,r.memoizedState=Ev(1|e,t,void 0,n===void 0?null:n)}function vj(s,e,t,n){var r=Ia();n=n===void 0?null:n;var a=void 0;if(gn!==null){var o=gn.memoizedState;if(a=o.destroy,n!==null&&YE(n,o.deps)){r.memoizedState=Ev(e,t,a,n);return}}Is.flags|=s,r.memoizedState=Ev(1|e,t,a,n)}function ZI(s,e){return C1(8390656,8,s,e)}function QE(s,e){return vj(2048,8,s,e)}function DF(s,e){return vj(4,2,s,e)}function LF(s,e){return vj(4,4,s,e)}function OF(s,e){if(typeof e=="function")return s=s(),e(s),function(){e(null)};if(e!=null)return s=s(),e.current=s,function(){e.current=null}}function FF(s,e,t){return t=t!=null?t.concat([s]):null,vj(4,4,OF.bind(null,e,s),t)}function ZE(){}function BF(s,e){var t=Ia();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&YE(e,n[1])?n[0]:(t.memoizedState=[s,e],s)}function $F(s,e){var t=Ia();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&YE(e,n[1])?n[0]:(s=s(),t.memoizedState=[s,e],s)}function UF(s,e,t){return em&21?(So(t,e)||(t=q4(),Is.lanes|=t,tm|=t,s.baseState=!0),e):(s.baseState&&(s.baseState=!1,ni=!0),s.memoizedState=t)}function r9(s,e){var t=Zt;Zt=t!==0&&4>t?t:4,s(!0);var n=mN.transition;mN.transition={};try{s(!1),e()}finally{Zt=t,mN.transition=n}}function zF(){return Ia().memoizedState}function i9(s,e,t){var n=ju(s);if(t={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null},HF(s))VF(e,t);else if(t=jF(s,e,t,n),t!==null){var r=Er();vo(t,s,n,r),WF(t,e,n)}}function a9(s,e,t){var n=ju(s),r={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null};if(HF(s))VF(e,r);else{var a=s.alternate;if(s.lanes===0&&(a===null||a.lanes===0)&&(a=e.lastRenderedReducer,a!==null))try{var o=e.lastRenderedState,l=a(o,t);if(r.hasEagerState=!0,r.eagerState=l,So(l,o)){var c=e.interleaved;c===null?(r.next=r,HE(e)):(r.next=c.next,c.next=r),e.interleaved=r;return}}catch{}finally{}t=jF(s,e,r,n),t!==null&&(r=Er(),vo(t,s,n,r),WF(t,e,n))}}function HF(s){var e=s.alternate;return s===Is||e!==null&&e===Is}function VF(s,e){Jy=$C=!0;var t=s.pending;t===null?e.next=e:(e.next=t.next,t.next=e),s.pending=e}function WF(s,e,t){if(t&4194240){var n=e.lanes;n&=s.pendingLanes,t|=n,e.lanes=t,TE(s,t)}}var UC={readContext:Ma,useCallback:Jn,useContext:Jn,useEffect:Jn,useImperativeHandle:Jn,useInsertionEffect:Jn,useLayoutEffect:Jn,useMemo:Jn,useReducer:Jn,useRef:Jn,useState:Jn,useDebugValue:Jn,useDeferredValue:Jn,useTransition:Jn,useMutableSource:Jn,useSyncExternalStore:Jn,useId:Jn,unstable_isNewReconciler:!1},o9={readContext:Ma,useCallback:function(s,e){return Lo().memoizedState=[s,e===void 0?null:e],s},useContext:Ma,useEffect:ZI,useImperativeHandle:function(s,e,t){return t=t!=null?t.concat([s]):null,C1(4194308,4,OF.bind(null,e,s),t)},useLayoutEffect:function(s,e){return C1(4194308,4,s,e)},useInsertionEffect:function(s,e){return C1(4,2,s,e)},useMemo:function(s,e){var t=Lo();return e=e===void 0?null:e,s=s(),t.memoizedState=[s,e],s},useReducer:function(s,e,t){var n=Lo();return e=t!==void 0?t(e):e,n.memoizedState=n.baseState=e,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:e},n.queue=s,s=s.dispatch=i9.bind(null,Is,s),[n.memoizedState,s]},useRef:function(s){var e=Lo();return s={current:s},e.memoizedState=s},useState:QI,useDebugValue:ZE,useDeferredValue:function(s){return Lo().memoizedState=s},useTransition:function(){var s=QI(!1),e=s[0];return s=r9.bind(null,s[1]),Lo().memoizedState=s,[e,s]},useMutableSource:function(){},useSyncExternalStore:function(s,e,t){var n=Is,r=Lo();if(Ts){if(t===void 0)throw Error(Te(407));t=t()}else{if(t=e(),Pn===null)throw Error(Te(349));em&30||TF(n,e,t)}r.memoizedState=t;var a={value:t,getSnapshot:e};return r.queue=a,ZI(PF.bind(null,n,a,s),[s]),n.flags|=2048,Ev(9,EF.bind(null,n,a,t,e),void 0,null),t},useId:function(){var s=Lo(),e=Pn.identifierPrefix;if(Ts){var t=kc,n=jc;t=(n&~(1<<32-yo(n)-1)).toString(32)+t,e=":"+e+"R"+t,t=_v++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=n9++,e=":"+e+"r"+t.toString(32)+":";return s.memoizedState=e},unstable_isNewReconciler:!1},l9={readContext:Ma,useCallback:BF,useContext:Ma,useEffect:QE,useImperativeHandle:FF,useInsertionEffect:DF,useLayoutEffect:LF,useMemo:$F,useReducer:pN,useRef:RF,useState:function(){return pN(Tv)},useDebugValue:ZE,useDeferredValue:function(s){var e=Ia();return UF(e,gn.memoizedState,s)},useTransition:function(){var s=pN(Tv)[0],e=Ia().memoizedState;return[s,e]},useMutableSource:AF,useSyncExternalStore:_F,useId:zF,unstable_isNewReconciler:!1},c9={readContext:Ma,useCallback:BF,useContext:Ma,useEffect:QE,useImperativeHandle:FF,useInsertionEffect:DF,useLayoutEffect:LF,useMemo:$F,useReducer:gN,useRef:RF,useState:function(){return gN(Tv)},useDebugValue:ZE,useDeferredValue:function(s){var e=Ia();return gn===null?e.memoizedState=s:UF(e,gn.memoizedState,s)},useTransition:function(){var s=gN(Tv)[0],e=Ia().memoizedState;return[s,e]},useMutableSource:AF,useSyncExternalStore:_F,useId:zF,unstable_isNewReconciler:!1};function Wa(s,e){if(s&&s.defaultProps){e=Os({},e),s=s.defaultProps;for(var t in s)e[t]===void 0&&(e[t]=s[t]);return e}return e}function d_(s,e,t,n){e=s.memoizedState,t=t(n,e),t=t==null?e:Os({},e,t),s.memoizedState=t,s.lanes===0&&(s.updateQueue.baseState=t)}var bj={isMounted:function(s){return(s=s._reactInternals)?bm(s)===s:!1},enqueueSetState:function(s,e,t){s=s._reactInternals;var n=Er(),r=ju(s),a=Nc(n,r);a.payload=e,t!=null&&(a.callback=t),e=Cu(s,a,r),e!==null&&(vo(e,s,r,n),b1(e,s,r))},enqueueReplaceState:function(s,e,t){s=s._reactInternals;var n=Er(),r=ju(s),a=Nc(n,r);a.tag=1,a.payload=e,t!=null&&(a.callback=t),e=Cu(s,a,r),e!==null&&(vo(e,s,r,n),b1(e,s,r))},enqueueForceUpdate:function(s,e){s=s._reactInternals;var t=Er(),n=ju(s),r=Nc(t,n);r.tag=2,e!=null&&(r.callback=e),e=Cu(s,r,n),e!==null&&(vo(e,s,n,t),b1(e,s,n))}};function JI(s,e,t,n,r,a,o){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(n,a,o):e.prototype&&e.prototype.isPureReactComponent?!Cv(t,n)||!Cv(r,a):!0}function qF(s,e,t){var n=!1,r=Mu,a=e.contextType;return typeof a=="object"&&a!==null?a=Ma(a):(r=oi(e)?Zf:fr.current,n=e.contextTypes,a=(n=n!=null)?ux(s,r):Mu),e=new e(t,a),s.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=bj,s.stateNode=e,e._reactInternals=s,n&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=r,s.__reactInternalMemoizedMaskedChildContext=a),e}function eR(s,e,t,n){s=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,n),e.state!==s&&bj.enqueueReplaceState(e,e.state,null)}function u_(s,e,t,n){var r=s.stateNode;r.props=t,r.state=s.memoizedState,r.refs={},VE(s);var a=e.contextType;typeof a=="object"&&a!==null?r.context=Ma(a):(a=oi(e)?Zf:fr.current,r.context=ux(s,a)),r.state=s.memoizedState,a=e.getDerivedStateFromProps,typeof a=="function"&&(d_(s,e,a,t),r.state=s.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&bj.enqueueReplaceState(r,r.state,null),FC(s,t,r,n),r.state=s.memoizedState),typeof r.componentDidMount=="function"&&(s.flags|=4194308)}function px(s,e){try{var t="",n=e;do t+=OW(n),n=n.return;while(n);var r=t}catch(a){r=`
Error generating stack: `+a.message+`
`+a.stack}return{value:s,source:e,stack:r,digest:null}}function xN(s,e,t){return{value:s,source:null,stack:t??null,digest:e??null}}function h_(s,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var d9=typeof WeakMap=="function"?WeakMap:Map;function GF(s,e,t){t=Nc(-1,t),t.tag=3,t.payload={element:null};var n=e.value;return t.callback=function(){HC||(HC=!0,C_=n),h_(s,e)},t}function YF(s,e,t){t=Nc(-1,t),t.tag=3;var n=s.type.getDerivedStateFromError;if(typeof n=="function"){var r=e.value;t.payload=function(){return n(r)},t.callback=function(){h_(s,e)}}var a=s.stateNode;return a!==null&&typeof a.componentDidCatch=="function"&&(t.callback=function(){h_(s,e),typeof n!="function"&&(Su===null?Su=new Set([this]):Su.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function tR(s,e,t){var n=s.pingCache;if(n===null){n=s.pingCache=new d9;var r=new Set;n.set(e,r)}else r=n.get(e),r===void 0&&(r=new Set,n.set(e,r));r.has(t)||(r.add(t),s=j9.bind(null,s,e,t),e.then(s,s))}function sR(s){do{var e;if((e=s.tag===13)&&(e=s.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return s;s=s.return}while(s!==null);return null}function nR(s,e,t,n,r){return s.mode&1?(s.flags|=65536,s.lanes=r,s):(s===e?s.flags|=65536:(s.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Nc(-1,1),e.tag=2,Cu(t,e,1))),t.lanes|=1),s)}var u9=Hc.ReactCurrentOwner,ni=!1;function kr(s,e,t,n){e.child=s===null?SF(e,null,t,n):fx(e,s.child,t,n)}function rR(s,e,t,n,r){t=t.render;var a=e.ref;return Sp(e,r),n=KE(s,e,t,n,a,r),t=XE(),s!==null&&!ni?(e.updateQueue=s.updateQueue,e.flags&=-2053,s.lanes&=~r,Rc(s,e,r)):(Ts&&t&&OE(e),e.flags|=1,kr(s,e,n,r),e.child)}function iR(s,e,t,n,r){if(s===null){var a=t.type;return typeof a=="function"&&!aP(a)&&a.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=a,KF(s,e,a,n,r)):(s=N1(t.type,null,n,e,e.mode,r),s.ref=e.ref,s.return=e,e.child=s)}if(a=s.child,!(s.lanes&r)){var o=a.memoizedProps;if(t=t.compare,t=t!==null?t:Cv,t(o,n)&&s.ref===e.ref)return Rc(s,e,r)}return e.flags|=1,s=ku(a,n),s.ref=e.ref,s.return=e,e.child=s}function KF(s,e,t,n,r){if(s!==null){var a=s.memoizedProps;if(Cv(a,n)&&s.ref===e.ref)if(ni=!1,e.pendingProps=n=a,(s.lanes&r)!==0)s.flags&131072&&(ni=!0);else return e.lanes=s.lanes,Rc(s,e,r)}return f_(s,e,t,n,r)}function XF(s,e,t){var n=e.pendingProps,r=n.children,a=s!==null?s.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},fs(up,Ri),Ri|=t;else{if(!(t&1073741824))return s=a!==null?a.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:s,cachePool:null,transitions:null},e.updateQueue=null,fs(up,Ri),Ri|=s,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=a!==null?a.baseLanes:t,fs(up,Ri),Ri|=n}else a!==null?(n=a.baseLanes|t,e.memoizedState=null):n=t,fs(up,Ri),Ri|=n;return kr(s,e,r,t),e.child}function QF(s,e){var t=e.ref;(s===null&&t!==null||s!==null&&s.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function f_(s,e,t,n,r){var a=oi(t)?Zf:fr.current;return a=ux(e,a),Sp(e,r),t=KE(s,e,t,n,a,r),n=XE(),s!==null&&!ni?(e.updateQueue=s.updateQueue,e.flags&=-2053,s.lanes&=~r,Rc(s,e,r)):(Ts&&n&&OE(e),e.flags|=1,kr(s,e,t,r),e.child)}function aR(s,e,t,n,r){if(oi(t)){var a=!0;IC(e)}else a=!1;if(Sp(e,r),e.stateNode===null)S1(s,e),qF(e,t,n),u_(e,t,n,r),n=!0;else if(s===null){var o=e.stateNode,l=e.memoizedProps;o.props=l;var c=o.context,d=t.contextType;typeof d=="object"&&d!==null?d=Ma(d):(d=oi(t)?Zf:fr.current,d=ux(e,d));var h=t.getDerivedStateFromProps,f=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==n||c!==d)&&eR(e,o,n,d),od=!1;var m=e.memoizedState;o.state=m,FC(e,n,o,r),c=e.memoizedState,l!==n||m!==c||ai.current||od?(typeof h=="function"&&(d_(e,t,h,n),c=e.memoizedState),(l=od||JI(e,t,l,n,m,c,d))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=c),o.props=n,o.state=c,o.context=d,n=l):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{o=e.stateNode,kF(s,e),l=e.memoizedProps,d=e.type===e.elementType?l:Wa(e.type,l),o.props=d,f=e.pendingProps,m=o.context,c=t.contextType,typeof c=="object"&&c!==null?c=Ma(c):(c=oi(t)?Zf:fr.current,c=ux(e,c));var p=t.getDerivedStateFromProps;(h=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==f||m!==c)&&eR(e,o,n,c),od=!1,m=e.memoizedState,o.state=m,FC(e,n,o,r);var x=e.memoizedState;l!==f||m!==x||ai.current||od?(typeof p=="function"&&(d_(e,t,p,n),x=e.memoizedState),(d=od||JI(e,t,d,n,m,x,c)||!1)?(h||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(n,x,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(n,x,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||l===s.memoizedProps&&m===s.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===s.memoizedProps&&m===s.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=x),o.props=n,o.state=x,o.context=c,n=d):(typeof o.componentDidUpdate!="function"||l===s.memoizedProps&&m===s.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===s.memoizedProps&&m===s.memoizedState||(e.flags|=1024),n=!1)}return m_(s,e,t,n,a,r)}function m_(s,e,t,n,r,a){QF(s,e);var o=(e.flags&128)!==0;if(!n&&!o)return r&&WI(e,t,!1),Rc(s,e,a);n=e.stateNode,u9.current=e;var l=o&&typeof t.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,s!==null&&o?(e.child=fx(e,s.child,null,a),e.child=fx(e,null,l,a)):kr(s,e,l,a),e.memoizedState=n.state,r&&WI(e,t,!0),e.child}function ZF(s){var e=s.stateNode;e.pendingContext?VI(s,e.pendingContext,e.pendingContext!==e.context):e.context&&VI(s,e.context,!1),WE(s,e.containerInfo)}function oR(s,e,t,n,r){return hx(),BE(r),e.flags|=256,kr(s,e,t,n),e.child}var p_={dehydrated:null,treeContext:null,retryLane:0};function g_(s){return{baseLanes:s,cachePool:null,transitions:null}}function JF(s,e,t){var n=e.pendingProps,r=Ms.current,a=!1,o=(e.flags&128)!==0,l;if((l=o)||(l=s!==null&&s.memoizedState===null?!1:(r&2)!==0),l?(a=!0,e.flags&=-129):(s===null||s.memoizedState!==null)&&(r|=1),fs(Ms,r&1),s===null)return l_(e),s=e.memoizedState,s!==null&&(s=s.dehydrated,s!==null)?(e.mode&1?s.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=n.children,s=n.fallback,a?(n=e.mode,a=e.child,o={mode:"hidden",children:o},!(n&1)&&a!==null?(a.childLanes=0,a.pendingProps=o):a=Sj(o,n,0,null),s=qf(s,n,t,null),a.return=e,s.return=e,a.sibling=s,e.child=a,e.child.memoizedState=g_(t),e.memoizedState=p_,s):JE(e,o));if(r=s.memoizedState,r!==null&&(l=r.dehydrated,l!==null))return h9(s,e,o,n,l,r,t);if(a){a=n.fallback,o=e.mode,r=s.child,l=r.sibling;var c={mode:"hidden",children:n.children};return!(o&1)&&e.child!==r?(n=e.child,n.childLanes=0,n.pendingProps=c,e.deletions=null):(n=ku(r,c),n.subtreeFlags=r.subtreeFlags&14680064),l!==null?a=ku(l,a):(a=qf(a,o,t,null),a.flags|=2),a.return=e,n.return=e,n.sibling=a,e.child=n,n=a,a=e.child,o=s.child.memoizedState,o=o===null?g_(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},a.memoizedState=o,a.childLanes=s.childLanes&~t,e.memoizedState=p_,n}return a=s.child,s=a.sibling,n=ku(a,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=t),n.return=e,n.sibling=null,s!==null&&(t=e.deletions,t===null?(e.deletions=[s],e.flags|=16):t.push(s)),e.child=n,e.memoizedState=null,n}function JE(s,e){return e=Sj({mode:"visible",children:e},s.mode,0,null),e.return=s,s.child=e}function Iw(s,e,t,n){return n!==null&&BE(n),fx(e,s.child,null,t),s=JE(e,e.pendingProps.children),s.flags|=2,e.memoizedState=null,s}function h9(s,e,t,n,r,a,o){if(t)return e.flags&256?(e.flags&=-257,n=xN(Error(Te(422))),Iw(s,e,o,n)):e.memoizedState!==null?(e.child=s.child,e.flags|=128,null):(a=n.fallback,r=e.mode,n=Sj({mode:"visible",children:n.children},r,0,null),a=qf(a,r,o,null),a.flags|=2,n.return=e,a.return=e,n.sibling=a,e.child=n,e.mode&1&&fx(e,s.child,null,o),e.child.memoizedState=g_(o),e.memoizedState=p_,a);if(!(e.mode&1))return Iw(s,e,o,null);if(r.data==="$!"){if(n=r.nextSibling&&r.nextSibling.dataset,n)var l=n.dgst;return n=l,a=Error(Te(419)),n=xN(a,n,void 0),Iw(s,e,o,n)}if(l=(o&s.childLanes)!==0,ni||l){if(n=Pn,n!==null){switch(o&-o){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(n.suspendedLanes|o)?0:r,r!==0&&r!==a.retryLane&&(a.retryLane=r,Ic(s,r),vo(n,s,r,-1))}return iP(),n=xN(Error(Te(421))),Iw(s,e,o,n)}return r.data==="$?"?(e.flags|=128,e.child=s.child,e=k9.bind(null,s),r._reactRetry=e,null):(s=a.treeContext,Hi=wu(r.nextSibling),Vi=e,Ts=!0,lo=null,s!==null&&(wa[Ca++]=jc,wa[Ca++]=kc,wa[Ca++]=Jf,jc=s.id,kc=s.overflow,Jf=e),e=JE(e,n.children),e.flags|=4096,e)}function lR(s,e,t){s.lanes|=e;var n=s.alternate;n!==null&&(n.lanes|=e),c_(s.return,e,t)}function yN(s,e,t,n,r){var a=s.memoizedState;a===null?s.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:t,tailMode:r}:(a.isBackwards=e,a.rendering=null,a.renderingStartTime=0,a.last=n,a.tail=t,a.tailMode=r)}function e3(s,e,t){var n=e.pendingProps,r=n.revealOrder,a=n.tail;if(kr(s,e,n.children,t),n=Ms.current,n&2)n=n&1|2,e.flags|=128;else{if(s!==null&&s.flags&128)e:for(s=e.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&lR(s,t,e);else if(s.tag===19)lR(s,t,e);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===e)break e;for(;s.sibling===null;){if(s.return===null||s.return===e)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}n&=1}if(fs(Ms,n),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(t=e.child,r=null;t!==null;)s=t.alternate,s!==null&&BC(s)===null&&(r=t),t=t.sibling;t=r,t===null?(r=e.child,e.child=null):(r=t.sibling,t.sibling=null),yN(e,!1,r,t,a);break;case"backwards":for(t=null,r=e.child,e.child=null;r!==null;){if(s=r.alternate,s!==null&&BC(s)===null){e.child=r;break}s=r.sibling,r.sibling=t,t=r,r=s}yN(e,!0,t,null,a);break;case"together":yN(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function S1(s,e){!(e.mode&1)&&s!==null&&(s.alternate=null,e.alternate=null,e.flags|=2)}function Rc(s,e,t){if(s!==null&&(e.dependencies=s.dependencies),tm|=e.lanes,!(t&e.childLanes))return null;if(s!==null&&e.child!==s.child)throw Error(Te(153));if(e.child!==null){for(s=e.child,t=ku(s,s.pendingProps),e.child=t,t.return=e;s.sibling!==null;)s=s.sibling,t=t.sibling=ku(s,s.pendingProps),t.return=e;t.sibling=null}return e.child}function f9(s,e,t){switch(e.tag){case 3:ZF(e),hx();break;case 5:NF(e);break;case 1:oi(e.type)&&IC(e);break;case 4:WE(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,r=e.memoizedProps.value;fs(LC,n._currentValue),n._currentValue=r;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(fs(Ms,Ms.current&1),e.flags|=128,null):t&e.child.childLanes?JF(s,e,t):(fs(Ms,Ms.current&1),s=Rc(s,e,t),s!==null?s.sibling:null);fs(Ms,Ms.current&1);break;case 19:if(n=(t&e.childLanes)!==0,s.flags&128){if(n)return e3(s,e,t);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),fs(Ms,Ms.current),n)break;return null;case 22:case 23:return e.lanes=0,XF(s,e,t)}return Rc(s,e,t)}var t3,x_,s3,n3;t3=function(s,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)s.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};x_=function(){};s3=function(s,e,t,n){var r=s.memoizedProps;if(r!==n){s=e.stateNode,vh(pl.current);var a=null;switch(t){case"input":r=BA(s,r),n=BA(s,n),a=[];break;case"select":r=Os({},r,{value:void 0}),n=Os({},n,{value:void 0}),a=[];break;case"textarea":r=zA(s,r),n=zA(s,n),a=[];break;default:typeof r.onClick!="function"&&typeof n.onClick=="function"&&(s.onclick=PC)}VA(t,n);var o;t=null;for(d in r)if(!n.hasOwnProperty(d)&&r.hasOwnProperty(d)&&r[d]!=null)if(d==="style"){var l=r[d];for(o in l)l.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(pv.hasOwnProperty(d)?a||(a=[]):(a=a||[]).push(d,null));for(d in n){var c=n[d];if(l=r!=null?r[d]:void 0,n.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(t||(t={}),t[o]=c[o])}else t||(a||(a=[]),a.push(d,t)),t=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(a=a||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(a=a||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(pv.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&vs("scroll",s),a||l===c||(a=[])):(a=a||[]).push(d,c))}t&&(a=a||[]).push("style",t);var d=a;(e.updateQueue=d)&&(e.flags|=4)}};n3=function(s,e,t,n){t!==n&&(e.flags|=4)};function Kx(s,e){if(!Ts)switch(s.tailMode){case"hidden":e=s.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?s.tail=null:t.sibling=null;break;case"collapsed":t=s.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e||s.tail===null?s.tail=null:s.tail.sibling=null:n.sibling=null}}function er(s){var e=s.alternate!==null&&s.alternate.child===s.child,t=0,n=0;if(e)for(var r=s.child;r!==null;)t|=r.lanes|r.childLanes,n|=r.subtreeFlags&14680064,n|=r.flags&14680064,r.return=s,r=r.sibling;else for(r=s.child;r!==null;)t|=r.lanes|r.childLanes,n|=r.subtreeFlags,n|=r.flags,r.return=s,r=r.sibling;return s.subtreeFlags|=n,s.childLanes=t,e}function m9(s,e,t){var n=e.pendingProps;switch(FE(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return er(e),null;case 1:return oi(e.type)&&MC(),er(e),null;case 3:return n=e.stateNode,mx(),ws(ai),ws(fr),GE(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(s===null||s.child===null)&&(Pw(e)?e.flags|=4:s===null||s.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,lo!==null&&(k_(lo),lo=null))),x_(s,e),er(e),null;case 5:qE(e);var r=vh(Av.current);if(t=e.type,s!==null&&e.stateNode!=null)s3(s,e,t,n,r),s.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(Te(166));return er(e),null}if(s=vh(pl.current),Pw(e)){n=e.stateNode,t=e.type;var a=e.memoizedProps;switch(n[ll]=e,n[kv]=a,s=(e.mode&1)!==0,t){case"dialog":vs("cancel",n),vs("close",n);break;case"iframe":case"object":case"embed":vs("load",n);break;case"video":case"audio":for(r=0;r<gy.length;r++)vs(gy[r],n);break;case"source":vs("error",n);break;case"img":case"image":case"link":vs("error",n),vs("load",n);break;case"details":vs("toggle",n);break;case"input":xI(n,a),vs("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!a.multiple},vs("invalid",n);break;case"textarea":vI(n,a),vs("invalid",n)}VA(t,a),r=null;for(var o in a)if(a.hasOwnProperty(o)){var l=a[o];o==="children"?typeof l=="string"?n.textContent!==l&&(a.suppressHydrationWarning!==!0&&Ew(n.textContent,l,s),r=["children",l]):typeof l=="number"&&n.textContent!==""+l&&(a.suppressHydrationWarning!==!0&&Ew(n.textContent,l,s),r=["children",""+l]):pv.hasOwnProperty(o)&&l!=null&&o==="onScroll"&&vs("scroll",n)}switch(t){case"input":Cw(n),yI(n,a,!0);break;case"textarea":Cw(n),bI(n);break;case"select":case"option":break;default:typeof a.onClick=="function"&&(n.onclick=PC)}n=r,e.updateQueue=n,n!==null&&(e.flags|=4)}else{o=r.nodeType===9?r:r.ownerDocument,s==="http://www.w3.org/1999/xhtml"&&(s=P4(t)),s==="http://www.w3.org/1999/xhtml"?t==="script"?(s=o.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild)):typeof n.is=="string"?s=o.createElement(t,{is:n.is}):(s=o.createElement(t),t==="select"&&(o=s,n.multiple?o.multiple=!0:n.size&&(o.size=n.size))):s=o.createElementNS(s,t),s[ll]=e,s[kv]=n,t3(s,e,!1,!1),e.stateNode=s;e:{switch(o=WA(t,n),t){case"dialog":vs("cancel",s),vs("close",s),r=n;break;case"iframe":case"object":case"embed":vs("load",s),r=n;break;case"video":case"audio":for(r=0;r<gy.length;r++)vs(gy[r],s);r=n;break;case"source":vs("error",s),r=n;break;case"img":case"image":case"link":vs("error",s),vs("load",s),r=n;break;case"details":vs("toggle",s),r=n;break;case"input":xI(s,n),r=BA(s,n),vs("invalid",s);break;case"option":r=n;break;case"select":s._wrapperState={wasMultiple:!!n.multiple},r=Os({},n,{value:void 0}),vs("invalid",s);break;case"textarea":vI(s,n),r=zA(s,n),vs("invalid",s);break;default:r=n}VA(t,r),l=r;for(a in l)if(l.hasOwnProperty(a)){var c=l[a];a==="style"?R4(s,c):a==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&M4(s,c)):a==="children"?typeof c=="string"?(t!=="textarea"||c!=="")&&gv(s,c):typeof c=="number"&&gv(s,""+c):a!=="suppressContentEditableWarning"&&a!=="suppressHydrationWarning"&&a!=="autoFocus"&&(pv.hasOwnProperty(a)?c!=null&&a==="onScroll"&&vs("scroll",s):c!=null&&SE(s,a,c,o))}switch(t){case"input":Cw(s),yI(s,n,!1);break;case"textarea":Cw(s),bI(s);break;case"option":n.value!=null&&s.setAttribute("value",""+Pu(n.value));break;case"select":s.multiple=!!n.multiple,a=n.value,a!=null?vp(s,!!n.multiple,a,!1):n.defaultValue!=null&&vp(s,!!n.multiple,n.defaultValue,!0);break;default:typeof r.onClick=="function"&&(s.onclick=PC)}switch(t){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return er(e),null;case 6:if(s&&e.stateNode!=null)n3(s,e,s.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(Te(166));if(t=vh(Av.current),vh(pl.current),Pw(e)){if(n=e.stateNode,t=e.memoizedProps,n[ll]=e,(a=n.nodeValue!==t)&&(s=Vi,s!==null))switch(s.tag){case 3:Ew(n.nodeValue,t,(s.mode&1)!==0);break;case 5:s.memoizedProps.suppressHydrationWarning!==!0&&Ew(n.nodeValue,t,(s.mode&1)!==0)}a&&(e.flags|=4)}else n=(t.nodeType===9?t:t.ownerDocument).createTextNode(n),n[ll]=e,e.stateNode=n}return er(e),null;case 13:if(ws(Ms),n=e.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(Ts&&Hi!==null&&e.mode&1&&!(e.flags&128))wF(),hx(),e.flags|=98560,a=!1;else if(a=Pw(e),n!==null&&n.dehydrated!==null){if(s===null){if(!a)throw Error(Te(318));if(a=e.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(Te(317));a[ll]=e}else hx(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;er(e),a=!1}else lo!==null&&(k_(lo),lo=null),a=!0;if(!a)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(n=n!==null,n!==(s!==null&&s.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(s===null||Ms.current&1?xn===0&&(xn=3):iP())),e.updateQueue!==null&&(e.flags|=4),er(e),null);case 4:return mx(),x_(s,e),s===null&&Sv(e.stateNode.containerInfo),er(e),null;case 10:return zE(e.type._context),er(e),null;case 17:return oi(e.type)&&MC(),er(e),null;case 19:if(ws(Ms),a=e.memoizedState,a===null)return er(e),null;if(n=(e.flags&128)!==0,o=a.rendering,o===null)if(n)Kx(a,!1);else{if(xn!==0||s!==null&&s.flags&128)for(s=e.child;s!==null;){if(o=BC(s),o!==null){for(e.flags|=128,Kx(a,!1),n=o.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=t,t=e.child;t!==null;)a=t,s=n,a.flags&=14680066,o=a.alternate,o===null?(a.childLanes=0,a.lanes=s,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=o.childLanes,a.lanes=o.lanes,a.child=o.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=o.memoizedProps,a.memoizedState=o.memoizedState,a.updateQueue=o.updateQueue,a.type=o.type,s=o.dependencies,a.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),t=t.sibling;return fs(Ms,Ms.current&1|2),e.child}s=s.sibling}a.tail!==null&&Zs()>gx&&(e.flags|=128,n=!0,Kx(a,!1),e.lanes=4194304)}else{if(!n)if(s=BC(o),s!==null){if(e.flags|=128,n=!0,t=s.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Kx(a,!0),a.tail===null&&a.tailMode==="hidden"&&!o.alternate&&!Ts)return er(e),null}else 2*Zs()-a.renderingStartTime>gx&&t!==1073741824&&(e.flags|=128,n=!0,Kx(a,!1),e.lanes=4194304);a.isBackwards?(o.sibling=e.child,e.child=o):(t=a.last,t!==null?t.sibling=o:e.child=o,a.last=o)}return a.tail!==null?(e=a.tail,a.rendering=e,a.tail=e.sibling,a.renderingStartTime=Zs(),e.sibling=null,t=Ms.current,fs(Ms,n?t&1|2:t&1),e):(er(e),null);case 22:case 23:return rP(),n=e.memoizedState!==null,s!==null&&s.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?Ri&1073741824&&(er(e),e.subtreeFlags&6&&(e.flags|=8192)):er(e),null;case 24:return null;case 25:return null}throw Error(Te(156,e.tag))}function p9(s,e){switch(FE(e),e.tag){case 1:return oi(e.type)&&MC(),s=e.flags,s&65536?(e.flags=s&-65537|128,e):null;case 3:return mx(),ws(ai),ws(fr),GE(),s=e.flags,s&65536&&!(s&128)?(e.flags=s&-65537|128,e):null;case 5:return qE(e),null;case 13:if(ws(Ms),s=e.memoizedState,s!==null&&s.dehydrated!==null){if(e.alternate===null)throw Error(Te(340));hx()}return s=e.flags,s&65536?(e.flags=s&-65537|128,e):null;case 19:return ws(Ms),null;case 4:return mx(),null;case 10:return zE(e.type._context),null;case 22:case 23:return rP(),null;case 24:return null;default:return null}}var Rw=!1,cr=!1,g9=typeof WeakSet=="function"?WeakSet:Set,qe=null;function dp(s,e){var t=s.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(n){Ws(s,e,n)}else t.current=null}function y_(s,e,t){try{t()}catch(n){Ws(s,e,n)}}var cR=!1;function x9(s,e){if(t_=_C,s=lF(),LE(s)){if("selectionStart"in s)var t={start:s.selectionStart,end:s.selectionEnd};else e:{t=(t=s.ownerDocument)&&t.defaultView||window;var n=t.getSelection&&t.getSelection();if(n&&n.rangeCount!==0){t=n.anchorNode;var r=n.anchorOffset,a=n.focusNode;n=n.focusOffset;try{t.nodeType,a.nodeType}catch{t=null;break e}var o=0,l=-1,c=-1,d=0,h=0,f=s,m=null;t:for(;;){for(var p;f!==t||r!==0&&f.nodeType!==3||(l=o+r),f!==a||n!==0&&f.nodeType!==3||(c=o+n),f.nodeType===3&&(o+=f.nodeValue.length),(p=f.firstChild)!==null;)m=f,f=p;for(;;){if(f===s)break t;if(m===t&&++d===r&&(l=o),m===a&&++h===n&&(c=o),(p=f.nextSibling)!==null)break;f=m,m=f.parentNode}f=p}t=l===-1||c===-1?null:{start:l,end:c}}else t=null}t=t||{start:0,end:0}}else t=null;for(s_={focusedElem:s,selectionRange:t},_C=!1,qe=e;qe!==null;)if(e=qe,s=e.child,(e.subtreeFlags&1028)!==0&&s!==null)s.return=e,qe=s;else for(;qe!==null;){e=qe;try{var x=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(x!==null){var g=x.memoizedProps,b=x.memoizedState,v=e.stateNode,y=v.getSnapshotBeforeUpdate(e.elementType===e.type?g:Wa(e.type,g),b);v.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var w=e.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Te(163))}}catch(S){Ws(e,e.return,S)}if(s=e.sibling,s!==null){s.return=e.return,qe=s;break}qe=e.return}return x=cR,cR=!1,x}function ev(s,e,t){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var r=n=n.next;do{if((r.tag&s)===s){var a=r.destroy;r.destroy=void 0,a!==void 0&&y_(e,t,a)}r=r.next}while(r!==n)}}function wj(s,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&s)===s){var n=t.create;t.destroy=n()}t=t.next}while(t!==e)}}function v_(s){var e=s.ref;if(e!==null){var t=s.stateNode;switch(s.tag){case 5:s=t;break;default:s=t}typeof e=="function"?e(s):e.current=s}}function r3(s){var e=s.alternate;e!==null&&(s.alternate=null,r3(e)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(e=s.stateNode,e!==null&&(delete e[ll],delete e[kv],delete e[i_],delete e[Jq],delete e[e9])),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}function i3(s){return s.tag===5||s.tag===3||s.tag===4}function dR(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||i3(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function b_(s,e,t){var n=s.tag;if(n===5||n===6)s=s.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(s,e):t.insertBefore(s,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(s,t)):(e=t,e.appendChild(s)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=PC));else if(n!==4&&(s=s.child,s!==null))for(b_(s,e,t),s=s.sibling;s!==null;)b_(s,e,t),s=s.sibling}function w_(s,e,t){var n=s.tag;if(n===5||n===6)s=s.stateNode,e?t.insertBefore(s,e):t.appendChild(s);else if(n!==4&&(s=s.child,s!==null))for(w_(s,e,t),s=s.sibling;s!==null;)w_(s,e,t),s=s.sibling}var Hn=null,oo=!1;function Kc(s,e,t){for(t=t.child;t!==null;)a3(s,e,t),t=t.sibling}function a3(s,e,t){if(ml&&typeof ml.onCommitFiberUnmount=="function")try{ml.onCommitFiberUnmount(fj,t)}catch{}switch(t.tag){case 5:cr||dp(t,e);case 6:var n=Hn,r=oo;Hn=null,Kc(s,e,t),Hn=n,oo=r,Hn!==null&&(oo?(s=Hn,t=t.stateNode,s.nodeType===8?s.parentNode.removeChild(t):s.removeChild(t)):Hn.removeChild(t.stateNode));break;case 18:Hn!==null&&(oo?(s=Hn,t=t.stateNode,s.nodeType===8?uN(s.parentNode,t):s.nodeType===1&&uN(s,t),bv(s)):uN(Hn,t.stateNode));break;case 4:n=Hn,r=oo,Hn=t.stateNode.containerInfo,oo=!0,Kc(s,e,t),Hn=n,oo=r;break;case 0:case 11:case 14:case 15:if(!cr&&(n=t.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){r=n=n.next;do{var a=r,o=a.destroy;a=a.tag,o!==void 0&&(a&2||a&4)&&y_(t,e,o),r=r.next}while(r!==n)}Kc(s,e,t);break;case 1:if(!cr&&(dp(t,e),n=t.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=t.memoizedProps,n.state=t.memoizedState,n.componentWillUnmount()}catch(l){Ws(t,e,l)}Kc(s,e,t);break;case 21:Kc(s,e,t);break;case 22:t.mode&1?(cr=(n=cr)||t.memoizedState!==null,Kc(s,e,t),cr=n):Kc(s,e,t);break;default:Kc(s,e,t)}}function uR(s){var e=s.updateQueue;if(e!==null){s.updateQueue=null;var t=s.stateNode;t===null&&(t=s.stateNode=new g9),e.forEach(function(n){var r=N9.bind(null,s,n);t.has(n)||(t.add(n),n.then(r,r))})}}function Ua(s,e){var t=e.deletions;if(t!==null)for(var n=0;n<t.length;n++){var r=t[n];try{var a=s,o=e,l=o;e:for(;l!==null;){switch(l.tag){case 5:Hn=l.stateNode,oo=!1;break e;case 3:Hn=l.stateNode.containerInfo,oo=!0;break e;case 4:Hn=l.stateNode.containerInfo,oo=!0;break e}l=l.return}if(Hn===null)throw Error(Te(160));a3(a,o,r),Hn=null,oo=!1;var c=r.alternate;c!==null&&(c.return=null),r.return=null}catch(d){Ws(r,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)o3(e,s),e=e.sibling}function o3(s,e){var t=s.alternate,n=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:if(Ua(e,s),To(s),n&4){try{ev(3,s,s.return),wj(3,s)}catch(g){Ws(s,s.return,g)}try{ev(5,s,s.return)}catch(g){Ws(s,s.return,g)}}break;case 1:Ua(e,s),To(s),n&512&&t!==null&&dp(t,t.return);break;case 5:if(Ua(e,s),To(s),n&512&&t!==null&&dp(t,t.return),s.flags&32){var r=s.stateNode;try{gv(r,"")}catch(g){Ws(s,s.return,g)}}if(n&4&&(r=s.stateNode,r!=null)){var a=s.memoizedProps,o=t!==null?t.memoizedProps:a,l=s.type,c=s.updateQueue;if(s.updateQueue=null,c!==null)try{l==="input"&&a.type==="radio"&&a.name!=null&&T4(r,a),WA(l,o);var d=WA(l,a);for(o=0;o<c.length;o+=2){var h=c[o],f=c[o+1];h==="style"?R4(r,f):h==="dangerouslySetInnerHTML"?M4(r,f):h==="children"?gv(r,f):SE(r,h,f,d)}switch(l){case"input":$A(r,a);break;case"textarea":E4(r,a);break;case"select":var m=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!a.multiple;var p=a.value;p!=null?vp(r,!!a.multiple,p,!1):m!==!!a.multiple&&(a.defaultValue!=null?vp(r,!!a.multiple,a.defaultValue,!0):vp(r,!!a.multiple,a.multiple?[]:"",!1))}r[kv]=a}catch(g){Ws(s,s.return,g)}}break;case 6:if(Ua(e,s),To(s),n&4){if(s.stateNode===null)throw Error(Te(162));r=s.stateNode,a=s.memoizedProps;try{r.nodeValue=a}catch(g){Ws(s,s.return,g)}}break;case 3:if(Ua(e,s),To(s),n&4&&t!==null&&t.memoizedState.isDehydrated)try{bv(e.containerInfo)}catch(g){Ws(s,s.return,g)}break;case 4:Ua(e,s),To(s);break;case 13:Ua(e,s),To(s),r=s.child,r.flags&8192&&(a=r.memoizedState!==null,r.stateNode.isHidden=a,!a||r.alternate!==null&&r.alternate.memoizedState!==null||(sP=Zs())),n&4&&uR(s);break;case 22:if(h=t!==null&&t.memoizedState!==null,s.mode&1?(cr=(d=cr)||h,Ua(e,s),cr=d):Ua(e,s),To(s),n&8192){if(d=s.memoizedState!==null,(s.stateNode.isHidden=d)&&!h&&s.mode&1)for(qe=s,h=s.child;h!==null;){for(f=qe=h;qe!==null;){switch(m=qe,p=m.child,m.tag){case 0:case 11:case 14:case 15:ev(4,m,m.return);break;case 1:dp(m,m.return);var x=m.stateNode;if(typeof x.componentWillUnmount=="function"){n=m,t=m.return;try{e=n,x.props=e.memoizedProps,x.state=e.memoizedState,x.componentWillUnmount()}catch(g){Ws(n,t,g)}}break;case 5:dp(m,m.return);break;case 22:if(m.memoizedState!==null){fR(f);continue}}p!==null?(p.return=m,qe=p):fR(f)}h=h.sibling}e:for(h=null,f=s;;){if(f.tag===5){if(h===null){h=f;try{r=f.stateNode,d?(a=r.style,typeof a.setProperty=="function"?a.setProperty("display","none","important"):a.display="none"):(l=f.stateNode,c=f.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=I4("display",o))}catch(g){Ws(s,s.return,g)}}}else if(f.tag===6){if(h===null)try{f.stateNode.nodeValue=d?"":f.memoizedProps}catch(g){Ws(s,s.return,g)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===s)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===s)break e;for(;f.sibling===null;){if(f.return===null||f.return===s)break e;h===f&&(h=null),f=f.return}h===f&&(h=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:Ua(e,s),To(s),n&4&&uR(s);break;case 21:break;default:Ua(e,s),To(s)}}function To(s){var e=s.flags;if(e&2){try{e:{for(var t=s.return;t!==null;){if(i3(t)){var n=t;break e}t=t.return}throw Error(Te(160))}switch(n.tag){case 5:var r=n.stateNode;n.flags&32&&(gv(r,""),n.flags&=-33);var a=dR(s);w_(s,a,r);break;case 3:case 4:var o=n.stateNode.containerInfo,l=dR(s);b_(s,l,o);break;default:throw Error(Te(161))}}catch(c){Ws(s,s.return,c)}s.flags&=-3}e&4096&&(s.flags&=-4097)}function y9(s,e,t){qe=s,l3(s)}function l3(s,e,t){for(var n=(s.mode&1)!==0;qe!==null;){var r=qe,a=r.child;if(r.tag===22&&n){var o=r.memoizedState!==null||Rw;if(!o){var l=r.alternate,c=l!==null&&l.memoizedState!==null||cr;l=Rw;var d=cr;if(Rw=o,(cr=c)&&!d)for(qe=r;qe!==null;)o=qe,c=o.child,o.tag===22&&o.memoizedState!==null?mR(r):c!==null?(c.return=o,qe=c):mR(r);for(;a!==null;)qe=a,l3(a),a=a.sibling;qe=r,Rw=l,cr=d}hR(s)}else r.subtreeFlags&8772&&a!==null?(a.return=r,qe=a):hR(s)}}function hR(s){for(;qe!==null;){var e=qe;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:cr||wj(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!cr)if(t===null)n.componentDidMount();else{var r=e.elementType===e.type?t.memoizedProps:Wa(e.type,t.memoizedProps);n.componentDidUpdate(r,t.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var a=e.updateQueue;a!==null&&XI(e,a,n);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}XI(e,o,t)}break;case 5:var l=e.stateNode;if(t===null&&e.flags&4){t=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&t.focus();break;case"img":c.src&&(t.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var h=d.memoizedState;if(h!==null){var f=h.dehydrated;f!==null&&bv(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Te(163))}cr||e.flags&512&&v_(e)}catch(m){Ws(e,e.return,m)}}if(e===s){qe=null;break}if(t=e.sibling,t!==null){t.return=e.return,qe=t;break}qe=e.return}}function fR(s){for(;qe!==null;){var e=qe;if(e===s){qe=null;break}var t=e.sibling;if(t!==null){t.return=e.return,qe=t;break}qe=e.return}}function mR(s){for(;qe!==null;){var e=qe;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{wj(4,e)}catch(c){Ws(e,t,c)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var r=e.return;try{n.componentDidMount()}catch(c){Ws(e,r,c)}}var a=e.return;try{v_(e)}catch(c){Ws(e,a,c)}break;case 5:var o=e.return;try{v_(e)}catch(c){Ws(e,o,c)}}}catch(c){Ws(e,e.return,c)}if(e===s){qe=null;break}var l=e.sibling;if(l!==null){l.return=e.return,qe=l;break}qe=e.return}}var v9=Math.ceil,zC=Hc.ReactCurrentDispatcher,eP=Hc.ReactCurrentOwner,_a=Hc.ReactCurrentBatchConfig,Bt=0,Pn=null,an=null,Gn=0,Ri=0,up=Wu(0),xn=0,Pv=null,tm=0,Cj=0,tP=0,tv=null,si=null,sP=0,gx=1/0,Ol=null,HC=!1,C_=null,Su=null,Dw=!1,fu=null,VC=0,sv=0,S_=null,j1=-1,k1=0;function Er(){return Bt&6?Zs():j1!==-1?j1:j1=Zs()}function ju(s){return s.mode&1?Bt&2&&Gn!==0?Gn&-Gn:s9.transition!==null?(k1===0&&(k1=q4()),k1):(s=Zt,s!==0||(s=window.event,s=s===void 0?16:J4(s.type)),s):1}function vo(s,e,t,n){if(50<sv)throw sv=0,S_=null,Error(Te(185));K0(s,t,n),(!(Bt&2)||s!==Pn)&&(s===Pn&&(!(Bt&2)&&(Cj|=t),xn===4&&ud(s,Gn)),li(s,n),t===1&&Bt===0&&!(e.mode&1)&&(gx=Zs()+500,yj&&qu()))}function li(s,e){var t=s.callbackNode;sq(s,e);var n=AC(s,s===Pn?Gn:0);if(n===0)t!==null&&SI(t),s.callbackNode=null,s.callbackPriority=0;else if(e=n&-n,s.callbackPriority!==e){if(t!=null&&SI(t),e===1)s.tag===0?t9(pR.bind(null,s)):yF(pR.bind(null,s)),Qq(function(){!(Bt&6)&&qu()}),t=null;else{switch(G4(n)){case 1:t=_E;break;case 4:t=V4;break;case 16:t=NC;break;case 536870912:t=W4;break;default:t=NC}t=g3(t,c3.bind(null,s))}s.callbackPriority=e,s.callbackNode=t}}function c3(s,e){if(j1=-1,k1=0,Bt&6)throw Error(Te(327));var t=s.callbackNode;if(jp()&&s.callbackNode!==t)return null;var n=AC(s,s===Pn?Gn:0);if(n===0)return null;if(n&30||n&s.expiredLanes||e)e=WC(s,n);else{e=n;var r=Bt;Bt|=2;var a=u3();(Pn!==s||Gn!==e)&&(Ol=null,gx=Zs()+500,Wf(s,e));do try{C9();break}catch(l){d3(s,l)}while(!0);UE(),zC.current=a,Bt=r,an!==null?e=0:(Pn=null,Gn=0,e=xn)}if(e!==0){if(e===2&&(r=XA(s),r!==0&&(n=r,e=j_(s,r))),e===1)throw t=Pv,Wf(s,0),ud(s,n),li(s,Zs()),t;if(e===6)ud(s,n);else{if(r=s.current.alternate,!(n&30)&&!b9(r)&&(e=WC(s,n),e===2&&(a=XA(s),a!==0&&(n=a,e=j_(s,a))),e===1))throw t=Pv,Wf(s,0),ud(s,n),li(s,Zs()),t;switch(s.finishedWork=r,s.finishedLanes=n,e){case 0:case 1:throw Error(Te(345));case 2:ih(s,si,Ol);break;case 3:if(ud(s,n),(n&130023424)===n&&(e=sP+500-Zs(),10<e)){if(AC(s,0)!==0)break;if(r=s.suspendedLanes,(r&n)!==n){Er(),s.pingedLanes|=s.suspendedLanes&r;break}s.timeoutHandle=r_(ih.bind(null,s,si,Ol),e);break}ih(s,si,Ol);break;case 4:if(ud(s,n),(n&4194240)===n)break;for(e=s.eventTimes,r=-1;0<n;){var o=31-yo(n);a=1<<o,o=e[o],o>r&&(r=o),n&=~a}if(n=r,n=Zs()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*v9(n/1960))-n,10<n){s.timeoutHandle=r_(ih.bind(null,s,si,Ol),n);break}ih(s,si,Ol);break;case 5:ih(s,si,Ol);break;default:throw Error(Te(329))}}}return li(s,Zs()),s.callbackNode===t?c3.bind(null,s):null}function j_(s,e){var t=tv;return s.current.memoizedState.isDehydrated&&(Wf(s,e).flags|=256),s=WC(s,e),s!==2&&(e=si,si=t,e!==null&&k_(e)),s}function k_(s){si===null?si=s:si.push.apply(si,s)}function b9(s){for(var e=s;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var n=0;n<t.length;n++){var r=t[n],a=r.getSnapshot;r=r.value;try{if(!So(a(),r))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===s)break;for(;e.sibling===null;){if(e.return===null||e.return===s)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ud(s,e){for(e&=~tP,e&=~Cj,s.suspendedLanes|=e,s.pingedLanes&=~e,s=s.expirationTimes;0<e;){var t=31-yo(e),n=1<<t;s[t]=-1,e&=~n}}function pR(s){if(Bt&6)throw Error(Te(327));jp();var e=AC(s,0);if(!(e&1))return li(s,Zs()),null;var t=WC(s,e);if(s.tag!==0&&t===2){var n=XA(s);n!==0&&(e=n,t=j_(s,n))}if(t===1)throw t=Pv,Wf(s,0),ud(s,e),li(s,Zs()),t;if(t===6)throw Error(Te(345));return s.finishedWork=s.current.alternate,s.finishedLanes=e,ih(s,si,Ol),li(s,Zs()),null}function nP(s,e){var t=Bt;Bt|=1;try{return s(e)}finally{Bt=t,Bt===0&&(gx=Zs()+500,yj&&qu())}}function sm(s){fu!==null&&fu.tag===0&&!(Bt&6)&&jp();var e=Bt;Bt|=1;var t=_a.transition,n=Zt;try{if(_a.transition=null,Zt=1,s)return s()}finally{Zt=n,_a.transition=t,Bt=e,!(Bt&6)&&qu()}}function rP(){Ri=up.current,ws(up)}function Wf(s,e){s.finishedWork=null,s.finishedLanes=0;var t=s.timeoutHandle;if(t!==-1&&(s.timeoutHandle=-1,Xq(t)),an!==null)for(t=an.return;t!==null;){var n=t;switch(FE(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&MC();break;case 3:mx(),ws(ai),ws(fr),GE();break;case 5:qE(n);break;case 4:mx();break;case 13:ws(Ms);break;case 19:ws(Ms);break;case 10:zE(n.type._context);break;case 22:case 23:rP()}t=t.return}if(Pn=s,an=s=ku(s.current,null),Gn=Ri=e,xn=0,Pv=null,tP=Cj=tm=0,si=tv=null,yh!==null){for(e=0;e<yh.length;e++)if(t=yh[e],n=t.interleaved,n!==null){t.interleaved=null;var r=n.next,a=t.pending;if(a!==null){var o=a.next;a.next=r,n.next=o}t.pending=n}yh=null}return s}function d3(s,e){do{var t=an;try{if(UE(),w1.current=UC,$C){for(var n=Is.memoizedState;n!==null;){var r=n.queue;r!==null&&(r.pending=null),n=n.next}$C=!1}if(em=0,_n=gn=Is=null,Jy=!1,_v=0,eP.current=null,t===null||t.return===null){xn=1,Pv=e,an=null;break}e:{var a=s,o=t.return,l=t,c=e;if(e=Gn,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,h=l,f=h.tag;if(!(h.mode&1)&&(f===0||f===11||f===15)){var m=h.alternate;m?(h.updateQueue=m.updateQueue,h.memoizedState=m.memoizedState,h.lanes=m.lanes):(h.updateQueue=null,h.memoizedState=null)}var p=sR(o);if(p!==null){p.flags&=-257,nR(p,o,l,a,e),p.mode&1&&tR(a,d,e),e=p,c=d;var x=e.updateQueue;if(x===null){var g=new Set;g.add(c),e.updateQueue=g}else x.add(c);break e}else{if(!(e&1)){tR(a,d,e),iP();break e}c=Error(Te(426))}}else if(Ts&&l.mode&1){var b=sR(o);if(b!==null){!(b.flags&65536)&&(b.flags|=256),nR(b,o,l,a,e),BE(px(c,l));break e}}a=c=px(c,l),xn!==4&&(xn=2),tv===null?tv=[a]:tv.push(a),a=o;do{switch(a.tag){case 3:a.flags|=65536,e&=-e,a.lanes|=e;var v=GF(a,c,e);KI(a,v);break e;case 1:l=c;var y=a.type,w=a.stateNode;if(!(a.flags&128)&&(typeof y.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Su===null||!Su.has(w)))){a.flags|=65536,e&=-e,a.lanes|=e;var S=YF(a,l,e);KI(a,S);break e}}a=a.return}while(a!==null)}f3(t)}catch(j){e=j,an===t&&t!==null&&(an=t=t.return);continue}break}while(!0)}function u3(){var s=zC.current;return zC.current=UC,s===null?UC:s}function iP(){(xn===0||xn===3||xn===2)&&(xn=4),Pn===null||!(tm&268435455)&&!(Cj&268435455)||ud(Pn,Gn)}function WC(s,e){var t=Bt;Bt|=2;var n=u3();(Pn!==s||Gn!==e)&&(Ol=null,Wf(s,e));do try{w9();break}catch(r){d3(s,r)}while(!0);if(UE(),Bt=t,zC.current=n,an!==null)throw Error(Te(261));return Pn=null,Gn=0,xn}function w9(){for(;an!==null;)h3(an)}function C9(){for(;an!==null&&!GW();)h3(an)}function h3(s){var e=p3(s.alternate,s,Ri);s.memoizedProps=s.pendingProps,e===null?f3(s):an=e,eP.current=null}function f3(s){var e=s;do{var t=e.alternate;if(s=e.return,e.flags&32768){if(t=p9(t,e),t!==null){t.flags&=32767,an=t;return}if(s!==null)s.flags|=32768,s.subtreeFlags=0,s.deletions=null;else{xn=6,an=null;return}}else if(t=m9(t,e,Ri),t!==null){an=t;return}if(e=e.sibling,e!==null){an=e;return}an=e=s}while(e!==null);xn===0&&(xn=5)}function ih(s,e,t){var n=Zt,r=_a.transition;try{_a.transition=null,Zt=1,S9(s,e,t,n)}finally{_a.transition=r,Zt=n}return null}function S9(s,e,t,n){do jp();while(fu!==null);if(Bt&6)throw Error(Te(327));t=s.finishedWork;var r=s.finishedLanes;if(t===null)return null;if(s.finishedWork=null,s.finishedLanes=0,t===s.current)throw Error(Te(177));s.callbackNode=null,s.callbackPriority=0;var a=t.lanes|t.childLanes;if(nq(s,a),s===Pn&&(an=Pn=null,Gn=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||Dw||(Dw=!0,g3(NC,function(){return jp(),null})),a=(t.flags&15990)!==0,t.subtreeFlags&15990||a){a=_a.transition,_a.transition=null;var o=Zt;Zt=1;var l=Bt;Bt|=4,eP.current=null,x9(s,t),o3(t,s),Hq(s_),_C=!!t_,s_=t_=null,s.current=t,y9(t),YW(),Bt=l,Zt=o,_a.transition=a}else s.current=t;if(Dw&&(Dw=!1,fu=s,VC=r),a=s.pendingLanes,a===0&&(Su=null),QW(t.stateNode),li(s,Zs()),e!==null)for(n=s.onRecoverableError,t=0;t<e.length;t++)r=e[t],n(r.value,{componentStack:r.stack,digest:r.digest});if(HC)throw HC=!1,s=C_,C_=null,s;return VC&1&&s.tag!==0&&jp(),a=s.pendingLanes,a&1?s===S_?sv++:(sv=0,S_=s):sv=0,qu(),null}function jp(){if(fu!==null){var s=G4(VC),e=_a.transition,t=Zt;try{if(_a.transition=null,Zt=16>s?16:s,fu===null)var n=!1;else{if(s=fu,fu=null,VC=0,Bt&6)throw Error(Te(331));var r=Bt;for(Bt|=4,qe=s.current;qe!==null;){var a=qe,o=a.child;if(qe.flags&16){var l=a.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(qe=d;qe!==null;){var h=qe;switch(h.tag){case 0:case 11:case 15:ev(8,h,a)}var f=h.child;if(f!==null)f.return=h,qe=f;else for(;qe!==null;){h=qe;var m=h.sibling,p=h.return;if(r3(h),h===d){qe=null;break}if(m!==null){m.return=p,qe=m;break}qe=p}}}var x=a.alternate;if(x!==null){var g=x.child;if(g!==null){x.child=null;do{var b=g.sibling;g.sibling=null,g=b}while(g!==null)}}qe=a}}if(a.subtreeFlags&2064&&o!==null)o.return=a,qe=o;else e:for(;qe!==null;){if(a=qe,a.flags&2048)switch(a.tag){case 0:case 11:case 15:ev(9,a,a.return)}var v=a.sibling;if(v!==null){v.return=a.return,qe=v;break e}qe=a.return}}var y=s.current;for(qe=y;qe!==null;){o=qe;var w=o.child;if(o.subtreeFlags&2064&&w!==null)w.return=o,qe=w;else e:for(o=y;qe!==null;){if(l=qe,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:wj(9,l)}}catch(j){Ws(l,l.return,j)}if(l===o){qe=null;break e}var S=l.sibling;if(S!==null){S.return=l.return,qe=S;break e}qe=l.return}}if(Bt=r,qu(),ml&&typeof ml.onPostCommitFiberRoot=="function")try{ml.onPostCommitFiberRoot(fj,s)}catch{}n=!0}return n}finally{Zt=t,_a.transition=e}}return!1}function gR(s,e,t){e=px(t,e),e=GF(s,e,1),s=Cu(s,e,1),e=Er(),s!==null&&(K0(s,1,e),li(s,e))}function Ws(s,e,t){if(s.tag===3)gR(s,s,t);else for(;e!==null;){if(e.tag===3){gR(e,s,t);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Su===null||!Su.has(n))){s=px(t,s),s=YF(e,s,1),e=Cu(e,s,1),s=Er(),e!==null&&(K0(e,1,s),li(e,s));break}}e=e.return}}function j9(s,e,t){var n=s.pingCache;n!==null&&n.delete(e),e=Er(),s.pingedLanes|=s.suspendedLanes&t,Pn===s&&(Gn&t)===t&&(xn===4||xn===3&&(Gn&130023424)===Gn&&500>Zs()-sP?Wf(s,0):tP|=t),li(s,e)}function m3(s,e){e===0&&(s.mode&1?(e=kw,kw<<=1,!(kw&130023424)&&(kw=4194304)):e=1);var t=Er();s=Ic(s,e),s!==null&&(K0(s,e,t),li(s,t))}function k9(s){var e=s.memoizedState,t=0;e!==null&&(t=e.retryLane),m3(s,t)}function N9(s,e){var t=0;switch(s.tag){case 13:var n=s.stateNode,r=s.memoizedState;r!==null&&(t=r.retryLane);break;case 19:n=s.stateNode;break;default:throw Error(Te(314))}n!==null&&n.delete(e),m3(s,t)}var p3;p3=function(s,e,t){if(s!==null)if(s.memoizedProps!==e.pendingProps||ai.current)ni=!0;else{if(!(s.lanes&t)&&!(e.flags&128))return ni=!1,f9(s,e,t);ni=!!(s.flags&131072)}else ni=!1,Ts&&e.flags&1048576&&vF(e,DC,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;S1(s,e),s=e.pendingProps;var r=ux(e,fr.current);Sp(e,t),r=KE(null,e,n,s,r,t);var a=XE();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,oi(n)?(a=!0,IC(e)):a=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,VE(e),r.updater=bj,e.stateNode=r,r._reactInternals=e,u_(e,n,s,t),e=m_(null,e,n,!0,a,t)):(e.tag=0,Ts&&a&&OE(e),kr(null,e,r,t),e=e.child),e;case 16:n=e.elementType;e:{switch(S1(s,e),s=e.pendingProps,r=n._init,n=r(n._payload),e.type=n,r=e.tag=_9(n),s=Wa(n,s),r){case 0:e=f_(null,e,n,s,t);break e;case 1:e=aR(null,e,n,s,t);break e;case 11:e=rR(null,e,n,s,t);break e;case 14:e=iR(null,e,n,Wa(n.type,s),t);break e}throw Error(Te(306,n,""))}return e;case 0:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:Wa(n,r),f_(s,e,n,r,t);case 1:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:Wa(n,r),aR(s,e,n,r,t);case 3:e:{if(ZF(e),s===null)throw Error(Te(387));n=e.pendingProps,a=e.memoizedState,r=a.element,kF(s,e),FC(e,n,null,t);var o=e.memoizedState;if(n=o.element,a.isDehydrated)if(a={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=a,e.memoizedState=a,e.flags&256){r=px(Error(Te(423)),e),e=oR(s,e,n,t,r);break e}else if(n!==r){r=px(Error(Te(424)),e),e=oR(s,e,n,t,r);break e}else for(Hi=wu(e.stateNode.containerInfo.firstChild),Vi=e,Ts=!0,lo=null,t=SF(e,null,n,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(hx(),n===r){e=Rc(s,e,t);break e}kr(s,e,n,t)}e=e.child}return e;case 5:return NF(e),s===null&&l_(e),n=e.type,r=e.pendingProps,a=s!==null?s.memoizedProps:null,o=r.children,n_(n,r)?o=null:a!==null&&n_(n,a)&&(e.flags|=32),QF(s,e),kr(s,e,o,t),e.child;case 6:return s===null&&l_(e),null;case 13:return JF(s,e,t);case 4:return WE(e,e.stateNode.containerInfo),n=e.pendingProps,s===null?e.child=fx(e,null,n,t):kr(s,e,n,t),e.child;case 11:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:Wa(n,r),rR(s,e,n,r,t);case 7:return kr(s,e,e.pendingProps,t),e.child;case 8:return kr(s,e,e.pendingProps.children,t),e.child;case 12:return kr(s,e,e.pendingProps.children,t),e.child;case 10:e:{if(n=e.type._context,r=e.pendingProps,a=e.memoizedProps,o=r.value,fs(LC,n._currentValue),n._currentValue=o,a!==null)if(So(a.value,o)){if(a.children===r.children&&!ai.current){e=Rc(s,e,t);break e}}else for(a=e.child,a!==null&&(a.return=e);a!==null;){var l=a.dependencies;if(l!==null){o=a.child;for(var c=l.firstContext;c!==null;){if(c.context===n){if(a.tag===1){c=Nc(-1,t&-t),c.tag=2;var d=a.updateQueue;if(d!==null){d=d.shared;var h=d.pending;h===null?c.next=c:(c.next=h.next,h.next=c),d.pending=c}}a.lanes|=t,c=a.alternate,c!==null&&(c.lanes|=t),c_(a.return,t,e),l.lanes|=t;break}c=c.next}}else if(a.tag===10)o=a.type===e.type?null:a.child;else if(a.tag===18){if(o=a.return,o===null)throw Error(Te(341));o.lanes|=t,l=o.alternate,l!==null&&(l.lanes|=t),c_(o,t,e),o=a.sibling}else o=a.child;if(o!==null)o.return=a;else for(o=a;o!==null;){if(o===e){o=null;break}if(a=o.sibling,a!==null){a.return=o.return,o=a;break}o=o.return}a=o}kr(s,e,r.children,t),e=e.child}return e;case 9:return r=e.type,n=e.pendingProps.children,Sp(e,t),r=Ma(r),n=n(r),e.flags|=1,kr(s,e,n,t),e.child;case 14:return n=e.type,r=Wa(n,e.pendingProps),r=Wa(n.type,r),iR(s,e,n,r,t);case 15:return KF(s,e,e.type,e.pendingProps,t);case 17:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:Wa(n,r),S1(s,e),e.tag=1,oi(n)?(s=!0,IC(e)):s=!1,Sp(e,t),qF(e,n,r),u_(e,n,r,t),m_(null,e,n,!0,s,t);case 19:return e3(s,e,t);case 22:return XF(s,e,t)}throw Error(Te(156,e.tag))};function g3(s,e){return H4(s,e)}function A9(s,e,t,n){this.tag=s,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ka(s,e,t,n){return new A9(s,e,t,n)}function aP(s){return s=s.prototype,!(!s||!s.isReactComponent)}function _9(s){if(typeof s=="function")return aP(s)?1:0;if(s!=null){if(s=s.$$typeof,s===kE)return 11;if(s===NE)return 14}return 2}function ku(s,e){var t=s.alternate;return t===null?(t=ka(s.tag,e,s.key,s.mode),t.elementType=s.elementType,t.type=s.type,t.stateNode=s.stateNode,t.alternate=s,s.alternate=t):(t.pendingProps=e,t.type=s.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=s.flags&14680064,t.childLanes=s.childLanes,t.lanes=s.lanes,t.child=s.child,t.memoizedProps=s.memoizedProps,t.memoizedState=s.memoizedState,t.updateQueue=s.updateQueue,e=s.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=s.sibling,t.index=s.index,t.ref=s.ref,t}function N1(s,e,t,n,r,a){var o=2;if(n=s,typeof s=="function")aP(s)&&(o=1);else if(typeof s=="string")o=5;else e:switch(s){case tp:return qf(t.children,r,a,e);case jE:o=8,r|=8;break;case DA:return s=ka(12,t,e,r|2),s.elementType=DA,s.lanes=a,s;case LA:return s=ka(13,t,e,r),s.elementType=LA,s.lanes=a,s;case OA:return s=ka(19,t,e,r),s.elementType=OA,s.lanes=a,s;case N4:return Sj(t,r,a,e);default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case j4:o=10;break e;case k4:o=9;break e;case kE:o=11;break e;case NE:o=14;break e;case ad:o=16,n=null;break e}throw Error(Te(130,s==null?s:typeof s,""))}return e=ka(o,t,e,r),e.elementType=s,e.type=n,e.lanes=a,e}function qf(s,e,t,n){return s=ka(7,s,n,e),s.lanes=t,s}function Sj(s,e,t,n){return s=ka(22,s,n,e),s.elementType=N4,s.lanes=t,s.stateNode={isHidden:!1},s}function vN(s,e,t){return s=ka(6,s,null,e),s.lanes=t,s}function bN(s,e,t){return e=ka(4,s.children!==null?s.children:[],s.key,e),e.lanes=t,e.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},e}function T9(s,e,t,n,r){this.tag=e,this.containerInfo=s,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=eN(0),this.expirationTimes=eN(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=eN(0),this.identifierPrefix=n,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function oP(s,e,t,n,r,a,o,l,c){return s=new T9(s,e,t,l,c),e===1?(e=1,a===!0&&(e|=8)):e=0,a=ka(3,null,null,e),s.current=a,a.stateNode=s,a.memoizedState={element:n,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},VE(a),s}function E9(s,e,t){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ep,key:n==null?null:""+n,children:s,containerInfo:e,implementation:t}}function x3(s){if(!s)return Mu;s=s._reactInternals;e:{if(bm(s)!==s||s.tag!==1)throw Error(Te(170));var e=s;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(oi(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Te(171))}if(s.tag===1){var t=s.type;if(oi(t))return xF(s,t,e)}return e}function y3(s,e,t,n,r,a,o,l,c){return s=oP(t,n,!0,s,r,a,o,l,c),s.context=x3(null),t=s.current,n=Er(),r=ju(t),a=Nc(n,r),a.callback=e??null,Cu(t,a,r),s.current.lanes=r,K0(s,r,n),li(s,n),s}function jj(s,e,t,n){var r=e.current,a=Er(),o=ju(r);return t=x3(t),e.context===null?e.context=t:e.pendingContext=t,e=Nc(a,o),e.payload={element:s},n=n===void 0?null:n,n!==null&&(e.callback=n),s=Cu(r,e,o),s!==null&&(vo(s,r,o,a),b1(s,r,o)),o}function qC(s){if(s=s.current,!s.child)return null;switch(s.child.tag){case 5:return s.child.stateNode;default:return s.child.stateNode}}function xR(s,e){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var t=s.retryLane;s.retryLane=t!==0&&t<e?t:e}}function lP(s,e){xR(s,e),(s=s.alternate)&&xR(s,e)}function P9(){return null}var v3=typeof reportError=="function"?reportError:function(s){console.error(s)};function cP(s){this._internalRoot=s}kj.prototype.render=cP.prototype.render=function(s){var e=this._internalRoot;if(e===null)throw Error(Te(409));jj(s,e,null,null)};kj.prototype.unmount=cP.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var e=s.containerInfo;sm(function(){jj(null,s,null,null)}),e[Mc]=null}};function kj(s){this._internalRoot=s}kj.prototype.unstable_scheduleHydration=function(s){if(s){var e=X4();s={blockedOn:null,target:s,priority:e};for(var t=0;t<dd.length&&e!==0&&e<dd[t].priority;t++);dd.splice(t,0,s),t===0&&Z4(s)}};function dP(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function Nj(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11&&(s.nodeType!==8||s.nodeValue!==" react-mount-point-unstable "))}function yR(){}function M9(s,e,t,n,r){if(r){if(typeof n=="function"){var a=n;n=function(){var d=qC(o);a.call(d)}}var o=y3(e,n,s,0,null,!1,!1,"",yR);return s._reactRootContainer=o,s[Mc]=o.current,Sv(s.nodeType===8?s.parentNode:s),sm(),o}for(;r=s.lastChild;)s.removeChild(r);if(typeof n=="function"){var l=n;n=function(){var d=qC(c);l.call(d)}}var c=oP(s,0,!1,null,null,!1,!1,"",yR);return s._reactRootContainer=c,s[Mc]=c.current,Sv(s.nodeType===8?s.parentNode:s),sm(function(){jj(e,c,t,n)}),c}function Aj(s,e,t,n,r){var a=t._reactRootContainer;if(a){var o=a;if(typeof r=="function"){var l=r;r=function(){var c=qC(o);l.call(c)}}jj(e,o,s,r)}else o=M9(t,e,s,r,n);return qC(o)}Y4=function(s){switch(s.tag){case 3:var e=s.stateNode;if(e.current.memoizedState.isDehydrated){var t=py(e.pendingLanes);t!==0&&(TE(e,t|1),li(e,Zs()),!(Bt&6)&&(gx=Zs()+500,qu()))}break;case 13:sm(function(){var n=Ic(s,1);if(n!==null){var r=Er();vo(n,s,1,r)}}),lP(s,1)}};EE=function(s){if(s.tag===13){var e=Ic(s,134217728);if(e!==null){var t=Er();vo(e,s,134217728,t)}lP(s,134217728)}};K4=function(s){if(s.tag===13){var e=ju(s),t=Ic(s,e);if(t!==null){var n=Er();vo(t,s,e,n)}lP(s,e)}};X4=function(){return Zt};Q4=function(s,e){var t=Zt;try{return Zt=s,e()}finally{Zt=t}};GA=function(s,e,t){switch(e){case"input":if($A(s,t),e=t.name,t.type==="radio"&&e!=null){for(t=s;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var n=t[e];if(n!==s&&n.form===s.form){var r=xj(n);if(!r)throw Error(Te(90));_4(n),$A(n,r)}}}break;case"textarea":E4(s,t);break;case"select":e=t.value,e!=null&&vp(s,!!t.multiple,e,!1)}};O4=nP;F4=sm;var I9={usingClientEntryPoint:!1,Events:[Q0,ip,xj,D4,L4,nP]},Xx={findFiberByHostInstance:xh,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},R9={bundleType:Xx.bundleType,version:Xx.version,rendererPackageName:Xx.rendererPackageName,rendererConfig:Xx.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Hc.ReactCurrentDispatcher,findHostInstanceByFiber:function(s){return s=U4(s),s===null?null:s.stateNode},findFiberByHostInstance:Xx.findFiberByHostInstance||P9,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Lw=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Lw.isDisabled&&Lw.supportsFiber)try{fj=Lw.inject(R9),ml=Lw}catch{}}Qi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=I9;Qi.createPortal=function(s,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!dP(e))throw Error(Te(200));return E9(s,e,null,t)};Qi.createRoot=function(s,e){if(!dP(s))throw Error(Te(299));var t=!1,n="",r=v3;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=oP(s,1,!1,null,null,t,!1,n,r),s[Mc]=e.current,Sv(s.nodeType===8?s.parentNode:s),new cP(e)};Qi.findDOMNode=function(s){if(s==null)return null;if(s.nodeType===1)return s;var e=s._reactInternals;if(e===void 0)throw typeof s.render=="function"?Error(Te(188)):(s=Object.keys(s).join(","),Error(Te(268,s)));return s=U4(e),s=s===null?null:s.stateNode,s};Qi.flushSync=function(s){return sm(s)};Qi.hydrate=function(s,e,t){if(!Nj(e))throw Error(Te(200));return Aj(null,s,e,!0,t)};Qi.hydrateRoot=function(s,e,t){if(!dP(s))throw Error(Te(405));var n=t!=null&&t.hydratedSources||null,r=!1,a="",o=v3;if(t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(a=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=y3(e,null,s,1,t??null,r,!1,a,o),s[Mc]=e.current,Sv(s),n)for(s=0;s<n.length;s++)t=n[s],r=t._getVersion,r=r(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,r]:e.mutableSourceEagerHydrationData.push(t,r);return new kj(e)};Qi.render=function(s,e,t){if(!Nj(e))throw Error(Te(200));return Aj(null,s,e,!1,t)};Qi.unmountComponentAtNode=function(s){if(!Nj(s))throw Error(Te(40));return s._reactRootContainer?(sm(function(){Aj(null,null,s,!1,function(){s._reactRootContainer=null,s[Mc]=null})}),!0):!1};Qi.unstable_batchedUpdates=nP;Qi.unstable_renderSubtreeIntoContainer=function(s,e,t,n){if(!Nj(t))throw Error(Te(200));if(s==null||s._reactInternals===void 0)throw Error(Te(38));return Aj(s,e,t,!1,n)};Qi.version="18.3.1-next-f1338f8080-20240426";function b3(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(b3)}catch(s){console.error(s)}}b3(),b4.exports=Qi;var Gu=b4.exports;const w3=pE(Gu);var vR=Gu;IA.createRoot=vR.createRoot,IA.hydrateRoot=vR.hydrateRoot;var wh,D9=(wh=class extends Error{constructor(t){super(new.target.formatMessage(new.target.kind,t.message,t.code,t.docsUrl),{cause:t.cause});Ce(this,"clerkError",!0);Ce(this,"code");Ce(this,"longMessage");Ce(this,"docsUrl");Ce(this,"cause");Object.setPrototypeOf(this,wh.prototype),this.code=t.code,this.docsUrl=t.docsUrl,this.longMessage=t.longMessage,this.cause=t.cause}get name(){return this.constructor.name}toString(){return`[${this.name}]
Message:${this.message}`}static formatMessage(t,n,r,a){const o="Clerk:",l=new RegExp(o.replace(" ","\\s*"),"i");return n=n.replace(l,""),n=`${o} ${n.trim()}

(code="${r}")

`,a&&(n+=`

Docs: ${a}`),n}},Ce(wh,"kind","ClerkError"),wh);const L9=Object.freeze({InvalidProxyUrlErrorMessage:"The proxyUrl passed to Clerk is invalid. The expected value for proxyUrl is an absolute URL or a relative path with a leading '/'. (key={{url}})",InvalidPublishableKeyErrorMessage:"The publishableKey passed to Clerk is invalid. You can get your Publishable key at https://dashboard.clerk.com/last-active?path=api-keys. (key={{key}})",MissingPublishableKeyErrorMessage:"Missing publishableKey. You can get your key at https://dashboard.clerk.com/last-active?path=api-keys.",MissingSecretKeyErrorMessage:"Missing secretKey. You can get your key at https://dashboard.clerk.com/last-active?path=api-keys.",MissingClerkProvider:"{{source}} can only be used within the <ClerkProvider /> component. Learn more: https://clerk.com/docs/components/clerk-provider"});function C3({packageName:s,customMessages:e}){let t=s;function n(a,o){if(!o)return`${t}: ${a}`;let l=a;const c=a.matchAll(/{{([a-zA-Z0-9-_]+)}}/g);for(const d of c){const h=(o[d[1]]||"").toString();l=l.replace(`{{${d[1]}}}`,h)}return`${t}: ${l}`}const r={...L9,...e};return{setPackageName({packageName:a}){return typeof a=="string"&&(t=a),this},setMessages({customMessages:a}){return Object.assign(r,a||{}),this},throwInvalidPublishableKeyError(a){throw new Error(n(r.InvalidPublishableKeyErrorMessage,a))},throwInvalidProxyUrl(a){throw new Error(n(r.InvalidProxyUrlErrorMessage,a))},throwMissingPublishableKeyError(){throw new Error(n(r.MissingPublishableKeyErrorMessage))},throwMissingSecretKeyError(){throw new Error(n(r.MissingSecretKeyErrorMessage))},throwMissingClerkProviderError(a){throw new Error(n(r.MissingClerkProvider,a))},throw(a){throw new Error(n(a))}}}var Ch,S3=(Ch=class extends D9{constructor(t,n){super({...n,message:t});Ce(this,"clerkRuntimeError",!0);Object.setPrototypeOf(this,Ch.prototype)}},Ce(Ch,"kind","ClerkRuntimeError"),Ch);const O9={strict_mfa:{afterMinutes:10,level:"multi_factor"},strict:{afterMinutes:10,level:"second_factor"},moderate:{afterMinutes:60,level:"second_factor"},lax:{afterMinutes:1440,level:"second_factor"}},F9=new Set(["first_factor","second_factor","multi_factor"]),B9=new Set(["strict_mfa","strict","moderate","lax"]),$9=s=>typeof s=="number"&&s>0,U9=s=>F9.has(s),z9=s=>B9.has(s),wN=s=>s.replace(/^(org:)*/,"org:"),H9=(s,e)=>{const{orgId:t,orgRole:n,orgPermissions:r}=e;return!s.role&&!s.permission||!t||!n||!r?null:s.permission?r.includes(wN(s.permission)):s.role?wN(n)===wN(s.role):null},bR=(s,e)=>{const{org:t,user:n}=W9(s),[r,a]=e.split(":"),o=a||r;return r==="org"?t.includes(o):r==="user"?n.includes(o):[...t,...n].includes(o)},V9=(s,e)=>{const{features:t,plans:n}=e;return s.feature&&t?bR(t,s.feature):s.plan&&n?bR(n,s.plan):null},W9=s=>{const e=s?s.split(",").map(t=>t.trim()):[];return{org:e.filter(t=>t.split(":")[0].includes("o")).map(t=>t.split(":")[1]),user:e.filter(t=>t.split(":")[0].includes("u")).map(t=>t.split(":")[1])}},q9=s=>{if(!s)return!1;const e=r=>typeof r=="string"?O9[r]:r,t=typeof s=="string"&&z9(s),n=typeof s=="object"&&U9(s.level)&&$9(s.afterMinutes);return t||n?e.bind(null,s):!1},G9=(s,{factorVerificationAge:e})=>{if(!s.reverification||!e)return null;const t=q9(s.reverification);if(!t)return null;const{level:n,afterMinutes:r}=t(),[a,o]=e,l=a!==-1?r>a:null,c=o!==-1?r>o:null;switch(n){case"first_factor":return l;case"second_factor":return o!==-1?c:l;case"multi_factor":return o===-1?l:l&&c}},Y9=s=>e=>{if(!s.userId)return!1;const t=V9(e,s),n=H9(e,s),r=G9(e,s);return[t||n,r].some(a=>a===null)?[t||n,r].some(a=>a===!0):[t||n,r].every(a=>a===!0)},K9=({authObject:{sessionId:s,sessionStatus:e,userId:t,actor:n,orgId:r,orgRole:a,orgSlug:o,signOut:l,getToken:c,has:d,sessionClaims:h},options:{treatPendingAsSignedOut:f=!0}})=>{if(s===void 0&&t===void 0)return{isLoaded:!1,isSignedIn:void 0,sessionId:s,sessionClaims:void 0,userId:t,actor:void 0,orgId:void 0,orgRole:void 0,orgSlug:void 0,has:void 0,signOut:l,getToken:c};if(s===null&&t===null)return{isLoaded:!0,isSignedIn:!1,sessionId:s,userId:t,sessionClaims:null,actor:null,orgId:null,orgRole:null,orgSlug:null,has:()=>!1,signOut:l,getToken:c};if(f&&e==="pending")return{isLoaded:!0,isSignedIn:!1,sessionId:null,userId:null,sessionClaims:null,actor:null,orgId:null,orgRole:null,orgSlug:null,has:()=>!1,signOut:l,getToken:c};if(s&&h&&t&&r&&a)return{isLoaded:!0,isSignedIn:!0,sessionId:s,sessionClaims:h,userId:t,actor:n||null,orgId:r,orgRole:a,orgSlug:o||null,has:d,signOut:l,getToken:c};if(s&&h&&t&&!r)return{isLoaded:!0,isSignedIn:!0,sessionId:s,sessionClaims:h,userId:t,actor:n||null,orgId:null,orgRole:null,orgSlug:null,has:d,signOut:l,getToken:c}},X9=[".lcl.dev",".stg.dev",".lclstage.dev",".stgstage.dev",".dev.lclclerk.com",".stg.lclclerk.com",".accounts.lclclerk.com","accountsstage.dev","accounts.dev"],j3=s=>typeof atob<"u"&&typeof atob=="function"?atob(s):typeof globalThis<"u"&&globalThis.Buffer?new globalThis.Buffer(s,"base64").toString():s,k3="pk_live_",Q9="pk_test_";function N3(s){if(!s.endsWith("$"))return!1;const e=s.slice(0,-1);return e.includes("$")?!1:e.includes(".")}function wR(s,e={}){if(s=s||"",!s||!N_(s)){if(e.fatal&&!s)throw new Error("Publishable key is missing. Ensure that your publishable key is correctly configured. Double-check your environment configuration for your keys, or access them here: https://dashboard.clerk.com/last-active?path=api-keys");if(e.fatal&&!N_(s))throw new Error("Publishable key not valid.");return null}const t=s.startsWith(k3)?"production":"development";let n;try{n=j3(s.split("_")[2])}catch{if(e.fatal)throw new Error("Publishable key not valid: Failed to decode key.");return null}if(!N3(n)){if(e.fatal)throw new Error("Publishable key not valid: Decoded key has invalid format.");return null}let r=n.slice(0,-1);return e.proxyUrl?r=e.proxyUrl:t!=="development"&&e.domain&&e.isSatellite&&(r=`clerk.${e.domain}`),{instanceType:t,frontendApi:r}}function N_(s=""){try{if(!(s.startsWith(k3)||s.startsWith(Q9)))return!1;const e=s.split("_");if(e.length!==3)return!1;const t=e[2];return t?N3(j3(t)):!1}catch{return!1}}function Z9(){const s=new Map;return{isDevOrStagingUrl:e=>{if(!e)return!1;const t=typeof e=="string"?e:e.hostname;let n=s.get(t);return n===void 0&&(n=X9.some(r=>t.endsWith(r)),s.set(t,n)),n}}}const J9="METHOD_CALLED",e7=.1;function A3(s,e){return{event:J9,eventSamplingRate:e7,payload:{method:s,...e}}}var _3={exports:{}},T3={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xx=C;function t7(s,e){return s===e&&(s!==0||1/s===1/e)||s!==s&&e!==e}var s7=typeof Object.is=="function"?Object.is:t7,n7=xx.useState,r7=xx.useEffect,i7=xx.useLayoutEffect,a7=xx.useDebugValue;function o7(s,e){var t=e(),n=n7({inst:{value:t,getSnapshot:e}}),r=n[0].inst,a=n[1];return i7(function(){r.value=t,r.getSnapshot=e,CN(r)&&a({inst:r})},[s,t,e]),r7(function(){return CN(r)&&a({inst:r}),s(function(){CN(r)&&a({inst:r})})},[s]),a7(t),t}function CN(s){var e=s.getSnapshot;s=s.value;try{var t=e();return!s7(s,t)}catch{return!0}}function l7(s,e){return e()}var c7=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?l7:o7;T3.useSyncExternalStore=xx.useSyncExternalStore!==void 0?xx.useSyncExternalStore:c7;_3.exports=T3;var d7=_3.exports;const u7=0,h7=1,f7=2;var CR=Object.prototype.hasOwnProperty;function A_(s,e){var t,n;if(s===e)return!0;if(s&&e&&(t=s.constructor)===e.constructor){if(t===Date)return s.getTime()===e.getTime();if(t===RegExp)return s.toString()===e.toString();if(t===Array){if((n=s.length)===e.length)for(;n--&&A_(s[n],e[n]););return n===-1}if(!t||typeof s=="object"){n=0;for(t in s)if(CR.call(s,t)&&++n&&!CR.call(e,t)||!(t in e)||!A_(s[t],e[t]))return!1;return Object.keys(e).length===n}}return s!==s&&e!==e}const hd=new WeakMap,mu=()=>{},Bi=mu(),GC=Object,mo=s=>s===Bi,fd=s=>typeof s=="function",nm=(s,e)=>({...s,...e}),m7=s=>fd(s.then),SN={},Ow={},E3="undefined",_j=typeof window!=E3,__=typeof document!=E3,p7=_j&&"Deno"in window,g7=(s,e)=>{const t=hd.get(s);return[()=>!mo(e)&&s.get(e)||SN,n=>{if(!mo(e)){const r=s.get(e);e in Ow||(Ow[e]=r),t[5](e,nm(r,n),r||SN)}},t[6],()=>!mo(e)&&e in Ow?Ow[e]:!mo(e)&&s.get(e)||SN]};let T_=!0;const x7=()=>T_,[E_,P_]=_j&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[mu,mu],y7=()=>{const s=__&&document.visibilityState;return mo(s)||s!=="hidden"},v7=s=>(__&&document.addEventListener("visibilitychange",s),E_("focus",s),()=>{__&&document.removeEventListener("visibilitychange",s),P_("focus",s)}),b7=s=>{const e=()=>{T_=!0,s()},t=()=>{T_=!1};return E_("online",e),E_("offline",t),()=>{P_("online",e),P_("offline",t)}},w7={isOnline:x7,isVisible:y7},C7={initFocus:v7,initReconnect:b7};V.useId;const uP=!_j||p7,S7=uP?C.useEffect:C.useLayoutEffect,jN=typeof navigator<"u"&&navigator.connection,SR=!uP&&jN&&(["slow-2g","2g"].includes(jN.effectiveType)||jN.saveData),Fw=new WeakMap,j7=s=>GC.prototype.toString.call(s),kN=(s,e)=>s===`[object ${e}]`;let k7=0;const M_=s=>{const e=typeof s,t=j7(s),n=kN(t,"Date"),r=kN(t,"RegExp"),a=kN(t,"Object");let o,l;if(GC(s)===s&&!n&&!r){if(o=Fw.get(s),o)return o;if(o=++k7+"~",Fw.set(s,o),Array.isArray(s)){for(o="@",l=0;l<s.length;l++)o+=M_(s[l])+",";Fw.set(s,o)}if(a){o="#";const c=GC.keys(s).sort();for(;!mo(l=c.pop());)mo(s[l])||(o+=l+":"+M_(s[l])+",");Fw.set(s,o)}}else o=n?s.toJSON():e=="symbol"?s.toString():e=="string"?JSON.stringify(s):""+s;return o},P3=s=>{if(fd(s))try{s=s()}catch{s=""}const e=s;return s=typeof s=="string"?s:(Array.isArray(s)?s.length:s)?M_(s):"",[s,e]};let N7=0;const jR=()=>++N7;async function A7(...s){const[e,t,n,r]=s,a=nm({populateCache:!0,throwOnError:!0},typeof r=="boolean"?{revalidate:r}:r||{});let o=a.populateCache;const l=a.rollbackOnError;let c=a.optimisticData;const d=m=>typeof l=="function"?l(m):l!==!1,h=a.throwOnError;if(fd(t)){const m=t,p=[],x=e.keys();for(const g of x)!/^\$(inf|sub)\$/.test(g)&&m(e.get(g)._k)&&p.push(g);return Promise.all(p.map(f))}return f(t);async function f(m){const[p]=P3(m);if(!p)return;const[x,g]=g7(e,p),[b,v,y,w]=hd.get(e),S=()=>{const R=b[p];return(fd(a.revalidate)?a.revalidate(x().data,m):a.revalidate!==!1)&&(delete y[p],delete w[p],R&&R[0])?R[0](f7).then(()=>x().data):x().data};if(s.length<3)return S();let j=n,A,k=!1;const _=jR();v[p]=[_,0];const L=!mo(c),D=x(),P=D.data,T=D._c,B=mo(T)?P:T;if(L&&(c=fd(c)?c(B,P):c,g({data:c,_c:B})),fd(j))try{j=j(B)}catch(R){A=R,k=!0}if(j&&m7(j))if(j=await j.catch(R=>{A=R,k=!0}),_!==v[p][0]){if(k)throw A;return j}else k&&L&&d(A)&&(o=!0,g({data:B,_c:Bi}));if(o&&!k)if(fd(o)){const R=o(j,B);g({data:R,error:Bi,_c:Bi})}else g({data:j,error:Bi,_c:Bi});if(v[p][1]=jR(),Promise.resolve(S()).then(()=>{g({_c:Bi})}),k){if(h)throw A;return}return j}}const kR=(s,e)=>{for(const t in s)s[t][0]&&s[t][0](e)},M3=(s,e)=>{if(!hd.has(s)){const t=nm(C7,e),n=Object.create(null),r=A7.bind(Bi,s);let a=mu;const o=Object.create(null),l=(h,f)=>{const m=o[h]||[];return o[h]=m,m.push(f),()=>m.splice(m.indexOf(f),1)},c=(h,f,m)=>{s.set(h,f);const p=o[h];if(p)for(const x of p)x(f,m)},d=()=>{if(!hd.has(s)&&(hd.set(s,[n,Object.create(null),Object.create(null),Object.create(null),r,c,l]),!uP)){const h=t.initFocus(setTimeout.bind(Bi,kR.bind(Bi,n,u7))),f=t.initReconnect(setTimeout.bind(Bi,kR.bind(Bi,n,h7)));a=()=>{h&&h(),f&&f(),hd.delete(s)}}};return d(),[s,r,d,a]}return[s,hd.get(s)[4]]},_7=(s,e,t,n,r)=>{const a=t.errorRetryCount,o=r.retryCount,l=~~((Math.random()+.5)*(1<<(o<8?o:8)))*t.errorRetryInterval;!mo(a)&&o>a||setTimeout(n,l,r)},T7=A_,[hP,E7]=M3(new Map),P7=nm({onLoadingSlow:mu,onSuccess:mu,onError:mu,onErrorRetry:_7,onDiscarded:mu,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:SR?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:SR?5e3:3e3,compare:T7,isPaused:()=>!1,cache:hP,mutate:E7,fallback:{}},w7),M7=(s,e)=>{const t=nm(s,e);if(e){const{use:n,fallback:r}=s,{use:a,fallback:o}=e;n&&a&&(t.use=n.concat(a)),r&&o&&(t.fallback=nm(r,o))}return t},NR=C.createContext({}),I7=s=>{const{value:e}=s,t=C.useContext(NR),n=fd(e),r=C.useMemo(()=>n?e(t):e,[n,t,e]),a=C.useMemo(()=>n?r:M7(t,r),[n,t,r]),o=r&&r.provider,l=C.useRef(Bi);o&&!l.current&&(l.current=M3(o(a.cache||hP),r));const c=l.current;return c&&(a.cache=c[0],a.mutate=c[1]),S7(()=>{if(c)return c[2]&&c[2](),c[3]},[]),C.createElement(NR.Provider,nm(s,{value:a}))},R7="$inf$",I3=_j&&window.__SWR_DEVTOOLS_USE__,D7=I3?window.__SWR_DEVTOOLS_USE__:[],L7=()=>{I3&&(window.__SWR_DEVTOOLS_REACT__=V)},O7=s=>(e,t,n)=>s(e,t&&((...a)=>{const[o]=P3(e),[,,,l]=hd.get(hP);if(o.startsWith(R7))return t(...a);const c=l[o];return mo(c)?t(...a):(delete l[o],c)}),n);D7.concat(O7);L7();V.use;const F7=GC.defineProperty(I7,"defaultValue",{value:P7});var AR=Object.prototype.hasOwnProperty;function _R(s,e,t){for(t of s.keys())if(nv(t,e))return t}function nv(s,e){var t,n,r;if(s===e)return!0;if(s&&e&&(t=s.constructor)===e.constructor){if(t===Date)return s.getTime()===e.getTime();if(t===RegExp)return s.toString()===e.toString();if(t===Array){if((n=s.length)===e.length)for(;n--&&nv(s[n],e[n]););return n===-1}if(t===Set){if(s.size!==e.size)return!1;for(n of s)if(r=n,r&&typeof r=="object"&&(r=_R(e,r),!r)||!e.has(r))return!1;return!0}if(t===Map){if(s.size!==e.size)return!1;for(n of s)if(r=n[0],r&&typeof r=="object"&&(r=_R(e,r),!r)||!nv(n[1],e.get(r)))return!1;return!0}if(t===ArrayBuffer)s=new Uint8Array(s),e=new Uint8Array(e);else if(t===DataView){if((n=s.byteLength)===e.byteLength)for(;n--&&s.getInt8(n)===e.getInt8(n););return n===-1}if(ArrayBuffer.isView(s)){if((n=s.byteLength)===e.byteLength)for(;n--&&s[n]===e[n];);return n===-1}if(!t||typeof s=="object"){n=0;for(t in s)if(AR.call(s,t)&&++n&&!AR.call(e,t)||!(t in e)||!nv(s[t],e[t]))return!1;return Object.keys(e).length===n}}return s!==s&&e!==e}function B7(s,e){if(!s)throw typeof e=="string"?new Error(e):new Error(`${e.displayName} not found`)}const Vc=(s,e)=>{const{assertCtxFn:t=B7}={},n=V.createContext(void 0);return n.displayName=s,[n,()=>{const o=V.useContext(n);return t(o,`${s} not found`),o.value},()=>{const o=V.useContext(n);return o?o.value:{}}]};function $7({swrConfig:s,children:e}){return V.createElement(F7,{value:s},e)}const[R3,D3]=Vc("ClerkInstanceContext"),[U7,z7]=Vc("UserContext"),[H7]=Vc("ClientContext"),[V7]=Vc("SessionContext");V.createContext({});const[W7]=Vc("CheckoutContext"),q7=({children:s,...e})=>V.createElement(W7.Provider,{value:{value:e}},s),[G7]=Vc("OrganizationContext"),Y7=({children:s,organization:e,swrConfig:t})=>V.createElement($7,{swrConfig:t},V.createElement(G7.Provider,{value:{value:{organization:e}}},s));function L3(s){if(!V.useContext(R3)){if(typeof s=="function"){s();return}throw new Error(`${s} can only be used within the <ClerkProvider /> component.

Possible fixes:
1. Ensure that the <ClerkProvider /> is correctly wrapping your application where this component is used.
2. Check for multiple versions of the \`@clerk/shared\` package in your project. Use a tool like \`npm ls @clerk/shared\` to identify multiple versions, and update your dependencies to only rely on one.

Learn more: https://clerk.com/docs/components/clerk-provider`.trim())}}typeof window<"u"?V.useLayoutEffect:V.useEffect;const TR="useUser";function Wc(){var e;L3(TR);const s=z7();return(e=D3().telemetry)==null||e.record(A3(TR)),s===void 0?{isLoaded:!1,isSignedIn:void 0,user:void 0}:s===null?{isLoaded:!0,isSignedIn:!1,user:null}:{isLoaded:!0,isSignedIn:!0,user:s}}const ER=nv,K7=s=>{const e=C.useRef(s);return C.useEffect(()=>{e.current=s},[s]),e.current},fi=(s,e,t)=>{const n=!!t,r=C.useRef(t);C.useEffect(()=>{r.current=t},[t]),C.useEffect(()=>{if(!n||!s)return()=>{};const a=(...o)=>{r.current&&r.current(...o)};return s.on(e,a),()=>{s.off(e,a)}},[n,e,s,r])},O3=V.createContext(null);O3.displayName="ElementsContext";const X7=(s,e)=>{if(!s)throw new Error(`Could not find Elements context; You need to wrap the part of your app that ${e} in an <Elements> provider.`);return s},YC=s=>s!==null&&typeof s=="object",Q7=(s,e,t)=>YC(s)?Object.keys(s).reduce((n,r)=>{const a=!YC(e)||!F3(s[r],e[r]);return t.includes(r)?(a&&console.warn(`Unsupported prop change: options.${r} is not a mutable property.`),n):a?{...n||{},[r]:s[r]}:n},null):null,PR="[object Object]",F3=(s,e)=>{if(!YC(s)||!YC(e))return s===e;const t=Array.isArray(s);if(t!==Array.isArray(e))return!1;const n=Object.prototype.toString.call(s)===PR;if(n!==(Object.prototype.toString.call(e)===PR))return!1;if(!n&&!t)return s===e;const r=Object.keys(s),a=Object.keys(e);if(r.length!==a.length)return!1;const o={};for(let f=0;f<r.length;f+=1)o[r[f]]=!0;for(let f=0;f<a.length;f+=1)o[a[f]]=!0;const l=Object.keys(o);if(l.length!==r.length)return!1;const c=s,d=e,h=f=>F3(c[f],d[f]);return l.every(h)},MR=s=>X7(V.useContext(O3),s),Z7=s=>s.charAt(0).toUpperCase()+s.slice(1),J7=(s,e)=>{const t=`${Z7(s)}Element`,a=e?o=>{MR(`mounts <${t}>`);const{id:l,className:c}=o;return V.createElement("div",{id:l,className:c})}:({id:o,className:l,fallback:c,options:d={},onBlur:h,onFocus:f,onReady:m,onChange:p,onEscape:x,onClick:g,onLoadError:b,onLoaderStart:v,onNetworksChange:y,onConfirm:w,onCancel:S,onShippingAddressChange:j,onShippingRateChange:A})=>{const k=MR(`mounts <${t}>`),_="elements"in k?k.elements:null,[L,D]=V.useState(null),P=V.useRef(null),T=V.useRef(null),[B,R]=C.useState(!1);fi(L,"blur",h),fi(L,"focus",f),fi(L,"escape",x),fi(L,"click",g),fi(L,"loaderror",b),fi(L,"loaderstart",v),fi(L,"networkschange",y),fi(L,"confirm",w),fi(L,"cancel",S),fi(L,"shippingaddresschange",j),fi(L,"shippingratechange",A),fi(L,"change",p);let O;m&&(O=()=>{R(!0),m(L)}),fi(L,"ready",O),V.useLayoutEffect(()=>{if(P.current===null&&T.current!==null&&_){let U=null;_&&(U=_.create(s,d)),P.current=U,D(U),U&&U.mount(T.current)}},[_,d]);const I=K7(d);return V.useEffect(()=>{if(!P.current)return;const U=Q7(d,I,["paymentRequest"]);U&&"update"in P.current&&P.current.update(U)},[d,I]),V.useLayoutEffect(()=>()=>{if(P.current&&typeof P.current.destroy=="function")try{P.current.destroy(),P.current=null}catch{}},[]),V.createElement(V.Fragment,null,!B&&c,V.createElement("div",{id:o,style:{height:B?"unset":"0px",visibility:B?"visible":"hidden"},className:l,ref:T}))};return a.displayName=t,a.__elementType=s,a};J7("payment",typeof window>"u");Vc("PaymentElementContext");Vc("StripeUtilsContext");var bo=C3({packageName:"@clerk/clerk-react"});function eG(s){bo.setMessages(s).setPackageName(s)}var[tG,sG]=Vc("AuthContext"),nG=R3,B3=D3,rG="You've added multiple <ClerkProvider> components in your React component tree. Wrap your components in a single <ClerkProvider>.",iG=s=>`You've passed multiple children components to <${s}/>. You can only pass a single child component or text.`,aG="Invalid state. Feel free to submit a bug or reach out to support here: https://clerk.com/support",NN="Unsupported usage of isSatellite, domain or proxyUrl. The usage of isSatellite, domain or proxyUrl as function is not supported in non-browser environments.",oG="<UserProfile.Page /> component needs to be a direct child of `<UserProfile />` or `<UserButton />`.",lG="<UserProfile.Link /> component needs to be a direct child of `<UserProfile />` or `<UserButton />`.",cG="<OrganizationProfile.Page /> component needs to be a direct child of `<OrganizationProfile />` or `<OrganizationSwitcher />`.",dG="<OrganizationProfile.Link /> component needs to be a direct child of `<OrganizationProfile />` or `<OrganizationSwitcher />`.",uG=s=>`<${s} /> can only accept <${s}.Page /> and <${s}.Link /> as its children. Any other provided component will be ignored. Additionally, please ensure that the component is rendered in a client component.`,hG=s=>`Missing props. <${s}.Page /> component requires the following props: url, label, labelIcon, alongside with children to be rendered inside the page.`,fG=s=>`Missing props. <${s}.Link /> component requires the following props: url, label and labelIcon.`,mG="<UserButton /> can only accept <UserButton.UserProfilePage />, <UserButton.UserProfileLink /> and <UserButton.MenuItems /> as its children. Any other provided component will be ignored. Additionally, please ensure that the component is rendered in a client component.",pG="<UserButton.MenuItems /> component can only accept <UserButton.Action /> and <UserButton.Link /> as its children. Any other provided component will be ignored. Additionally, please ensure that the component is rendered in a client component.",gG="<UserButton.MenuItems /> component needs to be a direct child of `<UserButton />`.",xG="<UserButton.Action /> component needs to be a direct child of `<UserButton.MenuItems />`.",yG="<UserButton.Link /> component needs to be a direct child of `<UserButton.MenuItems />`.",vG="Missing props. <UserButton.Link /> component requires the following props: href, label and labelIcon.",bG="Missing props. <UserButton.Action /> component requires the following props: label.",Tj=s=>{L3(()=>{bo.throwMissingClerkProviderError({source:s})})},$3=s=>new Promise(e=>{const t=n=>{["ready","degraded"].includes(n)&&(e(),s.off("status",t))};s.on("status",t,{notify:!0})}),wG=s=>async e=>(await $3(s),s.session?s.session.getToken(e):null),CG=s=>async(...e)=>(await $3(s),s.signOut(...e)),Ji=(s={})=>{var e;Tj("useAuth");const{treatPendingAsSignedOut:t,...n}=s??{},r=n;let o=sG();o.sessionId===void 0&&o.userId===void 0&&(o=r??{});const l=B3(),c=C.useCallback(wG(l),[l]),d=C.useCallback(CG(l),[l]);return(e=l.telemetry)==null||e.record(A3("useAuth",{treatPendingAsSignedOut:t})),SG({...o,getToken:c,signOut:d},{treatPendingAsSignedOut:t})};function SG(s,{treatPendingAsSignedOut:e=!0}={}){const{userId:t,orgId:n,orgRole:r,has:a,signOut:o,getToken:l,orgPermissions:c,factorVerificationAge:d,sessionClaims:h}=s??{},f=C.useCallback(p=>a?a(p):Y9({userId:t,orgId:n,orgRole:r,orgPermissions:c,factorVerificationAge:d,features:(h==null?void 0:h.fea)||"",plans:(h==null?void 0:h.pla)||""})(p),[a,t,n,r,c,d,h]),m=K9({authObject:{...s,getToken:l,signOut:o,has:f},options:{treatPendingAsSignedOut:e}});return m||bo.throw(aG)}var js=(s,e)=>{const n=(typeof e=="string"?e:e==null?void 0:e.component)||s.displayName||s.name||"Component";s.displayName=n;const r=typeof e=="string"?void 0:e,a=o=>{Tj(n||"withClerk");const l=B3();return!l.loaded&&!(r!=null&&r.renderWhileLoading)?null:V.createElement(s,{...o,component:n,clerk:l})};return a.displayName=`withClerk(${n})`,a};const jG=()=>{try{return!1}catch{}return!1},kG=()=>{try{return!1}catch{}return!1},NG=()=>{try{return!0}catch{}return!1},IR=new Set,fP=(s,e,t)=>{const n=kG()||NG(),r=s;IR.has(r)||n||(IR.add(r),console.warn(`Clerk - DEPRECATION WARNING: "${s}" is deprecated and will be removed in the next major release.
${e}`))};var Rr=({children:s,treatPendingAsSignedOut:e})=>{Tj("SignedIn");const{userId:t}=Ji({treatPendingAsSignedOut:e});return t?s:null},Yu=({children:s,treatPendingAsSignedOut:e})=>{Tj("SignedOut");const{userId:t}=Ji({treatPendingAsSignedOut:e});return t===null?s:null};js(({clerk:s,...e})=>{const{client:t,session:n}=s,r=t.signedInSessions?t.signedInSessions.length>0:t.activeSessions&&t.activeSessions.length>0;return V.useEffect(()=>{n===null&&r?s.redirectToAfterSignOut():s.redirectToSignIn(e)},[]),null},"RedirectToSignIn");js(({clerk:s,...e})=>(V.useEffect(()=>{s.redirectToSignUp(e)},[]),null),"RedirectToSignUp");js(({clerk:s,...e})=>(V.useEffect(()=>{s.redirectToTasks(e)},[]),null),"RedirectToTasks");js(({clerk:s})=>(V.useEffect(()=>{fP("RedirectToUserProfile","Use the `redirectToUserProfile()` method instead."),s.redirectToUserProfile()},[]),null),"RedirectToUserProfile");js(({clerk:s})=>(V.useEffect(()=>{fP("RedirectToOrganizationProfile","Use the `redirectToOrganizationProfile()` method instead."),s.redirectToOrganizationProfile()},[]),null),"RedirectToOrganizationProfile");js(({clerk:s})=>(V.useEffect(()=>{fP("RedirectToCreateOrganization","Use the `redirectToCreateOrganization()` method instead."),s.redirectToCreateOrganization()},[]),null),"RedirectToCreateOrganization");js(({clerk:s,...e})=>(V.useEffect(()=>{s.handleRedirectCallback(e)},[]),null),"AuthenticateWithRedirectCallback");function AN(s,e,t){if(typeof s=="function")return s(e);if(typeof s<"u")return s;if(typeof t<"u")return t}const _r=s=>{jG()&&console.error(`Clerk: ${s}`)},RR=(s,...e)=>{const t={...s};for(const n of e)delete t[n];return t};var Ej=s=>e=>{try{return V.Children.only(s)}catch{return bo.throw(iG(e))}},Pj=(s,e)=>(s||(s=e),typeof s=="string"&&(s=V.createElement("button",null,s)),s),Mj=s=>(...e)=>{if(s&&typeof s=="function")return s(...e)};function AG(s){return typeof s=="function"}var Bw=new Map;function _G(s,e,t=1){V.useEffect(()=>{const n=Bw.get(s)||0;return n==t?bo.throw(e):(Bw.set(s,n+1),()=>{Bw.set(s,(Bw.get(s)||1)-1)})},[])}function TG(s,e,t){const n=s.displayName||s.name||e||"Component",r=a=>(_G(e,t),V.createElement(s,{...a}));return r.displayName=`withMaxAllowedInstancesGuard(${n})`,r}var rv=s=>{const[e,t]=C.useState(new Map);return s.map(n=>({id:n.id,mount:r=>t(a=>new Map(a).set(String(n.id),r)),unmount:()=>t(r=>{const a=new Map(r);return a.set(String(n.id),null),a}),portal:()=>{const r=e.get(String(n.id));return r?Gu.createPortal(n.component,r):null}}))},Nr=(s,e)=>!!s&&V.isValidElement(s)&&(s==null?void 0:s.type)===e,U3=(s,e)=>V3({children:s,reorderItemsLabels:["account","security"],LinkComponent:ew,PageComponent:J0,MenuItemsComponent:Rj,componentName:"UserProfile"},e),z3=(s,e)=>V3({children:s,reorderItemsLabels:["general","members"],LinkComponent:Lj,PageComponent:Dj,componentName:"OrganizationProfile"},e),H3=s=>{const e=[],t=[Lj,Dj,Rj,J0,ew];return V.Children.forEach(s,n=>{t.some(r=>Nr(n,r))||e.push(n)}),e},V3=(s,e)=>{const{children:t,LinkComponent:n,PageComponent:r,MenuItemsComponent:a,reorderItemsLabels:o,componentName:l}=s,{allowForAnyChildren:c=!1}=e||{},d=[];V.Children.forEach(t,y=>{if(!Nr(y,r)&&!Nr(y,n)&&!Nr(y,a)){y&&!c&&_r(uG(l));return}const{props:w}=y,{children:S,label:j,url:A,labelIcon:k}=w;if(Nr(y,r))if(DR(w,o))d.push({label:j});else if(_N(w))d.push({label:j,labelIcon:k,children:S,url:A});else{_r(hG(l));return}if(Nr(y,n))if(TN(w))d.push({label:j,labelIcon:k,url:A});else{_r(fG(l));return}});const h=[],f=[],m=[];d.forEach((y,w)=>{if(_N(y)){h.push({component:y.children,id:w}),f.push({component:y.labelIcon,id:w});return}TN(y)&&m.push({component:y.labelIcon,id:w})});const p=rv(h),x=rv(f),g=rv(m),b=[],v=[];return d.forEach((y,w)=>{if(DR(y,o)){b.push({label:y.label});return}if(_N(y)){const{portal:S,mount:j,unmount:A}=p.find(D=>D.id===w),{portal:k,mount:_,unmount:L}=x.find(D=>D.id===w);b.push({label:y.label,url:y.url,mount:j,unmount:A,mountIcon:_,unmountIcon:L}),v.push(S),v.push(k);return}if(TN(y)){const{portal:S,mount:j,unmount:A}=g.find(k=>k.id===w);b.push({label:y.label,url:y.url,mountIcon:j,unmountIcon:A}),v.push(S);return}}),{customPages:b,customPagesPortals:v}},DR=(s,e)=>{const{children:t,label:n,url:r,labelIcon:a}=s;return!t&&!r&&!a&&e.some(o=>o===n)},_N=s=>{const{children:e,label:t,url:n,labelIcon:r}=s;return!!e&&!!n&&!!r&&!!t},TN=s=>{const{children:e,label:t,url:n,labelIcon:r}=s;return!e&&!!n&&!!r&&!!t},EG=(s,e)=>{var t;return PG({children:s,reorderItemsLabels:["manageAccount","signOut"],MenuItemsComponent:Rj,MenuActionComponent:q3,MenuLinkComponent:G3,UserProfileLinkComponent:ew,UserProfilePageComponent:J0,allowForAnyChildren:(t=e==null?void 0:e.allowForAnyChildren)!=null?t:!1})},PG=({children:s,MenuItemsComponent:e,MenuActionComponent:t,MenuLinkComponent:n,UserProfileLinkComponent:r,UserProfilePageComponent:a,reorderItemsLabels:o,allowForAnyChildren:l=!1})=>{const c=[],d=[],h=[];V.Children.forEach(s,g=>{if(!Nr(g,e)&&!Nr(g,r)&&!Nr(g,a)){g&&!l&&_r(mG);return}if(Nr(g,r)||Nr(g,a))return;const{props:b}=g;V.Children.forEach(b.children,v=>{if(!Nr(v,t)&&!Nr(v,n)){v&&_r(pG);return}const{props:y}=v,{label:w,labelIcon:S,href:j,onClick:A,open:k}=y;if(Nr(v,t))if(LR(y,o))c.push({label:w});else if(EN(y)){const _={label:w,labelIcon:S};if(A!==void 0)c.push({..._,onClick:A});else if(k!==void 0)c.push({..._,open:k.startsWith("/")?k:`/${k}`});else{_r("Custom menu item must have either onClick or open property");return}}else{_r(bG);return}if(Nr(v,n))if(PN(y))c.push({label:w,labelIcon:S,href:j});else{_r(vG);return}})});const f=[],m=[];c.forEach((g,b)=>{EN(g)&&f.push({component:g.labelIcon,id:b}),PN(g)&&m.push({component:g.labelIcon,id:b})});const p=rv(f),x=rv(m);return c.forEach((g,b)=>{if(LR(g,o)&&d.push({label:g.label}),EN(g)){const{portal:v,mount:y,unmount:w}=p.find(j=>j.id===b),S={label:g.label,mountIcon:y,unmountIcon:w};"onClick"in g?S.onClick=g.onClick:"open"in g&&(S.open=g.open),d.push(S),h.push(v)}if(PN(g)){const{portal:v,mount:y,unmount:w}=x.find(S=>S.id===b);d.push({label:g.label,href:g.href,mountIcon:y,unmountIcon:w}),h.push(v)}}),{customMenuItems:d,customMenuItemsPortals:h}},LR=(s,e)=>{const{children:t,label:n,onClick:r,labelIcon:a}=s;return!t&&!r&&!a&&e.some(o=>o===n)},EN=s=>{const{label:e,labelIcon:t,onClick:n,open:r}=s;return!!t&&!!e&&(typeof n=="function"||typeof r=="string")},PN=s=>{const{label:e,href:t,labelIcon:n}=s;return!!t&&!!n&&!!e},MG=s=>{const e=s==null?void 0:s.isReady;return t=>new Promise((n,r)=>{const{root:a=document==null?void 0:document.body,selector:o,timeout:l=0}=t;if(!a){r(new Error("No root element provided"));return}let c=a;if(o&&(c=a==null?void 0:a.querySelector(o)),e(c,o)){n();return}const d=new MutationObserver(h=>{for(const f of h)if(!c&&o&&(c=a==null?void 0:a.querySelector(o)),(s.childList&&f.type==="childList"||s.attributes&&f.type==="attributes")&&e(c,o)){d.disconnect(),n();return}});d.observe(a,s),l>0&&setTimeout(()=>{d.disconnect(),r(new Error(`Timeout waiting for ${o}`))},l)})},IG=MG({childList:!0,subtree:!0,isReady:(s,e)=>{var t;return!!(s!=null&&s.childElementCount)&&((t=s==null?void 0:s.matches)==null?void 0:t.call(s,e))&&s.childElementCount>0}});function di(s,e){const t=C.useRef(),[n,r]=C.useState("rendering");return C.useEffect(()=>{if(!s)throw new Error("Clerk: no component name provided, unable to detect mount.");if(typeof window<"u"&&!t.current){const a=`[data-clerk-component="${s}"]`,o=e==null?void 0:e.selector;t.current=IG({selector:o?a+o:a}).then(()=>{r("rendered")}).catch(()=>{r("error")})}},[s,e==null?void 0:e.selector]),n}var $w=s=>"mount"in s,OR=s=>"open"in s,FR=s=>s==null?void 0:s.map(({mountIcon:e,unmountIcon:t,...n})=>n),pr=class extends V.PureComponent{constructor(){super(...arguments),this.rootRef=V.createRef()}componentDidUpdate(s){var e,t,n,r;if(!$w(s)||!$w(this.props))return;const a=RR(s.props,"customPages","customMenuItems","children"),o=RR(this.props.props,"customPages","customMenuItems","children"),l=((e=a.customPages)==null?void 0:e.length)!==((t=o.customPages)==null?void 0:t.length),c=((n=a.customMenuItems)==null?void 0:n.length)!==((r=o.customMenuItems)==null?void 0:r.length),d=FR(s.props.customMenuItems),h=FR(this.props.props.customMenuItems);(!ER(a,o)||!ER(d,h)||l||c)&&this.rootRef.current&&this.props.updateProps({node:this.rootRef.current,props:this.props.props})}componentDidMount(){this.rootRef.current&&($w(this.props)&&this.props.mount(this.rootRef.current,this.props.props),OR(this.props)&&this.props.open(this.props.props))}componentWillUnmount(){this.rootRef.current&&($w(this.props)&&this.props.unmount(this.rootRef.current),OR(this.props)&&this.props.close())}render(){const{hideRootHtmlElement:s=!1}=this.props,e={ref:this.rootRef,...this.props.rootProps,...this.props.component&&{"data-clerk-component":this.props.component}};return V.createElement(V.Fragment,null,!s&&V.createElement("div",{...e}),this.props.children)}},Ij=s=>{var e,t;return V.createElement(V.Fragment,null,(e=s==null?void 0:s.customPagesPortals)==null?void 0:e.map((n,r)=>C.createElement(n,{key:r})),(t=s==null?void 0:s.customMenuItemsPortals)==null?void 0:t.map((n,r)=>C.createElement(n,{key:r})))};js(({clerk:s,component:e,fallback:t,...n})=>{const a=di(e)==="rendering"||!s.loaded,o={...a&&t&&{style:{display:"none"}}};return V.createElement(V.Fragment,null,a&&t,s.loaded&&V.createElement(pr,{component:e,mount:s.mountSignIn,unmount:s.unmountSignIn,updateProps:s.__unstable__updateProps,props:n,rootProps:o}))},{component:"SignIn",renderWhileLoading:!0});js(({clerk:s,component:e,fallback:t,...n})=>{const a=di(e)==="rendering"||!s.loaded,o={...a&&t&&{style:{display:"none"}}};return V.createElement(V.Fragment,null,a&&t,s.loaded&&V.createElement(pr,{component:e,mount:s.mountSignUp,unmount:s.unmountSignUp,updateProps:s.__unstable__updateProps,props:n,rootProps:o}))},{component:"SignUp",renderWhileLoading:!0});function J0({children:s}){return _r(oG),V.createElement(V.Fragment,null,s)}function ew({children:s}){return _r(lG),V.createElement(V.Fragment,null,s)}var RG=js(({clerk:s,component:e,fallback:t,...n})=>{const a=di(e)==="rendering"||!s.loaded,o={...a&&t&&{style:{display:"none"}}},{customPages:l,customPagesPortals:c}=U3(n.children);return V.createElement(V.Fragment,null,a&&t,V.createElement(pr,{component:e,mount:s.mountUserProfile,unmount:s.unmountUserProfile,updateProps:s.__unstable__updateProps,props:{...n,customPages:l},rootProps:o},V.createElement(Ij,{customPagesPortals:c})))},{component:"UserProfile",renderWhileLoading:!0});Object.assign(RG,{Page:J0,Link:ew});var W3=C.createContext({mount:()=>{},unmount:()=>{},updateProps:()=>{}}),DG=js(({clerk:s,component:e,fallback:t,...n})=>{const a=di(e)==="rendering"||!s.loaded,o={...a&&t&&{style:{display:"none"}}},{customPages:l,customPagesPortals:c}=U3(n.children,{allowForAnyChildren:!!n.__experimental_asProvider}),d=Object.assign(n.userProfileProps||{},{customPages:l}),{customMenuItems:h,customMenuItemsPortals:f}=EG(n.children,{allowForAnyChildren:!!n.__experimental_asProvider}),m=H3(n.children),p={mount:s.mountUserButton,unmount:s.unmountUserButton,updateProps:s.__unstable__updateProps,props:{...n,userProfileProps:d,customMenuItems:h}},x={customPagesPortals:c,customMenuItemsPortals:f};return V.createElement(W3.Provider,{value:p},a&&t,s.loaded&&V.createElement(pr,{component:e,...p,hideRootHtmlElement:!!n.__experimental_asProvider,rootProps:o},n.__experimental_asProvider?m:null,V.createElement(Ij,{...x})))},{component:"UserButton",renderWhileLoading:!0});function Rj({children:s}){return _r(gG),V.createElement(V.Fragment,null,s)}function q3({children:s}){return _r(xG),V.createElement(V.Fragment,null,s)}function G3({children:s}){return _r(yG),V.createElement(V.Fragment,null,s)}function LG(s){const e=C.useContext(W3),t={...e,props:{...e.props,...s}};return V.createElement(pr,{...t})}var OG=Object.assign(DG,{UserProfilePage:J0,UserProfileLink:ew,MenuItems:Rj,Action:q3,Link:G3,__experimental_Outlet:LG});function Dj({children:s}){return _r(cG),V.createElement(V.Fragment,null,s)}function Lj({children:s}){return _r(dG),V.createElement(V.Fragment,null,s)}var FG=js(({clerk:s,component:e,fallback:t,...n})=>{const a=di(e)==="rendering"||!s.loaded,o={...a&&t&&{style:{display:"none"}}},{customPages:l,customPagesPortals:c}=z3(n.children);return V.createElement(V.Fragment,null,a&&t,s.loaded&&V.createElement(pr,{component:e,mount:s.mountOrganizationProfile,unmount:s.unmountOrganizationProfile,updateProps:s.__unstable__updateProps,props:{...n,customPages:l},rootProps:o},V.createElement(Ij,{customPagesPortals:c})))},{component:"OrganizationProfile",renderWhileLoading:!0});Object.assign(FG,{Page:Dj,Link:Lj});js(({clerk:s,component:e,fallback:t,...n})=>{const a=di(e)==="rendering"||!s.loaded,o={...a&&t&&{style:{display:"none"}}};return V.createElement(V.Fragment,null,a&&t,s.loaded&&V.createElement(pr,{component:e,mount:s.mountCreateOrganization,unmount:s.unmountCreateOrganization,updateProps:s.__unstable__updateProps,props:n,rootProps:o}))},{component:"CreateOrganization",renderWhileLoading:!0});var Y3=C.createContext({mount:()=>{},unmount:()=>{},updateProps:()=>{}}),BG=js(({clerk:s,component:e,fallback:t,...n})=>{const a=di(e)==="rendering"||!s.loaded,o={...a&&t&&{style:{display:"none"}}},{customPages:l,customPagesPortals:c}=z3(n.children,{allowForAnyChildren:!!n.__experimental_asProvider}),d=Object.assign(n.organizationProfileProps||{},{customPages:l}),h=H3(n.children),f={mount:s.mountOrganizationSwitcher,unmount:s.unmountOrganizationSwitcher,updateProps:s.__unstable__updateProps,props:{...n,organizationProfileProps:d},rootProps:o,component:e};return s.__experimental_prefetchOrganizationSwitcher(),V.createElement(Y3.Provider,{value:f},V.createElement(V.Fragment,null,a&&t,s.loaded&&V.createElement(pr,{...f,hideRootHtmlElement:!!n.__experimental_asProvider},n.__experimental_asProvider?h:null,V.createElement(Ij,{customPagesPortals:c}))))},{component:"OrganizationSwitcher",renderWhileLoading:!0});function $G(s){const e=C.useContext(Y3),t={...e,props:{...e.props,...s}};return V.createElement(pr,{...t})}Object.assign(BG,{OrganizationProfilePage:Dj,OrganizationProfileLink:Lj,__experimental_Outlet:$G});js(({clerk:s,component:e,fallback:t,...n})=>{const a=di(e)==="rendering"||!s.loaded,o={...a&&t&&{style:{display:"none"}}};return V.createElement(V.Fragment,null,a&&t,s.loaded&&V.createElement(pr,{component:e,mount:s.mountOrganizationList,unmount:s.unmountOrganizationList,updateProps:s.__unstable__updateProps,props:n,rootProps:o}))},{component:"OrganizationList",renderWhileLoading:!0});js(({clerk:s,component:e,fallback:t,...n})=>{const a=di(e)==="rendering"||!s.loaded,o={...a&&t&&{style:{display:"none"}}};return V.createElement(V.Fragment,null,a&&t,s.loaded&&V.createElement(pr,{component:e,open:s.openGoogleOneTap,close:s.closeGoogleOneTap,updateProps:s.__unstable__updateProps,props:n,rootProps:o}))},{component:"GoogleOneTap",renderWhileLoading:!0});js(({clerk:s,component:e,fallback:t,...n})=>{const a=di(e)==="rendering"||!s.loaded,o={...a&&t&&{style:{display:"none"}}};return V.createElement(V.Fragment,null,a&&t,s.loaded&&V.createElement(pr,{component:e,mount:s.mountWaitlist,unmount:s.unmountWaitlist,updateProps:s.__unstable__updateProps,props:n,rootProps:o}))},{component:"Waitlist",renderWhileLoading:!0});js(({clerk:s,component:e,fallback:t,...n})=>{const a=di(e,{selector:'[data-component-status="ready"]'})==="rendering"||!s.loaded,o={...a&&t&&{style:{display:"none"}}};return V.createElement(V.Fragment,null,a&&t,s.loaded&&V.createElement(pr,{component:e,mount:s.mountPricingTable,unmount:s.unmountPricingTable,updateProps:s.__unstable__updateProps,props:n,rootProps:o}))},{component:"PricingTable",renderWhileLoading:!0});js(({clerk:s,component:e,fallback:t,...n})=>{const a=di(e)==="rendering"||!s.loaded,o={...a&&t&&{style:{display:"none"}}};return V.createElement(V.Fragment,null,a&&t,s.loaded&&V.createElement(pr,{component:e,mount:s.mountAPIKeys,unmount:s.unmountAPIKeys,updateProps:s.__unstable__updateProps,props:n,rootProps:o}))},{component:"ApiKeys",renderWhileLoading:!0});js(({clerk:s,component:e,fallback:t,...n})=>{const a=di(e)==="rendering"||!s.loaded,o={...a&&t&&{style:{display:"none"}}};return V.createElement(V.Fragment,null,a&&t,s.loaded&&V.createElement(pr,{component:e,mount:s.mountUserAvatar,unmount:s.unmountUserAvatar,updateProps:s.__unstable__updateProps,props:n,rootProps:o}))},{component:"UserAvatar",renderWhileLoading:!0});js(({clerk:s,component:e,fallback:t,...n})=>{const a=di(e)==="rendering"||!s.loaded,o={...a&&t&&{style:{display:"none"}}};return V.createElement(V.Fragment,null,a&&t,s.loaded&&V.createElement(pr,{component:e,mount:s.mountTaskChooseOrganization,unmount:s.unmountTaskChooseOrganization,updateProps:s.__unstable__updateProps,props:n,rootProps:o}))},{component:"TaskChooseOrganization",renderWhileLoading:!0});var K3=s=>{throw TypeError(s)},mP=(s,e,t)=>e.has(s)||K3("Cannot "+t),xs=(s,e,t)=>(mP(s,e,"read from private field"),t?t.call(s):e.get(s)),td=(s,e,t)=>e.has(s)?K3("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t),nh=(s,e,t,n)=>(mP(s,e,"write to private field"),e.set(s,t),t),MN=(s,e,t)=>(mP(s,e,"access private method"),t);const UG={initialDelay:125,maxDelayBetweenRetries:0,factor:2,shouldRetry:(s,e)=>e<5,retryImmediately:!1,jitter:!0},zG=100,X3=async s=>new Promise(e=>setTimeout(e,s)),Q3=(s,e)=>e?s*(1+Math.random()):s,HG=s=>{let e=0;const t=()=>{const n=s.initialDelay,r=s.factor;let a=n*Math.pow(r,e);return a=Q3(a,s.jitter),Math.min(s.maxDelayBetweenRetries||a,a)};return async()=>{await X3(t()),e++}},VG=async(s,e={})=>{let t=0;const{shouldRetry:n,initialDelay:r,maxDelayBetweenRetries:a,factor:o,retryImmediately:l,jitter:c,onBeforeRetry:d}={...UG,...e},h=HG({initialDelay:r,maxDelayBetweenRetries:a,factor:o,jitter:c});for(;;)try{return await s()}catch(f){if(t++,!n(f,t))throw f;d&&await d(t),l&&t===1?await X3(Q3(zG,c)):await h()}},WG="loadScript cannot be called when document does not exist",qG="loadScript cannot be called without a src";async function GG(s="",e){const{async:t,defer:n,beforeLoad:r,crossOrigin:a,nonce:o}=e||{};return VG(()=>new Promise((c,d)=>{s||d(new Error(qG)),(!document||!document.body)&&d(new Error(WG));const h=document.createElement("script");a&&h.setAttribute("crossorigin",a),h.async=t||!1,h.defer=n||!1,h.addEventListener("load",()=>{h.remove(),c(h)}),h.addEventListener("error",f=>{h.remove(),d(f.error??new Error(`failed to load script: ${s}`))}),h.src=s,h.nonce=o,r==null||r(h),document.body.appendChild(h)}),{shouldRetry:(c,d)=>d<=5})}function YG(s){return s?KG(s)||Z3(s):!0}function KG(s){return/^http(s)?:\/\//.test(s||"")}function Z3(s){return s.startsWith("/")}function XG(s){return s?Z3(s)?new URL(s,window.location.origin).toString():s:""}function QG(s){if(!s)return"";let e;if(s.match(/^(clerk\.)+\w*$/))e=/(clerk\.)*(?=clerk\.)/;else{if(s.match(/\.clerk.accounts/))return s;e=/^(clerk\.)*/gi}return`clerk.${s.replace(e,"")}`}const ZG=(s,e="5.110.0")=>{if(s)return s;const t=JG(e);return t?t==="snapshot"?"5.110.0":t:eY(e)},JG=s=>{var e;return(e=s.trim().replace(/^v/,"").match(/-(.+?)(\.|$)/))==null?void 0:e[1]},eY=s=>s.trim().replace(/^v/,"").split(".")[0],tY="failed_to_load_clerk_js",sY="failed_to_load_clerk_js_timeout",J3="Failed to load Clerk",{isDevOrStagingUrl:nY}=Z9(),eB=C3({packageName:"@clerk/shared"});function rY(s){eB.setPackageName({packageName:s})}function I_(){if(typeof window>"u"||!window.Clerk)return!1;const s=window.Clerk;return typeof s=="object"&&typeof s.load=="function"}function BR(s){return new Promise((e,t)=>{let n=!1;const r=(d,h)=>{clearTimeout(d),clearInterval(h)},a=()=>{n||I_()&&(n=!0,r(l,c),e(null))},l=setTimeout(()=>{n||(n=!0,r(l,c),I_()?e(null):t(new S3(J3,{code:sY})))},s);a();const c=setInterval(()=>{if(n){clearInterval(c);return}a()},100)})}const iY=async s=>{const e=(s==null?void 0:s.scriptLoadTimeout)??15e3;if(I_())return null;if(document.querySelector("script[data-clerk-js-script]"))return BR(e);if(!(s!=null&&s.publishableKey))return eB.throwMissingPublishableKeyError(),null;const t=BR(e);return GG(aY(s),{async:!0,crossOrigin:"anonymous",nonce:s.nonce,beforeLoad:lY(s)}).catch(n=>{throw new S3(J3+(n.message?`, ${n.message}`:""),{code:tY,cause:n})}),t},aY=s=>{var h,f;const{clerkJSUrl:e,clerkJSVariant:t,clerkJSVersion:n,proxyUrl:r,domain:a,publishableKey:o}=s;if(e)return e;let l="";r&&YG(r)?l=XG(r).replace(/http(s)?:\/\//,""):a&&!nY(((h=wR(o))==null?void 0:h.frontendApi)||"")?l=QG(a):l=((f=wR(o))==null?void 0:f.frontendApi)||"";const c=t?`${t.replace(/\.+$/,"")}.`:"",d=ZG(n);return`https://${l}/npm/@clerk/clerk-js@${d}/dist/clerk.${c}browser.js`},oY=s=>{const e={};return s.publishableKey&&(e["data-clerk-publishable-key"]=s.publishableKey),s.proxyUrl&&(e["data-clerk-proxy-url"]=s.proxyUrl),s.domain&&(e["data-clerk-domain"]=s.domain),s.nonce&&(e.nonce=s.nonce),e},lY=s=>e=>{const t=oY(s);for(const n in t)e.setAttribute(n,t[n])},cY=(s,e,t)=>!s&&t?dY(t):uY(e),dY=s=>{const e=s.userId,t=s.user,n=s.sessionId,r=s.sessionStatus,a=s.sessionClaims;return{userId:e,user:t,sessionId:n,session:s.session,sessionStatus:r,sessionClaims:a,organization:s.organization,orgId:s.orgId,orgRole:s.orgRole,orgPermissions:s.orgPermissions,orgSlug:s.orgSlug,actor:s.actor,factorVerificationAge:s.factorVerificationAge}},uY=s=>{var x,g,b,v;const e=s.user?s.user.id:s.user,t=s.user,n=s.session?s.session.id:s.session,r=s.session,a=(x=s.session)==null?void 0:x.status,o=s.session?(b=(g=s.session.lastActiveToken)==null?void 0:g.jwt)==null?void 0:b.claims:null,l=s.session?s.session.factorVerificationAge:null,c=r==null?void 0:r.actor,d=s.organization,h=s.organization?s.organization.id:s.organization,f=d==null?void 0:d.slug,m=d&&((v=t==null?void 0:t.organizationMemberships)==null?void 0:v.find(y=>y.organization.id===h)),p=m&&m.permissions;return{userId:e,user:t,sessionId:n,session:r,sessionStatus:a,sessionClaims:o,organization:d,orgId:h,orgRole:m&&m.role,orgSlug:f,orgPermissions:p,actor:c,factorVerificationAge:l}};function KC(){return typeof window<"u"}const $R=(s,e,t,n,r)=>{const{notify:a}=r||{};let o=s.get(t);o||(o=[],s.set(t,o)),o.push(n),a&&e.has(t)&&n(e.get(t))},UR=(s,e,t)=>(s.get(e)||[]).map(n=>n(t)),zR=(s,e,t)=>{const n=s.get(e);n&&(t?n.splice(n.indexOf(t)>>>0,1):s.set(e,[]))},hY=()=>{const s=new Map,e=new Map,t=new Map;return{on:(...r)=>$R(s,e,...r),prioritizedOn:(...r)=>$R(t,e,...r),emit:(r,a)=>{e.set(r,a),UR(t,r,a),UR(s,r,a)},off:(...r)=>zR(s,...r),prioritizedOff:(...r)=>zR(t,...r),internal:{retrieveListeners:r=>s.get(r)||[]}}},Uw={Status:"status"},fY=()=>hY();typeof window<"u"&&!window.global&&(window.global=typeof globalThis>"u"?window:globalThis);var R_=js(({clerk:s,children:e,...t})=>{const{signUpFallbackRedirectUrl:n,forceRedirectUrl:r,fallbackRedirectUrl:a,signUpForceRedirectUrl:o,mode:l,initialValues:c,withSignUp:d,oauthFlow:h,...f}=t;e=Pj(e,"Sign in");const m=Ej(e)("SignInButton"),p=()=>{const b={forceRedirectUrl:r,fallbackRedirectUrl:a,signUpFallbackRedirectUrl:n,signUpForceRedirectUrl:o,initialValues:c,withSignUp:d,oauthFlow:h};return l==="modal"?s.openSignIn({...b,appearance:t.appearance}):s.redirectToSignIn({...b,signInFallbackRedirectUrl:a,signInForceRedirectUrl:r})},g={...f,onClick:async b=>(m&&typeof m=="object"&&"props"in m&&await Mj(m.props.onClick)(b),p())};return V.cloneElement(m,g)},{component:"SignInButton",renderWhileLoading:!0});js(({clerk:s,children:e,...t})=>{const{redirectUrl:n,...r}=t;e=Pj(e,"Sign in with Metamask");const a=Ej(e)("SignInWithMetamaskButton"),o=async()=>{async function d(){await s.authenticateWithMetamask({redirectUrl:n||void 0})}d()},c={...r,onClick:async d=>(await Mj(a.props.onClick)(d),o())};return V.cloneElement(a,c)},{component:"SignInWithMetamask",renderWhileLoading:!0});js(({clerk:s,children:e,...t})=>{const{redirectUrl:n="/",signOutOptions:r,...a}=t;e=Pj(e,"Sign out");const o=Ej(e)("SignOutButton"),l=()=>s.signOut({redirectUrl:n,...r}),d={...a,onClick:async h=>(await Mj(o.props.onClick)(h),l())};return V.cloneElement(o,d)},{component:"SignOutButton",renderWhileLoading:!0});js(({clerk:s,children:e,...t})=>{const{fallbackRedirectUrl:n,forceRedirectUrl:r,signInFallbackRedirectUrl:a,signInForceRedirectUrl:o,mode:l,initialValues:c,oauthFlow:d,...h}=t;e=Pj(e,"Sign up");const f=Ej(e)("SignUpButton"),m=()=>{const g={fallbackRedirectUrl:n,forceRedirectUrl:r,signInFallbackRedirectUrl:a,signInForceRedirectUrl:o,initialValues:c,oauthFlow:d};return l==="modal"?s.openSignUp({...g,appearance:t.appearance,unsafeMetadata:t.unsafeMetadata}):s.redirectToSignUp({...g,signUpFallbackRedirectUrl:n,signUpForceRedirectUrl:r})},x={...h,onClick:async g=>(f&&typeof f=="object"&&"props"in f&&await Mj(f.props.onClick)(g),m())};return V.cloneElement(f,x)},{component:"SignUpButton",renderWhileLoading:!0});var mY=()=>({fields:{identifier:null,password:null,code:null},raw:null,global:null}),pY=()=>({fields:{firstName:null,lastName:null,emailAddress:null,phoneNumber:null,password:null,username:null,code:null,captcha:null,legalAccepted:null},raw:null,global:null}),gY=class{constructor(s){this.isomorphicClerk=s,this.signInSignalProxy=this.buildSignInProxy(),this.signUpSignalProxy=this.buildSignUpProxy()}signInSignal(){return this.signInSignalProxy}signUpSignal(){return this.signUpSignalProxy}buildSignInProxy(){const s=this.gateProperty.bind(this),e=()=>this.client.signIn.__internal_future;return{errors:mY(),fetchStatus:"idle",signIn:{status:"needs_identifier",availableStrategies:[],isTransferable:!1,get id(){return s(e,"id",void 0)},get supportedFirstFactors(){return s(e,"supportedFirstFactors",[])},get supportedSecondFactors(){return s(e,"supportedSecondFactors",[])},get secondFactorVerification(){return s(e,"secondFactorVerification",{status:null,error:null,expireAt:null,externalVerificationRedirectURL:null,nonce:null,attempts:null,message:null,strategy:null,verifiedAtClient:null,verifiedFromTheSameClient:()=>!1,__internal_toSnapshot:()=>{throw new Error("__internal_toSnapshot called before Clerk is loaded")},pathRoot:"",reload:()=>{throw new Error("__internal_toSnapshot called before Clerk is loaded")}})},get identifier(){return s(e,"identifier",null)},get createdSessionId(){return s(e,"createdSessionId",null)},get userData(){return s(e,"userData",{})},get firstFactorVerification(){return s(e,"firstFactorVerification",{status:null,error:null,expireAt:null,externalVerificationRedirectURL:null,nonce:null,attempts:null,message:null,strategy:null,verifiedAtClient:null,verifiedFromTheSameClient:()=>!1,__internal_toSnapshot:()=>{throw new Error("__internal_toSnapshot called before Clerk is loaded")},pathRoot:"",reload:()=>{throw new Error("__internal_toSnapshot called before Clerk is loaded")}})},create:this.gateMethod(e,"create"),password:this.gateMethod(e,"password"),sso:this.gateMethod(e,"sso"),finalize:this.gateMethod(e,"finalize"),emailCode:this.wrapMethods(()=>e().emailCode,["sendCode","verifyCode"]),emailLink:this.wrapStruct(()=>e().emailLink,["sendLink","waitForVerification"],["verification"],{verification:null}),resetPasswordEmailCode:this.wrapMethods(()=>e().resetPasswordEmailCode,["sendCode","verifyCode","submitPassword"]),phoneCode:this.wrapMethods(()=>e().phoneCode,["sendCode","verifyCode"]),mfa:this.wrapMethods(()=>e().mfa,["sendPhoneCode","verifyPhoneCode","verifyTOTP","verifyBackupCode"]),ticket:this.gateMethod(e,"ticket"),passkey:this.gateMethod(e,"passkey"),web3:this.gateMethod(e,"web3")}}}buildSignUpProxy(){const s=this.gateProperty.bind(this),e=this.gateMethod.bind(this),t=this.wrapMethods.bind(this),n=()=>this.client.signUp.__internal_future;return{errors:pY(),fetchStatus:"idle",signUp:{get id(){return s(n,"id",void 0)},get requiredFields(){return s(n,"requiredFields",[])},get optionalFields(){return s(n,"optionalFields",[])},get missingFields(){return s(n,"missingFields",[])},get username(){return s(n,"username",null)},get firstName(){return s(n,"firstName",null)},get lastName(){return s(n,"lastName",null)},get emailAddress(){return s(n,"emailAddress",null)},get phoneNumber(){return s(n,"phoneNumber",null)},get web3Wallet(){return s(n,"web3Wallet",null)},get hasPassword(){return s(n,"hasPassword",!1)},get unsafeMetadata(){return s(n,"unsafeMetadata",{})},get createdSessionId(){return s(n,"createdSessionId",null)},get createdUserId(){return s(n,"createdUserId",null)},get abandonAt(){return s(n,"abandonAt",null)},get legalAcceptedAt(){return s(n,"legalAcceptedAt",null)},get locale(){return s(n,"locale",null)},get status(){return s(n,"status","missing_requirements")},get unverifiedFields(){return s(n,"unverifiedFields",[])},get isTransferable(){return s(n,"isTransferable",!1)},create:e(n,"create"),update:e(n,"update"),sso:e(n,"sso"),password:e(n,"password"),ticket:e(n,"ticket"),web3:e(n,"web3"),finalize:e(n,"finalize"),verifications:t(()=>n().verifications,["sendEmailCode","verifyEmailCode","sendPhoneCode","verifyPhoneCode"])}}}__internal_effect(s){throw new Error("__internal_effect called before Clerk is loaded")}__internal_computed(s){throw new Error("__internal_computed called before Clerk is loaded")}get client(){const s=this.isomorphicClerk.client;if(!s)throw new Error("Clerk client not ready");return s}gateProperty(s,e,t){return!KC()||!this.isomorphicClerk.loaded?t:s()[e]}gateMethod(s,e){return async(...t)=>{if(!KC())return bo.throw(`Attempted to call a method (${e}) that is not supported on the server.`);this.isomorphicClerk.loaded||await new Promise(r=>this.isomorphicClerk.addOnLoaded(r));const n=s();return n[e].apply(n,t)}}wrapMethods(s,e){return Object.fromEntries(e.map(t=>[t,this.gateMethod(s,t)]))}wrapStruct(s,e,t,n){const r={};for(const a of e)r[a]=this.gateMethod(s,a);for(const a of t)Object.defineProperty(r,a,{get:()=>this.gateProperty(s,a,n[a]),enumerable:!0});return r}};typeof globalThis.__BUILD_DISABLE_RHC__>"u"&&(globalThis.__BUILD_DISABLE_RHC__=!1);var xY={name:"@clerk/clerk-react",version:"5.57.0",environment:"production"},A1,Bm,$m,sd,Ro,_1,ld,xy,T1,tB=class sB{constructor(e){td(this,xy),this.clerkjs=null,this.preopenOneTap=null,this.preopenUserVerification=null,this.preopenEnableOrganizationsPrompt=null,this.preopenSignIn=null,this.preopenCheckout=null,this.preopenPlanDetails=null,this.preopenSubscriptionDetails=null,this.preopenSignUp=null,this.preopenUserProfile=null,this.preopenOrganizationProfile=null,this.preopenCreateOrganization=null,this.preOpenWaitlist=null,this.premountSignInNodes=new Map,this.premountSignUpNodes=new Map,this.premountUserAvatarNodes=new Map,this.premountUserProfileNodes=new Map,this.premountUserButtonNodes=new Map,this.premountOrganizationProfileNodes=new Map,this.premountCreateOrganizationNodes=new Map,this.premountOrganizationSwitcherNodes=new Map,this.premountOrganizationListNodes=new Map,this.premountMethodCalls=new Map,this.premountWaitlistNodes=new Map,this.premountPricingTableNodes=new Map,this.premountAPIKeysNodes=new Map,this.premountOAuthConsentNodes=new Map,this.premountTaskChooseOrganizationNodes=new Map,this.premountAddListenerCalls=new Map,this.loadedListeners=[],td(this,A1,"loading"),td(this,Bm),td(this,$m),td(this,sd),td(this,Ro,fY()),td(this,_1),this.buildSignInUrl=r=>{const a=()=>{var o;return((o=this.clerkjs)==null?void 0:o.buildSignInUrl(r))||""};if(this.clerkjs&&this.loaded)return a();this.premountMethodCalls.set("buildSignInUrl",a)},this.buildSignUpUrl=r=>{const a=()=>{var o;return((o=this.clerkjs)==null?void 0:o.buildSignUpUrl(r))||""};if(this.clerkjs&&this.loaded)return a();this.premountMethodCalls.set("buildSignUpUrl",a)},this.buildAfterSignInUrl=(...r)=>{const a=()=>{var o;return((o=this.clerkjs)==null?void 0:o.buildAfterSignInUrl(...r))||""};if(this.clerkjs&&this.loaded)return a();this.premountMethodCalls.set("buildAfterSignInUrl",a)},this.buildAfterSignUpUrl=(...r)=>{const a=()=>{var o;return((o=this.clerkjs)==null?void 0:o.buildAfterSignUpUrl(...r))||""};if(this.clerkjs&&this.loaded)return a();this.premountMethodCalls.set("buildAfterSignUpUrl",a)},this.buildAfterSignOutUrl=()=>{const r=()=>{var a;return((a=this.clerkjs)==null?void 0:a.buildAfterSignOutUrl())||""};if(this.clerkjs&&this.loaded)return r();this.premountMethodCalls.set("buildAfterSignOutUrl",r)},this.buildNewSubscriptionRedirectUrl=()=>{const r=()=>{var a;return((a=this.clerkjs)==null?void 0:a.buildNewSubscriptionRedirectUrl())||""};if(this.clerkjs&&this.loaded)return r();this.premountMethodCalls.set("buildNewSubscriptionRedirectUrl",r)},this.buildAfterMultiSessionSingleSignOutUrl=()=>{const r=()=>{var a;return((a=this.clerkjs)==null?void 0:a.buildAfterMultiSessionSingleSignOutUrl())||""};if(this.clerkjs&&this.loaded)return r();this.premountMethodCalls.set("buildAfterMultiSessionSingleSignOutUrl",r)},this.buildUserProfileUrl=()=>{const r=()=>{var a;return((a=this.clerkjs)==null?void 0:a.buildUserProfileUrl())||""};if(this.clerkjs&&this.loaded)return r();this.premountMethodCalls.set("buildUserProfileUrl",r)},this.buildCreateOrganizationUrl=()=>{const r=()=>{var a;return((a=this.clerkjs)==null?void 0:a.buildCreateOrganizationUrl())||""};if(this.clerkjs&&this.loaded)return r();this.premountMethodCalls.set("buildCreateOrganizationUrl",r)},this.buildOrganizationProfileUrl=()=>{const r=()=>{var a;return((a=this.clerkjs)==null?void 0:a.buildOrganizationProfileUrl())||""};if(this.clerkjs&&this.loaded)return r();this.premountMethodCalls.set("buildOrganizationProfileUrl",r)},this.buildWaitlistUrl=()=>{const r=()=>{var a;return((a=this.clerkjs)==null?void 0:a.buildWaitlistUrl())||""};if(this.clerkjs&&this.loaded)return r();this.premountMethodCalls.set("buildWaitlistUrl",r)},this.buildTasksUrl=()=>{const r=()=>{var a;return((a=this.clerkjs)==null?void 0:a.buildTasksUrl())||""};if(this.clerkjs&&this.loaded)return r();this.premountMethodCalls.set("buildTasksUrl",r)},this.buildUrlWithAuth=r=>{const a=()=>{var o;return((o=this.clerkjs)==null?void 0:o.buildUrlWithAuth(r))||""};if(this.clerkjs&&this.loaded)return a();this.premountMethodCalls.set("buildUrlWithAuth",a)},this.handleUnauthenticated=async()=>{const r=()=>{var a;return(a=this.clerkjs)==null?void 0:a.handleUnauthenticated()};this.clerkjs&&this.loaded?r():this.premountMethodCalls.set("handleUnauthenticated",r)},this.on=(...r)=>{var a;if((a=this.clerkjs)!=null&&a.on)return this.clerkjs.on(...r);xs(this,Ro).on(...r)},this.off=(...r)=>{var a;if((a=this.clerkjs)!=null&&a.off)return this.clerkjs.off(...r);xs(this,Ro).off(...r)},this.addOnLoaded=r=>{this.loadedListeners.push(r),this.loaded&&this.emitLoaded()},this.emitLoaded=()=>{this.loadedListeners.forEach(r=>r()),this.loadedListeners=[]},this.beforeLoad=r=>{if(!r)throw new Error("Failed to hydrate latest Clerk JS")},this.hydrateClerkJS=r=>{var a,o;if(!r)throw new Error("Failed to hydrate latest Clerk JS");return this.clerkjs=r,this.premountMethodCalls.forEach(l=>l()),this.premountAddListenerCalls.forEach((l,c)=>{l.nativeUnsubscribe=r.addListener(c)}),(a=xs(this,Ro).internal.retrieveListeners("status"))==null||a.forEach(l=>{this.on("status",l,{notify:!0})}),(o=xs(this,Ro).internal.retrieveListeners("queryClientStatus"))==null||o.forEach(l=>{this.on("queryClientStatus",l,{notify:!0})}),this.preopenSignIn!==null&&r.openSignIn(this.preopenSignIn),this.preopenCheckout!==null&&r.__internal_openCheckout(this.preopenCheckout),this.preopenPlanDetails!==null&&r.__internal_openPlanDetails(this.preopenPlanDetails),this.preopenSubscriptionDetails!==null&&r.__internal_openSubscriptionDetails(this.preopenSubscriptionDetails),this.preopenSignUp!==null&&r.openSignUp(this.preopenSignUp),this.preopenUserProfile!==null&&r.openUserProfile(this.preopenUserProfile),this.preopenUserVerification!==null&&r.__internal_openReverification(this.preopenUserVerification),this.preopenOneTap!==null&&r.openGoogleOneTap(this.preopenOneTap),this.preopenOrganizationProfile!==null&&r.openOrganizationProfile(this.preopenOrganizationProfile),this.preopenCreateOrganization!==null&&r.openCreateOrganization(this.preopenCreateOrganization),this.preOpenWaitlist!==null&&r.openWaitlist(this.preOpenWaitlist),this.preopenEnableOrganizationsPrompt&&r.__internal_openEnableOrganizationsPrompt(this.preopenEnableOrganizationsPrompt),this.premountSignInNodes.forEach((l,c)=>{r.mountSignIn(c,l)}),this.premountSignUpNodes.forEach((l,c)=>{r.mountSignUp(c,l)}),this.premountUserProfileNodes.forEach((l,c)=>{r.mountUserProfile(c,l)}),this.premountUserAvatarNodes.forEach((l,c)=>{r.mountUserAvatar(c,l)}),this.premountUserButtonNodes.forEach((l,c)=>{r.mountUserButton(c,l)}),this.premountOrganizationListNodes.forEach((l,c)=>{r.mountOrganizationList(c,l)}),this.premountWaitlistNodes.forEach((l,c)=>{r.mountWaitlist(c,l)}),this.premountPricingTableNodes.forEach((l,c)=>{r.mountPricingTable(c,l)}),this.premountAPIKeysNodes.forEach((l,c)=>{r.mountAPIKeys(c,l)}),this.premountOAuthConsentNodes.forEach((l,c)=>{r.__internal_mountOAuthConsent(c,l)}),this.premountTaskChooseOrganizationNodes.forEach((l,c)=>{r.mountTaskChooseOrganization(c,l)}),typeof this.clerkjs.status>"u"&&xs(this,Ro).emit(Uw.Status,"ready"),this.emitLoaded(),this.clerkjs},this.__experimental_checkout=(...r)=>{var a;return(a=this.clerkjs)==null?void 0:a.__experimental_checkout(...r)},this.__unstable__updateProps=async r=>{const a=await MN(this,xy,T1).call(this);if(a&&"__unstable__updateProps"in a)return a.__unstable__updateProps(r)},this.setActive=r=>this.clerkjs?this.clerkjs.setActive(r):Promise.reject(),this.openSignIn=r=>{this.clerkjs&&this.loaded?this.clerkjs.openSignIn(r):this.preopenSignIn=r},this.closeSignIn=()=>{this.clerkjs&&this.loaded?this.clerkjs.closeSignIn():this.preopenSignIn=null},this.__internal_openCheckout=r=>{this.clerkjs&&this.loaded?this.clerkjs.__internal_openCheckout(r):this.preopenCheckout=r},this.__internal_closeCheckout=()=>{this.clerkjs&&this.loaded?this.clerkjs.__internal_closeCheckout():this.preopenCheckout=null},this.__internal_openPlanDetails=r=>{this.clerkjs&&this.loaded?this.clerkjs.__internal_openPlanDetails(r):this.preopenPlanDetails=r},this.__internal_closePlanDetails=()=>{this.clerkjs&&this.loaded?this.clerkjs.__internal_closePlanDetails():this.preopenPlanDetails=null},this.__internal_openSubscriptionDetails=r=>{this.clerkjs&&this.loaded?this.clerkjs.__internal_openSubscriptionDetails(r):this.preopenSubscriptionDetails=r??null},this.__internal_closeSubscriptionDetails=()=>{this.clerkjs&&this.loaded?this.clerkjs.__internal_closeSubscriptionDetails():this.preopenSubscriptionDetails=null},this.__internal_openReverification=r=>{this.clerkjs&&this.loaded?this.clerkjs.__internal_openReverification(r):this.preopenUserVerification=r},this.__internal_closeReverification=()=>{this.clerkjs&&this.loaded?this.clerkjs.__internal_closeReverification():this.preopenUserVerification=null},this.__internal_openEnableOrganizationsPrompt=r=>{this.clerkjs&&this.loaded?this.clerkjs.__internal_openEnableOrganizationsPrompt(r):this.preopenEnableOrganizationsPrompt=r},this.__internal_closeEnableOrganizationsPrompt=()=>{this.clerkjs&&this.loaded?this.clerkjs.__internal_closeEnableOrganizationsPrompt():this.preopenEnableOrganizationsPrompt=null},this.openGoogleOneTap=r=>{this.clerkjs&&this.loaded?this.clerkjs.openGoogleOneTap(r):this.preopenOneTap=r},this.closeGoogleOneTap=()=>{this.clerkjs&&this.loaded?this.clerkjs.closeGoogleOneTap():this.preopenOneTap=null},this.openUserProfile=r=>{this.clerkjs&&this.loaded?this.clerkjs.openUserProfile(r):this.preopenUserProfile=r},this.closeUserProfile=()=>{this.clerkjs&&this.loaded?this.clerkjs.closeUserProfile():this.preopenUserProfile=null},this.openOrganizationProfile=r=>{this.clerkjs&&this.loaded?this.clerkjs.openOrganizationProfile(r):this.preopenOrganizationProfile=r},this.closeOrganizationProfile=()=>{this.clerkjs&&this.loaded?this.clerkjs.closeOrganizationProfile():this.preopenOrganizationProfile=null},this.openCreateOrganization=r=>{this.clerkjs&&this.loaded?this.clerkjs.openCreateOrganization(r):this.preopenCreateOrganization=r},this.closeCreateOrganization=()=>{this.clerkjs&&this.loaded?this.clerkjs.closeCreateOrganization():this.preopenCreateOrganization=null},this.openWaitlist=r=>{this.clerkjs&&this.loaded?this.clerkjs.openWaitlist(r):this.preOpenWaitlist=r},this.closeWaitlist=()=>{this.clerkjs&&this.loaded?this.clerkjs.closeWaitlist():this.preOpenWaitlist=null},this.openSignUp=r=>{this.clerkjs&&this.loaded?this.clerkjs.openSignUp(r):this.preopenSignUp=r},this.closeSignUp=()=>{this.clerkjs&&this.loaded?this.clerkjs.closeSignUp():this.preopenSignUp=null},this.mountSignIn=(r,a)=>{this.clerkjs&&this.loaded?this.clerkjs.mountSignIn(r,a):this.premountSignInNodes.set(r,a)},this.unmountSignIn=r=>{this.clerkjs&&this.loaded?this.clerkjs.unmountSignIn(r):this.premountSignInNodes.delete(r)},this.mountSignUp=(r,a)=>{this.clerkjs&&this.loaded?this.clerkjs.mountSignUp(r,a):this.premountSignUpNodes.set(r,a)},this.unmountSignUp=r=>{this.clerkjs&&this.loaded?this.clerkjs.unmountSignUp(r):this.premountSignUpNodes.delete(r)},this.mountUserAvatar=(r,a)=>{this.clerkjs&&this.loaded?this.clerkjs.mountUserAvatar(r,a):this.premountUserAvatarNodes.set(r,a)},this.unmountUserAvatar=r=>{this.clerkjs&&this.loaded?this.clerkjs.unmountUserAvatar(r):this.premountUserAvatarNodes.delete(r)},this.mountUserProfile=(r,a)=>{this.clerkjs&&this.loaded?this.clerkjs.mountUserProfile(r,a):this.premountUserProfileNodes.set(r,a)},this.unmountUserProfile=r=>{this.clerkjs&&this.loaded?this.clerkjs.unmountUserProfile(r):this.premountUserProfileNodes.delete(r)},this.mountOrganizationProfile=(r,a)=>{this.clerkjs&&this.loaded?this.clerkjs.mountOrganizationProfile(r,a):this.premountOrganizationProfileNodes.set(r,a)},this.unmountOrganizationProfile=r=>{this.clerkjs&&this.loaded?this.clerkjs.unmountOrganizationProfile(r):this.premountOrganizationProfileNodes.delete(r)},this.mountCreateOrganization=(r,a)=>{this.clerkjs&&this.loaded?this.clerkjs.mountCreateOrganization(r,a):this.premountCreateOrganizationNodes.set(r,a)},this.unmountCreateOrganization=r=>{this.clerkjs&&this.loaded?this.clerkjs.unmountCreateOrganization(r):this.premountCreateOrganizationNodes.delete(r)},this.mountOrganizationSwitcher=(r,a)=>{this.clerkjs&&this.loaded?this.clerkjs.mountOrganizationSwitcher(r,a):this.premountOrganizationSwitcherNodes.set(r,a)},this.unmountOrganizationSwitcher=r=>{this.clerkjs&&this.loaded?this.clerkjs.unmountOrganizationSwitcher(r):this.premountOrganizationSwitcherNodes.delete(r)},this.__experimental_prefetchOrganizationSwitcher=()=>{const r=()=>{var a;return(a=this.clerkjs)==null?void 0:a.__experimental_prefetchOrganizationSwitcher()};this.clerkjs&&this.loaded?r():this.premountMethodCalls.set("__experimental_prefetchOrganizationSwitcher",r)},this.mountOrganizationList=(r,a)=>{this.clerkjs&&this.loaded?this.clerkjs.mountOrganizationList(r,a):this.premountOrganizationListNodes.set(r,a)},this.unmountOrganizationList=r=>{this.clerkjs&&this.loaded?this.clerkjs.unmountOrganizationList(r):this.premountOrganizationListNodes.delete(r)},this.mountUserButton=(r,a)=>{this.clerkjs&&this.loaded?this.clerkjs.mountUserButton(r,a):this.premountUserButtonNodes.set(r,a)},this.unmountUserButton=r=>{this.clerkjs&&this.loaded?this.clerkjs.unmountUserButton(r):this.premountUserButtonNodes.delete(r)},this.mountWaitlist=(r,a)=>{this.clerkjs&&this.loaded?this.clerkjs.mountWaitlist(r,a):this.premountWaitlistNodes.set(r,a)},this.unmountWaitlist=r=>{this.clerkjs&&this.loaded?this.clerkjs.unmountWaitlist(r):this.premountWaitlistNodes.delete(r)},this.mountPricingTable=(r,a)=>{this.clerkjs&&this.loaded?this.clerkjs.mountPricingTable(r,a):this.premountPricingTableNodes.set(r,a)},this.unmountPricingTable=r=>{this.clerkjs&&this.loaded?this.clerkjs.unmountPricingTable(r):this.premountPricingTableNodes.delete(r)},this.mountAPIKeys=(r,a)=>{this.clerkjs&&this.loaded?this.clerkjs.mountAPIKeys(r,a):this.premountAPIKeysNodes.set(r,a)},this.unmountAPIKeys=r=>{this.clerkjs&&this.loaded?this.clerkjs.unmountAPIKeys(r):this.premountAPIKeysNodes.delete(r)},this.__internal_mountOAuthConsent=(r,a)=>{this.clerkjs&&this.loaded?this.clerkjs.__internal_mountOAuthConsent(r,a):this.premountOAuthConsentNodes.set(r,a)},this.__internal_unmountOAuthConsent=r=>{this.clerkjs&&this.loaded?this.clerkjs.__internal_unmountOAuthConsent(r):this.premountOAuthConsentNodes.delete(r)},this.mountTaskChooseOrganization=(r,a)=>{this.clerkjs&&this.loaded?this.clerkjs.mountTaskChooseOrganization(r,a):this.premountTaskChooseOrganizationNodes.set(r,a)},this.unmountTaskChooseOrganization=r=>{this.clerkjs&&this.loaded?this.clerkjs.unmountTaskChooseOrganization(r):this.premountTaskChooseOrganizationNodes.delete(r)},this.addListener=r=>{if(this.clerkjs)return this.clerkjs.addListener(r);{const a=()=>{var o;const l=this.premountAddListenerCalls.get(r);l&&((o=l.nativeUnsubscribe)==null||o.call(l),this.premountAddListenerCalls.delete(r))};return this.premountAddListenerCalls.set(r,{unsubscribe:a,nativeUnsubscribe:void 0}),a}},this.navigate=r=>{const a=()=>{var o;return(o=this.clerkjs)==null?void 0:o.navigate(r)};this.clerkjs&&this.loaded?a():this.premountMethodCalls.set("navigate",a)},this.redirectWithAuth=async(...r)=>{const a=()=>{var o;return(o=this.clerkjs)==null?void 0:o.redirectWithAuth(...r)};if(this.clerkjs&&this.loaded)return a();this.premountMethodCalls.set("redirectWithAuth",a)},this.redirectToSignIn=async r=>{const a=()=>{var o;return(o=this.clerkjs)==null?void 0:o.redirectToSignIn(r)};if(this.clerkjs&&this.loaded)return a();this.premountMethodCalls.set("redirectToSignIn",a)},this.redirectToSignUp=async r=>{const a=()=>{var o;return(o=this.clerkjs)==null?void 0:o.redirectToSignUp(r)};if(this.clerkjs&&this.loaded)return a();this.premountMethodCalls.set("redirectToSignUp",a)},this.redirectToUserProfile=async()=>{const r=()=>{var a;return(a=this.clerkjs)==null?void 0:a.redirectToUserProfile()};if(this.clerkjs&&this.loaded)return r();this.premountMethodCalls.set("redirectToUserProfile",r)},this.redirectToAfterSignUp=()=>{const r=()=>{var a;return(a=this.clerkjs)==null?void 0:a.redirectToAfterSignUp()};if(this.clerkjs&&this.loaded)return r();this.premountMethodCalls.set("redirectToAfterSignUp",r)},this.redirectToAfterSignIn=()=>{const r=()=>{var a;return(a=this.clerkjs)==null?void 0:a.redirectToAfterSignIn()};this.clerkjs&&this.loaded?r():this.premountMethodCalls.set("redirectToAfterSignIn",r)},this.redirectToAfterSignOut=()=>{const r=()=>{var a;return(a=this.clerkjs)==null?void 0:a.redirectToAfterSignOut()};this.clerkjs&&this.loaded?r():this.premountMethodCalls.set("redirectToAfterSignOut",r)},this.redirectToOrganizationProfile=async()=>{const r=()=>{var a;return(a=this.clerkjs)==null?void 0:a.redirectToOrganizationProfile()};if(this.clerkjs&&this.loaded)return r();this.premountMethodCalls.set("redirectToOrganizationProfile",r)},this.redirectToCreateOrganization=async()=>{const r=()=>{var a;return(a=this.clerkjs)==null?void 0:a.redirectToCreateOrganization()};if(this.clerkjs&&this.loaded)return r();this.premountMethodCalls.set("redirectToCreateOrganization",r)},this.redirectToWaitlist=async()=>{const r=()=>{var a;return(a=this.clerkjs)==null?void 0:a.redirectToWaitlist()};if(this.clerkjs&&this.loaded)return r();this.premountMethodCalls.set("redirectToWaitlist",r)},this.redirectToTasks=async r=>{const a=()=>{var o;return(o=this.clerkjs)==null?void 0:o.redirectToTasks(r)};if(this.clerkjs&&this.loaded)return a();this.premountMethodCalls.set("redirectToTasks",a)},this.handleRedirectCallback=async r=>{var a;const o=()=>{var l;return(l=this.clerkjs)==null?void 0:l.handleRedirectCallback(r)};this.clerkjs&&this.loaded?(a=o())==null||a.catch(()=>{}):this.premountMethodCalls.set("handleRedirectCallback",o)},this.handleGoogleOneTapCallback=async(r,a)=>{var o;const l=()=>{var c;return(c=this.clerkjs)==null?void 0:c.handleGoogleOneTapCallback(r,a)};this.clerkjs&&this.loaded?(o=l())==null||o.catch(()=>{}):this.premountMethodCalls.set("handleGoogleOneTapCallback",l)},this.handleEmailLinkVerification=async r=>{const a=()=>{var o;return(o=this.clerkjs)==null?void 0:o.handleEmailLinkVerification(r)};if(this.clerkjs&&this.loaded)return a();this.premountMethodCalls.set("handleEmailLinkVerification",a)},this.authenticateWithMetamask=async r=>{const a=()=>{var o;return(o=this.clerkjs)==null?void 0:o.authenticateWithMetamask(r)};if(this.clerkjs&&this.loaded)return a();this.premountMethodCalls.set("authenticateWithMetamask",a)},this.authenticateWithCoinbaseWallet=async r=>{const a=()=>{var o;return(o=this.clerkjs)==null?void 0:o.authenticateWithCoinbaseWallet(r)};if(this.clerkjs&&this.loaded)return a();this.premountMethodCalls.set("authenticateWithCoinbaseWallet",a)},this.authenticateWithBase=async r=>{const a=()=>{var o;return(o=this.clerkjs)==null?void 0:o.authenticateWithBase(r)};if(this.clerkjs&&this.loaded)return a();this.premountMethodCalls.set("authenticateWithBase",a)},this.authenticateWithOKXWallet=async r=>{const a=()=>{var o;return(o=this.clerkjs)==null?void 0:o.authenticateWithOKXWallet(r)};if(this.clerkjs&&this.loaded)return a();this.premountMethodCalls.set("authenticateWithOKXWallet",a)},this.authenticateWithWeb3=async r=>{const a=()=>{var o;return(o=this.clerkjs)==null?void 0:o.authenticateWithWeb3(r)};if(this.clerkjs&&this.loaded)return a();this.premountMethodCalls.set("authenticateWithWeb3",a)},this.authenticateWithGoogleOneTap=async r=>(await MN(this,xy,T1).call(this)).authenticateWithGoogleOneTap(r),this.__internal_loadStripeJs=async()=>(await MN(this,xy,T1).call(this)).__internal_loadStripeJs(),this.createOrganization=async r=>{const a=()=>{var o;return(o=this.clerkjs)==null?void 0:o.createOrganization(r)};if(this.clerkjs&&this.loaded)return a();this.premountMethodCalls.set("createOrganization",a)},this.getOrganization=async r=>{const a=()=>{var o;return(o=this.clerkjs)==null?void 0:o.getOrganization(r)};if(this.clerkjs&&this.loaded)return a();this.premountMethodCalls.set("getOrganization",a)},this.joinWaitlist=async r=>{const a=()=>{var o;return(o=this.clerkjs)==null?void 0:o.joinWaitlist(r)};if(this.clerkjs&&this.loaded)return a();this.premountMethodCalls.set("joinWaitlist",a)},this.signOut=async(...r)=>{const a=()=>{var o;return(o=this.clerkjs)==null?void 0:o.signOut(...r)};if(this.clerkjs&&this.loaded)return a();this.premountMethodCalls.set("signOut",a)},this.__internal_attemptToEnableEnvironmentSetting=r=>{const a=()=>{var o;return(o=this.clerkjs)==null?void 0:o.__internal_attemptToEnableEnvironmentSetting(r)};if(this.clerkjs&&this.loaded)return a();this.premountMethodCalls.set("__internal_attemptToEnableEnvironmentSetting",a)};const{Clerk:t=null,publishableKey:n}=e||{};nh(this,sd,n),nh(this,$m,e==null?void 0:e.proxyUrl),nh(this,Bm,e==null?void 0:e.domain),this.options=e,this.Clerk=t,this.mode=KC()?"browser":"server",nh(this,_1,new gY(this)),this.options.sdkMetadata||(this.options.sdkMetadata=xY),xs(this,Ro).emit(Uw.Status,"loading"),xs(this,Ro).prioritizedOn(Uw.Status,r=>nh(this,A1,r)),xs(this,sd)&&this.loadClerkJS()}get publishableKey(){return xs(this,sd)}get loaded(){var e;return((e=this.clerkjs)==null?void 0:e.loaded)||!1}get status(){var e;return this.clerkjs?((e=this.clerkjs)==null?void 0:e.status)||(this.clerkjs.loaded?"ready":"loading"):xs(this,A1)}static getOrCreateInstance(e){return(!KC()||!xs(this,ld)||e.Clerk&&xs(this,ld).Clerk!==e.Clerk||xs(this,ld).publishableKey!==e.publishableKey)&&nh(this,ld,new sB(e)),xs(this,ld)}static clearInstance(){nh(this,ld,null)}get domain(){return typeof window<"u"&&window.location?AN(xs(this,Bm),new URL(window.location.href),""):typeof xs(this,Bm)=="function"?bo.throw(NN):xs(this,Bm)||""}get proxyUrl(){return typeof window<"u"&&window.location?AN(xs(this,$m),new URL(window.location.href),""):typeof xs(this,$m)=="function"?bo.throw(NN):xs(this,$m)||""}__internal_getOption(e){var t,n;return(t=this.clerkjs)!=null&&t.__internal_getOption?(n=this.clerkjs)==null?void 0:n.__internal_getOption(e):this.options[e]}get sdkMetadata(){var e;return((e=this.clerkjs)==null?void 0:e.sdkMetadata)||this.options.sdkMetadata||void 0}get instanceType(){var e;return(e=this.clerkjs)==null?void 0:e.instanceType}get frontendApi(){var e;return((e=this.clerkjs)==null?void 0:e.frontendApi)||""}get isStandardBrowser(){var e;return((e=this.clerkjs)==null?void 0:e.isStandardBrowser)||this.options.standardBrowser||!1}get __internal_queryClient(){var e;return(e=this.clerkjs)==null?void 0:e.__internal_queryClient}get isSatellite(){return typeof window<"u"&&window.location?AN(this.options.isSatellite,new URL(window.location.href),!1):typeof this.options.isSatellite=="function"?bo.throw(NN):!1}async loadClerkJS(){var e;if(!(this.mode!=="browser"||this.loaded)){typeof window<"u"&&(window.__clerk_publishable_key=xs(this,sd),window.__clerk_proxy_url=this.proxyUrl,window.__clerk_domain=this.domain);try{if(this.Clerk){let t;AG(this.Clerk)?(t=new this.Clerk(xs(this,sd),{proxyUrl:this.proxyUrl,domain:this.domain}),this.beforeLoad(t),await t.load(this.options)):(t=this.Clerk,t.loaded||(this.beforeLoad(t),await t.load(this.options))),globalThis.Clerk=t}else if(!__BUILD_DISABLE_RHC__){if(globalThis.Clerk||await iY({...this.options,publishableKey:xs(this,sd),proxyUrl:this.proxyUrl,domain:this.domain,nonce:this.options.nonce}),!globalThis.Clerk)throw new Error("Failed to download latest ClerkJS. Contact support@clerk.com.");this.beforeLoad(globalThis.Clerk),await globalThis.Clerk.load(this.options)}return(e=globalThis.Clerk)!=null&&e.loaded?this.hydrateClerkJS(globalThis.Clerk):void 0}catch(t){const n=t;xs(this,Ro).emit(Uw.Status,"error"),console.error(n.stack||n.message||n);return}}}get version(){var e;return(e=this.clerkjs)==null?void 0:e.version}get client(){if(this.clerkjs)return this.clerkjs.client}get session(){if(this.clerkjs)return this.clerkjs.session}get user(){if(this.clerkjs)return this.clerkjs.user}get organization(){if(this.clerkjs)return this.clerkjs.organization}get telemetry(){if(this.clerkjs)return this.clerkjs.telemetry}get __unstable__environment(){if(this.clerkjs)return this.clerkjs.__unstable__environment}get isSignedIn(){return this.clerkjs?this.clerkjs.isSignedIn:!1}get billing(){var e;return(e=this.clerkjs)==null?void 0:e.billing}get __internal_state(){return this.loaded&&this.clerkjs?this.clerkjs.__internal_state:xs(this,_1)}get apiKeys(){var e;return(e=this.clerkjs)==null?void 0:e.apiKeys}__unstable__setEnvironment(...e){if(this.clerkjs&&"__unstable__setEnvironment"in this.clerkjs)this.clerkjs.__unstable__setEnvironment(e);else return}};A1=new WeakMap;Bm=new WeakMap;$m=new WeakMap;sd=new WeakMap;Ro=new WeakMap;_1=new WeakMap;ld=new WeakMap;xy=new WeakSet;T1=function(){return new Promise(s=>{this.addOnLoaded(()=>s(this.clerkjs))})};td(tB,ld);var HR=tB;function yY(s){const{isomorphicClerkOptions:e,initialState:t,children:n}=s,{isomorphicClerk:r,clerkStatus:a}=vY(e),[o,l]=V.useState({client:r.client,session:r.session,user:r.user,organization:r.organization});V.useEffect(()=>r.addListener(T=>l({...T})),[]);const c=cY(r.loaded,o,t),d=V.useMemo(()=>({value:r}),[a]),h=V.useMemo(()=>({value:o.client}),[o.client]),{sessionId:f,sessionStatus:m,sessionClaims:p,session:x,userId:g,user:b,orgId:v,actor:y,organization:w,orgRole:S,orgSlug:j,orgPermissions:A,factorVerificationAge:k}=c,_=V.useMemo(()=>({value:{sessionId:f,sessionStatus:m,sessionClaims:p,userId:g,actor:y,orgId:v,orgRole:S,orgSlug:j,orgPermissions:A,factorVerificationAge:k}}),[f,m,g,y,v,S,j,k,p==null?void 0:p.__raw]),L=V.useMemo(()=>({value:x}),[f,x]),D=V.useMemo(()=>({value:b}),[g,b]),P=V.useMemo(()=>({value:{organization:w}}),[v,w]);return V.createElement(nG.Provider,{value:d},V.createElement(H7.Provider,{value:h},V.createElement(V7.Provider,{value:L},V.createElement(Y7,{...P.value},V.createElement(tG.Provider,{value:_},V.createElement(U7.Provider,{value:D},V.createElement(q7,{value:void 0},n)))))))}var vY=s=>{const e=V.useRef(HR.getOrCreateInstance(s)),[t,n]=V.useState(e.current.status);return V.useEffect(()=>{e.current.__unstable__updateProps({appearance:s.appearance})},[s.appearance]),V.useEffect(()=>{e.current.__unstable__updateProps({options:s})},[s.localization]),V.useEffect(()=>(e.current.on("status",n),()=>{e.current&&e.current.off("status",n),HR.clearInstance()}),[]),{isomorphicClerk:e.current,clerkStatus:t}};function bY(s){const{initialState:e,children:t,__internal_bypassMissingPublishableKey:n,...r}=s,{publishableKey:a="",Clerk:o}=r;return!o&&!n&&(a?a&&!N_(a)&&bo.throwInvalidPublishableKeyError({key:a}):bo.throwMissingPublishableKeyError()),V.createElement(yY,{initialState:e,isomorphicClerkOptions:r},t)}var nB=TG(bY,"ClerkProvider",rG);nB.displayName="ClerkProvider";eG({packageName:"@clerk/clerk-react"});rY("@clerk/clerk-react");const VR="1.29.3";var cl=[],aa=[],wY=Uint8Array,IN="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var _m=0,CY=IN.length;_m<CY;++_m)cl[_m]=IN[_m],aa[IN.charCodeAt(_m)]=_m;aa[45]=62;aa[95]=63;function SY(s){var e=s.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=s.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function jY(s,e,t){return(e+t)*3/4-t}function Mv(s){var e,t=SY(s),n=t[0],r=t[1],a=new wY(jY(s,n,r)),o=0,l=r>0?n-4:n,c;for(c=0;c<l;c+=4)e=aa[s.charCodeAt(c)]<<18|aa[s.charCodeAt(c+1)]<<12|aa[s.charCodeAt(c+2)]<<6|aa[s.charCodeAt(c+3)],a[o++]=e>>16&255,a[o++]=e>>8&255,a[o++]=e&255;return r===2&&(e=aa[s.charCodeAt(c)]<<2|aa[s.charCodeAt(c+1)]>>4,a[o++]=e&255),r===1&&(e=aa[s.charCodeAt(c)]<<10|aa[s.charCodeAt(c+1)]<<4|aa[s.charCodeAt(c+2)]>>2,a[o++]=e>>8&255,a[o++]=e&255),a}function kY(s){return cl[s>>18&63]+cl[s>>12&63]+cl[s>>6&63]+cl[s&63]}function NY(s,e,t){for(var n,r=[],a=e;a<t;a+=3)n=(s[a]<<16&16711680)+(s[a+1]<<8&65280)+(s[a+2]&255),r.push(kY(n));return r.join("")}function Iv(s){for(var e,t=s.length,n=t%3,r=[],a=16383,o=0,l=t-n;o<l;o+=a)r.push(NY(s,o,o+a>l?l:o+a));return n===1?(e=s[t-1],r.push(cl[e>>2]+cl[e<<4&63]+"==")):n===2&&(e=(s[t-2]<<8)+s[t-1],r.push(cl[e>>10]+cl[e>>4&63]+cl[e<<2&63]+"=")),r.join("")}function Ul(s){if(s===void 0)return{};if(!rB(s))throw new Error(`The arguments to a Convex function must be an object. Received: ${s}`);return s}function AY(s){if(typeof s>"u")throw new Error("Client created with undefined deployment address. If you used an environment variable, check that it's set.");if(typeof s!="string")throw new Error(`Invalid deployment address: found ${s}".`);if(!(s.startsWith("http:")||s.startsWith("https:")))throw new Error(`Invalid deployment address: Must start with "https://" or "http://". Found "${s}".`);try{new URL(s)}catch{throw new Error(`Invalid deployment address: "${s}" is not a valid URL. If you believe this URL is correct, use the \`skipConvexDeploymentUrlCheck\` option to bypass this.`)}if(s.endsWith(".convex.site"))throw new Error(`Invalid deployment address: "${s}" ends with .convex.site, which is used for HTTP Actions. Convex deployment URLs typically end with .convex.cloud? If you believe this URL is correct, use the \`skipConvexDeploymentUrlCheck\` option to bypass this.`)}function rB(s){var r;const e=typeof s=="object",t=Object.getPrototypeOf(s),n=t===null||t===Object.prototype||((r=t==null?void 0:t.constructor)==null?void 0:r.name)==="Object";return e&&n}const iB=!0,yx=BigInt("-9223372036854775808"),pP=BigInt("9223372036854775807"),D_=BigInt("0"),_Y=BigInt("8"),TY=BigInt("256");function aB(s){return Number.isNaN(s)||!Number.isFinite(s)||Object.is(s,-0)}function EY(s){s<D_&&(s-=yx+yx);let e=s.toString(16);e.length%2===1&&(e="0"+e);const t=new Uint8Array(new ArrayBuffer(8));let n=0;for(const r of e.match(/.{2}/g).reverse())t.set([parseInt(r,16)],n++),s>>=_Y;return Iv(t)}function PY(s){const e=Mv(s);if(e.byteLength!==8)throw new Error(`Received ${e.byteLength} bytes, expected 8 for $integer`);let t=D_,n=D_;for(const r of e)t+=BigInt(r)*TY**n,n++;return t>pP&&(t+=yx+yx),t}function MY(s){if(s<yx||pP<s)throw new Error(`BigInt ${s} does not fit into a 64-bit signed integer.`);const e=new ArrayBuffer(8);return new DataView(e).setBigInt64(0,s,!0),Iv(new Uint8Array(e))}function IY(s){const e=Mv(s);if(e.byteLength!==8)throw new Error(`Received ${e.byteLength} bytes, expected 8 for $integer`);return new DataView(e.buffer).getBigInt64(0,!0)}const RY=DataView.prototype.setBigInt64?MY:EY,DY=DataView.prototype.getBigInt64?IY:PY,WR=1024;function oB(s){if(s.length>WR)throw new Error(`Field name ${s} exceeds maximum field name length ${WR}.`);if(s.startsWith("$"))throw new Error(`Field name ${s} starts with a '$', which is reserved.`);for(let e=0;e<s.length;e+=1){const t=s.charCodeAt(e);if(t<32||t>=127)throw new Error(`Field name ${s} has invalid character '${s[e]}': Field names can only contain non-control ASCII characters`)}}function vx(s){if(s===null||typeof s=="boolean"||typeof s=="number"||typeof s=="string")return s;if(Array.isArray(s))return s.map(n=>vx(n));if(typeof s!="object")throw new Error(`Unexpected type of ${s}`);const e=Object.entries(s);if(e.length===1){const n=e[0][0];if(n==="$bytes"){if(typeof s.$bytes!="string")throw new Error(`Malformed $bytes field on ${s}`);return Mv(s.$bytes).buffer}if(n==="$integer"){if(typeof s.$integer!="string")throw new Error(`Malformed $integer field on ${s}`);return DY(s.$integer)}if(n==="$float"){if(typeof s.$float!="string")throw new Error(`Malformed $float field on ${s}`);const r=Mv(s.$float);if(r.byteLength!==8)throw new Error(`Received ${r.byteLength} bytes, expected 8 for $float`);const o=new DataView(r.buffer).getFloat64(0,iB);if(!aB(o))throw new Error(`Float ${o} should be encoded as a number`);return o}if(n==="$set")throw new Error("Received a Set which is no longer supported as a Convex type.");if(n==="$map")throw new Error("Received a Map which is no longer supported as a Convex type.")}const t={};for(const[n,r]of Object.entries(s))oB(n),t[n]=vx(r);return t}const qR=16384;function iv(s){const e=JSON.stringify(s,(t,n)=>n===void 0?"undefined":typeof n=="bigint"?`${n.toString()}n`:n);if(e.length>qR){const t="[...truncated]";let n=qR-t.length;const r=e.codePointAt(n-1);return r!==void 0&&r>65535&&(n-=1),e.substring(0,n)+t}return e}function L_(s,e,t,n){var o;if(s===void 0){const l=t&&` (present at path ${t} in original object ${iv(e)})`;throw new Error(`undefined is not a valid Convex value${l}. To learn about Convex's supported types, see https://docs.convex.dev/using/types.`)}if(s===null)return s;if(typeof s=="bigint"){if(s<yx||pP<s)throw new Error(`BigInt ${s} does not fit into a 64-bit signed integer.`);return{$integer:RY(s)}}if(typeof s=="number")if(aB(s)){const l=new ArrayBuffer(8);return new DataView(l).setFloat64(0,s,iB),{$float:Iv(new Uint8Array(l))}}else return s;if(typeof s=="boolean"||typeof s=="string")return s;if(s instanceof ArrayBuffer)return{$bytes:Iv(new Uint8Array(s))};if(Array.isArray(s))return s.map((l,c)=>L_(l,e,t+`[${c}]`));if(s instanceof Set)throw new Error(RN(t,"Set",[...s],e));if(s instanceof Map)throw new Error(RN(t,"Map",[...s],e));if(!rB(s)){const l=(o=s==null?void 0:s.constructor)==null?void 0:o.name,c=l?`${l} `:"";throw new Error(RN(t,c,s,e))}const r={},a=Object.entries(s);a.sort(([l,c],[d,h])=>l===d?0:l<d?-1:1);for(const[l,c]of a)c!==void 0&&(oB(l),r[l]=L_(c,e,t+`.${l}`));return r}function RN(s,e,t,n){return s?`${e}${iv(t)} is not a supported Convex type (present at path ${s} in original object ${iv(n)}). To learn about Convex's supported types, see https://docs.convex.dev/using/types.`:`${e}${iv(t)} is not a supported Convex type.`}function Iu(s){return L_(s,s,"")}var LY=Object.defineProperty,OY=(s,e,t)=>e in s?LY(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,DN=(s,e,t)=>OY(s,typeof e!="symbol"?e+"":e,t),GR,YR;const FY=Symbol.for("ConvexError");class O_ extends(YR=Error,GR=FY,YR){constructor(e){super(typeof e=="string"?e:iv(e)),DN(this,"name","ConvexError"),DN(this,"data"),DN(this,GR,!0),this.data=e}}const lB=()=>Array.from({length:4},()=>0);lB();lB();var BY=Object.defineProperty,$Y=(s,e,t)=>e in s?BY(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,KR=(s,e,t)=>$Y(s,typeof e!="symbol"?e+"":e,t);const UY="color:rgb(0, 145, 255)";function cB(s){switch(s){case"query":return"Q";case"mutation":return"M";case"action":return"A";case"any":return"?"}}class dB{constructor(e){KR(this,"_onLogLineFuncs"),KR(this,"_verbose"),this._onLogLineFuncs={},this._verbose=e.verbose}addLogLineListener(e){let t=Math.random().toString(36).substring(2,15);for(let n=0;n<10&&this._onLogLineFuncs[t]!==void 0;n++)t=Math.random().toString(36).substring(2,15);return this._onLogLineFuncs[t]=e,()=>{delete this._onLogLineFuncs[t]}}logVerbose(...e){if(this._verbose)for(const t of Object.values(this._onLogLineFuncs))t("debug",`${new Date().toISOString()}`,...e)}log(...e){for(const t of Object.values(this._onLogLineFuncs))t("info",...e)}warn(...e){for(const t of Object.values(this._onLogLineFuncs))t("warn",...e)}error(...e){for(const t of Object.values(this._onLogLineFuncs))t("error",...e)}}function uB(s){const e=new dB(s);return e.addLogLineListener((t,...n)=>{switch(t){case"debug":console.debug(...n);break;case"info":console.log(...n);break;case"warn":console.warn(...n);break;case"error":console.error(...n);break;default:console.log(...n)}}),e}function hB(s){return new dB(s)}function XC(s,e,t,n,r){const a=cB(t);if(typeof r=="object"&&(r=`ConvexError ${JSON.stringify(r.errorData,null,2)}`),e==="info"){const o=r.match(/^\[.*?\] /);if(o===null){s.error(`[CONVEX ${a}(${n})] Could not parse console.log`);return}const l=r.slice(1,o[0].length-2),c=r.slice(o[0].length);s.log(`%c[CONVEX ${a}(${n})] [${l}]`,UY,c)}else s.error(`[CONVEX ${a}(${n})] ${r}`)}function zY(s,e){const t=`[CONVEX FATAL ERROR] ${e}`;return s.error(t),new Error(t)}function hp(s,e,t){return`[CONVEX ${cB(s)}(${e})] ${t.errorMessage}
  Called by client`}function F_(s,e){return e.data=s.errorData,e}function QC(s){const e=s.split(":");let t,n;return e.length===1?(t=e[0],n="default"):(t=e.slice(0,e.length-1).join(":"),n=e[e.length-1]),t.endsWith(".js")&&(t=t.slice(0,-3)),`${t}:${n}`}function Gf(s,e){return JSON.stringify({udfPath:QC(s),args:Iu(e)})}var HY=Object.defineProperty,VY=(s,e,t)=>e in s?HY(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Eo=(s,e,t)=>VY(s,typeof e!="symbol"?e+"":e,t);class WY{constructor(){Eo(this,"nextQueryId"),Eo(this,"querySetVersion"),Eo(this,"querySet"),Eo(this,"queryIdToToken"),Eo(this,"identityVersion"),Eo(this,"auth"),Eo(this,"outstandingQueriesOlderThanRestart"),Eo(this,"outstandingAuthOlderThanRestart"),Eo(this,"paused"),Eo(this,"pendingQuerySetModifications"),this.nextQueryId=0,this.querySetVersion=0,this.identityVersion=0,this.querySet=new Map,this.queryIdToToken=new Map,this.outstandingQueriesOlderThanRestart=new Set,this.outstandingAuthOlderThanRestart=!1,this.paused=!1,this.pendingQuerySetModifications=new Map}hasSyncedPastLastReconnect(){return this.outstandingQueriesOlderThanRestart.size===0&&!this.outstandingAuthOlderThanRestart}markAuthCompletion(){this.outstandingAuthOlderThanRestart=!1}subscribe(e,t,n,r){const a=QC(e),o=Gf(a,t),l=this.querySet.get(o);if(l!==void 0)return l.numSubscribers+=1,{queryToken:o,modification:null,unsubscribe:()=>this.removeSubscriber(o)};{const c=this.nextQueryId++,d={id:c,canonicalizedUdfPath:a,args:t,numSubscribers:1,journal:n,componentPath:r};this.querySet.set(o,d),this.queryIdToToken.set(c,o);const h=this.querySetVersion,f=this.querySetVersion+1,m={type:"Add",queryId:c,udfPath:a,args:[Iu(t)],journal:n,componentPath:r};return this.paused?this.pendingQuerySetModifications.set(c,m):this.querySetVersion=f,{queryToken:o,modification:{type:"ModifyQuerySet",baseVersion:h,newVersion:f,modifications:[m]},unsubscribe:()=>this.removeSubscriber(o)}}}transition(e){for(const t of e.modifications)switch(t.type){case"QueryUpdated":case"QueryFailed":{this.outstandingQueriesOlderThanRestart.delete(t.queryId);const n=t.journal;if(n!==void 0){const r=this.queryIdToToken.get(t.queryId);r!==void 0&&(this.querySet.get(r).journal=n)}break}case"QueryRemoved":{this.outstandingQueriesOlderThanRestart.delete(t.queryId);break}default:throw new Error(`Invalid modification ${t.type}`)}}queryId(e,t){const n=QC(e),r=Gf(n,t),a=this.querySet.get(r);return a!==void 0?a.id:null}isCurrentOrNewerAuthVersion(e){return e>=this.identityVersion}getAuth(){return this.auth}setAuth(e){this.auth={tokenType:"User",value:e};const t=this.identityVersion;return this.paused||(this.identityVersion=t+1),{type:"Authenticate",baseVersion:t,...this.auth}}setAdminAuth(e,t){const n={tokenType:"Admin",value:e,impersonating:t};this.auth=n;const r=this.identityVersion;return this.paused||(this.identityVersion=r+1),{type:"Authenticate",baseVersion:r,...n}}clearAuth(){this.auth=void 0,this.markAuthCompletion();const e=this.identityVersion;return this.paused||(this.identityVersion=e+1),{type:"Authenticate",tokenType:"None",baseVersion:e}}hasAuth(){return!!this.auth}isNewAuth(e){var t;return((t=this.auth)==null?void 0:t.value)!==e}queryPath(e){const t=this.queryIdToToken.get(e);return t?this.querySet.get(t).canonicalizedUdfPath:null}queryArgs(e){const t=this.queryIdToToken.get(e);return t?this.querySet.get(t).args:null}queryToken(e){return this.queryIdToToken.get(e)??null}queryJournal(e){var t;return(t=this.querySet.get(e))==null?void 0:t.journal}restart(e){this.unpause(),this.outstandingQueriesOlderThanRestart.clear();const t=[];for(const a of this.querySet.values()){const o={type:"Add",queryId:a.id,udfPath:a.canonicalizedUdfPath,args:[Iu(a.args)],journal:a.journal,componentPath:a.componentPath};t.push(o),e.has(a.id)||this.outstandingQueriesOlderThanRestart.add(a.id)}this.querySetVersion=1;const n={type:"ModifyQuerySet",baseVersion:0,newVersion:1,modifications:t};if(!this.auth)return this.identityVersion=0,[n,void 0];this.outstandingAuthOlderThanRestart=!0;const r={type:"Authenticate",baseVersion:0,...this.auth};return this.identityVersion=1,[n,r]}pause(){this.paused=!0}resume(){const e=this.pendingQuerySetModifications.size>0?{type:"ModifyQuerySet",baseVersion:this.querySetVersion,newVersion:++this.querySetVersion,modifications:Array.from(this.pendingQuerySetModifications.values())}:void 0,t=this.auth!==void 0?{type:"Authenticate",baseVersion:this.identityVersion++,...this.auth}:void 0;return this.unpause(),[e,t]}unpause(){this.paused=!1,this.pendingQuerySetModifications.clear()}removeSubscriber(e){const t=this.querySet.get(e);if(t.numSubscribers>1)return t.numSubscribers-=1,null;{this.querySet.delete(e),this.queryIdToToken.delete(t.id),this.outstandingQueriesOlderThanRestart.delete(t.id);const n=this.querySetVersion,r=this.querySetVersion+1,a={type:"Remove",queryId:t.id};return this.paused?this.pendingQuerySetModifications.has(t.id)?this.pendingQuerySetModifications.delete(t.id):this.pendingQuerySetModifications.set(t.id,a):this.querySetVersion=r,{type:"ModifyQuerySet",baseVersion:n,newVersion:r,modifications:[a]}}}}var qY=Object.defineProperty,GY=(s,e,t)=>e in s?qY(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,zw=(s,e,t)=>GY(s,typeof e!="symbol"?e+"":e,t);class YY{constructor(e,t){this.logger=e,this.markConnectionStateDirty=t,zw(this,"inflightRequests"),zw(this,"requestsOlderThanRestart"),zw(this,"inflightMutationsCount",0),zw(this,"inflightActionsCount",0),this.inflightRequests=new Map,this.requestsOlderThanRestart=new Set}request(e,t){const n=new Promise(r=>{const a=t?"Requested":"NotSent";this.inflightRequests.set(e.requestId,{message:e,status:{status:a,requestedAt:new Date,onResult:r}}),e.type==="Mutation"?this.inflightMutationsCount++:e.type==="Action"&&this.inflightActionsCount++});return this.markConnectionStateDirty(),n}onResponse(e){const t=this.inflightRequests.get(e.requestId);if(t===void 0||t.status.status==="Completed")return null;const n=t.message.type==="Mutation"?"mutation":"action",r=t.message.udfPath;for(const c of e.logLines)XC(this.logger,"info",n,r,c);const a=t.status;let o,l;if(e.success)o={success:!0,logLines:e.logLines,value:vx(e.result)},l=()=>a.onResult(o);else{const c=e.result,{errorData:d}=e;XC(this.logger,"error",n,r,c),o={success:!1,errorMessage:c,errorData:d!==void 0?vx(d):void 0,logLines:e.logLines},l=()=>a.onResult(o)}return e.type==="ActionResponse"||!e.success?(l(),this.inflightRequests.delete(e.requestId),this.requestsOlderThanRestart.delete(e.requestId),t.message.type==="Action"?this.inflightActionsCount--:t.message.type==="Mutation"&&this.inflightMutationsCount--,this.markConnectionStateDirty(),{requestId:e.requestId,result:o}):(t.status={status:"Completed",result:o,ts:e.ts,onResolve:l},null)}removeCompleted(e){const t=new Map;for(const[n,r]of this.inflightRequests.entries()){const a=r.status;a.status==="Completed"&&a.ts.lessThanOrEqual(e)&&(a.onResolve(),t.set(n,a.result),r.message.type==="Mutation"?this.inflightMutationsCount--:r.message.type==="Action"&&this.inflightActionsCount--,this.inflightRequests.delete(n),this.requestsOlderThanRestart.delete(n))}return t.size>0&&this.markConnectionStateDirty(),t}restart(){this.requestsOlderThanRestart=new Set(this.inflightRequests.keys());const e=[];for(const[t,n]of this.inflightRequests){if(n.status.status==="NotSent"){n.status.status="Requested",e.push(n.message);continue}if(n.message.type==="Mutation")e.push(n.message);else if(n.message.type==="Action"){if(this.inflightRequests.delete(t),this.requestsOlderThanRestart.delete(t),this.inflightActionsCount--,n.status.status==="Completed")throw new Error("Action should never be in 'Completed' state");n.status.onResult({success:!1,errorMessage:"Connection lost while action was in flight",logLines:[]})}}return this.markConnectionStateDirty(),e}resume(){const e=[];for(const[,t]of this.inflightRequests)if(t.status.status==="NotSent"){t.status.status="Requested",e.push(t.message);continue}return e}hasIncompleteRequests(){for(const e of this.inflightRequests.values())if(e.status.status==="Requested")return!0;return!1}hasInflightRequests(){return this.inflightRequests.size>0}hasSyncedPastLastReconnect(){return this.requestsOlderThanRestart.size===0}timeOfOldestInflightRequest(){if(this.inflightRequests.size===0)return null;let e=Date.now();for(const t of this.inflightRequests.values())t.status.status!=="Completed"&&t.status.requestedAt.getTime()<e&&(e=t.status.requestedAt.getTime());return new Date(e)}inflightMutations(){return this.inflightMutationsCount}inflightActions(){return this.inflightActionsCount}}const Rv=Symbol.for("functionName"),fB=Symbol.for("toReferencePath");function KY(s){return s[fB]??null}function XY(s){return s.startsWith("function://")}function QY(s){let e;if(typeof s=="string")XY(s)?e={functionHandle:s}:e={name:s};else if(s[Rv])e={name:s[Rv]};else{const t=KY(s);if(!t)throw new Error(`${s} is not a functionReference`);e={reference:t}}return e}function ri(s){const e=QY(s);if(e.name===void 0)throw e.functionHandle!==void 0?new Error(`Expected function reference like "api.file.func" or "internal.file.func", but received function handle ${e.functionHandle}`):e.reference!==void 0?new Error(`Expected function reference in the current component like "api.file.func" or "internal.file.func", but received reference ${e.reference}`):new Error(`Expected function reference like "api.file.func" or "internal.file.func", but received ${JSON.stringify(e)}`);if(typeof s=="string")return s;const t=s[Rv];if(!t)throw new Error(`${s} is not a functionReference`);return t}function gP(s){return{[Rv]:s}}function mB(s=[]){const e={get(t,n){if(typeof n=="string"){const r=[...s,n];return mB(r)}else if(n===Rv){if(s.length<2){const o=["api",...s].join(".");throw new Error(`API path is expected to be of the form \`api.moduleName.functionName\`. Found: \`${o}\``)}const r=s.slice(0,-1).join("/"),a=s[s.length-1];return a==="default"?r:r+":"+a}else return n===Symbol.toStringTag?"FunctionReference":void 0}};return new Proxy({},e)}const ZY=mB();var JY=Object.defineProperty,eK=(s,e,t)=>e in s?JY(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,ZC=(s,e,t)=>eK(s,typeof e!="symbol"?e+"":e,t);class Dv{constructor(e){ZC(this,"queryResults"),ZC(this,"modifiedQueries"),this.queryResults=e,this.modifiedQueries=[]}getQuery(e,...t){const n=Ul(t[0]),r=ri(e),a=this.queryResults.get(Gf(r,n));if(a!==void 0)return Dv.queryValue(a.result)}getAllQueries(e){const t=[],n=ri(e);for(const r of this.queryResults.values())r.udfPath===QC(n)&&t.push({args:r.args,value:Dv.queryValue(r.result)});return t}setQuery(e,t,n){const r=Ul(t),a=ri(e),o=Gf(a,r);let l;n===void 0?l=void 0:l={success:!0,value:n,logLines:[]};const c={udfPath:a,args:r,result:l};this.queryResults.set(o,c),this.modifiedQueries.push(o)}static queryValue(e){if(e!==void 0)return e.success?e.value:void 0}}class tK{constructor(){ZC(this,"queryResults"),ZC(this,"optimisticUpdates"),this.queryResults=new Map,this.optimisticUpdates=[]}ingestQueryResultsFromServer(e,t){this.optimisticUpdates=this.optimisticUpdates.filter(o=>!t.has(o.mutationId));const n=this.queryResults;this.queryResults=new Map(e);const r=new Dv(this.queryResults);for(const o of this.optimisticUpdates)o.update(r);const a=[];for(const[o,l]of this.queryResults){const c=n.get(o);(c===void 0||c.result!==l.result)&&a.push(o)}return a}applyOptimisticUpdate(e,t){this.optimisticUpdates.push({update:e,mutationId:t});const n=new Dv(this.queryResults);return e(n),n.modifiedQueries}rawQueryResult(e){return this.queryResults.get(e)}queryResult(e){const t=this.queryResults.get(e);if(t===void 0)return;const n=t.result;if(n!==void 0){if(n.success)return n.value;throw n.errorData!==void 0?F_(n,new O_(hp("query",t.udfPath,n))):new Error(hp("query",t.udfPath,n))}}hasQueryResult(e){return this.queryResults.get(e)!==void 0}queryLogs(e){var n;const t=this.queryResults.get(e);return(n=t==null?void 0:t.result)==null?void 0:n.logLines}}var sK=Object.defineProperty,nK=(s,e,t)=>e in s?sK(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,LN=(s,e,t)=>nK(s,typeof e!="symbol"?e+"":e,t);class Di{constructor(e,t){LN(this,"low"),LN(this,"high"),LN(this,"__isUnsignedLong__"),this.low=e|0,this.high=t|0,this.__isUnsignedLong__=!0}static isLong(e){return(e&&e.__isUnsignedLong__)===!0}static fromBytesLE(e){return new Di(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24)}toBytesLE(){const e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]}static fromNumber(e){return isNaN(e)||e<0?XR:e>=rK?iK:new Di(e%av|0,e/av|0)}toString(){return(BigInt(this.high)*BigInt(av)+BigInt(this.low)).toString()}equals(e){return Di.isLong(e)||(e=Di.fromValue(e)),this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low}notEquals(e){return!this.equals(e)}comp(e){return Di.isLong(e)||(e=Di.fromValue(e)),this.equals(e)?0:e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1}lessThanOrEqual(e){return this.comp(e)<=0}static fromValue(e){return typeof e=="number"?Di.fromNumber(e):new Di(e.low,e.high)}}const XR=new Di(0,0),QR=65536,av=QR*QR,rK=av*av,iK=new Di(-1,-1);var aK=Object.defineProperty,oK=(s,e,t)=>e in s?aK(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Hw=(s,e,t)=>oK(s,typeof e!="symbol"?e+"":e,t);class ZR{constructor(e,t){Hw(this,"version"),Hw(this,"remoteQuerySet"),Hw(this,"queryPath"),Hw(this,"logger"),this.version={querySet:0,ts:Di.fromNumber(0),identity:0},this.remoteQuerySet=new Map,this.queryPath=e,this.logger=t}transition(e){const t=e.startVersion;if(this.version.querySet!==t.querySet||this.version.ts.notEquals(t.ts)||this.version.identity!==t.identity)throw new Error(`Invalid start version: ${t.ts.toString()}:${t.querySet}:${t.identity}, transitioning from ${this.version.ts.toString()}:${this.version.querySet}:${this.version.identity}`);for(const n of e.modifications)switch(n.type){case"QueryUpdated":{const r=this.queryPath(n.queryId);if(r)for(const o of n.logLines)XC(this.logger,"info","query",r,o);const a=vx(n.value??null);this.remoteQuerySet.set(n.queryId,{success:!0,value:a,logLines:n.logLines});break}case"QueryFailed":{const r=this.queryPath(n.queryId);if(r)for(const o of n.logLines)XC(this.logger,"info","query",r,o);const{errorData:a}=n;this.remoteQuerySet.set(n.queryId,{success:!1,errorMessage:n.errorMessage,errorData:a!==void 0?vx(a):void 0,logLines:n.logLines});break}case"QueryRemoved":{this.remoteQuerySet.delete(n.queryId);break}default:throw new Error(`Invalid modification ${n.type}`)}this.version=e.endVersion}remoteQueryResults(){return this.remoteQuerySet}timestamp(){return this.version.ts}}function ON(s){const e=Mv(s);return Di.fromBytesLE(Array.from(e))}function lK(s){const e=new Uint8Array(s.toBytesLE());return Iv(e)}function JR(s){switch(s.type){case"FatalError":case"AuthError":case"ActionResponse":case"TransitionChunk":case"Ping":return{...s};case"MutationResponse":return s.success?{...s,ts:ON(s.ts)}:{...s};case"Transition":return{...s,startVersion:{...s.startVersion,ts:ON(s.startVersion.ts)},endVersion:{...s.endVersion,ts:ON(s.endVersion.ts)}}}}function cK(s){switch(s.type){case"Authenticate":case"ModifyQuerySet":case"Mutation":case"Action":case"Event":return{...s};case"Connect":return s.maxObservedTimestamp!==void 0?{...s,maxObservedTimestamp:lK(s.maxObservedTimestamp)}:{...s,maxObservedTimestamp:void 0}}}var dK=Object.defineProperty,uK=(s,e,t)=>e in s?dK(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Dn=(s,e,t)=>uK(s,typeof e!="symbol"?e+"":e,t);const hK=1e3,fK=1001,mK=1005,pK=4040;let E1;function P1(){return E1===void 0&&(E1=Date.now()),typeof performance>"u"||!performance.now?Date.now():Math.round(E1+performance.now())}function eD(){return`t=${Math.round((P1()-E1)/100)/10}s`}const pB={InternalServerError:{timeout:1e3},SubscriptionsWorkerFullError:{timeout:3e3},TooManyConcurrentRequests:{timeout:3e3},CommitterFullError:{timeout:3e3},AwsTooManyRequestsException:{timeout:3e3},ExecuteFullError:{timeout:3e3},SystemTimeoutError:{timeout:3e3},ExpiredInQueue:{timeout:3e3},VectorIndexesUnavailable:{timeout:1e3},SearchIndexesUnavailable:{timeout:1e3},TableSummariesUnavailable:{timeout:1e3},VectorIndexTooLarge:{timeout:3e3},SearchIndexTooLarge:{timeout:3e3},TooManyWritesInTimePeriod:{timeout:3e3}};function gK(s){if(s===void 0)return"Unknown";for(const e of Object.keys(pB))if(s.startsWith(e))return e;return"Unknown"}class xK{constructor(e,t,n,r,a,o){this.markConnectionStateDirty=a,this.debug=o,Dn(this,"socket"),Dn(this,"connectionCount"),Dn(this,"_hasEverConnected",!1),Dn(this,"lastCloseReason"),Dn(this,"transitionChunkBuffer",null),Dn(this,"defaultInitialBackoff"),Dn(this,"maxBackoff"),Dn(this,"retries"),Dn(this,"serverInactivityThreshold"),Dn(this,"reconnectDueToServerInactivityTimeout"),Dn(this,"uri"),Dn(this,"onOpen"),Dn(this,"onResume"),Dn(this,"onMessage"),Dn(this,"webSocketConstructor"),Dn(this,"logger"),Dn(this,"onServerDisconnectError"),this.webSocketConstructor=n,this.socket={state:"disconnected"},this.connectionCount=0,this.lastCloseReason="InitialConnect",this.defaultInitialBackoff=1e3,this.maxBackoff=16e3,this.retries=0,this.serverInactivityThreshold=6e4,this.reconnectDueToServerInactivityTimeout=null,this.uri=e,this.onOpen=t.onOpen,this.onResume=t.onResume,this.onMessage=t.onMessage,this.onServerDisconnectError=t.onServerDisconnectError,this.logger=r,this.connect()}setSocketState(e){this.socket=e,this._logVerbose(`socket state changed: ${this.socket.state}, paused: ${"paused"in this.socket?this.socket.paused:void 0}`),this.markConnectionStateDirty()}assembleTransition(e){if(e.partNumber<0||e.partNumber>=e.totalParts||e.totalParts===0||this.transitionChunkBuffer&&(this.transitionChunkBuffer.totalParts!==e.totalParts||this.transitionChunkBuffer.transitionId!==e.transitionId))throw this.transitionChunkBuffer=null,new Error("Invalid TransitionChunk");if(this.transitionChunkBuffer===null&&(this.transitionChunkBuffer={chunks:[],totalParts:e.totalParts,transitionId:e.transitionId}),e.partNumber!==this.transitionChunkBuffer.chunks.length){const t=this.transitionChunkBuffer.chunks.length;throw this.transitionChunkBuffer=null,new Error(`TransitionChunk received out of order: expected part ${t}, got ${e.partNumber}`)}if(this.transitionChunkBuffer.chunks.push(e.chunk),this.transitionChunkBuffer.chunks.length===e.totalParts){const t=this.transitionChunkBuffer.chunks.join("");this.transitionChunkBuffer=null;const n=JR(JSON.parse(t));if(n.type!=="Transition")throw new Error(`Expected Transition, got ${n.type} after assembling chunks`);return n}return null}connect(){if(this.socket.state==="terminated")return;if(this.socket.state!=="disconnected"&&this.socket.state!=="stopped")throw new Error("Didn't start connection from disconnected state: "+this.socket.state);const e=new this.webSocketConstructor(this.uri);this._logVerbose("constructed WebSocket"),this.setSocketState({state:"connecting",ws:e,paused:"no"}),this.resetServerInactivityTimeout(),e.onopen=()=>{if(this.logger.logVerbose("begin ws.onopen"),this.socket.state!=="connecting")throw new Error("onopen called with socket not in connecting state");this.setSocketState({state:"ready",ws:e,paused:this.socket.paused==="yes"?"uninitialized":"no"}),this.resetServerInactivityTimeout(),this.socket.paused==="no"&&(this._hasEverConnected=!0,this.onOpen({connectionCount:this.connectionCount,lastCloseReason:this.lastCloseReason,clientTs:P1()})),this.lastCloseReason!=="InitialConnect"&&(this.lastCloseReason?this.logger.log("WebSocket reconnected at",eD(),"after disconnect due to",this.lastCloseReason):this.logger.log("WebSocket reconnected at",eD())),this.connectionCount+=1,this.lastCloseReason=null},e.onerror=t=>{this.transitionChunkBuffer=null;const n=t.message;n&&this.logger.log(`WebSocket error message: ${n}`)},e.onmessage=t=>{this.resetServerInactivityTimeout();const n=t.data.length;let r=JR(JSON.parse(t.data));if(this._logVerbose(`received ws message with type ${r.type}`),r.type==="Ping")return;if(r.type==="TransitionChunk"){const o=this.assembleTransition(r);if(!o)return;r=o,this._logVerbose(`assembled full ws message of type ${r.type}`)}this.transitionChunkBuffer!==null&&(this.transitionChunkBuffer=null,this.logger.log(`Received unexpected ${r.type} while buffering TransitionChunks`)),r.type==="Transition"&&this.reportLargeTransition({messageLength:n,transition:r}),this.onMessage(r).hasSyncedPastLastReconnect&&(this.retries=0,this.markConnectionStateDirty())},e.onclose=t=>{if(this._logVerbose("begin ws.onclose"),this.transitionChunkBuffer=null,this.lastCloseReason===null&&(this.lastCloseReason=t.reason||`closed with code ${t.code}`),t.code!==hK&&t.code!==fK&&t.code!==mK&&t.code!==pK){let r=`WebSocket closed with code ${t.code}`;t.reason&&(r+=`: ${t.reason}`),this.logger.log(r),this.onServerDisconnectError&&t.reason&&this.onServerDisconnectError(r)}const n=gK(t.reason);this.scheduleReconnect(n)}}socketState(){return this.socket.state}sendMessage(e){const t={type:e.type,...e.type==="Authenticate"&&e.tokenType==="User"?{value:`...${e.value.slice(-7)}`}:{}};if(this.socket.state==="ready"&&this.socket.paused==="no"){const n=cK(e),r=JSON.stringify(n);let a=!1;try{this.socket.ws.send(r),a=!0}catch(o){this.logger.log(`Failed to send message on WebSocket, reconnecting: ${o}`),this.closeAndReconnect("FailedToSendMessage")}return this._logVerbose(`${a?"sent":"failed to send"} message with type ${e.type}: ${JSON.stringify(t)}`),!0}return this._logVerbose(`message not sent (socket state: ${this.socket.state}, paused: ${"paused"in this.socket?this.socket.paused:void 0}): ${JSON.stringify(t)}`),!1}resetServerInactivityTimeout(){this.socket.state!=="terminated"&&(this.reconnectDueToServerInactivityTimeout!==null&&(clearTimeout(this.reconnectDueToServerInactivityTimeout),this.reconnectDueToServerInactivityTimeout=null),this.reconnectDueToServerInactivityTimeout=setTimeout(()=>{this.closeAndReconnect("InactiveServer")},this.serverInactivityThreshold))}scheduleReconnect(e){this.socket={state:"disconnected"};const t=this.nextBackoff(e);this.markConnectionStateDirty(),this.logger.log(`Attempting reconnect in ${Math.round(t)}ms`),setTimeout(()=>this.connect(),t)}closeAndReconnect(e){switch(this._logVerbose(`begin closeAndReconnect with reason ${e}`),this.socket.state){case"disconnected":case"terminated":case"stopped":return;case"connecting":case"ready":{this.lastCloseReason=e,this.close(),this.scheduleReconnect("client");return}default:this.socket}}close(){switch(this.transitionChunkBuffer=null,this.socket.state){case"disconnected":case"terminated":case"stopped":return Promise.resolve();case"connecting":{const e=this.socket.ws;return e.onmessage=t=>{this._logVerbose("Ignoring message received after close")},new Promise(t=>{e.onclose=()=>{this._logVerbose("Closed after connecting"),t()},e.onopen=()=>{this._logVerbose("Opened after connecting"),e.close()}})}case"ready":{this._logVerbose("ws.close called");const e=this.socket.ws;e.onmessage=n=>{this._logVerbose("Ignoring message received after close")};const t=new Promise(n=>{e.onclose=()=>{n()}});return e.close(),t}default:return this.socket,Promise.resolve()}}terminate(){switch(this.reconnectDueToServerInactivityTimeout&&clearTimeout(this.reconnectDueToServerInactivityTimeout),this.socket.state){case"terminated":case"stopped":case"disconnected":case"connecting":case"ready":{const e=this.close();return this.setSocketState({state:"terminated"}),e}default:throw this.socket,new Error(`Invalid websocket state: ${this.socket.state}`)}}stop(){switch(this.socket.state){case"terminated":return Promise.resolve();case"connecting":case"stopped":case"disconnected":case"ready":{const e=this.close();return this.socket={state:"stopped"},e}default:return this.socket,Promise.resolve()}}tryRestart(){switch(this.socket.state){case"stopped":break;case"terminated":case"connecting":case"ready":case"disconnected":this.logger.logVerbose("Restart called without stopping first");return;default:this.socket}this.connect()}pause(){switch(this.socket.state){case"disconnected":case"stopped":case"terminated":return;case"connecting":case"ready":{this.socket={...this.socket,paused:"yes"};return}default:{this.socket;return}}}resume(){switch(this.socket.state){case"connecting":this.socket={...this.socket,paused:"no"};return;case"ready":this.socket.paused==="uninitialized"?(this.socket={...this.socket,paused:"no"},this.onOpen({connectionCount:this.connectionCount,lastCloseReason:this.lastCloseReason,clientTs:P1()})):this.socket.paused==="yes"&&(this.socket={...this.socket,paused:"no"},this.onResume());return;case"terminated":case"stopped":case"disconnected":return;default:this.socket}this.connect()}connectionState(){return{isConnected:this.socket.state==="ready",hasEverConnected:this._hasEverConnected,connectionCount:this.connectionCount,connectionRetries:this.retries}}_logVerbose(e){this.logger.logVerbose(e)}nextBackoff(e){const n=(e==="client"?100:e==="Unknown"?this.defaultInitialBackoff:pB[e].timeout)*Math.pow(2,this.retries);this.retries+=1;const r=Math.min(n,this.maxBackoff),a=r*(Math.random()-.5);return r+a}reportLargeTransition({transition:e,messageLength:t}){if(e.clientClockSkew===void 0||e.serverTs===void 0)return;const n=P1()-e.clientClockSkew-e.serverTs/1e6,r=`${Math.round(n)}ms`,a=`${Math.round(t/1e4)/100}MB`,o=t/(n/1e3),l=`${Math.round(o/1e4)/100}MB per second`;this._logVerbose(`received ${a} transition in ${r} at ${l}`),t>2e7?this.logger.log(`received query results totaling more that 20MB (${a}) which will take a long time to download on slower connections`):n>2e4&&this.logger.log(`received query results totaling ${a} which took more than 20s to arrive (${r})`),this.debug&&this.sendMessage({type:"Event",eventType:"ClientReceivedTransition",event:{transitionTransitTime:n,messageLength:t}})}}function yK(){return vK()}function vK(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,s=>{const e=Math.random()*16|0;return(s==="x"?e:e&3|8).toString(16)})}class yy extends Error{}yy.prototype.name="InvalidTokenError";function bK(s){return decodeURIComponent(atob(s).replace(/(.)/g,(e,t)=>{let n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}))}function wK(s){let e=s.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return bK(e)}catch{return atob(e)}}function gB(s,e){if(typeof s!="string")throw new yy("Invalid token specified: must be a string");e||(e={});const t=e.header===!0?0:1,n=s.split(".")[t];if(typeof n!="string")throw new yy(`Invalid token specified: missing part #${t+1}`);let r;try{r=wK(n)}catch(a){throw new yy(`Invalid token specified: invalid base64 for part #${t+1} (${a.message})`)}try{return JSON.parse(r)}catch(a){throw new yy(`Invalid token specified: invalid json for part #${t+1} (${a.message})`)}}var CK=Object.defineProperty,SK=(s,e,t)=>e in s?CK(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,ta=(s,e,t)=>SK(s,typeof e!="symbol"?e+"":e,t);const jK=20*24*60*60*1e3,tD=2;class kK{constructor(e,t,n){ta(this,"authState",{state:"noAuth"}),ta(this,"configVersion",0),ta(this,"syncState"),ta(this,"authenticate"),ta(this,"stopSocket"),ta(this,"tryRestartSocket"),ta(this,"pauseSocket"),ta(this,"resumeSocket"),ta(this,"clearAuth"),ta(this,"logger"),ta(this,"refreshTokenLeewaySeconds"),ta(this,"tokenConfirmationAttempts",0),this.syncState=e,this.authenticate=t.authenticate,this.stopSocket=t.stopSocket,this.tryRestartSocket=t.tryRestartSocket,this.pauseSocket=t.pauseSocket,this.resumeSocket=t.resumeSocket,this.clearAuth=t.clearAuth,this.logger=n.logger,this.refreshTokenLeewaySeconds=n.refreshTokenLeewaySeconds}async setConfig(e,t){this.resetAuthState(),this._logVerbose("pausing WS for auth token fetch"),this.pauseSocket();const n=await this.fetchTokenAndGuardAgainstRace(e,{forceRefreshToken:!1});n.isFromOutdatedConfig||(n.value?(this.setAuthState({state:"waitingForServerConfirmationOfCachedToken",config:{fetchToken:e,onAuthChange:t},hasRetried:!1}),this.authenticate(n.value)):(this.setAuthState({state:"initialRefetch",config:{fetchToken:e,onAuthChange:t}}),await this.refetchToken()),this._logVerbose("resuming WS after auth token fetch"),this.resumeSocket())}onTransition(e){if(this.syncState.isCurrentOrNewerAuthVersion(e.endVersion.identity)&&!(e.endVersion.identity<=e.startVersion.identity)){if(this.authState.state==="waitingForServerConfirmationOfCachedToken"){this._logVerbose("server confirmed auth token is valid"),this.refetchToken(),this.authState.config.onAuthChange(!0);return}this.authState.state==="waitingForServerConfirmationOfFreshToken"&&(this._logVerbose("server confirmed new auth token is valid"),this.scheduleTokenRefetch(this.authState.token),this.tokenConfirmationAttempts=0,this.authState.hadAuth||this.authState.config.onAuthChange(!0))}}onAuthError(e){if(e.authUpdateAttempted===!1&&(this.authState.state==="waitingForServerConfirmationOfFreshToken"||this.authState.state==="waitingForServerConfirmationOfCachedToken")){this._logVerbose("ignoring non-auth token expired error");return}const{baseVersion:t}=e;if(!this.syncState.isCurrentOrNewerAuthVersion(t+1)){this._logVerbose("ignoring auth error for previous auth attempt");return}this.tryToReauthenticate(e)}async tryToReauthenticate(e){if(this._logVerbose(`attempting to reauthenticate: ${e.error}`),this.authState.state==="noAuth"||this.authState.state==="waitingForServerConfirmationOfFreshToken"&&this.tokenConfirmationAttempts>=tD){this.logger.error(`Failed to authenticate: "${e.error}", check your server auth config`),this.syncState.hasAuth()&&this.syncState.clearAuth(),this.authState.state!=="noAuth"&&this.setAndReportAuthFailed(this.authState.config.onAuthChange);return}this.authState.state==="waitingForServerConfirmationOfFreshToken"&&(this.tokenConfirmationAttempts++,this._logVerbose(`retrying reauthentication, ${tD-this.tokenConfirmationAttempts} attempts remaining`)),await this.stopSocket();const t=await this.fetchTokenAndGuardAgainstRace(this.authState.config.fetchToken,{forceRefreshToken:!0});t.isFromOutdatedConfig||(t.value&&this.syncState.isNewAuth(t.value)?(this.authenticate(t.value),this.setAuthState({state:"waitingForServerConfirmationOfFreshToken",config:this.authState.config,token:t.value,hadAuth:this.authState.state==="notRefetching"||this.authState.state==="waitingForScheduledRefetch"})):(this._logVerbose("reauthentication failed, could not fetch a new token"),this.syncState.hasAuth()&&this.syncState.clearAuth(),this.setAndReportAuthFailed(this.authState.config.onAuthChange)),this.tryRestartSocket())}async refetchToken(){if(this.authState.state==="noAuth")return;this._logVerbose("refetching auth token");const e=await this.fetchTokenAndGuardAgainstRace(this.authState.config.fetchToken,{forceRefreshToken:!0});e.isFromOutdatedConfig||(e.value?this.syncState.isNewAuth(e.value)?(this.setAuthState({state:"waitingForServerConfirmationOfFreshToken",hadAuth:this.syncState.hasAuth(),token:e.value,config:this.authState.config}),this.authenticate(e.value)):this.setAuthState({state:"notRefetching",config:this.authState.config}):(this._logVerbose("refetching token failed"),this.syncState.hasAuth()&&this.clearAuth(),this.setAndReportAuthFailed(this.authState.config.onAuthChange)),this._logVerbose("restarting WS after auth token fetch (if currently stopped)"),this.tryRestartSocket())}scheduleTokenRefetch(e){if(this.authState.state==="noAuth")return;const t=this.decodeToken(e);if(!t){this.logger.error("Auth token is not a valid JWT, cannot refetch the token");return}const{iat:n,exp:r}=t;if(!n||!r){this.logger.error("Auth token does not have required fields, cannot refetch the token");return}const a=r-n;if(a<=2){this.logger.error("Auth token does not live long enough, cannot refetch the token");return}let o=Math.min(jK,(a-this.refreshTokenLeewaySeconds)*1e3);o<=0&&(this.logger.warn(`Refetching auth token immediately, configured leeway ${this.refreshTokenLeewaySeconds}s is larger than the token's lifetime ${a}s`),o=0);const l=setTimeout(()=>{this._logVerbose("running scheduled token refetch"),this.refetchToken()},o);this.setAuthState({state:"waitingForScheduledRefetch",refetchTokenTimeoutId:l,config:this.authState.config}),this._logVerbose(`scheduled preemptive auth token refetching in ${o}ms`)}async fetchTokenAndGuardAgainstRace(e,t){const n=++this.configVersion;this._logVerbose(`fetching token with config version ${n}`);const r=await e(t);return this.configVersion!==n?(this._logVerbose(`stale config version, expected ${n}, got ${this.configVersion}`),{isFromOutdatedConfig:!0}):{isFromOutdatedConfig:!1,value:r}}stop(){this.resetAuthState(),this.configVersion++,this._logVerbose(`config version bumped to ${this.configVersion}`)}setAndReportAuthFailed(e){e(!1),this.resetAuthState()}resetAuthState(){this.setAuthState({state:"noAuth"})}setAuthState(e){const t=e.state==="waitingForServerConfirmationOfFreshToken"?{hadAuth:e.hadAuth,state:e.state,token:`...${e.token.slice(-7)}`}:{state:e.state};switch(this._logVerbose(`setting auth state to ${JSON.stringify(t)}`),e.state){case"waitingForScheduledRefetch":case"notRefetching":case"noAuth":this.tokenConfirmationAttempts=0;break}this.authState.state==="waitingForScheduledRefetch"&&(clearTimeout(this.authState.refetchTokenTimeoutId),this.syncState.markAuthCompletion()),this.authState=e}decodeToken(e){try{return gB(e)}catch(t){return this._logVerbose(`Error decoding token: ${t instanceof Error?t.message:"Unknown error"}`),null}}_logVerbose(e){this.logger.logVerbose(`${e} [v${this.configVersion}]`)}}const NK=["convexClientConstructed","convexWebSocketOpen","convexFirstMessageReceived"];function AK(s,e){const t={sessionId:e};typeof performance>"u"||!performance.mark||performance.mark(s,{detail:t})}function _K(s){let e=s.name.slice(6);return e=e.charAt(0).toLowerCase()+e.slice(1),{name:e,startTime:s.startTime}}function TK(s){if(typeof performance>"u"||!performance.getEntriesByName)return[];const e=[];for(const t of NK){const n=performance.getEntriesByName(t).filter(r=>r.entryType==="mark").filter(r=>r.detail.sessionId===s);e.push(...n)}return e.map(_K)}var EK=Object.defineProperty,PK=(s,e,t)=>e in s?EK(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Js=(s,e,t)=>PK(s,typeof e!="symbol"?e+"":e,t);class MK{constructor(e,t,n){if(Js(this,"address"),Js(this,"state"),Js(this,"requestManager"),Js(this,"webSocketManager"),Js(this,"authenticationManager"),Js(this,"remoteQuerySet"),Js(this,"optimisticQueryResults"),Js(this,"_transitionHandlerCounter",0),Js(this,"_nextRequestId"),Js(this,"_onTransitionFns",new Map),Js(this,"_sessionId"),Js(this,"firstMessageReceived",!1),Js(this,"debug"),Js(this,"logger"),Js(this,"maxObservedTimestamp"),Js(this,"connectionStateSubscribers",new Map),Js(this,"nextConnectionStateSubscriberId",0),Js(this,"_lastPublishedConnectionState"),Js(this,"markConnectionStateDirty",()=>{Promise.resolve().then(()=>{const p=this.connectionState();if(JSON.stringify(p)!==JSON.stringify(this._lastPublishedConnectionState)){this._lastPublishedConnectionState=p;for(const x of this.connectionStateSubscribers.values())x(p)}})}),Js(this,"mark",p=>{this.debug&&AK(p,this.sessionId)}),typeof e=="object")throw new Error("Passing a ClientConfig object is no longer supported. Pass the URL of the Convex deployment as a string directly.");(n==null?void 0:n.skipConvexDeploymentUrlCheck)!==!0&&AY(e),n={...n};const r=n.authRefreshTokenLeewaySeconds??2;let a=n.webSocketConstructor;if(!a&&typeof WebSocket>"u")throw new Error("No WebSocket global variable defined! To use Convex in an environment without WebSocket try the HTTP client: https://docs.convex.dev/api/classes/browser.ConvexHttpClient");a=a||WebSocket,this.debug=n.reportDebugInfoToConvex??!1,this.address=e,this.logger=n.logger===!1?hB({verbose:n.verbose??!1}):n.logger!==!0&&n.logger?n.logger:uB({verbose:n.verbose??!1});const o=e.search("://");if(o===-1)throw new Error("Provided address was not an absolute URL.");const l=e.substring(o+3),c=e.substring(0,o);let d;if(c==="http")d="ws";else if(c==="https")d="wss";else throw new Error(`Unknown parent protocol ${c}`);const h=`${d}://${l}/api/${VR}/sync`;this.state=new WY,this.remoteQuerySet=new ZR(p=>this.state.queryPath(p),this.logger),this.requestManager=new YY(this.logger,this.markConnectionStateDirty);const f=()=>{this.webSocketManager.pause(),this.state.pause()};this.authenticationManager=new kK(this.state,{authenticate:p=>{const x=this.state.setAuth(p);return this.webSocketManager.sendMessage(x),x.baseVersion},stopSocket:()=>this.webSocketManager.stop(),tryRestartSocket:()=>this.webSocketManager.tryRestart(),pauseSocket:f,resumeSocket:()=>this.webSocketManager.resume(),clearAuth:()=>{this.clearAuth()}},{logger:this.logger,refreshTokenLeewaySeconds:r}),this.optimisticQueryResults=new tK,this.addOnTransitionHandler(p=>{t(p.queries.map(x=>x.token))}),this._nextRequestId=0,this._sessionId=yK();const{unsavedChangesWarning:m}=n;if(typeof window>"u"||typeof window.addEventListener>"u"){if(m===!0)throw new Error("unsavedChangesWarning requested, but window.addEventListener not found! Remove {unsavedChangesWarning: true} from Convex client options.")}else m!==!1&&window.addEventListener("beforeunload",p=>{if(this.requestManager.hasIncompleteRequests()){p.preventDefault();const x="Are you sure you want to leave? Your changes may not be saved.";return(p||window.event).returnValue=x,x}});this.webSocketManager=new xK(h,{onOpen:p=>{this.mark("convexWebSocketOpen"),this.webSocketManager.sendMessage({...p,type:"Connect",sessionId:this._sessionId,maxObservedTimestamp:this.maxObservedTimestamp});const x=new Set(this.remoteQuerySet.remoteQueryResults().keys());this.remoteQuerySet=new ZR(v=>this.state.queryPath(v),this.logger);const[g,b]=this.state.restart(x);b&&this.webSocketManager.sendMessage(b),this.webSocketManager.sendMessage(g);for(const v of this.requestManager.restart())this.webSocketManager.sendMessage(v)},onResume:()=>{const[p,x]=this.state.resume();x&&this.webSocketManager.sendMessage(x),p&&this.webSocketManager.sendMessage(p);for(const g of this.requestManager.resume())this.webSocketManager.sendMessage(g)},onMessage:p=>{switch(this.firstMessageReceived||(this.firstMessageReceived=!0,this.mark("convexFirstMessageReceived"),this.reportMarks()),p.type){case"Transition":{this.observedTimestamp(p.endVersion.ts),this.authenticationManager.onTransition(p),this.remoteQuerySet.transition(p),this.state.transition(p);const x=this.requestManager.removeCompleted(this.remoteQuerySet.timestamp());this.notifyOnQueryResultChanges(x);break}case"MutationResponse":{p.success&&this.observedTimestamp(p.ts);const x=this.requestManager.onResponse(p);x!==null&&this.notifyOnQueryResultChanges(new Map([[x.requestId,x.result]]));break}case"ActionResponse":{this.requestManager.onResponse(p);break}case"AuthError":{this.authenticationManager.onAuthError(p);break}case"FatalError":{const x=zY(this.logger,p.error);throw this.webSocketManager.terminate(),x}}return{hasSyncedPastLastReconnect:this.hasSyncedPastLastReconnect()}},onServerDisconnectError:n.onServerDisconnectError},a,this.logger,this.markConnectionStateDirty,this.debug),this.mark("convexClientConstructed"),n.expectAuth&&f()}hasSyncedPastLastReconnect(){return this.requestManager.hasSyncedPastLastReconnect()||this.state.hasSyncedPastLastReconnect()}observedTimestamp(e){(this.maxObservedTimestamp===void 0||this.maxObservedTimestamp.lessThanOrEqual(e))&&(this.maxObservedTimestamp=e)}getMaxObservedTimestamp(){return this.maxObservedTimestamp}notifyOnQueryResultChanges(e){const t=this.remoteQuerySet.remoteQueryResults(),n=new Map;for(const[a,o]of t){const l=this.state.queryToken(a);if(l!==null){const c={result:o,udfPath:this.state.queryPath(a),args:this.state.queryArgs(a)};n.set(l,c)}}const r=this.optimisticQueryResults.ingestQueryResultsFromServer(n,new Set(e.keys()));this.handleTransition({queries:r.map(a=>{const o=this.optimisticQueryResults.rawQueryResult(a);return{token:a,modification:{kind:"Updated",result:o.result}}}),reflectedMutations:Array.from(e).map(([a,o])=>({requestId:a,result:o})),timestamp:this.remoteQuerySet.timestamp()})}handleTransition(e){for(const t of this._onTransitionFns.values())t(e)}addOnTransitionHandler(e){const t=this._transitionHandlerCounter++;return this._onTransitionFns.set(t,e),()=>this._onTransitionFns.delete(t)}getCurrentAuthClaims(){const e=this.state.getAuth();let t={};if(e&&e.tokenType==="User")try{t=e?gB(e.value):{}}catch{t={}}else return;return{token:e.value,decoded:t}}setAuth(e,t){this.authenticationManager.setConfig(e,t)}hasAuth(){return this.state.hasAuth()}setAdminAuth(e,t){const n=this.state.setAdminAuth(e,t);this.webSocketManager.sendMessage(n)}clearAuth(){const e=this.state.clearAuth();this.webSocketManager.sendMessage(e)}subscribe(e,t,n){const r=Ul(t),{modification:a,queryToken:o,unsubscribe:l}=this.state.subscribe(e,r,n==null?void 0:n.journal,n==null?void 0:n.componentPath);return a!==null&&this.webSocketManager.sendMessage(a),{queryToken:o,unsubscribe:()=>{const c=l();c&&this.webSocketManager.sendMessage(c)}}}localQueryResult(e,t){const n=Ul(t),r=Gf(e,n);return this.optimisticQueryResults.queryResult(r)}localQueryResultByToken(e){return this.optimisticQueryResults.queryResult(e)}hasLocalQueryResultByToken(e){return this.optimisticQueryResults.hasQueryResult(e)}localQueryLogs(e,t){const n=Ul(t),r=Gf(e,n);return this.optimisticQueryResults.queryLogs(r)}queryJournal(e,t){const n=Ul(t),r=Gf(e,n);return this.state.queryJournal(r)}connectionState(){const e=this.webSocketManager.connectionState();return{hasInflightRequests:this.requestManager.hasInflightRequests(),isWebSocketConnected:e.isConnected,hasEverConnected:e.hasEverConnected,connectionCount:e.connectionCount,connectionRetries:e.connectionRetries,timeOfOldestInflightRequest:this.requestManager.timeOfOldestInflightRequest(),inflightMutations:this.requestManager.inflightMutations(),inflightActions:this.requestManager.inflightActions()}}subscribeToConnectionState(e){const t=this.nextConnectionStateSubscriberId++;return this.connectionStateSubscribers.set(t,e),()=>{this.connectionStateSubscribers.delete(t)}}async mutation(e,t,n){const r=await this.mutationInternal(e,t,n);if(!r.success)throw r.errorData!==void 0?F_(r,new O_(hp("mutation",e,r))):new Error(hp("mutation",e,r));return r.value}async mutationInternal(e,t,n,r){const{mutationPromise:a}=this.enqueueMutation(e,t,n,r);return a}enqueueMutation(e,t,n,r){const a=Ul(t);this.tryReportLongDisconnect();const o=this.nextRequestId;if(this._nextRequestId++,n!==void 0){const h=n.optimisticUpdate;if(h!==void 0){const f=x=>{h(x,a)instanceof Promise&&this.logger.warn("Optimistic update handler returned a Promise. Optimistic updates should be synchronous.")},p=this.optimisticQueryResults.applyOptimisticUpdate(f,o).map(x=>{const g=this.localQueryResultByToken(x);return{token:x,modification:{kind:"Updated",result:g===void 0?void 0:{success:!0,value:g,logLines:[]}}}});this.handleTransition({queries:p,reflectedMutations:[],timestamp:this.remoteQuerySet.timestamp()})}}const l={type:"Mutation",requestId:o,udfPath:e,componentPath:r,args:[Iu(a)]},c=this.webSocketManager.sendMessage(l),d=this.requestManager.request(l,c);return{requestId:o,mutationPromise:d}}async action(e,t){const n=await this.actionInternal(e,t);if(!n.success)throw n.errorData!==void 0?F_(n,new O_(hp("action",e,n))):new Error(hp("action",e,n));return n.value}async actionInternal(e,t,n){const r=Ul(t),a=this.nextRequestId;this._nextRequestId++,this.tryReportLongDisconnect();const o={type:"Action",requestId:a,udfPath:e,componentPath:n,args:[Iu(r)]},l=this.webSocketManager.sendMessage(o);return this.requestManager.request(o,l)}async close(){return this.authenticationManager.stop(),this.webSocketManager.terminate()}get url(){return this.address}get nextRequestId(){return this._nextRequestId}get sessionId(){return this._sessionId}reportMarks(){if(this.debug){const e=TK(this.sessionId);this.webSocketManager.sendMessage({type:"Event",eventType:"ClientConnect",event:e})}}tryReportLongDisconnect(){if(!this.debug)return;const e=this.connectionState().timeOfOldestInflightRequest;if(e===null||Date.now()-e.getTime()<=60*1e3)return;const t=`${this.address}/api/debug_event`;fetch(t,{method:"POST",headers:{"Content-Type":"application/json","Convex-Client":`npm-${VR}`},body:JSON.stringify({event:"LongWebsocketDisconnect"})}).then(n=>{n.ok||this.logger.warn("Analytics request failed with response:",n.body)}).catch(n=>{this.logger.warn("Analytics response failed with error:",n)})}}var IK=Object.defineProperty,RK=(s,e,t)=>e in s?IK(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,FN=(s,e,t)=>RK(s,typeof e!="symbol"?e+"":e,t);class DK{constructor(e){FN(this,"createWatch"),FN(this,"queries"),FN(this,"listeners"),this.createWatch=e,this.queries={},this.listeners=new Set}setQueries(e){for(const t of Object.keys(e)){const{query:n,args:r}=e[t];if(ri(n),this.queries[t]===void 0)this.addQuery(t,n,r);else{const a=this.queries[t];(ri(n)!==ri(a.query)||JSON.stringify(Iu(r))!==JSON.stringify(Iu(a.args)))&&(this.removeQuery(t),this.addQuery(t,n,r))}}for(const t of Object.keys(this.queries))e[t]===void 0&&this.removeQuery(t)}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}getLocalResults(e){const t={};for(const n of Object.keys(e)){const{query:r,args:a}=e[n];ri(r);const o=this.createWatch(r,a);let l;try{l=o.localQueryResult()}catch(c){if(c instanceof Error)l=c;else throw c}t[n]=l}return t}setCreateWatch(e){this.createWatch=e;for(const t of Object.keys(this.queries)){const{query:n,args:r,watch:a}=this.queries[t],o=a.journal();this.removeQuery(t),this.addQuery(t,n,r,o)}}destroy(){for(const e of Object.keys(this.queries))this.removeQuery(e);this.listeners=new Set}addQuery(e,t,n,r){if(this.queries[e]!==void 0)throw new Error(`Tried to add a new query with identifier ${e} when it already exists.`);const a=this.createWatch(t,n,r),o=a.onUpdate(()=>this.notifyListeners());this.queries[e]={query:t,args:n,watch:a,unsubscribe:o}}removeQuery(e){const t=this.queries[e];if(t===void 0)throw new Error(`No query found with identifier ${e}.`);t.unsubscribe(),delete this.queries[e]}notifyListeners(){for(const e of this.listeners)e()}}function LK({getCurrentValue:s,subscribe:e}){const[t,n]=C.useState(()=>({getCurrentValue:s,subscribe:e,value:s()}));let r=t.value;return(t.getCurrentValue!==s||t.subscribe!==e)&&(r=s(),n({getCurrentValue:s,subscribe:e,value:r})),C.useEffect(()=>{let a=!1;const o=()=>{a||n(c=>{if(c.getCurrentValue!==s||c.subscribe!==e)return c;const d=s();return c.value===d?c:{...c,value:d}})},l=e(o);return o(),()=>{a=!0,l()}},[s,e]),r}function OK(s){const e=VK();if(e===void 0)throw new Error("Could not find Convex client! `useQuery` must be used in the React component tree under `ConvexProvider`. Did you forget it? See https://docs.convex.dev/quick-start#set-up-convex-in-your-react-app");const t=C.useMemo(()=>(n,r,a)=>e.watchQuery(n,r,a?{journal:a}:{}),[e]);return FK(s,t)}function FK(s,e){const[t]=C.useState(()=>new DK(e));t.createWatch!==e&&t.setCreateWatch(e),C.useEffect(()=>()=>t.destroy(),[t]);const n=C.useMemo(()=>({getCurrentValue:()=>t.getLocalResults(s),subscribe:r=>(t.setQueries(s),t.subscribe(r))}),[t,s]);return LK(n)}var BK=Object.defineProperty,$K=(s,e,t)=>e in s?BK(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,Xc=(s,e,t)=>$K(s,typeof e!="symbol"?e+"":e,t);const UK=5e3;if(typeof V>"u")throw new Error("Required dependency 'react' not found");function xB(s,e,t){function n(r){return GK(r),e.mutation(s,r,{optimisticUpdate:t})}return n.withOptimisticUpdate=function(a){if(t!==void 0)throw new Error(`Already specified optimistic update for mutation ${ri(s)}`);return xB(s,e,a)},n}function zK(s,e){return function(t){return e.action(s,t)}}class HK{constructor(e,t){if(Xc(this,"address"),Xc(this,"cachedSync"),Xc(this,"listeners"),Xc(this,"options"),Xc(this,"closed",!1),Xc(this,"_logger"),Xc(this,"adminAuth"),Xc(this,"fakeUserIdentity"),e===void 0)throw new Error("No address provided to ConvexReactClient.\nIf trying to deploy to production, make sure to follow all the instructions found at https://docs.convex.dev/production/hosting/\nIf running locally, make sure to run `convex dev` and ensure the .env.local file is populated.");if(typeof e!="string")throw new Error(`ConvexReactClient requires a URL like 'https://happy-otter-123.convex.cloud', received something of type ${typeof e} instead.`);if(!e.includes("://"))throw new Error("Provided address was not an absolute URL.");this.address=e,this.listeners=new Map,this._logger=(t==null?void 0:t.logger)===!1?hB({verbose:(t==null?void 0:t.verbose)??!1}):(t==null?void 0:t.logger)!==!0&&(t!=null&&t.logger)?t.logger:uB({verbose:(t==null?void 0:t.verbose)??!1}),this.options={...t,logger:this._logger}}get url(){return this.address}get sync(){if(this.closed)throw new Error("ConvexReactClient has already been closed.");return this.cachedSync?this.cachedSync:(this.cachedSync=new MK(this.address,e=>this.transition(e),this.options),this.adminAuth&&this.cachedSync.setAdminAuth(this.adminAuth,this.fakeUserIdentity),this.cachedSync)}setAuth(e,t){if(typeof e=="string")throw new Error("Passing a string to ConvexReactClient.setAuth is no longer supported, please upgrade to passing in an async function to handle reauthentication.");this.sync.setAuth(e,t??(()=>{}))}clearAuth(){this.sync.clearAuth()}setAdminAuth(e,t){if(this.adminAuth=e,this.fakeUserIdentity=t,this.closed)throw new Error("ConvexReactClient has already been closed.");this.cachedSync&&this.sync.setAdminAuth(e,t)}watchQuery(e,...t){const[n,r]=t,a=ri(e);return{onUpdate:o=>{const{queryToken:l,unsubscribe:c}=this.sync.subscribe(a,n,r),d=this.listeners.get(l);return d!==void 0?d.add(o):this.listeners.set(l,new Set([o])),()=>{if(this.closed)return;const h=this.listeners.get(l);h.delete(o),h.size===0&&this.listeners.delete(l),c()}},localQueryResult:()=>{if(this.cachedSync)return this.cachedSync.localQueryResult(a,n)},localQueryLogs:()=>{if(this.cachedSync)return this.cachedSync.localQueryLogs(a,n)},journal:()=>{if(this.cachedSync)return this.cachedSync.queryJournal(a,n)}}}prewarmQuery(e){const t=e.extendSubscriptionFor??UK,r=this.watchQuery(e.query,e.args||{}).onUpdate(()=>{});setTimeout(r,t)}mutation(e,...t){const[n,r]=t,a=ri(e);return this.sync.mutation(a,n,r)}action(e,...t){const n=ri(e);return this.sync.action(n,...t)}query(e,...t){const n=this.watchQuery(e,...t),r=n.localQueryResult();return r!==void 0?Promise.resolve(r):new Promise((a,o)=>{const l=n.onUpdate(()=>{l();try{a(n.localQueryResult())}catch(c){o(c)}})})}connectionState(){return this.sync.connectionState()}subscribeToConnectionState(e){return this.sync.subscribeToConnectionState(e)}get logger(){return this._logger}async close(){if(this.closed=!0,this.listeners=new Map,this.cachedSync){const e=this.cachedSync;this.cachedSync=void 0,await e.close()}}transition(e){for(const t of e){const n=this.listeners.get(t);if(n)for(const r of n)r()}}}const Oj=V.createContext(void 0);function VK(){return C.useContext(Oj)}const WK=({client:s,children:e})=>V.createElement(Oj.Provider,{value:s},e);function Fe(s,...e){const t=e[0]==="skip",n=e[0]==="skip"?{}:Ul(e[0]),r=typeof s=="string"?gP(s):s,a=ri(r),o=C.useMemo(()=>t?{}:{query:{query:r,args:n}},[JSON.stringify(Iu(n)),a,t]),c=OK(o).query;if(c instanceof Error)throw c;return c}function Re(s){const e=typeof s=="string"?gP(s):s,t=C.useContext(Oj);if(t===void 0)throw new Error("Could not find Convex client! `useMutation` must be used in the React component tree under `ConvexProvider`. Did you forget it? See https://docs.convex.dev/quick-start#set-up-convex-in-your-react-app");return C.useMemo(()=>xB(e,t),[t,ri(e)])}function qK(s){const e=C.useContext(Oj),t=typeof s=="string"?gP(s):s;if(e===void 0)throw new Error("Could not find Convex client! `useAction` must be used in the React component tree under `ConvexProvider`. Did you forget it? See https://docs.convex.dev/quick-start#set-up-convex-in-your-react-app");return C.useMemo(()=>zK(t,e),[e,ri(t)])}function GK(s){if(typeof s=="object"&&s!==null&&"bubbles"in s&&"persist"in s&&"isDefaultPrevented"in s)throw new Error("Convex function called with SyntheticEvent object. Did you use a Convex function as an event handler directly? Event handlers like onClick receive an event object as their first argument. These SyntheticEvent objects are not valid Convex values. Try wrapping the function like `const handler = () => myMutation();` and using `handler` in the event handler.")}const yB=C.createContext(void 0);function YK(){const s=C.useContext(yB);if(s===void 0)throw new Error("Could not find `ConvexProviderWithAuth` (or `ConvexProviderWithClerk` or `ConvexProviderWithAuth0`) as an ancestor component. This component may be missing, or you might have two instances of the `convex/react` module loaded in your project.");return s}function KK({children:s,client:e,useAuth:t}){const{isLoading:n,isAuthenticated:r,fetchAccessToken:a}=t(),[o,l]=C.useState(null);return n&&o!==null&&l(null),!n&&!r&&o!==!1&&l(!1),V.createElement(yB.Provider,{value:{isLoading:o===null,isAuthenticated:r&&(o??!1)}},V.createElement(XK,{authProviderAuthenticated:r,fetchAccessToken:a,authProviderLoading:n,client:e,setIsConvexAuthenticated:l}),V.createElement(WK,{client:e},s),V.createElement(QK,{authProviderAuthenticated:r,fetchAccessToken:a,authProviderLoading:n,client:e,setIsConvexAuthenticated:l}))}function XK({authProviderAuthenticated:s,fetchAccessToken:e,authProviderLoading:t,client:n,setIsConvexAuthenticated:r}){return C.useEffect(()=>{let a=!0;if(s)return n.setAuth(e,o=>{a&&r(()=>o)}),()=>{a=!1,r(o=>o?!1:null)}},[s,e,t,n,r]),null}function QK({authProviderAuthenticated:s,fetchAccessToken:e,authProviderLoading:t,client:n,setIsConvexAuthenticated:r}){return C.useEffect(()=>{if(s)return()=>{n.clearAuth(),r(()=>null)}},[s,e,t,n,r]),null}function ZK({children:s,client:e,useAuth:t}){const n=JK(t);return V.createElement(KK,{client:e,useAuth:n},s)}function JK(s){return C.useMemo(()=>function(){const{isLoaded:t,isSignedIn:n,getToken:r,orgId:a,orgRole:o}=s(),l=C.useCallback(async({forceRefreshToken:c})=>{try{return await r({template:"convex",skipCache:c})}catch{return null}},[a,o]);return C.useMemo(()=>({isLoading:!t,isAuthenticated:n??!1,fetchAccessToken:l}),[t,n,l])},[s])}var Fj=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(s){return this.listeners.add(s),this.onSubscribe(),()=>{this.listeners.delete(s),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},eX={setTimeout:(s,e)=>setTimeout(s,e),clearTimeout:s=>clearTimeout(s),setInterval:(s,e)=>setInterval(s,e),clearInterval:s=>clearInterval(s)},pd,mE,JO,tX=(JO=class{constructor(){E(this,pd,eX);E(this,mE,!1)}setTimeoutProvider(s){N(this,pd,s)}setTimeout(s,e){return u(this,pd).setTimeout(s,e)}clearTimeout(s){u(this,pd).clearTimeout(s)}setInterval(s,e){return u(this,pd).setInterval(s,e)}clearInterval(s){u(this,pd).clearInterval(s)}},pd=new WeakMap,mE=new WeakMap,JO),B_=new tX;function sX(s){setTimeout(s,0)}var Bj=typeof window>"u"||"Deno"in globalThis;function qa(){}function nX(s,e){return typeof s=="function"?s(e):s}function rX(s){return typeof s=="number"&&s>=0&&s!==1/0}function iX(s,e){return Math.max(s+(e||0)-Date.now(),0)}function $_(s,e){return typeof s=="function"?s(e):s}function aX(s,e){return typeof s=="function"?s(e):s}function sD(s,e){const{type:t="all",exact:n,fetchStatus:r,predicate:a,queryKey:o,stale:l}=s;if(o){if(n){if(e.queryHash!==xP(o,e.options))return!1}else if(!Ov(e.queryKey,o))return!1}if(t!=="all"){const c=e.isActive();if(t==="active"&&!c||t==="inactive"&&c)return!1}return!(typeof l=="boolean"&&e.isStale()!==l||r&&r!==e.state.fetchStatus||a&&!a(e))}function nD(s,e){const{exact:t,status:n,predicate:r,mutationKey:a}=s;if(a){if(!e.options.mutationKey)return!1;if(t){if(Lv(e.options.mutationKey)!==Lv(a))return!1}else if(!Ov(e.options.mutationKey,a))return!1}return!(n&&e.state.status!==n||r&&!r(e))}function xP(s,e){return((e==null?void 0:e.queryKeyHashFn)||Lv)(s)}function Lv(s){return JSON.stringify(s,(e,t)=>U_(t)?Object.keys(t).sort().reduce((n,r)=>(n[r]=t[r],n),{}):t)}function Ov(s,e){return s===e?!0:typeof s!=typeof e?!1:s&&e&&typeof s=="object"&&typeof e=="object"?Object.keys(e).every(t=>Ov(s[t],e[t])):!1}var oX=Object.prototype.hasOwnProperty;function vB(s,e){if(s===e)return s;const t=rD(s)&&rD(e);if(!t&&!(U_(s)&&U_(e)))return e;const r=(t?s:Object.keys(s)).length,a=t?e:Object.keys(e),o=a.length,l=t?new Array(o):{};let c=0;for(let d=0;d<o;d++){const h=t?d:a[d],f=s[h],m=e[h];if(f===m){l[h]=f,(t?d<r:oX.call(s,h))&&c++;continue}if(f===null||m===null||typeof f!="object"||typeof m!="object"){l[h]=m;continue}const p=vB(f,m);l[h]=p,p===f&&c++}return r===o&&c===r?s:l}function rD(s){return Array.isArray(s)&&s.length===Object.keys(s).length}function U_(s){if(!iD(s))return!1;const e=s.constructor;if(e===void 0)return!0;const t=e.prototype;return!(!iD(t)||!t.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(s)!==Object.prototype)}function iD(s){return Object.prototype.toString.call(s)==="[object Object]"}function lX(s){return new Promise(e=>{B_.setTimeout(e,s)})}function cX(s,e,t){return typeof t.structuralSharing=="function"?t.structuralSharing(s,e):t.structuralSharing!==!1?vB(s,e):e}function dX(s,e,t=0){const n=[...s,e];return t&&n.length>t?n.slice(1):n}function uX(s,e,t=0){const n=[e,...s];return t&&n.length>t?n.slice(0,-1):n}var yP=Symbol();function bB(s,e){return!s.queryFn&&(e!=null&&e.initialPromise)?()=>e.initialPromise:!s.queryFn||s.queryFn===yP?()=>Promise.reject(new Error(`Missing queryFn: '${s.queryHash}'`)):s.queryFn}var Sh,gd,Pp,e4,hX=(e4=class extends Fj{constructor(){super();E(this,Sh);E(this,gd);E(this,Pp);N(this,Pp,e=>{if(!Bj&&window.addEventListener){const t=()=>e();return window.addEventListener("visibilitychange",t,!1),()=>{window.removeEventListener("visibilitychange",t)}}})}onSubscribe(){u(this,gd)||this.setEventListener(u(this,Pp))}onUnsubscribe(){var e;this.hasListeners()||((e=u(this,gd))==null||e.call(this),N(this,gd,void 0))}setEventListener(e){var t;N(this,Pp,e),(t=u(this,gd))==null||t.call(this),N(this,gd,e(n=>{typeof n=="boolean"?this.setFocused(n):this.onFocus()}))}setFocused(e){u(this,Sh)!==e&&(N(this,Sh,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(t=>{t(e)})}isFocused(){var e;return typeof u(this,Sh)=="boolean"?u(this,Sh):((e=globalThis.document)==null?void 0:e.visibilityState)!=="hidden"}},Sh=new WeakMap,gd=new WeakMap,Pp=new WeakMap,e4),wB=new hX;function fX(){let s,e;const t=new Promise((r,a)=>{s=r,e=a});t.status="pending",t.catch(()=>{});function n(r){Object.assign(t,r),delete t.resolve,delete t.reject}return t.resolve=r=>{n({status:"fulfilled",value:r}),s(r)},t.reject=r=>{n({status:"rejected",reason:r}),e(r)},t}var mX=sX;function pX(){let s=[],e=0,t=l=>{l()},n=l=>{l()},r=mX;const a=l=>{e?s.push(l):r(()=>{t(l)})},o=()=>{const l=s;s=[],l.length&&r(()=>{n(()=>{l.forEach(c=>{t(c)})})})};return{batch:l=>{let c;e++;try{c=l()}finally{e--,e||o()}return c},batchCalls:l=>(...c)=>{a(()=>{l(...c)})},schedule:a,setNotifyFunction:l=>{t=l},setBatchNotifyFunction:l=>{n=l},setScheduler:l=>{r=l}}}var Ar=pX(),Mp,xd,Ip,t4,gX=(t4=class extends Fj{constructor(){super();E(this,Mp,!0);E(this,xd);E(this,Ip);N(this,Ip,e=>{if(!Bj&&window.addEventListener){const t=()=>e(!0),n=()=>e(!1);return window.addEventListener("online",t,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",n)}}})}onSubscribe(){u(this,xd)||this.setEventListener(u(this,Ip))}onUnsubscribe(){var e;this.hasListeners()||((e=u(this,xd))==null||e.call(this),N(this,xd,void 0))}setEventListener(e){var t;N(this,Ip,e),(t=u(this,xd))==null||t.call(this),N(this,xd,e(this.setOnline.bind(this)))}setOnline(e){u(this,Mp)!==e&&(N(this,Mp,e),this.listeners.forEach(n=>{n(e)}))}isOnline(){return u(this,Mp)}},Mp=new WeakMap,xd=new WeakMap,Ip=new WeakMap,t4),JC=new gX;function xX(s){return Math.min(1e3*2**s,3e4)}function CB(s){return(s??"online")==="online"?JC.isOnline():!0}var z_=class extends Error{constructor(s){super("CancelledError"),this.revert=s==null?void 0:s.revert,this.silent=s==null?void 0:s.silent}};function SB(s){let e=!1,t=0,n;const r=fX(),a=()=>r.status!=="pending",o=g=>{var b;if(!a()){const v=new z_(g);m(v),(b=s.onCancel)==null||b.call(s,v)}},l=()=>{e=!0},c=()=>{e=!1},d=()=>wB.isFocused()&&(s.networkMode==="always"||JC.isOnline())&&s.canRun(),h=()=>CB(s.networkMode)&&s.canRun(),f=g=>{a()||(n==null||n(),r.resolve(g))},m=g=>{a()||(n==null||n(),r.reject(g))},p=()=>new Promise(g=>{var b;n=v=>{(a()||d())&&g(v)},(b=s.onPause)==null||b.call(s)}).then(()=>{var g;n=void 0,a()||(g=s.onContinue)==null||g.call(s)}),x=()=>{if(a())return;let g;const b=t===0?s.initialPromise:void 0;try{g=b??s.fn()}catch(v){g=Promise.reject(v)}Promise.resolve(g).then(f).catch(v=>{var A;if(a())return;const y=s.retry??(Bj?0:3),w=s.retryDelay??xX,S=typeof w=="function"?w(t,v):w,j=y===!0||typeof y=="number"&&t<y||typeof y=="function"&&y(t,v);if(e||!j){m(v);return}t++,(A=s.onFail)==null||A.call(s,t,v),lX(S).then(()=>d()?void 0:p()).then(()=>{e?m(v):x()})})};return{promise:r,status:()=>r.status,cancel:o,continue:()=>(n==null||n(),r),cancelRetry:l,continueRetry:c,canStart:h,start:()=>(h()?x():p().then(x),r)}}var jh,s4,jB=(s4=class{constructor(){E(this,jh)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),rX(this.gcTime)&&N(this,jh,B_.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(s){this.gcTime=Math.max(this.gcTime||0,s??(Bj?1/0:5*60*1e3))}clearGcTimeout(){u(this,jh)&&(B_.clearTimeout(u(this,jh)),N(this,jh,void 0))}},jh=new WeakMap,s4),kh,Rp,oa,Nh,bn,sb,Ah,Ga,Il,n4,yX=(n4=class extends jB{constructor(e){super();E(this,Ga);E(this,kh);E(this,Rp);E(this,oa);E(this,Nh);E(this,bn);E(this,sb);E(this,Ah);N(this,Ah,!1),N(this,sb,e.defaultOptions),this.setOptions(e.options),this.observers=[],N(this,Nh,e.client),N(this,oa,u(this,Nh).getQueryCache()),this.queryKey=e.queryKey,this.queryHash=e.queryHash,N(this,kh,oD(this.options)),this.state=e.state??u(this,kh),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var e;return(e=u(this,bn))==null?void 0:e.promise}setOptions(e){if(this.options={...u(this,sb),...e},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const t=oD(this.options);t.data!==void 0&&(this.setState(aD(t.data,t.dataUpdatedAt)),N(this,kh,t))}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&u(this,oa).remove(this)}setData(e,t){const n=cX(this.state.data,e,this.options);return F(this,Ga,Il).call(this,{data:n,type:"success",dataUpdatedAt:t==null?void 0:t.updatedAt,manual:t==null?void 0:t.manual}),n}setState(e,t){F(this,Ga,Il).call(this,{type:"setState",state:e,setStateOptions:t})}cancel(e){var n,r;const t=(n=u(this,bn))==null?void 0:n.promise;return(r=u(this,bn))==null||r.cancel(e),t?t.then(qa).catch(qa):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(u(this,kh))}isActive(){return this.observers.some(e=>aX(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===yP||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>$_(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!iX(this.state.dataUpdatedAt,e)}onFocus(){var t;const e=this.observers.find(n=>n.shouldFetchOnWindowFocus());e==null||e.refetch({cancelRefetch:!1}),(t=u(this,bn))==null||t.continue()}onOnline(){var t;const e=this.observers.find(n=>n.shouldFetchOnReconnect());e==null||e.refetch({cancelRefetch:!1}),(t=u(this,bn))==null||t.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),u(this,oa).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(t=>t!==e),this.observers.length||(u(this,bn)&&(u(this,Ah)?u(this,bn).cancel({revert:!0}):u(this,bn).cancelRetry()),this.scheduleGc()),u(this,oa).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||F(this,Ga,Il).call(this,{type:"invalidate"})}async fetch(e,t){var c,d,h,f,m,p,x,g,b,v,y,w;if(this.state.fetchStatus!=="idle"&&((c=u(this,bn))==null?void 0:c.status())!=="rejected"){if(this.state.data!==void 0&&(t!=null&&t.cancelRefetch))this.cancel({silent:!0});else if(u(this,bn))return u(this,bn).continueRetry(),u(this,bn).promise}if(e&&this.setOptions(e),!this.options.queryFn){const S=this.observers.find(j=>j.options.queryFn);S&&this.setOptions(S.options)}const n=new AbortController,r=S=>{Object.defineProperty(S,"signal",{enumerable:!0,get:()=>(N(this,Ah,!0),n.signal)})},a=()=>{const S=bB(this.options,t),A=(()=>{const k={client:u(this,Nh),queryKey:this.queryKey,meta:this.meta};return r(k),k})();return N(this,Ah,!1),this.options.persister?this.options.persister(S,A,this):S(A)},l=(()=>{const S={fetchOptions:t,options:this.options,queryKey:this.queryKey,client:u(this,Nh),state:this.state,fetchFn:a};return r(S),S})();(d=this.options.behavior)==null||d.onFetch(l,this),N(this,Rp,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((h=l.fetchOptions)==null?void 0:h.meta))&&F(this,Ga,Il).call(this,{type:"fetch",meta:(f=l.fetchOptions)==null?void 0:f.meta}),N(this,bn,SB({initialPromise:t==null?void 0:t.initialPromise,fn:l.fetchFn,onCancel:S=>{S instanceof z_&&S.revert&&this.setState({...u(this,Rp),fetchStatus:"idle"}),n.abort()},onFail:(S,j)=>{F(this,Ga,Il).call(this,{type:"failed",failureCount:S,error:j})},onPause:()=>{F(this,Ga,Il).call(this,{type:"pause"})},onContinue:()=>{F(this,Ga,Il).call(this,{type:"continue"})},retry:l.options.retry,retryDelay:l.options.retryDelay,networkMode:l.options.networkMode,canRun:()=>!0}));try{const S=await u(this,bn).start();if(S===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(S),(p=(m=u(this,oa).config).onSuccess)==null||p.call(m,S,this),(g=(x=u(this,oa).config).onSettled)==null||g.call(x,S,this.state.error,this),S}catch(S){if(S instanceof z_){if(S.silent)return u(this,bn).promise;if(S.revert){if(this.state.data===void 0)throw S;return this.state.data}}throw F(this,Ga,Il).call(this,{type:"error",error:S}),(v=(b=u(this,oa).config).onError)==null||v.call(b,S,this),(w=(y=u(this,oa).config).onSettled)==null||w.call(y,this.state.data,S,this),S}finally{this.scheduleGc()}}},kh=new WeakMap,Rp=new WeakMap,oa=new WeakMap,Nh=new WeakMap,bn=new WeakMap,sb=new WeakMap,Ah=new WeakMap,Ga=new WeakSet,Il=function(e){const t=n=>{switch(e.type){case"failed":return{...n,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...n,fetchStatus:"paused"};case"continue":return{...n,fetchStatus:"fetching"};case"fetch":return{...n,...vX(n.data,this.options),fetchMeta:e.meta??null};case"success":const r={...n,...aD(e.data,e.dataUpdatedAt),dataUpdateCount:n.dataUpdateCount+1,...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return N(this,Rp,e.manual?r:void 0),r;case"error":const a=e.error;return{...n,error:a,errorUpdateCount:n.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:n.fetchFailureCount+1,fetchFailureReason:a,fetchStatus:"idle",status:"error"};case"invalidate":return{...n,isInvalidated:!0};case"setState":return{...n,...e.state}}};this.state=t(this.state),Ar.batch(()=>{this.observers.forEach(n=>{n.onQueryUpdate()}),u(this,oa).notify({query:this,type:"updated",action:e})})},n4);function vX(s,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:CB(e.networkMode)?"fetching":"paused",...s===void 0&&{error:null,status:"pending"}}}function aD(s,e){return{data:s,dataUpdatedAt:e??Date.now(),error:null,isInvalidated:!1,status:"success"}}function oD(s){const e=typeof s.initialData=="function"?s.initialData():s.initialData,t=e!==void 0,n=t?typeof s.initialDataUpdatedAt=="function"?s.initialDataUpdatedAt():s.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:t?n??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:t?"success":"pending",fetchStatus:"idle"}}function lD(s){return{onFetch:(e,t)=>{var h,f,m,p,x;const n=e.options,r=(m=(f=(h=e.fetchOptions)==null?void 0:h.meta)==null?void 0:f.fetchMore)==null?void 0:m.direction,a=((p=e.state.data)==null?void 0:p.pages)||[],o=((x=e.state.data)==null?void 0:x.pageParams)||[];let l={pages:[],pageParams:[]},c=0;const d=async()=>{let g=!1;const b=w=>{Object.defineProperty(w,"signal",{enumerable:!0,get:()=>(e.signal.aborted?g=!0:e.signal.addEventListener("abort",()=>{g=!0}),e.signal)})},v=bB(e.options,e.fetchOptions),y=async(w,S,j)=>{if(g)return Promise.reject();if(S==null&&w.pages.length)return Promise.resolve(w);const k=(()=>{const P={client:e.client,queryKey:e.queryKey,pageParam:S,direction:j?"backward":"forward",meta:e.options.meta};return b(P),P})(),_=await v(k),{maxPages:L}=e.options,D=j?uX:dX;return{pages:D(w.pages,_,L),pageParams:D(w.pageParams,S,L)}};if(r&&a.length){const w=r==="backward",S=w?bX:cD,j={pages:a,pageParams:o},A=S(n,j);l=await y(j,A,w)}else{const w=s??a.length;do{const S=c===0?o[0]??n.initialPageParam:cD(n,l);if(c>0&&S==null)break;l=await y(l,S),c++}while(c<w)}return l};e.options.persister?e.fetchFn=()=>{var g,b;return(b=(g=e.options).persister)==null?void 0:b.call(g,d,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},t)}:e.fetchFn=d}}}function cD(s,{pages:e,pageParams:t}){const n=e.length-1;return e.length>0?s.getNextPageParam(e[n],e,t[n],t):void 0}function bX(s,{pages:e,pageParams:t}){var n;return e.length>0?(n=s.getPreviousPageParam)==null?void 0:n.call(s,e[0],e,t[0],t):void 0}var nb,Oo,yr,_h,Fo,nd,r4,wX=(r4=class extends jB{constructor(e){super();E(this,Fo);E(this,nb);E(this,Oo);E(this,yr);E(this,_h);N(this,nb,e.client),this.mutationId=e.mutationId,N(this,yr,e.mutationCache),N(this,Oo,[]),this.state=e.state||CX(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){u(this,Oo).includes(e)||(u(this,Oo).push(e),this.clearGcTimeout(),u(this,yr).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){N(this,Oo,u(this,Oo).filter(t=>t!==e)),this.scheduleGc(),u(this,yr).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){u(this,Oo).length||(this.state.status==="pending"?this.scheduleGc():u(this,yr).remove(this))}continue(){var e;return((e=u(this,_h))==null?void 0:e.continue())??this.execute(this.state.variables)}async execute(e){var o,l,c,d,h,f,m,p,x,g,b,v,y,w,S,j,A,k,_,L;const t=()=>{F(this,Fo,nd).call(this,{type:"continue"})},n={client:u(this,nb),meta:this.options.meta,mutationKey:this.options.mutationKey};N(this,_h,SB({fn:()=>this.options.mutationFn?this.options.mutationFn(e,n):Promise.reject(new Error("No mutationFn found")),onFail:(D,P)=>{F(this,Fo,nd).call(this,{type:"failed",failureCount:D,error:P})},onPause:()=>{F(this,Fo,nd).call(this,{type:"pause"})},onContinue:t,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>u(this,yr).canRun(this)}));const r=this.state.status==="pending",a=!u(this,_h).canStart();try{if(r)t();else{F(this,Fo,nd).call(this,{type:"pending",variables:e,isPaused:a}),await((l=(o=u(this,yr).config).onMutate)==null?void 0:l.call(o,e,this,n));const P=await((d=(c=this.options).onMutate)==null?void 0:d.call(c,e,n));P!==this.state.context&&F(this,Fo,nd).call(this,{type:"pending",context:P,variables:e,isPaused:a})}const D=await u(this,_h).start();return await((f=(h=u(this,yr).config).onSuccess)==null?void 0:f.call(h,D,e,this.state.context,this,n)),await((p=(m=this.options).onSuccess)==null?void 0:p.call(m,D,e,this.state.context,n)),await((g=(x=u(this,yr).config).onSettled)==null?void 0:g.call(x,D,null,this.state.variables,this.state.context,this,n)),await((v=(b=this.options).onSettled)==null?void 0:v.call(b,D,null,e,this.state.context,n)),F(this,Fo,nd).call(this,{type:"success",data:D}),D}catch(D){try{throw await((w=(y=u(this,yr).config).onError)==null?void 0:w.call(y,D,e,this.state.context,this,n)),await((j=(S=this.options).onError)==null?void 0:j.call(S,D,e,this.state.context,n)),await((k=(A=u(this,yr).config).onSettled)==null?void 0:k.call(A,void 0,D,this.state.variables,this.state.context,this,n)),await((L=(_=this.options).onSettled)==null?void 0:L.call(_,void 0,D,e,this.state.context,n)),D}finally{F(this,Fo,nd).call(this,{type:"error",error:D})}}finally{u(this,yr).runNext(this)}}},nb=new WeakMap,Oo=new WeakMap,yr=new WeakMap,_h=new WeakMap,Fo=new WeakSet,nd=function(e){const t=n=>{switch(e.type){case"failed":return{...n,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...n,isPaused:!0};case"continue":return{...n,isPaused:!1};case"pending":return{...n,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...n,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...n,data:void 0,error:e.error,failureCount:n.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=t(this.state),Ar.batch(()=>{u(this,Oo).forEach(n=>{n.onMutationUpdate(e)}),u(this,yr).notify({mutation:this,type:"updated",action:e})})},r4);function CX(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var zl,Ya,rb,i4,SX=(i4=class extends Fj{constructor(e={}){super();E(this,zl);E(this,Ya);E(this,rb);this.config=e,N(this,zl,new Set),N(this,Ya,new Map),N(this,rb,0)}build(e,t,n){const r=new wX({client:e,mutationCache:this,mutationId:++Fs(this,rb)._,options:e.defaultMutationOptions(t),state:n});return this.add(r),r}add(e){u(this,zl).add(e);const t=Vw(e);if(typeof t=="string"){const n=u(this,Ya).get(t);n?n.push(e):u(this,Ya).set(t,[e])}this.notify({type:"added",mutation:e})}remove(e){if(u(this,zl).delete(e)){const t=Vw(e);if(typeof t=="string"){const n=u(this,Ya).get(t);if(n)if(n.length>1){const r=n.indexOf(e);r!==-1&&n.splice(r,1)}else n[0]===e&&u(this,Ya).delete(t)}}this.notify({type:"removed",mutation:e})}canRun(e){const t=Vw(e);if(typeof t=="string"){const n=u(this,Ya).get(t),r=n==null?void 0:n.find(a=>a.state.status==="pending");return!r||r===e}else return!0}runNext(e){var n;const t=Vw(e);if(typeof t=="string"){const r=(n=u(this,Ya).get(t))==null?void 0:n.find(a=>a!==e&&a.state.isPaused);return(r==null?void 0:r.continue())??Promise.resolve()}else return Promise.resolve()}clear(){Ar.batch(()=>{u(this,zl).forEach(e=>{this.notify({type:"removed",mutation:e})}),u(this,zl).clear(),u(this,Ya).clear()})}getAll(){return Array.from(u(this,zl))}find(e){const t={exact:!0,...e};return this.getAll().find(n=>nD(t,n))}findAll(e={}){return this.getAll().filter(t=>nD(e,t))}notify(e){Ar.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(t=>t.state.isPaused);return Ar.batch(()=>Promise.all(e.map(t=>t.continue().catch(qa))))}},zl=new WeakMap,Ya=new WeakMap,rb=new WeakMap,i4);function Vw(s){var e;return(e=s.options.scope)==null?void 0:e.id}var Bo,a4,jX=(a4=class extends Fj{constructor(e={}){super();E(this,Bo);this.config=e,N(this,Bo,new Map)}build(e,t,n){const r=t.queryKey,a=t.queryHash??xP(r,t);let o=this.get(a);return o||(o=new yX({client:e,queryKey:r,queryHash:a,options:e.defaultQueryOptions(t),state:n,defaultOptions:e.getQueryDefaults(r)}),this.add(o)),o}add(e){u(this,Bo).has(e.queryHash)||(u(this,Bo).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=u(this,Bo).get(e.queryHash);t&&(e.destroy(),t===e&&u(this,Bo).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){Ar.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return u(this,Bo).get(e)}getAll(){return[...u(this,Bo).values()]}find(e){const t={exact:!0,...e};return this.getAll().find(n=>sD(t,n))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(n=>sD(e,n)):t}notify(e){Ar.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){Ar.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){Ar.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},Bo=new WeakMap,a4),Bs,yd,vd,Dp,Lp,bd,Op,Fp,o4,kX=(o4=class{constructor(s={}){E(this,Bs);E(this,yd);E(this,vd);E(this,Dp);E(this,Lp);E(this,bd);E(this,Op);E(this,Fp);N(this,Bs,s.queryCache||new jX),N(this,yd,s.mutationCache||new SX),N(this,vd,s.defaultOptions||{}),N(this,Dp,new Map),N(this,Lp,new Map),N(this,bd,0)}mount(){Fs(this,bd)._++,u(this,bd)===1&&(N(this,Op,wB.subscribe(async s=>{s&&(await this.resumePausedMutations(),u(this,Bs).onFocus())})),N(this,Fp,JC.subscribe(async s=>{s&&(await this.resumePausedMutations(),u(this,Bs).onOnline())})))}unmount(){var s,e;Fs(this,bd)._--,u(this,bd)===0&&((s=u(this,Op))==null||s.call(this),N(this,Op,void 0),(e=u(this,Fp))==null||e.call(this),N(this,Fp,void 0))}isFetching(s){return u(this,Bs).findAll({...s,fetchStatus:"fetching"}).length}isMutating(s){return u(this,yd).findAll({...s,status:"pending"}).length}getQueryData(s){var t;const e=this.defaultQueryOptions({queryKey:s});return(t=u(this,Bs).get(e.queryHash))==null?void 0:t.state.data}ensureQueryData(s){const e=this.defaultQueryOptions(s),t=u(this,Bs).build(this,e),n=t.state.data;return n===void 0?this.fetchQuery(s):(s.revalidateIfStale&&t.isStaleByTime($_(e.staleTime,t))&&this.prefetchQuery(e),Promise.resolve(n))}getQueriesData(s){return u(this,Bs).findAll(s).map(({queryKey:e,state:t})=>{const n=t.data;return[e,n]})}setQueryData(s,e,t){const n=this.defaultQueryOptions({queryKey:s}),r=u(this,Bs).get(n.queryHash),a=r==null?void 0:r.state.data,o=nX(e,a);if(o!==void 0)return u(this,Bs).build(this,n).setData(o,{...t,manual:!0})}setQueriesData(s,e,t){return Ar.batch(()=>u(this,Bs).findAll(s).map(({queryKey:n})=>[n,this.setQueryData(n,e,t)]))}getQueryState(s){var t;const e=this.defaultQueryOptions({queryKey:s});return(t=u(this,Bs).get(e.queryHash))==null?void 0:t.state}removeQueries(s){const e=u(this,Bs);Ar.batch(()=>{e.findAll(s).forEach(t=>{e.remove(t)})})}resetQueries(s,e){const t=u(this,Bs);return Ar.batch(()=>(t.findAll(s).forEach(n=>{n.reset()}),this.refetchQueries({type:"active",...s},e)))}cancelQueries(s,e={}){const t={revert:!0,...e},n=Ar.batch(()=>u(this,Bs).findAll(s).map(r=>r.cancel(t)));return Promise.all(n).then(qa).catch(qa)}invalidateQueries(s,e={}){return Ar.batch(()=>(u(this,Bs).findAll(s).forEach(t=>{t.invalidate()}),(s==null?void 0:s.refetchType)==="none"?Promise.resolve():this.refetchQueries({...s,type:(s==null?void 0:s.refetchType)??(s==null?void 0:s.type)??"active"},e)))}refetchQueries(s,e={}){const t={...e,cancelRefetch:e.cancelRefetch??!0},n=Ar.batch(()=>u(this,Bs).findAll(s).filter(r=>!r.isDisabled()&&!r.isStatic()).map(r=>{let a=r.fetch(void 0,t);return t.throwOnError||(a=a.catch(qa)),r.state.fetchStatus==="paused"?Promise.resolve():a}));return Promise.all(n).then(qa)}fetchQuery(s){const e=this.defaultQueryOptions(s);e.retry===void 0&&(e.retry=!1);const t=u(this,Bs).build(this,e);return t.isStaleByTime($_(e.staleTime,t))?t.fetch(e):Promise.resolve(t.state.data)}prefetchQuery(s){return this.fetchQuery(s).then(qa).catch(qa)}fetchInfiniteQuery(s){return s.behavior=lD(s.pages),this.fetchQuery(s)}prefetchInfiniteQuery(s){return this.fetchInfiniteQuery(s).then(qa).catch(qa)}ensureInfiniteQueryData(s){return s.behavior=lD(s.pages),this.ensureQueryData(s)}resumePausedMutations(){return JC.isOnline()?u(this,yd).resumePausedMutations():Promise.resolve()}getQueryCache(){return u(this,Bs)}getMutationCache(){return u(this,yd)}getDefaultOptions(){return u(this,vd)}setDefaultOptions(s){N(this,vd,s)}setQueryDefaults(s,e){u(this,Dp).set(Lv(s),{queryKey:s,defaultOptions:e})}getQueryDefaults(s){const e=[...u(this,Dp).values()],t={};return e.forEach(n=>{Ov(s,n.queryKey)&&Object.assign(t,n.defaultOptions)}),t}setMutationDefaults(s,e){u(this,Lp).set(Lv(s),{mutationKey:s,defaultOptions:e})}getMutationDefaults(s){const e=[...u(this,Lp).values()],t={};return e.forEach(n=>{Ov(s,n.mutationKey)&&Object.assign(t,n.defaultOptions)}),t}defaultQueryOptions(s){if(s._defaulted)return s;const e={...u(this,vd).queries,...this.getQueryDefaults(s.queryKey),...s,_defaulted:!0};return e.queryHash||(e.queryHash=xP(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===yP&&(e.enabled=!1),e}defaultMutationOptions(s){return s!=null&&s._defaulted?s:{...u(this,vd).mutations,...(s==null?void 0:s.mutationKey)&&this.getMutationDefaults(s.mutationKey),...s,_defaulted:!0}}clear(){u(this,Bs).clear(),u(this,yd).clear()}},Bs=new WeakMap,yd=new WeakMap,vd=new WeakMap,Dp=new WeakMap,Lp=new WeakMap,bd=new WeakMap,Op=new WeakMap,Fp=new WeakMap,o4),NX=C.createContext(void 0),AX=({client:s,children:e})=>(C.useEffect(()=>(s.mount(),()=>{s.unmount()}),[s]),i.jsx(NX.Provider,{value:s,children:e}));const H_=new WeakMap,_X=new WeakMap,eS={current:[]};let BN=!1,ov=0;const vy=new Set,Ww=new Map;function kB(s){for(const e of s){if(eS.current.includes(e))continue;eS.current.push(e),e.recompute();const t=_X.get(e);if(t)for(const n of t){const r=H_.get(n);r!=null&&r.length&&kB(r)}}}function TX(s){const e={prevVal:s.prevState,currentVal:s.state};for(const t of s.listeners)t(e)}function EX(s){const e={prevVal:s.prevState,currentVal:s.state};for(const t of s.listeners)t(e)}function NB(s){if(ov>0&&!Ww.has(s)&&Ww.set(s,s.prevState),vy.add(s),!(ov>0)&&!BN)try{for(BN=!0;vy.size>0;){const e=Array.from(vy);vy.clear();for(const t of e){const n=Ww.get(t)??t.prevState;t.prevState=n,TX(t)}for(const t of e){const n=H_.get(t);n&&(eS.current.push(t),kB(n))}for(const t of e){const n=H_.get(t);if(n)for(const r of n)EX(r)}}}finally{BN=!1,eS.current=[],Ww.clear()}}function lv(s){ov++;try{s()}finally{if(ov--,ov===0){const e=vy.values().next().value;e&&NB(e)}}}function PX(s){return typeof s=="function"}class MX{constructor(e,t){this.listeners=new Set,this.subscribe=n=>{var r,a;this.listeners.add(n);const o=(a=(r=this.options)==null?void 0:r.onSubscribe)==null?void 0:a.call(r,n,this);return()=>{this.listeners.delete(n),o==null||o()}},this.prevState=e,this.state=e,this.options=t}setState(e){var t,n,r;this.prevState=this.state,(t=this.options)!=null&&t.updateFn?this.state=this.options.updateFn(this.prevState)(e):PX(e)?this.state=e(this.prevState):this.state=e,(r=(n=this.options)==null?void 0:n.onUpdate)==null||r.call(n),NB(this)}}const Nu="__TSR_index",dD="popstate",uD="beforeunload";function IX(s){let e=s.getLocation();const t=new Set,n=o=>{e=s.getLocation(),t.forEach(l=>l({location:e,action:o}))},r=o=>{s.notifyOnIndexChange??!0?n(o):e=s.getLocation()},a=async({task:o,navigateOpts:l,...c})=>{var m,p;if((l==null?void 0:l.ignoreBlocker)??!1){o();return}const h=((m=s.getBlockers)==null?void 0:m.call(s))??[],f=c.type==="PUSH"||c.type==="REPLACE";if(typeof document<"u"&&h.length&&f)for(const x of h){const g=tS(c.path,c.state);if(await x.blockerFn({currentLocation:e,nextLocation:g,action:c.type})){(p=s.onBlocked)==null||p.call(s);return}}o()};return{get location(){return e},get length(){return s.getLength()},subscribers:t,subscribe:o=>(t.add(o),()=>{t.delete(o)}),push:(o,l,c)=>{const d=e.state[Nu];l=hD(d+1,l),a({task:()=>{s.pushState(o,l),n({type:"PUSH"})},navigateOpts:c,type:"PUSH",path:o,state:l})},replace:(o,l,c)=>{const d=e.state[Nu];l=hD(d,l),a({task:()=>{s.replaceState(o,l),n({type:"REPLACE"})},navigateOpts:c,type:"REPLACE",path:o,state:l})},go:(o,l)=>{a({task:()=>{s.go(o),r({type:"GO",index:o})},navigateOpts:l,type:"GO"})},back:o=>{a({task:()=>{s.back((o==null?void 0:o.ignoreBlocker)??!1),r({type:"BACK"})},navigateOpts:o,type:"BACK"})},forward:o=>{a({task:()=>{s.forward((o==null?void 0:o.ignoreBlocker)??!1),r({type:"FORWARD"})},navigateOpts:o,type:"FORWARD"})},canGoBack:()=>e.state[Nu]!==0,createHref:o=>s.createHref(o),block:o=>{var c;if(!s.setBlockers)return()=>{};const l=((c=s.getBlockers)==null?void 0:c.call(s))??[];return s.setBlockers([...l,o]),()=>{var h,f;const d=((h=s.getBlockers)==null?void 0:h.call(s))??[];(f=s.setBlockers)==null||f.call(s,d.filter(m=>m!==o))}},flush:()=>{var o;return(o=s.flush)==null?void 0:o.call(s)},destroy:()=>{var o;return(o=s.destroy)==null?void 0:o.call(s)},notify:n}}function hD(s,e){e||(e={});const t=vP();return{...e,key:t,__TSR_key:t,[Nu]:s}}function RX(s){var _,L;const e=typeof document<"u"?window:void 0,t=e.history.pushState,n=e.history.replaceState;let r=[];const a=()=>r,o=D=>r=D,l=D=>D,c=()=>tS(`${e.location.pathname}${e.location.search}${e.location.hash}`,e.history.state);if(!((_=e.history.state)!=null&&_.__TSR_key)&&!((L=e.history.state)!=null&&L.key)){const D=vP();e.history.replaceState({[Nu]:0,key:D,__TSR_key:D},"")}let d=c(),h,f=!1,m=!1,p=!1,x=!1;const g=()=>d;let b,v;const y=()=>{b&&(k._ignoreSubscribers=!0,(b.isPush?e.history.pushState:e.history.replaceState)(b.state,"",b.href),k._ignoreSubscribers=!1,b=void 0,v=void 0,h=void 0)},w=(D,P,T)=>{const B=l(P);v||(h=d),d=tS(P,T),b={href:B,state:T,isPush:(b==null?void 0:b.isPush)||D==="push"},v||(v=Promise.resolve().then(()=>y()))},S=D=>{d=c(),k.notify({type:D})},j=async()=>{if(m){m=!1;return}const D=c(),P=D.state[Nu]-d.state[Nu],T=P===1,B=P===-1,R=!T&&!B||f;f=!1;const O=R?"GO":B?"BACK":"FORWARD",I=R?{type:"GO",index:P}:{type:B?"BACK":"FORWARD"};if(p)p=!1;else{const U=a();if(typeof document<"u"&&U.length){for(const M of U)if(await M.blockerFn({currentLocation:d,nextLocation:D,action:O})){m=!0,e.history.go(1),k.notify(I);return}}}d=c(),k.notify(I)},A=D=>{if(x){x=!1;return}let P=!1;const T=a();if(typeof document<"u"&&T.length)for(const B of T){const R=B.enableBeforeUnload??!0;if(R===!0){P=!0;break}if(typeof R=="function"&&R()===!0){P=!0;break}}if(P)return D.preventDefault(),D.returnValue=""},k=IX({getLocation:g,getLength:()=>e.history.length,pushState:(D,P)=>w("push",D,P),replaceState:(D,P)=>w("replace",D,P),back:D=>(D&&(p=!0),x=!0,e.history.back()),forward:D=>{D&&(p=!0),x=!0,e.history.forward()},go:D=>{f=!0,e.history.go(D)},createHref:D=>l(D),flush:y,destroy:()=>{e.history.pushState=t,e.history.replaceState=n,e.removeEventListener(uD,A,{capture:!0}),e.removeEventListener(dD,j)},onBlocked:()=>{h&&d!==h&&(d=h)},getBlockers:a,setBlockers:o,notifyOnIndexChange:!1});return e.addEventListener(uD,A,{capture:!0}),e.addEventListener(dD,j),e.history.pushState=function(...D){const P=t.apply(e.history,D);return k._ignoreSubscribers||S("PUSH"),P},e.history.replaceState=function(...D){const P=n.apply(e.history,D);return k._ignoreSubscribers||S("REPLACE"),P},k}function tS(s,e){const t=s.indexOf("#"),n=s.indexOf("?"),r=vP();return{href:s,pathname:s.substring(0,t>0?n>0?Math.min(t,n):t:n>0?n:s.length),hash:t>-1?s.substring(t):"",search:n>-1?s.slice(n,t===-1?void 0:t):"",state:e||{[Nu]:0,key:r,__TSR_key:r}}}function vP(){return(Math.random()+1).toString(36).substring(7)}function sS(s){return s[s.length-1]}function DX(s){return typeof s=="function"}function Yf(s,e){return DX(s)?s(e):s}const LX=Object.prototype.hasOwnProperty;function ia(s,e){if(s===e)return s;const t=e,n=pD(s)&&pD(t);if(!n&&!(nS(s)&&nS(t)))return t;const r=n?s:fD(s);if(!r)return t;const a=n?t:fD(t);if(!a)return t;const o=r.length,l=a.length,c=n?new Array(l):{};let d=0;for(let h=0;h<l;h++){const f=n?h:a[h],m=s[f],p=t[f];if(m===p){c[f]=m,(n?h<o:LX.call(s,f))&&d++;continue}if(m===null||p===null||typeof m!="object"||typeof p!="object"){c[f]=p;continue}const x=ia(m,p);c[f]=x,x===m&&d++}return o===l&&d===o?s:c}function fD(s){const e=[],t=Object.getOwnPropertyNames(s);for(const r of t){if(!Object.prototype.propertyIsEnumerable.call(s,r))return!1;e.push(r)}const n=Object.getOwnPropertySymbols(s);for(const r of n){if(!Object.prototype.propertyIsEnumerable.call(s,r))return!1;e.push(r)}return e}function nS(s){if(!mD(s))return!1;const e=s.constructor;if(typeof e>"u")return!0;const t=e.prototype;return!(!mD(t)||!t.hasOwnProperty("isPrototypeOf"))}function mD(s){return Object.prototype.toString.call(s)==="[object Object]"}function pD(s){return Array.isArray(s)&&s.length===Object.keys(s).length}function Kf(s,e,t){if(s===e)return!0;if(typeof s!=typeof e)return!1;if(Array.isArray(s)&&Array.isArray(e)){if(s.length!==e.length)return!1;for(let n=0,r=s.length;n<r;n++)if(!Kf(s[n],e[n],t))return!1;return!0}if(nS(s)&&nS(e)){const n=(t==null?void 0:t.ignoreUndefined)??!0;if(t!=null&&t.partial){for(const o in e)if((!n||e[o]!==void 0)&&!Kf(s[o],e[o],t))return!1;return!0}let r=0;if(!n)r=Object.keys(s).length;else for(const o in s)s[o]!==void 0&&r++;let a=0;for(const o in e)if((!n||e[o]!==void 0)&&(a++,a>r||!Kf(s[o],e[o],t)))return!1;return r===a}return!1}function bx(s){let e,t;const n=new Promise((r,a)=>{e=r,t=a});return n.status="pending",n.resolve=r=>{n.status="resolved",n.value=r,e(r),s==null||s(r)},n.reject=r=>{n.status="rejected",t(r)},n}function Au(s){return!!(s&&typeof s=="object"&&typeof s.then=="function")}function gD(s){try{return decodeURI(s)}catch{return s.replaceAll(/%[0-9A-F]{2}/gi,e=>{try{return decodeURI(e)}catch{return e}})}}function xD(s,e){if(!s)return s;const t=/%25|%5C/gi;let n=0,r="",a;for(;(a=t.exec(s))!==null;)r+=gD(s.slice(n,a.index))+a[0],n=t.lastIndex;return r+gD(n?s.slice(n):s)}var OX="Invariant failed";function Dc(s,e){if(!s)throw new Error(OX)}function rS(s){const e=new Map;let t,n;const r=a=>{a.next&&(a.prev?(a.prev.next=a.next,a.next.prev=a.prev,a.next=void 0,n&&(n.next=a,a.prev=n)):(a.next.prev=void 0,t=a.next,a.next=void 0,n&&(a.prev=n,n.next=a)),n=a)};return{get(a){const o=e.get(a);if(o)return r(o),o.value},set(a,o){if(e.size>=s&&t){const c=t;e.delete(c.key),c.next&&(t=c.next,c.next.prev=void 0),c===n&&(n=void 0)}const l=e.get(a);if(l)l.value=o,r(l);else{const c={key:a,value:o,prev:n};n&&(n.next=c),n=c,t||(t=c),e.set(a,c)}},clear(){e.clear(),t=void 0,n=void 0}}}const wx=0,rm=1,im=2,Fv=3,FX=/^([^{]*)\{\$([a-zA-Z_$][a-zA-Z0-9_$]*)\}([^}]*)$/,BX=/^([^{]*)\{-\$([a-zA-Z_$][a-zA-Z0-9_$]*)\}([^}]*)$/,$X=/^([^{]*)\{\$\}([^}]*)$/;function bP(s,e,t=new Uint16Array(6)){const n=s.indexOf("/",e),r=n===-1?s.length:n,a=s.substring(e,r);if(!a||!a.includes("$"))return t[0]=wx,t[1]=e,t[2]=e,t[3]=r,t[4]=r,t[5]=r,t;if(a==="$"){const d=s.length;return t[0]=im,t[1]=e,t[2]=e,t[3]=d,t[4]=d,t[5]=d,t}if(a.charCodeAt(0)===36)return t[0]=rm,t[1]=e,t[2]=e+1,t[3]=r,t[4]=r,t[5]=r,t;const o=a.match($X);if(o){const h=o[1].length;return t[0]=im,t[1]=e+h,t[2]=e+h+1,t[3]=e+h+2,t[4]=e+h+3,t[5]=s.length,t}const l=a.match(BX);if(l){const d=l[1],h=l[2],f=l[3],m=d.length;return t[0]=Fv,t[1]=e+m,t[2]=e+m+3,t[3]=e+m+3+h.length,t[4]=r-f.length,t[5]=r,t}const c=a.match(FX);if(c){const d=c[1],h=c[2],f=c[3],m=d.length;return t[0]=rm,t[1]=e+m,t[2]=e+m+2,t[3]=e+m+2+h.length,t[4]=r-f.length,t[5]=r,t}return t[0]=wx,t[1]=e,t[2]=e,t[3]=r,t[4]=r,t[5]=r,t}function $j(s,e,t,n,r,a,o){var c,d,h,f,m;o==null||o(t);let l=n;{const p=t.fullPath??t.from,x=p.length,g=((c=t.options)==null?void 0:c.caseSensitive)??s;for(;l<x;){const b=bP(p,l,e);let v;const y=l,w=b[5];switch(l=w+1,a++,b[0]){case wx:{const j=p.substring(b[2],b[3]);if(g){const A=(d=r.static)==null?void 0:d.get(j);if(A)v=A;else{r.static??(r.static=new Map);const k=Bv(t.fullPath??t.from);k.parent=r,k.depth=a,v=k,r.static.set(j,k)}}else{const A=j.toLowerCase(),k=(h=r.staticInsensitive)==null?void 0:h.get(A);if(k)v=k;else{r.staticInsensitive??(r.staticInsensitive=new Map);const _=Bv(t.fullPath??t.from);_.parent=r,_.depth=a,v=_,r.staticInsensitive.set(A,_)}}break}case rm:{const j=p.substring(y,b[1]),A=p.substring(b[4],w),k=g&&!!(j||A),_=j?k?j:j.toLowerCase():void 0,L=A?k?A:A.toLowerCase():void 0,D=(f=r.dynamic)==null?void 0:f.find(P=>P.caseSensitive===k&&P.prefix===_&&P.suffix===L);if(D)v=D;else{const P=UN(rm,t.fullPath??t.from,k,_,L);v=P,P.depth=a,P.parent=r,r.dynamic??(r.dynamic=[]),r.dynamic.push(P)}break}case Fv:{const j=p.substring(y,b[1]),A=p.substring(b[4],w),k=g&&!!(j||A),_=j?k?j:j.toLowerCase():void 0,L=A?k?A:A.toLowerCase():void 0,D=(m=r.optional)==null?void 0:m.find(P=>P.caseSensitive===k&&P.prefix===_&&P.suffix===L);if(D)v=D;else{const P=UN(Fv,t.fullPath??t.from,k,_,L);v=P,P.parent=r,P.depth=a,r.optional??(r.optional=[]),r.optional.push(P)}break}case im:{const j=p.substring(y,b[1]),A=p.substring(b[4],w),k=g&&!!(j||A),_=j?k?j:j.toLowerCase():void 0,L=A?k?A:A.toLowerCase():void 0,D=UN(im,t.fullPath??t.from,k,_,L);v=D,D.parent=r,D.depth=a,r.wildcard??(r.wildcard=[]),r.wildcard.push(D)}}r=v}if((t.path||!t.children)&&!t.isRoot){const b=p.endsWith("/");b||(r.notFound=t),(!r.route||!r.isIndex&&b)&&(r.route=t),r.isIndex||(r.isIndex=b)}}if(t.children)for(const p of t.children)$j(s,e,p,l,r,a,o)}function $N(s,e){if(s.prefix&&e.prefix&&s.prefix!==e.prefix){if(s.prefix.startsWith(e.prefix))return-1;if(e.prefix.startsWith(s.prefix))return 1}if(s.suffix&&e.suffix&&s.suffix!==e.suffix){if(s.suffix.endsWith(e.suffix))return-1;if(e.suffix.endsWith(s.suffix))return 1}return s.prefix&&!e.prefix?-1:!s.prefix&&e.prefix?1:s.suffix&&!e.suffix?-1:!s.suffix&&e.suffix?1:s.caseSensitive&&!e.caseSensitive?-1:!s.caseSensitive&&e.caseSensitive?1:0}function fh(s){var e,t,n;if(s.static)for(const r of s.static.values())fh(r);if(s.staticInsensitive)for(const r of s.staticInsensitive.values())fh(r);if((e=s.dynamic)!=null&&e.length){s.dynamic.sort($N);for(const r of s.dynamic)fh(r)}if((t=s.optional)!=null&&t.length){s.optional.sort($N);for(const r of s.optional)fh(r)}if((n=s.wildcard)!=null&&n.length){s.wildcard.sort($N);for(const r of s.wildcard)fh(r)}}function Bv(s){return{kind:wx,depth:0,static:null,staticInsensitive:null,dynamic:null,optional:null,wildcard:null,route:null,fullPath:s,parent:null,isIndex:!1,notFound:null}}function UN(s,e,t,n,r){return{kind:s,depth:0,static:null,staticInsensitive:null,dynamic:null,optional:null,wildcard:null,route:null,fullPath:e,parent:null,isIndex:!1,notFound:null,caseSensitive:t,prefix:n,suffix:r}}function UX(s,e){const t=Bv("/"),n=new Uint16Array(6);for(const r of s)$j(!1,n,r,1,t,0);fh(t),e.masksTree=t,e.flatCache=rS(1e3)}function zX(s,e){s||(s="/");const t=e.flatCache.get(s);if(t)return t;const n=wP(s,e.masksTree);return e.flatCache.set(s,n),n}function HX(s,e,t,n,r){s||(s="/"),n||(n="/");const a=e?`case\0${s}`:s;let o=r.singleCache.get(a);if(!o){o=Bv("/");const l=new Uint16Array(6);$j(e,l,{from:s},1,o,0),r.singleCache.set(a,o)}return wP(n,o,t)}function VX(s,e,t=!1){const n=t?s:`nofuzz\0${s}`,r=e.matchCache.get(n);if(r!==void 0)return r;s||(s="/");const a=wP(s,e.segmentTree,t);return a&&(a.branch=YX(a.route)),e.matchCache.set(n,a),a}function WX(s){return s==="/"?s:s.replace(/\/{1,}$/,"")}function qX(s,e=!1,t){const n=Bv(s.fullPath),r=new Uint16Array(6),a={},o={};let l=0;return $j(e,r,s,1,n,0,d=>{if(t==null||t(d,l),Dc(!(d.id in a),`Duplicate routes found with id: ${String(d.id)}`),a[d.id]=d,l!==0&&d.path){const h=WX(d.fullPath);(!o[h]||d.fullPath.endsWith("/"))&&(o[h]=d)}l++}),fh(n),{processedTree:{segmentTree:n,singleCache:rS(1e3),matchCache:rS(1e3),flatCache:null,masksTree:null},routesById:a,routesByPath:o}}function wP(s,e,t=!1){const n=s.split("/"),r=XX(s,n,e,t);if(!r)return null;const a=GX(s,n,r),o="**"in r;return o&&(a["**"]=r["**"]),{route:o?r.node.notFound??r.node.route:r.node.route,params:a}}function GX(s,e,t){var o,l,c,d,h,f;const n=KX(t.node);let r=null;const a={};for(let m=0,p=0,x=0;p<n.length;m++,p++,x++){const g=n[p],b=e[m],v=x;if(b&&(x+=b.length),g.kind===rm){r??(r=t.node.fullPath.split("/"));const y=r[p],w=((o=g.prefix)==null?void 0:o.length)??0;if(y.charCodeAt(w)===123){const j=((l=g.suffix)==null?void 0:l.length)??0,A=y.substring(w+2,y.length-j-1),k=b.substring(w,b.length-j);a[A]=decodeURIComponent(k)}else{const j=y.substring(1);a[j]=decodeURIComponent(b)}}else if(g.kind===Fv){if(t.skipped&1<<p){m--;continue}r??(r=t.node.fullPath.split("/"));const y=r[p],w=((c=g.prefix)==null?void 0:c.length)??0,S=((d=g.suffix)==null?void 0:d.length)??0,j=y.substring(w+3,y.length-S-1),A=g.suffix||g.prefix?b.substring(w,b.length-S):b;A&&(a[j]=decodeURIComponent(A))}else if(g.kind===im){const y=g,w=s.substring(v+(((h=y.prefix)==null?void 0:h.length)??0),s.length-(((f=y.suffix)==null?void 0:f.length)??0)),S=decodeURIComponent(w);a["*"]=S,a._splat=S;break}}return a}function YX(s){const e=[s];for(;s.parentRoute;)s=s.parentRoute,e.push(s);return e.reverse(),e}function KX(s){const e=Array(s.depth+1);do e[s.depth]=s,s=s.parent;while(s);return e}function XX(s,e,t,n){const r=!sS(e),a=r&&s!=="/",o=e.length-(r?1:0),l=[{node:t,index:1,skipped:0,depth:1,statics:1,dynamics:0,optionals:0}];let c=null,d=null,h=null;for(;l.length;){const f=l.pop();let{node:m,index:p,skipped:x,depth:g,statics:b,dynamics:v,optionals:y}=f;n&&m.notFound&&zN(d,f)&&(d=f);const w=p===o;if(w){if(m.route&&(!a||m.isIndex)&&(zN(h,f)&&(h=f),b===o&&m.isIndex))return h;if(!m.optional&&!m.wildcard)continue}const S=w?void 0:e[p];let j;if(m.wildcard&&zN(c,f))for(const A of m.wildcard){const{prefix:k,suffix:_}=A;if(!(k&&(w||!(A.caseSensitive?S:j??(j=S.toLowerCase())).startsWith(k)))){if(_){if(w)continue;const L=e.slice(p).join("/").slice(-_.length);if((A.caseSensitive?L:L.toLowerCase())!==_)continue}c={node:A,index:p,skipped:x,depth:g,statics:b,dynamics:v,optionals:y};break}}if(m.optional){const A=x|1<<g,k=g+1;for(let _=m.optional.length-1;_>=0;_--){const L=m.optional[_];l.push({node:L,index:p,skipped:A,depth:k,statics:b,dynamics:v,optionals:y})}if(!w)for(let _=m.optional.length-1;_>=0;_--){const L=m.optional[_],{prefix:D,suffix:P}=L;if(D||P){const T=L.caseSensitive?S:j??(j=S.toLowerCase());if(D&&!T.startsWith(D)||P&&!T.endsWith(P))continue}l.push({node:L,index:p+1,skipped:x,depth:k,statics:b,dynamics:v,optionals:y+1})}}if(!w&&m.dynamic&&S)for(let A=m.dynamic.length-1;A>=0;A--){const k=m.dynamic[A],{prefix:_,suffix:L}=k;if(_||L){const D=k.caseSensitive?S:j??(j=S.toLowerCase());if(_&&!D.startsWith(_)||L&&!D.endsWith(L))continue}l.push({node:k,index:p+1,skipped:x,depth:g+1,statics:b,dynamics:v+1,optionals:y})}if(!w&&m.staticInsensitive){const A=m.staticInsensitive.get(j??(j=S.toLowerCase()));A&&l.push({node:A,index:p+1,skipped:x,depth:g+1,statics:b+1,dynamics:v,optionals:y})}if(!w&&m.static){const A=m.static.get(S);A&&l.push({node:A,index:p+1,skipped:x,depth:g+1,statics:b+1,dynamics:v,optionals:y})}}if(h)return h;if(c)return c;if(n&&d){let f=d.index;for(let p=0;p<d.index;p++)f+=e[p].length;const m=f===s.length?"/":s.slice(f);return{node:d.node,skipped:d.skipped,"**":decodeURIComponent(m)}}return null}function zN(s,e){return s?e.statics>s.statics||e.statics===s.statics&&(e.dynamics>s.dynamics||e.dynamics===s.dynamics&&(e.optionals>s.optionals||e.optionals===s.optionals&&(e.node.isIndex>s.node.isIndex||e.node.isIndex===s.node.isIndex&&e.depth>s.depth))):!0}function M1(s){return CP(s.filter(e=>e!==void 0).join("/"))}function CP(s){return s.replace(/\/{2,}/g,"/")}function AB(s){return s==="/"?s:s.replace(/^\/{1,}/,"")}function Xf(s){const e=s.length;return e>1&&s[e-1]==="/"?s.replace(/\/{1,}$/,""):s}function I1(s){return Xf(AB(s))}function iS(s,e){return s!=null&&s.endsWith("/")&&s!=="/"&&s!==`${e}/`?s.slice(0,-1):s}function QX(s,e,t){return iS(s,t)===iS(e,t)}function ZX({base:s,to:e,trailingSlash:t="never",cache:n}){const r=e.startsWith("/"),a=!r&&e===".";let o;if(n){o=r?e:a?s:s+"\0"+e;const f=n.get(o);if(f)return f}let l;if(a)l=s.split("/");else if(r)l=e.split("/");else{for(l=s.split("/");l.length>1&&sS(l)==="";)l.pop();const f=e.split("/");for(let m=0,p=f.length;m<p;m++){const x=f[m];x===""?m?m===p-1&&l.push(x):l=[x]:x===".."?l.pop():x==="."||l.push(x)}}l.length>1&&(sS(l)===""?t==="never"&&l.pop():t==="always"&&l.push(""));let c,d="";for(let f=0;f<l.length;f++){f>0&&(d+="/");const m=l[f];if(!m)continue;c=bP(m,0,c);const p=c[0];if(p===wx){d+=m;continue}const x=c[5],g=m.substring(0,c[1]),b=m.substring(c[4],x),v=m.substring(c[2],c[3]);p===rm?d+=g||b?`${g}{$${v}}${b}`:`$${v}`:p===im?d+=g||b?`${g}{$}${b}`:"$":d+=`${g}{-$${v}}${b}`}d=CP(d);const h=d||"/";return o&&n&&n.set(o,h),h}function HN(s,e,t){const n=e[s];return typeof n!="string"?n:s==="_splat"?encodeURI(n):JX(n,t)}function VN({path:s,params:e,decodeCharMap:t}){let n=!1;const r={};if(!s||s==="/")return{interpolatedPath:"/",usedParams:r,isMissingParams:n};if(!s.includes("$"))return{interpolatedPath:s,usedParams:r,isMissingParams:n};const a=s.length;let o=0,l,c="";for(;o<a;){const h=o;l=bP(s,h,l);const f=l[5];if(o=f+1,h===f)continue;const m=l[0];if(m===wx){c+="/"+s.substring(h,f);continue}if(m===im){const p=e._splat;r._splat=p,r["*"]=p;const x=s.substring(h,l[1]),g=s.substring(l[4],f);if(!p){n=!0,(x||g)&&(c+="/"+x+g);continue}const b=HN("_splat",e,t);c+="/"+x+b+g;continue}if(m===rm){const p=s.substring(l[2],l[3]);!n&&!(p in e)&&(n=!0),r[p]=e[p];const x=s.substring(h,l[1]),g=s.substring(l[4],f),b=HN(p,e,t)??"undefined";c+="/"+x+b+g;continue}if(m===Fv){const p=s.substring(l[2],l[3]),x=e[p];if(x==null)continue;r[p]=x;const g=s.substring(h,l[1]),b=s.substring(l[4],f),v=HN(p,e,t)??"";c+="/"+g+v+b;continue}}return s.endsWith("/")&&(c+="/"),{usedParams:r,interpolatedPath:c||"/",isMissingParams:n}}function JX(s,e){let t=encodeURIComponent(s);if(e)for(const[n,r]of e)t=t.replaceAll(n,r);return t}function Ta(s){return!!(s!=null&&s.isNotFound)}function eQ(){try{if(typeof window<"u"&&typeof window.sessionStorage=="object")return window.sessionStorage}catch{}}const aS="tsr-scroll-restoration-v1_3",tQ=(s,e)=>{let t;return(...n)=>{t||(t=setTimeout(()=>{s(...n),t=null},e))}};function sQ(){const s=eQ();if(!s)return null;const e=s.getItem(aS);let t=e?JSON.parse(e):{};return{state:t,set:n=>(t=Yf(n,t)||t,s.setItem(aS,JSON.stringify(t)))}}const qw=sQ(),V_=s=>s.state.__TSR_key||s.href;function nQ(s){const e=[];let t;for(;t=s.parentNode;)e.push(`${s.tagName}:nth-child(${Array.prototype.indexOf.call(t.children,s)+1})`),s=t;return`${e.reverse().join(" > ")}`.toLowerCase()}let oS=!1;function _B({storageKey:s,key:e,behavior:t,shouldScrollRestoration:n,scrollToTopSelectors:r,location:a}){var d,h;let o;try{o=JSON.parse(sessionStorage.getItem(s)||"{}")}catch(f){console.error(f);return}const l=e||((d=window.history.state)==null?void 0:d.__TSR_key),c=o[l];oS=!0;e:{if(n&&c&&Object.keys(c).length>0){for(const p in c){const x=c[p];if(p==="window")window.scrollTo({top:x.scrollY,left:x.scrollX,behavior:t});else if(p){const g=document.querySelector(p);g&&(g.scrollLeft=x.scrollX,g.scrollTop=x.scrollY)}}break e}const f=(a??window.location).hash.split("#",2)[1];if(f){const p=((h=window.history.state)==null?void 0:h.__hashScrollIntoViewOptions)??!0;if(p){const x=document.getElementById(f);x&&x.scrollIntoView(p)}break e}const m={top:0,left:0,behavior:t};if(window.scrollTo(m),r)for(const p of r){if(p==="window")continue;const x=typeof p=="function"?p():document.querySelector(p);x&&x.scrollTo(m)}}oS=!1}function rQ(s,e){if(!qw&&!s.isServer||((s.options.scrollRestoration??!1)&&(s.isScrollRestoring=!0),s.isServer||s.isScrollRestorationSetup||!qw))return;s.isScrollRestorationSetup=!0,oS=!1;const n=s.options.getScrollRestorationKey||V_;window.history.scrollRestoration="manual";const r=a=>{if(oS||!s.isScrollRestoring)return;let o="";if(a.target===document||a.target===window)o="window";else{const c=a.target.getAttribute("data-scroll-restoration-id");c?o=`[data-scroll-restoration-id="${c}"]`:o=nQ(a.target)}const l=n(s.state.location);qw.set(c=>{const d=c[l]||(c[l]={}),h=d[o]||(d[o]={});if(o==="window")h.scrollX=window.scrollX||0,h.scrollY=window.scrollY||0;else if(o){const f=document.querySelector(o);f&&(h.scrollX=f.scrollLeft||0,h.scrollY=f.scrollTop||0)}return c})};typeof document<"u"&&document.addEventListener("scroll",tQ(r,100),!0),s.subscribe("onRendered",a=>{const o=n(a.toLocation);if(!s.resetNextScroll){s.resetNextScroll=!0;return}typeof s.options.scrollRestoration=="function"&&!s.options.scrollRestoration({location:s.latestLocation})||(_B({storageKey:aS,key:o,behavior:s.options.scrollRestorationBehavior,shouldScrollRestoration:s.isScrollRestoring,scrollToTopSelectors:s.options.scrollToTopSelectors,location:s.history.location}),s.isScrollRestoring&&qw.set(l=>(l[o]||(l[o]={}),l)))})}function iQ(s){if(typeof document<"u"&&document.querySelector){const e=s.state.location.state.__hashScrollIntoViewOptions??!0;if(e&&s.state.location.hash!==""){const t=document.getElementById(s.state.location.hash);t&&t.scrollIntoView(e)}}}function aQ(s,e=String){const t=new URLSearchParams;for(const n in s){const r=s[n];r!==void 0&&t.set(n,e(r))}return t.toString()}function WN(s){return s?s==="false"?!1:s==="true"?!0:+s*0===0&&+s+""===s?+s:s:""}function oQ(s){const e=new URLSearchParams(s),t={};for(const[n,r]of e.entries()){const a=t[n];a==null?t[n]=WN(r):Array.isArray(a)?a.push(WN(r)):t[n]=[a,WN(r)]}return t}const lQ=dQ(JSON.parse),cQ=uQ(JSON.stringify,JSON.parse);function dQ(s){return e=>{e[0]==="?"&&(e=e.substring(1));const t=oQ(e);for(const n in t){const r=t[n];if(typeof r=="string")try{t[n]=s(r)}catch{}}return t}}function uQ(s,e){const t=typeof e=="function";function n(r){if(typeof r=="object"&&r!==null)try{return s(r)}catch{}else if(t&&typeof r=="string")try{return e(r),s(r)}catch{}return r}return r=>{const a=aQ(r,n);return a?`?${a}`:""}}const Li="__root__";function hQ(s){if(s.statusCode=s.statusCode||s.code||307,!s.reloadDocument&&typeof s.href=="string")try{new URL(s.href),s.reloadDocument=!0}catch{}const e=new Headers(s.headers);s.href&&e.get("Location")===null&&e.set("Location",s.href);const t=new Response(null,{status:s.statusCode,headers:e});if(t.options=s,s.throw)throw t;return t}function po(s){return s instanceof Response&&!!s.options}const R1=s=>{var e;if(!s.rendered)return s.rendered=!0,(e=s.onReady)==null?void 0:e.call(s)},Uj=(s,e)=>!!(s.preload&&!s.router.state.matches.some(t=>t.id===e)),TB=(s,e)=>{var r;const t=s.router.routesById[e.routeId??""]??s.router.routeTree;!t.options.notFoundComponent&&((r=s.router.options)!=null&&r.defaultNotFoundComponent)&&(t.options.notFoundComponent=s.router.options.defaultNotFoundComponent),Dc(t.options.notFoundComponent);const n=s.matches.find(a=>a.routeId===t.id);Dc(n,"Could not find match for route: "+t.id),s.updateMatch(n.id,a=>({...a,status:"notFound",error:e,isFetching:!1})),e.routerCode==="BEFORE_LOAD"&&t.parentRoute&&(e.routeId=t.parentRoute.id,TB(s,e))},pu=(s,e,t)=>{var n,r,a;if(!(!po(t)&&!Ta(t))){if(po(t)&&t.redirectHandled&&!t.options.reloadDocument)throw t;if(e){(n=e._nonReactive.beforeLoadPromise)==null||n.resolve(),(r=e._nonReactive.loaderPromise)==null||r.resolve(),e._nonReactive.beforeLoadPromise=void 0,e._nonReactive.loaderPromise=void 0;const o=po(t)?"redirected":"notFound";e._nonReactive.error=t,s.updateMatch(e.id,l=>({...l,status:o,isFetching:!1,error:t})),Ta(t)&&!t.routeId&&(t.routeId=e.routeId),(a=e._nonReactive.loadPromise)==null||a.resolve()}throw po(t)?(s.rendered=!0,t.options._fromLocation=s.location,t.redirectHandled=!0,t=s.router.resolveRedirect(t),t):(TB(s,t),t)}},EB=(s,e)=>{const t=s.router.getMatch(e);return!!(!s.router.isServer&&t._nonReactive.dehydrated||s.router.isServer&&t.ssr===!1)},Qx=(s,e,t,n)=>{var l,c;const{id:r,routeId:a}=s.matches[e],o=s.router.looseRoutesById[a];if(t instanceof Promise)throw t;t.routerCode=n,s.firstBadMatchIndex??(s.firstBadMatchIndex=e),pu(s,s.router.getMatch(r),t);try{(c=(l=o.options).onError)==null||c.call(l,t)}catch(d){t=d,pu(s,s.router.getMatch(r),t)}s.updateMatch(r,d=>{var h,f;return(h=d._nonReactive.beforeLoadPromise)==null||h.resolve(),d._nonReactive.beforeLoadPromise=void 0,(f=d._nonReactive.loadPromise)==null||f.resolve(),{...d,error:t,status:"error",isFetching:!1,updatedAt:Date.now(),abortController:new AbortController}})},fQ=(s,e,t,n)=>{var p;const r=s.router.getMatch(e),a=(p=s.matches[t-1])==null?void 0:p.id,o=a?s.router.getMatch(a):void 0;if(s.router.isShell()){r.ssr=n.id===Li;return}if((o==null?void 0:o.ssr)===!1){r.ssr=!1;return}const l=x=>x===!0&&(o==null?void 0:o.ssr)==="data-only"?"data-only":x,c=s.router.options.defaultSsr??!0;if(n.options.ssr===void 0){r.ssr=l(c);return}if(typeof n.options.ssr!="function"){r.ssr=l(n.options.ssr);return}const{search:d,params:h}=r,f={search:Gw(d,r.searchError),params:Gw(h,r.paramsError),location:s.location,matches:s.matches.map(x=>({index:x.index,pathname:x.pathname,fullPath:x.fullPath,staticData:x.staticData,id:x.id,routeId:x.routeId,search:Gw(x.search,x.searchError),params:Gw(x.params,x.paramsError),ssr:x.ssr}))},m=n.options.ssr(f);if(Au(m))return m.then(x=>{r.ssr=l(x??c)});r.ssr=l(m??c)},PB=(s,e,t,n)=>{var o;if(n._nonReactive.pendingTimeout!==void 0)return;const r=t.options.pendingMs??s.router.options.defaultPendingMs;if(!!(s.onReady&&!s.router.isServer&&!Uj(s,e)&&(t.options.loader||t.options.beforeLoad||RB(t))&&typeof r=="number"&&r!==1/0&&(t.options.pendingComponent??((o=s.router.options)==null?void 0:o.defaultPendingComponent)))){const l=setTimeout(()=>{R1(s)},r);n._nonReactive.pendingTimeout=l}},mQ=(s,e,t)=>{const n=s.router.getMatch(e);if(!n._nonReactive.beforeLoadPromise&&!n._nonReactive.loaderPromise)return;PB(s,e,t,n);const r=()=>{const a=s.router.getMatch(e);a.preload&&(a.status==="redirected"||a.status==="notFound")&&pu(s,a,a.error)};return n._nonReactive.beforeLoadPromise?n._nonReactive.beforeLoadPromise.then(r):r()},pQ=(s,e,t,n)=>{var k;const r=s.router.getMatch(e),a=r._nonReactive.loadPromise;r._nonReactive.loadPromise=bx(()=>{a==null||a.resolve()});const{paramsError:o,searchError:l}=r;o&&Qx(s,t,o,"PARSE_PARAMS"),l&&Qx(s,t,l,"VALIDATE_SEARCH"),PB(s,e,n,r);const c=new AbortController,d=(k=s.matches[t-1])==null?void 0:k.id,h=d?s.router.getMatch(d):void 0,m={...(h==null?void 0:h.context)??s.router.options.context??void 0,...r.__routeContext};let p=!1;const x=()=>{p||(p=!0,s.updateMatch(e,_=>({..._,isFetching:"beforeLoad",fetchCount:_.fetchCount+1,abortController:c,context:m})))},g=()=>{var _;(_=r._nonReactive.beforeLoadPromise)==null||_.resolve(),r._nonReactive.beforeLoadPromise=void 0,s.updateMatch(e,L=>({...L,isFetching:!1}))};if(!n.options.beforeLoad){lv(()=>{x(),g()});return}r._nonReactive.beforeLoadPromise=bx();const{search:b,params:v,cause:y}=r,w=Uj(s,e),S={search:b,abortController:c,params:v,preload:w,context:m,location:s.location,navigate:_=>s.router.navigate({..._,_fromLocation:s.location}),buildLocation:s.router.buildLocation,cause:w?"preload":y,matches:s.matches,...s.router.options.additionalContext},j=_=>{if(_===void 0){lv(()=>{x(),g()});return}(po(_)||Ta(_))&&(x(),Qx(s,t,_,"BEFORE_LOAD")),lv(()=>{x(),s.updateMatch(e,L=>({...L,__beforeLoadContext:_,context:{...L.context,..._}})),g()})};let A;try{if(A=n.options.beforeLoad(S),Au(A))return x(),A.catch(_=>{Qx(s,t,_,"BEFORE_LOAD")}).then(j)}catch(_){x(),Qx(s,t,_,"BEFORE_LOAD")}j(A)},gQ=(s,e)=>{const{id:t,routeId:n}=s.matches[e],r=s.router.looseRoutesById[n],a=()=>{if(s.router.isServer){const c=fQ(s,t,e,r);if(Au(c))return c.then(l)}return l()},o=()=>pQ(s,t,e,r),l=()=>{if(EB(s,t))return;const c=mQ(s,t,r);return Au(c)?c.then(o):o()};return a()},cv=(s,e,t)=>{var a,o,l,c,d,h;const n=s.router.getMatch(e);if(!n||!t.options.head&&!t.options.scripts&&!t.options.headers)return;const r={matches:s.matches,match:n,params:n.params,loaderData:n.loaderData};return Promise.all([(o=(a=t.options).head)==null?void 0:o.call(a,r),(c=(l=t.options).scripts)==null?void 0:c.call(l,r),(h=(d=t.options).headers)==null?void 0:h.call(d,r)]).then(([f,m,p])=>{const x=f==null?void 0:f.meta,g=f==null?void 0:f.links,b=f==null?void 0:f.scripts,v=f==null?void 0:f.styles;return{meta:x,links:g,headScripts:b,headers:p,scripts:m,styles:v}})},MB=(s,e,t,n)=>{const r=s.matchPromises[t-1],{params:a,loaderDeps:o,abortController:l,cause:c}=s.router.getMatch(e);let d=s.router.options.context??{};for(let f=0;f<=t;f++){const m=s.matches[f];if(!m)continue;const p=s.router.getMatch(m.id);p&&(d={...d,...p.__routeContext??{},...p.__beforeLoadContext??{}})}const h=Uj(s,e);return{params:a,deps:o,preload:!!h,parentMatchPromise:r,abortController:l,context:d,location:s.location,navigate:f=>s.router.navigate({...f,_fromLocation:s.location}),cause:h?"preload":c,route:n,...s.router.options.additionalContext}},yD=async(s,e,t,n)=>{var r,a,o,l,c,d;try{const h=s.router.getMatch(e);try{(!s.router.isServer||h.ssr===!0)&&IB(n);const f=(a=(r=n.options).loader)==null?void 0:a.call(r,MB(s,e,t,n)),m=n.options.loader&&Au(f);if(!!(m||n._lazyPromise||n._componentsPromise||n.options.head||n.options.scripts||n.options.headers||h._nonReactive.minPendingPromise)&&s.updateMatch(e,v=>({...v,isFetching:"loader"})),n.options.loader){const v=m?await f:f;pu(s,s.router.getMatch(e),v),v!==void 0&&s.updateMatch(e,y=>({...y,loaderData:v}))}n._lazyPromise&&await n._lazyPromise;const x=cv(s,e,n),g=x?await x:void 0,b=h._nonReactive.minPendingPromise;b&&await b,n._componentsPromise&&await n._componentsPromise,s.updateMatch(e,v=>({...v,error:void 0,status:"success",isFetching:!1,updatedAt:Date.now(),...g}))}catch(f){let m=f;const p=h._nonReactive.minPendingPromise;p&&await p,Ta(f)&&await((l=(o=n.options.notFoundComponent)==null?void 0:o.preload)==null?void 0:l.call(o)),pu(s,s.router.getMatch(e),f);try{(d=(c=n.options).onError)==null||d.call(c,f)}catch(b){m=b,pu(s,s.router.getMatch(e),b)}const x=cv(s,e,n),g=x?await x:void 0;s.updateMatch(e,b=>({...b,error:m,status:"error",isFetching:!1,...g}))}}catch(h){const f=s.router.getMatch(e);if(f){const m=cv(s,e,n);if(m){const p=await m;s.updateMatch(e,x=>({...x,...p}))}f._nonReactive.loaderPromise=void 0}pu(s,f,h)}},xQ=async(s,e)=>{var d,h;const{id:t,routeId:n}=s.matches[e];let r=!1,a=!1;const o=s.router.looseRoutesById[n];if(EB(s,t)){if(s.router.isServer){const f=cv(s,t,o);if(f){const m=await f;s.updateMatch(t,p=>({...p,...m}))}return s.router.getMatch(t)}}else{const f=s.router.getMatch(t);if(f._nonReactive.loaderPromise){if(f.status==="success"&&!s.sync&&!f.preload)return f;await f._nonReactive.loaderPromise;const m=s.router.getMatch(t),p=m._nonReactive.error||m.error;p&&pu(s,m,p)}else{const m=Date.now()-f.updatedAt,p=Uj(s,t),x=p?o.options.preloadStaleTime??s.router.options.defaultPreloadStaleTime??3e4:o.options.staleTime??s.router.options.defaultStaleTime??0,g=o.options.shouldReload,b=typeof g=="function"?g(MB(s,t,e,o)):g,v=!!p&&!s.router.state.matches.some(j=>j.id===t),y=s.router.getMatch(t);y._nonReactive.loaderPromise=bx(),v!==y.preload&&s.updateMatch(t,j=>({...j,preload:v}));const{status:w,invalid:S}=y;if(r=w==="success"&&(S||(b??m>x)),!(p&&o.options.preload===!1))if(r&&!s.sync)a=!0,(async()=>{var j,A;try{await yD(s,t,e,o);const k=s.router.getMatch(t);(j=k._nonReactive.loaderPromise)==null||j.resolve(),(A=k._nonReactive.loadPromise)==null||A.resolve(),k._nonReactive.loaderPromise=void 0}catch(k){po(k)&&await s.router.navigate(k.options)}})();else if(w!=="success"||r&&s.sync)await yD(s,t,e,o);else{const j=cv(s,t,o);if(j){const A=await j;s.updateMatch(t,k=>({...k,...A}))}}}}const l=s.router.getMatch(t);a||((d=l._nonReactive.loaderPromise)==null||d.resolve(),(h=l._nonReactive.loadPromise)==null||h.resolve()),clearTimeout(l._nonReactive.pendingTimeout),l._nonReactive.pendingTimeout=void 0,a||(l._nonReactive.loaderPromise=void 0),l._nonReactive.dehydrated=void 0;const c=a?l.isFetching:!1;return c!==l.isFetching||l.invalid!==!1?(s.updateMatch(t,f=>({...f,isFetching:c,invalid:!1})),s.router.getMatch(t)):l};async function vD(s){const e=Object.assign(s,{matchPromises:[]});!e.router.isServer&&e.router.state.matches.some(t=>t._forcePending)&&R1(e);try{for(let r=0;r<e.matches.length;r++){const a=gQ(e,r);Au(a)&&await a}const t=e.firstBadMatchIndex??e.matches.length;for(let r=0;r<t;r++)e.matchPromises.push(xQ(e,r));await Promise.all(e.matchPromises);const n=R1(e);Au(n)&&await n}catch(t){if(Ta(t)&&!e.preload){const n=R1(e);throw Au(n)&&await n,t}if(po(t))throw t}return e.matches}async function IB(s){if(!s._lazyLoaded&&s._lazyPromise===void 0&&(s.lazyFn?s._lazyPromise=s.lazyFn().then(e=>{const{id:t,...n}=e.options;Object.assign(s.options,n),s._lazyLoaded=!0,s._lazyPromise=void 0}):s._lazyLoaded=!0),!s._componentsLoaded&&s._componentsPromise===void 0){const e=()=>{var n;const t=[];for(const r of DB){const a=(n=s.options[r])==null?void 0:n.preload;a&&t.push(a())}if(t.length)return Promise.all(t).then(()=>{s._componentsLoaded=!0,s._componentsPromise=void 0});s._componentsLoaded=!0,s._componentsPromise=void 0};s._componentsPromise=s._lazyPromise?s._lazyPromise.then(e):e()}return s._componentsPromise}function Gw(s,e){return e?{status:"error",error:e}:{status:"success",value:s}}function RB(s){var e;for(const t of DB)if((e=s.options[t])!=null&&e.preload)return!0;return!1}const DB=["component","errorComponent","pendingComponent","notFoundComponent"];function yQ(s){return{input:({url:e})=>{for(const t of s)e=LB(t,e);return e},output:({url:e})=>{for(let t=s.length-1;t>=0;t--)e=OB(s[t],e);return e}}}function vQ(s){const e=I1(s.basepath),t=`/${e}`,n=`${t}/`,r=s.caseSensitive?t:t.toLowerCase(),a=s.caseSensitive?n:n.toLowerCase();return{input:({url:o})=>{const l=s.caseSensitive?o.pathname:o.pathname.toLowerCase();return l===r?o.pathname="/":l.startsWith(a)&&(o.pathname=o.pathname.slice(t.length)),o},output:({url:o})=>(o.pathname=M1(["/",e,o.pathname]),o)}}function LB(s,e){var n;const t=(n=s==null?void 0:s.input)==null?void 0:n.call(s,{url:e});if(t){if(typeof t=="string")return new URL(t);if(t instanceof URL)return t}return e}function OB(s,e){var n;const t=(n=s==null?void 0:s.output)==null?void 0:n.call(s,{url:e});if(t){if(typeof t=="string")return new URL(t);if(t instanceof URL)return t}return e}function Qf(s){const e=s.resolvedLocation,t=s.location,n=(e==null?void 0:e.pathname)!==t.pathname,r=(e==null?void 0:e.href)!==t.href,a=(e==null?void 0:e.hash)!==t.hash;return{fromLocation:e,toLocation:t,pathChanged:n,hrefChanged:r,hashChanged:a}}class bQ{constructor(e){this.tempLocationKey=`${Math.round(Math.random()*1e7)}`,this.resetNextScroll=!0,this.shouldViewTransition=void 0,this.isViewTransitionTypesSupported=void 0,this.subscribers=new Set,this.isScrollRestoring=!1,this.isScrollRestorationSetup=!1,this.startTransition=t=>t(),this.update=t=>{var m;t.notFoundRoute&&console.warn("The notFoundRoute API is deprecated and will be removed in the next major version. See https://tanstack.com/router/v1/docs/framework/react/guide/not-found-errors#migrating-from-notfoundroute for more info.");const n=this.options,r=this.basepath??(n==null?void 0:n.basepath)??"/",a=this.basepath===void 0,o=n==null?void 0:n.rewrite;this.options={...n,...t},this.isServer=this.options.isServer??typeof document>"u",this.pathParamsDecodeCharMap=this.options.pathParamsAllowedCharacters?new Map(this.options.pathParamsAllowedCharacters.map(p=>[encodeURIComponent(p),p])):void 0,(!this.history||this.options.history&&this.options.history!==this.history)&&(this.options.history?this.history=this.options.history:this.isServer||(this.history=RX())),this.origin=this.options.origin,this.origin||(!this.isServer&&(window!=null&&window.origin)&&window.origin!=="null"?this.origin=window.origin:this.origin="http://localhost"),this.history&&this.updateLatestLocation(),this.options.routeTree!==this.routeTree&&(this.routeTree=this.options.routeTree,this.buildRouteTree()),!this.__store&&this.latestLocation&&(this.__store=new MX(CQ(this.latestLocation),{onUpdate:()=>{this.__store.state={...this.state,cachedMatches:this.state.cachedMatches.filter(p=>!["redirected"].includes(p.status))}}}),rQ(this));let l=!1;const c=this.options.basepath??"/",d=this.options.rewrite;if(a||r!==c||o!==d){this.basepath=c;const p=[];I1(c)!==""&&p.push(vQ({basepath:c})),d&&p.push(d),this.rewrite=p.length===0?void 0:p.length===1?p[0]:yQ(p),this.history&&this.updateLatestLocation(),l=!0}l&&this.__store&&(this.__store.state={...this.state,location:this.latestLocation}),typeof window<"u"&&"CSS"in window&&typeof((m=window.CSS)==null?void 0:m.supports)=="function"&&(this.isViewTransitionTypesSupported=window.CSS.supports("selector(:active-view-transition-type(a)"))},this.updateLatestLocation=()=>{this.latestLocation=this.parseLocation(this.history.location,this.latestLocation)},this.buildRouteTree=()=>{const{routesById:t,routesByPath:n,processedTree:r}=qX(this.routeTree,this.options.caseSensitive,(o,l)=>{o.init({originalIndex:l})});this.options.routeMasks&&UX(this.options.routeMasks,r),this.routesById=t,this.routesByPath=n,this.processedTree=r;const a=this.options.notFoundRoute;a&&(a.init({originalIndex:99999999999}),this.routesById[a.id]=a)},this.subscribe=(t,n)=>{const r={eventType:t,fn:n};return this.subscribers.add(r),()=>{this.subscribers.delete(r)}},this.emit=t=>{this.subscribers.forEach(n=>{n.eventType===t.type&&n.fn(t)})},this.parseLocation=(t,n)=>{const r=({href:c,state:d})=>{const h=new URL(c,this.origin),f=LB(this.rewrite,h),m=this.options.parseSearch(f.search),p=this.options.stringifySearch(m);f.search=p;const x=f.href.replace(f.origin,""),{pathname:g,hash:b}=f;return{href:x,publicHref:c,url:f.href,pathname:xD(g),searchStr:p,search:ia(n==null?void 0:n.search,m),hash:b.split("#").reverse()[0]??"",state:ia(n==null?void 0:n.state,d)}},a=r(t),{__tempLocation:o,__tempKey:l}=a.state;if(o&&(!l||l===this.tempLocationKey)){const c=r(o);return c.state.key=a.state.key,c.state.__TSR_key=a.state.__TSR_key,delete c.state.__tempLocation,{...c,maskedLocation:a}}return a},this.resolvePathCache=rS(1e3),this.resolvePathWithBase=(t,n)=>ZX({base:t,to:CP(n),trailingSlash:this.options.trailingSlash,cache:this.resolvePathCache}),this.matchRoutes=(t,n,r)=>typeof t=="string"?this.matchRoutesInternal({pathname:t,search:n},r):this.matchRoutesInternal(t,n),this.getMatchedRoutes=t=>SQ({pathname:t,routesById:this.routesById,processedTree:this.processedTree}),this.cancelMatch=t=>{const n=this.getMatch(t);n&&(n.abortController.abort(),clearTimeout(n._nonReactive.pendingTimeout),n._nonReactive.pendingTimeout=void 0)},this.cancelMatches=()=>{const t=this.state.matches.filter(a=>a.status==="pending"),n=this.state.matches.filter(a=>a.isFetching==="loader");new Set([...this.state.pendingMatches??[],...t,...n]).forEach(a=>{this.cancelMatch(a.id)})},this.buildLocation=t=>{const n=(a={})=>{var D,P;const o=a._fromLocation||this.pendingBuiltLocation||this.latestLocation,l=this.matchRoutes(o,{_buildLocation:!0}),c=sS(l);a.from;const d=a.unsafeRelative==="path"?o.pathname:a.from??c.fullPath,h=this.resolvePathWithBase(d,"."),f=c.search,m={...c.params},p=a.to?this.resolvePathWithBase(h,`${a.to}`):this.resolvePathWithBase(h,"."),x=a.params===!1||a.params===null?{}:(a.params??!0)===!0?m:Object.assign(m,Yf(a.params,m)),g=VN({path:p,params:x}).interpolatedPath,b=this.matchRoutes(g,void 0,{_buildLocation:!0}).map(T=>this.looseRoutesById[T.routeId]);if(Object.keys(x).length>0)for(const T of b){const B=((D=T.options.params)==null?void 0:D.stringify)??T.options.stringifyParams;B&&Object.assign(x,B(x))}const v=t.leaveParams?p:xD(VN({path:p,params:x,decodeCharMap:this.pathParamsDecodeCharMap}).interpolatedPath);let y=f;if(t._includeValidateSearch&&((P=this.options.search)!=null&&P.strict)){const T={};b.forEach(B=>{if(B.options.validateSearch)try{Object.assign(T,W_(B.options.validateSearch,{...T,...y}))}catch{}}),y=T}y=jQ({search:y,dest:a,destRoutes:b,_includeValidateSearch:t._includeValidateSearch}),y=ia(f,y);const w=this.options.stringifySearch(y),S=a.hash===!0?o.hash:a.hash?Yf(a.hash,o.hash):void 0,j=S?`#${S}`:"";let A=a.state===!0?o.state:a.state?Yf(a.state,o.state):{};A=ia(o.state,A);const k=`${v}${w}${j}`,_=new URL(k,this.origin),L=OB(this.rewrite,_);return{publicHref:L.pathname+L.search+L.hash,href:k,url:L.href,pathname:v,search:y,searchStr:w,state:A,hash:S??"",unmaskOnReload:a.unmaskOnReload}},r=(a={},o)=>{const l=n(a);let c=o?n(o):void 0;if(!c){const d={};if(this.options.routeMasks){const h=zX(l.pathname,this.processedTree);if(h){Object.assign(d,h.params);const{from:f,...m}=h.route;o={from:t.from,...m,params:d},c=n(o)}}}return c&&(l.maskedLocation=c),l};return t.mask?r(t,{from:t.from,...t.mask}):r(t)},this.commitLocation=({viewTransition:t,ignoreBlocker:n,...r})=>{const a=()=>{const c=["key","__TSR_key","__TSR_index","__hashScrollIntoViewOptions"];c.forEach(h=>{r.state[h]=this.latestLocation.state[h]});const d=Kf(r.state,this.latestLocation.state);return c.forEach(h=>{delete r.state[h]}),d},o=Xf(this.latestLocation.href)===Xf(r.href),l=this.commitLocationPromise;if(this.commitLocationPromise=bx(()=>{l==null||l.resolve()}),o&&a())this.load();else{let{maskedLocation:c,hashScrollIntoView:d,...h}=r;c&&(h={...c,state:{...c.state,__tempKey:void 0,__tempLocation:{...h,search:h.searchStr,state:{...h.state,__tempKey:void 0,__tempLocation:void 0,__TSR_key:void 0,key:void 0}}}},(h.unmaskOnReload??this.options.unmaskOnReload??!1)&&(h.state.__tempKey=this.tempLocationKey)),h.state.__hashScrollIntoViewOptions=d??this.options.defaultHashScrollIntoView??!0,this.shouldViewTransition=t,this.history[r.replace?"replace":"push"](h.publicHref,h.state,{ignoreBlocker:n})}return this.resetNextScroll=r.resetScroll??!0,this.history.subscribers.size||this.load(),this.commitLocationPromise},this.buildAndCommitLocation=({replace:t,resetScroll:n,hashScrollIntoView:r,viewTransition:a,ignoreBlocker:o,href:l,...c}={})=>{if(l){const f=this.history.location.state.__TSR_index,m=tS(l,{__TSR_index:t?f:f+1});c.to=m.pathname,c.search=this.options.parseSearch(m.search),c.hash=m.hash.slice(1)}const d=this.buildLocation({...c,_includeValidateSearch:!0});this.pendingBuiltLocation=d;const h=this.commitLocation({...d,viewTransition:a,replace:t,resetScroll:n,hashScrollIntoView:r,ignoreBlocker:o});return Promise.resolve().then(()=>{this.pendingBuiltLocation===d&&(this.pendingBuiltLocation=void 0)}),h},this.navigate=async({to:t,reloadDocument:n,href:r,...a})=>{var o;if(!n&&r)try{new URL(`${r}`),n=!0}catch{}if(n){if(r||(r=this.buildLocation({to:t,...a}).url),!a.ignoreBlocker){const l=this.history,c=((o=l.getBlockers)==null?void 0:o.call(l))??[];for(const d of c)if(d!=null&&d.blockerFn&&await d.blockerFn({currentLocation:this.latestLocation,nextLocation:this.latestLocation,action:"PUSH"}))return Promise.resolve()}return a.replace?window.location.replace(r):window.location.href=r,Promise.resolve()}return this.buildAndCommitLocation({...a,href:r,to:t,_isNavigate:!0})},this.beforeLoad=()=>{if(this.cancelMatches(),this.updateLatestLocation(),this.isServer){const n=this.buildLocation({to:this.latestLocation.pathname,search:!0,params:!0,hash:!0,state:!0,_includeValidateSearch:!0}),r=a=>{try{return encodeURI(decodeURI(a))}catch{return a}};if(I1(r(this.latestLocation.href))!==I1(r(n.href))){let a=n.url;throw this.origin&&a.startsWith(this.origin)&&(a=a.replace(this.origin,"")||"/"),hQ({href:a})}}const t=this.matchRoutes(this.latestLocation);this.__store.setState(n=>({...n,status:"pending",statusCode:200,isLoading:!0,location:this.latestLocation,pendingMatches:t,cachedMatches:n.cachedMatches.filter(r=>!t.some(a=>a.id===r.id))}))},this.load=async t=>{let n,r,a;for(a=new Promise(l=>{this.startTransition(async()=>{var c;try{this.beforeLoad();const d=this.latestLocation,h=this.state.resolvedLocation;this.state.redirect||this.emit({type:"onBeforeNavigate",...Qf({resolvedLocation:h,location:d})}),this.emit({type:"onBeforeLoad",...Qf({resolvedLocation:h,location:d})}),await vD({router:this,sync:t==null?void 0:t.sync,matches:this.state.pendingMatches,location:d,updateMatch:this.updateMatch,onReady:async()=>{this.startTransition(()=>{this.startViewTransition(async()=>{let f=[],m=[],p=[];lv(()=>{this.__store.setState(x=>{const g=x.matches,b=x.pendingMatches||x.matches;return f=g.filter(v=>!b.some(y=>y.id===v.id)),m=b.filter(v=>!g.some(y=>y.id===v.id)),p=b.filter(v=>g.some(y=>y.id===v.id)),{...x,isLoading:!1,loadedAt:Date.now(),matches:b,pendingMatches:void 0,cachedMatches:[...x.cachedMatches,...f.filter(v=>v.status!=="error"&&v.status!=="notFound")]}}),this.clearExpiredCache()}),[[f,"onLeave"],[m,"onEnter"],[p,"onStay"]].forEach(([x,g])=>{x.forEach(b=>{var v,y;(y=(v=this.looseRoutesById[b.routeId].options)[g])==null||y.call(v,b)})})})})}})}catch(d){po(d)?(n=d,this.isServer||this.navigate({...n.options,replace:!0,ignoreBlocker:!0})):Ta(d)&&(r=d),this.__store.setState(h=>({...h,statusCode:n?n.status:r?404:h.matches.some(f=>f.status==="error")?500:200,redirect:n}))}this.latestLoadPromise===a&&((c=this.commitLocationPromise)==null||c.resolve(),this.latestLoadPromise=void 0,this.commitLocationPromise=void 0),l()})}),this.latestLoadPromise=a,await a;this.latestLoadPromise&&a!==this.latestLoadPromise;)await this.latestLoadPromise;let o;this.hasNotFoundMatch()?o=404:this.__store.state.matches.some(l=>l.status==="error")&&(o=500),o!==void 0&&this.__store.setState(l=>({...l,statusCode:o}))},this.startViewTransition=t=>{const n=this.shouldViewTransition??this.options.defaultViewTransition;if(delete this.shouldViewTransition,n&&typeof document<"u"&&"startViewTransition"in document&&typeof document.startViewTransition=="function"){let r;if(typeof n=="object"&&this.isViewTransitionTypesSupported){const a=this.latestLocation,o=this.state.resolvedLocation,l=typeof n.types=="function"?n.types(Qf({resolvedLocation:o,location:a})):n.types;if(l===!1){t();return}r={update:t,types:l}}else r=t;document.startViewTransition(r)}else t()},this.updateMatch=(t,n)=>{this.startTransition(()=>{var a;const r=(a=this.state.pendingMatches)!=null&&a.some(o=>o.id===t)?"pendingMatches":this.state.matches.some(o=>o.id===t)?"matches":this.state.cachedMatches.some(o=>o.id===t)?"cachedMatches":"";r&&this.__store.setState(o=>{var l;return{...o,[r]:(l=o[r])==null?void 0:l.map(c=>c.id===t?n(c):c)}})})},this.getMatch=t=>{var r;const n=a=>a.id===t;return this.state.cachedMatches.find(n)??((r=this.state.pendingMatches)==null?void 0:r.find(n))??this.state.matches.find(n)},this.invalidate=t=>{const n=r=>{var a;return((a=t==null?void 0:t.filter)==null?void 0:a.call(t,r))??!0?{...r,invalid:!0,...t!=null&&t.forcePending||r.status==="error"||r.status==="notFound"?{status:"pending",error:void 0}:void 0}:r};return this.__store.setState(r=>{var a;return{...r,matches:r.matches.map(n),cachedMatches:r.cachedMatches.map(n),pendingMatches:(a=r.pendingMatches)==null?void 0:a.map(n)}}),this.shouldViewTransition=!1,this.load({sync:t==null?void 0:t.sync})},this.resolveRedirect=t=>{if(!t.options.href){const n=this.buildLocation(t.options);let r=n.url;this.origin&&r.startsWith(this.origin)&&(r=r.replace(this.origin,"")||"/"),t.options.href=n.href,t.headers.set("Location",r)}return t.headers.get("Location")||t.headers.set("Location",t.options.href),t},this.clearCache=t=>{const n=t==null?void 0:t.filter;n!==void 0?this.__store.setState(r=>({...r,cachedMatches:r.cachedMatches.filter(a=>!n(a))})):this.__store.setState(r=>({...r,cachedMatches:[]}))},this.clearExpiredCache=()=>{const t=n=>{const r=this.looseRoutesById[n.routeId];if(!r.options.loader)return!0;const a=(n.preload?r.options.preloadGcTime??this.options.defaultPreloadGcTime:r.options.gcTime??this.options.defaultGcTime)??5*60*1e3;return n.status==="error"?!0:Date.now()-n.updatedAt>=a};this.clearCache({filter:t})},this.loadRouteChunk=IB,this.preloadRoute=async t=>{const n=this.buildLocation(t);let r=this.matchRoutes(n,{throwOnError:!0,preload:!0,dest:t});const a=new Set([...this.state.matches,...this.state.pendingMatches??[]].map(l=>l.id)),o=new Set([...a,...this.state.cachedMatches.map(l=>l.id)]);lv(()=>{r.forEach(l=>{o.has(l.id)||this.__store.setState(c=>({...c,cachedMatches:[...c.cachedMatches,l]}))})});try{return r=await vD({router:this,matches:r,location:n,preload:!0,updateMatch:(l,c)=>{a.has(l)?r=r.map(d=>d.id===l?c(d):d):this.updateMatch(l,c)}}),r}catch(l){if(po(l))return l.options.reloadDocument?void 0:await this.preloadRoute({...l.options,_fromLocation:n});Ta(l)||console.error(l);return}},this.matchRoute=(t,n)=>{const r={...t,to:t.to?this.resolvePathWithBase(t.from||"",t.to):void 0,params:t.params||{},leaveParams:!0},a=this.buildLocation(r);if(n!=null&&n.pending&&this.state.status!=="pending")return!1;const l=((n==null?void 0:n.pending)===void 0?!this.state.isLoading:n.pending)?this.latestLocation:this.state.resolvedLocation||this.state.location,c=HX(a.pathname,(n==null?void 0:n.caseSensitive)??!1,(n==null?void 0:n.fuzzy)??!1,l.pathname,this.processedTree);return!c||t.params&&!Kf(c.params,t.params,{partial:!0})?!1:(n==null?void 0:n.includeSearch)??!0?Kf(l.search,a.search,{partial:!0})?c.params:!1:c.params},this.hasNotFoundMatch=()=>this.__store.state.matches.some(t=>t.status==="notFound"||t.globalNotFound),this.update({defaultPreloadDelay:50,defaultPendingMs:1e3,defaultPendingMinMs:500,context:void 0,...e,caseSensitive:e.caseSensitive??!1,notFoundMode:e.notFoundMode??"fuzzy",stringifySearch:e.stringifySearch??cQ,parseSearch:e.parseSearch??lQ}),typeof document<"u"&&(self.__TSR_ROUTER__=this)}isShell(){return!!this.options.isShell}isPrerendering(){return!!this.options.isPrerendering}get state(){return this.__store.state}get looseRoutesById(){return this.routesById}matchRoutesInternal(e,t){const n=this.getMatchedRoutes(e.pathname),{foundRoute:r,routeParams:a}=n;let{matchedRoutes:o}=n,l=!1;(r?r.path!=="/"&&a["**"]:Xf(e.pathname))&&(this.options.notFoundRoute?o=[...o,this.options.notFoundRoute]:l=!0);const c=(()=>{if(l){if(this.options.notFoundMode!=="root")for(let f=o.length-1;f>=0;f--){const m=o[f];if(m.children)return m.id}return Li}})(),d=[],h=f=>(f==null?void 0:f.id)?f.context??this.options.context??void 0:this.options.context??void 0;return o.forEach((f,m)=>{var B,R,O;const p=d[m-1],[x,g,b]=(()=>{const I=(p==null?void 0:p.search)??e.search,U=(p==null?void 0:p._strictSearch)??void 0;try{const M=W_(f.options.validateSearch,{...I})??void 0;return[{...I,...M},{...U,...M},void 0]}catch(M){let $=M;if(M instanceof lS||($=new lS(M.message,{cause:M})),t!=null&&t.throwOnError)throw $;return[I,{},$]}})(),v=((R=(B=f.options).loaderDeps)==null?void 0:R.call(B,{search:x}))??"",y=v?JSON.stringify(v):"",{interpolatedPath:w,usedParams:S}=VN({path:f.fullPath,params:a,decodeCharMap:this.pathParamsDecodeCharMap}),j=f.id+w+y,A=this.getMatch(j),k=this.state.matches.find(I=>I.routeId===f.id),_=(A==null?void 0:A._strictParams)??S;let L;if(!A){const I=((O=f.options.params)==null?void 0:O.parse)??f.options.parseParams;if(I)try{Object.assign(_,I(_))}catch(U){if(Ta(U)||po(U)?L=U:L=new wQ(U.message,{cause:U}),t!=null&&t.throwOnError)throw L}}Object.assign(a,_);const D=k?"stay":"enter";let P;if(A)P={...A,cause:D,params:k?ia(k.params,a):a,_strictParams:_,search:ia(k?k.search:A.search,x),_strictSearch:g};else{const I=f.options.loader||f.options.beforeLoad||f.lazyFn||RB(f)?"pending":"success";P={id:j,ssr:this.isServer?void 0:f.options.ssr,index:m,routeId:f.id,params:k?ia(k.params,a):a,_strictParams:_,pathname:w,updatedAt:Date.now(),search:k?ia(k.search,x):x,_strictSearch:g,searchError:void 0,status:I,isFetching:!1,error:void 0,paramsError:L,__routeContext:void 0,_nonReactive:{loadPromise:bx()},__beforeLoadContext:void 0,context:{},abortController:new AbortController,fetchCount:0,cause:D,loaderDeps:k?ia(k.loaderDeps,v):v,invalid:!1,preload:!1,links:void 0,scripts:void 0,headScripts:void 0,meta:void 0,staticData:f.options.staticData||{},fullPath:f.fullPath}}t!=null&&t.preload||(P.globalNotFound=c===f.id),P.searchError=b;const T=h(p);P.context={...T,...P.__routeContext,...P.__beforeLoadContext},d.push(P)}),d.forEach((f,m)=>{const p=this.looseRoutesById[f.routeId];if(!this.getMatch(f.id)&&(t==null?void 0:t._buildLocation)!==!0){const g=d[m-1],b=h(g);if(p.options.context){const v={deps:f.loaderDeps,params:f.params,context:b??{},location:e,navigate:y=>this.navigate({...y,_fromLocation:e}),buildLocation:this.buildLocation,cause:f.cause,abortController:f.abortController,preload:!!f.preload,matches:d};f.__routeContext=p.options.context(v)??void 0}f.context={...b,...f.__routeContext,...f.__beforeLoadContext}}}),d}}class lS extends Error{}class wQ extends Error{}function CQ(s){return{loadedAt:0,isLoading:!1,isTransitioning:!1,status:"idle",resolvedLocation:void 0,location:s,matches:[],pendingMatches:[],cachedMatches:[],statusCode:200}}function W_(s,e){if(s==null)return{};if("~standard"in s){const t=s["~standard"].validate(e);if(t instanceof Promise)throw new lS("Async validation not supported");if(t.issues)throw new lS(JSON.stringify(t.issues,void 0,2),{cause:t});return t.value}return"parse"in s?s.parse(e):typeof s=="function"?s(e):{}}function SQ({pathname:s,routesById:e,processedTree:t}){const n={},r=Xf(s);let a;const o=VX(r,t,!0);return o&&(a=o.route,Object.assign(n,o.params)),{matchedRoutes:(o==null?void 0:o.branch)||[e[Li]],routeParams:n,foundRoute:a}}function jQ({search:s,dest:e,destRoutes:t,_includeValidateSearch:n}){const r=t.reduce((l,c)=>{var h;const d=[];if("search"in c.options)(h=c.options.search)!=null&&h.middlewares&&d.push(...c.options.search.middlewares);else if(c.options.preSearchFilters||c.options.postSearchFilters){const f=({search:m,next:p})=>{let x=m;"preSearchFilters"in c.options&&c.options.preSearchFilters&&(x=c.options.preSearchFilters.reduce((b,v)=>v(b),m));const g=p(x);return"postSearchFilters"in c.options&&c.options.postSearchFilters?c.options.postSearchFilters.reduce((b,v)=>v(b),g):g};d.push(f)}if(n&&c.options.validateSearch){const f=({search:m,next:p})=>{const x=p(m);try{return{...x,...W_(c.options.validateSearch,x)??void 0}}catch{return x}};d.push(f)}return l.concat(d)},[])??[],a=({search:l})=>e.search?e.search===!0?l:Yf(e.search,l):{};r.push(a);const o=(l,c)=>{if(l>=r.length)return c;const d=r[l];return d({search:c,next:f=>o(l+1,f)})};return o(0,s)}const kQ="Error preloading route! ";class FB{constructor(e){if(this.init=t=>{var d,h;this.originalIndex=t.originalIndex;const n=this.options,r=!(n!=null&&n.path)&&!(n!=null&&n.id);this.parentRoute=(h=(d=this.options).getParentRoute)==null?void 0:h.call(d),r?this._path=Li:this.parentRoute||Dc(!1);let a=r?Li:n==null?void 0:n.path;a&&a!=="/"&&(a=AB(a));const o=(n==null?void 0:n.id)||a;let l=r?Li:M1([this.parentRoute.id===Li?"":this.parentRoute.id,o]);a===Li&&(a="/"),l!==Li&&(l=M1(["/",l]));const c=l===Li?"/":M1([this.parentRoute.fullPath,a]);this._path=a,this._id=l,this._fullPath=c,this._to=c},this.addChildren=t=>this._addFileChildren(t),this._addFileChildren=t=>(Array.isArray(t)&&(this.children=t),typeof t=="object"&&t!==null&&(this.children=Object.values(t)),this),this._addFileTypes=()=>this,this.updateLoader=t=>(Object.assign(this.options,t),this),this.update=t=>(Object.assign(this.options,t),this),this.lazy=t=>(this.lazyFn=t,this),this.options=e||{},this.isRoot=!(e!=null&&e.getParentRoute),e!=null&&e.id&&(e!=null&&e.path))throw new Error("Route cannot have both an 'id' and a 'path' option.")}get to(){return this._to}get id(){return this._id}get path(){return this._path}get fullPath(){return this._fullPath}}class NQ extends FB{constructor(e){super(e)}}function SP(s){const e=s.errorComponent??zj;return i.jsx(AQ,{getResetKey:s.getResetKey,onCatch:s.onCatch,children:({error:t,reset:n})=>t?C.createElement(e,{error:t,reset:n}):s.children})}class AQ extends C.Component{constructor(){super(...arguments),this.state={error:null}}static getDerivedStateFromProps(e){return{resetKey:e.getResetKey()}}static getDerivedStateFromError(e){return{error:e}}reset(){this.setState({error:null})}componentDidUpdate(e,t){t.error&&t.resetKey!==this.state.resetKey&&this.reset()}componentDidCatch(e,t){this.props.onCatch&&this.props.onCatch(e,t)}render(){return this.props.children({error:this.state.resetKey!==this.props.getResetKey()?null:this.state.error,reset:()=>{this.reset()}})}}function zj({error:s}){const[e,t]=C.useState(!1);return i.jsxs("div",{style:{padding:".5rem",maxWidth:"100%"},children:[i.jsxs("div",{style:{display:"flex",alignItems:"center",gap:".5rem"},children:[i.jsx("strong",{style:{fontSize:"1rem"},children:"Something went wrong!"}),i.jsx("button",{style:{appearance:"none",fontSize:".6em",border:"1px solid currentColor",padding:".1rem .2rem",fontWeight:"bold",borderRadius:".25rem"},onClick:()=>t(n=>!n),children:e?"Hide Error":"Show Error"})]}),i.jsx("div",{style:{height:".25rem"}}),e?i.jsx("div",{children:i.jsx("pre",{style:{fontSize:".7em",border:"1px solid red",borderRadius:".25rem",padding:".3rem",color:"red",overflow:"auto"},children:s.message?i.jsx("code",{children:s.message}):null})}):null]})}function _Q({children:s,fallback:e=null}){return TQ()?i.jsx(V.Fragment,{children:s}):i.jsx(V.Fragment,{children:e})}function TQ(){return V.useSyncExternalStore(EQ,()=>!0,()=>!1)}function EQ(){return()=>{}}var BB={exports:{}},$B={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hj=C,PQ=d7;function MQ(s,e){return s===e&&(s!==0||1/s===1/e)||s!==s&&e!==e}var IQ=typeof Object.is=="function"?Object.is:MQ,RQ=PQ.useSyncExternalStore,DQ=Hj.useRef,LQ=Hj.useEffect,OQ=Hj.useMemo,FQ=Hj.useDebugValue;$B.useSyncExternalStoreWithSelector=function(s,e,t,n,r){var a=DQ(null);if(a.current===null){var o={hasValue:!1,value:null};a.current=o}else o=a.current;a=OQ(function(){function c(p){if(!d){if(d=!0,h=p,p=n(p),r!==void 0&&o.hasValue){var x=o.value;if(r(x,p))return f=x}return f=p}if(x=f,IQ(h,p))return x;var g=n(p);return r!==void 0&&r(x,g)?(h=p,x):(h=p,f=g)}var d=!1,h,f,m=t===void 0?null:t;return[function(){return c(e())},m===null?void 0:function(){return c(m())}]},[e,t,n,r]);var l=RQ(s,a[0],a[1]);return LQ(function(){o.hasValue=!0,o.value=l},[l]),FQ(l),l};BB.exports=$B;var BQ=BB.exports;function $Q(s,e=n=>n,t={}){const n=t.equal??UQ;return BQ.useSyncExternalStoreWithSelector(s.subscribe,()=>s.state,()=>s.state,e,n)}function UQ(s,e){if(Object.is(s,e))return!0;if(typeof s!="object"||s===null||typeof e!="object"||e===null)return!1;if(s instanceof Map&&e instanceof Map){if(s.size!==e.size)return!1;for(const[n,r]of s)if(!e.has(n)||!Object.is(r,e.get(n)))return!1;return!0}if(s instanceof Set&&e instanceof Set){if(s.size!==e.size)return!1;for(const n of s)if(!e.has(n))return!1;return!0}if(s instanceof Date&&e instanceof Date)return s.getTime()===e.getTime();const t=bD(s);if(t.length!==bD(e).length)return!1;for(let n=0;n<t.length;n++)if(!Object.prototype.hasOwnProperty.call(e,t[n])||!Object.is(s[t[n]],e[t[n]]))return!1;return!0}function bD(s){return Object.keys(s).concat(Object.getOwnPropertySymbols(s))}const qN=C.createContext(null);function UB(){return typeof document>"u"?qN:window.__TSR_ROUTER_CONTEXT__?window.__TSR_ROUTER_CONTEXT__:(window.__TSR_ROUTER_CONTEXT__=qN,qN)}function ea(s){const e=C.useContext(UB());return s==null||s.warn,e}function Pr(s){const e=ea({warn:(s==null?void 0:s.router)===void 0}),t=(s==null?void 0:s.router)||e,n=C.useRef(void 0);return $Q(t.__store,r=>{if(s!=null&&s.select){if(s.structuralSharing??t.options.defaultStructuralSharing){const a=ia(n.current,s.select(r));return n.current=a,a}return s.select(r)}return r})}const Vj=C.createContext(void 0),zQ=C.createContext(void 0);function vl(s){const e=C.useContext(s.from?zQ:Vj);return Pr({select:n=>{const r=n.matches.find(a=>s.from?s.from===a.routeId:a.id===e);if(Dc(!((s.shouldThrow??!0)&&!r),`Could not find ${s.from?`an active match from "${s.from}"`:"a nearest match!"}`),r!==void 0)return s.select?s.select(r):r},structuralSharing:s.structuralSharing})}function jP(s){return vl({from:s.from,strict:s.strict,structuralSharing:s.structuralSharing,select:e=>s.select?s.select(e.loaderData):e.loaderData})}function kP(s){const{select:e,...t}=s;return vl({...t,select:n=>e?e(n.loaderDeps):n.loaderDeps})}function NP(s){return vl({from:s.from,shouldThrow:s.shouldThrow,structuralSharing:s.structuralSharing,strict:s.strict,select:e=>{const t=s.strict===!1?e.params:e._strictParams;return s.select?s.select(t):t}})}function AP(s){return vl({from:s.from,strict:s.strict,shouldThrow:s.shouldThrow,structuralSharing:s.structuralSharing,select:e=>s.select?s.select(e.search):e.search})}const Yw=typeof window<"u"?C.useLayoutEffect:C.useEffect;function GN(s){const e=C.useRef({value:s,prev:null}),t=e.current.value;return s!==t&&(e.current={value:s,prev:t}),e.current.prev}function HQ(s,e,t={},n={}){C.useEffect(()=>{if(!s.current||n.disabled||typeof IntersectionObserver!="function")return;const r=new IntersectionObserver(([a])=>{e(a)},t);return r.observe(s.current),()=>{r.disconnect()}},[e,t,n.disabled,s])}function VQ(s){const e=C.useRef(null);return C.useImperativeHandle(s,()=>e.current,[]),e}function Wj(s){const e=ea();return C.useCallback(t=>e.navigate({...t,from:t.from??(s==null?void 0:s.from)}),[s==null?void 0:s.from,e])}function WQ(s,e){const t=ea(),[n,r]=C.useState(!1),a=C.useRef(!1),o=VQ(e),{activeProps:l,inactiveProps:c,activeOptions:d,to:h,preload:f,preloadDelay:m,hashScrollIntoView:p,replace:x,startTransition:g,resetScroll:b,viewTransition:v,children:y,target:w,disabled:S,style:j,className:A,onClick:k,onFocus:_,onMouseEnter:L,onMouseLeave:D,onTouchStart:P,ignoreBlocker:T,params:B,search:R,hash:O,state:I,mask:U,reloadDocument:M,unsafeRelative:$,from:W,_fromLocation:ee,...Z}=s,z=Pr({select:ve=>ve.location.search,structuralSharing:!0}),se=s.from,de=C.useMemo(()=>({...s,from:se}),[t,z,se,s._fromLocation,s.hash,s.to,s.search,s.params,s.state,s.mask,s.unsafeRelative]),ne=C.useMemo(()=>t.buildLocation({...de}),[t,de]),H=C.useMemo(()=>{if(S)return;let ve=ne.maskedLocation?ne.maskedLocation.url:ne.url,we=!1;return t.origin&&(ve.startsWith(t.origin)?ve=t.history.createHref(ve.replace(t.origin,""))||"/":we=!0),{href:ve,external:we}},[S,ne.maskedLocation,ne.url,t.origin,t.history]),Y=C.useMemo(()=>{if(H!=null&&H.external)return H.href;try{return new URL(h),h}catch{}},[h,H]),ae=s.reloadDocument||Y?!1:f??t.options.defaultPreload,ce=m??t.options.defaultPreloadDelay??0,Ue=Pr({select:ve=>{if(Y)return!1;if(d!=null&&d.exact){if(!QX(ve.location.pathname,ne.pathname,t.basepath))return!1}else{const we=iS(ve.location.pathname,t.basepath),je=iS(ne.pathname,t.basepath);if(!(we.startsWith(je)&&(we.length===je.length||we[je.length]==="/")))return!1}return((d==null?void 0:d.includeSearch)??!0)&&!Kf(ve.location.search,ne.search,{partial:!(d!=null&&d.exact),ignoreUndefined:!(d!=null&&d.explicitUndefined)})?!1:d!=null&&d.includeHash?ve.location.hash===ne.hash:!0}}),te=C.useCallback(()=>{t.preloadRoute({...de}).catch(ve=>{console.warn(ve),console.warn(kQ)})},[t,de]),J=C.useCallback(ve=>{ve!=null&&ve.isIntersecting&&te()},[te]);HQ(o,J,XQ,{disabled:!!S||ae!=="viewport"}),C.useEffect(()=>{a.current||!S&&ae==="render"&&(te(),a.current=!0)},[S,te,ae]);const K=ve=>{const we=ve.currentTarget.getAttribute("target"),je=w!==void 0?w:we;if(!S&&!QQ(ve)&&!ve.defaultPrevented&&(!je||je==="_self")&&ve.button===0){ve.preventDefault(),Gu.flushSync(()=>{r(!0)});const Ye=t.subscribe("onResolved",()=>{Ye(),r(!1)});t.navigate({...de,replace:x,resetScroll:b,hashScrollIntoView:p,startTransition:g,viewTransition:v,ignoreBlocker:T})}};if(Y)return{...Z,ref:o,href:Y,...y&&{children:y},...w&&{target:w},...S&&{disabled:S},...j&&{style:j},...A&&{className:A},...k&&{onClick:k},..._&&{onFocus:_},...L&&{onMouseEnter:L},...D&&{onMouseLeave:D},...P&&{onTouchStart:P}};const be=ve=>{S||ae&&te()},Me=be,De=ve=>{if(!(S||!ae))if(!ce)te();else{const we=ve.target;if(Zx.has(we))return;const je=setTimeout(()=>{Zx.delete(we),te()},ce);Zx.set(we,je)}},_t=ve=>{if(S||!ae||!ce)return;const we=ve.target,je=Zx.get(we);je&&(clearTimeout(je),Zx.delete(we))},et=Ue?Yf(l,{})??qQ:YN,G=Ue?YN:Yf(c,{})??YN,Q=[A,et.className,G.className].filter(Boolean).join(" "),ie=(j||et.style||G.style)&&{...j,...et.style,...G.style};return{...Z,...et,...G,href:H==null?void 0:H.href,ref:o,onClick:Jx([k,K]),onFocus:Jx([_,be]),onMouseEnter:Jx([L,De]),onMouseLeave:Jx([D,_t]),onTouchStart:Jx([P,Me]),disabled:!!S,target:w,...ie&&{style:ie},...Q&&{className:Q},...S&&GQ,...Ue&&YQ,...n&&KQ}}const YN={},qQ={className:"active"},GQ={role:"link","aria-disabled":!0},YQ={"data-status":"active","aria-current":"page"},KQ={"data-transitioning":"transitioning"},Zx=new WeakMap,XQ={rootMargin:"100px"},Jx=s=>e=>{for(const t of s)if(t){if(e.defaultPrevented)return;t(e)}},ba=C.forwardRef((s,e)=>{const{_asChild:t,...n}=s,{type:r,ref:a,...o}=WQ(n,e),l=typeof n.children=="function"?n.children({isActive:o["data-status"]==="active"}):n.children;return t===void 0&&delete o.disabled,C.createElement(t||"a",{...o,ref:a},l)});function QQ(s){return!!(s.metaKey||s.altKey||s.ctrlKey||s.shiftKey)}class ZQ extends FB{constructor(e){super(e),this.useMatch=t=>vl({select:t==null?void 0:t.select,from:this.id,structuralSharing:t==null?void 0:t.structuralSharing}),this.useRouteContext=t=>vl({...t,from:this.id,select:n=>t!=null&&t.select?t.select(n.context):n.context}),this.useSearch=t=>AP({select:t==null?void 0:t.select,structuralSharing:t==null?void 0:t.structuralSharing,from:this.id}),this.useParams=t=>NP({select:t==null?void 0:t.select,structuralSharing:t==null?void 0:t.structuralSharing,from:this.id}),this.useLoaderDeps=t=>kP({...t,from:this.id}),this.useLoaderData=t=>jP({...t,from:this.id}),this.useNavigate=()=>Wj({from:this.fullPath}),this.Link=V.forwardRef((t,n)=>i.jsx(ba,{ref:n,from:this.fullPath,...t})),this.$$typeof=Symbol.for("react.memo")}}function ui(s){return new ZQ(s)}class JQ extends NQ{constructor(e){super(e),this.useMatch=t=>vl({select:t==null?void 0:t.select,from:this.id,structuralSharing:t==null?void 0:t.structuralSharing}),this.useRouteContext=t=>vl({...t,from:this.id,select:n=>t!=null&&t.select?t.select(n.context):n.context}),this.useSearch=t=>AP({select:t==null?void 0:t.select,structuralSharing:t==null?void 0:t.structuralSharing,from:this.id}),this.useParams=t=>NP({select:t==null?void 0:t.select,structuralSharing:t==null?void 0:t.structuralSharing,from:this.id}),this.useLoaderDeps=t=>kP({...t,from:this.id}),this.useLoaderData=t=>jP({...t,from:this.id}),this.useNavigate=()=>Wj({from:this.fullPath}),this.Link=V.forwardRef((t,n)=>i.jsx(ba,{ref:n,from:this.fullPath,...t})),this.$$typeof=Symbol.for("react.memo")}}function eZ(s){return new JQ(s)}function wD(s){return typeof s=="object"?new CD(s,{silent:!0}).createRoute(s):new CD(s,{silent:!0}).createRoute}class CD{constructor(e,t){this.path=e,this.createRoute=n=>{this.silent;const r=ui(n);return r.isRoot=!1,r},this.silent=t==null?void 0:t.silent}}class SD{constructor(e){this.useMatch=t=>vl({select:t==null?void 0:t.select,from:this.options.id,structuralSharing:t==null?void 0:t.structuralSharing}),this.useRouteContext=t=>vl({from:this.options.id,select:n=>t!=null&&t.select?t.select(n.context):n.context}),this.useSearch=t=>AP({select:t==null?void 0:t.select,structuralSharing:t==null?void 0:t.structuralSharing,from:this.options.id}),this.useParams=t=>NP({select:t==null?void 0:t.select,structuralSharing:t==null?void 0:t.structuralSharing,from:this.options.id}),this.useLoaderDeps=t=>kP({...t,from:this.options.id}),this.useLoaderData=t=>jP({...t,from:this.options.id}),this.useNavigate=()=>{const t=ea();return Wj({from:t.routesById[this.options.id].fullPath})},this.options=e,this.$$typeof=Symbol.for("react.memo")}}function jD(s){return typeof s=="object"?new SD(s):e=>new SD({id:s,...e})}function tZ(){const s=ea(),e=C.useRef({router:s,mounted:!1}),[t,n]=C.useState(!1),{hasPendingMatches:r,isLoading:a}=Pr({select:f=>({isLoading:f.isLoading,hasPendingMatches:f.matches.some(m=>m.status==="pending")}),structuralSharing:!0}),o=GN(a),l=a||t||r,c=GN(l),d=a||r,h=GN(d);return s.startTransition=f=>{n(!0),C.startTransition(()=>{f(),n(!1)})},C.useEffect(()=>{const f=s.history.subscribe(s.load),m=s.buildLocation({to:s.latestLocation.pathname,search:!0,params:!0,hash:!0,state:!0,_includeValidateSearch:!0});return Xf(s.latestLocation.href)!==Xf(m.href)&&s.commitLocation({...m,replace:!0}),()=>{f()}},[s,s.history]),Yw(()=>{if(typeof window<"u"&&s.ssr||e.current.router===s&&e.current.mounted)return;e.current={router:s,mounted:!0},(async()=>{try{await s.load()}catch(m){console.error(m)}})()},[s]),Yw(()=>{o&&!a&&s.emit({type:"onLoad",...Qf(s.state)})},[o,s,a]),Yw(()=>{h&&!d&&s.emit({type:"onBeforeRouteMount",...Qf(s.state)})},[d,h,s]),Yw(()=>{if(c&&!l){const f=Qf(s.state);s.emit({type:"onResolved",...f}),s.__store.setState(m=>({...m,status:"idle",resolvedLocation:m.location})),f.hrefChanged&&iQ(s)}},[l,c,s]),null}function sZ(s){const e=Pr({select:t=>`not-found-${t.location.pathname}-${t.status}`});return i.jsx(SP,{getResetKey:()=>e,onCatch:(t,n)=>{var r;if(Ta(t))(r=s.onCatch)==null||r.call(s,t,n);else throw t},errorComponent:({error:t})=>{var n;if(Ta(t))return(n=s.fallback)==null?void 0:n.call(s,t);throw t},children:s.children})}function nZ(){return i.jsx("p",{children:"Not Found"})}function Um(s){return i.jsx(i.Fragment,{children:s.children})}function zB(s,e,t){return e.options.notFoundComponent?i.jsx(e.options.notFoundComponent,{...t}):s.options.defaultNotFoundComponent?i.jsx(s.options.defaultNotFoundComponent,{...t}):i.jsx(nZ,{})}function rZ({children:s}){var t;const e=ea();return e.isServer?i.jsx("script",{nonce:(t=e.options.ssr)==null?void 0:t.nonce,className:"$tsr",dangerouslySetInnerHTML:{__html:s+';typeof $_TSR !== "undefined" && $_TSR.c()'}}):null}function iZ(){const s=ea();if(!s.isScrollRestoring||!s.isServer||typeof s.options.scrollRestoration=="function"&&!s.options.scrollRestoration({location:s.latestLocation}))return null;const t=(s.options.getScrollRestorationKey||V_)(s.latestLocation),n=t!==V_(s.latestLocation)?t:void 0,r={storageKey:aS,shouldScrollRestoration:!0};return n&&(r.key=n),i.jsx(rZ,{children:`(${_B.toString()})(${JSON.stringify(r)})`})}const HB=C.memo(function({matchId:e}){var v,y;const t=ea(),n=Pr({select:w=>{const S=w.matches.find(j=>j.id===e);return Dc(S),{routeId:S.routeId,ssr:S.ssr,_displayPending:S._displayPending}},structuralSharing:!0}),r=t.routesById[n.routeId],a=r.options.pendingComponent??t.options.defaultPendingComponent,o=a?i.jsx(a,{}):null,l=r.options.errorComponent??t.options.defaultErrorComponent,c=r.options.onCatch??t.options.defaultOnCatch,d=r.isRoot?r.options.notFoundComponent??((v=t.options.notFoundRoute)==null?void 0:v.options.component):r.options.notFoundComponent,h=n.ssr===!1||n.ssr==="data-only",f=(!r.isRoot||r.options.wrapInSuspense||h)&&(r.options.wrapInSuspense??a??(((y=r.options.errorComponent)==null?void 0:y.preload)||h))?C.Suspense:Um,m=l?SP:Um,p=d?sZ:Um,x=Pr({select:w=>w.loadedAt}),g=Pr({select:w=>{var j;const S=w.matches.findIndex(A=>A.id===e);return(j=w.matches[S-1])==null?void 0:j.routeId}}),b=r.isRoot?r.options.shellComponent??Um:Um;return i.jsxs(b,{children:[i.jsx(Vj.Provider,{value:e,children:i.jsx(f,{fallback:o,children:i.jsx(m,{getResetKey:()=>x,errorComponent:l||zj,onCatch:(w,S)=>{if(Ta(w))throw w;c==null||c(w,S)},children:i.jsx(p,{fallback:w=>{if(!d||w.routeId&&w.routeId!==n.routeId||!w.routeId&&!r.isRoot)throw w;return C.createElement(d,w)},children:h||n._displayPending?i.jsx(_Q,{fallback:o,children:i.jsx(kD,{matchId:e})}):i.jsx(kD,{matchId:e})})})})}),g===Li&&t.options.scrollRestoration?i.jsxs(i.Fragment,{children:[i.jsx(aZ,{}),i.jsx(iZ,{})]}):null]})});function aZ(){const s=ea(),e=C.useRef(void 0);return i.jsx("script",{suppressHydrationWarning:!0,ref:t=>{t&&(e.current===void 0||e.current.href!==s.latestLocation.href)&&(s.emit({type:"onRendered",...Qf(s.state)}),e.current=s.latestLocation)}},s.latestLocation.state.__TSR_key)}const kD=C.memo(function({matchId:e}){var c,d,h,f;const t=ea(),{match:n,key:r,routeId:a}=Pr({select:m=>{const p=m.matches.find(y=>y.id===e),x=p.routeId,g=t.routesById[x].options.remountDeps??t.options.defaultRemountDeps,b=g==null?void 0:g({routeId:x,loaderDeps:p.loaderDeps,params:p._strictParams,search:p._strictSearch});return{key:b?JSON.stringify(b):void 0,routeId:x,match:{id:p.id,status:p.status,error:p.error,_forcePending:p._forcePending,_displayPending:p._displayPending}}},structuralSharing:!0}),o=t.routesById[a],l=C.useMemo(()=>{const m=o.options.component??t.options.defaultComponent;return m?i.jsx(m,{},r):i.jsx(VB,{})},[r,o.options.component,t.options.defaultComponent]);if(n._displayPending)throw(c=t.getMatch(n.id))==null?void 0:c._nonReactive.displayPendingPromise;if(n._forcePending)throw(d=t.getMatch(n.id))==null?void 0:d._nonReactive.minPendingPromise;if(n.status==="pending"){const m=o.options.pendingMinMs??t.options.defaultPendingMinMs;if(m){const p=t.getMatch(n.id);if(p&&!p._nonReactive.minPendingPromise&&!t.isServer){const x=bx();p._nonReactive.minPendingPromise=x,setTimeout(()=>{x.resolve(),p._nonReactive.minPendingPromise=void 0},m)}}throw(h=t.getMatch(n.id))==null?void 0:h._nonReactive.loadPromise}if(n.status==="notFound")return Dc(Ta(n.error)),zB(t,o,n.error);if(n.status==="redirected")throw Dc(po(n.error)),(f=t.getMatch(n.id))==null?void 0:f._nonReactive.loadPromise;if(n.status==="error"){if(t.isServer){const m=(o.options.errorComponent??t.options.defaultErrorComponent)||zj;return i.jsx(m,{error:n.error,reset:void 0,info:{componentStack:""}})}throw n.error}return l}),VB=C.memo(function(){const e=ea(),t=C.useContext(Vj),n=Pr({select:d=>{var h;return(h=d.matches.find(f=>f.id===t))==null?void 0:h.routeId}}),r=e.routesById[n],a=Pr({select:d=>{const f=d.matches.find(m=>m.id===t);return Dc(f),f.globalNotFound}}),o=Pr({select:d=>{var m;const h=d.matches,f=h.findIndex(p=>p.id===t);return(m=h[f+1])==null?void 0:m.id}}),l=e.options.defaultPendingComponent?i.jsx(e.options.defaultPendingComponent,{}):null;if(a)return zB(e,r,void 0);if(!o)return null;const c=i.jsx(HB,{matchId:o});return n===Li?i.jsx(C.Suspense,{fallback:l,children:c}):c});function oZ(){const s=ea(),t=s.routesById[Li].options.pendingComponent??s.options.defaultPendingComponent,n=t?i.jsx(t,{}):null,r=s.isServer||typeof document<"u"&&s.ssr?Um:C.Suspense,a=i.jsxs(r,{fallback:n,children:[!s.isServer&&i.jsx(tZ,{}),i.jsx(lZ,{})]});return s.options.InnerWrap?i.jsx(s.options.InnerWrap,{children:a}):a}function lZ(){const s=ea(),e=Pr({select:r=>{var a;return(a=r.matches[0])==null?void 0:a.id}}),t=Pr({select:r=>r.loadedAt}),n=e?i.jsx(HB,{matchId:e}):null;return i.jsx(Vj.Provider,{value:e,children:s.options.disableGlobalCatchBoundary?n:i.jsx(SP,{getResetKey:()=>t,errorComponent:zj,onCatch:r=>{r.message||r.toString()},children:n})})}const cZ=s=>new dZ(s);let dZ=class extends bQ{constructor(e){super(e)}};typeof globalThis<"u"?(globalThis.createFileRoute=wD,globalThis.createLazyFileRoute=jD):typeof window<"u"&&(window.createFileRoute=wD,window.createLazyFileRoute=jD);function uZ({router:s,children:e,...t}){Object.keys(t).length>0&&s.update({...s.options,...t,context:{...s.options.context,...t.context}});const n=UB(),r=i.jsx(n.Provider,{value:s,children:e});return s.options.Wrap?i.jsx(s.options.Wrap,{children:r}):r}function hZ({router:s,...e}){return i.jsx(uZ,{router:s,...e,children:i.jsx(oZ,{})})}const WB=C.createContext({dragDropManager:void 0});function cS(s){"@babel/helpers - typeof";return cS=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},cS(s)}function sa(s){return"Minified Redux error #"+s+"; visit https://redux.js.org/Errors?code="+s+" for the full message or use the non-minified dev environment for full errors. "}var ND=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),AD=function(){return Math.random().toString(36).substring(7).split("").join(".")},_D={INIT:"@@redux/INIT"+AD(),REPLACE:"@@redux/REPLACE"+AD()};function fZ(s){if(typeof s!="object"||s===null)return!1;for(var e=s;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(s)===e}function qB(s,e,t){var n;if(typeof e=="function"&&typeof t=="function"||typeof t=="function"&&typeof arguments[3]=="function")throw new Error(sa(0));if(typeof e=="function"&&typeof t>"u"&&(t=e,e=void 0),typeof t<"u"){if(typeof t!="function")throw new Error(sa(1));return t(qB)(s,e)}if(typeof s!="function")throw new Error(sa(2));var r=s,a=e,o=[],l=o,c=!1;function d(){l===o&&(l=o.slice())}function h(){if(c)throw new Error(sa(3));return a}function f(g){if(typeof g!="function")throw new Error(sa(4));if(c)throw new Error(sa(5));var b=!0;return d(),l.push(g),function(){if(b){if(c)throw new Error(sa(6));b=!1,d();var y=l.indexOf(g);l.splice(y,1),o=null}}}function m(g){if(!fZ(g))throw new Error(sa(7));if(typeof g.type>"u")throw new Error(sa(8));if(c)throw new Error(sa(9));try{c=!0,a=r(a,g)}finally{c=!1}for(var b=o=l,v=0;v<b.length;v++){var y=b[v];y()}return g}function p(g){if(typeof g!="function")throw new Error(sa(10));r=g,m({type:_D.REPLACE})}function x(){var g,b=f;return g={subscribe:function(y){if(typeof y!="object"||y===null)throw new Error(sa(11));function w(){y.next&&y.next(h())}w();var S=b(w);return{unsubscribe:S}}},g[ND]=function(){return this},g}return m({type:_D.INIT}),n={dispatch:m,subscribe:f,getState:h,replaceReducer:p},n[ND]=x,n}function vt(s,e,...t){if(mZ()&&e===void 0)throw new Error("invariant requires an error message argument");if(!s){let n;if(e===void 0)n=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{let r=0;n=new Error(e.replace(/%s/g,function(){return t[r++]})),n.name="Invariant Violation"}throw n.framesToPop=1,n}}function mZ(){return typeof process<"u"&&!0}function pZ(s,e,t){return e.split(".").reduce((n,r)=>n&&n[r]?n[r]:t||null,s)}function gZ(s,e){return s.filter(t=>t!==e)}function GB(s){return typeof s=="object"}function xZ(s,e){const t=new Map,n=a=>{t.set(a,t.has(a)?t.get(a)+1:1)};s.forEach(n),e.forEach(n);const r=[];return t.forEach((a,o)=>{a===1&&r.push(o)}),r}function yZ(s,e){return s.filter(t=>e.indexOf(t)>-1)}const _P="dnd-core/INIT_COORDS",qj="dnd-core/BEGIN_DRAG",TP="dnd-core/PUBLISH_DRAG_SOURCE",Gj="dnd-core/HOVER",Yj="dnd-core/DROP",Kj="dnd-core/END_DRAG";function TD(s,e){return{type:_P,payload:{sourceClientOffset:e||null,clientOffset:s||null}}}const vZ={type:_P,payload:{clientOffset:null,sourceClientOffset:null}};function bZ(s){return function(t=[],n={publishSource:!0}){const{publishSource:r=!0,clientOffset:a,getSourceClientOffset:o}=n,l=s.getMonitor(),c=s.getRegistry();s.dispatch(TD(a)),wZ(t,l,c);const d=jZ(t,l);if(d==null){s.dispatch(vZ);return}let h=null;if(a){if(!o)throw new Error("getSourceClientOffset must be defined");CZ(o),h=o(d)}s.dispatch(TD(a,h));const m=c.getSource(d).beginDrag(l,d);if(m==null)return;SZ(m),c.pinSource(d);const p=c.getSourceType(d);return{type:qj,payload:{itemType:p,item:m,sourceId:d,clientOffset:a||null,sourceClientOffset:h||null,isSourcePublic:!!r}}}}function wZ(s,e,t){vt(!e.isDragging(),"Cannot call beginDrag while dragging."),s.forEach(function(n){vt(t.getSource(n),"Expected sourceIds to be registered.")})}function CZ(s){vt(typeof s=="function","When clientOffset is provided, getSourceClientOffset must be a function.")}function SZ(s){vt(GB(s),"Item must be an object.")}function jZ(s,e){let t=null;for(let n=s.length-1;n>=0;n--)if(e.canDragSource(s[n])){t=s[n];break}return t}function kZ(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}function NZ(s){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{},n=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),n.forEach(function(r){kZ(s,r,t[r])})}return s}function AZ(s){return function(t={}){const n=s.getMonitor(),r=s.getRegistry();_Z(n),PZ(n).forEach((o,l)=>{const c=TZ(o,l,r,n),d={type:Yj,payload:{dropResult:NZ({},t,c)}};s.dispatch(d)})}}function _Z(s){vt(s.isDragging(),"Cannot call drop while not dragging."),vt(!s.didDrop(),"Cannot call drop twice during one drag operation.")}function TZ(s,e,t,n){const r=t.getTarget(s);let a=r?r.drop(n,s):void 0;return EZ(a),typeof a>"u"&&(a=e===0?{}:n.getDropResult()),a}function EZ(s){vt(typeof s>"u"||GB(s),"Drop result must either be an object or undefined.")}function PZ(s){const e=s.getTargetIds().filter(s.canDropOnTarget,s);return e.reverse(),e}function MZ(s){return function(){const t=s.getMonitor(),n=s.getRegistry();IZ(t);const r=t.getSourceId();return r!=null&&(n.getSource(r,!0).endDrag(t,r),n.unpinSource()),{type:Kj}}}function IZ(s){vt(s.isDragging(),"Cannot call endDrag while not dragging.")}function q_(s,e){return e===null?s===null:Array.isArray(s)?s.some(t=>t===e):s===e}function RZ(s){return function(t,{clientOffset:n}={}){DZ(t);const r=t.slice(0),a=s.getMonitor(),o=s.getRegistry(),l=a.getItemType();return OZ(r,o,l),LZ(r,a,o),FZ(r,a,o),{type:Gj,payload:{targetIds:r,clientOffset:n||null}}}}function DZ(s){vt(Array.isArray(s),"Expected targetIds to be an array.")}function LZ(s,e,t){vt(e.isDragging(),"Cannot call hover while not dragging."),vt(!e.didDrop(),"Cannot call hover after drop.");for(let n=0;n<s.length;n++){const r=s[n];vt(s.lastIndexOf(r)===n,"Expected targetIds to be unique in the passed array.");const a=t.getTarget(r);vt(a,"Expected targetIds to be registered.")}}function OZ(s,e,t){for(let n=s.length-1;n>=0;n--){const r=s[n],a=e.getTargetType(r);q_(a,t)||s.splice(n,1)}}function FZ(s,e,t){s.forEach(function(n){t.getTarget(n).hover(e,n)})}function BZ(s){return function(){if(s.getMonitor().isDragging())return{type:TP}}}function $Z(s){return{beginDrag:bZ(s),publishDragSource:BZ(s),hover:RZ(s),drop:AZ(s),endDrag:MZ(s)}}class UZ{receiveBackend(e){this.backend=e}getMonitor(){return this.monitor}getBackend(){return this.backend}getRegistry(){return this.monitor.registry}getActions(){const e=this,{dispatch:t}=this.store;function n(a){return(...o)=>{const l=a.apply(e,o);typeof l<"u"&&t(l)}}const r=$Z(this);return Object.keys(r).reduce((a,o)=>{const l=r[o];return a[o]=n(l),a},{})}dispatch(e){this.store.dispatch(e)}constructor(e,t){this.isSetUp=!1,this.handleRefCountChange=()=>{const n=this.store.getState().refCount>0;this.backend&&(n&&!this.isSetUp?(this.backend.setup(),this.isSetUp=!0):!n&&this.isSetUp&&(this.backend.teardown(),this.isSetUp=!1))},this.store=e,this.monitor=t,e.subscribe(this.handleRefCountChange)}}function zZ(s,e){return{x:s.x+e.x,y:s.y+e.y}}function YB(s,e){return{x:s.x-e.x,y:s.y-e.y}}function HZ(s){const{clientOffset:e,initialClientOffset:t,initialSourceClientOffset:n}=s;return!e||!t||!n?null:YB(zZ(e,n),t)}function VZ(s){const{clientOffset:e,initialClientOffset:t}=s;return!e||!t?null:YB(e,t)}const dv=[],EP=[];dv.__IS_NONE__=!0;EP.__IS_ALL__=!0;function WZ(s,e){return s===dv?!1:s===EP||typeof e>"u"?!0:yZ(e,s).length>0}class qZ{subscribeToStateChange(e,t={}){const{handlerIds:n}=t;vt(typeof e=="function","listener must be a function."),vt(typeof n>"u"||Array.isArray(n),"handlerIds, when specified, must be an array of strings.");let r=this.store.getState().stateId;const a=()=>{const o=this.store.getState(),l=o.stateId;try{l===r||l===r+1&&!WZ(o.dirtyHandlerIds,n)||e()}finally{r=l}};return this.store.subscribe(a)}subscribeToOffsetChange(e){vt(typeof e=="function","listener must be a function.");let t=this.store.getState().dragOffset;const n=()=>{const r=this.store.getState().dragOffset;r!==t&&(t=r,e())};return this.store.subscribe(n)}canDragSource(e){if(!e)return!1;const t=this.registry.getSource(e);return vt(t,`Expected to find a valid source. sourceId=${e}`),this.isDragging()?!1:t.canDrag(this,e)}canDropOnTarget(e){if(!e)return!1;const t=this.registry.getTarget(e);if(vt(t,`Expected to find a valid target. targetId=${e}`),!this.isDragging()||this.didDrop())return!1;const n=this.registry.getTargetType(e),r=this.getItemType();return q_(n,r)&&t.canDrop(this,e)}isDragging(){return!!this.getItemType()}isDraggingSource(e){if(!e)return!1;const t=this.registry.getSource(e,!0);if(vt(t,`Expected to find a valid source. sourceId=${e}`),!this.isDragging()||!this.isSourcePublic())return!1;const n=this.registry.getSourceType(e),r=this.getItemType();return n!==r?!1:t.isDragging(this,e)}isOverTarget(e,t={shallow:!1}){if(!e)return!1;const{shallow:n}=t;if(!this.isDragging())return!1;const r=this.registry.getTargetType(e),a=this.getItemType();if(a&&!q_(r,a))return!1;const o=this.getTargetIds();if(!o.length)return!1;const l=o.indexOf(e);return n?l===o.length-1:l>-1}getItemType(){return this.store.getState().dragOperation.itemType}getItem(){return this.store.getState().dragOperation.item}getSourceId(){return this.store.getState().dragOperation.sourceId}getTargetIds(){return this.store.getState().dragOperation.targetIds}getDropResult(){return this.store.getState().dragOperation.dropResult}didDrop(){return this.store.getState().dragOperation.didDrop}isSourcePublic(){return!!this.store.getState().dragOperation.isSourcePublic}getInitialClientOffset(){return this.store.getState().dragOffset.initialClientOffset}getInitialSourceClientOffset(){return this.store.getState().dragOffset.initialSourceClientOffset}getClientOffset(){return this.store.getState().dragOffset.clientOffset}getSourceClientOffset(){return HZ(this.store.getState().dragOffset)}getDifferenceFromInitialOffset(){return VZ(this.store.getState().dragOffset)}constructor(e,t){this.store=e,this.registry=t}}const ED=typeof globalThis<"u"?globalThis:self,KB=ED.MutationObserver||ED.WebKitMutationObserver;function XB(s){return function(){const t=setTimeout(r,0),n=setInterval(r,50);function r(){clearTimeout(t),clearInterval(n),s()}}}function GZ(s){let e=1;const t=new KB(s),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){e=-e,n.data=e}}const YZ=typeof KB=="function"?GZ:XB;class KZ{enqueueTask(e){const{queue:t,requestFlush:n}=this;t.length||(n(),this.flushing=!0),t[t.length]=e}constructor(){this.queue=[],this.pendingErrors=[],this.flushing=!1,this.index=0,this.capacity=1024,this.flush=()=>{const{queue:e}=this;for(;this.index<e.length;){const t=this.index;if(this.index++,e[t].call(),this.index>this.capacity){for(let n=0,r=e.length-this.index;n<r;n++)e[n]=e[n+this.index];e.length-=this.index,this.index=0}}e.length=0,this.index=0,this.flushing=!1},this.registerPendingError=e=>{this.pendingErrors.push(e),this.requestErrorThrow()},this.requestFlush=YZ(this.flush),this.requestErrorThrow=XB(()=>{if(this.pendingErrors.length)throw this.pendingErrors.shift()})}}class XZ{call(){try{this.task&&this.task()}catch(e){this.onError(e)}finally{this.task=null,this.release(this)}}constructor(e,t){this.onError=e,this.release=t,this.task=null}}class QZ{create(e){const t=this.freeTasks,n=t.length?t.pop():new XZ(this.onError,r=>t[t.length]=r);return n.task=e,n}constructor(e){this.onError=e,this.freeTasks=[]}}const QB=new KZ,ZZ=new QZ(QB.registerPendingError);function JZ(s){QB.enqueueTask(ZZ.create(s))}const PP="dnd-core/ADD_SOURCE",MP="dnd-core/ADD_TARGET",IP="dnd-core/REMOVE_SOURCE",Xj="dnd-core/REMOVE_TARGET";function eJ(s){return{type:PP,payload:{sourceId:s}}}function tJ(s){return{type:MP,payload:{targetId:s}}}function sJ(s){return{type:IP,payload:{sourceId:s}}}function nJ(s){return{type:Xj,payload:{targetId:s}}}function rJ(s){vt(typeof s.canDrag=="function","Expected canDrag to be a function."),vt(typeof s.beginDrag=="function","Expected beginDrag to be a function."),vt(typeof s.endDrag=="function","Expected endDrag to be a function.")}function iJ(s){vt(typeof s.canDrop=="function","Expected canDrop to be a function."),vt(typeof s.hover=="function","Expected hover to be a function."),vt(typeof s.drop=="function","Expected beginDrag to be a function.")}function G_(s,e){if(e&&Array.isArray(s)){s.forEach(t=>G_(t,!1));return}vt(typeof s=="string"||typeof s=="symbol",e?"Type can only be a string, a symbol, or an array of either.":"Type can only be a string or a symbol.")}var Sa;(function(s){s.SOURCE="SOURCE",s.TARGET="TARGET"})(Sa||(Sa={}));let aJ=0;function oJ(){return aJ++}function lJ(s){const e=oJ().toString();switch(s){case Sa.SOURCE:return`S${e}`;case Sa.TARGET:return`T${e}`;default:throw new Error(`Unknown Handler Role: ${s}`)}}function PD(s){switch(s[0]){case"S":return Sa.SOURCE;case"T":return Sa.TARGET;default:throw new Error(`Cannot parse handler ID: ${s}`)}}function MD(s,e){const t=s.entries();let n=!1;do{const{done:r,value:[,a]}=t.next();if(a===e)return!0;n=!!r}while(!n);return!1}class cJ{addSource(e,t){G_(e),rJ(t);const n=this.addHandler(Sa.SOURCE,e,t);return this.store.dispatch(eJ(n)),n}addTarget(e,t){G_(e,!0),iJ(t);const n=this.addHandler(Sa.TARGET,e,t);return this.store.dispatch(tJ(n)),n}containsHandler(e){return MD(this.dragSources,e)||MD(this.dropTargets,e)}getSource(e,t=!1){return vt(this.isSourceId(e),"Expected a valid source ID."),t&&e===this.pinnedSourceId?this.pinnedSource:this.dragSources.get(e)}getTarget(e){return vt(this.isTargetId(e),"Expected a valid target ID."),this.dropTargets.get(e)}getSourceType(e){return vt(this.isSourceId(e),"Expected a valid source ID."),this.types.get(e)}getTargetType(e){return vt(this.isTargetId(e),"Expected a valid target ID."),this.types.get(e)}isSourceId(e){return PD(e)===Sa.SOURCE}isTargetId(e){return PD(e)===Sa.TARGET}removeSource(e){vt(this.getSource(e),"Expected an existing source."),this.store.dispatch(sJ(e)),JZ(()=>{this.dragSources.delete(e),this.types.delete(e)})}removeTarget(e){vt(this.getTarget(e),"Expected an existing target."),this.store.dispatch(nJ(e)),this.dropTargets.delete(e),this.types.delete(e)}pinSource(e){const t=this.getSource(e);vt(t,"Expected an existing source."),this.pinnedSourceId=e,this.pinnedSource=t}unpinSource(){vt(this.pinnedSource,"No source is pinned at the time."),this.pinnedSourceId=null,this.pinnedSource=null}addHandler(e,t,n){const r=lJ(e);return this.types.set(r,t),e===Sa.SOURCE?this.dragSources.set(r,n):e===Sa.TARGET&&this.dropTargets.set(r,n),r}constructor(e){this.types=new Map,this.dragSources=new Map,this.dropTargets=new Map,this.pinnedSourceId=null,this.pinnedSource=null,this.store=e}}const dJ=(s,e)=>s===e;function uJ(s,e){return!s&&!e?!0:!s||!e?!1:s.x===e.x&&s.y===e.y}function hJ(s,e,t=dJ){if(s.length!==e.length)return!1;for(let n=0;n<s.length;++n)if(!t(s[n],e[n]))return!1;return!0}function fJ(s=dv,e){switch(e.type){case Gj:break;case PP:case MP:case Xj:case IP:return dv;case qj:case TP:case Kj:case Yj:default:return EP}const{targetIds:t=[],prevTargetIds:n=[]}=e.payload,r=xZ(t,n);if(!(r.length>0||!hJ(t,n)))return dv;const o=n[n.length-1],l=t[t.length-1];return o!==l&&(o&&r.push(o),l&&r.push(l)),r}function mJ(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}function pJ(s){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{},n=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),n.forEach(function(r){mJ(s,r,t[r])})}return s}const ID={initialSourceClientOffset:null,initialClientOffset:null,clientOffset:null};function gJ(s=ID,e){const{payload:t}=e;switch(e.type){case _P:case qj:return{initialSourceClientOffset:t.sourceClientOffset,initialClientOffset:t.clientOffset,clientOffset:t.clientOffset};case Gj:return uJ(s.clientOffset,t.clientOffset)?s:pJ({},s,{clientOffset:t.clientOffset});case Kj:case Yj:return ID;default:return s}}function xJ(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}function Tm(s){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{},n=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),n.forEach(function(r){xJ(s,r,t[r])})}return s}const yJ={itemType:null,item:null,sourceId:null,targetIds:[],dropResult:null,didDrop:!1,isSourcePublic:null};function vJ(s=yJ,e){const{payload:t}=e;switch(e.type){case qj:return Tm({},s,{itemType:t.itemType,item:t.item,sourceId:t.sourceId,isSourcePublic:t.isSourcePublic,dropResult:null,didDrop:!1});case TP:return Tm({},s,{isSourcePublic:!0});case Gj:return Tm({},s,{targetIds:t.targetIds});case Xj:return s.targetIds.indexOf(t.targetId)===-1?s:Tm({},s,{targetIds:gZ(s.targetIds,t.targetId)});case Yj:return Tm({},s,{dropResult:t.dropResult,didDrop:!0,targetIds:[]});case Kj:return Tm({},s,{itemType:null,item:null,sourceId:null,dropResult:null,didDrop:!1,isSourcePublic:null,targetIds:[]});default:return s}}function bJ(s=0,e){switch(e.type){case PP:case MP:return s+1;case IP:case Xj:return s-1;default:return s}}function wJ(s=0){return s+1}function CJ(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}function SJ(s){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{},n=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),n.forEach(function(r){CJ(s,r,t[r])})}return s}function jJ(s={},e){return{dirtyHandlerIds:fJ(s.dirtyHandlerIds,{type:e.type,payload:SJ({},e.payload,{prevTargetIds:pZ(s,"dragOperation.targetIds",[])})}),dragOffset:gJ(s.dragOffset,e),refCount:bJ(s.refCount,e),dragOperation:vJ(s.dragOperation,e),stateId:wJ(s.stateId)}}function kJ(s,e=void 0,t={},n=!1){const r=NJ(n),a=new qZ(r,new cJ(r)),o=new UZ(r,a),l=s(o,e,t);return o.receiveBackend(l),o}function NJ(s){const e=typeof window<"u"&&window.__REDUX_DEVTOOLS_EXTENSION__;return qB(jJ,s&&e&&e({name:"dnd-core",instanceId:"dnd-core"}))}function AJ(s,e){if(s==null)return{};var t=_J(s,e),n,r;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(s);for(r=0;r<a.length;r++)n=a[r],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(s,n)&&(t[n]=s[n])}return t}function _J(s,e){if(s==null)return{};var t={},n=Object.keys(s),r,a;for(a=0;a<n.length;a++)r=n[a],!(e.indexOf(r)>=0)&&(t[r]=s[r]);return t}let RD=0;const D1=Symbol.for("__REACT_DND_CONTEXT_INSTANCE__");var TJ=C.memo(function(e){var{children:t}=e,n=AJ(e,["children"]);const[r,a]=EJ(n);return C.useEffect(()=>{if(a){const o=ZB();return++RD,()=>{--RD===0&&(o[D1]=null)}}},[]),i.jsx(WB.Provider,{value:r,children:t})});function EJ(s){if("manager"in s)return[{dragDropManager:s.manager},!1];const e=PJ(s.backend,s.context,s.options,s.debugMode),t=!s.context;return[e,t]}function PJ(s,e=ZB(),t,n){const r=e;return r[D1]||(r[D1]={dragDropManager:kJ(s,e,t,n)}),r[D1]}function ZB(){return typeof globalThis<"u"?globalThis:window}var MJ=function s(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,r,a;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(r=n;r--!==0;)if(!s(e[r],t[r]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(a=Object.keys(e),n=a.length,n!==Object.keys(t).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(t,a[r]))return!1;for(r=n;r--!==0;){var o=a[r];if(!s(e[o],t[o]))return!1}return!0}return e!==e&&t!==t};const IJ=pE(MJ),am=typeof window<"u"?C.useLayoutEffect:C.useEffect;function RJ(s,e,t){const[n,r]=C.useState(()=>e(s)),a=C.useCallback(()=>{const o=e(s);IJ(n,o)||(r(o),t&&t())},[n,s,t]);return am(a),[n,a]}function DJ(s,e,t){const[n,r]=RJ(s,e,t);return am(function(){const o=s.getHandlerId();if(o!=null)return s.subscribeToStateChange(r,{handlerIds:[o]})},[s,r]),n}function JB(s,e,t){return DJ(e,s||(()=>({})),()=>t.reconnect())}function e5(s,e){const t=[...e||[]];return e==null&&typeof s!="function"&&t.push(s),C.useMemo(()=>typeof s=="function"?s():s,t)}function LJ(s){return C.useMemo(()=>s.hooks.dragSource(),[s])}function OJ(s){return C.useMemo(()=>s.hooks.dragPreview(),[s])}let KN=!1,XN=!1;class FJ{receiveHandlerId(e){this.sourceId=e}getHandlerId(){return this.sourceId}canDrag(){vt(!KN,"You may not call monitor.canDrag() inside your canDrag() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return KN=!0,this.internalMonitor.canDragSource(this.sourceId)}finally{KN=!1}}isDragging(){if(!this.sourceId)return!1;vt(!XN,"You may not call monitor.isDragging() inside your isDragging() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return XN=!0,this.internalMonitor.isDraggingSource(this.sourceId)}finally{XN=!1}}subscribeToStateChange(e,t){return this.internalMonitor.subscribeToStateChange(e,t)}isDraggingSource(e){return this.internalMonitor.isDraggingSource(e)}isOverTarget(e,t){return this.internalMonitor.isOverTarget(e,t)}getTargetIds(){return this.internalMonitor.getTargetIds()}isSourcePublic(){return this.internalMonitor.isSourcePublic()}getSourceId(){return this.internalMonitor.getSourceId()}subscribeToOffsetChange(e){return this.internalMonitor.subscribeToOffsetChange(e)}canDragSource(e){return this.internalMonitor.canDragSource(e)}canDropOnTarget(e){return this.internalMonitor.canDropOnTarget(e)}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}constructor(e){this.sourceId=null,this.internalMonitor=e.getMonitor()}}let QN=!1;class BJ{receiveHandlerId(e){this.targetId=e}getHandlerId(){return this.targetId}subscribeToStateChange(e,t){return this.internalMonitor.subscribeToStateChange(e,t)}canDrop(){if(!this.targetId)return!1;vt(!QN,"You may not call monitor.canDrop() inside your canDrop() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target-monitor");try{return QN=!0,this.internalMonitor.canDropOnTarget(this.targetId)}finally{QN=!1}}isOver(e){return this.targetId?this.internalMonitor.isOverTarget(this.targetId,e):!1}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}constructor(e){this.targetId=null,this.internalMonitor=e.getMonitor()}}function $J(s,e,t){const n=t.getRegistry(),r=n.addTarget(s,e);return[r,()=>n.removeTarget(r)]}function UJ(s,e,t){const n=t.getRegistry(),r=n.addSource(s,e);return[r,()=>n.removeSource(r)]}function Y_(s,e,t,n){let r;if(r!==void 0)return!!r;if(s===e)return!0;if(typeof s!="object"||!s||typeof e!="object"||!e)return!1;const a=Object.keys(s),o=Object.keys(e);if(a.length!==o.length)return!1;const l=Object.prototype.hasOwnProperty.bind(e);for(let c=0;c<a.length;c++){const d=a[c];if(!l(d))return!1;const h=s[d],f=e[d];if(r=void 0,r===!1||r===void 0&&h!==f)return!1}return!0}function K_(s){return s!==null&&typeof s=="object"&&Object.prototype.hasOwnProperty.call(s,"current")}function zJ(s){if(typeof s.type=="string")return;const e=s.type.displayName||s.type.name||"the component";throw new Error(`Only native element nodes can now be passed to React DnD connectors.You can either wrap ${e} into a <div>, or turn it into a drag source or a drop target itself.`)}function HJ(s){return(e=null,t=null)=>{if(!C.isValidElement(e)){const a=e;return s(a,t),a}const n=e;return zJ(n),VJ(n,t?a=>s(a,t):s)}}function t5(s){const e={};return Object.keys(s).forEach(t=>{const n=s[t];if(t.endsWith("Ref"))e[t]=s[t];else{const r=HJ(n);e[t]=()=>r}}),e}function DD(s,e){typeof s=="function"?s(e):s.current=e}function VJ(s,e){const t=s.ref;return vt(typeof t!="string","Cannot connect React DnD to an element with an existing string ref. Please convert it to use a callback ref instead, or wrap it into a <span> or <div>. Read more: https://reactjs.org/docs/refs-and-the-dom.html#callback-refs"),t?C.cloneElement(s,{ref:n=>{DD(t,n),DD(e,n)}}):C.cloneElement(s,{ref:e})}class WJ{receiveHandlerId(e){this.handlerId!==e&&(this.handlerId=e,this.reconnect())}get connectTarget(){return this.dragSource}get dragSourceOptions(){return this.dragSourceOptionsInternal}set dragSourceOptions(e){this.dragSourceOptionsInternal=e}get dragPreviewOptions(){return this.dragPreviewOptionsInternal}set dragPreviewOptions(e){this.dragPreviewOptionsInternal=e}reconnect(){const e=this.reconnectDragSource();this.reconnectDragPreview(e)}reconnectDragSource(){const e=this.dragSource,t=this.didHandlerIdChange()||this.didConnectedDragSourceChange()||this.didDragSourceOptionsChange();return t&&this.disconnectDragSource(),this.handlerId?e?(t&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragSource=e,this.lastConnectedDragSourceOptions=this.dragSourceOptions,this.dragSourceUnsubscribe=this.backend.connectDragSource(this.handlerId,e,this.dragSourceOptions)),t):(this.lastConnectedDragSource=e,t):t}reconnectDragPreview(e=!1){const t=this.dragPreview,n=e||this.didHandlerIdChange()||this.didConnectedDragPreviewChange()||this.didDragPreviewOptionsChange();if(n&&this.disconnectDragPreview(),!!this.handlerId){if(!t){this.lastConnectedDragPreview=t;return}n&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragPreview=t,this.lastConnectedDragPreviewOptions=this.dragPreviewOptions,this.dragPreviewUnsubscribe=this.backend.connectDragPreview(this.handlerId,t,this.dragPreviewOptions))}}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didConnectedDragSourceChange(){return this.lastConnectedDragSource!==this.dragSource}didConnectedDragPreviewChange(){return this.lastConnectedDragPreview!==this.dragPreview}didDragSourceOptionsChange(){return!Y_(this.lastConnectedDragSourceOptions,this.dragSourceOptions)}didDragPreviewOptionsChange(){return!Y_(this.lastConnectedDragPreviewOptions,this.dragPreviewOptions)}disconnectDragSource(){this.dragSourceUnsubscribe&&(this.dragSourceUnsubscribe(),this.dragSourceUnsubscribe=void 0)}disconnectDragPreview(){this.dragPreviewUnsubscribe&&(this.dragPreviewUnsubscribe(),this.dragPreviewUnsubscribe=void 0,this.dragPreviewNode=null,this.dragPreviewRef=null)}get dragSource(){return this.dragSourceNode||this.dragSourceRef&&this.dragSourceRef.current}get dragPreview(){return this.dragPreviewNode||this.dragPreviewRef&&this.dragPreviewRef.current}clearDragSource(){this.dragSourceNode=null,this.dragSourceRef=null}clearDragPreview(){this.dragPreviewNode=null,this.dragPreviewRef=null}constructor(e){this.hooks=t5({dragSource:(t,n)=>{this.clearDragSource(),this.dragSourceOptions=n||null,K_(t)?this.dragSourceRef=t:this.dragSourceNode=t,this.reconnectDragSource()},dragPreview:(t,n)=>{this.clearDragPreview(),this.dragPreviewOptions=n||null,K_(t)?this.dragPreviewRef=t:this.dragPreviewNode=t,this.reconnectDragPreview()}}),this.handlerId=null,this.dragSourceRef=null,this.dragSourceOptionsInternal=null,this.dragPreviewRef=null,this.dragPreviewOptionsInternal=null,this.lastConnectedHandlerId=null,this.lastConnectedDragSource=null,this.lastConnectedDragSourceOptions=null,this.lastConnectedDragPreview=null,this.lastConnectedDragPreviewOptions=null,this.backend=e}}class qJ{get connectTarget(){return this.dropTarget}reconnect(){const e=this.didHandlerIdChange()||this.didDropTargetChange()||this.didOptionsChange();e&&this.disconnectDropTarget();const t=this.dropTarget;if(this.handlerId){if(!t){this.lastConnectedDropTarget=t;return}e&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDropTarget=t,this.lastConnectedDropTargetOptions=this.dropTargetOptions,this.unsubscribeDropTarget=this.backend.connectDropTarget(this.handlerId,t,this.dropTargetOptions))}}receiveHandlerId(e){e!==this.handlerId&&(this.handlerId=e,this.reconnect())}get dropTargetOptions(){return this.dropTargetOptionsInternal}set dropTargetOptions(e){this.dropTargetOptionsInternal=e}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didDropTargetChange(){return this.lastConnectedDropTarget!==this.dropTarget}didOptionsChange(){return!Y_(this.lastConnectedDropTargetOptions,this.dropTargetOptions)}disconnectDropTarget(){this.unsubscribeDropTarget&&(this.unsubscribeDropTarget(),this.unsubscribeDropTarget=void 0)}get dropTarget(){return this.dropTargetNode||this.dropTargetRef&&this.dropTargetRef.current}clearDropTarget(){this.dropTargetRef=null,this.dropTargetNode=null}constructor(e){this.hooks=t5({dropTarget:(t,n)=>{this.clearDropTarget(),this.dropTargetOptions=n,K_(t)?this.dropTargetRef=t:this.dropTargetNode=t,this.reconnect()}}),this.handlerId=null,this.dropTargetRef=null,this.dropTargetOptionsInternal=null,this.lastConnectedHandlerId=null,this.lastConnectedDropTarget=null,this.lastConnectedDropTargetOptions=null,this.backend=e}}function Lx(){const{dragDropManager:s}=C.useContext(WB);return vt(s!=null,"Expected drag drop context"),s}function GJ(s,e){const t=Lx(),n=C.useMemo(()=>new WJ(t.getBackend()),[t]);return am(()=>(n.dragSourceOptions=s||null,n.reconnect(),()=>n.disconnectDragSource()),[n,s]),am(()=>(n.dragPreviewOptions=e||null,n.reconnect(),()=>n.disconnectDragPreview()),[n,e]),n}function YJ(){const s=Lx();return C.useMemo(()=>new FJ(s),[s])}class KJ{beginDrag(){const e=this.spec,t=this.monitor;let n=null;return typeof e.item=="object"?n=e.item:typeof e.item=="function"?n=e.item(t):n={},n??null}canDrag(){const e=this.spec,t=this.monitor;return typeof e.canDrag=="boolean"?e.canDrag:typeof e.canDrag=="function"?e.canDrag(t):!0}isDragging(e,t){const n=this.spec,r=this.monitor,{isDragging:a}=n;return a?a(r):t===e.getSourceId()}endDrag(){const e=this.spec,t=this.monitor,n=this.connector,{end:r}=e;r&&r(t.getItem(),t),n.reconnect()}constructor(e,t,n){this.spec=e,this.monitor=t,this.connector=n}}function XJ(s,e,t){const n=C.useMemo(()=>new KJ(s,e,t),[e,t]);return C.useEffect(()=>{n.spec=s},[s]),n}function QJ(s){return C.useMemo(()=>{const e=s.type;return vt(e!=null,"spec.type must be defined"),e},[s])}function ZJ(s,e,t){const n=Lx(),r=XJ(s,e,t),a=QJ(s);am(function(){if(a!=null){const[l,c]=UJ(a,r,n);return e.receiveHandlerId(l),t.receiveHandlerId(l),c}},[n,e,t,r,a])}function JJ(s,e){const t=e5(s,e);vt(!t.begin,"useDrag::spec.begin was deprecated in v14. Replace spec.begin() with spec.item(). (see more here - https://react-dnd.github.io/react-dnd/docs/api/use-drag)");const n=YJ(),r=GJ(t.options,t.previewOptions);return ZJ(t,n,r),[JB(t.collect,n,r),LJ(r),OJ(r)]}function eee(s){return C.useMemo(()=>s.hooks.dropTarget(),[s])}function tee(s){const e=Lx(),t=C.useMemo(()=>new qJ(e.getBackend()),[e]);return am(()=>(t.dropTargetOptions=s||null,t.reconnect(),()=>t.disconnectDropTarget()),[s]),t}function see(){const s=Lx();return C.useMemo(()=>new BJ(s),[s])}function nee(s){const{accept:e}=s;return C.useMemo(()=>(vt(s.accept!=null,"accept must be defined"),Array.isArray(e)?e:[e]),[e])}class ree{canDrop(){const e=this.spec,t=this.monitor;return e.canDrop?e.canDrop(t.getItem(),t):!0}hover(){const e=this.spec,t=this.monitor;e.hover&&e.hover(t.getItem(),t)}drop(){const e=this.spec,t=this.monitor;if(e.drop)return e.drop(t.getItem(),t)}constructor(e,t){this.spec=e,this.monitor=t}}function iee(s,e){const t=C.useMemo(()=>new ree(s,e),[e]);return C.useEffect(()=>{t.spec=s},[s]),t}function aee(s,e,t){const n=Lx(),r=iee(s,e),a=nee(s);am(function(){const[l,c]=$J(a,r,n);return e.receiveHandlerId(l),t.receiveHandlerId(l),c},[n,e,r,t,a.map(o=>o.toString()).join("|")])}function oee(s,e){const t=e5(s,e),n=see(),r=tee(t.options);return aee(t,n,r),[JB(t.collect,n,r),eee(r)]}function s5(s){let e=null;return()=>(e==null&&(e=s()),e)}function lee(s,e){return s.filter(t=>t!==e)}function cee(s,e){const t=new Set,n=a=>t.add(a);s.forEach(n),e.forEach(n);const r=[];return t.forEach(a=>r.push(a)),r}class dee{enter(e){const t=this.entered.length,n=r=>this.isNodeInDocument(r)&&(!r.contains||r.contains(e));return this.entered=cee(this.entered.filter(n),[e]),t===0&&this.entered.length>0}leave(e){const t=this.entered.length;return this.entered=lee(this.entered.filter(this.isNodeInDocument),e),t>0&&this.entered.length===0}reset(){this.entered=[]}constructor(e){this.entered=[],this.isNodeInDocument=e}}class uee{initializeExposedProperties(){Object.keys(this.config.exposeProperties).forEach(e=>{Object.defineProperty(this.item,e,{configurable:!0,enumerable:!0,get(){return console.warn(`Browser doesn't allow reading "${e}" until the drop event.`),null}})})}loadDataTransfer(e){if(e){const t={};Object.keys(this.config.exposeProperties).forEach(n=>{const r=this.config.exposeProperties[n];r!=null&&(t[n]={value:r(e,this.config.matchesTypes),configurable:!0,enumerable:!0})}),Object.defineProperties(this.item,t)}}canDrag(){return!0}beginDrag(){return this.item}isDragging(e,t){return t===e.getSourceId()}endDrag(){}constructor(e){this.config=e,this.item={},this.initializeExposedProperties()}}const n5="__NATIVE_FILE__",r5="__NATIVE_URL__",i5="__NATIVE_TEXT__",a5="__NATIVE_HTML__",LD=Object.freeze(Object.defineProperty({__proto__:null,FILE:n5,HTML:a5,TEXT:i5,URL:r5},Symbol.toStringTag,{value:"Module"}));function ZN(s,e,t){const n=e.reduce((r,a)=>r||s.getData(a),"");return n??t}const X_={[n5]:{exposeProperties:{files:s=>Array.prototype.slice.call(s.files),items:s=>s.items,dataTransfer:s=>s},matchesTypes:["Files"]},[a5]:{exposeProperties:{html:(s,e)=>ZN(s,e,""),dataTransfer:s=>s},matchesTypes:["Html","text/html"]},[r5]:{exposeProperties:{urls:(s,e)=>ZN(s,e,"").split(`
`),dataTransfer:s=>s},matchesTypes:["Url","text/uri-list"]},[i5]:{exposeProperties:{text:(s,e)=>ZN(s,e,""),dataTransfer:s=>s},matchesTypes:["Text","text/plain"]}};function hee(s,e){const t=X_[s];if(!t)throw new Error(`native type ${s} has no configuration`);const n=new uee(t);return n.loadDataTransfer(e),n}function JN(s){if(!s)return null;const e=Array.prototype.slice.call(s.types||[]);return Object.keys(X_).filter(t=>{const n=X_[t];return n!=null&&n.matchesTypes?n.matchesTypes.some(r=>e.indexOf(r)>-1):!1})[0]||null}const fee=s5(()=>/firefox/i.test(navigator.userAgent)),o5=s5(()=>!!window.safari);class OD{interpolate(e){const{xs:t,ys:n,c1s:r,c2s:a,c3s:o}=this;let l=t.length-1;if(e===t[l])return n[l];let c=0,d=o.length-1,h;for(;c<=d;){h=Math.floor(.5*(c+d));const p=t[h];if(p<e)c=h+1;else if(p>e)d=h-1;else return n[h]}l=Math.max(0,d);const f=e-t[l],m=f*f;return n[l]+r[l]*f+a[l]*m+o[l]*f*m}constructor(e,t){const{length:n}=e,r=[];for(let p=0;p<n;p++)r.push(p);r.sort((p,x)=>e[p]<e[x]?-1:1);const a=[],o=[];let l,c;for(let p=0;p<n-1;p++)l=e[p+1]-e[p],c=t[p+1]-t[p],a.push(l),o.push(c/l);const d=[o[0]];for(let p=0;p<a.length-1;p++){const x=o[p],g=o[p+1];if(x*g<=0)d.push(0);else{l=a[p];const b=a[p+1],v=l+b;d.push(3*v/((v+b)/x+(v+l)/g))}}d.push(o[o.length-1]);const h=[],f=[];let m;for(let p=0;p<d.length-1;p++){m=o[p];const x=d[p],g=1/a[p],b=x+d[p+1]-m-m;h.push((m-x-b)*g),f.push(b*g*g)}this.xs=e,this.ys=t,this.c1s=d,this.c2s=h,this.c3s=f}}const mee=1;function l5(s){const e=s.nodeType===mee?s:s.parentElement;if(!e)return null;const{top:t,left:n}=e.getBoundingClientRect();return{x:n,y:t}}function Kw(s){return{x:s.clientX,y:s.clientY}}function pee(s){var e;return s.nodeName==="IMG"&&(fee()||!(!((e=document.documentElement)===null||e===void 0)&&e.contains(s)))}function gee(s,e,t,n){let r=s?e.width:t,a=s?e.height:n;return o5()&&s&&(a/=window.devicePixelRatio,r/=window.devicePixelRatio),{dragPreviewWidth:r,dragPreviewHeight:a}}function xee(s,e,t,n,r){const a=pee(e),l=l5(a?s:e),c={x:t.x-l.x,y:t.y-l.y},{offsetWidth:d,offsetHeight:h}=s,{anchorX:f,anchorY:m}=n,{dragPreviewWidth:p,dragPreviewHeight:x}=gee(a,e,d,h),g=()=>{let A=new OD([0,.5,1],[c.y,c.y/h*x,c.y+x-h]).interpolate(m);return o5()&&a&&(A+=(window.devicePixelRatio-1)*x),A},b=()=>new OD([0,.5,1],[c.x,c.x/d*p,c.x+p-d]).interpolate(f),{offsetX:v,offsetY:y}=r,w=v===0||v,S=y===0||y;return{x:w?v:b(),y:S?y:g()}}class yee{get window(){if(this.globalContext)return this.globalContext;if(typeof window<"u")return window}get document(){var e;return!((e=this.globalContext)===null||e===void 0)&&e.document?this.globalContext.document:this.window?this.window.document:void 0}get rootElement(){var e;return((e=this.optionsArgs)===null||e===void 0?void 0:e.rootElement)||this.window}constructor(e,t){this.ownerDocument=null,this.globalContext=e,this.optionsArgs=t}}function vee(s,e,t){return e in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}function FD(s){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{},n=Object.keys(t);typeof Object.getOwnPropertySymbols=="function"&&(n=n.concat(Object.getOwnPropertySymbols(t).filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),n.forEach(function(r){vee(s,r,t[r])})}return s}class bee{profile(){var e,t;return{sourcePreviewNodes:this.sourcePreviewNodes.size,sourcePreviewNodeOptions:this.sourcePreviewNodeOptions.size,sourceNodeOptions:this.sourceNodeOptions.size,sourceNodes:this.sourceNodes.size,dragStartSourceIds:((e=this.dragStartSourceIds)===null||e===void 0?void 0:e.length)||0,dropTargetIds:this.dropTargetIds.length,dragEnterTargetIds:this.dragEnterTargetIds.length,dragOverTargetIds:((t=this.dragOverTargetIds)===null||t===void 0?void 0:t.length)||0}}get window(){return this.options.window}get document(){return this.options.document}get rootElement(){return this.options.rootElement}setup(){const e=this.rootElement;if(e!==void 0){if(e.__isReactDndBackendSetUp)throw new Error("Cannot have two HTML5 backends at the same time.");e.__isReactDndBackendSetUp=!0,this.addEventListeners(e)}}teardown(){const e=this.rootElement;if(e!==void 0&&(e.__isReactDndBackendSetUp=!1,this.removeEventListeners(this.rootElement),this.clearCurrentDragSourceNode(),this.asyncEndDragFrameId)){var t;(t=this.window)===null||t===void 0||t.cancelAnimationFrame(this.asyncEndDragFrameId)}}connectDragPreview(e,t,n){return this.sourcePreviewNodeOptions.set(e,n),this.sourcePreviewNodes.set(e,t),()=>{this.sourcePreviewNodes.delete(e),this.sourcePreviewNodeOptions.delete(e)}}connectDragSource(e,t,n){this.sourceNodes.set(e,t),this.sourceNodeOptions.set(e,n);const r=o=>this.handleDragStart(o,e),a=o=>this.handleSelectStart(o);return t.setAttribute("draggable","true"),t.addEventListener("dragstart",r),t.addEventListener("selectstart",a),()=>{this.sourceNodes.delete(e),this.sourceNodeOptions.delete(e),t.removeEventListener("dragstart",r),t.removeEventListener("selectstart",a),t.setAttribute("draggable","false")}}connectDropTarget(e,t){const n=o=>this.handleDragEnter(o,e),r=o=>this.handleDragOver(o,e),a=o=>this.handleDrop(o,e);return t.addEventListener("dragenter",n),t.addEventListener("dragover",r),t.addEventListener("drop",a),()=>{t.removeEventListener("dragenter",n),t.removeEventListener("dragover",r),t.removeEventListener("drop",a)}}addEventListeners(e){e.addEventListener&&(e.addEventListener("dragstart",this.handleTopDragStart),e.addEventListener("dragstart",this.handleTopDragStartCapture,!0),e.addEventListener("dragend",this.handleTopDragEndCapture,!0),e.addEventListener("dragenter",this.handleTopDragEnter),e.addEventListener("dragenter",this.handleTopDragEnterCapture,!0),e.addEventListener("dragleave",this.handleTopDragLeaveCapture,!0),e.addEventListener("dragover",this.handleTopDragOver),e.addEventListener("dragover",this.handleTopDragOverCapture,!0),e.addEventListener("drop",this.handleTopDrop),e.addEventListener("drop",this.handleTopDropCapture,!0))}removeEventListeners(e){e.removeEventListener&&(e.removeEventListener("dragstart",this.handleTopDragStart),e.removeEventListener("dragstart",this.handleTopDragStartCapture,!0),e.removeEventListener("dragend",this.handleTopDragEndCapture,!0),e.removeEventListener("dragenter",this.handleTopDragEnter),e.removeEventListener("dragenter",this.handleTopDragEnterCapture,!0),e.removeEventListener("dragleave",this.handleTopDragLeaveCapture,!0),e.removeEventListener("dragover",this.handleTopDragOver),e.removeEventListener("dragover",this.handleTopDragOverCapture,!0),e.removeEventListener("drop",this.handleTopDrop),e.removeEventListener("drop",this.handleTopDropCapture,!0))}getCurrentSourceNodeOptions(){const e=this.monitor.getSourceId(),t=this.sourceNodeOptions.get(e);return FD({dropEffect:this.altKeyPressed?"copy":"move"},t||{})}getCurrentDropEffect(){return this.isDraggingNativeItem()?"copy":this.getCurrentSourceNodeOptions().dropEffect}getCurrentSourcePreviewNodeOptions(){const e=this.monitor.getSourceId(),t=this.sourcePreviewNodeOptions.get(e);return FD({anchorX:.5,anchorY:.5,captureDraggingState:!1},t||{})}isDraggingNativeItem(){const e=this.monitor.getItemType();return Object.keys(LD).some(t=>LD[t]===e)}beginDragNativeItem(e,t){this.clearCurrentDragSourceNode(),this.currentNativeSource=hee(e,t),this.currentNativeHandle=this.registry.addSource(e,this.currentNativeSource),this.actions.beginDrag([this.currentNativeHandle])}setCurrentDragSourceNode(e){this.clearCurrentDragSourceNode(),this.currentDragSourceNode=e;const t=1e3;this.mouseMoveTimeoutTimer=setTimeout(()=>{var n;return(n=this.rootElement)===null||n===void 0?void 0:n.addEventListener("mousemove",this.endDragIfSourceWasRemovedFromDOM,!0)},t)}clearCurrentDragSourceNode(){if(this.currentDragSourceNode){if(this.currentDragSourceNode=null,this.rootElement){var e;(e=this.window)===null||e===void 0||e.clearTimeout(this.mouseMoveTimeoutTimer||void 0),this.rootElement.removeEventListener("mousemove",this.endDragIfSourceWasRemovedFromDOM,!0)}return this.mouseMoveTimeoutTimer=null,!0}return!1}handleDragStart(e,t){e.defaultPrevented||(this.dragStartSourceIds||(this.dragStartSourceIds=[]),this.dragStartSourceIds.unshift(t))}handleDragEnter(e,t){this.dragEnterTargetIds.unshift(t)}handleDragOver(e,t){this.dragOverTargetIds===null&&(this.dragOverTargetIds=[]),this.dragOverTargetIds.unshift(t)}handleDrop(e,t){this.dropTargetIds.unshift(t)}constructor(e,t,n){this.sourcePreviewNodes=new Map,this.sourcePreviewNodeOptions=new Map,this.sourceNodes=new Map,this.sourceNodeOptions=new Map,this.dragStartSourceIds=null,this.dropTargetIds=[],this.dragEnterTargetIds=[],this.currentNativeSource=null,this.currentNativeHandle=null,this.currentDragSourceNode=null,this.altKeyPressed=!1,this.mouseMoveTimeoutTimer=null,this.asyncEndDragFrameId=null,this.dragOverTargetIds=null,this.lastClientOffset=null,this.hoverRafId=null,this.getSourceClientOffset=r=>{const a=this.sourceNodes.get(r);return a&&l5(a)||null},this.endDragNativeItem=()=>{this.isDraggingNativeItem()&&(this.actions.endDrag(),this.currentNativeHandle&&this.registry.removeSource(this.currentNativeHandle),this.currentNativeHandle=null,this.currentNativeSource=null)},this.isNodeInDocument=r=>!!(r&&this.document&&this.document.body&&this.document.body.contains(r)),this.endDragIfSourceWasRemovedFromDOM=()=>{const r=this.currentDragSourceNode;r==null||this.isNodeInDocument(r)||(this.clearCurrentDragSourceNode()&&this.monitor.isDragging()&&this.actions.endDrag(),this.cancelHover())},this.scheduleHover=r=>{this.hoverRafId===null&&typeof requestAnimationFrame<"u"&&(this.hoverRafId=requestAnimationFrame(()=>{this.monitor.isDragging()&&this.actions.hover(r||[],{clientOffset:this.lastClientOffset}),this.hoverRafId=null}))},this.cancelHover=()=>{this.hoverRafId!==null&&typeof cancelAnimationFrame<"u"&&(cancelAnimationFrame(this.hoverRafId),this.hoverRafId=null)},this.handleTopDragStartCapture=()=>{this.clearCurrentDragSourceNode(),this.dragStartSourceIds=[]},this.handleTopDragStart=r=>{if(r.defaultPrevented)return;const{dragStartSourceIds:a}=this;this.dragStartSourceIds=null;const o=Kw(r);this.monitor.isDragging()&&(this.actions.endDrag(),this.cancelHover()),this.actions.beginDrag(a||[],{publishSource:!1,getSourceClientOffset:this.getSourceClientOffset,clientOffset:o});const{dataTransfer:l}=r,c=JN(l);if(this.monitor.isDragging()){if(l&&typeof l.setDragImage=="function"){const h=this.monitor.getSourceId(),f=this.sourceNodes.get(h),m=this.sourcePreviewNodes.get(h)||f;if(m){const{anchorX:p,anchorY:x,offsetX:g,offsetY:b}=this.getCurrentSourcePreviewNodeOptions(),w=xee(f,m,o,{anchorX:p,anchorY:x},{offsetX:g,offsetY:b});l.setDragImage(m,w.x,w.y)}}try{l==null||l.setData("application/json",{})}catch{}this.setCurrentDragSourceNode(r.target);const{captureDraggingState:d}=this.getCurrentSourcePreviewNodeOptions();d?this.actions.publishDragSource():setTimeout(()=>this.actions.publishDragSource(),0)}else if(c)this.beginDragNativeItem(c);else{if(l&&!l.types&&(r.target&&!r.target.hasAttribute||!r.target.hasAttribute("draggable")))return;r.preventDefault()}},this.handleTopDragEndCapture=()=>{this.clearCurrentDragSourceNode()&&this.monitor.isDragging()&&this.actions.endDrag(),this.cancelHover()},this.handleTopDragEnterCapture=r=>{if(this.dragEnterTargetIds=[],this.isDraggingNativeItem()){var a;(a=this.currentNativeSource)===null||a===void 0||a.loadDataTransfer(r.dataTransfer)}if(!this.enterLeaveCounter.enter(r.target)||this.monitor.isDragging())return;const{dataTransfer:l}=r,c=JN(l);c&&this.beginDragNativeItem(c,l)},this.handleTopDragEnter=r=>{const{dragEnterTargetIds:a}=this;if(this.dragEnterTargetIds=[],!this.monitor.isDragging())return;this.altKeyPressed=r.altKey,a.length>0&&this.actions.hover(a,{clientOffset:Kw(r)}),a.some(l=>this.monitor.canDropOnTarget(l))&&(r.preventDefault(),r.dataTransfer&&(r.dataTransfer.dropEffect=this.getCurrentDropEffect()))},this.handleTopDragOverCapture=r=>{if(this.dragOverTargetIds=[],this.isDraggingNativeItem()){var a;(a=this.currentNativeSource)===null||a===void 0||a.loadDataTransfer(r.dataTransfer)}},this.handleTopDragOver=r=>{const{dragOverTargetIds:a}=this;if(this.dragOverTargetIds=[],!this.monitor.isDragging()){r.preventDefault(),r.dataTransfer&&(r.dataTransfer.dropEffect="none");return}this.altKeyPressed=r.altKey,this.lastClientOffset=Kw(r),this.scheduleHover(a),(a||[]).some(l=>this.monitor.canDropOnTarget(l))?(r.preventDefault(),r.dataTransfer&&(r.dataTransfer.dropEffect=this.getCurrentDropEffect())):this.isDraggingNativeItem()?r.preventDefault():(r.preventDefault(),r.dataTransfer&&(r.dataTransfer.dropEffect="none"))},this.handleTopDragLeaveCapture=r=>{this.isDraggingNativeItem()&&r.preventDefault(),this.enterLeaveCounter.leave(r.target)&&(this.isDraggingNativeItem()&&setTimeout(()=>this.endDragNativeItem(),0),this.cancelHover())},this.handleTopDropCapture=r=>{if(this.dropTargetIds=[],this.isDraggingNativeItem()){var a;r.preventDefault(),(a=this.currentNativeSource)===null||a===void 0||a.loadDataTransfer(r.dataTransfer)}else JN(r.dataTransfer)&&r.preventDefault();this.enterLeaveCounter.reset()},this.handleTopDrop=r=>{const{dropTargetIds:a}=this;this.dropTargetIds=[],this.actions.hover(a,{clientOffset:Kw(r)}),this.actions.drop({dropEffect:this.getCurrentDropEffect()}),this.isDraggingNativeItem()?this.endDragNativeItem():this.monitor.isDragging()&&this.actions.endDrag(),this.cancelHover()},this.handleSelectStart=r=>{const a=r.target;typeof a.dragDrop=="function"&&(a.tagName==="INPUT"||a.tagName==="SELECT"||a.tagName==="TEXTAREA"||a.isContentEditable||(r.preventDefault(),a.dragDrop()))},this.options=new yee(t,n),this.actions=e.getActions(),this.monitor=e.getMonitor(),this.registry=e.getRegistry(),this.enterLeaveCounter=new dee(this.isNodeInDocument)}}const wee=function(e,t,n){return new bee(e,t,n)},Cee=new HK("http://127.0.0.1:3210"),See={theme:"system",setTheme:()=>null,actualTheme:"light"},c5=C.createContext(See);function jee({children:s,defaultTheme:e="system",storageKey:t="campaignion-ui-theme",...n}){const[r,a]=C.useState(()=>localStorage.getItem(t)||e),[o,l]=C.useState("light");C.useEffect(()=>{const d=window.document.documentElement;d.classList.remove("light","dark");let h;r==="system"?h=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":h=r,d.classList.add(h),l(h);const f=document.querySelector('meta[name="theme-color"]');f&&f.setAttribute("content",h==="dark"?"#0f172a":"#ffffff")},[r]),C.useEffect(()=>{if(r==="system"){const d=window.matchMedia("(prefers-color-scheme: dark)"),h=()=>{const f=window.document.documentElement;f.classList.remove("light","dark");const m=d.matches?"dark":"light";f.classList.add(m),l(m)};return d.addEventListener("change",h),()=>d.removeEventListener("change",h)}},[r]);const c={theme:r,setTheme:d=>{localStorage.setItem(t,d),a(d)},actualTheme:o};return i.jsx(c5.Provider,{...n,value:c,children:s})}const Ox=()=>{const s=C.useContext(c5);if(s===void 0)throw new Error("useTheme must be used within a ThemeProvider");return s};function kee({onSessionExpired:s,onUnauthorized:e,onAuthError:t,showToast:n}={}){const{isLoaded:r,isSignedIn:a,signOut:o,getToken:l}=Ji(),{isLoading:c,isAuthenticated:d}=YK(),h=C.useCallback(p=>{console.error("Authentication error:",p);const x={code:p.code||"UNKNOWN_AUTH_ERROR",message:p.message||"An authentication error occurred",originalError:p};switch(p.code){case"Unauthenticated":case"UNAUTHENTICATED":n==null||n("Your session has expired. Please sign in again.","warning"),s==null||s();break;case"UNAUTHORIZED":n==null||n("You are not authorized to perform this action.","error"),e==null||e();break;case"INVALID_TOKEN":case"TOKEN_EXPIRED":n==null||n("Your session token is invalid. Please sign in again.","warning"),s==null||s();break;case"NETWORK_ERROR":n==null||n("Network error. Please check your connection and try again.","error");break;default:typeof p=="string"?p.includes("Unauthenticated")||p.includes("authentication")?(n==null||n("Authentication error. Please sign in again.","warning"),s==null||s()):n==null||n("An unexpected error occurred.","error"):n==null||n("An unexpected authentication error occurred.","error");break}t==null||t(x)},[s,e,t,n]);C.useEffect(()=>{r&&!c&&a&&!d&&(console.warn("Authentication state mismatch detected"),console.log("Clerk state:",{isSignedIn:a,isLoaded:r}),console.log("Convex state:",{isConvexAuthenticated:d,isLoading:c}),l({template:"convex",skipCache:!0}).then(p=>{p?(console.log('Clerk token retrieved successfully for "convex" template'),n==null||n("Authentication configuration issue detected. Please check your Convex auth setup.","warning")):(console.error("No token received from Clerk"),n==null||n("Authentication token not available. Please sign in again.","warning"),h({code:"NO_TOKEN",message:"No authentication token available from Clerk"}))}).catch(p=>{console.error("Failed to refresh token:",p),n==null||n("Failed to refresh authentication token. Please sign in again.","error"),h({code:"TOKEN_REFRESH_FAILED",message:"Failed to refresh authentication token"})}))},[r,c,a,d,l,h,n]);const f=C.useCallback(async()=>{try{await o(),n==null||n("You have been signed out.","info")}catch(p){console.error("Sign out error:",p),n==null||n("Error during sign out. Please refresh the page.","error")}},[o,n]),m=C.useCallback(async()=>{try{return await l({skipCache:!0}),n==null||n("Session refreshed successfully.","info"),!0}catch(p){return console.error("Session refresh failed:",p),h(p),!1}},[l,n,h]);return{handleAuthError:h,signOutUser:f,refreshSession:m,isAuthenticated:a&&d,isLoading:!r||c}}function Nee({warningTimeMinutes:s=5,checkIntervalSeconds:e=30,onSessionExpiring:t,onSessionExpired:n,onSessionRefreshed:r}={}){const{isSignedIn:a,getToken:o,session:l}=Ji(),[c,d]=C.useState({isExpiringSoon:!1,isExpired:!1}),h=C.useRef(),f=C.useRef(0),m=C.useCallback(async()=>{if(!a||!l){d({isExpiringSoon:!1,isExpired:!0});return}try{const g=await o({skipCache:!1});if(!g){d({isExpiringSoon:!1,isExpired:!0}),n==null||n();return}try{const v=JSON.parse(atob(g.split(".")[1])).exp*1e3,y=Date.now(),w=v-y,S=s*60*1e3,j=w<=0,A=w<=S&&w>0;if(d({expiresAt:v,timeUntilExpiry:Math.max(0,w),isExpiringSoon:A,isExpired:j}),j)n==null||n();else if(A){const k=Date.now();k-f.current>6e4&&(f.current=k,t==null||t(w))}}catch(b){console.error("Failed to parse token:",b),d({isExpiringSoon:!1,isExpired:!0}),n==null||n()}}catch(g){console.error("Error checking session status:",g),d({isExpiringSoon:!1,isExpired:!0})}},[a,l,o,s,t,n]),p=C.useCallback(async()=>{try{return await o({skipCache:!0})?(r==null||r(),await m(),!0):!1}catch(g){return console.error("Failed to refresh session:",g),!1}},[o,r,m]);C.useEffect(()=>{if(a)return m(),h.current=setInterval(m,e*1e3),()=>{h.current&&clearInterval(h.current)};h.current&&(clearInterval(h.current),h.current=void 0),d({isExpiringSoon:!1,isExpired:!1})},[a,m,e]);const x=C.useCallback(g=>{const b=Math.floor(g/6e4),v=Math.floor(g%6e4/1e3);return b>0?`${b}m ${v}s`:`${v}s`},[]);return{sessionInfo:c,refreshSession:p,formatTimeRemaining:x,isMonitoring:a&&!!h.current}}function Aee(s,e){const t=C.createContext(e),n=a=>{const{children:o,...l}=a,c=C.useMemo(()=>l,Object.values(l));return i.jsx(t.Provider,{value:c,children:o})};n.displayName=s+"Provider";function r(a){const o=C.useContext(t);if(o)return o;if(e!==void 0)return e;throw new Error(`\`${a}\` must be used within \`${s}\``)}return[n,r]}function Oa(s,e=[]){let t=[];function n(a,o){const l=C.createContext(o),c=t.length;t=[...t,o];const d=f=>{var v;const{scope:m,children:p,...x}=f,g=((v=m==null?void 0:m[s])==null?void 0:v[c])||l,b=C.useMemo(()=>x,Object.values(x));return i.jsx(g.Provider,{value:b,children:p})};d.displayName=a+"Provider";function h(f,m){var g;const p=((g=m==null?void 0:m[s])==null?void 0:g[c])||l,x=C.useContext(p);if(x)return x;if(o!==void 0)return o;throw new Error(`\`${f}\` must be used within \`${a}\``)}return[d,h]}const r=()=>{const a=t.map(o=>C.createContext(o));return function(l){const c=(l==null?void 0:l[s])||a;return C.useMemo(()=>({[`__scope${s}`]:{...l,[s]:c}}),[l,c])}};return r.scopeName=s,[n,_ee(r,...e)]}function _ee(...s){const e=s[0];if(s.length===1)return e;const t=()=>{const n=s.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(a){const o=n.reduce((l,{useScope:c,scopeName:d})=>{const f=c(a)[`__scope${d}`];return{...l,...f}},{});return C.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return t.scopeName=e.scopeName,t}function BD(s,e){if(typeof s=="function")return s(e);s!=null&&(s.current=e)}function qc(...s){return e=>{let t=!1;const n=s.map(r=>{const a=BD(r,e);return!t&&typeof a=="function"&&(t=!0),a});if(t)return()=>{for(let r=0;r<n.length;r++){const a=n[r];typeof a=="function"?a():BD(s[r],null)}}}}function Tt(...s){return C.useCallback(qc(...s),s)}function He(s,e,{checkForDefaultPrevented:t=!0}={}){return function(r){if(s==null||s(r),t===!1||!r.defaultPrevented)return e==null?void 0:e(r)}}var mr=globalThis!=null&&globalThis.document?C.useLayoutEffect:()=>{},Tee=bE[" useId ".trim().toString()]||(()=>{}),Eee=0;function gl(s){const[e,t]=C.useState(Tee());return mr(()=>{t(n=>n??String(Eee++))},[s]),e?`radix-${e}`:""}var Pee=bE[" useInsertionEffect ".trim().toString()]||mr;function Lc({prop:s,defaultProp:e,onChange:t=()=>{},caller:n}){const[r,a,o]=Mee({defaultProp:e,onChange:t}),l=s!==void 0,c=l?s:r;{const h=C.useRef(s!==void 0);C.useEffect(()=>{const f=h.current;f!==l&&console.warn(`${n} is changing from ${f?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),h.current=l},[l,n])}const d=C.useCallback(h=>{var f;if(l){const m=Iee(h)?h(s):h;m!==s&&((f=o.current)==null||f.call(o,m))}else a(h)},[l,s,a,o]);return[c,d]}function Mee({defaultProp:s,onChange:e}){const[t,n]=C.useState(s),r=C.useRef(t),a=C.useRef(e);return Pee(()=>{a.current=e},[e]),C.useEffect(()=>{var o;r.current!==t&&((o=a.current)==null||o.call(a,t),r.current=t)},[t,r]),[t,n,a]}function Iee(s){return typeof s=="function"}function Ree(s){const e=Dee(s),t=C.forwardRef((n,r)=>{const{children:a,...o}=n,l=C.Children.toArray(a),c=l.find(Oee);if(c){const d=c.props.children,h=l.map(f=>f===c?C.Children.count(d)>1?C.Children.only(null):C.isValidElement(d)?d.props.children:null:f);return i.jsx(e,{...o,ref:r,children:C.isValidElement(d)?C.cloneElement(d,void 0,h):null})}return i.jsx(e,{...o,ref:r,children:a})});return t.displayName=`${s}.Slot`,t}function Dee(s){const e=C.forwardRef((t,n)=>{const{children:r,...a}=t;if(C.isValidElement(r)){const o=Bee(r),l=Fee(a,r.props);return r.type!==C.Fragment&&(l.ref=n?qc(n,o):o),C.cloneElement(r,l)}return C.Children.count(r)>1?C.Children.only(null):null});return e.displayName=`${s}.SlotClone`,e}var Lee=Symbol("radix.slottable");function Oee(s){return C.isValidElement(s)&&typeof s.type=="function"&&"__radixId"in s.type&&s.type.__radixId===Lee}function Fee(s,e){const t={...e};for(const n in e){const r=s[n],a=e[n];/^on[A-Z]/.test(n)?r&&a?t[n]=(...l)=>{const c=a(...l);return r(...l),c}:r&&(t[n]=r):n==="style"?t[n]={...r,...a}:n==="className"&&(t[n]=[r,a].filter(Boolean).join(" "))}return{...s,...t}}function Bee(s){var n,r;let e=(n=Object.getOwnPropertyDescriptor(s.props,"ref"))==null?void 0:n.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?s.ref:(e=(r=Object.getOwnPropertyDescriptor(s,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?s.props.ref:s.props.ref||s.ref)}var $ee=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],ot=$ee.reduce((s,e)=>{const t=Ree(`Primitive.${e}`),n=C.forwardRef((r,a)=>{const{asChild:o,...l}=r,c=o?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),i.jsx(c,{...l,ref:a})});return n.displayName=`Primitive.${e}`,{...s,[e]:n}},{});function d5(s,e){s&&Gu.flushSync(()=>s.dispatchEvent(e))}function bl(s){const e=C.useRef(s);return C.useEffect(()=>{e.current=s}),C.useMemo(()=>(...t)=>{var n;return(n=e.current)==null?void 0:n.call(e,...t)},[])}function Uee(s,e=globalThis==null?void 0:globalThis.document){const t=bl(s);C.useEffect(()=>{const n=r=>{r.key==="Escape"&&t(r)};return e.addEventListener("keydown",n,{capture:!0}),()=>e.removeEventListener("keydown",n,{capture:!0})},[t,e])}var zee="DismissableLayer",Q_="dismissableLayer.update",Hee="dismissableLayer.pointerDownOutside",Vee="dismissableLayer.focusOutside",$D,u5=C.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Qj=C.forwardRef((s,e)=>{const{disableOutsidePointerEvents:t=!1,onEscapeKeyDown:n,onPointerDownOutside:r,onFocusOutside:a,onInteractOutside:o,onDismiss:l,...c}=s,d=C.useContext(u5),[h,f]=C.useState(null),m=(h==null?void 0:h.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,p]=C.useState({}),x=Tt(e,k=>f(k)),g=Array.from(d.layers),[b]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),v=g.indexOf(b),y=h?g.indexOf(h):-1,w=d.layersWithOutsidePointerEventsDisabled.size>0,S=y>=v,j=Gee(k=>{const _=k.target,L=[...d.branches].some(D=>D.contains(_));!S||L||(r==null||r(k),o==null||o(k),k.defaultPrevented||l==null||l())},m),A=Yee(k=>{const _=k.target;[...d.branches].some(D=>D.contains(_))||(a==null||a(k),o==null||o(k),k.defaultPrevented||l==null||l())},m);return Uee(k=>{y===d.layers.size-1&&(n==null||n(k),!k.defaultPrevented&&l&&(k.preventDefault(),l()))},m),C.useEffect(()=>{if(h)return t&&(d.layersWithOutsidePointerEventsDisabled.size===0&&($D=m.body.style.pointerEvents,m.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(h)),d.layers.add(h),UD(),()=>{t&&d.layersWithOutsidePointerEventsDisabled.size===1&&(m.body.style.pointerEvents=$D)}},[h,m,t,d]),C.useEffect(()=>()=>{h&&(d.layers.delete(h),d.layersWithOutsidePointerEventsDisabled.delete(h),UD())},[h,d]),C.useEffect(()=>{const k=()=>p({});return document.addEventListener(Q_,k),()=>document.removeEventListener(Q_,k)},[]),i.jsx(ot.div,{...c,ref:x,style:{pointerEvents:w?S?"auto":"none":void 0,...s.style},onFocusCapture:He(s.onFocusCapture,A.onFocusCapture),onBlurCapture:He(s.onBlurCapture,A.onBlurCapture),onPointerDownCapture:He(s.onPointerDownCapture,j.onPointerDownCapture)})});Qj.displayName=zee;var Wee="DismissableLayerBranch",qee=C.forwardRef((s,e)=>{const t=C.useContext(u5),n=C.useRef(null),r=Tt(e,n);return C.useEffect(()=>{const a=n.current;if(a)return t.branches.add(a),()=>{t.branches.delete(a)}},[t.branches]),i.jsx(ot.div,{...s,ref:r})});qee.displayName=Wee;function Gee(s,e=globalThis==null?void 0:globalThis.document){const t=bl(s),n=C.useRef(!1),r=C.useRef(()=>{});return C.useEffect(()=>{const a=l=>{if(l.target&&!n.current){let c=function(){h5(Hee,t,d,{discrete:!0})};const d={originalEvent:l};l.pointerType==="touch"?(e.removeEventListener("click",r.current),r.current=c,e.addEventListener("click",r.current,{once:!0})):c()}else e.removeEventListener("click",r.current);n.current=!1},o=window.setTimeout(()=>{e.addEventListener("pointerdown",a)},0);return()=>{window.clearTimeout(o),e.removeEventListener("pointerdown",a),e.removeEventListener("click",r.current)}},[e,t]),{onPointerDownCapture:()=>n.current=!0}}function Yee(s,e=globalThis==null?void 0:globalThis.document){const t=bl(s),n=C.useRef(!1);return C.useEffect(()=>{const r=a=>{a.target&&!n.current&&h5(Vee,t,{originalEvent:a},{discrete:!1})};return e.addEventListener("focusin",r),()=>e.removeEventListener("focusin",r)},[e,t]),{onFocusCapture:()=>n.current=!0,onBlurCapture:()=>n.current=!1}}function UD(){const s=new CustomEvent(Q_);document.dispatchEvent(s)}function h5(s,e,t,{discrete:n}){const r=t.originalEvent.target,a=new CustomEvent(s,{bubbles:!1,cancelable:!0,detail:t});e&&r.addEventListener(s,e,{once:!0}),n?d5(r,a):r.dispatchEvent(a)}var eA="focusScope.autoFocusOnMount",tA="focusScope.autoFocusOnUnmount",zD={bubbles:!1,cancelable:!0},Kee="FocusScope",Zj=C.forwardRef((s,e)=>{const{loop:t=!1,trapped:n=!1,onMountAutoFocus:r,onUnmountAutoFocus:a,...o}=s,[l,c]=C.useState(null),d=bl(r),h=bl(a),f=C.useRef(null),m=Tt(e,g=>c(g)),p=C.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;C.useEffect(()=>{if(n){let g=function(w){if(p.paused||!l)return;const S=w.target;l.contains(S)?f.current=S:rd(f.current,{select:!0})},b=function(w){if(p.paused||!l)return;const S=w.relatedTarget;S!==null&&(l.contains(S)||rd(f.current,{select:!0}))},v=function(w){if(document.activeElement===document.body)for(const j of w)j.removedNodes.length>0&&rd(l)};document.addEventListener("focusin",g),document.addEventListener("focusout",b);const y=new MutationObserver(v);return l&&y.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",g),document.removeEventListener("focusout",b),y.disconnect()}}},[n,l,p.paused]),C.useEffect(()=>{if(l){VD.add(p);const g=document.activeElement;if(!l.contains(g)){const v=new CustomEvent(eA,zD);l.addEventListener(eA,d),l.dispatchEvent(v),v.defaultPrevented||(Xee(tte(f5(l)),{select:!0}),document.activeElement===g&&rd(l))}return()=>{l.removeEventListener(eA,d),setTimeout(()=>{const v=new CustomEvent(tA,zD);l.addEventListener(tA,h),l.dispatchEvent(v),v.defaultPrevented||rd(g??document.body,{select:!0}),l.removeEventListener(tA,h),VD.remove(p)},0)}}},[l,d,h,p]);const x=C.useCallback(g=>{if(!t&&!n||p.paused)return;const b=g.key==="Tab"&&!g.altKey&&!g.ctrlKey&&!g.metaKey,v=document.activeElement;if(b&&v){const y=g.currentTarget,[w,S]=Qee(y);w&&S?!g.shiftKey&&v===S?(g.preventDefault(),t&&rd(w,{select:!0})):g.shiftKey&&v===w&&(g.preventDefault(),t&&rd(S,{select:!0})):v===y&&g.preventDefault()}},[t,n,p.paused]);return i.jsx(ot.div,{tabIndex:-1,...o,ref:m,onKeyDown:x})});Zj.displayName=Kee;function Xee(s,{select:e=!1}={}){const t=document.activeElement;for(const n of s)if(rd(n,{select:e}),document.activeElement!==t)return}function Qee(s){const e=f5(s),t=HD(e,s),n=HD(e.reverse(),s);return[t,n]}function f5(s){const e=[],t=document.createTreeWalker(s,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const r=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||r?NodeFilter.FILTER_SKIP:n.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function HD(s,e){for(const t of s)if(!Zee(t,{upTo:e}))return t}function Zee(s,{upTo:e}){if(getComputedStyle(s).visibility==="hidden")return!0;for(;s;){if(e!==void 0&&s===e)return!1;if(getComputedStyle(s).display==="none")return!0;s=s.parentElement}return!1}function Jee(s){return s instanceof HTMLInputElement&&"select"in s}function rd(s,{select:e=!1}={}){if(s&&s.focus){const t=document.activeElement;s.focus({preventScroll:!0}),s!==t&&Jee(s)&&e&&s.select()}}var VD=ete();function ete(){let s=[];return{add(e){const t=s[0];e!==t&&(t==null||t.pause()),s=WD(s,e),s.unshift(e)},remove(e){var t;s=WD(s,e),(t=s[0])==null||t.resume()}}}function WD(s,e){const t=[...s],n=t.indexOf(e);return n!==-1&&t.splice(n,1),t}function tte(s){return s.filter(e=>e.tagName!=="A")}var ste="Portal",Jj=C.forwardRef((s,e)=>{var l;const{container:t,...n}=s,[r,a]=C.useState(!1);mr(()=>a(!0),[]);const o=t||r&&((l=globalThis==null?void 0:globalThis.document)==null?void 0:l.body);return o?w3.createPortal(i.jsx(ot.div,{...n,ref:e}),o):null});Jj.displayName=ste;function nte(s,e){return C.useReducer((t,n)=>e[t][n]??t,s)}var jl=s=>{const{present:e,children:t}=s,n=rte(e),r=typeof t=="function"?t({present:n.isPresent}):C.Children.only(t),a=Tt(n.ref,ite(r));return typeof t=="function"||n.isPresent?C.cloneElement(r,{ref:a}):null};jl.displayName="Presence";function rte(s){const[e,t]=C.useState(),n=C.useRef(null),r=C.useRef(s),a=C.useRef("none"),o=s?"mounted":"unmounted",[l,c]=nte(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return C.useEffect(()=>{const d=Xw(n.current);a.current=l==="mounted"?d:"none"},[l]),mr(()=>{const d=n.current,h=r.current;if(h!==s){const m=a.current,p=Xw(d);s?c("MOUNT"):p==="none"||(d==null?void 0:d.display)==="none"?c("UNMOUNT"):c(h&&m!==p?"ANIMATION_OUT":"UNMOUNT"),r.current=s}},[s,c]),mr(()=>{if(e){let d;const h=e.ownerDocument.defaultView??window,f=p=>{const g=Xw(n.current).includes(CSS.escape(p.animationName));if(p.target===e&&g&&(c("ANIMATION_END"),!r.current)){const b=e.style.animationFillMode;e.style.animationFillMode="forwards",d=h.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=b)})}},m=p=>{p.target===e&&(a.current=Xw(n.current))};return e.addEventListener("animationstart",m),e.addEventListener("animationcancel",f),e.addEventListener("animationend",f),()=>{h.clearTimeout(d),e.removeEventListener("animationstart",m),e.removeEventListener("animationcancel",f),e.removeEventListener("animationend",f)}}else c("ANIMATION_END")},[e,c]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:C.useCallback(d=>{n.current=d?getComputedStyle(d):null,t(d)},[])}}function Xw(s){return(s==null?void 0:s.animationName)||"none"}function ite(s){var n,r;let e=(n=Object.getOwnPropertyDescriptor(s.props,"ref"))==null?void 0:n.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?s.ref:(e=(r=Object.getOwnPropertyDescriptor(s,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?s.props.ref:s.props.ref||s.ref)}var sA=0;function RP(){C.useEffect(()=>{const s=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",s[0]??qD()),document.body.insertAdjacentElement("beforeend",s[1]??qD()),sA++,()=>{sA===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),sA--}},[])}function qD(){const s=document.createElement("span");return s.setAttribute("data-radix-focus-guard",""),s.tabIndex=0,s.style.outline="none",s.style.opacity="0",s.style.position="fixed",s.style.pointerEvents="none",s}var dl=function(){return dl=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},dl.apply(this,arguments)};function m5(s,e){var t={};for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&e.indexOf(n)<0&&(t[n]=s[n]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,n=Object.getOwnPropertySymbols(s);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(s,n[r])&&(t[n[r]]=s[n[r]]);return t}function ate(s,e,t){if(t||arguments.length===2)for(var n=0,r=e.length,a;n<r;n++)(a||!(n in e))&&(a||(a=Array.prototype.slice.call(e,0,n)),a[n]=e[n]);return s.concat(a||Array.prototype.slice.call(e))}var L1="right-scroll-bar-position",O1="width-before-scroll-bar",ote="with-scroll-bars-hidden",lte="--removed-body-scroll-bar-size";function nA(s,e){return typeof s=="function"?s(e):s&&(s.current=e),s}function cte(s,e){var t=C.useState(function(){return{value:s,callback:e,facade:{get current(){return t.value},set current(n){var r=t.value;r!==n&&(t.value=n,t.callback(n,r))}}}})[0];return t.callback=e,t.facade}var dte=typeof window<"u"?C.useLayoutEffect:C.useEffect,GD=new WeakMap;function ute(s,e){var t=cte(null,function(n){return s.forEach(function(r){return nA(r,n)})});return dte(function(){var n=GD.get(t);if(n){var r=new Set(n),a=new Set(s),o=t.current;r.forEach(function(l){a.has(l)||nA(l,null)}),a.forEach(function(l){r.has(l)||nA(l,o)})}GD.set(t,s)},[s]),t}function hte(s){return s}function fte(s,e){e===void 0&&(e=hte);var t=[],n=!1,r={read:function(){if(n)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return t.length?t[t.length-1]:s},useMedium:function(a){var o=e(a,n);return t.push(o),function(){t=t.filter(function(l){return l!==o})}},assignSyncMedium:function(a){for(n=!0;t.length;){var o=t;t=[],o.forEach(a)}t={push:function(l){return a(l)},filter:function(){return t}}},assignMedium:function(a){n=!0;var o=[];if(t.length){var l=t;t=[],l.forEach(a),o=t}var c=function(){var h=o;o=[],h.forEach(a)},d=function(){return Promise.resolve().then(c)};d(),t={push:function(h){o.push(h),d()},filter:function(h){return o=o.filter(h),t}}}};return r}function mte(s){s===void 0&&(s={});var e=fte(null);return e.options=dl({async:!0,ssr:!1},s),e}var p5=function(s){var e=s.sideCar,t=m5(s,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var n=e.read();if(!n)throw new Error("Sidecar medium not found");return C.createElement(n,dl({},t))};p5.isSideCarExport=!0;function pte(s,e){return s.useMedium(e),p5}var g5=mte(),rA=function(){},ek=C.forwardRef(function(s,e){var t=C.useRef(null),n=C.useState({onScrollCapture:rA,onWheelCapture:rA,onTouchMoveCapture:rA}),r=n[0],a=n[1],o=s.forwardProps,l=s.children,c=s.className,d=s.removeScrollBar,h=s.enabled,f=s.shards,m=s.sideCar,p=s.noRelative,x=s.noIsolation,g=s.inert,b=s.allowPinchZoom,v=s.as,y=v===void 0?"div":v,w=s.gapMode,S=m5(s,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),j=m,A=ute([t,e]),k=dl(dl({},S),r);return C.createElement(C.Fragment,null,h&&C.createElement(j,{sideCar:g5,removeScrollBar:d,shards:f,noRelative:p,noIsolation:x,inert:g,setCallbacks:a,allowPinchZoom:!!b,lockRef:t,gapMode:w}),o?C.cloneElement(C.Children.only(l),dl(dl({},k),{ref:A})):C.createElement(y,dl({},k,{className:c,ref:A}),l))});ek.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};ek.classNames={fullWidth:O1,zeroRight:L1};var gte=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function xte(){if(!document)return null;var s=document.createElement("style");s.type="text/css";var e=gte();return e&&s.setAttribute("nonce",e),s}function yte(s,e){s.styleSheet?s.styleSheet.cssText=e:s.appendChild(document.createTextNode(e))}function vte(s){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(s)}var bte=function(){var s=0,e=null;return{add:function(t){s==0&&(e=xte())&&(yte(e,t),vte(e)),s++},remove:function(){s--,!s&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},wte=function(){var s=bte();return function(e,t){C.useEffect(function(){return s.add(e),function(){s.remove()}},[e&&t])}},x5=function(){var s=wte(),e=function(t){var n=t.styles,r=t.dynamic;return s(n,r),null};return e},Cte={left:0,top:0,right:0,gap:0},iA=function(s){return parseInt(s||"",10)||0},Ste=function(s){var e=window.getComputedStyle(document.body),t=e[s==="padding"?"paddingLeft":"marginLeft"],n=e[s==="padding"?"paddingTop":"marginTop"],r=e[s==="padding"?"paddingRight":"marginRight"];return[iA(t),iA(n),iA(r)]},jte=function(s){if(s===void 0&&(s="margin"),typeof window>"u")return Cte;var e=Ste(s),t=document.documentElement.clientWidth,n=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,n-t+e[2]-e[0])}},kte=x5(),kp="data-scroll-locked",Nte=function(s,e,t,n){var r=s.left,a=s.top,o=s.right,l=s.gap;return t===void 0&&(t="margin"),`
  .`.concat(ote,` {
   overflow: hidden `).concat(n,`;
   padding-right: `).concat(l,"px ").concat(n,`;
  }
  body[`).concat(kp,`] {
    overflow: hidden `).concat(n,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(n,";"),t==="margin"&&`
    padding-left: `.concat(r,`px;
    padding-top: `).concat(a,`px;
    padding-right: `).concat(o,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(l,"px ").concat(n,`;
    `),t==="padding"&&"padding-right: ".concat(l,"px ").concat(n,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(L1,` {
    right: `).concat(l,"px ").concat(n,`;
  }
  
  .`).concat(O1,` {
    margin-right: `).concat(l,"px ").concat(n,`;
  }
  
  .`).concat(L1," .").concat(L1,` {
    right: 0 `).concat(n,`;
  }
  
  .`).concat(O1," .").concat(O1,` {
    margin-right: 0 `).concat(n,`;
  }
  
  body[`).concat(kp,`] {
    `).concat(lte,": ").concat(l,`px;
  }
`)},YD=function(){var s=parseInt(document.body.getAttribute(kp)||"0",10);return isFinite(s)?s:0},Ate=function(){C.useEffect(function(){return document.body.setAttribute(kp,(YD()+1).toString()),function(){var s=YD()-1;s<=0?document.body.removeAttribute(kp):document.body.setAttribute(kp,s.toString())}},[])},_te=function(s){var e=s.noRelative,t=s.noImportant,n=s.gapMode,r=n===void 0?"margin":n;Ate();var a=C.useMemo(function(){return jte(r)},[r]);return C.createElement(kte,{styles:Nte(a,!e,r,t?"":"!important")})},Z_=!1;if(typeof window<"u")try{var Qw=Object.defineProperty({},"passive",{get:function(){return Z_=!0,!0}});window.addEventListener("test",Qw,Qw),window.removeEventListener("test",Qw,Qw)}catch{Z_=!1}var Em=Z_?{passive:!1}:!1,Tte=function(s){return s.tagName==="TEXTAREA"},y5=function(s,e){if(!(s instanceof Element))return!1;var t=window.getComputedStyle(s);return t[e]!=="hidden"&&!(t.overflowY===t.overflowX&&!Tte(s)&&t[e]==="visible")},Ete=function(s){return y5(s,"overflowY")},Pte=function(s){return y5(s,"overflowX")},KD=function(s,e){var t=e.ownerDocument,n=e;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var r=v5(s,n);if(r){var a=b5(s,n),o=a[1],l=a[2];if(o>l)return!0}n=n.parentNode}while(n&&n!==t.body);return!1},Mte=function(s){var e=s.scrollTop,t=s.scrollHeight,n=s.clientHeight;return[e,t,n]},Ite=function(s){var e=s.scrollLeft,t=s.scrollWidth,n=s.clientWidth;return[e,t,n]},v5=function(s,e){return s==="v"?Ete(e):Pte(e)},b5=function(s,e){return s==="v"?Mte(e):Ite(e)},Rte=function(s,e){return s==="h"&&e==="rtl"?-1:1},Dte=function(s,e,t,n,r){var a=Rte(s,window.getComputedStyle(e).direction),o=a*n,l=t.target,c=e.contains(l),d=!1,h=o>0,f=0,m=0;do{if(!l)break;var p=b5(s,l),x=p[0],g=p[1],b=p[2],v=g-b-a*x;(x||v)&&v5(s,l)&&(f+=v,m+=x);var y=l.parentNode;l=y&&y.nodeType===Node.DOCUMENT_FRAGMENT_NODE?y.host:y}while(!c&&l!==document.body||c&&(e.contains(l)||e===l));return(h&&Math.abs(f)<1||!h&&Math.abs(m)<1)&&(d=!0),d},Zw=function(s){return"changedTouches"in s?[s.changedTouches[0].clientX,s.changedTouches[0].clientY]:[0,0]},XD=function(s){return[s.deltaX,s.deltaY]},QD=function(s){return s&&"current"in s?s.current:s},Lte=function(s,e){return s[0]===e[0]&&s[1]===e[1]},Ote=function(s){return`
  .block-interactivity-`.concat(s,` {pointer-events: none;}
  .allow-interactivity-`).concat(s,` {pointer-events: all;}
`)},Fte=0,Pm=[];function Bte(s){var e=C.useRef([]),t=C.useRef([0,0]),n=C.useRef(),r=C.useState(Fte++)[0],a=C.useState(x5)[0],o=C.useRef(s);C.useEffect(function(){o.current=s},[s]),C.useEffect(function(){if(s.inert){document.body.classList.add("block-interactivity-".concat(r));var g=ate([s.lockRef.current],(s.shards||[]).map(QD),!0).filter(Boolean);return g.forEach(function(b){return b.classList.add("allow-interactivity-".concat(r))}),function(){document.body.classList.remove("block-interactivity-".concat(r)),g.forEach(function(b){return b.classList.remove("allow-interactivity-".concat(r))})}}},[s.inert,s.lockRef.current,s.shards]);var l=C.useCallback(function(g,b){if("touches"in g&&g.touches.length===2||g.type==="wheel"&&g.ctrlKey)return!o.current.allowPinchZoom;var v=Zw(g),y=t.current,w="deltaX"in g?g.deltaX:y[0]-v[0],S="deltaY"in g?g.deltaY:y[1]-v[1],j,A=g.target,k=Math.abs(w)>Math.abs(S)?"h":"v";if("touches"in g&&k==="h"&&A.type==="range")return!1;var _=KD(k,A);if(!_)return!0;if(_?j=k:(j=k==="v"?"h":"v",_=KD(k,A)),!_)return!1;if(!n.current&&"changedTouches"in g&&(w||S)&&(n.current=j),!j)return!0;var L=n.current||j;return Dte(L,b,g,L==="h"?w:S)},[]),c=C.useCallback(function(g){var b=g;if(!(!Pm.length||Pm[Pm.length-1]!==a)){var v="deltaY"in b?XD(b):Zw(b),y=e.current.filter(function(j){return j.name===b.type&&(j.target===b.target||b.target===j.shadowParent)&&Lte(j.delta,v)})[0];if(y&&y.should){b.cancelable&&b.preventDefault();return}if(!y){var w=(o.current.shards||[]).map(QD).filter(Boolean).filter(function(j){return j.contains(b.target)}),S=w.length>0?l(b,w[0]):!o.current.noIsolation;S&&b.cancelable&&b.preventDefault()}}},[]),d=C.useCallback(function(g,b,v,y){var w={name:g,delta:b,target:v,should:y,shadowParent:$te(v)};e.current.push(w),setTimeout(function(){e.current=e.current.filter(function(S){return S!==w})},1)},[]),h=C.useCallback(function(g){t.current=Zw(g),n.current=void 0},[]),f=C.useCallback(function(g){d(g.type,XD(g),g.target,l(g,s.lockRef.current))},[]),m=C.useCallback(function(g){d(g.type,Zw(g),g.target,l(g,s.lockRef.current))},[]);C.useEffect(function(){return Pm.push(a),s.setCallbacks({onScrollCapture:f,onWheelCapture:f,onTouchMoveCapture:m}),document.addEventListener("wheel",c,Em),document.addEventListener("touchmove",c,Em),document.addEventListener("touchstart",h,Em),function(){Pm=Pm.filter(function(g){return g!==a}),document.removeEventListener("wheel",c,Em),document.removeEventListener("touchmove",c,Em),document.removeEventListener("touchstart",h,Em)}},[]);var p=s.removeScrollBar,x=s.inert;return C.createElement(C.Fragment,null,x?C.createElement(a,{styles:Ote(r)}):null,p?C.createElement(_te,{noRelative:s.noRelative,gapMode:s.gapMode}):null)}function $te(s){for(var e=null;s!==null;)s instanceof ShadowRoot&&(e=s.host,s=s.host),s=s.parentNode;return e}const Ute=pte(g5,Bte);var tk=C.forwardRef(function(s,e){return C.createElement(ek,dl({},s,{ref:e,sideCar:Ute}))});tk.classNames=ek.classNames;var zte=function(s){if(typeof document>"u")return null;var e=Array.isArray(s)?s[0]:s;return e.ownerDocument.body},Mm=new WeakMap,Jw=new WeakMap,e1={},aA=0,w5=function(s){return s&&(s.host||w5(s.parentNode))},Hte=function(s,e){return e.map(function(t){if(s.contains(t))return t;var n=w5(t);return n&&s.contains(n)?n:(console.error("aria-hidden",t,"in not contained inside",s,". Doing nothing"),null)}).filter(function(t){return!!t})},Vte=function(s,e,t,n){var r=Hte(e,Array.isArray(s)?s:[s]);e1[t]||(e1[t]=new WeakMap);var a=e1[t],o=[],l=new Set,c=new Set(r),d=function(f){!f||l.has(f)||(l.add(f),d(f.parentNode))};r.forEach(d);var h=function(f){!f||c.has(f)||Array.prototype.forEach.call(f.children,function(m){if(l.has(m))h(m);else try{var p=m.getAttribute(n),x=p!==null&&p!=="false",g=(Mm.get(m)||0)+1,b=(a.get(m)||0)+1;Mm.set(m,g),a.set(m,b),o.push(m),g===1&&x&&Jw.set(m,!0),b===1&&m.setAttribute(t,"true"),x||m.setAttribute(n,"true")}catch(v){console.error("aria-hidden: cannot operate on ",m,v)}})};return h(e),l.clear(),aA++,function(){o.forEach(function(f){var m=Mm.get(f)-1,p=a.get(f)-1;Mm.set(f,m),a.set(f,p),m||(Jw.has(f)||f.removeAttribute(n),Jw.delete(f)),p||f.removeAttribute(t)}),aA--,aA||(Mm=new WeakMap,Mm=new WeakMap,Jw=new WeakMap,e1={})}},DP=function(s,e,t){t===void 0&&(t="data-aria-hidden");var n=Array.from(Array.isArray(s)?s:[s]),r=zte(s);return r?(n.push.apply(n,Array.from(r.querySelectorAll("[aria-live], script"))),Vte(n,r,t,"aria-hidden")):function(){return null}};function Wte(s){const e=qte(s),t=C.forwardRef((n,r)=>{const{children:a,...o}=n,l=C.Children.toArray(a),c=l.find(Yte);if(c){const d=c.props.children,h=l.map(f=>f===c?C.Children.count(d)>1?C.Children.only(null):C.isValidElement(d)?d.props.children:null:f);return i.jsx(e,{...o,ref:r,children:C.isValidElement(d)?C.cloneElement(d,void 0,h):null})}return i.jsx(e,{...o,ref:r,children:a})});return t.displayName=`${s}.Slot`,t}function qte(s){const e=C.forwardRef((t,n)=>{const{children:r,...a}=t;if(C.isValidElement(r)){const o=Xte(r),l=Kte(a,r.props);return r.type!==C.Fragment&&(l.ref=n?qc(n,o):o),C.cloneElement(r,l)}return C.Children.count(r)>1?C.Children.only(null):null});return e.displayName=`${s}.SlotClone`,e}var Gte=Symbol("radix.slottable");function Yte(s){return C.isValidElement(s)&&typeof s.type=="function"&&"__radixId"in s.type&&s.type.__radixId===Gte}function Kte(s,e){const t={...e};for(const n in e){const r=s[n],a=e[n];/^on[A-Z]/.test(n)?r&&a?t[n]=(...l)=>{const c=a(...l);return r(...l),c}:r&&(t[n]=r):n==="style"?t[n]={...r,...a}:n==="className"&&(t[n]=[r,a].filter(Boolean).join(" "))}return{...s,...t}}function Xte(s){var n,r;let e=(n=Object.getOwnPropertyDescriptor(s.props,"ref"))==null?void 0:n.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?s.ref:(e=(r=Object.getOwnPropertyDescriptor(s,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?s.props.ref:s.props.ref||s.ref)}var sk="Dialog",[C5,S5]=Oa(sk),[Qte,_o]=C5(sk),j5=s=>{const{__scopeDialog:e,children:t,open:n,defaultOpen:r,onOpenChange:a,modal:o=!0}=s,l=C.useRef(null),c=C.useRef(null),[d,h]=Lc({prop:n,defaultProp:r??!1,onChange:a,caller:sk});return i.jsx(Qte,{scope:e,triggerRef:l,contentRef:c,contentId:gl(),titleId:gl(),descriptionId:gl(),open:d,onOpenChange:h,onOpenToggle:C.useCallback(()=>h(f=>!f),[h]),modal:o,children:t})};j5.displayName=sk;var k5="DialogTrigger",N5=C.forwardRef((s,e)=>{const{__scopeDialog:t,...n}=s,r=_o(k5,t),a=Tt(e,r.triggerRef);return i.jsx(ot.button,{type:"button","aria-haspopup":"dialog","aria-expanded":r.open,"aria-controls":r.contentId,"data-state":FP(r.open),...n,ref:a,onClick:He(s.onClick,r.onOpenToggle)})});N5.displayName=k5;var LP="DialogPortal",[Zte,A5]=C5(LP,{forceMount:void 0}),_5=s=>{const{__scopeDialog:e,forceMount:t,children:n,container:r}=s,a=_o(LP,e);return i.jsx(Zte,{scope:e,forceMount:t,children:C.Children.map(n,o=>i.jsx(jl,{present:t||a.open,children:i.jsx(Jj,{asChild:!0,container:r,children:o})}))})};_5.displayName=LP;var dS="DialogOverlay",T5=C.forwardRef((s,e)=>{const t=A5(dS,s.__scopeDialog),{forceMount:n=t.forceMount,...r}=s,a=_o(dS,s.__scopeDialog);return a.modal?i.jsx(jl,{present:n||a.open,children:i.jsx(ese,{...r,ref:e})}):null});T5.displayName=dS;var Jte=Wte("DialogOverlay.RemoveScroll"),ese=C.forwardRef((s,e)=>{const{__scopeDialog:t,...n}=s,r=_o(dS,t);return i.jsx(tk,{as:Jte,allowPinchZoom:!0,shards:[r.contentRef],children:i.jsx(ot.div,{"data-state":FP(r.open),...n,ref:e,style:{pointerEvents:"auto",...n.style}})})}),om="DialogContent",E5=C.forwardRef((s,e)=>{const t=A5(om,s.__scopeDialog),{forceMount:n=t.forceMount,...r}=s,a=_o(om,s.__scopeDialog);return i.jsx(jl,{present:n||a.open,children:a.modal?i.jsx(tse,{...r,ref:e}):i.jsx(sse,{...r,ref:e})})});E5.displayName=om;var tse=C.forwardRef((s,e)=>{const t=_o(om,s.__scopeDialog),n=C.useRef(null),r=Tt(e,t.contentRef,n);return C.useEffect(()=>{const a=n.current;if(a)return DP(a)},[]),i.jsx(P5,{...s,ref:r,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:He(s.onCloseAutoFocus,a=>{var o;a.preventDefault(),(o=t.triggerRef.current)==null||o.focus()}),onPointerDownOutside:He(s.onPointerDownOutside,a=>{const o=a.detail.originalEvent,l=o.button===0&&o.ctrlKey===!0;(o.button===2||l)&&a.preventDefault()}),onFocusOutside:He(s.onFocusOutside,a=>a.preventDefault())})}),sse=C.forwardRef((s,e)=>{const t=_o(om,s.__scopeDialog),n=C.useRef(!1),r=C.useRef(!1);return i.jsx(P5,{...s,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:a=>{var o,l;(o=s.onCloseAutoFocus)==null||o.call(s,a),a.defaultPrevented||(n.current||(l=t.triggerRef.current)==null||l.focus(),a.preventDefault()),n.current=!1,r.current=!1},onInteractOutside:a=>{var c,d;(c=s.onInteractOutside)==null||c.call(s,a),a.defaultPrevented||(n.current=!0,a.detail.originalEvent.type==="pointerdown"&&(r.current=!0));const o=a.target;((d=t.triggerRef.current)==null?void 0:d.contains(o))&&a.preventDefault(),a.detail.originalEvent.type==="focusin"&&r.current&&a.preventDefault()}})}),P5=C.forwardRef((s,e)=>{const{__scopeDialog:t,trapFocus:n,onOpenAutoFocus:r,onCloseAutoFocus:a,...o}=s,l=_o(om,t),c=C.useRef(null),d=Tt(e,c);return RP(),i.jsxs(i.Fragment,{children:[i.jsx(Zj,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:r,onUnmountAutoFocus:a,children:i.jsx(Qj,{role:"dialog",id:l.contentId,"aria-describedby":l.descriptionId,"aria-labelledby":l.titleId,"data-state":FP(l.open),...o,ref:d,onDismiss:()=>l.onOpenChange(!1)})}),i.jsxs(i.Fragment,{children:[i.jsx(rse,{titleId:l.titleId}),i.jsx(ase,{contentRef:c,descriptionId:l.descriptionId})]})]})}),OP="DialogTitle",M5=C.forwardRef((s,e)=>{const{__scopeDialog:t,...n}=s,r=_o(OP,t);return i.jsx(ot.h2,{id:r.titleId,...n,ref:e})});M5.displayName=OP;var I5="DialogDescription",R5=C.forwardRef((s,e)=>{const{__scopeDialog:t,...n}=s,r=_o(I5,t);return i.jsx(ot.p,{id:r.descriptionId,...n,ref:e})});R5.displayName=I5;var D5="DialogClose",L5=C.forwardRef((s,e)=>{const{__scopeDialog:t,...n}=s,r=_o(D5,t);return i.jsx(ot.button,{type:"button",...n,ref:e,onClick:He(s.onClick,()=>r.onOpenChange(!1))})});L5.displayName=D5;function FP(s){return s?"open":"closed"}var O5="DialogTitleWarning",[nse,F5]=Aee(O5,{contentName:om,titleName:OP,docsSlug:"dialog"}),rse=({titleId:s})=>{const e=F5(O5),t=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return C.useEffect(()=>{s&&(document.getElementById(s)||console.error(t))},[t,s]),null},ise="DialogDescriptionWarning",ase=({contentRef:s,descriptionId:e})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${F5(ise).contentName}}.`;return C.useEffect(()=>{var a;const r=(a=s.current)==null?void 0:a.getAttribute("aria-describedby");e&&r&&(document.getElementById(e)||console.warn(n))},[n,s,e]),null},B5=j5,$5=N5,U5=_5,BP=T5,$P=E5,UP=M5,zP=R5,HP=L5,ose=Symbol("radix.slottable");function lse(s){const e=({children:t})=>i.jsx(i.Fragment,{children:t});return e.displayName=`${s}.Slottable`,e.__radixId=ose,e}var z5="AlertDialog",[cse]=Oa(z5,[S5]),Gc=S5(),H5=s=>{const{__scopeAlertDialog:e,...t}=s,n=Gc(e);return i.jsx(B5,{...n,...t,modal:!0})};H5.displayName=z5;var dse="AlertDialogTrigger",V5=C.forwardRef((s,e)=>{const{__scopeAlertDialog:t,...n}=s,r=Gc(t);return i.jsx($5,{...r,...n,ref:e})});V5.displayName=dse;var use="AlertDialogPortal",W5=s=>{const{__scopeAlertDialog:e,...t}=s,n=Gc(e);return i.jsx(U5,{...n,...t})};W5.displayName=use;var hse="AlertDialogOverlay",q5=C.forwardRef((s,e)=>{const{__scopeAlertDialog:t,...n}=s,r=Gc(t);return i.jsx(BP,{...r,...n,ref:e})});q5.displayName=hse;var Np="AlertDialogContent",[fse,mse]=cse(Np),pse=lse("AlertDialogContent"),G5=C.forwardRef((s,e)=>{const{__scopeAlertDialog:t,children:n,...r}=s,a=Gc(t),o=C.useRef(null),l=Tt(e,o),c=C.useRef(null);return i.jsx(nse,{contentName:Np,titleName:Y5,docsSlug:"alert-dialog",children:i.jsx(fse,{scope:t,cancelRef:c,children:i.jsxs($P,{role:"alertdialog",...a,...r,ref:l,onOpenAutoFocus:He(r.onOpenAutoFocus,d=>{var h;d.preventDefault(),(h=c.current)==null||h.focus({preventScroll:!0})}),onPointerDownOutside:d=>d.preventDefault(),onInteractOutside:d=>d.preventDefault(),children:[i.jsx(pse,{children:n}),i.jsx(xse,{contentRef:o})]})})})});G5.displayName=Np;var Y5="AlertDialogTitle",K5=C.forwardRef((s,e)=>{const{__scopeAlertDialog:t,...n}=s,r=Gc(t);return i.jsx(UP,{...r,...n,ref:e})});K5.displayName=Y5;var X5="AlertDialogDescription",Q5=C.forwardRef((s,e)=>{const{__scopeAlertDialog:t,...n}=s,r=Gc(t);return i.jsx(zP,{...r,...n,ref:e})});Q5.displayName=X5;var gse="AlertDialogAction",Z5=C.forwardRef((s,e)=>{const{__scopeAlertDialog:t,...n}=s,r=Gc(t);return i.jsx(HP,{...r,...n,ref:e})});Z5.displayName=gse;var J5="AlertDialogCancel",e$=C.forwardRef((s,e)=>{const{__scopeAlertDialog:t,...n}=s,{cancelRef:r}=mse(J5,t),a=Gc(t),o=Tt(e,r);return i.jsx(HP,{...a,...n,ref:o})});e$.displayName=J5;var xse=({contentRef:s})=>{const e=`\`${Np}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${Np}\` by passing a \`${X5}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${Np}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return C.useEffect(()=>{var n;document.getElementById((n=s.current)==null?void 0:n.getAttribute("aria-describedby"))||console.warn(e)},[e,s]),null},yse=H5,vse=V5,bse=W5,t$=q5,s$=G5,n$=Z5,r$=e$,i$=K5,a$=Q5;function o$(s){var e,t,n="";if(typeof s=="string"||typeof s=="number")n+=s;else if(typeof s=="object")if(Array.isArray(s)){var r=s.length;for(e=0;e<r;e++)s[e]&&(t=o$(s[e]))&&(n&&(n+=" "),n+=t)}else for(t in s)s[t]&&(n&&(n+=" "),n+=t);return n}function l$(){for(var s,e,t=0,n="",r=arguments.length;t<r;t++)(s=arguments[t])&&(e=o$(s))&&(n&&(n+=" "),n+=e);return n}const VP="-",wse=s=>{const e=Sse(s),{conflictingClassGroups:t,conflictingClassGroupModifiers:n}=s;return{getClassGroupId:o=>{const l=o.split(VP);return l[0]===""&&l.length!==1&&l.shift(),c$(l,e)||Cse(o)},getConflictingClassGroupIds:(o,l)=>{const c=t[o]||[];return l&&n[o]?[...c,...n[o]]:c}}},c$=(s,e)=>{var o;if(s.length===0)return e.classGroupId;const t=s[0],n=e.nextPart.get(t),r=n?c$(s.slice(1),n):void 0;if(r)return r;if(e.validators.length===0)return;const a=s.join(VP);return(o=e.validators.find(({validator:l})=>l(a)))==null?void 0:o.classGroupId},ZD=/^\[(.+)\]$/,Cse=s=>{if(ZD.test(s)){const e=ZD.exec(s)[1],t=e==null?void 0:e.substring(0,e.indexOf(":"));if(t)return"arbitrary.."+t}},Sse=s=>{const{theme:e,prefix:t}=s,n={nextPart:new Map,validators:[]};return kse(Object.entries(s.classGroups),t).forEach(([a,o])=>{J_(o,n,a,e)}),n},J_=(s,e,t,n)=>{s.forEach(r=>{if(typeof r=="string"){const a=r===""?e:JD(e,r);a.classGroupId=t;return}if(typeof r=="function"){if(jse(r)){J_(r(n),e,t,n);return}e.validators.push({validator:r,classGroupId:t});return}Object.entries(r).forEach(([a,o])=>{J_(o,JD(e,a),t,n)})})},JD=(s,e)=>{let t=s;return e.split(VP).forEach(n=>{t.nextPart.has(n)||t.nextPart.set(n,{nextPart:new Map,validators:[]}),t=t.nextPart.get(n)}),t},jse=s=>s.isThemeGetter,kse=(s,e)=>e?s.map(([t,n])=>{const r=n.map(a=>typeof a=="string"?e+a:typeof a=="object"?Object.fromEntries(Object.entries(a).map(([o,l])=>[e+o,l])):a);return[t,r]}):s,Nse=s=>{if(s<1)return{get:()=>{},set:()=>{}};let e=0,t=new Map,n=new Map;const r=(a,o)=>{t.set(a,o),e++,e>s&&(e=0,n=t,t=new Map)};return{get(a){let o=t.get(a);if(o!==void 0)return o;if((o=n.get(a))!==void 0)return r(a,o),o},set(a,o){t.has(a)?t.set(a,o):r(a,o)}}},d$="!",Ase=s=>{const{separator:e,experimentalParseClassName:t}=s,n=e.length===1,r=e[0],a=e.length,o=l=>{const c=[];let d=0,h=0,f;for(let b=0;b<l.length;b++){let v=l[b];if(d===0){if(v===r&&(n||l.slice(b,b+a)===e)){c.push(l.slice(h,b)),h=b+a;continue}if(v==="/"){f=b;continue}}v==="["?d++:v==="]"&&d--}const m=c.length===0?l:l.substring(h),p=m.startsWith(d$),x=p?m.substring(1):m,g=f&&f>h?f-h:void 0;return{modifiers:c,hasImportantModifier:p,baseClassName:x,maybePostfixModifierPosition:g}};return t?l=>t({className:l,parseClassName:o}):o},_se=s=>{if(s.length<=1)return s;const e=[];let t=[];return s.forEach(n=>{n[0]==="["?(e.push(...t.sort(),n),t=[]):t.push(n)}),e.push(...t.sort()),e},Tse=s=>({cache:Nse(s.cacheSize),parseClassName:Ase(s),...wse(s)}),Ese=/\s+/,Pse=(s,e)=>{const{parseClassName:t,getClassGroupId:n,getConflictingClassGroupIds:r}=e,a=[],o=s.trim().split(Ese);let l="";for(let c=o.length-1;c>=0;c-=1){const d=o[c],{modifiers:h,hasImportantModifier:f,baseClassName:m,maybePostfixModifierPosition:p}=t(d);let x=!!p,g=n(x?m.substring(0,p):m);if(!g){if(!x){l=d+(l.length>0?" "+l:l);continue}if(g=n(m),!g){l=d+(l.length>0?" "+l:l);continue}x=!1}const b=_se(h).join(":"),v=f?b+d$:b,y=v+g;if(a.includes(y))continue;a.push(y);const w=r(g,x);for(let S=0;S<w.length;++S){const j=w[S];a.push(v+j)}l=d+(l.length>0?" "+l:l)}return l};function Mse(){let s=0,e,t,n="";for(;s<arguments.length;)(e=arguments[s++])&&(t=u$(e))&&(n&&(n+=" "),n+=t);return n}const u$=s=>{if(typeof s=="string")return s;let e,t="";for(let n=0;n<s.length;n++)s[n]&&(e=u$(s[n]))&&(t&&(t+=" "),t+=e);return t};function Ise(s,...e){let t,n,r,a=o;function o(c){const d=e.reduce((h,f)=>f(h),s());return t=Tse(d),n=t.cache.get,r=t.cache.set,a=l,l(c)}function l(c){const d=n(c);if(d)return d;const h=Pse(c,t);return r(c,h),h}return function(){return a(Mse.apply(null,arguments))}}const ys=s=>{const e=t=>t[s]||[];return e.isThemeGetter=!0,e},h$=/^\[(?:([a-z-]+):)?(.+)\]$/i,Rse=/^\d+\/\d+$/,Dse=new Set(["px","full","screen"]),Lse=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Ose=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Fse=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Bse=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,$se=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,El=s=>Ap(s)||Dse.has(s)||Rse.test(s),Qc=s=>Fx(s,"length",Yse),Ap=s=>!!s&&!Number.isNaN(Number(s)),oA=s=>Fx(s,"number",Ap),ey=s=>!!s&&Number.isInteger(Number(s)),Use=s=>s.endsWith("%")&&Ap(s.slice(0,-1)),jt=s=>h$.test(s),Zc=s=>Lse.test(s),zse=new Set(["length","size","percentage"]),Hse=s=>Fx(s,zse,f$),Vse=s=>Fx(s,"position",f$),Wse=new Set(["image","url"]),qse=s=>Fx(s,Wse,Xse),Gse=s=>Fx(s,"",Kse),ty=()=>!0,Fx=(s,e,t)=>{const n=h$.exec(s);return n?n[1]?typeof e=="string"?n[1]===e:e.has(n[1]):t(n[2]):!1},Yse=s=>Ose.test(s)&&!Fse.test(s),f$=()=>!1,Kse=s=>Bse.test(s),Xse=s=>$se.test(s),Qse=()=>{const s=ys("colors"),e=ys("spacing"),t=ys("blur"),n=ys("brightness"),r=ys("borderColor"),a=ys("borderRadius"),o=ys("borderSpacing"),l=ys("borderWidth"),c=ys("contrast"),d=ys("grayscale"),h=ys("hueRotate"),f=ys("invert"),m=ys("gap"),p=ys("gradientColorStops"),x=ys("gradientColorStopPositions"),g=ys("inset"),b=ys("margin"),v=ys("opacity"),y=ys("padding"),w=ys("saturate"),S=ys("scale"),j=ys("sepia"),A=ys("skew"),k=ys("space"),_=ys("translate"),L=()=>["auto","contain","none"],D=()=>["auto","hidden","clip","visible","scroll"],P=()=>["auto",jt,e],T=()=>[jt,e],B=()=>["",El,Qc],R=()=>["auto",Ap,jt],O=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],I=()=>["solid","dashed","dotted","double","none"],U=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],M=()=>["start","end","center","between","around","evenly","stretch"],$=()=>["","0",jt],W=()=>["auto","avoid","all","avoid-page","page","left","right","column"],ee=()=>[Ap,jt];return{cacheSize:500,separator:":",theme:{colors:[ty],spacing:[El,Qc],blur:["none","",Zc,jt],brightness:ee(),borderColor:[s],borderRadius:["none","","full",Zc,jt],borderSpacing:T(),borderWidth:B(),contrast:ee(),grayscale:$(),hueRotate:ee(),invert:$(),gap:T(),gradientColorStops:[s],gradientColorStopPositions:[Use,Qc],inset:P(),margin:P(),opacity:ee(),padding:T(),saturate:ee(),scale:ee(),sepia:$(),skew:ee(),space:T(),translate:T()},classGroups:{aspect:[{aspect:["auto","square","video",jt]}],container:["container"],columns:[{columns:[Zc]}],"break-after":[{"break-after":W()}],"break-before":[{"break-before":W()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...O(),jt]}],overflow:[{overflow:D()}],"overflow-x":[{"overflow-x":D()}],"overflow-y":[{"overflow-y":D()}],overscroll:[{overscroll:L()}],"overscroll-x":[{"overscroll-x":L()}],"overscroll-y":[{"overscroll-y":L()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[g]}],"inset-x":[{"inset-x":[g]}],"inset-y":[{"inset-y":[g]}],start:[{start:[g]}],end:[{end:[g]}],top:[{top:[g]}],right:[{right:[g]}],bottom:[{bottom:[g]}],left:[{left:[g]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",ey,jt]}],basis:[{basis:P()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",jt]}],grow:[{grow:$()}],shrink:[{shrink:$()}],order:[{order:["first","last","none",ey,jt]}],"grid-cols":[{"grid-cols":[ty]}],"col-start-end":[{col:["auto",{span:["full",ey,jt]},jt]}],"col-start":[{"col-start":R()}],"col-end":[{"col-end":R()}],"grid-rows":[{"grid-rows":[ty]}],"row-start-end":[{row:["auto",{span:[ey,jt]},jt]}],"row-start":[{"row-start":R()}],"row-end":[{"row-end":R()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",jt]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",jt]}],gap:[{gap:[m]}],"gap-x":[{"gap-x":[m]}],"gap-y":[{"gap-y":[m]}],"justify-content":[{justify:["normal",...M()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...M(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...M(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[y]}],px:[{px:[y]}],py:[{py:[y]}],ps:[{ps:[y]}],pe:[{pe:[y]}],pt:[{pt:[y]}],pr:[{pr:[y]}],pb:[{pb:[y]}],pl:[{pl:[y]}],m:[{m:[b]}],mx:[{mx:[b]}],my:[{my:[b]}],ms:[{ms:[b]}],me:[{me:[b]}],mt:[{mt:[b]}],mr:[{mr:[b]}],mb:[{mb:[b]}],ml:[{ml:[b]}],"space-x":[{"space-x":[k]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[k]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",jt,e]}],"min-w":[{"min-w":[jt,e,"min","max","fit"]}],"max-w":[{"max-w":[jt,e,"none","full","min","max","fit","prose",{screen:[Zc]},Zc]}],h:[{h:[jt,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[jt,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[jt,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[jt,e,"auto","min","max","fit"]}],"font-size":[{text:["base",Zc,Qc]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",oA]}],"font-family":[{font:[ty]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",jt]}],"line-clamp":[{"line-clamp":["none",Ap,oA]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",El,jt]}],"list-image":[{"list-image":["none",jt]}],"list-style-type":[{list:["none","disc","decimal",jt]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[s]}],"placeholder-opacity":[{"placeholder-opacity":[v]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[s]}],"text-opacity":[{"text-opacity":[v]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...I(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",El,Qc]}],"underline-offset":[{"underline-offset":["auto",El,jt]}],"text-decoration-color":[{decoration:[s]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:T()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",jt]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",jt]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[v]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...O(),Vse]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Hse]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},qse]}],"bg-color":[{bg:[s]}],"gradient-from-pos":[{from:[x]}],"gradient-via-pos":[{via:[x]}],"gradient-to-pos":[{to:[x]}],"gradient-from":[{from:[p]}],"gradient-via":[{via:[p]}],"gradient-to":[{to:[p]}],rounded:[{rounded:[a]}],"rounded-s":[{"rounded-s":[a]}],"rounded-e":[{"rounded-e":[a]}],"rounded-t":[{"rounded-t":[a]}],"rounded-r":[{"rounded-r":[a]}],"rounded-b":[{"rounded-b":[a]}],"rounded-l":[{"rounded-l":[a]}],"rounded-ss":[{"rounded-ss":[a]}],"rounded-se":[{"rounded-se":[a]}],"rounded-ee":[{"rounded-ee":[a]}],"rounded-es":[{"rounded-es":[a]}],"rounded-tl":[{"rounded-tl":[a]}],"rounded-tr":[{"rounded-tr":[a]}],"rounded-br":[{"rounded-br":[a]}],"rounded-bl":[{"rounded-bl":[a]}],"border-w":[{border:[l]}],"border-w-x":[{"border-x":[l]}],"border-w-y":[{"border-y":[l]}],"border-w-s":[{"border-s":[l]}],"border-w-e":[{"border-e":[l]}],"border-w-t":[{"border-t":[l]}],"border-w-r":[{"border-r":[l]}],"border-w-b":[{"border-b":[l]}],"border-w-l":[{"border-l":[l]}],"border-opacity":[{"border-opacity":[v]}],"border-style":[{border:[...I(),"hidden"]}],"divide-x":[{"divide-x":[l]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[l]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[v]}],"divide-style":[{divide:I()}],"border-color":[{border:[r]}],"border-color-x":[{"border-x":[r]}],"border-color-y":[{"border-y":[r]}],"border-color-s":[{"border-s":[r]}],"border-color-e":[{"border-e":[r]}],"border-color-t":[{"border-t":[r]}],"border-color-r":[{"border-r":[r]}],"border-color-b":[{"border-b":[r]}],"border-color-l":[{"border-l":[r]}],"divide-color":[{divide:[r]}],"outline-style":[{outline:["",...I()]}],"outline-offset":[{"outline-offset":[El,jt]}],"outline-w":[{outline:[El,Qc]}],"outline-color":[{outline:[s]}],"ring-w":[{ring:B()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[s]}],"ring-opacity":[{"ring-opacity":[v]}],"ring-offset-w":[{"ring-offset":[El,Qc]}],"ring-offset-color":[{"ring-offset":[s]}],shadow:[{shadow:["","inner","none",Zc,Gse]}],"shadow-color":[{shadow:[ty]}],opacity:[{opacity:[v]}],"mix-blend":[{"mix-blend":[...U(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":U()}],filter:[{filter:["","none"]}],blur:[{blur:[t]}],brightness:[{brightness:[n]}],contrast:[{contrast:[c]}],"drop-shadow":[{"drop-shadow":["","none",Zc,jt]}],grayscale:[{grayscale:[d]}],"hue-rotate":[{"hue-rotate":[h]}],invert:[{invert:[f]}],saturate:[{saturate:[w]}],sepia:[{sepia:[j]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[t]}],"backdrop-brightness":[{"backdrop-brightness":[n]}],"backdrop-contrast":[{"backdrop-contrast":[c]}],"backdrop-grayscale":[{"backdrop-grayscale":[d]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[h]}],"backdrop-invert":[{"backdrop-invert":[f]}],"backdrop-opacity":[{"backdrop-opacity":[v]}],"backdrop-saturate":[{"backdrop-saturate":[w]}],"backdrop-sepia":[{"backdrop-sepia":[j]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[o]}],"border-spacing-x":[{"border-spacing-x":[o]}],"border-spacing-y":[{"border-spacing-y":[o]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",jt]}],duration:[{duration:ee()}],ease:[{ease:["linear","in","out","in-out",jt]}],delay:[{delay:ee()}],animate:[{animate:["none","spin","ping","pulse","bounce",jt]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[S]}],"scale-x":[{"scale-x":[S]}],"scale-y":[{"scale-y":[S]}],rotate:[{rotate:[ey,jt]}],"translate-x":[{"translate-x":[_]}],"translate-y":[{"translate-y":[_]}],"skew-x":[{"skew-x":[A]}],"skew-y":[{"skew-y":[A]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",jt]}],accent:[{accent:["auto",s]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",jt]}],"caret-color":[{caret:[s]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":T()}],"scroll-mx":[{"scroll-mx":T()}],"scroll-my":[{"scroll-my":T()}],"scroll-ms":[{"scroll-ms":T()}],"scroll-me":[{"scroll-me":T()}],"scroll-mt":[{"scroll-mt":T()}],"scroll-mr":[{"scroll-mr":T()}],"scroll-mb":[{"scroll-mb":T()}],"scroll-ml":[{"scroll-ml":T()}],"scroll-p":[{"scroll-p":T()}],"scroll-px":[{"scroll-px":T()}],"scroll-py":[{"scroll-py":T()}],"scroll-ps":[{"scroll-ps":T()}],"scroll-pe":[{"scroll-pe":T()}],"scroll-pt":[{"scroll-pt":T()}],"scroll-pr":[{"scroll-pr":T()}],"scroll-pb":[{"scroll-pb":T()}],"scroll-pl":[{"scroll-pl":T()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",jt]}],fill:[{fill:[s,"none"]}],"stroke-w":[{stroke:[El,Qc,oA]}],stroke:[{stroke:[s,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Zse=Ise(Qse);function Ee(...s){return Zse(l$(s))}function lr(s){return s>=0?`+${s}`:`${s}`}var Jse=Symbol.for("react.lazy"),uS=bE[" use ".trim().toString()];function ene(s){return typeof s=="object"&&s!==null&&"then"in s}function m$(s){return s!=null&&typeof s=="object"&&"$$typeof"in s&&s.$$typeof===Jse&&"_payload"in s&&ene(s._payload)}function WP(s){const e=tne(s),t=C.forwardRef((n,r)=>{let{children:a,...o}=n;m$(a)&&typeof uS=="function"&&(a=uS(a._payload));const l=C.Children.toArray(a),c=l.find(nne);if(c){const d=c.props.children,h=l.map(f=>f===c?C.Children.count(d)>1?C.Children.only(null):C.isValidElement(d)?d.props.children:null:f);return i.jsx(e,{...o,ref:r,children:C.isValidElement(d)?C.cloneElement(d,void 0,h):null})}return i.jsx(e,{...o,ref:r,children:a})});return t.displayName=`${s}.Slot`,t}var p$=WP("Slot");function tne(s){const e=C.forwardRef((t,n)=>{let{children:r,...a}=t;if(m$(r)&&typeof uS=="function"&&(r=uS(r._payload)),C.isValidElement(r)){const o=ine(r),l=rne(a,r.props);return r.type!==C.Fragment&&(l.ref=n?qc(n,o):o),C.cloneElement(r,l)}return C.Children.count(r)>1?C.Children.only(null):null});return e.displayName=`${s}.SlotClone`,e}var sne=Symbol("radix.slottable");function nne(s){return C.isValidElement(s)&&typeof s.type=="function"&&"__radixId"in s.type&&s.type.__radixId===sne}function rne(s,e){const t={...e};for(const n in e){const r=s[n],a=e[n];/^on[A-Z]/.test(n)?r&&a?t[n]=(...l)=>{const c=a(...l);return r(...l),c}:r&&(t[n]=r):n==="style"?t[n]={...r,...a}:n==="className"&&(t[n]=[r,a].filter(Boolean).join(" "))}return{...s,...t}}function ine(s){var n,r;let e=(n=Object.getOwnPropertyDescriptor(s.props,"ref"))==null?void 0:n.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?s.ref:(e=(r=Object.getOwnPropertyDescriptor(s,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?s.props.ref:s.props.ref||s.ref)}const eL=s=>typeof s=="boolean"?`${s}`:s===0?"0":s,tL=l$,nk=(s,e)=>t=>{var n;if((e==null?void 0:e.variants)==null)return tL(s,t==null?void 0:t.class,t==null?void 0:t.className);const{variants:r,defaultVariants:a}=e,o=Object.keys(r).map(d=>{const h=t==null?void 0:t[d],f=a==null?void 0:a[d];if(h===null)return null;const m=eL(h)||eL(f);return r[d][m]}),l=t&&Object.entries(t).reduce((d,h)=>{let[f,m]=h;return m===void 0||(d[f]=m),d},{}),c=e==null||(n=e.compoundVariants)===null||n===void 0?void 0:n.reduce((d,h)=>{let{class:f,className:m,...p}=h;return Object.entries(p).every(x=>{let[g,b]=x;return Array.isArray(b)?b.includes({...a,...l}[g]):{...a,...l}[g]===b})?[...d,f,m]:d},[]);return tL(s,o,c,t==null?void 0:t.class,t==null?void 0:t.className)},qP=nk("inline-flex items-center justify-center whitespace-nowrap rounded-lg text-sm font-semibold ring-offset-background transition-all duration-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 hover:shadow-glow",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background/50 backdrop-blur-sm hover:bg-royal-plum-100 dark:hover:bg-royal-plum-900/50 hover:text-royal-plum-700 dark:hover:text-royal-plum-200 hover:border-royal-plum-300 dark:hover:border-royal-plum-600 hover:shadow-modern",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 hover:shadow-modern",ghost:"hover:bg-royal-plum-100 dark:hover:bg-royal-plum-900/50 hover:text-royal-plum-700 dark:hover:text-royal-plum-200 hover:shadow-modern",link:"text-primary underline-offset-4 hover:underline",gradient:"gradient-primary text-white hover:shadow-glow hover:scale-105",glass:"glass text-foreground hover:bg-royal-plum-100/50 dark:hover:bg-royal-plum-900/30 hover:shadow-modern-lg",glow:"bg-primary text-primary-foreground hover:shadow-glow hover:scale-105 animate-pulse-glow"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-lg px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),q=C.forwardRef(({className:s,variant:e,size:t,asChild:n=!1,...r},a)=>{const o=n?p$:"button";return i.jsx(o,{className:Ee(qP({variant:e,size:t,className:s})),ref:a,...r})});q.displayName="Button";const g$=yse,ane=vse,one=bse,x$=C.forwardRef(({className:s,...e},t)=>i.jsx(t$,{className:Ee("fixed inset-0 z-50 bg-background/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...e,ref:t}));x$.displayName=t$.displayName;const GP=C.forwardRef(({className:s,...e},t)=>i.jsxs(one,{children:[i.jsx(x$,{}),i.jsx(s$,{ref:t,className:Ee("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...e})]}));GP.displayName=s$.displayName;const YP=({className:s,...e})=>i.jsx("div",{className:Ee("flex flex-col space-y-2 text-center sm:text-left",s),...e});YP.displayName="AlertDialogHeader";const KP=({className:s,...e})=>i.jsx("div",{className:Ee("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...e});KP.displayName="AlertDialogFooter";const XP=C.forwardRef(({className:s,...e},t)=>i.jsx(i$,{ref:t,className:Ee("text-lg font-semibold",s),...e}));XP.displayName=i$.displayName;const QP=C.forwardRef(({className:s,...e},t)=>i.jsx(a$,{ref:t,className:Ee("text-sm text-muted-foreground",s),...e}));QP.displayName=a$.displayName;const ZP=C.forwardRef(({className:s,...e},t)=>i.jsx(n$,{ref:t,className:Ee(qP(),s),...e}));ZP.displayName=n$.displayName;const JP=C.forwardRef(({className:s,...e},t)=>i.jsx(r$,{ref:t,className:Ee(qP({variant:"outline"}),"mt-2 sm:mt-0",s),...e}));JP.displayName=r$.displayName;const rk=C.forwardRef(({className:s,value:e=0,...t},n)=>i.jsx("div",{ref:n,className:Ee("relative h-4 w-full overflow-hidden rounded-full bg-secondary",s),...t,children:i.jsx("div",{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-Math.min(Math.max(e,0),100)}%)`}})}));rk.displayName="Progress";var lne={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const cne=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),dne=(s,e)=>{const t=C.forwardRef(({color:n="currentColor",size:r=24,strokeWidth:a=2,absoluteStrokeWidth:o,children:l,...c},d)=>C.createElement("svg",{ref:d,...lne,width:r,height:r,stroke:n,strokeWidth:o?Number(a)*24/Number(r):a,className:`lucide lucide-${cne(s)}`,...c},[...e.map(([h,f])=>C.createElement(h,f)),...(Array.isArray(l)?l:[l])||[]]));return t.displayName=`${s}`,t};var Se=dne;const Na=Se("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),lm=Se("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),ik=Se("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),wo=Se("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]),Cx=Se("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]),Ac=Se("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]),une=Se("Car",[["path",{d:"M14 16H9m10 0h3v-3.15a1 1 0 0 0-.84-.99L16 11l-2.7-3.6a1 1 0 0 0-.8-.4H5.24a2 2 0 0 0-1.8 1.1l-.8 1.63A6 6 0 0 0 2 12.42V16h2",key:"l5np60"}],["circle",{cx:"6.5",cy:"16.5",r:"2.5",key:"ae40ju"}],["circle",{cx:"16.5",cy:"16.5",r:"2.5",key:"1smtlt"}]]),ak=Se("Castle",[["path",{d:"M22 20v-9H2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2Z",key:"109fe4"}],["path",{d:"M18 11V4H6v7",key:"mon5oj"}],["path",{d:"M15 22v-4a3 3 0 0 0-3-3v0a3 3 0 0 0-3 3v4",key:"jdggr9"}],["path",{d:"M22 11V9",key:"3zbp94"}],["path",{d:"M2 11V9",key:"1x5rnq"}],["path",{d:"M6 4V2",key:"1rsq15"}],["path",{d:"M18 4V2",key:"1jsdo1"}],["path",{d:"M10 4V2",key:"75d9ly"}],["path",{d:"M14 4V2",key:"8nj3z6"}]]),sL=Se("CheckCircle2",[["path",{d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z",key:"14v8dr"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),Yi=Se("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["polyline",{points:"22 4 12 14.01 9 11.01",key:"6xbx8j"}]]),eM=Se("Check",[["polyline",{points:"20 6 9 17 4 12",key:"10jjfj"}]]),tM=Se("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]),hne=Se("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),y$=Se("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),v$=Se("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),tw=Se("Church",[["path",{d:"m18 7 4 2v11a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9l4-2",key:"gy5gyo"}],["path",{d:"M14 22v-4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v4",key:"cpkuc4"}],["path",{d:"M18 22V5l-6-3-6 3v17",key:"1hsnhq"}],["path",{d:"M12 7v5",key:"ma6bk"}],["path",{d:"M10 9h4",key:"u4k05v"}]]),sM=Se("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),Ra=Se("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),b$=Se("Coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]),w$=Se("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),fne=Se("Crosshair",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"22",x2:"18",y1:"12",y2:"12",key:"l9bcsi"}],["line",{x1:"6",x2:"2",y1:"12",y2:"12",key:"13hhkx"}],["line",{x1:"12",x2:"12",y1:"6",y2:"2",key:"10w3f3"}],["line",{x1:"12",x2:"12",y1:"22",y2:"18",key:"15g9kq"}]]),Ru=Se("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]),nL=Se("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),mne=Se("Dice1",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M12 12h.01",key:"1mp3jc"}]]),rL=Se("Dice6",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M16 8h.01",key:"cr5u4v"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M16 16h.01",key:"1f9h7w"}],["path",{d:"M8 8h.01",key:"1e4136"}],["path",{d:"M8 12h.01",key:"czm47f"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]),lA=Se("Dices",[["rect",{width:"12",height:"12",x:"2",y:"10",rx:"2",ry:"2",key:"6agr2n"}],["path",{d:"m17.92 14 3.5-3.5a2.24 2.24 0 0 0 0-3l-5-4.92a2.24 2.24 0 0 0-3 0L10 6",key:"1o487t"}],["path",{d:"M6 18h.01",key:"uhywen"}],["path",{d:"M10 14h.01",key:"ssrbsk"}],["path",{d:"M15 6h.01",key:"cblpky"}],["path",{d:"M18 9h.01",key:"2061c0"}]]),F1=Se("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),C$=Se("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]),Sx=Se("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]),Ku=Se("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),$v=Se("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]),S$=Se("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),pne=Se("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]),j$=Se("Footprints",[["path",{d:"M4 16v-2.38C4 11.5 2.97 10.5 3 8c.03-2.72 1.49-6 4.5-6C9.37 2 10 3.8 10 5.5c0 3.11-2 5.66-2 8.68V16a2 2 0 1 1-4 0Z",key:"1dudjm"}],["path",{d:"M20 20v-2.38c0-2.12 1.03-3.12 1-5.62-.03-2.72-1.49-6-4.5-6C14.63 6 14 7.8 14 9.5c0 3.11 2 5.66 2 8.68V20a2 2 0 1 0 4 0Z",key:"l2t8xc"}],["path",{d:"M16 17h4",key:"1dejxt"}],["path",{d:"M4 13h4",key:"1bwh8b"}]]),gne=Se("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z",key:"nb9nel"}]]),xne=Se("GraduationCap",[["path",{d:"M22 10v6M2 10l10-5 10 5-10 5z",key:"1ef52a"}],["path",{d:"M6 12v5c3 3 9 3 12 0v-5",key:"1f75yj"}]]),yne=Se("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]),nM=Se("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),vne=Se("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Uv=Se("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),Du=Se("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]),k$=Se("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),ok=Se("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),N$=Se("Layers",[["polygon",{points:"12 2 2 7 12 12 22 7 12 2",key:"1b0ttc"}],["polyline",{points:"2 17 12 22 22 17",key:"imjtdl"}],["polyline",{points:"2 12 12 17 22 12",key:"5dexcv"}]]),iL=Se("Layout",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["line",{x1:"3",x2:"21",y1:"9",y2:"9",key:"1vqk6q"}],["line",{x1:"9",x2:"9",y1:"21",y2:"9",key:"wpwpyp"}]]),bne=Se("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),wne=Se("ListTodo",[["rect",{x:"3",y:"5",width:"6",height:"6",rx:"1",key:"1defrl"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]),Ss=Se("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]),Cne=Se("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),Mn=Se("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),jo=Se("Map",[["polygon",{points:"3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21",key:"ok2ie8"}],["line",{x1:"9",x2:"9",y1:"3",y2:"18",key:"w34qz5"}],["line",{x1:"15",x2:"15",y1:"6",y2:"21",key:"volv9a"}]]),Sne=Se("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]),jne=Se("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]),kne=Se("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]),Nne=Se("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]),Ane=Se("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]),aL=Se("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]),lk=Se("Mountain",[["path",{d:"m8 3 4 8 5-5 5 15H2L8 3z",key:"otkl63"}]]),rM=Se("MousePointer",[["path",{d:"m3 3 7.07 16.97 2.51-7.39 7.39-2.51L3 3z",key:"y2ucgo"}],["path",{d:"m13 13 6 6",key:"1nhxnf"}]]),_ne=Se("Move",[["polyline",{points:"5 9 2 12 5 15",key:"1r5uj5"}],["polyline",{points:"9 5 12 2 15 5",key:"5v383o"}],["polyline",{points:"15 19 12 22 9 19",key:"g7qi8m"}],["polyline",{points:"19 9 22 12 19 15",key:"tpp73q"}],["line",{x1:"2",x2:"22",y1:"12",y2:"12",key:"1dnqot"}],["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}]]),jx=Se("Network",[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]]),hl=Se("Package",[["path",{d:"M16.5 9.4 7.55 4.24",key:"10qotr"}],["path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z",key:"yt0hxn"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}]]),Tne=Se("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",key:"1xcu5"}],["circle",{cx:"17.5",cy:"10.5",r:".5",key:"736e4u"}],["circle",{cx:"8.5",cy:"7.5",r:".5",key:"clrty"}],["circle",{cx:"6.5",cy:"12.5",r:".5",key:"1s4xz9"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]),eT=Se("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]),Ene=Se("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]),hS=Se("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]),Pne=Se("PinOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["line",{x1:"12",x2:"12",y1:"17",y2:"22",key:"1jrz49"}],["path",{d:"M9 9v1.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V17h12",key:"13x2n8"}],["path",{d:"M15 9.34V6h1a2 2 0 0 0 0-4H7.89",key:"reo3ki"}]]),Mne=Se("Pin",[["line",{x1:"12",x2:"12",y1:"17",y2:"22",key:"1jrz49"}],["path",{d:"M5 17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V6h1a2 2 0 0 0 0-4H8a2 2 0 0 0 0 4h1v4.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24Z",key:"13yl11"}]]),_u=Se("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),Mt=Se("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),Lu=Se("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),ck=Se("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),tT=Se("Router",[["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",key:"w68u3i"}],["path",{d:"M6.01 18H6",key:"19vcac"}],["path",{d:"M10.01 18H10",key:"uamcmx"}],["path",{d:"M15 10v4",key:"qjz1xs"}],["path",{d:"M17.84 7.17a4 4 0 0 0-5.66 0",key:"1rif40"}],["path",{d:"M20.66 4.34a8 8 0 0 0-11.31 0",key:"6a5xfq"}]]),iM=Se("Ruler",[["path",{d:"M21.3 15.3a2.4 2.4 0 0 1 0 3.4l-2.6 2.6a2.4 2.4 0 0 1-3.4 0L2.7 8.7a2.41 2.41 0 0 1 0-3.4l2.6-2.6a2.41 2.41 0 0 1 3.4 0Z",key:"icamh8"}],["path",{d:"m14.5 12.5 2-2",key:"inckbg"}],["path",{d:"m11.5 9.5 2-2",key:"fmmyf7"}],["path",{d:"m8.5 6.5 2-2",key:"vc6u1g"}],["path",{d:"m17.5 15.5 2-2",key:"wo5hmg"}]]),A$=Se("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]),sT=Se("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]),cA=Se("ScrollText",[["path",{d:"M8 21h12a2 2 0 0 0 2-2v-2H10v2a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v3h4",key:"13a6an"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M15 8h-5",key:"1khuty"}],["path",{d:"M15 12h-5",key:"r7krc0"}]]),uv=Se("Scroll",[["path",{d:"M8 21h12a2 2 0 0 0 2-2v-2H10v2a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v3h4",key:"13a6an"}],["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}]]),wm=Se("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),dk=Se("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),Dr=Se("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",key:"3xmgem"}]]),Ine=Se("Ship",[["path",{d:"M2 21c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1 .6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"iegodh"}],["path",{d:"M19.38 20A11.6 11.6 0 0 0 21 14l-9-4-9 4c0 2.9.94 5.34 2.81 7.76",key:"fp8vka"}],["path",{d:"M19 13V7a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v6",key:"qpkstq"}],["path",{d:"M12 10v4",key:"1kjpxc"}],["path",{d:"M12 2v3",key:"qbqxhf"}]]),oL=Se("SkipForward",[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]]),Oc=Se("Skull",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["path",{d:"M8 20v2h8v-2",key:"ded4og"}],["path",{d:"m12.5 17-.5-1-.5 1h1z",key:"3me087"}],["path",{d:"M16 20a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20",key:"xq9p5u"}]]),Aa=Se("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]),_$=Se("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),Co=Se("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),aM=Se("StickyNote",[["path",{d:"M15.5 3H5a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2V8.5L15.5 3Z",key:"1wis1t"}],["path",{d:"M15 3v6h6",key:"edgan2"}]]),lL=Se("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]),En=Se("Sword",[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}]]),uk=Se("Swords",[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}],["polyline",{points:"14.5 6.5 18 3 21 3 21 6 17.5 9.5",key:"hbey2j"}],["line",{x1:"5",x2:"9",y1:"14",y2:"18",key:"1hf58s"}],["line",{x1:"7",x2:"4",y1:"17",y2:"20",key:"pidxm4"}],["line",{x1:"3",x2:"5",y1:"19",y2:"21",key:"1pehsh"}]]),ci=Se("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),hk=Se("Tent",[["path",{d:"M19 20 10 4",key:"1ak541"}],["path",{d:"m5 20 9-16",key:"11dtj9"}],["path",{d:"M3 20h18",key:"1l19wn"}],["path",{d:"m12 15-3 5",key:"1c5kej"}],["path",{d:"m12 15 3 5",key:"odkmhi"}]]),kx=Se("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),fk=Se("Trees",[["path",{d:"M10 10v.2A3 3 0 0 1 8.9 16v0H5v0h0a3 3 0 0 1-1-5.8V10a3 3 0 0 1 6 0Z",key:"yh07w9"}],["path",{d:"M7 16v6",key:"1a82de"}],["path",{d:"M13 19v3",key:"13sx9i"}],["path",{d:"M12 19h8.3a1 1 0 0 0 .7-1.7L18 14h.3a1 1 0 0 0 .7-1.7L16 9h.2a1 1 0 0 0 .8-1.7L13 3l-1.4 1.5",key:"1sj9kv"}]]),Rne=Se("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),T$=Se("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),oM=Se("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]),lM=Se("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),cM=Se("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),Cs=Se("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),E$=Se("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),Mr=Se("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),Da=Se("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),Dne=Se("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]);function Lne({isOpen:s,timeRemaining:e,onExtendSession:t,onSignOut:n,onClose:r,autoSignOutAfter:a=60}){const[o,l]=C.useState(!1),[c,d]=C.useState(a);C.useEffect(()=>{if(!s){d(a);return}const p=setInterval(()=>{d(x=>x<=1?(n(),0):x-1)},1e3);return()=>clearInterval(p)},[s,a,n]);const h=async()=>{l(!0);try{await t()&&r()}catch(p){console.error("Failed to extend session:",p)}finally{l(!1)}},f=p=>{const x=Math.floor(p/1e3),g=Math.floor(x/60),b=x%60;return g>0?`${g}:${b.toString().padStart(2,"0")}`:`${b}s`},m=Math.max(0,Math.min(100,e/(5*60*1e3)*100));return s?i.jsx(g$,{open:s,children:i.jsxs(GP,{className:"max-w-md",children:[i.jsxs(YP,{children:[i.jsxs("div",{className:"flex items-center gap-2 text-amber-600",children:[i.jsx(lm,{className:"h-5 w-5"}),i.jsx(XP,{children:"Session Expiring Soon"})]}),i.jsxs(QP,{className:"space-y-4",children:[i.jsxs("div",{className:"text-center",children:[i.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[i.jsx(Ra,{className:"h-4 w-4"}),i.jsxs("span",{className:"font-medium",children:["Time remaining: ",f(e)]})]}),i.jsx(rk,{value:m,className:"w-full h-2"}),i.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Your session will expire soon due to inactivity. Would you like to extend your session or sign out?"})]}),i.jsxs("div",{className:"bg-muted p-3 rounded-lg text-sm",children:[i.jsxs("p",{className:"font-medium text-center",children:["Auto sign out in: ",c,"s"]}),i.jsx("p",{className:"text-muted-foreground text-center text-xs mt-1",children:"You will be automatically signed out if no action is taken"})]})]})]}),i.jsxs(KP,{className:"flex-col-reverse sm:flex-row gap-2",children:[i.jsx(JP,{asChild:!0,children:i.jsxs(q,{variant:"outline",onClick:n,className:"w-full sm:w-auto",children:[i.jsx(Cne,{className:"h-4 w-4 mr-2"}),"Sign Out"]})}),i.jsx(ZP,{asChild:!0,children:i.jsx(q,{onClick:h,disabled:o,className:"w-full sm:w-auto",children:o?i.jsxs(i.Fragment,{children:[i.jsx(Lu,{className:"h-4 w-4 mr-2 animate-spin"}),"Extending..."]}):i.jsxs(i.Fragment,{children:[i.jsx(Lu,{className:"h-4 w-4 mr-2"}),"Extend Session"]})})})]})]})}):null}const P$=C.createContext(void 0);function One({children:s,showToast:e}){const{signOut:t,isLoaded:n}=Ji(),[r,a]=C.useState(!1),[o,l]=C.useState(0),c=C.useCallback((A,k)=>{console.log(`[${k.toUpperCase()}] ${A}`)},[]),d=e||c,h=C.useCallback(A=>{l(A),a(!0)},[]),f=C.useCallback(()=>{a(!1),d("Your session has expired. Please sign in again.","warning"),t()},[d,t]),m=C.useCallback(()=>{a(!1),d("Session extended successfully.","info")},[d]),{sessionInfo:p,refreshSession:x}=Nee({warningTimeMinutes:5,checkIntervalSeconds:30,onSessionExpiring:h,onSessionExpired:f,onSessionRefreshed:m}),{handleAuthError:g,signOutUser:b,isAuthenticated:v,isLoading:y}=kee({onSessionExpired:f,onUnauthorized:()=>{d("You are not authorized to perform this action.","error")},onAuthError:A=>{var k;console.error("Authentication error:",A),!((k=A.message)!=null&&k.includes("Not authenticated")&&!n)&&d("Authentication error occurred. Please try refreshing the page.","error")},showToast:d});C.useEffect(()=>{const A=_=>{var D,P,T;const L=_.error;L&&((D=L.message)!=null&&D.includes("Unauthenticated")||(P=L.message)!=null&&P.includes("authentication")||(T=L.message)!=null&&T.includes("UNAUTHORIZED")||L.code==="Unauthenticated")&&g(L)},k=_=>{var D,P,T;const L=_.reason;L&&((D=L.message)!=null&&D.includes("Unauthenticated")||(P=L.message)!=null&&P.includes("authentication")||(T=L.message)!=null&&T.includes("UNAUTHORIZED")||L.code==="Unauthenticated")&&(g(L),_.preventDefault())};return window.addEventListener("error",A),window.addEventListener("unhandledrejection",k),()=>{window.removeEventListener("error",A),window.removeEventListener("unhandledrejection",k)}},[g]);const w=C.useCallback(async()=>{const A=await x();return A&&a(!1),A},[x]),S=C.useCallback(()=>{a(!1),b()},[b]),j={handleAuthError:g,showSessionWarning:p.isExpiringSoon,isAuthenticated:v,isLoading:y,signOutUser:b,refreshSession:x};return i.jsxs(P$.Provider,{value:j,children:[s,i.jsx(Lne,{isOpen:r,timeRemaining:o,onExtendSession:w,onSignOut:S,onClose:()=>a(!1),autoSignOutAfter:60})]})}function sw(){const s=C.useContext(P$);if(s===void 0)throw new Error("useAuthentication must be used within an AuthenticationProvider");return s}const oe=C.forwardRef(({className:s,...e},t)=>i.jsx("div",{ref:t,className:Ee("rounded-xl border bg-card/50 backdrop-blur-sm text-card-foreground shadow-modern hover-lift transition-all duration-300",s),...e}));oe.displayName="Card";const ke=C.forwardRef(({className:s,...e},t)=>i.jsx("div",{ref:t,className:Ee("flex flex-col space-y-2 p-6",s),...e}));ke.displayName="CardHeader";const Ne=C.forwardRef(({className:s,...e},t)=>i.jsx("h3",{ref:t,className:Ee("text-2xl font-bold leading-none tracking-tight text-gradient",s),...e}));Ne.displayName="CardTitle";const At=C.forwardRef(({className:s,...e},t)=>i.jsx("p",{ref:t,className:Ee("text-sm text-muted-foreground leading-relaxed",s),...e}));At.displayName="CardDescription";const he=C.forwardRef(({className:s,...e},t)=>i.jsx("div",{ref:t,className:Ee("p-6 pt-0",s),...e}));he.displayName="CardContent";const Fne=C.forwardRef(({className:s,...e},t)=>i.jsx("div",{ref:t,className:Ee("flex items-center p-6 pt-0",s),...e}));Fne.displayName="CardFooter";const Bne=nk("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",cr:"border-transparent bg-orange-500 text-white hover:bg-orange-600",level:"border-transparent bg-blue-500 text-white hover:bg-blue-600",status:"border-transparent bg-green-500 text-white hover:bg-green-600"}},defaultVariants:{variant:"default"}});function ue({className:s,variant:e,...t}){return i.jsx("div",{className:Ee(Bne({variant:e}),s),...t})}function cL({campaign:s,dmName:e,onView:t,onEdit:n,canEdit:r=!1}){var o;const a=((o=s.players)==null?void 0:o.length)||0;return i.jsxs(oe,{className:"hover:shadow-md transition-shadow cursor-pointer",children:[i.jsx(ke,{className:"pb-3",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsx(Ne,{className:"text-lg line-clamp-1",children:s.name}),i.jsxs("div",{className:"flex items-center gap-1",children:[s.isPublic?i.jsx(Ku,{className:"h-4 w-4 text-muted-foreground"}):i.jsx(Sx,{className:"h-4 w-4 text-muted-foreground"}),i.jsx(ue,{variant:"outline",children:s.isPublic?"Public":"Private"})]})]})}),i.jsxs(he,{className:"space-y-3",children:[s.description&&i.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:s.description}),i.jsxs("div",{className:"flex items-center justify-between text-sm",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"text-muted-foreground",children:"DM:"}),i.jsx("span",{className:"font-medium",children:e||"Unknown"})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(Cs,{className:"h-4 w-4 text-muted-foreground"}),i.jsxs("span",{className:"text-muted-foreground",children:[a," players"]})]})]}),i.jsxs("div",{className:"flex gap-2 pt-2",children:[i.jsx(q,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>t==null?void 0:t(s._id),children:"View"}),r&&i.jsx(q,{size:"sm",className:"flex-1",onClick:()=>n==null?void 0:n(s._id),children:"Edit"})]})]})]})}var nw=s=>s.type==="checkbox",bh=s=>s instanceof Date,ti=s=>s==null;const M$=s=>typeof s=="object";var on=s=>!ti(s)&&!Array.isArray(s)&&M$(s)&&!bh(s),I$=s=>on(s)&&s.target?nw(s.target)?s.target.checked:s.target.value:s,$ne=s=>s.substring(0,s.search(/\.\d+(\.|$)/))||s,R$=(s,e)=>s.has($ne(e)),Une=s=>{const e=s.constructor&&s.constructor.prototype;return on(e)&&e.hasOwnProperty("isPrototypeOf")},dM=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function un(s){let e;const t=Array.isArray(s),n=typeof FileList<"u"?s instanceof FileList:!1;if(s instanceof Date)e=new Date(s);else if(!(dM&&(s instanceof Blob||n))&&(t||on(s)))if(e=t?[]:Object.create(Object.getPrototypeOf(s)),!t&&!Une(s))e=s;else for(const r in s)s.hasOwnProperty(r)&&(e[r]=un(s[r]));else return s;return e}var mk=s=>/^\w*$/.test(s),qs=s=>s===void 0,uM=s=>Array.isArray(s)?s.filter(Boolean):[],hM=s=>uM(s.replace(/["|']|\]/g,"").split(/\.|\[/)),Le=(s,e,t)=>{if(!e||!on(s))return t;const n=(mk(e)?[e]:hM(e)).reduce((r,a)=>ti(r)?r:r[a],s);return qs(n)||n===s?qs(s[e])?t:s[e]:n},Oi=s=>typeof s=="boolean",Xt=(s,e,t)=>{let n=-1;const r=mk(e)?[e]:hM(e),a=r.length,o=a-1;for(;++n<a;){const l=r[n];let c=t;if(n!==o){const d=s[l];c=on(d)||Array.isArray(d)?d:isNaN(+r[n+1])?{}:[]}if(l==="__proto__"||l==="constructor"||l==="prototype")return;s[l]=c,s=s[l]}};const fS={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},co={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Pl={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},fM=V.createContext(null);fM.displayName="HookFormContext";const pk=()=>V.useContext(fM),zne=s=>{const{children:e,...t}=s;return V.createElement(fM.Provider,{value:t},e)};var D$=(s,e,t,n=!0)=>{const r={defaultValues:e._defaultValues};for(const a in s)Object.defineProperty(r,a,{get:()=>{const o=a;return e._proxyFormState[o]!==co.all&&(e._proxyFormState[o]=!n||co.all),t&&(t[o]=!0),s[o]}});return r};const mM=typeof window<"u"?V.useLayoutEffect:V.useEffect;function Hne(s){const e=pk(),{control:t=e.control,disabled:n,name:r,exact:a}=s||{},[o,l]=V.useState(t._formState),c=V.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1});return mM(()=>t._subscribe({name:r,formState:c.current,exact:a,callback:d=>{!n&&l({...t._formState,...d})}}),[r,n,a]),V.useEffect(()=>{c.current.isValid&&t._setValid(!0)},[t]),V.useMemo(()=>D$(o,t,c.current,!1),[o,t])}var zi=s=>typeof s=="string",nT=(s,e,t,n,r)=>zi(s)?(n&&e.watch.add(s),Le(t,s,r)):Array.isArray(s)?s.map(a=>(n&&e.watch.add(a),Le(t,a))):(n&&(e.watchAll=!0),t),rT=s=>ti(s)||!M$(s);function uo(s,e,t=new WeakSet){if(rT(s)||rT(e))return Object.is(s,e);if(bh(s)&&bh(e))return s.getTime()===e.getTime();const n=Object.keys(s),r=Object.keys(e);if(n.length!==r.length)return!1;if(t.has(s)||t.has(e))return!0;t.add(s),t.add(e);for(const a of n){const o=s[a];if(!r.includes(a))return!1;if(a!=="ref"){const l=e[a];if(bh(o)&&bh(l)||on(o)&&on(l)||Array.isArray(o)&&Array.isArray(l)?!uo(o,l,t):!Object.is(o,l))return!1}}return!0}function L$(s){const e=pk(),{control:t=e.control,name:n,defaultValue:r,disabled:a,exact:o,compute:l}=s||{},c=V.useRef(r),d=V.useRef(l),h=V.useRef(void 0),f=V.useRef(t),m=V.useRef(n);d.current=l;const[p,x]=V.useState(()=>{const S=t._getWatch(n,c.current);return d.current?d.current(S):S}),g=V.useCallback(S=>{const j=nT(n,t._names,S||t._formValues,!1,c.current);return d.current?d.current(j):j},[t._formValues,t._names,n]),b=V.useCallback(S=>{if(!a){const j=nT(n,t._names,S||t._formValues,!1,c.current);if(d.current){const A=d.current(j);uo(A,h.current)||(x(A),h.current=A)}else x(j)}},[t._formValues,t._names,a,n]);mM(()=>((f.current!==t||!uo(m.current,n))&&(f.current=t,m.current=n,b()),t._subscribe({name:n,formState:{values:!0},exact:o,callback:S=>{b(S.values)}})),[t,o,n,b]),V.useEffect(()=>t._removeUnmounted());const v=f.current!==t,y=m.current,w=V.useMemo(()=>{if(a)return null;const S=!v&&!uo(y,n);return v||S?g():null},[a,v,n,y,g]);return w!==null?w:p}function Vne(s){const e=pk(),{name:t,disabled:n,control:r=e.control,shouldUnregister:a,defaultValue:o}=s,l=R$(r._names.array,t),c=V.useMemo(()=>Le(r._formValues,t,Le(r._defaultValues,t,o)),[r,t,o]),d=L$({control:r,name:t,defaultValue:c,exact:!0}),h=Hne({control:r,name:t,exact:!0}),f=V.useRef(s),m=V.useRef(void 0),p=V.useRef(r.register(t,{...s.rules,value:d,...Oi(s.disabled)?{disabled:s.disabled}:{}}));f.current=s;const x=V.useMemo(()=>Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!Le(h.errors,t)},isDirty:{enumerable:!0,get:()=>!!Le(h.dirtyFields,t)},isTouched:{enumerable:!0,get:()=>!!Le(h.touchedFields,t)},isValidating:{enumerable:!0,get:()=>!!Le(h.validatingFields,t)},error:{enumerable:!0,get:()=>Le(h.errors,t)}}),[h,t]),g=V.useCallback(w=>p.current.onChange({target:{value:I$(w),name:t},type:fS.CHANGE}),[t]),b=V.useCallback(()=>p.current.onBlur({target:{value:Le(r._formValues,t),name:t},type:fS.BLUR}),[t,r._formValues]),v=V.useCallback(w=>{const S=Le(r._fields,t);S&&w&&(S._f.ref={focus:()=>w.focus&&w.focus(),select:()=>w.select&&w.select(),setCustomValidity:j=>w.setCustomValidity(j),reportValidity:()=>w.reportValidity()})},[r._fields,t]),y=V.useMemo(()=>({name:t,value:d,...Oi(n)||h.disabled?{disabled:h.disabled||n}:{},onChange:g,onBlur:b,ref:v}),[t,n,h.disabled,g,b,v,d]);return V.useEffect(()=>{const w=r._options.shouldUnregister||a,S=m.current;S&&S!==t&&!l&&r.unregister(S),r.register(t,{...f.current.rules,...Oi(f.current.disabled)?{disabled:f.current.disabled}:{}});const j=(A,k)=>{const _=Le(r._fields,A);_&&_._f&&(_._f.mount=k)};if(j(t,!0),w){const A=un(Le(r._options.defaultValues,t,f.current.defaultValue));Xt(r._defaultValues,t,A),qs(Le(r._formValues,t))&&Xt(r._formValues,t,A)}return!l&&r.register(t),m.current=t,()=>{(l?w&&!r._state.action:w)?r.unregister(t):j(t,!1)}},[t,r,l,a]),V.useEffect(()=>{r._setDisabledField({disabled:n,name:t})},[n,t,r]),V.useMemo(()=>({field:y,formState:h,fieldState:x}),[y,h,x])}const Wne=s=>s.render(Vne(s));var O$=(s,e,t,n,r)=>e?{...t[s],types:{...t[s]&&t[s].types?t[s].types:{},[n]:r||!0}}:{},hv=s=>Array.isArray(s)?s:[s],dL=()=>{let s=[];return{get observers(){return s},next:r=>{for(const a of s)a.next&&a.next(r)},subscribe:r=>(s.push(r),{unsubscribe:()=>{s=s.filter(a=>a!==r)}}),unsubscribe:()=>{s=[]}}};function F$(s,e){const t={};for(const n in s)if(s.hasOwnProperty(n)){const r=s[n],a=e[n];if(r&&on(r)&&a){const o=F$(r,a);on(o)&&(t[n]=o)}else s[n]&&(t[n]=a)}return t}var Cr=s=>on(s)&&!Object.keys(s).length,pM=s=>s.type==="file",ho=s=>typeof s=="function",mS=s=>{if(!dM)return!1;const e=s?s.ownerDocument:0;return s instanceof(e&&e.defaultView?e.defaultView.HTMLElement:HTMLElement)},B$=s=>s.type==="select-multiple",gM=s=>s.type==="radio",qne=s=>gM(s)||nw(s),dA=s=>mS(s)&&s.isConnected;function Gne(s,e){const t=e.slice(0,-1).length;let n=0;for(;n<t;)s=qs(s)?n++:s[e[n++]];return s}function Yne(s){for(const e in s)if(s.hasOwnProperty(e)&&!qs(s[e]))return!1;return!0}function tn(s,e){const t=Array.isArray(e)?e:mk(e)?[e]:hM(e),n=t.length===1?s:Gne(s,t),r=t.length-1,a=t[r];return n&&delete n[a],r!==0&&(on(n)&&Cr(n)||Array.isArray(n)&&Yne(n))&&tn(s,t.slice(0,-1)),s}var Kne=s=>{for(const e in s)if(ho(s[e]))return!0;return!1};function $$(s){return Array.isArray(s)||on(s)&&!Kne(s)}function iT(s,e={}){for(const t in s){const n=s[t];$$(n)?(e[t]=Array.isArray(n)?[]:{},iT(n,e[t])):qs(n)||(e[t]=!0)}return e}function zm(s,e,t){t||(t=iT(e));for(const n in s){const r=s[n];if($$(r))qs(e)||rT(t[n])?t[n]=iT(r,Array.isArray(r)?[]:{}):zm(r,ti(e)?{}:e[n],t[n]);else{const a=e[n];t[n]=!uo(r,a)}}return t}const uL={value:!1,isValid:!1},hL={value:!0,isValid:!0};var U$=s=>{if(Array.isArray(s)){if(s.length>1){const e=s.filter(t=>t&&t.checked&&!t.disabled).map(t=>t.value);return{value:e,isValid:!!e.length}}return s[0].checked&&!s[0].disabled?s[0].attributes&&!qs(s[0].attributes.value)?qs(s[0].value)||s[0].value===""?hL:{value:s[0].value,isValid:!0}:hL:uL}return uL},z$=(s,{valueAsNumber:e,valueAsDate:t,setValueAs:n})=>qs(s)?s:e?s===""?NaN:s&&+s:t&&zi(s)?new Date(s):n?n(s):s;const fL={isValid:!1,value:null};var H$=s=>Array.isArray(s)?s.reduce((e,t)=>t&&t.checked&&!t.disabled?{isValid:!0,value:t.value}:e,fL):fL;function mL(s){const e=s.ref;return pM(e)?e.files:gM(e)?H$(s.refs).value:B$(e)?[...e.selectedOptions].map(({value:t})=>t):nw(e)?U$(s.refs).value:z$(qs(e.value)?s.ref.value:e.value,s)}var Xne=(s,e,t,n)=>{const r={};for(const a of s){const o=Le(e,a);o&&Xt(r,a,o._f)}return{criteriaMode:t,names:[...s],fields:r,shouldUseNativeValidation:n}},pS=s=>s instanceof RegExp,sy=s=>qs(s)?s:pS(s)?s.source:on(s)?pS(s.value)?s.value.source:s.value:s,pL=s=>({isOnSubmit:!s||s===co.onSubmit,isOnBlur:s===co.onBlur,isOnChange:s===co.onChange,isOnAll:s===co.all,isOnTouch:s===co.onTouched});const gL="AsyncFunction";var Qne=s=>!!s&&!!s.validate&&!!(ho(s.validate)&&s.validate.constructor.name===gL||on(s.validate)&&Object.values(s.validate).find(e=>e.constructor.name===gL)),Zne=s=>s.mount&&(s.required||s.min||s.max||s.maxLength||s.minLength||s.pattern||s.validate),xL=(s,e,t)=>!t&&(e.watchAll||e.watch.has(s)||[...e.watch].some(n=>s.startsWith(n)&&/^\.\w+/.test(s.slice(n.length))));const fv=(s,e,t,n)=>{for(const r of t||Object.keys(s)){const a=Le(s,r);if(a){const{_f:o,...l}=a;if(o){if(o.refs&&o.refs[0]&&e(o.refs[0],r)&&!n)return!0;if(o.ref&&e(o.ref,o.name)&&!n)return!0;if(fv(l,e))break}else if(on(l)&&fv(l,e))break}}};function yL(s,e,t){const n=Le(s,t);if(n||mk(t))return{error:n,name:t};const r=t.split(".");for(;r.length;){const a=r.join("."),o=Le(e,a),l=Le(s,a);if(o&&!Array.isArray(o)&&t!==a)return{name:t};if(l&&l.type)return{name:a,error:l};if(l&&l.root&&l.root.type)return{name:`${a}.root`,error:l.root};r.pop()}return{name:t}}var Jne=(s,e,t,n)=>{t(s);const{name:r,...a}=s;return Cr(a)||Object.keys(a).length>=Object.keys(e).length||Object.keys(a).find(o=>e[o]===(!n||co.all))},ere=(s,e,t)=>!s||!e||s===e||hv(s).some(n=>n&&(t?n===e:n.startsWith(e)||e.startsWith(n))),tre=(s,e,t,n,r)=>r.isOnAll?!1:!t&&r.isOnTouch?!(e||s):(t?n.isOnBlur:r.isOnBlur)?!s:(t?n.isOnChange:r.isOnChange)?s:!0,sre=(s,e)=>!uM(Le(s,e)).length&&tn(s,e),nre=(s,e,t)=>{const n=hv(Le(s,t));return Xt(n,"root",e[t]),Xt(s,t,n),s};function vL(s,e,t="validate"){if(zi(s)||Array.isArray(s)&&s.every(zi)||Oi(s)&&!s)return{type:t,message:zi(s)?s:"",ref:e}}var Im=s=>on(s)&&!pS(s)?s:{value:s,message:""},bL=async(s,e,t,n,r,a)=>{const{ref:o,refs:l,required:c,maxLength:d,minLength:h,min:f,max:m,pattern:p,validate:x,name:g,valueAsNumber:b,mount:v}=s._f,y=Le(t,g);if(!v||e.has(g))return{};const w=l?l[0]:o,S=T=>{r&&w.reportValidity&&(w.setCustomValidity(Oi(T)?"":T||""),w.reportValidity())},j={},A=gM(o),k=nw(o),_=A||k,L=(b||pM(o))&&qs(o.value)&&qs(y)||mS(o)&&o.value===""||y===""||Array.isArray(y)&&!y.length,D=O$.bind(null,g,n,j),P=(T,B,R,O=Pl.maxLength,I=Pl.minLength)=>{const U=T?B:R;j[g]={type:T?O:I,message:U,ref:o,...D(T?O:I,U)}};if(a?!Array.isArray(y)||!y.length:c&&(!_&&(L||ti(y))||Oi(y)&&!y||k&&!U$(l).isValid||A&&!H$(l).isValid)){const{value:T,message:B}=zi(c)?{value:!!c,message:c}:Im(c);if(T&&(j[g]={type:Pl.required,message:B,ref:w,...D(Pl.required,B)},!n))return S(B),j}if(!L&&(!ti(f)||!ti(m))){let T,B;const R=Im(m),O=Im(f);if(!ti(y)&&!isNaN(y)){const I=o.valueAsNumber||y&&+y;ti(R.value)||(T=I>R.value),ti(O.value)||(B=I<O.value)}else{const I=o.valueAsDate||new Date(y),U=W=>new Date(new Date().toDateString()+" "+W),M=o.type=="time",$=o.type=="week";zi(R.value)&&y&&(T=M?U(y)>U(R.value):$?y>R.value:I>new Date(R.value)),zi(O.value)&&y&&(B=M?U(y)<U(O.value):$?y<O.value:I<new Date(O.value))}if((T||B)&&(P(!!T,R.message,O.message,Pl.max,Pl.min),!n))return S(j[g].message),j}if((d||h)&&!L&&(zi(y)||a&&Array.isArray(y))){const T=Im(d),B=Im(h),R=!ti(T.value)&&y.length>+T.value,O=!ti(B.value)&&y.length<+B.value;if((R||O)&&(P(R,T.message,B.message),!n))return S(j[g].message),j}if(p&&!L&&zi(y)){const{value:T,message:B}=Im(p);if(pS(T)&&!y.match(T)&&(j[g]={type:Pl.pattern,message:B,ref:o,...D(Pl.pattern,B)},!n))return S(B),j}if(x){if(ho(x)){const T=await x(y,t),B=vL(T,w);if(B&&(j[g]={...B,...D(Pl.validate,B.message)},!n))return S(B.message),j}else if(on(x)){let T={};for(const B in x){if(!Cr(T)&&!n)break;const R=vL(await x[B](y,t),w,B);R&&(T={...R,...D(B,R.message)},S(R.message),n&&(j[g]=T))}if(!Cr(T)&&(j[g]={ref:w,...T},!n))return j}}return S(!0),j};const rre={mode:co.onSubmit,reValidateMode:co.onChange,shouldFocusError:!0};function ire(s={}){let e={...rre,...s},t={submitCount:0,isDirty:!1,isReady:!1,isLoading:ho(e.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1},n={},r=on(e.defaultValues)||on(e.values)?un(e.defaultValues||e.values)||{}:{},a=e.shouldUnregister?{}:un(r),o={action:!1,mount:!1,watch:!1},l={mount:new Set,disabled:new Set,unMount:new Set,array:new Set,watch:new Set},c,d=0;const h={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1};let f={...h};const m={array:dL(),state:dL()},p=e.criteriaMode===co.all,x=G=>Q=>{clearTimeout(d),d=setTimeout(G,Q)},g=async G=>{if(!e.disabled&&(h.isValid||f.isValid||G)){const Q=e.resolver?Cr((await k()).errors):await L(n,!0);Q!==t.isValid&&m.state.next({isValid:Q})}},b=(G,Q)=>{!e.disabled&&(h.isValidating||h.validatingFields||f.isValidating||f.validatingFields)&&((G||Array.from(l.mount)).forEach(ie=>{ie&&(Q?Xt(t.validatingFields,ie,Q):tn(t.validatingFields,ie))}),m.state.next({validatingFields:t.validatingFields,isValidating:!Cr(t.validatingFields)}))},v=(G,Q=[],ie,ve,we=!0,je=!0)=>{if(ve&&ie&&!e.disabled){if(o.action=!0,je&&Array.isArray(Le(n,G))){const Ye=ie(Le(n,G),ve.argA,ve.argB);we&&Xt(n,G,Ye)}if(je&&Array.isArray(Le(t.errors,G))){const Ye=ie(Le(t.errors,G),ve.argA,ve.argB);we&&Xt(t.errors,G,Ye),sre(t.errors,G)}if((h.touchedFields||f.touchedFields)&&je&&Array.isArray(Le(t.touchedFields,G))){const Ye=ie(Le(t.touchedFields,G),ve.argA,ve.argB);we&&Xt(t.touchedFields,G,Ye)}(h.dirtyFields||f.dirtyFields)&&(t.dirtyFields=zm(r,a)),m.state.next({name:G,isDirty:P(G,Q),dirtyFields:t.dirtyFields,errors:t.errors,isValid:t.isValid})}else Xt(a,G,Q)},y=(G,Q)=>{Xt(t.errors,G,Q),m.state.next({errors:t.errors})},w=G=>{t.errors=G,m.state.next({errors:t.errors,isValid:!1})},S=(G,Q,ie,ve)=>{const we=Le(n,G);if(we){const je=Le(a,G,qs(ie)?Le(r,G):ie);qs(je)||ve&&ve.defaultChecked||Q?Xt(a,G,Q?je:mL(we._f)):R(G,je),o.mount&&!o.action&&g()}},j=(G,Q,ie,ve,we)=>{let je=!1,Ye=!1;const Ft={name:G};if(!e.disabled){if(!ie||ve){(h.isDirty||f.isDirty)&&(Ye=t.isDirty,t.isDirty=Ft.isDirty=P(),je=Ye!==Ft.isDirty);const Wt=uo(Le(r,G),Q);Ye=!!Le(t.dirtyFields,G),Wt?tn(t.dirtyFields,G):Xt(t.dirtyFields,G,!0),Ft.dirtyFields=t.dirtyFields,je=je||(h.dirtyFields||f.dirtyFields)&&Ye!==!Wt}if(ie){const Wt=Le(t.touchedFields,G);Wt||(Xt(t.touchedFields,G,ie),Ft.touchedFields=t.touchedFields,je=je||(h.touchedFields||f.touchedFields)&&Wt!==ie)}je&&we&&m.state.next(Ft)}return je?Ft:{}},A=(G,Q,ie,ve)=>{const we=Le(t.errors,G),je=(h.isValid||f.isValid)&&Oi(Q)&&t.isValid!==Q;if(e.delayError&&ie?(c=x(()=>y(G,ie)),c(e.delayError)):(clearTimeout(d),c=null,ie?Xt(t.errors,G,ie):tn(t.errors,G)),(ie?!uo(we,ie):we)||!Cr(ve)||je){const Ye={...ve,...je&&Oi(Q)?{isValid:Q}:{},errors:t.errors,name:G};t={...t,...Ye},m.state.next(Ye)}},k=async G=>{b(G,!0);const Q=await e.resolver(a,e.context,Xne(G||l.mount,n,e.criteriaMode,e.shouldUseNativeValidation));return b(G),Q},_=async G=>{const{errors:Q}=await k(G);if(G)for(const ie of G){const ve=Le(Q,ie);ve?Xt(t.errors,ie,ve):tn(t.errors,ie)}else t.errors=Q;return Q},L=async(G,Q,ie={valid:!0})=>{for(const ve in G){const we=G[ve];if(we){const{_f:je,...Ye}=we;if(je){const Ft=l.array.has(je.name),Wt=we._f&&Qne(we._f);Wt&&h.validatingFields&&b([je.name],!0);const vn=await bL(we,l.disabled,a,p,e.shouldUseNativeValidation&&!Q,Ft);if(Wt&&h.validatingFields&&b([je.name]),vn[je.name]&&(ie.valid=!1,Q))break;!Q&&(Le(vn,je.name)?Ft?nre(t.errors,vn,je.name):Xt(t.errors,je.name,vn[je.name]):tn(t.errors,je.name))}!Cr(Ye)&&await L(Ye,Q,ie)}}return ie.valid},D=()=>{for(const G of l.unMount){const Q=Le(n,G);Q&&(Q._f.refs?Q._f.refs.every(ie=>!dA(ie)):!dA(Q._f.ref))&&H(G)}l.unMount=new Set},P=(G,Q)=>!e.disabled&&(G&&Q&&Xt(a,G,Q),!uo(W(),r)),T=(G,Q,ie)=>nT(G,l,{...o.mount?a:qs(Q)?r:zi(G)?{[G]:Q}:Q},ie,Q),B=G=>uM(Le(o.mount?a:r,G,e.shouldUnregister?Le(r,G,[]):[])),R=(G,Q,ie={})=>{const ve=Le(n,G);let we=Q;if(ve){const je=ve._f;je&&(!je.disabled&&Xt(a,G,z$(Q,je)),we=mS(je.ref)&&ti(Q)?"":Q,B$(je.ref)?[...je.ref.options].forEach(Ye=>Ye.selected=we.includes(Ye.value)):je.refs?nw(je.ref)?je.refs.forEach(Ye=>{(!Ye.defaultChecked||!Ye.disabled)&&(Array.isArray(we)?Ye.checked=!!we.find(Ft=>Ft===Ye.value):Ye.checked=we===Ye.value||!!we)}):je.refs.forEach(Ye=>Ye.checked=Ye.value===we):pM(je.ref)?je.ref.value="":(je.ref.value=we,je.ref.type||m.state.next({name:G,values:un(a)})))}(ie.shouldDirty||ie.shouldTouch)&&j(G,we,ie.shouldTouch,ie.shouldDirty,!0),ie.shouldValidate&&$(G)},O=(G,Q,ie)=>{for(const ve in Q){if(!Q.hasOwnProperty(ve))return;const we=Q[ve],je=G+"."+ve,Ye=Le(n,je);(l.array.has(G)||on(we)||Ye&&!Ye._f)&&!bh(we)?O(je,we,ie):R(je,we,ie)}},I=(G,Q,ie={})=>{const ve=Le(n,G),we=l.array.has(G),je=un(Q);Xt(a,G,je),we?(m.array.next({name:G,values:un(a)}),(h.isDirty||h.dirtyFields||f.isDirty||f.dirtyFields)&&ie.shouldDirty&&m.state.next({name:G,dirtyFields:zm(r,a),isDirty:P(G,je)})):ve&&!ve._f&&!ti(je)?O(G,je,ie):R(G,je,ie),xL(G,l)&&m.state.next({...t,name:G}),m.state.next({name:o.mount?G:void 0,values:un(a)})},U=async G=>{o.mount=!0;const Q=G.target;let ie=Q.name,ve=!0;const we=Le(n,ie),je=Wt=>{ve=Number.isNaN(Wt)||bh(Wt)&&isNaN(Wt.getTime())||uo(Wt,Le(a,ie,Wt))},Ye=pL(e.mode),Ft=pL(e.reValidateMode);if(we){let Wt,vn;const Ur=Q.type?mL(we._f):I$(G),zr=G.type===fS.BLUR||G.type===fS.FOCUS_OUT,xe=!Zne(we._f)&&!e.resolver&&!Le(t.errors,ie)&&!we._f.deps||tre(zr,Le(t.touchedFields,ie),t.isSubmitted,Ft,Ye),Ke=xL(ie,l,zr);Xt(a,ie,Ur),zr?(!Q||!Q.readOnly)&&(we._f.onBlur&&we._f.onBlur(G),c&&c(0)):we._f.onChange&&we._f.onChange(G);const tt=j(ie,Ur,zr),lt=!Cr(tt)||Ke;if(!zr&&m.state.next({name:ie,type:G.type,values:un(a)}),xe)return(h.isValid||f.isValid)&&(e.mode==="onBlur"?zr&&g():zr||g()),lt&&m.state.next({name:ie,...Ke?{}:tt});if(!zr&&Ke&&m.state.next({...t}),e.resolver){const{errors:St}=await k([ie]);if(je(Ur),ve){const gs=yL(t.errors,n,ie),Dt=yL(St,n,gs.name||ie);Wt=Dt.error,ie=Dt.name,vn=Cr(St)}}else b([ie],!0),Wt=(await bL(we,l.disabled,a,p,e.shouldUseNativeValidation))[ie],b([ie]),je(Ur),ve&&(Wt?vn=!1:(h.isValid||f.isValid)&&(vn=await L(n,!0)));ve&&(we._f.deps&&(!Array.isArray(we._f.deps)||we._f.deps.length>0)&&$(we._f.deps),A(ie,vn,Wt,tt))}},M=(G,Q)=>{if(Le(t.errors,Q)&&G.focus)return G.focus(),1},$=async(G,Q={})=>{let ie,ve;const we=hv(G);if(e.resolver){const je=await _(qs(G)?G:we);ie=Cr(je),ve=G?!we.some(Ye=>Le(je,Ye)):ie}else G?(ve=(await Promise.all(we.map(async je=>{const Ye=Le(n,je);return await L(Ye&&Ye._f?{[je]:Ye}:Ye)}))).every(Boolean),!(!ve&&!t.isValid)&&g()):ve=ie=await L(n);return m.state.next({...!zi(G)||(h.isValid||f.isValid)&&ie!==t.isValid?{}:{name:G},...e.resolver||!G?{isValid:ie}:{},errors:t.errors}),Q.shouldFocus&&!ve&&fv(n,M,G?we:l.mount),ve},W=(G,Q)=>{let ie={...o.mount?a:r};return Q&&(ie=F$(Q.dirtyFields?t.dirtyFields:t.touchedFields,ie)),qs(G)?ie:zi(G)?Le(ie,G):G.map(ve=>Le(ie,ve))},ee=(G,Q)=>({invalid:!!Le((Q||t).errors,G),isDirty:!!Le((Q||t).dirtyFields,G),error:Le((Q||t).errors,G),isValidating:!!Le(t.validatingFields,G),isTouched:!!Le((Q||t).touchedFields,G)}),Z=G=>{G&&hv(G).forEach(Q=>tn(t.errors,Q)),m.state.next({errors:G?t.errors:{}})},z=(G,Q,ie)=>{const ve=(Le(n,G,{_f:{}})._f||{}).ref,we=Le(t.errors,G)||{},{ref:je,message:Ye,type:Ft,...Wt}=we;Xt(t.errors,G,{...Wt,...Q,ref:ve}),m.state.next({name:G,errors:t.errors,isValid:!1}),ie&&ie.shouldFocus&&ve&&ve.focus&&ve.focus()},se=(G,Q)=>ho(G)?m.state.subscribe({next:ie=>"values"in ie&&G(T(void 0,Q),ie)}):T(G,Q,!0),de=G=>m.state.subscribe({next:Q=>{ere(G.name,Q.name,G.exact)&&Jne(Q,G.formState||h,De,G.reRenderRoot)&&G.callback({values:{...a},...t,...Q,defaultValues:r})}}).unsubscribe,ne=G=>(o.mount=!0,f={...f,...G.formState},de({...G,formState:f})),H=(G,Q={})=>{for(const ie of G?hv(G):l.mount)l.mount.delete(ie),l.array.delete(ie),Q.keepValue||(tn(n,ie),tn(a,ie)),!Q.keepError&&tn(t.errors,ie),!Q.keepDirty&&tn(t.dirtyFields,ie),!Q.keepTouched&&tn(t.touchedFields,ie),!Q.keepIsValidating&&tn(t.validatingFields,ie),!e.shouldUnregister&&!Q.keepDefaultValue&&tn(r,ie);m.state.next({values:un(a)}),m.state.next({...t,...Q.keepDirty?{isDirty:P()}:{}}),!Q.keepIsValid&&g()},Y=({disabled:G,name:Q})=>{(Oi(G)&&o.mount||G||l.disabled.has(Q))&&(G?l.disabled.add(Q):l.disabled.delete(Q))},ae=(G,Q={})=>{let ie=Le(n,G);const ve=Oi(Q.disabled)||Oi(e.disabled);return Xt(n,G,{...ie||{},_f:{...ie&&ie._f?ie._f:{ref:{name:G}},name:G,mount:!0,...Q}}),l.mount.add(G),ie?Y({disabled:Oi(Q.disabled)?Q.disabled:e.disabled,name:G}):S(G,!0,Q.value),{...ve?{disabled:Q.disabled||e.disabled}:{},...e.progressive?{required:!!Q.required,min:sy(Q.min),max:sy(Q.max),minLength:sy(Q.minLength),maxLength:sy(Q.maxLength),pattern:sy(Q.pattern)}:{},name:G,onChange:U,onBlur:U,ref:we=>{if(we){ae(G,Q),ie=Le(n,G);const je=qs(we.value)&&we.querySelectorAll&&we.querySelectorAll("input,select,textarea")[0]||we,Ye=qne(je),Ft=ie._f.refs||[];if(Ye?Ft.find(Wt=>Wt===je):je===ie._f.ref)return;Xt(n,G,{_f:{...ie._f,...Ye?{refs:[...Ft.filter(dA),je,...Array.isArray(Le(r,G))?[{}]:[]],ref:{type:je.type,name:G}}:{ref:je}}}),S(G,!1,void 0,je)}else ie=Le(n,G,{}),ie._f&&(ie._f.mount=!1),(e.shouldUnregister||Q.shouldUnregister)&&!(R$(l.array,G)&&o.action)&&l.unMount.add(G)}}},ce=()=>e.shouldFocusError&&fv(n,M,l.mount),Ue=G=>{Oi(G)&&(m.state.next({disabled:G}),fv(n,(Q,ie)=>{const ve=Le(n,ie);ve&&(Q.disabled=ve._f.disabled||G,Array.isArray(ve._f.refs)&&ve._f.refs.forEach(we=>{we.disabled=ve._f.disabled||G}))},0,!1))},te=(G,Q)=>async ie=>{let ve;ie&&(ie.preventDefault&&ie.preventDefault(),ie.persist&&ie.persist());let we=un(a);if(m.state.next({isSubmitting:!0}),e.resolver){const{errors:je,values:Ye}=await k();t.errors=je,we=un(Ye)}else await L(n);if(l.disabled.size)for(const je of l.disabled)tn(we,je);if(tn(t.errors,"root"),Cr(t.errors)){m.state.next({errors:{}});try{await G(we,ie)}catch(je){ve=je}}else Q&&await Q({...t.errors},ie),ce(),setTimeout(ce);if(m.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:Cr(t.errors)&&!ve,submitCount:t.submitCount+1,errors:t.errors}),ve)throw ve},J=(G,Q={})=>{Le(n,G)&&(qs(Q.defaultValue)?I(G,un(Le(r,G))):(I(G,Q.defaultValue),Xt(r,G,un(Q.defaultValue))),Q.keepTouched||tn(t.touchedFields,G),Q.keepDirty||(tn(t.dirtyFields,G),t.isDirty=Q.defaultValue?P(G,un(Le(r,G))):P()),Q.keepError||(tn(t.errors,G),h.isValid&&g()),m.state.next({...t}))},K=(G,Q={})=>{const ie=G?un(G):r,ve=un(ie),we=Cr(G),je=we?r:ve;if(Q.keepDefaultValues||(r=ie),!Q.keepValues){if(Q.keepDirtyValues){const Ye=new Set([...l.mount,...Object.keys(zm(r,a))]);for(const Ft of Array.from(Ye))Le(t.dirtyFields,Ft)?Xt(je,Ft,Le(a,Ft)):I(Ft,Le(je,Ft))}else{if(dM&&qs(G))for(const Ye of l.mount){const Ft=Le(n,Ye);if(Ft&&Ft._f){const Wt=Array.isArray(Ft._f.refs)?Ft._f.refs[0]:Ft._f.ref;if(mS(Wt)){const vn=Wt.closest("form");if(vn){vn.reset();break}}}}if(Q.keepFieldsRef)for(const Ye of l.mount)I(Ye,Le(je,Ye));else n={}}a=e.shouldUnregister?Q.keepDefaultValues?un(r):{}:un(je),m.array.next({values:{...je}}),m.state.next({values:{...je}})}l={mount:Q.keepDirtyValues?l.mount:new Set,unMount:new Set,array:new Set,disabled:new Set,watch:new Set,watchAll:!1,focus:""},o.mount=!h.isValid||!!Q.keepIsValid||!!Q.keepDirtyValues||!e.shouldUnregister&&!Cr(je),o.watch=!!e.shouldUnregister,m.state.next({submitCount:Q.keepSubmitCount?t.submitCount:0,isDirty:we?!1:Q.keepDirty?t.isDirty:!!(Q.keepDefaultValues&&!uo(G,r)),isSubmitted:Q.keepIsSubmitted?t.isSubmitted:!1,dirtyFields:we?{}:Q.keepDirtyValues?Q.keepDefaultValues&&a?zm(r,a):t.dirtyFields:Q.keepDefaultValues&&G?zm(r,G):Q.keepDirty?t.dirtyFields:{},touchedFields:Q.keepTouched?t.touchedFields:{},errors:Q.keepErrors?t.errors:{},isSubmitSuccessful:Q.keepIsSubmitSuccessful?t.isSubmitSuccessful:!1,isSubmitting:!1,defaultValues:r})},be=(G,Q)=>K(ho(G)?G(a):G,Q),Me=(G,Q={})=>{const ie=Le(n,G),ve=ie&&ie._f;if(ve){const we=ve.refs?ve.refs[0]:ve.ref;we.focus&&(we.focus(),Q.shouldSelect&&ho(we.select)&&we.select())}},De=G=>{t={...t,...G}},et={control:{register:ae,unregister:H,getFieldState:ee,handleSubmit:te,setError:z,_subscribe:de,_runSchema:k,_focusError:ce,_getWatch:T,_getDirty:P,_setValid:g,_setFieldArray:v,_setDisabledField:Y,_setErrors:w,_getFieldArray:B,_reset:K,_resetDefaultValues:()=>ho(e.defaultValues)&&e.defaultValues().then(G=>{be(G,e.resetOptions),m.state.next({isLoading:!1})}),_removeUnmounted:D,_disableForm:Ue,_subjects:m,_proxyFormState:h,get _fields(){return n},get _formValues(){return a},get _state(){return o},set _state(G){o=G},get _defaultValues(){return r},get _names(){return l},set _names(G){l=G},get _formState(){return t},get _options(){return e},set _options(G){e={...e,...G}}},subscribe:ne,trigger:$,register:ae,handleSubmit:te,watch:se,setValue:I,getValues:W,reset:be,resetField:J,clearErrors:Z,unregister:H,setError:z,setFocus:Me,getFieldState:ee};return{...et,formControl:et}}function kl(s={}){const e=V.useRef(void 0),t=V.useRef(void 0),[n,r]=V.useState({isDirty:!1,isValidating:!1,isLoading:ho(s.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:s.errors||{},disabled:s.disabled||!1,isReady:!1,defaultValues:ho(s.defaultValues)?void 0:s.defaultValues});if(!e.current)if(s.formControl)e.current={...s.formControl,formState:n},s.defaultValues&&!ho(s.defaultValues)&&s.formControl.reset(s.defaultValues,s.resetOptions);else{const{formControl:o,...l}=ire(s);e.current={...l,formState:n}}const a=e.current.control;return a._options=s,mM(()=>{const o=a._subscribe({formState:a._proxyFormState,callback:()=>r({...a._formState}),reRenderRoot:!0});return r(l=>({...l,isReady:!0})),a._formState.isReady=!0,o},[a]),V.useEffect(()=>a._disableForm(s.disabled),[a,s.disabled]),V.useEffect(()=>{s.mode&&(a._options.mode=s.mode),s.reValidateMode&&(a._options.reValidateMode=s.reValidateMode)},[a,s.mode,s.reValidateMode]),V.useEffect(()=>{s.errors&&(a._setErrors(s.errors),a._focusError())},[a,s.errors]),V.useEffect(()=>{s.shouldUnregister&&a._subjects.state.next({values:a._getWatch()})},[a,s.shouldUnregister]),V.useEffect(()=>{if(a._proxyFormState.isDirty){const o=a._getDirty();o!==n.isDirty&&a._subjects.state.next({isDirty:o})}},[a,n.isDirty]),V.useEffect(()=>{var o;s.values&&!uo(s.values,t.current)?(a._reset(s.values,{keepFieldsRef:!0,...a._options.resetOptions}),!((o=a._options.resetOptions)===null||o===void 0)&&o.keepIsValid||a._setValid(),t.current=s.values,r(l=>({...l}))):a._resetDefaultValues()},[a,s.values]),V.useEffect(()=>{a._state.mount||(a._setValid(),a._state.mount=!0),a._state.watch&&(a._state.watch=!1,a._subjects.state.next({...a._formState})),a._removeUnmounted()}),e.current.formState=D$(n,a),e.current}const wL=(s,e,t)=>{if(s&&"reportValidity"in s){const n=Le(t,e);s.setCustomValidity(n&&n.message||""),s.reportValidity()}},V$=(s,e)=>{for(const t in e.fields){const n=e.fields[t];n&&n.ref&&"reportValidity"in n.ref?wL(n.ref,t,s):n.refs&&n.refs.forEach(r=>wL(r,t,s))}},are=(s,e)=>{e.shouldUseNativeValidation&&V$(s,e);const t={};for(const n in s){const r=Le(e.fields,n),a=Object.assign(s[n]||{},{ref:r&&r.ref});if(ore(e.names||Object.keys(s),n)){const o=Object.assign({},Le(t,n));Xt(o,"root",a),Xt(t,n,o)}else Xt(t,n,a)}return t},ore=(s,e)=>s.some(t=>t.startsWith(e+"."));var lre=function(s,e){for(var t={};s.length;){var n=s[0],r=n.code,a=n.message,o=n.path.join(".");if(!t[o])if("unionErrors"in n){var l=n.unionErrors[0].errors[0];t[o]={message:l.message,type:l.code}}else t[o]={message:a,type:r};if("unionErrors"in n&&n.unionErrors.forEach(function(h){return h.errors.forEach(function(f){return s.push(f)})}),e){var c=t[o].types,d=c&&c[n.code];t[o]=O$(o,e,t,r,d?[].concat(d,n.message):n.message)}s.shift()}return t},Nl=function(s,e,t){return t===void 0&&(t={}),function(n,r,a){try{return Promise.resolve(function(o,l){try{var c=Promise.resolve(s[t.mode==="sync"?"parse":"parseAsync"](n,e)).then(function(d){return a.shouldUseNativeValidation&&V$({},a),{errors:{},values:t.raw?n:d}})}catch(d){return l(d)}return c&&c.then?c.then(void 0,l):c}(0,function(o){if(function(l){return Array.isArray(l==null?void 0:l.errors)}(o))return{values:{},errors:are(lre(o.errors,!a.shouldUseNativeValidation&&a.criteriaMode==="all"),a)};throw o}))}catch(o){return Promise.reject(o)}}};function cre(s){if(typeof document>"u")return;let e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.type="text/css",e.appendChild(t),t.styleSheet?t.styleSheet.cssText=s:t.appendChild(document.createTextNode(s))}const dre=s=>{switch(s){case"success":return fre;case"info":return pre;case"warning":return mre;case"error":return gre;default:return null}},ure=Array(12).fill(0),hre=({visible:s,className:e})=>V.createElement("div",{className:["sonner-loading-wrapper",e].filter(Boolean).join(" "),"data-visible":s},V.createElement("div",{className:"sonner-spinner"},ure.map((t,n)=>V.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${n}`})))),fre=V.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},V.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),mre=V.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},V.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),pre=V.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},V.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),gre=V.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},V.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),xre=V.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},V.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),V.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),yre=()=>{const[s,e]=V.useState(document.hidden);return V.useEffect(()=>{const t=()=>{e(document.hidden)};return document.addEventListener("visibilitychange",t),()=>window.removeEventListener("visibilitychange",t)},[]),s};let aT=1;class vre{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{const t=this.subscribers.indexOf(e);this.subscribers.splice(t,1)}),this.publish=e=>{this.subscribers.forEach(t=>t(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var t;const{message:n,...r}=e,a=typeof(e==null?void 0:e.id)=="number"||((t=e.id)==null?void 0:t.length)>0?e.id:aT++,o=this.toasts.find(c=>c.id===a),l=e.dismissible===void 0?!0:e.dismissible;return this.dismissedToasts.has(a)&&this.dismissedToasts.delete(a),o?this.toasts=this.toasts.map(c=>c.id===a?(this.publish({...c,...e,id:a,title:n}),{...c,...e,id:a,dismissible:l,title:n}):c):this.addToast({title:n,...r,dismissible:l,id:a}),a},this.dismiss=e=>(e?(this.dismissedToasts.add(e),requestAnimationFrame(()=>this.subscribers.forEach(t=>t({id:e,dismiss:!0})))):this.toasts.forEach(t=>{this.subscribers.forEach(n=>n({id:t.id,dismiss:!0}))}),e),this.message=(e,t)=>this.create({...t,message:e}),this.error=(e,t)=>this.create({...t,message:e,type:"error"}),this.success=(e,t)=>this.create({...t,type:"success",message:e}),this.info=(e,t)=>this.create({...t,type:"info",message:e}),this.warning=(e,t)=>this.create({...t,type:"warning",message:e}),this.loading=(e,t)=>this.create({...t,type:"loading",message:e}),this.promise=(e,t)=>{if(!t)return;let n;t.loading!==void 0&&(n=this.create({...t,promise:e,type:"loading",message:t.loading,description:typeof t.description!="function"?t.description:void 0}));const r=Promise.resolve(e instanceof Function?e():e);let a=n!==void 0,o;const l=r.then(async d=>{if(o=["resolve",d],V.isValidElement(d))a=!1,this.create({id:n,type:"default",message:d});else if(wre(d)&&!d.ok){a=!1;const f=typeof t.error=="function"?await t.error(`HTTP error! status: ${d.status}`):t.error,m=typeof t.description=="function"?await t.description(`HTTP error! status: ${d.status}`):t.description,x=typeof f=="object"&&!V.isValidElement(f)?f:{message:f};this.create({id:n,type:"error",description:m,...x})}else if(d instanceof Error){a=!1;const f=typeof t.error=="function"?await t.error(d):t.error,m=typeof t.description=="function"?await t.description(d):t.description,x=typeof f=="object"&&!V.isValidElement(f)?f:{message:f};this.create({id:n,type:"error",description:m,...x})}else if(t.success!==void 0){a=!1;const f=typeof t.success=="function"?await t.success(d):t.success,m=typeof t.description=="function"?await t.description(d):t.description,x=typeof f=="object"&&!V.isValidElement(f)?f:{message:f};this.create({id:n,type:"success",description:m,...x})}}).catch(async d=>{if(o=["reject",d],t.error!==void 0){a=!1;const h=typeof t.error=="function"?await t.error(d):t.error,f=typeof t.description=="function"?await t.description(d):t.description,p=typeof h=="object"&&!V.isValidElement(h)?h:{message:h};this.create({id:n,type:"error",description:f,...p})}}).finally(()=>{a&&(this.dismiss(n),n=void 0),t.finally==null||t.finally.call(t)}),c=()=>new Promise((d,h)=>l.then(()=>o[0]==="reject"?h(o[1]):d(o[1])).catch(h));return typeof n!="string"&&typeof n!="number"?{unwrap:c}:Object.assign(n,{unwrap:c})},this.custom=(e,t)=>{const n=(t==null?void 0:t.id)||aT++;return this.create({jsx:e(n),id:n,...t}),n},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}}const Jr=new vre,bre=(s,e)=>{const t=(e==null?void 0:e.id)||aT++;return Jr.addToast({title:s,...e,id:t}),t},wre=s=>s&&typeof s=="object"&&"ok"in s&&typeof s.ok=="boolean"&&"status"in s&&typeof s.status=="number",Cre=bre,Sre=()=>Jr.toasts,jre=()=>Jr.getActiveToasts(),rt=Object.assign(Cre,{success:Jr.success,info:Jr.info,warning:Jr.warning,error:Jr.error,custom:Jr.custom,message:Jr.message,promise:Jr.promise,dismiss:Jr.dismiss,loading:Jr.loading},{getHistory:Sre,getToasts:jre});cre("[data-sonner-toaster][dir=ltr],html[dir=ltr]{--toast-icon-margin-start:-3px;--toast-icon-margin-end:4px;--toast-svg-margin-start:-1px;--toast-svg-margin-end:0px;--toast-button-margin-start:auto;--toast-button-margin-end:0;--toast-close-button-start:0;--toast-close-button-end:unset;--toast-close-button-transform:translate(-35%, -35%)}[data-sonner-toaster][dir=rtl],html[dir=rtl]{--toast-icon-margin-start:4px;--toast-icon-margin-end:-3px;--toast-svg-margin-start:0px;--toast-svg-margin-end:-1px;--toast-button-margin-start:0;--toast-button-margin-end:auto;--toast-close-button-start:unset;--toast-close-button-end:0;--toast-close-button-transform:translate(35%, -35%)}[data-sonner-toaster]{position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1:hsl(0, 0%, 99%);--gray2:hsl(0, 0%, 97.3%);--gray3:hsl(0, 0%, 95.1%);--gray4:hsl(0, 0%, 93%);--gray5:hsl(0, 0%, 90.9%);--gray6:hsl(0, 0%, 88.7%);--gray7:hsl(0, 0%, 85.8%);--gray8:hsl(0, 0%, 78%);--gray9:hsl(0, 0%, 56.1%);--gray10:hsl(0, 0%, 52.3%);--gray11:hsl(0, 0%, 43.5%);--gray12:hsl(0, 0%, 9%);--border-radius:8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:0;z-index:999999999;transition:transform .4s ease}@media (hover:none) and (pointer:coarse){[data-sonner-toaster][data-lifted=true]{transform:none}}[data-sonner-toaster][data-x-position=right]{right:var(--offset-right)}[data-sonner-toaster][data-x-position=left]{left:var(--offset-left)}[data-sonner-toaster][data-x-position=center]{left:50%;transform:translateX(-50%)}[data-sonner-toaster][data-y-position=top]{top:var(--offset-top)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--offset-bottom)}[data-sonner-toast]{--y:translateY(100%);--lift-amount:calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:0;overflow-wrap:anywhere}[data-sonner-toast][data-styled=true]{padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px rgba(0,0,0,.1);width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}[data-sonner-toast]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-y-position=top]{top:0;--y:translateY(-100%);--lift:1;--lift-amount:calc(1 * var(--gap))}[data-sonner-toast][data-y-position=bottom]{bottom:0;--y:translateY(100%);--lift:-1;--lift-amount:calc(var(--lift) * var(--gap))}[data-sonner-toast][data-styled=true] [data-description]{font-weight:400;line-height:1.4;color:#3f3f3f}[data-rich-colors=true][data-sonner-toast][data-styled=true] [data-description]{color:inherit}[data-sonner-toaster][data-sonner-theme=dark] [data-description]{color:#e8e8e8}[data-sonner-toast][data-styled=true] [data-title]{font-weight:500;line-height:1.5;color:inherit}[data-sonner-toast][data-styled=true] [data-icon]{display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}[data-sonner-toast][data-promise=true] [data-icon]>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}[data-sonner-toast][data-styled=true] [data-icon]>*{flex-shrink:0}[data-sonner-toast][data-styled=true] [data-icon] svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}[data-sonner-toast][data-styled=true] [data-content]{display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;font-weight:500;cursor:pointer;outline:0;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}[data-sonner-toast][data-styled=true] [data-button]:focus-visible{box-shadow:0 0 0 2px rgba(0,0,0,.4)}[data-sonner-toast][data-styled=true] [data-button]:first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}[data-sonner-toast][data-styled=true] [data-cancel]{color:var(--normal-text);background:rgba(0,0,0,.08)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-styled=true] [data-cancel]{background:rgba(255,255,255,.3)}[data-sonner-toast][data-styled=true] [data-close-button]{position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);background:var(--normal-bg);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast][data-styled=true] [data-close-button]:focus-visible{box-shadow:0 4px 12px rgba(0,0,0,.1),0 0 0 2px rgba(0,0,0,.2)}[data-sonner-toast][data-styled=true] [data-disabled=true]{cursor:not-allowed}[data-sonner-toast][data-styled=true]:hover [data-close-button]:hover{background:var(--gray2);border-color:var(--gray5)}[data-sonner-toast][data-swiping=true]::before{content:'';position:absolute;left:-100%;right:-100%;height:100%;z-index:-1}[data-sonner-toast][data-y-position=top][data-swiping=true]::before{bottom:50%;transform:scaleY(3) translateY(50%)}[data-sonner-toast][data-y-position=bottom][data-swiping=true]::before{top:50%;transform:scaleY(3) translateY(-50%)}[data-sonner-toast][data-swiping=false][data-removed=true]::before{content:'';position:absolute;inset:0;transform:scaleY(2)}[data-sonner-toast][data-expanded=true]::after{content:'';position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}[data-sonner-toast][data-mounted=true]{--y:translateY(0);opacity:1}[data-sonner-toast][data-expanded=false][data-front=false]{--scale:var(--toasts-before) * 0.05 + 1;--y:translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}[data-sonner-toast]>*{transition:opacity .4s}[data-sonner-toast][data-x-position=right]{right:0}[data-sonner-toast][data-x-position=left]{left:0}[data-sonner-toast][data-expanded=false][data-front=false][data-styled=true]>*{opacity:0}[data-sonner-toast][data-visible=false]{opacity:0;pointer-events:none}[data-sonner-toast][data-mounted=true][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}[data-sonner-toast][data-removed=true][data-front=true][data-swipe-out=false]{--y:translateY(calc(var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=true]{--y:translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}[data-sonner-toast][data-removed=true][data-front=false][data-swipe-out=false][data-expanded=false]{--y:translateY(40%);opacity:0;transition:transform .5s,opacity .2s}[data-sonner-toast][data-removed=true][data-front=false]::before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y,0)) translateX(var(--swipe-amount-x,0));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{from{transform:var(--y) translateX(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translateX(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{from{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width:600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-sonner-theme=light]{--normal-bg:#fff;--normal-border:var(--gray4);--normal-text:var(--gray12);--success-bg:hsl(143, 85%, 96%);--success-border:hsl(145, 92%, 87%);--success-text:hsl(140, 100%, 27%);--info-bg:hsl(208, 100%, 97%);--info-border:hsl(221, 91%, 93%);--info-text:hsl(210, 92%, 45%);--warning-bg:hsl(49, 100%, 97%);--warning-border:hsl(49, 91%, 84%);--warning-text:hsl(31, 92%, 45%);--error-bg:hsl(359, 100%, 97%);--error-border:hsl(359, 100%, 94%);--error-text:hsl(360, 100%, 45%)}[data-sonner-toaster][data-sonner-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg:#000;--normal-border:hsl(0, 0%, 20%);--normal-text:var(--gray1)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg:#fff;--normal-border:var(--gray3);--normal-text:var(--gray12)}[data-sonner-toaster][data-sonner-theme=dark]{--normal-bg:#000;--normal-bg-hover:hsl(0, 0%, 12%);--normal-border:hsl(0, 0%, 20%);--normal-border-hover:hsl(0, 0%, 25%);--normal-text:var(--gray1);--success-bg:hsl(150, 100%, 6%);--success-border:hsl(147, 100%, 12%);--success-text:hsl(150, 86%, 65%);--info-bg:hsl(215, 100%, 6%);--info-border:hsl(223, 43%, 17%);--info-text:hsl(216, 87%, 65%);--warning-bg:hsl(64, 100%, 6%);--warning-border:hsl(60, 100%, 9%);--warning-text:hsl(46, 87%, 65%);--error-bg:hsl(358, 76%, 10%);--error-border:hsl(357, 89%, 16%);--error-text:hsl(358, 100%, 81%)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-sonner-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size:16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:first-child{animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}100%{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}100%{opacity:.15}}@media (prefers-reduced-motion){.sonner-loading-bar,[data-sonner-toast],[data-sonner-toast]>*{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}");function t1(s){return s.label!==void 0}const kre=3,Nre="24px",Are="16px",CL=4e3,_re=356,Tre=14,Ere=45,Pre=200;function Po(...s){return s.filter(Boolean).join(" ")}function Mre(s){const[e,t]=s.split("-"),n=[];return e&&n.push(e),t&&n.push(t),n}const Ire=s=>{var e,t,n,r,a,o,l,c,d;const{invert:h,toast:f,unstyled:m,interacting:p,setHeights:x,visibleToasts:g,heights:b,index:v,toasts:y,expanded:w,removeToast:S,defaultRichColors:j,closeButton:A,style:k,cancelButtonStyle:_,actionButtonStyle:L,className:D="",descriptionClassName:P="",duration:T,position:B,gap:R,expandByDefault:O,classNames:I,icons:U,closeButtonAriaLabel:M="Close toast"}=s,[$,W]=V.useState(null),[ee,Z]=V.useState(null),[z,se]=V.useState(!1),[de,ne]=V.useState(!1),[H,Y]=V.useState(!1),[ae,ce]=V.useState(!1),[Ue,te]=V.useState(!1),[J,K]=V.useState(0),[be,Me]=V.useState(0),De=V.useRef(f.duration||T||CL),_t=V.useRef(null),et=V.useRef(null),G=v===0,Q=v+1<=g,ie=f.type,ve=f.dismissible!==!1,we=f.className||"",je=f.descriptionClassName||"",Ye=V.useMemo(()=>b.findIndex(ct=>ct.toastId===f.id)||0,[b,f.id]),Ft=V.useMemo(()=>{var ct;return(ct=f.closeButton)!=null?ct:A},[f.closeButton,A]),Wt=V.useMemo(()=>f.duration||T||CL,[f.duration,T]),vn=V.useRef(0),Ur=V.useRef(0),zr=V.useRef(0),xe=V.useRef(null),[Ke,tt]=B.split("-"),lt=V.useMemo(()=>b.reduce((ct,Ks,Rn)=>Rn>=Ye?ct:ct+Ks.height,0),[b,Ye]),St=yre(),gs=f.invert||h,Dt=ie==="loading";Ur.current=V.useMemo(()=>Ye*R+lt,[Ye,lt]),V.useEffect(()=>{De.current=Wt},[Wt]),V.useEffect(()=>{se(!0)},[]),V.useEffect(()=>{const ct=et.current;if(ct){const Ks=ct.getBoundingClientRect().height;return Me(Ks),x(Rn=>[{toastId:f.id,height:Ks,position:f.position},...Rn]),()=>x(Rn=>Rn.filter(cn=>cn.toastId!==f.id))}},[x,f.id]),V.useLayoutEffect(()=>{if(!z)return;const ct=et.current,Ks=ct.style.height;ct.style.height="auto";const Rn=ct.getBoundingClientRect().height;ct.style.height=Ks,Me(Rn),x(cn=>cn.find(ks=>ks.toastId===f.id)?cn.map(ks=>ks.toastId===f.id?{...ks,height:Rn}:ks):[{toastId:f.id,height:Rn,position:f.position},...cn])},[z,f.title,f.description,x,f.id,f.jsx,f.action,f.cancel]);const it=V.useCallback(()=>{ne(!0),K(Ur.current),x(ct=>ct.filter(Ks=>Ks.toastId!==f.id)),setTimeout(()=>{S(f)},Pre)},[f,S,x,Ur]);V.useEffect(()=>{if(f.promise&&ie==="loading"||f.duration===1/0||f.type==="loading")return;let ct;return w||p||St?(()=>{if(zr.current<vn.current){const cn=new Date().getTime()-vn.current;De.current=De.current-cn}zr.current=new Date().getTime()})():(()=>{De.current!==1/0&&(vn.current=new Date().getTime(),ct=setTimeout(()=>{f.onAutoClose==null||f.onAutoClose.call(f,f),it()},De.current))})(),()=>clearTimeout(ct)},[w,p,f,ie,St,it]),V.useEffect(()=>{f.delete&&(it(),f.onDismiss==null||f.onDismiss.call(f,f))},[it,f.delete]);function Ys(){var ct;if(U!=null&&U.loading){var Ks;return V.createElement("div",{className:Po(I==null?void 0:I.loader,f==null||(Ks=f.classNames)==null?void 0:Ks.loader,"sonner-loader"),"data-visible":ie==="loading"},U.loading)}return V.createElement(hre,{className:Po(I==null?void 0:I.loader,f==null||(ct=f.classNames)==null?void 0:ct.loader),visible:ie==="loading"})}const Zn=f.icon||(U==null?void 0:U[ie])||dre(ie);var Yc,eh;return V.createElement("li",{tabIndex:0,ref:et,className:Po(D,we,I==null?void 0:I.toast,f==null||(e=f.classNames)==null?void 0:e.toast,I==null?void 0:I.default,I==null?void 0:I[ie],f==null||(t=f.classNames)==null?void 0:t[ie]),"data-sonner-toast":"","data-rich-colors":(Yc=f.richColors)!=null?Yc:j,"data-styled":!(f.jsx||f.unstyled||m),"data-mounted":z,"data-promise":!!f.promise,"data-swiped":Ue,"data-removed":de,"data-visible":Q,"data-y-position":Ke,"data-x-position":tt,"data-index":v,"data-front":G,"data-swiping":H,"data-dismissible":ve,"data-type":ie,"data-invert":gs,"data-swipe-out":ae,"data-swipe-direction":ee,"data-expanded":!!(w||O&&z),"data-testid":f.testId,style:{"--index":v,"--toasts-before":v,"--z-index":y.length-v,"--offset":`${de?J:Ur.current}px`,"--initial-height":O?"auto":`${be}px`,...k,...f.style},onDragEnd:()=>{Y(!1),W(null),xe.current=null},onPointerDown:ct=>{ct.button!==2&&(Dt||!ve||(_t.current=new Date,K(Ur.current),ct.target.setPointerCapture(ct.pointerId),ct.target.tagName!=="BUTTON"&&(Y(!0),xe.current={x:ct.clientX,y:ct.clientY})))},onPointerUp:()=>{var ct,Ks,Rn;if(ae||!ve)return;xe.current=null;const cn=Number(((ct=et.current)==null?void 0:ct.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),dn=Number(((Ks=et.current)==null?void 0:Ks.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),ks=new Date().getTime()-((Rn=_t.current)==null?void 0:Rn.getTime()),Hr=$==="x"?cn:dn,th=Math.abs(Hr)/ks;if(Math.abs(Hr)>=Ere||th>.11){K(Ur.current),f.onDismiss==null||f.onDismiss.call(f,f),Z($==="x"?cn>0?"right":"left":dn>0?"down":"up"),it(),ce(!0);return}else{var Ba,$a;(Ba=et.current)==null||Ba.style.setProperty("--swipe-amount-x","0px"),($a=et.current)==null||$a.style.setProperty("--swipe-amount-y","0px")}te(!1),Y(!1),W(null)},onPointerMove:ct=>{var Ks,Rn,cn;if(!xe.current||!ve||((Ks=window.getSelection())==null?void 0:Ks.toString().length)>0)return;const ks=ct.clientY-xe.current.y,Hr=ct.clientX-xe.current.x;var th;const Ba=(th=s.swipeDirections)!=null?th:Mre(B);!$&&(Math.abs(Hr)>1||Math.abs(ks)>1)&&W(Math.abs(Hr)>Math.abs(ks)?"x":"y");let $a={x:0,y:0};const cI=sh=>1/(1.5+Math.abs(sh)/20);if($==="y"){if(Ba.includes("top")||Ba.includes("bottom"))if(Ba.includes("top")&&ks<0||Ba.includes("bottom")&&ks>0)$a.y=ks;else{const sh=ks*cI(ks);$a.y=Math.abs(sh)<Math.abs(ks)?sh:ks}}else if($==="x"&&(Ba.includes("left")||Ba.includes("right")))if(Ba.includes("left")&&Hr<0||Ba.includes("right")&&Hr>0)$a.x=Hr;else{const sh=Hr*cI(Hr);$a.x=Math.abs(sh)<Math.abs(Hr)?sh:Hr}(Math.abs($a.x)>0||Math.abs($a.y)>0)&&te(!0),(Rn=et.current)==null||Rn.style.setProperty("--swipe-amount-x",`${$a.x}px`),(cn=et.current)==null||cn.style.setProperty("--swipe-amount-y",`${$a.y}px`)}},Ft&&!f.jsx&&ie!=="loading"?V.createElement("button",{"aria-label":M,"data-disabled":Dt,"data-close-button":!0,onClick:Dt||!ve?()=>{}:()=>{it(),f.onDismiss==null||f.onDismiss.call(f,f)},className:Po(I==null?void 0:I.closeButton,f==null||(n=f.classNames)==null?void 0:n.closeButton)},(eh=U==null?void 0:U.close)!=null?eh:xre):null,(ie||f.icon||f.promise)&&f.icon!==null&&((U==null?void 0:U[ie])!==null||f.icon)?V.createElement("div",{"data-icon":"",className:Po(I==null?void 0:I.icon,f==null||(r=f.classNames)==null?void 0:r.icon)},f.promise||f.type==="loading"&&!f.icon?f.icon||Ys():null,f.type!=="loading"?Zn:null):null,V.createElement("div",{"data-content":"",className:Po(I==null?void 0:I.content,f==null||(a=f.classNames)==null?void 0:a.content)},V.createElement("div",{"data-title":"",className:Po(I==null?void 0:I.title,f==null||(o=f.classNames)==null?void 0:o.title)},f.jsx?f.jsx:typeof f.title=="function"?f.title():f.title),f.description?V.createElement("div",{"data-description":"",className:Po(P,je,I==null?void 0:I.description,f==null||(l=f.classNames)==null?void 0:l.description)},typeof f.description=="function"?f.description():f.description):null),V.isValidElement(f.cancel)?f.cancel:f.cancel&&t1(f.cancel)?V.createElement("button",{"data-button":!0,"data-cancel":!0,style:f.cancelButtonStyle||_,onClick:ct=>{t1(f.cancel)&&ve&&(f.cancel.onClick==null||f.cancel.onClick.call(f.cancel,ct),it())},className:Po(I==null?void 0:I.cancelButton,f==null||(c=f.classNames)==null?void 0:c.cancelButton)},f.cancel.label):null,V.isValidElement(f.action)?f.action:f.action&&t1(f.action)?V.createElement("button",{"data-button":!0,"data-action":!0,style:f.actionButtonStyle||L,onClick:ct=>{t1(f.action)&&(f.action.onClick==null||f.action.onClick.call(f.action,ct),!ct.defaultPrevented&&it())},className:Po(I==null?void 0:I.actionButton,f==null||(d=f.classNames)==null?void 0:d.actionButton)},f.action.label):null)};function SL(){if(typeof window>"u"||typeof document>"u")return"ltr";const s=document.documentElement.getAttribute("dir");return s==="auto"||!s?window.getComputedStyle(document.documentElement).direction:s}function Rre(s,e){const t={};return[s,e].forEach((n,r)=>{const a=r===1,o=a?"--mobile-offset":"--offset",l=a?Are:Nre;function c(d){["top","right","bottom","left"].forEach(h=>{t[`${o}-${h}`]=typeof d=="number"?`${d}px`:d})}typeof n=="number"||typeof n=="string"?c(n):typeof n=="object"?["top","right","bottom","left"].forEach(d=>{n[d]===void 0?t[`${o}-${d}`]=l:t[`${o}-${d}`]=typeof n[d]=="number"?`${n[d]}px`:n[d]}):c(l)}),t}const Dre=V.forwardRef(function(e,t){const{id:n,invert:r,position:a="bottom-right",hotkey:o=["altKey","KeyT"],expand:l,closeButton:c,className:d,offset:h,mobileOffset:f,theme:m="light",richColors:p,duration:x,style:g,visibleToasts:b=kre,toastOptions:v,dir:y=SL(),gap:w=Tre,icons:S,containerAriaLabel:j="Notifications"}=e,[A,k]=V.useState([]),_=V.useMemo(()=>n?A.filter(z=>z.toasterId===n):A.filter(z=>!z.toasterId),[A,n]),L=V.useMemo(()=>Array.from(new Set([a].concat(_.filter(z=>z.position).map(z=>z.position)))),[_,a]),[D,P]=V.useState([]),[T,B]=V.useState(!1),[R,O]=V.useState(!1),[I,U]=V.useState(m!=="system"?m:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),M=V.useRef(null),$=o.join("+").replace(/Key/g,"").replace(/Digit/g,""),W=V.useRef(null),ee=V.useRef(!1),Z=V.useCallback(z=>{k(se=>{var de;return(de=se.find(ne=>ne.id===z.id))!=null&&de.delete||Jr.dismiss(z.id),se.filter(({id:ne})=>ne!==z.id)})},[]);return V.useEffect(()=>Jr.subscribe(z=>{if(z.dismiss){requestAnimationFrame(()=>{k(se=>se.map(de=>de.id===z.id?{...de,delete:!0}:de))});return}setTimeout(()=>{w3.flushSync(()=>{k(se=>{const de=se.findIndex(ne=>ne.id===z.id);return de!==-1?[...se.slice(0,de),{...se[de],...z},...se.slice(de+1)]:[z,...se]})})})}),[A]),V.useEffect(()=>{if(m!=="system"){U(m);return}if(m==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?U("dark"):U("light")),typeof window>"u")return;const z=window.matchMedia("(prefers-color-scheme: dark)");try{z.addEventListener("change",({matches:se})=>{U(se?"dark":"light")})}catch{z.addListener(({matches:de})=>{try{U(de?"dark":"light")}catch(ne){console.error(ne)}})}},[m]),V.useEffect(()=>{A.length<=1&&B(!1)},[A]),V.useEffect(()=>{const z=se=>{var de;if(o.every(Y=>se[Y]||se.code===Y)){var H;B(!0),(H=M.current)==null||H.focus()}se.code==="Escape"&&(document.activeElement===M.current||(de=M.current)!=null&&de.contains(document.activeElement))&&B(!1)};return document.addEventListener("keydown",z),()=>document.removeEventListener("keydown",z)},[o]),V.useEffect(()=>{if(M.current)return()=>{W.current&&(W.current.focus({preventScroll:!0}),W.current=null,ee.current=!1)}},[M.current]),V.createElement("section",{ref:t,"aria-label":`${j} ${$}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},L.map((z,se)=>{var de;const[ne,H]=z.split("-");return _.length?V.createElement("ol",{key:z,dir:y==="auto"?SL():y,tabIndex:-1,ref:M,className:d,"data-sonner-toaster":!0,"data-sonner-theme":I,"data-y-position":ne,"data-x-position":H,style:{"--front-toast-height":`${((de=D[0])==null?void 0:de.height)||0}px`,"--width":`${_re}px`,"--gap":`${w}px`,...g,...Rre(h,f)},onBlur:Y=>{ee.current&&!Y.currentTarget.contains(Y.relatedTarget)&&(ee.current=!1,W.current&&(W.current.focus({preventScroll:!0}),W.current=null))},onFocus:Y=>{Y.target instanceof HTMLElement&&Y.target.dataset.dismissible==="false"||ee.current||(ee.current=!0,W.current=Y.relatedTarget)},onMouseEnter:()=>B(!0),onMouseMove:()=>B(!0),onMouseLeave:()=>{R||B(!1)},onDragEnd:()=>B(!1),onPointerDown:Y=>{Y.target instanceof HTMLElement&&Y.target.dataset.dismissible==="false"||O(!0)},onPointerUp:()=>O(!1)},_.filter(Y=>!Y.position&&se===0||Y.position===z).map((Y,ae)=>{var ce,Ue;return V.createElement(Ire,{key:Y.id,icons:S,index:ae,toast:Y,defaultRichColors:p,duration:(ce=v==null?void 0:v.duration)!=null?ce:x,className:v==null?void 0:v.className,descriptionClassName:v==null?void 0:v.descriptionClassName,invert:r,visibleToasts:b,closeButton:(Ue=v==null?void 0:v.closeButton)!=null?Ue:c,interacting:R,position:z,style:v==null?void 0:v.style,unstyled:v==null?void 0:v.unstyled,classNames:v==null?void 0:v.classNames,cancelButtonStyle:v==null?void 0:v.cancelButtonStyle,actionButtonStyle:v==null?void 0:v.actionButtonStyle,closeButtonAriaLabel:v==null?void 0:v.closeButtonAriaLabel,removeToast:Z,toasts:_.filter(te=>te.position==Y.position),heights:D.filter(te=>te.position==Y.position),setHeights:P,expandByDefault:l,gap:w,expanded:T,swipeDirections:e.swipeDirections})})):null}))}),cs=B5,oT=$5,Lre=U5,W$=C.forwardRef(({className:s,...e},t)=>i.jsx(BP,{ref:t,className:Ee("fixed inset-0 z-50 bg-background/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...e}));W$.displayName=BP.displayName;const is=C.forwardRef(({className:s,children:e,...t},n)=>i.jsxs(Lre,{children:[i.jsx(W$,{}),i.jsxs($P,{ref:n,className:Ee("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...t,children:[e,i.jsxs(HP,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[i.jsx(Mr,{className:"h-4 w-4"}),i.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));is.displayName=$P.displayName;const Rs=({className:s,...e})=>i.jsx("div",{className:Ee("flex flex-col space-y-1.5 text-center sm:text-left",s),...e});Rs.displayName="DialogHeader";const Xn=({className:s,...e})=>i.jsx("div",{className:Ee("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...e});Xn.displayName="DialogFooter";const Ds=C.forwardRef(({className:s,...e},t)=>i.jsx(UP,{ref:t,className:Ee("text-lg font-semibold leading-none tracking-tight",s),...e}));Ds.displayName=UP.displayName;const Lr=C.forwardRef(({className:s,...e},t)=>i.jsx(zP,{ref:t,className:Ee("text-sm text-muted-foreground",s),...e}));Lr.displayName=zP.displayName;const _e=C.forwardRef(({className:s,type:e,...t},n)=>i.jsx("input",{type:e,className:Ee("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:n,...t}));_e.displayName="Input";const ps=C.forwardRef(({className:s,...e},t)=>i.jsx("textarea",{className:Ee("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:t,...e}));ps.displayName="Textarea";function gk(s){const e=C.useRef({value:s,previous:s});return C.useMemo(()=>(e.current.value!==s&&(e.current.previous=e.current.value,e.current.value=s),e.current.previous),[s])}function xk(s){const[e,t]=C.useState(void 0);return mr(()=>{if(s){t({width:s.offsetWidth,height:s.offsetHeight});const n=new ResizeObserver(r=>{if(!Array.isArray(r)||!r.length)return;const a=r[0];let o,l;if("borderBoxSize"in a){const c=a.borderBoxSize,d=Array.isArray(c)?c[0]:c;o=d.inlineSize,l=d.blockSize}else o=s.offsetWidth,l=s.offsetHeight;t({width:o,height:l})});return n.observe(s,{box:"border-box"}),()=>n.unobserve(s)}else t(void 0)},[s]),e}var yk="Switch",[Ore]=Oa(yk),[Fre,Bre]=Ore(yk),q$=C.forwardRef((s,e)=>{const{__scopeSwitch:t,name:n,checked:r,defaultChecked:a,required:o,disabled:l,value:c="on",onCheckedChange:d,form:h,...f}=s,[m,p]=C.useState(null),x=Tt(e,w=>p(w)),g=C.useRef(!1),b=m?h||!!m.closest("form"):!0,[v,y]=Lc({prop:r,defaultProp:a??!1,onChange:d,caller:yk});return i.jsxs(Fre,{scope:t,checked:v,disabled:l,children:[i.jsx(ot.button,{type:"button",role:"switch","aria-checked":v,"aria-required":o,"data-state":X$(v),"data-disabled":l?"":void 0,disabled:l,value:c,...f,ref:x,onClick:He(s.onClick,w=>{y(S=>!S),b&&(g.current=w.isPropagationStopped(),g.current||w.stopPropagation())})}),b&&i.jsx(K$,{control:m,bubbles:!g.current,name:n,value:c,checked:v,required:o,disabled:l,form:h,style:{transform:"translateX(-100%)"}})]})});q$.displayName=yk;var G$="SwitchThumb",Y$=C.forwardRef((s,e)=>{const{__scopeSwitch:t,...n}=s,r=Bre(G$,t);return i.jsx(ot.span,{"data-state":X$(r.checked),"data-disabled":r.disabled?"":void 0,...n,ref:e})});Y$.displayName=G$;var $re="SwitchBubbleInput",K$=C.forwardRef(({__scopeSwitch:s,control:e,checked:t,bubbles:n=!0,...r},a)=>{const o=C.useRef(null),l=Tt(o,a),c=gk(t),d=xk(e);return C.useEffect(()=>{const h=o.current;if(!h)return;const f=window.HTMLInputElement.prototype,p=Object.getOwnPropertyDescriptor(f,"checked").set;if(c!==t&&p){const x=new Event("click",{bubbles:n});p.call(h,t),h.dispatchEvent(x)}},[c,t,n]),i.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:t,...r,tabIndex:-1,ref:l,style:{...r.style,...d,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});K$.displayName=$re;function X$(s){return s?"checked":"unchecked"}var Q$=q$,Ure=Y$;const lT=C.forwardRef(({className:s,...e},t)=>i.jsx(Q$,{className:Ee("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s),...e,ref:t,children:i.jsx(Ure,{className:Ee("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));lT.displayName=Q$.displayName;var zre=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Hre=zre.reduce((s,e)=>{const t=WP(`Primitive.${e}`),n=C.forwardRef((r,a)=>{const{asChild:o,...l}=r,c=o?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),i.jsx(c,{...l,ref:a})});return n.displayName=`Primitive.${e}`,{...s,[e]:n}},{}),Vre="Label",Z$=C.forwardRef((s,e)=>i.jsx(Hre.label,{...s,ref:e,onMouseDown:t=>{var r;t.target.closest("button, input, select, textarea")||((r=s.onMouseDown)==null||r.call(s,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));Z$.displayName=Vre;var J$=Z$;const Wre=nk("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),st=C.forwardRef(({className:s,...e},t)=>i.jsx(J$,{ref:t,className:Ee(Wre(),s),...e}));st.displayName=J$.displayName;const Al=zne,e6=C.createContext({}),pe=({...s})=>i.jsx(e6.Provider,{value:{name:s.name},children:i.jsx(Wne,{...s})}),vk=()=>{const s=C.useContext(e6),e=C.useContext(t6),{getFieldState:t,formState:n}=pk(),r=t(s.name,n);if(!s)throw new Error("useFormField should be used within <FormField>");const{id:a}=e;return{id:a,name:s.name,formItemId:`${a}-form-item`,formDescriptionId:`${a}-form-item-description`,formMessageId:`${a}-form-item-message`,...r}},t6=C.createContext({}),fe=C.forwardRef(({className:s,...e},t)=>{const n=C.useId();return i.jsx(t6.Provider,{value:{id:n},children:i.jsx("div",{ref:t,className:Ee("space-y-2",s),...e})})});fe.displayName="FormItem";const me=C.forwardRef(({className:s,...e},t)=>{const{error:n,formItemId:r}=vk();return i.jsx(st,{ref:t,className:Ee(n&&"text-destructive",s),htmlFor:r,...e})});me.displayName="FormLabel";const ge=C.forwardRef(({...s},e)=>{const{error:t,formItemId:n,formDescriptionId:r,formMessageId:a}=vk();return i.jsx(p$,{ref:e,id:n,"aria-describedby":t?`${r} ${a}`:`${r}`,"aria-invalid":!!t,...s})});ge.displayName="FormControl";const nt=C.forwardRef(({className:s,...e},t)=>{const{formDescriptionId:n}=vk();return i.jsx("p",{ref:t,id:n,className:Ee("text-sm text-muted-foreground",s),...e})});nt.displayName="FormDescription";const ye=C.forwardRef(({className:s,children:e,...t},n)=>{const{error:r,formMessageId:a}=vk(),o=r?String(r==null?void 0:r.message):e;return o?i.jsx("p",{ref:n,id:a,className:Ee("text-sm font-medium text-destructive",s),...t,children:o}):null});ye.displayName="FormMessage";function jL(s){const e=qre(s),t=C.forwardRef((n,r)=>{const{children:a,...o}=n,l=C.Children.toArray(a),c=l.find(Yre);if(c){const d=c.props.children,h=l.map(f=>f===c?C.Children.count(d)>1?C.Children.only(null):C.isValidElement(d)?d.props.children:null:f);return i.jsx(e,{...o,ref:r,children:C.isValidElement(d)?C.cloneElement(d,void 0,h):null})}return i.jsx(e,{...o,ref:r,children:a})});return t.displayName=`${s}.Slot`,t}function qre(s){const e=C.forwardRef((t,n)=>{const{children:r,...a}=t;if(C.isValidElement(r)){const o=Xre(r),l=Kre(a,r.props);return r.type!==C.Fragment&&(l.ref=n?qc(n,o):o),C.cloneElement(r,l)}return C.Children.count(r)>1?C.Children.only(null):null});return e.displayName=`${s}.SlotClone`,e}var Gre=Symbol("radix.slottable");function Yre(s){return C.isValidElement(s)&&typeof s.type=="function"&&"__radixId"in s.type&&s.type.__radixId===Gre}function Kre(s,e){const t={...e};for(const n in e){const r=s[n],a=e[n];/^on[A-Z]/.test(n)?r&&a?t[n]=(...l)=>{const c=a(...l);return r(...l),c}:r&&(t[n]=r):n==="style"?t[n]={...r,...a}:n==="className"&&(t[n]=[r,a].filter(Boolean).join(" "))}return{...s,...t}}function Xre(s){var n,r;let e=(n=Object.getOwnPropertyDescriptor(s.props,"ref"))==null?void 0:n.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?s.ref:(e=(r=Object.getOwnPropertyDescriptor(s,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?s.props.ref:s.props.ref||s.ref)}function bk(s){const e=s+"CollectionProvider",[t,n]=Oa(e),[r,a]=t(e,{collectionRef:{current:null},itemMap:new Map}),o=g=>{const{scope:b,children:v}=g,y=V.useRef(null),w=V.useRef(new Map).current;return i.jsx(r,{scope:b,itemMap:w,collectionRef:y,children:v})};o.displayName=e;const l=s+"CollectionSlot",c=jL(l),d=V.forwardRef((g,b)=>{const{scope:v,children:y}=g,w=a(l,v),S=Tt(b,w.collectionRef);return i.jsx(c,{ref:S,children:y})});d.displayName=l;const h=s+"CollectionItemSlot",f="data-radix-collection-item",m=jL(h),p=V.forwardRef((g,b)=>{const{scope:v,children:y,...w}=g,S=V.useRef(null),j=Tt(b,S),A=a(h,v);return V.useEffect(()=>(A.itemMap.set(S,{ref:S,...w}),()=>void A.itemMap.delete(S))),i.jsx(m,{[f]:"",ref:j,children:y})});p.displayName=h;function x(g){const b=a(s+"CollectionConsumer",g);return V.useCallback(()=>{const y=b.collectionRef.current;if(!y)return[];const w=Array.from(y.querySelectorAll(`[${f}]`));return Array.from(b.itemMap.values()).sort((A,k)=>w.indexOf(A.ref.current)-w.indexOf(k.ref.current))},[b.collectionRef,b.itemMap])}return[{Provider:o,Slot:d,ItemSlot:p},x,n]}var Qre=C.createContext(void 0);function rw(s){const e=C.useContext(Qre);return s||e||"ltr"}var uA="rovingFocusGroup.onEntryFocus",Zre={bubbles:!1,cancelable:!0},iw="RovingFocusGroup",[cT,s6,Jre]=bk(iw),[eie,wk]=Oa(iw,[Jre]),[tie,sie]=eie(iw),n6=C.forwardRef((s,e)=>i.jsx(cT.Provider,{scope:s.__scopeRovingFocusGroup,children:i.jsx(cT.Slot,{scope:s.__scopeRovingFocusGroup,children:i.jsx(nie,{...s,ref:e})})}));n6.displayName=iw;var nie=C.forwardRef((s,e)=>{const{__scopeRovingFocusGroup:t,orientation:n,loop:r=!1,dir:a,currentTabStopId:o,defaultCurrentTabStopId:l,onCurrentTabStopIdChange:c,onEntryFocus:d,preventScrollOnEntryFocus:h=!1,...f}=s,m=C.useRef(null),p=Tt(e,m),x=rw(a),[g,b]=Lc({prop:o,defaultProp:l??null,onChange:c,caller:iw}),[v,y]=C.useState(!1),w=bl(d),S=s6(t),j=C.useRef(!1),[A,k]=C.useState(0);return C.useEffect(()=>{const _=m.current;if(_)return _.addEventListener(uA,w),()=>_.removeEventListener(uA,w)},[w]),i.jsx(tie,{scope:t,orientation:n,dir:x,loop:r,currentTabStopId:g,onItemFocus:C.useCallback(_=>b(_),[b]),onItemShiftTab:C.useCallback(()=>y(!0),[]),onFocusableItemAdd:C.useCallback(()=>k(_=>_+1),[]),onFocusableItemRemove:C.useCallback(()=>k(_=>_-1),[]),children:i.jsx(ot.div,{tabIndex:v||A===0?-1:0,"data-orientation":n,...f,ref:p,style:{outline:"none",...s.style},onMouseDown:He(s.onMouseDown,()=>{j.current=!0}),onFocus:He(s.onFocus,_=>{const L=!j.current;if(_.target===_.currentTarget&&L&&!v){const D=new CustomEvent(uA,Zre);if(_.currentTarget.dispatchEvent(D),!D.defaultPrevented){const P=S().filter(I=>I.focusable),T=P.find(I=>I.active),B=P.find(I=>I.id===g),O=[T,B,...P].filter(Boolean).map(I=>I.ref.current);a6(O,h)}}j.current=!1}),onBlur:He(s.onBlur,()=>y(!1))})})}),r6="RovingFocusGroupItem",i6=C.forwardRef((s,e)=>{const{__scopeRovingFocusGroup:t,focusable:n=!0,active:r=!1,tabStopId:a,children:o,...l}=s,c=gl(),d=a||c,h=sie(r6,t),f=h.currentTabStopId===d,m=s6(t),{onFocusableItemAdd:p,onFocusableItemRemove:x,currentTabStopId:g}=h;return C.useEffect(()=>{if(n)return p(),()=>x()},[n,p,x]),i.jsx(cT.ItemSlot,{scope:t,id:d,focusable:n,active:r,children:i.jsx(ot.span,{tabIndex:f?0:-1,"data-orientation":h.orientation,...l,ref:e,onMouseDown:He(s.onMouseDown,b=>{n?h.onItemFocus(d):b.preventDefault()}),onFocus:He(s.onFocus,()=>h.onItemFocus(d)),onKeyDown:He(s.onKeyDown,b=>{if(b.key==="Tab"&&b.shiftKey){h.onItemShiftTab();return}if(b.target!==b.currentTarget)return;const v=aie(b,h.orientation,h.dir);if(v!==void 0){if(b.metaKey||b.ctrlKey||b.altKey||b.shiftKey)return;b.preventDefault();let w=m().filter(S=>S.focusable).map(S=>S.ref.current);if(v==="last")w.reverse();else if(v==="prev"||v==="next"){v==="prev"&&w.reverse();const S=w.indexOf(b.currentTarget);w=h.loop?oie(w,S+1):w.slice(S+1)}setTimeout(()=>a6(w))}}),children:typeof o=="function"?o({isCurrentTabStop:f,hasTabStop:g!=null}):o})})});i6.displayName=r6;var rie={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function iie(s,e){return e!=="rtl"?s:s==="ArrowLeft"?"ArrowRight":s==="ArrowRight"?"ArrowLeft":s}function aie(s,e,t){const n=iie(s.key,t);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(n))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(n)))return rie[n]}function a6(s,e=!1){const t=document.activeElement;for(const n of s)if(n===t||(n.focus({preventScroll:e}),document.activeElement!==t))return}function oie(s,e){return s.map((t,n)=>s[(e+n)%s.length])}var o6=n6,l6=i6,Ck="Tabs",[lie]=Oa(Ck,[wk]),c6=wk(),[cie,xM]=lie(Ck),d6=C.forwardRef((s,e)=>{const{__scopeTabs:t,value:n,onValueChange:r,defaultValue:a,orientation:o="horizontal",dir:l,activationMode:c="automatic",...d}=s,h=rw(l),[f,m]=Lc({prop:n,onChange:r,defaultProp:a??"",caller:Ck});return i.jsx(cie,{scope:t,baseId:gl(),value:f,onValueChange:m,orientation:o,dir:h,activationMode:c,children:i.jsx(ot.div,{dir:h,"data-orientation":o,...d,ref:e})})});d6.displayName=Ck;var u6="TabsList",h6=C.forwardRef((s,e)=>{const{__scopeTabs:t,loop:n=!0,...r}=s,a=xM(u6,t),o=c6(t);return i.jsx(o6,{asChild:!0,...o,orientation:a.orientation,dir:a.dir,loop:n,children:i.jsx(ot.div,{role:"tablist","aria-orientation":a.orientation,...r,ref:e})})});h6.displayName=u6;var f6="TabsTrigger",m6=C.forwardRef((s,e)=>{const{__scopeTabs:t,value:n,disabled:r=!1,...a}=s,o=xM(f6,t),l=c6(t),c=x6(o.baseId,n),d=y6(o.baseId,n),h=n===o.value;return i.jsx(l6,{asChild:!0,...l,focusable:!r,active:h,children:i.jsx(ot.button,{type:"button",role:"tab","aria-selected":h,"aria-controls":d,"data-state":h?"active":"inactive","data-disabled":r?"":void 0,disabled:r,id:c,...a,ref:e,onMouseDown:He(s.onMouseDown,f=>{!r&&f.button===0&&f.ctrlKey===!1?o.onValueChange(n):f.preventDefault()}),onKeyDown:He(s.onKeyDown,f=>{[" ","Enter"].includes(f.key)&&o.onValueChange(n)}),onFocus:He(s.onFocus,()=>{const f=o.activationMode!=="manual";!h&&!r&&f&&o.onValueChange(n)})})})});m6.displayName=f6;var p6="TabsContent",g6=C.forwardRef((s,e)=>{const{__scopeTabs:t,value:n,forceMount:r,children:a,...o}=s,l=xM(p6,t),c=x6(l.baseId,n),d=y6(l.baseId,n),h=n===l.value,f=C.useRef(h);return C.useEffect(()=>{const m=requestAnimationFrame(()=>f.current=!1);return()=>cancelAnimationFrame(m)},[]),i.jsx(jl,{present:r||h,children:({present:m})=>i.jsx(ot.div,{"data-state":h?"active":"inactive","data-orientation":l.orientation,role:"tabpanel","aria-labelledby":c,hidden:!m,id:d,tabIndex:0,...o,ref:e,style:{...s.style,animationDuration:f.current?"0s":void 0},children:m&&a})})});g6.displayName=p6;function x6(s,e){return`${s}-trigger-${e}`}function y6(s,e){return`${s}-content-${e}`}var die=d6,v6=h6,b6=m6,w6=g6;const Qn=die,In=C.forwardRef(({className:s,...e},t)=>i.jsx(v6,{ref:t,className:Ee("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...e}));In.displayName=v6.displayName;const Be=C.forwardRef(({className:s,...e},t)=>i.jsx(b6,{ref:t,className:Ee("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...e}));Be.displayName=b6.displayName;const $e=C.forwardRef(({className:s,...e},t)=>i.jsx(w6,{ref:t,className:Ee("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...e}));$e.displayName=w6.displayName;function C6(s,e){const t={get(n,r){if(typeof r=="string"){const a=[...e,r];return C6(s,a)}else if(r===fB){if(e.length<1){const a=[s,...e].join(".");throw new Error(`API path is expected to be of the form \`${s}.childComponent.functionName\`. Found: \`${a}\``)}return"_reference/childComponent/"+e.join("/")}else return}};return new Proxy({},t)}const uie=()=>C6("components",[]),re=ZY;uie();var Ht;(function(s){s.assertEqual=r=>{};function e(r){}s.assertIs=e;function t(r){throw new Error}s.assertNever=t,s.arrayToEnum=r=>{const a={};for(const o of r)a[o]=o;return a},s.getValidEnumValues=r=>{const a=s.objectKeys(r).filter(l=>typeof r[r[l]]!="number"),o={};for(const l of a)o[l]=r[l];return s.objectValues(o)},s.objectValues=r=>s.objectKeys(r).map(function(a){return r[a]}),s.objectKeys=typeof Object.keys=="function"?r=>Object.keys(r):r=>{const a=[];for(const o in r)Object.prototype.hasOwnProperty.call(r,o)&&a.push(o);return a},s.find=(r,a)=>{for(const o of r)if(a(o))return o},s.isInteger=typeof Number.isInteger=="function"?r=>Number.isInteger(r):r=>typeof r=="number"&&Number.isFinite(r)&&Math.floor(r)===r;function n(r,a=" | "){return r.map(o=>typeof o=="string"?`'${o}'`:o).join(a)}s.joinValues=n,s.jsonStringifyReplacer=(r,a)=>typeof a=="bigint"?a.toString():a})(Ht||(Ht={}));var kL;(function(s){s.mergeShapes=(e,t)=>({...e,...t})})(kL||(kL={}));const Xe=Ht.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),cd=s=>{switch(typeof s){case"undefined":return Xe.undefined;case"string":return Xe.string;case"number":return Number.isNaN(s)?Xe.nan:Xe.number;case"boolean":return Xe.boolean;case"function":return Xe.function;case"bigint":return Xe.bigint;case"symbol":return Xe.symbol;case"object":return Array.isArray(s)?Xe.array:s===null?Xe.null:s.then&&typeof s.then=="function"&&s.catch&&typeof s.catch=="function"?Xe.promise:typeof Map<"u"&&s instanceof Map?Xe.map:typeof Set<"u"&&s instanceof Set?Xe.set:typeof Date<"u"&&s instanceof Date?Xe.date:Xe.object;default:return Xe.unknown}},Pe=Ht.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Fc extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(a){return a.message},n={_errors:[]},r=a=>{for(const o of a.issues)if(o.code==="invalid_union")o.unionErrors.map(r);else if(o.code==="invalid_return_type")r(o.returnTypeError);else if(o.code==="invalid_arguments")r(o.argumentsError);else if(o.path.length===0)n._errors.push(t(o));else{let l=n,c=0;for(;c<o.path.length;){const d=o.path[c];c===o.path.length-1?(l[d]=l[d]||{_errors:[]},l[d]._errors.push(t(o))):l[d]=l[d]||{_errors:[]},l=l[d],c++}}};return r(this),n}static assert(e){if(!(e instanceof Fc))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Ht.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},n=[];for(const r of this.issues)if(r.path.length>0){const a=r.path[0];t[a]=t[a]||[],t[a].push(e(r))}else n.push(e(r));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}Fc.create=s=>new Fc(s);const dT=(s,e)=>{let t;switch(s.code){case Pe.invalid_type:s.received===Xe.undefined?t="Required":t=`Expected ${s.expected}, received ${s.received}`;break;case Pe.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(s.expected,Ht.jsonStringifyReplacer)}`;break;case Pe.unrecognized_keys:t=`Unrecognized key(s) in object: ${Ht.joinValues(s.keys,", ")}`;break;case Pe.invalid_union:t="Invalid input";break;case Pe.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${Ht.joinValues(s.options)}`;break;case Pe.invalid_enum_value:t=`Invalid enum value. Expected ${Ht.joinValues(s.options)}, received '${s.received}'`;break;case Pe.invalid_arguments:t="Invalid function arguments";break;case Pe.invalid_return_type:t="Invalid function return type";break;case Pe.invalid_date:t="Invalid date";break;case Pe.invalid_string:typeof s.validation=="object"?"includes"in s.validation?(t=`Invalid input: must include "${s.validation.includes}"`,typeof s.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${s.validation.position}`)):"startsWith"in s.validation?t=`Invalid input: must start with "${s.validation.startsWith}"`:"endsWith"in s.validation?t=`Invalid input: must end with "${s.validation.endsWith}"`:Ht.assertNever(s.validation):s.validation!=="regex"?t=`Invalid ${s.validation}`:t="Invalid";break;case Pe.too_small:s.type==="array"?t=`Array must contain ${s.exact?"exactly":s.inclusive?"at least":"more than"} ${s.minimum} element(s)`:s.type==="string"?t=`String must contain ${s.exact?"exactly":s.inclusive?"at least":"over"} ${s.minimum} character(s)`:s.type==="number"?t=`Number must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${s.minimum}`:s.type==="bigint"?t=`Number must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${s.minimum}`:s.type==="date"?t=`Date must be ${s.exact?"exactly equal to ":s.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(s.minimum))}`:t="Invalid input";break;case Pe.too_big:s.type==="array"?t=`Array must contain ${s.exact?"exactly":s.inclusive?"at most":"less than"} ${s.maximum} element(s)`:s.type==="string"?t=`String must contain ${s.exact?"exactly":s.inclusive?"at most":"under"} ${s.maximum} character(s)`:s.type==="number"?t=`Number must be ${s.exact?"exactly":s.inclusive?"less than or equal to":"less than"} ${s.maximum}`:s.type==="bigint"?t=`BigInt must be ${s.exact?"exactly":s.inclusive?"less than or equal to":"less than"} ${s.maximum}`:s.type==="date"?t=`Date must be ${s.exact?"exactly":s.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(s.maximum))}`:t="Invalid input";break;case Pe.custom:t="Invalid input";break;case Pe.invalid_intersection_types:t="Intersection results could not be merged";break;case Pe.not_multiple_of:t=`Number must be a multiple of ${s.multipleOf}`;break;case Pe.not_finite:t="Number must be finite";break;default:t=e.defaultError,Ht.assertNever(s)}return{message:t}};let hie=dT;function fie(){return hie}const mie=s=>{const{data:e,path:t,errorMaps:n,issueData:r}=s,a=[...t,...r.path||[]],o={...r,path:a};if(r.message!==void 0)return{...r,path:a,message:r.message};let l="";const c=n.filter(d=>!!d).slice().reverse();for(const d of c)l=d(o,{data:e,defaultError:l}).message;return{...r,path:a,message:l}};function ze(s,e){const t=fie(),n=mie({issueData:e,data:s.data,path:s.path,errorMaps:[s.common.contextualErrorMap,s.schemaErrorMap,t,t===dT?void 0:dT].filter(r=>!!r)});s.common.issues.push(n)}class Ki{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const r of t){if(r.status==="aborted")return ht;r.status==="dirty"&&e.dirty(),n.push(r.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const r of t){const a=await r.key,o=await r.value;n.push({key:a,value:o})}return Ki.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const r of t){const{key:a,value:o}=r;if(a.status==="aborted"||o.status==="aborted")return ht;a.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof o.value<"u"||r.alwaysSet)&&(n[a.value]=o.value)}return{status:e.value,value:n}}}const ht=Object.freeze({status:"aborted"}),by=s=>({status:"dirty",value:s}),Fa=s=>({status:"valid",value:s}),NL=s=>s.status==="aborted",AL=s=>s.status==="dirty",Nx=s=>s.status==="valid",gS=s=>typeof Promise<"u"&&s instanceof Promise;var Je;(function(s){s.errToObj=e=>typeof e=="string"?{message:e}:e||{},s.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(Je||(Je={}));class Ou{constructor(e,t,n,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=r}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const _L=(s,e)=>{if(Nx(e))return{success:!0,data:e.value};if(!s.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Fc(s.common.issues);return this._error=t,this._error}}};function Pt(s){if(!s)return{};const{errorMap:e,invalid_type_error:t,required_error:n,description:r}=s;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:r}:{errorMap:(o,l)=>{const{message:c}=s;return o.code==="invalid_enum_value"?{message:c??l.defaultError}:typeof l.data>"u"?{message:c??n??l.defaultError}:o.code!=="invalid_type"?{message:l.defaultError}:{message:c??t??l.defaultError}},description:r}}class zt{get description(){return this._def.description}_getType(e){return cd(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:cd(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Ki,ctx:{common:e.parent.common,data:e.data,parsedType:cd(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(gS(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){const n={common:{issues:[],async:(t==null?void 0:t.async)??!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:cd(e)},r=this._parseSync({data:e,path:n.path,parent:n});return _L(n,r)}"~validate"(e){var n,r;const t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:cd(e)};if(!this["~standard"].async)try{const a=this._parseSync({data:e,path:[],parent:t});return Nx(a)?{value:a.value}:{issues:t.common.issues}}catch(a){(r=(n=a==null?void 0:a.message)==null?void 0:n.toLowerCase())!=null&&r.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(a=>Nx(a)?{value:a.value}:{issues:t.common.issues})}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:cd(e)},r=this._parse({data:e,path:n.path,parent:n}),a=await(gS(r)?r:Promise.resolve(r));return _L(n,a)}refine(e,t){const n=r=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(r):t;return this._refinement((r,a)=>{const o=e(r),l=()=>a.addIssue({code:Pe.custom,...n(r)});return typeof Promise<"u"&&o instanceof Promise?o.then(c=>c?!0:(l(),!1)):o?!0:(l(),!1)})}refinement(e,t){return this._refinement((n,r)=>e(n)?!0:(r.addIssue(typeof t=="function"?t(n,r):t),!1))}_refinement(e){return new Tx({schema:this,typeName:ft.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return Tu.create(this,this._def)}nullable(){return Ex.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return xl.create(this)}promise(){return bS.create(this,this._def)}or(e){return yS.create([this,e],this._def)}and(e){return vS.create(this,e,this._def)}transform(e){return new Tx({...Pt(this._def),schema:this,typeName:ft.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new pT({...Pt(this._def),innerType:this,defaultValue:t,typeName:ft.ZodDefault})}brand(){return new Oie({typeName:ft.ZodBranded,type:this,...Pt(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new gT({...Pt(this._def),innerType:this,catchValue:t,typeName:ft.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return yM.create(this,e)}readonly(){return xT.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const pie=/^c[^\s-]{8,}$/i,gie=/^[0-9a-z]+$/,xie=/^[0-9A-HJKMNP-TV-Z]{26}$/i,yie=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,vie=/^[a-z0-9_-]{21}$/i,bie=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,wie=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Cie=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Sie="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let hA;const jie=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,kie=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Nie=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Aie=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,_ie=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Tie=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,S6="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Eie=new RegExp(`^${S6}$`);function j6(s){let e="[0-5]\\d";s.precision?e=`${e}\\.\\d{${s.precision}}`:s.precision==null&&(e=`${e}(\\.\\d+)?`);const t=s.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function Pie(s){return new RegExp(`^${j6(s)}$`)}function Mie(s){let e=`${S6}T${j6(s)}`;const t=[];return t.push(s.local?"Z?":"Z"),s.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function Iie(s,e){return!!((e==="v4"||!e)&&jie.test(s)||(e==="v6"||!e)&&Nie.test(s))}function Rie(s,e){if(!bie.test(s))return!1;try{const[t]=s.split(".");if(!t)return!1;const n=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),r=JSON.parse(atob(n));return!(typeof r!="object"||r===null||"typ"in r&&(r==null?void 0:r.typ)!=="JWT"||!r.alg||e&&r.alg!==e)}catch{return!1}}function Die(s,e){return!!((e==="v4"||!e)&&kie.test(s)||(e==="v6"||!e)&&Aie.test(s))}class gu extends zt{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==Xe.string){const a=this._getOrReturnCtx(e);return ze(a,{code:Pe.invalid_type,expected:Xe.string,received:a.parsedType}),ht}const n=new Ki;let r;for(const a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(r=this._getOrReturnCtx(e,r),ze(r,{code:Pe.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="max")e.data.length>a.value&&(r=this._getOrReturnCtx(e,r),ze(r,{code:Pe.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),n.dirty());else if(a.kind==="length"){const o=e.data.length>a.value,l=e.data.length<a.value;(o||l)&&(r=this._getOrReturnCtx(e,r),o?ze(r,{code:Pe.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):l&&ze(r,{code:Pe.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),n.dirty())}else if(a.kind==="email")Cie.test(e.data)||(r=this._getOrReturnCtx(e,r),ze(r,{validation:"email",code:Pe.invalid_string,message:a.message}),n.dirty());else if(a.kind==="emoji")hA||(hA=new RegExp(Sie,"u")),hA.test(e.data)||(r=this._getOrReturnCtx(e,r),ze(r,{validation:"emoji",code:Pe.invalid_string,message:a.message}),n.dirty());else if(a.kind==="uuid")yie.test(e.data)||(r=this._getOrReturnCtx(e,r),ze(r,{validation:"uuid",code:Pe.invalid_string,message:a.message}),n.dirty());else if(a.kind==="nanoid")vie.test(e.data)||(r=this._getOrReturnCtx(e,r),ze(r,{validation:"nanoid",code:Pe.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid")pie.test(e.data)||(r=this._getOrReturnCtx(e,r),ze(r,{validation:"cuid",code:Pe.invalid_string,message:a.message}),n.dirty());else if(a.kind==="cuid2")gie.test(e.data)||(r=this._getOrReturnCtx(e,r),ze(r,{validation:"cuid2",code:Pe.invalid_string,message:a.message}),n.dirty());else if(a.kind==="ulid")xie.test(e.data)||(r=this._getOrReturnCtx(e,r),ze(r,{validation:"ulid",code:Pe.invalid_string,message:a.message}),n.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{r=this._getOrReturnCtx(e,r),ze(r,{validation:"url",code:Pe.invalid_string,message:a.message}),n.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),ze(r,{validation:"regex",code:Pe.invalid_string,message:a.message}),n.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(r=this._getOrReturnCtx(e,r),ze(r,{code:Pe.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),n.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(r=this._getOrReturnCtx(e,r),ze(r,{code:Pe.invalid_string,validation:{startsWith:a.value},message:a.message}),n.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(r=this._getOrReturnCtx(e,r),ze(r,{code:Pe.invalid_string,validation:{endsWith:a.value},message:a.message}),n.dirty()):a.kind==="datetime"?Mie(a).test(e.data)||(r=this._getOrReturnCtx(e,r),ze(r,{code:Pe.invalid_string,validation:"datetime",message:a.message}),n.dirty()):a.kind==="date"?Eie.test(e.data)||(r=this._getOrReturnCtx(e,r),ze(r,{code:Pe.invalid_string,validation:"date",message:a.message}),n.dirty()):a.kind==="time"?Pie(a).test(e.data)||(r=this._getOrReturnCtx(e,r),ze(r,{code:Pe.invalid_string,validation:"time",message:a.message}),n.dirty()):a.kind==="duration"?wie.test(e.data)||(r=this._getOrReturnCtx(e,r),ze(r,{validation:"duration",code:Pe.invalid_string,message:a.message}),n.dirty()):a.kind==="ip"?Iie(e.data,a.version)||(r=this._getOrReturnCtx(e,r),ze(r,{validation:"ip",code:Pe.invalid_string,message:a.message}),n.dirty()):a.kind==="jwt"?Rie(e.data,a.alg)||(r=this._getOrReturnCtx(e,r),ze(r,{validation:"jwt",code:Pe.invalid_string,message:a.message}),n.dirty()):a.kind==="cidr"?Die(e.data,a.version)||(r=this._getOrReturnCtx(e,r),ze(r,{validation:"cidr",code:Pe.invalid_string,message:a.message}),n.dirty()):a.kind==="base64"?_ie.test(e.data)||(r=this._getOrReturnCtx(e,r),ze(r,{validation:"base64",code:Pe.invalid_string,message:a.message}),n.dirty()):a.kind==="base64url"?Tie.test(e.data)||(r=this._getOrReturnCtx(e,r),ze(r,{validation:"base64url",code:Pe.invalid_string,message:a.message}),n.dirty()):Ht.assertNever(a);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(r=>e.test(r),{validation:t,code:Pe.invalid_string,...Je.errToObj(n)})}_addCheck(e){return new gu({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Je.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Je.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Je.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Je.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...Je.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Je.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Je.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Je.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...Je.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...Je.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...Je.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Je.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...Je.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...Je.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...Je.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...Je.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...Je.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...Je.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...Je.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...Je.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...Je.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...Je.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...Je.errToObj(t)})}nonempty(e){return this.min(1,Je.errToObj(e))}trim(){return new gu({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new gu({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new gu({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}gu.create=s=>new gu({checks:[],typeName:ft.ZodString,coerce:(s==null?void 0:s.coerce)??!1,...Pt(s)});function Lie(s,e){const t=(s.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,r=t>n?t:n,a=Number.parseInt(s.toFixed(r).replace(".","")),o=Number.parseInt(e.toFixed(r).replace(".",""));return a%o/10**r}class Ax extends zt{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==Xe.number){const a=this._getOrReturnCtx(e);return ze(a,{code:Pe.invalid_type,expected:Xe.number,received:a.parsedType}),ht}let n;const r=new Ki;for(const a of this._def.checks)a.kind==="int"?Ht.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),ze(n,{code:Pe.invalid_type,expected:"integer",received:"float",message:a.message}),r.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),ze(n,{code:Pe.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),r.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),ze(n,{code:Pe.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),r.dirty()):a.kind==="multipleOf"?Lie(e.data,a.value)!==0&&(n=this._getOrReturnCtx(e,n),ze(n,{code:Pe.not_multiple_of,multipleOf:a.value,message:a.message}),r.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),ze(n,{code:Pe.not_finite,message:a.message}),r.dirty()):Ht.assertNever(a);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Je.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Je.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Je.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Je.toString(t))}setLimit(e,t,n,r){return new Ax({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:Je.toString(r)}]})}_addCheck(e){return new Ax({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Je.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Je.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Je.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Je.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Je.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Je.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:Je.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Je.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Je.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Ht.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Ax.create=s=>new Ax({checks:[],typeName:ft.ZodNumber,coerce:(s==null?void 0:s.coerce)||!1,...Pt(s)});class zv extends zt{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==Xe.bigint)return this._getInvalidInput(e);let n;const r=new Ki;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(n=this._getOrReturnCtx(e,n),ze(n,{code:Pe.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),r.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(n=this._getOrReturnCtx(e,n),ze(n,{code:Pe.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),r.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),ze(n,{code:Pe.not_multiple_of,multipleOf:a.value,message:a.message}),r.dirty()):Ht.assertNever(a);return{status:r.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return ze(t,{code:Pe.invalid_type,expected:Xe.bigint,received:t.parsedType}),ht}gte(e,t){return this.setLimit("min",e,!0,Je.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Je.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Je.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Je.toString(t))}setLimit(e,t,n,r){return new zv({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:Je.toString(r)}]})}_addCheck(e){return new zv({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Je.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Je.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Je.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Je.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Je.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}zv.create=s=>new zv({checks:[],typeName:ft.ZodBigInt,coerce:(s==null?void 0:s.coerce)??!1,...Pt(s)});class uT extends zt{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==Xe.boolean){const n=this._getOrReturnCtx(e);return ze(n,{code:Pe.invalid_type,expected:Xe.boolean,received:n.parsedType}),ht}return Fa(e.data)}}uT.create=s=>new uT({typeName:ft.ZodBoolean,coerce:(s==null?void 0:s.coerce)||!1,...Pt(s)});class xS extends zt{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==Xe.date){const a=this._getOrReturnCtx(e);return ze(a,{code:Pe.invalid_type,expected:Xe.date,received:a.parsedType}),ht}if(Number.isNaN(e.data.getTime())){const a=this._getOrReturnCtx(e);return ze(a,{code:Pe.invalid_date}),ht}const n=new Ki;let r;for(const a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(r=this._getOrReturnCtx(e,r),ze(r,{code:Pe.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),n.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(r=this._getOrReturnCtx(e,r),ze(r,{code:Pe.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),n.dirty()):Ht.assertNever(a);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new xS({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:Je.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:Je.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}xS.create=s=>new xS({checks:[],coerce:(s==null?void 0:s.coerce)||!1,typeName:ft.ZodDate,...Pt(s)});class TL extends zt{_parse(e){if(this._getType(e)!==Xe.symbol){const n=this._getOrReturnCtx(e);return ze(n,{code:Pe.invalid_type,expected:Xe.symbol,received:n.parsedType}),ht}return Fa(e.data)}}TL.create=s=>new TL({typeName:ft.ZodSymbol,...Pt(s)});class EL extends zt{_parse(e){if(this._getType(e)!==Xe.undefined){const n=this._getOrReturnCtx(e);return ze(n,{code:Pe.invalid_type,expected:Xe.undefined,received:n.parsedType}),ht}return Fa(e.data)}}EL.create=s=>new EL({typeName:ft.ZodUndefined,...Pt(s)});class PL extends zt{_parse(e){if(this._getType(e)!==Xe.null){const n=this._getOrReturnCtx(e);return ze(n,{code:Pe.invalid_type,expected:Xe.null,received:n.parsedType}),ht}return Fa(e.data)}}PL.create=s=>new PL({typeName:ft.ZodNull,...Pt(s)});class hT extends zt{constructor(){super(...arguments),this._any=!0}_parse(e){return Fa(e.data)}}hT.create=s=>new hT({typeName:ft.ZodAny,...Pt(s)});class ML extends zt{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Fa(e.data)}}ML.create=s=>new ML({typeName:ft.ZodUnknown,...Pt(s)});class Fu extends zt{_parse(e){const t=this._getOrReturnCtx(e);return ze(t,{code:Pe.invalid_type,expected:Xe.never,received:t.parsedType}),ht}}Fu.create=s=>new Fu({typeName:ft.ZodNever,...Pt(s)});class IL extends zt{_parse(e){if(this._getType(e)!==Xe.undefined){const n=this._getOrReturnCtx(e);return ze(n,{code:Pe.invalid_type,expected:Xe.void,received:n.parsedType}),ht}return Fa(e.data)}}IL.create=s=>new IL({typeName:ft.ZodVoid,...Pt(s)});class xl extends zt{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),r=this._def;if(t.parsedType!==Xe.array)return ze(t,{code:Pe.invalid_type,expected:Xe.array,received:t.parsedType}),ht;if(r.exactLength!==null){const o=t.data.length>r.exactLength.value,l=t.data.length<r.exactLength.value;(o||l)&&(ze(t,{code:o?Pe.too_big:Pe.too_small,minimum:l?r.exactLength.value:void 0,maximum:o?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),n.dirty())}if(r.minLength!==null&&t.data.length<r.minLength.value&&(ze(t,{code:Pe.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),n.dirty()),r.maxLength!==null&&t.data.length>r.maxLength.value&&(ze(t,{code:Pe.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((o,l)=>r.type._parseAsync(new Ou(t,o,t.path,l)))).then(o=>Ki.mergeArray(n,o));const a=[...t.data].map((o,l)=>r.type._parseSync(new Ou(t,o,t.path,l)));return Ki.mergeArray(n,a)}get element(){return this._def.type}min(e,t){return new xl({...this._def,minLength:{value:e,message:Je.toString(t)}})}max(e,t){return new xl({...this._def,maxLength:{value:e,message:Je.toString(t)}})}length(e,t){return new xl({...this._def,exactLength:{value:e,message:Je.toString(t)}})}nonempty(e){return this.min(1,e)}}xl.create=(s,e)=>new xl({type:s,minLength:null,maxLength:null,exactLength:null,typeName:ft.ZodArray,...Pt(e)});function Hm(s){if(s instanceof rn){const e={};for(const t in s.shape){const n=s.shape[t];e[t]=Tu.create(Hm(n))}return new rn({...s._def,shape:()=>e})}else return s instanceof xl?new xl({...s._def,type:Hm(s.element)}):s instanceof Tu?Tu.create(Hm(s.unwrap())):s instanceof Ex?Ex.create(Hm(s.unwrap())):s instanceof cm?cm.create(s.items.map(e=>Hm(e))):s}class rn extends zt{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=Ht.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==Xe.object){const d=this._getOrReturnCtx(e);return ze(d,{code:Pe.invalid_type,expected:Xe.object,received:d.parsedType}),ht}const{status:n,ctx:r}=this._processInputParams(e),{shape:a,keys:o}=this._getCached(),l=[];if(!(this._def.catchall instanceof Fu&&this._def.unknownKeys==="strip"))for(const d in r.data)o.includes(d)||l.push(d);const c=[];for(const d of o){const h=a[d],f=r.data[d];c.push({key:{status:"valid",value:d},value:h._parse(new Ou(r,f,r.path,d)),alwaysSet:d in r.data})}if(this._def.catchall instanceof Fu){const d=this._def.unknownKeys;if(d==="passthrough")for(const h of l)c.push({key:{status:"valid",value:h},value:{status:"valid",value:r.data[h]}});else if(d==="strict")l.length>0&&(ze(r,{code:Pe.unrecognized_keys,keys:l}),n.dirty());else if(d!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const d=this._def.catchall;for(const h of l){const f=r.data[h];c.push({key:{status:"valid",value:h},value:d._parse(new Ou(r,f,r.path,h)),alwaysSet:h in r.data})}}return r.common.async?Promise.resolve().then(async()=>{const d=[];for(const h of c){const f=await h.key,m=await h.value;d.push({key:f,value:m,alwaysSet:h.alwaysSet})}return d}).then(d=>Ki.mergeObjectSync(n,d)):Ki.mergeObjectSync(n,c)}get shape(){return this._def.shape()}strict(e){return Je.errToObj,new rn({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{var a,o;const r=((o=(a=this._def).errorMap)==null?void 0:o.call(a,t,n).message)??n.defaultError;return t.code==="unrecognized_keys"?{message:Je.errToObj(e).message??r}:{message:r}}}:{}})}strip(){return new rn({...this._def,unknownKeys:"strip"})}passthrough(){return new rn({...this._def,unknownKeys:"passthrough"})}extend(e){return new rn({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new rn({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:ft.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new rn({...this._def,catchall:e})}pick(e){const t={};for(const n of Ht.objectKeys(e))e[n]&&this.shape[n]&&(t[n]=this.shape[n]);return new rn({...this._def,shape:()=>t})}omit(e){const t={};for(const n of Ht.objectKeys(this.shape))e[n]||(t[n]=this.shape[n]);return new rn({...this._def,shape:()=>t})}deepPartial(){return Hm(this)}partial(e){const t={};for(const n of Ht.objectKeys(this.shape)){const r=this.shape[n];e&&!e[n]?t[n]=r:t[n]=r.optional()}return new rn({...this._def,shape:()=>t})}required(e){const t={};for(const n of Ht.objectKeys(this.shape))if(e&&!e[n])t[n]=this.shape[n];else{let a=this.shape[n];for(;a instanceof Tu;)a=a._def.innerType;t[n]=a}return new rn({...this._def,shape:()=>t})}keyof(){return k6(Ht.objectKeys(this.shape))}}rn.create=(s,e)=>new rn({shape:()=>s,unknownKeys:"strip",catchall:Fu.create(),typeName:ft.ZodObject,...Pt(e)});rn.strictCreate=(s,e)=>new rn({shape:()=>s,unknownKeys:"strict",catchall:Fu.create(),typeName:ft.ZodObject,...Pt(e)});rn.lazycreate=(s,e)=>new rn({shape:s,unknownKeys:"strip",catchall:Fu.create(),typeName:ft.ZodObject,...Pt(e)});class yS extends zt{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;function r(a){for(const l of a)if(l.result.status==="valid")return l.result;for(const l of a)if(l.result.status==="dirty")return t.common.issues.push(...l.ctx.common.issues),l.result;const o=a.map(l=>new Fc(l.ctx.common.issues));return ze(t,{code:Pe.invalid_union,unionErrors:o}),ht}if(t.common.async)return Promise.all(n.map(async a=>{const o={...t,common:{...t.common,issues:[]},parent:null};return{result:await a._parseAsync({data:t.data,path:t.path,parent:o}),ctx:o}})).then(r);{let a;const o=[];for(const c of n){const d={...t,common:{...t.common,issues:[]},parent:null},h=c._parseSync({data:t.data,path:t.path,parent:d});if(h.status==="valid")return h;h.status==="dirty"&&!a&&(a={result:h,ctx:d}),d.common.issues.length&&o.push(d.common.issues)}if(a)return t.common.issues.push(...a.ctx.common.issues),a.result;const l=o.map(c=>new Fc(c));return ze(t,{code:Pe.invalid_union,unionErrors:l}),ht}}get options(){return this._def.options}}yS.create=(s,e)=>new yS({options:s,typeName:ft.ZodUnion,...Pt(e)});function fT(s,e){const t=cd(s),n=cd(e);if(s===e)return{valid:!0,data:s};if(t===Xe.object&&n===Xe.object){const r=Ht.objectKeys(e),a=Ht.objectKeys(s).filter(l=>r.indexOf(l)!==-1),o={...s,...e};for(const l of a){const c=fT(s[l],e[l]);if(!c.valid)return{valid:!1};o[l]=c.data}return{valid:!0,data:o}}else if(t===Xe.array&&n===Xe.array){if(s.length!==e.length)return{valid:!1};const r=[];for(let a=0;a<s.length;a++){const o=s[a],l=e[a],c=fT(o,l);if(!c.valid)return{valid:!1};r.push(c.data)}return{valid:!0,data:r}}else return t===Xe.date&&n===Xe.date&&+s==+e?{valid:!0,data:s}:{valid:!1}}class vS extends zt{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),r=(a,o)=>{if(NL(a)||NL(o))return ht;const l=fT(a.value,o.value);return l.valid?((AL(a)||AL(o))&&t.dirty(),{status:t.value,value:l.data}):(ze(n,{code:Pe.invalid_intersection_types}),ht)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([a,o])=>r(a,o)):r(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}vS.create=(s,e,t)=>new vS({left:s,right:e,typeName:ft.ZodIntersection,...Pt(t)});class cm extends zt{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Xe.array)return ze(n,{code:Pe.invalid_type,expected:Xe.array,received:n.parsedType}),ht;if(n.data.length<this._def.items.length)return ze(n,{code:Pe.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),ht;!this._def.rest&&n.data.length>this._def.items.length&&(ze(n,{code:Pe.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const a=[...n.data].map((o,l)=>{const c=this._def.items[l]||this._def.rest;return c?c._parse(new Ou(n,o,n.path,l)):null}).filter(o=>!!o);return n.common.async?Promise.all(a).then(o=>Ki.mergeArray(t,o)):Ki.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new cm({...this._def,rest:e})}}cm.create=(s,e)=>{if(!Array.isArray(s))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new cm({items:s,typeName:ft.ZodTuple,rest:null,...Pt(e)})};class RL extends zt{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Xe.map)return ze(n,{code:Pe.invalid_type,expected:Xe.map,received:n.parsedType}),ht;const r=this._def.keyType,a=this._def.valueType,o=[...n.data.entries()].map(([l,c],d)=>({key:r._parse(new Ou(n,l,n.path,[d,"key"])),value:a._parse(new Ou(n,c,n.path,[d,"value"]))}));if(n.common.async){const l=new Map;return Promise.resolve().then(async()=>{for(const c of o){const d=await c.key,h=await c.value;if(d.status==="aborted"||h.status==="aborted")return ht;(d.status==="dirty"||h.status==="dirty")&&t.dirty(),l.set(d.value,h.value)}return{status:t.value,value:l}})}else{const l=new Map;for(const c of o){const d=c.key,h=c.value;if(d.status==="aborted"||h.status==="aborted")return ht;(d.status==="dirty"||h.status==="dirty")&&t.dirty(),l.set(d.value,h.value)}return{status:t.value,value:l}}}}RL.create=(s,e,t)=>new RL({valueType:e,keyType:s,typeName:ft.ZodMap,...Pt(t)});class Hv extends zt{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Xe.set)return ze(n,{code:Pe.invalid_type,expected:Xe.set,received:n.parsedType}),ht;const r=this._def;r.minSize!==null&&n.data.size<r.minSize.value&&(ze(n,{code:Pe.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),r.maxSize!==null&&n.data.size>r.maxSize.value&&(ze(n,{code:Pe.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());const a=this._def.valueType;function o(c){const d=new Set;for(const h of c){if(h.status==="aborted")return ht;h.status==="dirty"&&t.dirty(),d.add(h.value)}return{status:t.value,value:d}}const l=[...n.data.values()].map((c,d)=>a._parse(new Ou(n,c,n.path,d)));return n.common.async?Promise.all(l).then(c=>o(c)):o(l)}min(e,t){return new Hv({...this._def,minSize:{value:e,message:Je.toString(t)}})}max(e,t){return new Hv({...this._def,maxSize:{value:e,message:Je.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Hv.create=(s,e)=>new Hv({valueType:s,minSize:null,maxSize:null,typeName:ft.ZodSet,...Pt(e)});class DL extends zt{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}DL.create=(s,e)=>new DL({getter:s,typeName:ft.ZodLazy,...Pt(e)});class mT extends zt{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return ze(t,{received:t.data,code:Pe.invalid_literal,expected:this._def.value}),ht}return{status:"valid",value:e.data}}get value(){return this._def.value}}mT.create=(s,e)=>new mT({value:s,typeName:ft.ZodLiteral,...Pt(e)});function k6(s,e){return new _x({values:s,typeName:ft.ZodEnum,...Pt(e)})}class _x extends zt{_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),n=this._def.values;return ze(t,{expected:Ht.joinValues(n),received:t.parsedType,code:Pe.invalid_type}),ht}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return ze(t,{received:t.data,code:Pe.invalid_enum_value,options:n}),ht}return Fa(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return _x.create(e,{...this._def,...t})}exclude(e,t=this._def){return _x.create(this.options.filter(n=>!e.includes(n)),{...this._def,...t})}}_x.create=k6;class LL extends zt{_parse(e){const t=Ht.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==Xe.string&&n.parsedType!==Xe.number){const r=Ht.objectValues(t);return ze(n,{expected:Ht.joinValues(r),received:n.parsedType,code:Pe.invalid_type}),ht}if(this._cache||(this._cache=new Set(Ht.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const r=Ht.objectValues(t);return ze(n,{received:n.data,code:Pe.invalid_enum_value,options:r}),ht}return Fa(e.data)}get enum(){return this._def.values}}LL.create=(s,e)=>new LL({values:s,typeName:ft.ZodNativeEnum,...Pt(e)});class bS extends zt{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Xe.promise&&t.common.async===!1)return ze(t,{code:Pe.invalid_type,expected:Xe.promise,received:t.parsedType}),ht;const n=t.parsedType===Xe.promise?t.data:Promise.resolve(t.data);return Fa(n.then(r=>this._def.type.parseAsync(r,{path:t.path,errorMap:t.common.contextualErrorMap})))}}bS.create=(s,e)=>new bS({type:s,typeName:ft.ZodPromise,...Pt(e)});class Tx extends zt{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ft.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),r=this._def.effect||null,a={addIssue:o=>{ze(n,o),o.fatal?t.abort():t.dirty()},get path(){return n.path}};if(a.addIssue=a.addIssue.bind(a),r.type==="preprocess"){const o=r.transform(n.data,a);if(n.common.async)return Promise.resolve(o).then(async l=>{if(t.value==="aborted")return ht;const c=await this._def.schema._parseAsync({data:l,path:n.path,parent:n});return c.status==="aborted"?ht:c.status==="dirty"||t.value==="dirty"?by(c.value):c});{if(t.value==="aborted")return ht;const l=this._def.schema._parseSync({data:o,path:n.path,parent:n});return l.status==="aborted"?ht:l.status==="dirty"||t.value==="dirty"?by(l.value):l}}if(r.type==="refinement"){const o=l=>{const c=r.refinement(l,a);if(n.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return l};if(n.common.async===!1){const l=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return l.status==="aborted"?ht:(l.status==="dirty"&&t.dirty(),o(l.value),{status:t.value,value:l.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(l=>l.status==="aborted"?ht:(l.status==="dirty"&&t.dirty(),o(l.value).then(()=>({status:t.value,value:l.value}))))}if(r.type==="transform")if(n.common.async===!1){const o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Nx(o))return ht;const l=r.transform(o.value,a);if(l instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:l}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>Nx(o)?Promise.resolve(r.transform(o.value,a)).then(l=>({status:t.value,value:l})):ht);Ht.assertNever(r)}}Tx.create=(s,e,t)=>new Tx({schema:s,typeName:ft.ZodEffects,effect:e,...Pt(t)});Tx.createWithPreprocess=(s,e,t)=>new Tx({schema:e,effect:{type:"preprocess",transform:s},typeName:ft.ZodEffects,...Pt(t)});class Tu extends zt{_parse(e){return this._getType(e)===Xe.undefined?Fa(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Tu.create=(s,e)=>new Tu({innerType:s,typeName:ft.ZodOptional,...Pt(e)});class Ex extends zt{_parse(e){return this._getType(e)===Xe.null?Fa(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ex.create=(s,e)=>new Ex({innerType:s,typeName:ft.ZodNullable,...Pt(e)});class pT extends zt{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===Xe.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}pT.create=(s,e)=>new pT({innerType:s,typeName:ft.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...Pt(e)});class gT extends zt{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},r=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return gS(r)?r.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new Fc(n.common.issues)},input:n.data})})):{status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new Fc(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}gT.create=(s,e)=>new gT({innerType:s,typeName:ft.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...Pt(e)});class OL extends zt{_parse(e){if(this._getType(e)!==Xe.nan){const n=this._getOrReturnCtx(e);return ze(n,{code:Pe.invalid_type,expected:Xe.nan,received:n.parsedType}),ht}return{status:"valid",value:e.data}}}OL.create=s=>new OL({typeName:ft.ZodNaN,...Pt(s)});class Oie extends zt{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class yM extends zt{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return a.status==="aborted"?ht:a.status==="dirty"?(t.dirty(),by(a.value)):this._def.out._parseAsync({data:a.value,path:n.path,parent:n})})();{const r=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return r.status==="aborted"?ht:r.status==="dirty"?(t.dirty(),{status:"dirty",value:r.value}):this._def.out._parseSync({data:r.value,path:n.path,parent:n})}}static create(e,t){return new yM({in:e,out:t,typeName:ft.ZodPipeline})}}class xT extends zt{_parse(e){const t=this._def.innerType._parse(e),n=r=>(Nx(r)&&(r.value=Object.freeze(r.value)),r);return gS(t)?t.then(r=>n(r)):n(t)}unwrap(){return this._def.innerType}}xT.create=(s,e)=>new xT({innerType:s,typeName:ft.ZodReadonly,...Pt(e)});var ft;(function(s){s.ZodString="ZodString",s.ZodNumber="ZodNumber",s.ZodNaN="ZodNaN",s.ZodBigInt="ZodBigInt",s.ZodBoolean="ZodBoolean",s.ZodDate="ZodDate",s.ZodSymbol="ZodSymbol",s.ZodUndefined="ZodUndefined",s.ZodNull="ZodNull",s.ZodAny="ZodAny",s.ZodUnknown="ZodUnknown",s.ZodNever="ZodNever",s.ZodVoid="ZodVoid",s.ZodArray="ZodArray",s.ZodObject="ZodObject",s.ZodUnion="ZodUnion",s.ZodDiscriminatedUnion="ZodDiscriminatedUnion",s.ZodIntersection="ZodIntersection",s.ZodTuple="ZodTuple",s.ZodRecord="ZodRecord",s.ZodMap="ZodMap",s.ZodSet="ZodSet",s.ZodFunction="ZodFunction",s.ZodLazy="ZodLazy",s.ZodLiteral="ZodLiteral",s.ZodEnum="ZodEnum",s.ZodEffects="ZodEffects",s.ZodNativeEnum="ZodNativeEnum",s.ZodOptional="ZodOptional",s.ZodNullable="ZodNullable",s.ZodDefault="ZodDefault",s.ZodCatch="ZodCatch",s.ZodPromise="ZodPromise",s.ZodBranded="ZodBranded",s.ZodPipeline="ZodPipeline",s.ZodReadonly="ZodReadonly"})(ft||(ft={}));const X=gu.create,le=Ax.create,Tn=uT.create,vM=hT.create;Fu.create;const Ae=xl.create,Ze=rn.create,FL=yS.create;vS.create;cm.create;const dt=mT.create,Vt=_x.create;bS.create;Tu.create;Ex.create;const Fie=Ze({name:X().min(3,"Name must be at least 3 characters").max(100,"Name cannot exceed 100 characters"),description:X().max(500,"Description cannot exceed 500 characters").optional().or(dt("")),worldSetting:X().max(200,"World setting cannot exceed 200 characters").optional().or(dt("")),isPublic:Tn().default(!1)}),Bie=Ze({title:X().min(3,"Task title must be at least 3 characters").max(100,"Task title cannot exceed 100 characters"),description:X().max(1e3,"Task description cannot exceed 1000 characters").optional().or(dt("")),type:Vt(["Fetch","Kill","Speak","Explore","Puzzle","Deliver","Escort","Custom"]).default("Custom"),status:Vt(["NotStarted","InProgress","Completed","Failed"]).default("NotStarted"),dependsOn:Ae(X()).optional(),assignedTo:Ae(X()).optional(),locationId:X().optional().or(dt("__no_location__")),targetNpcId:X().optional(),requiredItemIds:Ae(X()).optional(),completionNotes:X().max(500,"Completion notes cannot exceed 500 characters").optional().or(dt(""))}),$ie=Ze({name:X().min(3,"Name must be at least 3 characters").max(100,"Name cannot exceed 100 characters"),description:X().max(1e3,"Description cannot exceed 1000 characters").optional().or(dt("")),campaignId:X().optional().or(dt("")).or(dt("__no_campaign__")),status:Vt(["idle","in_progress","completed","NotStarted","InProgress","Failed"]).default("idle"),locationId:X().optional().or(dt("__no_location__")),questType:Vt(["Main","Side","Personal","Guild","Faction"]).optional().default("Side"),difficulty:Vt(["Easy","Medium","Hard","Deadly"]).optional(),estimatedSessions:le().min(1,"Must be at least 1 session").max(20,"Cannot exceed 20 sessions").optional(),timelineEventId:X().optional().or(dt("__no_timeline_event__")),completionXP:le().min(0,"XP must be positive").optional(),rewards:Ze({xp:le().min(0,"XP must be positive").optional(),gold:le().min(0,"Gold must be positive").optional(),itemIds:Ae(X()).optional()}).optional(),involvedCharacterIds:Ae(X()).optional(),requiredLevel:le().min(1,"Level must be at least 1").max(20,"Level cannot exceed 20").optional(),dmNotes:X().max(2e3,"DM notes cannot exceed 2000 characters").optional().or(dt("")),playerNotes:Ae(X()).optional(),isRepeatable:Tn().default(!1),prerequisiteQuestIds:Ae(X()).optional()}),Uie=Ze({name:X().min(2,"Name must be at least 2 characters").max(100,"Name cannot exceed 100 characters"),type:Vt(["Weapon","Armor","Potion","Scroll","Wondrous Item","Ring","Rod","Staff","Wand","Ammunition","Adventuring Gear","Tool","Mount","Vehicle","Treasure","Other"]),rarity:Vt(["Common","Uncommon","Rare","Very Rare","Legendary","Artifact","Unique"]),description:X().min(1,"Description is required").max(1e3,"Description cannot exceed 1000 characters"),effects:X().max(500,"Effects cannot exceed 500 characters").optional().or(dt("")),weight:le().min(0,"Weight must be positive").optional(),cost:le().min(0,"Cost must be positive").optional(),attunement:Tn().optional(),typeOfArmor:Vt(["Light","Medium","Heavy","Shield"]).optional(),armorClass:le().min(1,"AC must be at least 1").max(30,"AC cannot exceed 30").optional(),abilityModifiers:Ze({strength:le().min(-5,"Modifier too low").max(10,"Modifier too high").optional(),dexterity:le().min(-5,"Modifier too low").max(10,"Modifier too high").optional(),constitution:le().min(-5,"Modifier too low").max(10,"Modifier too high").optional(),intelligence:le().min(-5,"Modifier too low").max(10,"Modifier too high").optional(),wisdom:le().min(-5,"Modifier too low").max(10,"Modifier too high").optional(),charisma:le().min(-5,"Modifier too low").max(10,"Modifier too high").optional(),initiative:le().min(-10,"Initiative bonus too low").max(10,"Initiative bonus too high").optional()}).optional()}),zie=Ze({name:X().min(2,"Name must be at least 2 characters").max(100,"Name cannot exceed 100 characters"),source:X().max(100,"Source cannot exceed 100 characters").optional().or(dt("")),size:Vt(["Tiny","Small","Medium","Large","Huge","Gargantuan"]),type:X().min(1,"Type is required").max(50,"Type cannot exceed 50 characters"),alignment:X().min(1,"Alignment is required").max(50,"Alignment cannot exceed 50 characters"),armorClass:le().min(1,"AC must be at least 1").max(30,"AC cannot exceed 30"),hitPoints:le().min(1,"Hit points must be at least 1").max(1e3,"Hit points cannot exceed 1000"),hitDice:Ze({count:le().min(1,"Must have at least 1 hit die").max(100,"Cannot exceed 100 hit dice"),die:Vt(["d4","d6","d8","d10","d12"])}),speed:Ze({walk:X().optional().or(dt("")),swim:X().optional().or(dt("")),fly:X().optional().or(dt("")),burrow:X().optional().or(dt("")),climb:X().optional().or(dt(""))}),abilityScores:Ze({strength:le().min(1,"Ability score must be at least 1").max(30,"Ability score cannot exceed 30"),dexterity:le().min(1,"Ability score must be at least 1").max(30,"Ability score cannot exceed 30"),constitution:le().min(1,"Ability score must be at least 1").max(30,"Ability score cannot exceed 30"),intelligence:le().min(1,"Ability score must be at least 1").max(30,"Ability score cannot exceed 30"),wisdom:le().min(1,"Ability score must be at least 1").max(30,"Ability score cannot exceed 30"),charisma:le().min(1,"Ability score must be at least 1").max(30,"Ability score cannot exceed 30")}),challengeRating:X().min(1,"Challenge rating is required"),proficiencyBonus:le().min(2,"Proficiency bonus must be at least 2").max(9,"Proficiency bonus cannot exceed 9"),initiative:le().optional(),senses:Ze({passivePerception:le().min(1,"Passive perception must be at least 1").max(30,"Passive perception cannot exceed 30"),darkvision:X().optional().or(dt("")),blindsight:X().optional().or(dt("")),tremorsense:X().optional().or(dt("")),truesight:X().optional().or(dt(""))}),challengeRatingValue:le().min(0,"CR value must be non-negative").optional(),legendaryActionCount:le().min(0,"Legendary actions must be non-negative").max(5,"Cannot exceed 5 legendary actions").optional(),lairActionCount:le().min(0,"Lair actions must be non-negative").max(5,"Cannot exceed 5 lair actions").optional(),actions:Ae(X()).optional(),reactions:Ae(X()).optional(),legendaryActions:Ae(X()).optional(),lairActions:Ae(X()).optional(),traits:Ae(Ze({name:X(),description:X()})).optional(),inventory:Ze({capacity:le().min(0,"Capacity must be non-negative"),items:Ae(Ze({itemId:X(),quantity:le().int().min(1,"Quantity must be at least 1")})).optional().default([])}).optional(),equipment:Ze({headgear:X().optional(),armwear:X().optional(),chestwear:X().optional(),legwear:X().optional(),footwear:X().optional(),mainHand:X().optional(),offHand:X().optional(),accessories:Ae(X()).optional().default([])}).optional(),equipmentBonuses:Ze({armorClass:le().min(-10).max(20).optional().default(0),abilityScores:Ze({strength:le().min(-10).max(10).optional().default(0),dexterity:le().min(-10).max(10).optional().default(0),constitution:le().min(-10).max(10).optional().default(0),intelligence:le().min(-10).max(10).optional().default(0),wisdom:le().min(-10).max(10).optional().default(0),charisma:le().min(-10).max(10).optional().default(0)}).optional().default({strength:0,dexterity:0,constitution:0,intelligence:0,wisdom:0,charisma:0})}).optional()}),yT=Ze({strength:le().min(1,"Ability score must be at least 1").max(30,"Ability score cannot exceed 30"),dexterity:le().min(1,"Ability score must be at least 1").max(30,"Ability score cannot exceed 30"),constitution:le().min(1,"Ability score must be at least 1").max(30,"Ability score cannot exceed 30"),intelligence:le().min(1,"Ability score must be at least 1").max(30,"Ability score cannot exceed 30"),wisdom:le().min(1,"Ability score must be at least 1").max(30,"Ability score cannot exceed 30"),charisma:le().min(1,"Ability score must be at least 1").max(30,"Ability score cannot exceed 30")}),Hie=Ze({name:X().min(1,"Class name is required"),level:le().int().min(1,"Level must be at least 1").max(20,"Level cannot exceed 20"),hitDie:Vt(["d6","d8","d10","d12"]),features:Ae(X()).optional(),subclass:X().optional()}),N6=Ze({name:X().min(2,"Name must be at least 2 characters").max(100,"Name cannot exceed 100 characters"),race:X().min(1,"Race is required").max(50,"Race cannot exceed 50 characters"),class:X().min(1,"Class is required").max(50,"Class cannot exceed 50 characters"),background:X().min(1,"Background is required").max(50,"Background cannot exceed 50 characters"),alignment:X().max(50,"Alignment cannot exceed 50 characters").optional().or(dt("")),level:le().min(1,"Level must be at least 1").max(20,"Level cannot exceed 20"),abilityScores:yT,hitPoints:le().min(1,"Hit points must be at least 1").max(1e3,"Hit points cannot exceed 1000"),armorClass:le().min(1,"AC must be at least 1").max(30,"AC cannot exceed 30"),speed:X().optional().or(dt("")),skills:Ae(X()).default([]),savingThrows:Ae(X()).default([]),proficiencies:Ae(X()).default([])}),Vie=N6.extend({subrace:X().optional(),classes:Ae(Hie).optional(),baseAbilityScores:yT.optional(),racialAbilityScoreImprovements:yT.optional(),maxHitPoints:le().int().min(1).optional(),currentHitPoints:le().int().min(0).optional(),tempHitPoints:le().int().min(0).optional(),hitDice:Ae(Ze({die:Vt(["d6","d8","d10","d12"]),current:le().int().min(0),max:le().int().min(0)})).optional(),baseArmorClass:le().int().min(1).max(30).optional(),skillProficiencies:Ae(Ze({skill:X(),proficient:Tn(),expertise:Tn().optional(),source:X().optional()})).optional(),savingThrowProficiencies:Ae(Ze({ability:X(),proficient:Tn(),source:X().optional()})).optional(),weaponProficiencies:Ae(X()).optional(),armorProficiencies:Ae(X()).optional(),toolProficiencies:Ae(X()).optional(),traits:Ae(X()).optional(),racialTraits:Ae(Ze({name:X(),description:X()})).optional(),languages:Ae(X()).optional(),speeds:Ze({walking:le().int().min(0).optional(),swimming:le().int().min(0).optional(),flying:le().int().min(0).optional(),climbing:le().int().min(0).optional(),burrowing:le().int().min(0).optional()}).optional(),initiative:le().optional(),passivePerception:le().int().min(0).optional(),passiveInvestigation:le().int().min(0).optional(),passiveInsight:le().int().min(0).optional(),spellcastingAbility:Vt(["Intelligence","Wisdom","Charisma"]).optional(),spellSaveDC:le().int().min(8).max(30).optional(),spellAttackBonus:le().int().optional(),spellSlots:Ae(Ze({level:le().int().min(1).max(9),total:le().int().min(0),used:le().int().min(0)})).optional(),spellsKnown:Ae(X()).optional(),cantripsKnown:Ae(X()).optional(),features:Ae(Ze({name:X(),description:X(),source:X(),uses:Ze({current:le().int().min(0),max:le().int().min(0),resetOn:X()}).optional()})).optional(),feats:Ae(Ze({name:X(),description:X()})).optional(),inspiration:Tn().optional(),deathSaves:Ze({successes:le().int().min(0).max(3),failures:le().int().min(0).max(3)}).optional(),importedFrom:X().optional(),importData:vM().optional(),actions:Ae(X()).optional(),inventory:Ze({capacity:le().min(0,"Capacity must be non-negative"),items:Ae(Ze({itemId:X(),quantity:le().int().min(1,"Quantity must be at least 1")})).optional().default([])}).optional(),equipment:Ze({headgear:X().optional(),armwear:X().optional(),chestwear:X().optional(),legwear:X().optional(),footwear:X().optional(),mainHand:X().optional(),offHand:X().optional(),accessories:Ae(X()).optional().default([])}).optional(),equipmentBonuses:Ze({armorClass:le().min(0).optional().default(0),abilityScores:Ze({strength:le().min(-10).max(10).optional().default(0),dexterity:le().min(-10).max(10).optional().default(0),constitution:le().min(-10).max(10).optional().default(0),intelligence:le().min(-10).max(10).optional().default(0),wisdom:le().min(-10).max(10).optional().default(0),charisma:le().min(-10).max(10).optional().default(0)}).optional().default({strength:0,dexterity:0,constitution:0,intelligence:0,wisdom:0,charisma:0})}).optional()}),Wie=Ze({title:X().min(3,"Title must be at least 3 characters").max(100,"Title cannot exceed 100 characters"),description:X().min(1,"Description is required").max(2e3,"Description cannot exceed 2000 characters"),date:le().min(0,"Date must be a valid timestamp"),campaignId:X().min(1,"Campaign is required"),type:Vt(["Battle","Alliance","Discovery","Disaster","Political","Cultural","Custom"]).default("Custom"),status:Vt(["idle","in_progress","completed"]).default("idle"),relatedLocationIds:Ae(X()).optional(),relatedNpcIds:Ae(X()).optional(),relatedFactionIds:Ae(X()).optional(),relatedQuestIds:Ae(X()).optional(),primaryQuestId:X().optional(),eventConsequences:Ae(X()).optional(),participantOutcomes:Ae(Ze({characterId:X(),outcome:X(),impact:Vt(["Positive","Negative","Neutral"])})).optional(),isPublic:Tn().default(!0),dmNotes:X().max(2e3,"DM notes cannot exceed 2000 characters").optional().or(dt("")),playerVisibleNotes:X().max(1e3,"Player notes cannot exceed 1000 characters").optional().or(dt(""))}),qie=Ze({name:X().min(3,"Name must be at least 3 characters").max(100,"Name cannot exceed 100 characters"),description:X().min(1,"Description is required").max(2e3,"Description cannot exceed 2000 characters"),campaignId:X().min(1,"Campaign is required"),goals:Ae(X()).optional(),leaderNpcIds:Ae(X()).optional(),alliedFactionIds:Ae(X()).optional(),enemyFactionIds:Ae(X()).optional(),reputation:Ae(Ze({playerCharacterId:X(),score:le().min(-100,"Reputation cannot be below -100").max(100,"Reputation cannot exceed 100")})).optional(),factionType:Vt(["Government","Religious","Mercantile","Criminal","Military","Scholarly","Other"]).optional().default("Other"),influence:Vt(["Local","Regional","National","International"]).optional().default("Local"),resources:Vt(["Poor","Modest","Wealthy","Rich","Aristocratic"]).optional().default("Modest"),publicInformation:X().max(1e3,"Public information cannot exceed 1000 characters").optional().or(dt("")),factionSecrets:X().max(2e3,"Faction secrets cannot exceed 2000 characters").optional().or(dt("")),dmNotes:X().max(2e3,"DM notes cannot exceed 2000 characters").optional().or(dt(""))}),Gie=Ze({name:X().min(2,"Name must be at least 2 characters").max(100,"Name cannot exceed 100 characters"),description:X().min(1,"Description is required").max(2e3,"Description cannot exceed 2000 characters"),actionCost:Vt(["Action","Bonus Action","Reaction","No Action","Special"]),type:Vt(["MELEE_ATTACK","RANGED_ATTACK","SPELL","COMMONLY_AVAILABLE_UTILITY","CLASS_FEATURE","BONUS_ACTION","REACTION","OTHER"]),requiresConcentration:Tn(),sourceBook:X().min(1,"Source book is required").max(100),category:Vt(["general","class_specific","race_specific","feat_specific"]),attackBonusAbilityScore:X().max(50).optional(),isProficient:Tn().optional(),damageRolls:Ae(Ze({dice:Ze({count:le().min(1).max(20),type:Vt(["D4","D6","D8","D10","D12","D20"])}),modifier:le().min(-10).max(20),damageType:Vt(["BLUDGEONING","PIERCING","SLASHING","ACID","COLD","FIRE","FORCE","LIGHTNING","NECROTIC","POISON","PSYCHIC","RADIANT","THUNDER"])})).optional(),spellLevel:FL([dt(0),dt(1),dt(2),dt(3),dt(4),dt(5),dt(6),dt(7),dt(8),dt(9)]).optional(),castingTime:X().max(100).optional(),range:X().max(100).optional(),components:Ze({verbal:Tn(),somatic:Tn(),material:X().max(200).optional()}).optional(),duration:X().max(100).optional(),savingThrow:Ze({ability:X().max(50),onSave:X().max(500)}).optional(),spellEffectDescription:X().max(1e3).optional(),requiredClass:X().max(50).optional(),targetClass:X().max(50).optional(),requiredLevel:le().min(1).max(20).optional(),requiredSubclass:X().max(50).optional(),usesPer:Vt(["Short Rest","Long Rest","Day","Special"]).optional(),maxUses:FL([le(),X()]).optional(),isBaseAction:Tn().optional(),tags:Ae(X()).optional(),prerequisites:Ae(X()).optional()}),Yie=Ze({name:X().min(3,"Name must be at least 3 characters").max(100,"Name cannot exceed 100 characters"),description:X().min(1,"Description is required").max(2e3,"Description cannot exceed 2000 characters"),type:Vt(["Town","City","Village","Dungeon","Castle","Forest","Mountain","Temple","Ruins","Camp","Other"]).default("Other"),campaignId:X().optional(),notableCharacterIds:Ae(X()).optional(),linkedLocations:Ae(X()).optional(),population:le().min(0,"Population cannot be negative").optional(),government:X().max(100,"Government type cannot exceed 100 characters").optional().or(dt("")),defenses:X().max(500,"Defense description cannot exceed 500 characters").optional().or(dt("")),imageUrls:Ae(X().url("Must be a valid URL")).optional(),mapId:X().optional(),publicInformation:X().max(1e3,"Public information cannot exceed 1000 characters").optional().or(dt("")),secrets:X().max(2e3,"Secrets cannot exceed 2000 characters").optional().or(dt("")),dmNotes:X().max(2e3,"DM notes cannot exceed 2000 characters").optional().or(dt("")),interactionsAtLocation:Ae(X()).optional()}),Kie=["Tiny","Small","Medium","Large","Huge","Gargantuan"],Xie=["0","1/8","1/4","1/2","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30"],Qie=["d4","d6","d8","d10","d12"],Zie=["Weapon","Armor","Potion","Scroll","Wondrous Item","Ring","Rod","Staff","Wand","Ammunition","Adventuring Gear","Tool","Mount","Vehicle","Treasure","Other"],Jie=["Common","Uncommon","Rare","Very Rare","Legendary","Artifact","Unique"],eae=["Light","Medium","Heavy","Shield"];function BL(s){return Math.floor((s-10)/2)}function Cm(){const{user:s,isSignedIn:e}=Wc(),{isLoaded:t}=Ji();return t?!e||!s?{user:null,isSignedIn:!1,isLoading:!1}:{user:s,isSignedIn:!0,isLoading:!1}:{user:null,isSignedIn:!1,isLoading:!0}}function Sk(){const{user:s,isSignedIn:e,isLoading:t}=Cm(),n=Fe(re.users.getCurrentUser,e?{}:"skip"),r=Re(re.users.ensureAdminRole);return V.useEffect(()=>{n&&n.role==="user"&&r().catch(console.error)},[n,r]),{user:s,databaseUser:n||null,isLoading:t||e&&n===void 0,isSignedIn:e}}function aw(s,e,t){const{user:n,databaseUser:r,isLoading:a}=Sk(),o=Fe(re.campaigns.getMyCampaigns);if(a)return{user:n,databaseUser:null,canAccess:!1,isAdmin:!1,isCampaignMaster:()=>!1,isPlayer:()=>!1,isLoading:!0};if(!r)throw new Error("User profile not found. Please try refreshing the page or contact support.");const l=(()=>{var c,d;if(r.role==="admin"||e==="campaign"&&s==="create")return!0;if(t!=null&&t.campaignId){const h=o==null?void 0:o.find(p=>p._id===t.campaignId);if(!h)return!1;const f=h.dmId===r.clerkId,m=(c=h.participantUserIds)==null?void 0:c.includes(r._id);switch(s){case"read":return f||m;case"create":case"edit":return f;default:return!1}}if(e==="campaign"&&(t!=null&&t._id)){const h=o==null?void 0:o.find(m=>m._id===t._id);if(!h)return!1;const f=h.dmId===r.clerkId;switch(s){case"read":return f||((d=h.participantUserIds)==null?void 0:d.includes(r._id));case"edit":return f;default:return!1}}switch(s){case"read":return!0;case"create":return!0;case"edit":return r.role==="admin";default:return!1}})();if(!l)throw new Error(`Insufficient permissions for ${s} access to ${e}`);return{user:n,databaseUser:r,canAccess:l,isAdmin:(r==null?void 0:r.role)==="admin",isCampaignMaster:c=>{const d=o==null?void 0:o.find(h=>h._id===c);return(d==null?void 0:d.dmId)===(r==null?void 0:r.clerkId)},isPlayer:c=>{var h;const d=o==null?void 0:o.find(f=>f._id===c);return(h=d==null?void 0:d.participantUserIds)==null?void 0:h.includes((r==null?void 0:r._id)||"")},isLoading:!1}}function wS(s,[e,t]){return Math.min(t,Math.max(e,s))}const tae=["top","right","bottom","left"],Bu=Math.min,$i=Math.max,CS=Math.round,s1=Math.floor,yl=s=>({x:s,y:s}),sae={left:"right",right:"left",bottom:"top",top:"bottom"},nae={start:"end",end:"start"};function vT(s,e,t){return $i(s,Bu(e,t))}function Bc(s,e){return typeof s=="function"?s(e):s}function $c(s){return s.split("-")[0]}function Bx(s){return s.split("-")[1]}function bM(s){return s==="x"?"y":"x"}function wM(s){return s==="y"?"height":"width"}const rae=new Set(["top","bottom"]);function fl(s){return rae.has($c(s))?"y":"x"}function CM(s){return bM(fl(s))}function iae(s,e,t){t===void 0&&(t=!1);const n=Bx(s),r=CM(s),a=wM(r);let o=r==="x"?n===(t?"end":"start")?"right":"left":n==="start"?"bottom":"top";return e.reference[a]>e.floating[a]&&(o=SS(o)),[o,SS(o)]}function aae(s){const e=SS(s);return[bT(s),e,bT(e)]}function bT(s){return s.replace(/start|end/g,e=>nae[e])}const $L=["left","right"],UL=["right","left"],oae=["top","bottom"],lae=["bottom","top"];function cae(s,e,t){switch(s){case"top":case"bottom":return t?e?UL:$L:e?$L:UL;case"left":case"right":return e?oae:lae;default:return[]}}function dae(s,e,t,n){const r=Bx(s);let a=cae($c(s),t==="start",n);return r&&(a=a.map(o=>o+"-"+r),e&&(a=a.concat(a.map(bT)))),a}function SS(s){return s.replace(/left|right|bottom|top/g,e=>sae[e])}function uae(s){return{top:0,right:0,bottom:0,left:0,...s}}function A6(s){return typeof s!="number"?uae(s):{top:s,right:s,bottom:s,left:s}}function jS(s){const{x:e,y:t,width:n,height:r}=s;return{width:n,height:r,top:t,left:e,right:e+n,bottom:t+r,x:e,y:t}}function zL(s,e,t){let{reference:n,floating:r}=s;const a=fl(e),o=CM(e),l=wM(o),c=$c(e),d=a==="y",h=n.x+n.width/2-r.width/2,f=n.y+n.height/2-r.height/2,m=n[l]/2-r[l]/2;let p;switch(c){case"top":p={x:h,y:n.y-r.height};break;case"bottom":p={x:h,y:n.y+n.height};break;case"right":p={x:n.x+n.width,y:f};break;case"left":p={x:n.x-r.width,y:f};break;default:p={x:n.x,y:n.y}}switch(Bx(e)){case"start":p[o]-=m*(t&&d?-1:1);break;case"end":p[o]+=m*(t&&d?-1:1);break}return p}const hae=async(s,e,t)=>{const{placement:n="bottom",strategy:r="absolute",middleware:a=[],platform:o}=t,l=a.filter(Boolean),c=await(o.isRTL==null?void 0:o.isRTL(e));let d=await o.getElementRects({reference:s,floating:e,strategy:r}),{x:h,y:f}=zL(d,n,c),m=n,p={},x=0;for(let g=0;g<l.length;g++){const{name:b,fn:v}=l[g],{x:y,y:w,data:S,reset:j}=await v({x:h,y:f,initialPlacement:n,placement:m,strategy:r,middlewareData:p,rects:d,platform:o,elements:{reference:s,floating:e}});h=y??h,f=w??f,p={...p,[b]:{...p[b],...S}},j&&x<=50&&(x++,typeof j=="object"&&(j.placement&&(m=j.placement),j.rects&&(d=j.rects===!0?await o.getElementRects({reference:s,floating:e,strategy:r}):j.rects),{x:h,y:f}=zL(d,m,c)),g=-1)}return{x:h,y:f,placement:m,strategy:r,middlewareData:p}};async function Vv(s,e){var t;e===void 0&&(e={});const{x:n,y:r,platform:a,rects:o,elements:l,strategy:c}=s,{boundary:d="clippingAncestors",rootBoundary:h="viewport",elementContext:f="floating",altBoundary:m=!1,padding:p=0}=Bc(e,s),x=A6(p),b=l[m?f==="floating"?"reference":"floating":f],v=jS(await a.getClippingRect({element:(t=await(a.isElement==null?void 0:a.isElement(b)))==null||t?b:b.contextElement||await(a.getDocumentElement==null?void 0:a.getDocumentElement(l.floating)),boundary:d,rootBoundary:h,strategy:c})),y=f==="floating"?{x:n,y:r,width:o.floating.width,height:o.floating.height}:o.reference,w=await(a.getOffsetParent==null?void 0:a.getOffsetParent(l.floating)),S=await(a.isElement==null?void 0:a.isElement(w))?await(a.getScale==null?void 0:a.getScale(w))||{x:1,y:1}:{x:1,y:1},j=jS(a.convertOffsetParentRelativeRectToViewportRelativeRect?await a.convertOffsetParentRelativeRectToViewportRelativeRect({elements:l,rect:y,offsetParent:w,strategy:c}):y);return{top:(v.top-j.top+x.top)/S.y,bottom:(j.bottom-v.bottom+x.bottom)/S.y,left:(v.left-j.left+x.left)/S.x,right:(j.right-v.right+x.right)/S.x}}const fae=s=>({name:"arrow",options:s,async fn(e){const{x:t,y:n,placement:r,rects:a,platform:o,elements:l,middlewareData:c}=e,{element:d,padding:h=0}=Bc(s,e)||{};if(d==null)return{};const f=A6(h),m={x:t,y:n},p=CM(r),x=wM(p),g=await o.getDimensions(d),b=p==="y",v=b?"top":"left",y=b?"bottom":"right",w=b?"clientHeight":"clientWidth",S=a.reference[x]+a.reference[p]-m[p]-a.floating[x],j=m[p]-a.reference[p],A=await(o.getOffsetParent==null?void 0:o.getOffsetParent(d));let k=A?A[w]:0;(!k||!await(o.isElement==null?void 0:o.isElement(A)))&&(k=l.floating[w]||a.floating[x]);const _=S/2-j/2,L=k/2-g[x]/2-1,D=Bu(f[v],L),P=Bu(f[y],L),T=D,B=k-g[x]-P,R=k/2-g[x]/2+_,O=vT(T,R,B),I=!c.arrow&&Bx(r)!=null&&R!==O&&a.reference[x]/2-(R<T?D:P)-g[x]/2<0,U=I?R<T?R-T:R-B:0;return{[p]:m[p]+U,data:{[p]:O,centerOffset:R-O-U,...I&&{alignmentOffset:U}},reset:I}}}),mae=function(s){return s===void 0&&(s={}),{name:"flip",options:s,async fn(e){var t,n;const{placement:r,middlewareData:a,rects:o,initialPlacement:l,platform:c,elements:d}=e,{mainAxis:h=!0,crossAxis:f=!0,fallbackPlacements:m,fallbackStrategy:p="bestFit",fallbackAxisSideDirection:x="none",flipAlignment:g=!0,...b}=Bc(s,e);if((t=a.arrow)!=null&&t.alignmentOffset)return{};const v=$c(r),y=fl(l),w=$c(l)===l,S=await(c.isRTL==null?void 0:c.isRTL(d.floating)),j=m||(w||!g?[SS(l)]:aae(l)),A=x!=="none";!m&&A&&j.push(...dae(l,g,x,S));const k=[l,...j],_=await Vv(e,b),L=[];let D=((n=a.flip)==null?void 0:n.overflows)||[];if(h&&L.push(_[v]),f){const R=iae(r,o,S);L.push(_[R[0]],_[R[1]])}if(D=[...D,{placement:r,overflows:L}],!L.every(R=>R<=0)){var P,T;const R=(((P=a.flip)==null?void 0:P.index)||0)+1,O=k[R];if(O&&(!(f==="alignment"?y!==fl(O):!1)||D.every(M=>fl(M.placement)===y?M.overflows[0]>0:!0)))return{data:{index:R,overflows:D},reset:{placement:O}};let I=(T=D.filter(U=>U.overflows[0]<=0).sort((U,M)=>U.overflows[1]-M.overflows[1])[0])==null?void 0:T.placement;if(!I)switch(p){case"bestFit":{var B;const U=(B=D.filter(M=>{if(A){const $=fl(M.placement);return $===y||$==="y"}return!0}).map(M=>[M.placement,M.overflows.filter($=>$>0).reduce(($,W)=>$+W,0)]).sort((M,$)=>M[1]-$[1])[0])==null?void 0:B[0];U&&(I=U);break}case"initialPlacement":I=l;break}if(r!==I)return{reset:{placement:I}}}return{}}}};function HL(s,e){return{top:s.top-e.height,right:s.right-e.width,bottom:s.bottom-e.height,left:s.left-e.width}}function VL(s){return tae.some(e=>s[e]>=0)}const pae=function(s){return s===void 0&&(s={}),{name:"hide",options:s,async fn(e){const{rects:t}=e,{strategy:n="referenceHidden",...r}=Bc(s,e);switch(n){case"referenceHidden":{const a=await Vv(e,{...r,elementContext:"reference"}),o=HL(a,t.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:VL(o)}}}case"escaped":{const a=await Vv(e,{...r,altBoundary:!0}),o=HL(a,t.floating);return{data:{escapedOffsets:o,escaped:VL(o)}}}default:return{}}}}},_6=new Set(["left","top"]);async function gae(s,e){const{placement:t,platform:n,elements:r}=s,a=await(n.isRTL==null?void 0:n.isRTL(r.floating)),o=$c(t),l=Bx(t),c=fl(t)==="y",d=_6.has(o)?-1:1,h=a&&c?-1:1,f=Bc(e,s);let{mainAxis:m,crossAxis:p,alignmentAxis:x}=typeof f=="number"?{mainAxis:f,crossAxis:0,alignmentAxis:null}:{mainAxis:f.mainAxis||0,crossAxis:f.crossAxis||0,alignmentAxis:f.alignmentAxis};return l&&typeof x=="number"&&(p=l==="end"?x*-1:x),c?{x:p*h,y:m*d}:{x:m*d,y:p*h}}const xae=function(s){return s===void 0&&(s=0),{name:"offset",options:s,async fn(e){var t,n;const{x:r,y:a,placement:o,middlewareData:l}=e,c=await gae(e,s);return o===((t=l.offset)==null?void 0:t.placement)&&(n=l.arrow)!=null&&n.alignmentOffset?{}:{x:r+c.x,y:a+c.y,data:{...c,placement:o}}}}},yae=function(s){return s===void 0&&(s={}),{name:"shift",options:s,async fn(e){const{x:t,y:n,placement:r}=e,{mainAxis:a=!0,crossAxis:o=!1,limiter:l={fn:b=>{let{x:v,y}=b;return{x:v,y}}},...c}=Bc(s,e),d={x:t,y:n},h=await Vv(e,c),f=fl($c(r)),m=bM(f);let p=d[m],x=d[f];if(a){const b=m==="y"?"top":"left",v=m==="y"?"bottom":"right",y=p+h[b],w=p-h[v];p=vT(y,p,w)}if(o){const b=f==="y"?"top":"left",v=f==="y"?"bottom":"right",y=x+h[b],w=x-h[v];x=vT(y,x,w)}const g=l.fn({...e,[m]:p,[f]:x});return{...g,data:{x:g.x-t,y:g.y-n,enabled:{[m]:a,[f]:o}}}}}},vae=function(s){return s===void 0&&(s={}),{options:s,fn(e){const{x:t,y:n,placement:r,rects:a,middlewareData:o}=e,{offset:l=0,mainAxis:c=!0,crossAxis:d=!0}=Bc(s,e),h={x:t,y:n},f=fl(r),m=bM(f);let p=h[m],x=h[f];const g=Bc(l,e),b=typeof g=="number"?{mainAxis:g,crossAxis:0}:{mainAxis:0,crossAxis:0,...g};if(c){const w=m==="y"?"height":"width",S=a.reference[m]-a.floating[w]+b.mainAxis,j=a.reference[m]+a.reference[w]-b.mainAxis;p<S?p=S:p>j&&(p=j)}if(d){var v,y;const w=m==="y"?"width":"height",S=_6.has($c(r)),j=a.reference[f]-a.floating[w]+(S&&((v=o.offset)==null?void 0:v[f])||0)+(S?0:b.crossAxis),A=a.reference[f]+a.reference[w]+(S?0:((y=o.offset)==null?void 0:y[f])||0)-(S?b.crossAxis:0);x<j?x=j:x>A&&(x=A)}return{[m]:p,[f]:x}}}},bae=function(s){return s===void 0&&(s={}),{name:"size",options:s,async fn(e){var t,n;const{placement:r,rects:a,platform:o,elements:l}=e,{apply:c=()=>{},...d}=Bc(s,e),h=await Vv(e,d),f=$c(r),m=Bx(r),p=fl(r)==="y",{width:x,height:g}=a.floating;let b,v;f==="top"||f==="bottom"?(b=f,v=m===(await(o.isRTL==null?void 0:o.isRTL(l.floating))?"start":"end")?"left":"right"):(v=f,b=m==="end"?"top":"bottom");const y=g-h.top-h.bottom,w=x-h.left-h.right,S=Bu(g-h[b],y),j=Bu(x-h[v],w),A=!e.middlewareData.shift;let k=S,_=j;if((t=e.middlewareData.shift)!=null&&t.enabled.x&&(_=w),(n=e.middlewareData.shift)!=null&&n.enabled.y&&(k=y),A&&!m){const D=$i(h.left,0),P=$i(h.right,0),T=$i(h.top,0),B=$i(h.bottom,0);p?_=x-2*(D!==0||P!==0?D+P:$i(h.left,h.right)):k=g-2*(T!==0||B!==0?T+B:$i(h.top,h.bottom))}await c({...e,availableWidth:_,availableHeight:k});const L=await o.getDimensions(l.floating);return x!==L.width||g!==L.height?{reset:{rects:!0}}:{}}}};function jk(){return typeof window<"u"}function $x(s){return T6(s)?(s.nodeName||"").toLowerCase():"#document"}function Wi(s){var e;return(s==null||(e=s.ownerDocument)==null?void 0:e.defaultView)||window}function _l(s){var e;return(e=(T6(s)?s.ownerDocument:s.document)||window.document)==null?void 0:e.documentElement}function T6(s){return jk()?s instanceof Node||s instanceof Wi(s).Node:!1}function ko(s){return jk()?s instanceof Element||s instanceof Wi(s).Element:!1}function wl(s){return jk()?s instanceof HTMLElement||s instanceof Wi(s).HTMLElement:!1}function WL(s){return!jk()||typeof ShadowRoot>"u"?!1:s instanceof ShadowRoot||s instanceof Wi(s).ShadowRoot}const wae=new Set(["inline","contents"]);function ow(s){const{overflow:e,overflowX:t,overflowY:n,display:r}=No(s);return/auto|scroll|overlay|hidden|clip/.test(e+n+t)&&!wae.has(r)}const Cae=new Set(["table","td","th"]);function Sae(s){return Cae.has($x(s))}const jae=[":popover-open",":modal"];function kk(s){return jae.some(e=>{try{return s.matches(e)}catch{return!1}})}const kae=["transform","translate","scale","rotate","perspective"],Nae=["transform","translate","scale","rotate","perspective","filter"],Aae=["paint","layout","strict","content"];function SM(s){const e=jM(),t=ko(s)?No(s):s;return kae.some(n=>t[n]?t[n]!=="none":!1)||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||Nae.some(n=>(t.willChange||"").includes(n))||Aae.some(n=>(t.contain||"").includes(n))}function _ae(s){let e=$u(s);for(;wl(e)&&!Px(e);){if(SM(e))return e;if(kk(e))return null;e=$u(e)}return null}function jM(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const Tae=new Set(["html","body","#document"]);function Px(s){return Tae.has($x(s))}function No(s){return Wi(s).getComputedStyle(s)}function Nk(s){return ko(s)?{scrollLeft:s.scrollLeft,scrollTop:s.scrollTop}:{scrollLeft:s.scrollX,scrollTop:s.scrollY}}function $u(s){if($x(s)==="html")return s;const e=s.assignedSlot||s.parentNode||WL(s)&&s.host||_l(s);return WL(e)?e.host:e}function E6(s){const e=$u(s);return Px(e)?s.ownerDocument?s.ownerDocument.body:s.body:wl(e)&&ow(e)?e:E6(e)}function Wv(s,e,t){var n;e===void 0&&(e=[]),t===void 0&&(t=!0);const r=E6(s),a=r===((n=s.ownerDocument)==null?void 0:n.body),o=Wi(r);if(a){const l=wT(o);return e.concat(o,o.visualViewport||[],ow(r)?r:[],l&&t?Wv(l):[])}return e.concat(r,Wv(r,[],t))}function wT(s){return s.parent&&Object.getPrototypeOf(s.parent)?s.frameElement:null}function P6(s){const e=No(s);let t=parseFloat(e.width)||0,n=parseFloat(e.height)||0;const r=wl(s),a=r?s.offsetWidth:t,o=r?s.offsetHeight:n,l=CS(t)!==a||CS(n)!==o;return l&&(t=a,n=o),{width:t,height:n,$:l}}function kM(s){return ko(s)?s:s.contextElement}function _p(s){const e=kM(s);if(!wl(e))return yl(1);const t=e.getBoundingClientRect(),{width:n,height:r,$:a}=P6(e);let o=(a?CS(t.width):t.width)/n,l=(a?CS(t.height):t.height)/r;return(!o||!Number.isFinite(o))&&(o=1),(!l||!Number.isFinite(l))&&(l=1),{x:o,y:l}}const Eae=yl(0);function M6(s){const e=Wi(s);return!jM()||!e.visualViewport?Eae:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function Pae(s,e,t){return e===void 0&&(e=!1),!t||e&&t!==Wi(s)?!1:e}function dm(s,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=!1);const r=s.getBoundingClientRect(),a=kM(s);let o=yl(1);e&&(n?ko(n)&&(o=_p(n)):o=_p(s));const l=Pae(a,t,n)?M6(a):yl(0);let c=(r.left+l.x)/o.x,d=(r.top+l.y)/o.y,h=r.width/o.x,f=r.height/o.y;if(a){const m=Wi(a),p=n&&ko(n)?Wi(n):n;let x=m,g=wT(x);for(;g&&n&&p!==x;){const b=_p(g),v=g.getBoundingClientRect(),y=No(g),w=v.left+(g.clientLeft+parseFloat(y.paddingLeft))*b.x,S=v.top+(g.clientTop+parseFloat(y.paddingTop))*b.y;c*=b.x,d*=b.y,h*=b.x,f*=b.y,c+=w,d+=S,x=Wi(g),g=wT(x)}}return jS({width:h,height:f,x:c,y:d})}function Ak(s,e){const t=Nk(s).scrollLeft;return e?e.left+t:dm(_l(s)).left+t}function I6(s,e){const t=s.getBoundingClientRect(),n=t.left+e.scrollLeft-Ak(s,t),r=t.top+e.scrollTop;return{x:n,y:r}}function Mae(s){let{elements:e,rect:t,offsetParent:n,strategy:r}=s;const a=r==="fixed",o=_l(n),l=e?kk(e.floating):!1;if(n===o||l&&a)return t;let c={scrollLeft:0,scrollTop:0},d=yl(1);const h=yl(0),f=wl(n);if((f||!f&&!a)&&(($x(n)!=="body"||ow(o))&&(c=Nk(n)),wl(n))){const p=dm(n);d=_p(n),h.x=p.x+n.clientLeft,h.y=p.y+n.clientTop}const m=o&&!f&&!a?I6(o,c):yl(0);return{width:t.width*d.x,height:t.height*d.y,x:t.x*d.x-c.scrollLeft*d.x+h.x+m.x,y:t.y*d.y-c.scrollTop*d.y+h.y+m.y}}function Iae(s){return Array.from(s.getClientRects())}function Rae(s){const e=_l(s),t=Nk(s),n=s.ownerDocument.body,r=$i(e.scrollWidth,e.clientWidth,n.scrollWidth,n.clientWidth),a=$i(e.scrollHeight,e.clientHeight,n.scrollHeight,n.clientHeight);let o=-t.scrollLeft+Ak(s);const l=-t.scrollTop;return No(n).direction==="rtl"&&(o+=$i(e.clientWidth,n.clientWidth)-r),{width:r,height:a,x:o,y:l}}const qL=25;function Dae(s,e){const t=Wi(s),n=_l(s),r=t.visualViewport;let a=n.clientWidth,o=n.clientHeight,l=0,c=0;if(r){a=r.width,o=r.height;const h=jM();(!h||h&&e==="fixed")&&(l=r.offsetLeft,c=r.offsetTop)}const d=Ak(n);if(d<=0){const h=n.ownerDocument,f=h.body,m=getComputedStyle(f),p=h.compatMode==="CSS1Compat"&&parseFloat(m.marginLeft)+parseFloat(m.marginRight)||0,x=Math.abs(n.clientWidth-f.clientWidth-p);x<=qL&&(a-=x)}else d<=qL&&(a+=d);return{width:a,height:o,x:l,y:c}}const Lae=new Set(["absolute","fixed"]);function Oae(s,e){const t=dm(s,!0,e==="fixed"),n=t.top+s.clientTop,r=t.left+s.clientLeft,a=wl(s)?_p(s):yl(1),o=s.clientWidth*a.x,l=s.clientHeight*a.y,c=r*a.x,d=n*a.y;return{width:o,height:l,x:c,y:d}}function GL(s,e,t){let n;if(e==="viewport")n=Dae(s,t);else if(e==="document")n=Rae(_l(s));else if(ko(e))n=Oae(e,t);else{const r=M6(s);n={x:e.x-r.x,y:e.y-r.y,width:e.width,height:e.height}}return jS(n)}function R6(s,e){const t=$u(s);return t===e||!ko(t)||Px(t)?!1:No(t).position==="fixed"||R6(t,e)}function Fae(s,e){const t=e.get(s);if(t)return t;let n=Wv(s,[],!1).filter(l=>ko(l)&&$x(l)!=="body"),r=null;const a=No(s).position==="fixed";let o=a?$u(s):s;for(;ko(o)&&!Px(o);){const l=No(o),c=SM(o);!c&&l.position==="fixed"&&(r=null),(a?!c&&!r:!c&&l.position==="static"&&!!r&&Lae.has(r.position)||ow(o)&&!c&&R6(s,o))?n=n.filter(h=>h!==o):r=l,o=$u(o)}return e.set(s,n),n}function Bae(s){let{element:e,boundary:t,rootBoundary:n,strategy:r}=s;const o=[...t==="clippingAncestors"?kk(e)?[]:Fae(e,this._c):[].concat(t),n],l=o[0],c=o.reduce((d,h)=>{const f=GL(e,h,r);return d.top=$i(f.top,d.top),d.right=Bu(f.right,d.right),d.bottom=Bu(f.bottom,d.bottom),d.left=$i(f.left,d.left),d},GL(e,l,r));return{width:c.right-c.left,height:c.bottom-c.top,x:c.left,y:c.top}}function $ae(s){const{width:e,height:t}=P6(s);return{width:e,height:t}}function Uae(s,e,t){const n=wl(e),r=_l(e),a=t==="fixed",o=dm(s,!0,a,e);let l={scrollLeft:0,scrollTop:0};const c=yl(0);function d(){c.x=Ak(r)}if(n||!n&&!a)if(($x(e)!=="body"||ow(r))&&(l=Nk(e)),n){const p=dm(e,!0,a,e);c.x=p.x+e.clientLeft,c.y=p.y+e.clientTop}else r&&d();a&&!n&&r&&d();const h=r&&!n&&!a?I6(r,l):yl(0),f=o.left+l.scrollLeft-c.x-h.x,m=o.top+l.scrollTop-c.y-h.y;return{x:f,y:m,width:o.width,height:o.height}}function fA(s){return No(s).position==="static"}function YL(s,e){if(!wl(s)||No(s).position==="fixed")return null;if(e)return e(s);let t=s.offsetParent;return _l(s)===t&&(t=t.ownerDocument.body),t}function D6(s,e){const t=Wi(s);if(kk(s))return t;if(!wl(s)){let r=$u(s);for(;r&&!Px(r);){if(ko(r)&&!fA(r))return r;r=$u(r)}return t}let n=YL(s,e);for(;n&&Sae(n)&&fA(n);)n=YL(n,e);return n&&Px(n)&&fA(n)&&!SM(n)?t:n||_ae(s)||t}const zae=async function(s){const e=this.getOffsetParent||D6,t=this.getDimensions,n=await t(s.floating);return{reference:Uae(s.reference,await e(s.floating),s.strategy),floating:{x:0,y:0,width:n.width,height:n.height}}};function Hae(s){return No(s).direction==="rtl"}const Vae={convertOffsetParentRelativeRectToViewportRelativeRect:Mae,getDocumentElement:_l,getClippingRect:Bae,getOffsetParent:D6,getElementRects:zae,getClientRects:Iae,getDimensions:$ae,getScale:_p,isElement:ko,isRTL:Hae};function L6(s,e){return s.x===e.x&&s.y===e.y&&s.width===e.width&&s.height===e.height}function Wae(s,e){let t=null,n;const r=_l(s);function a(){var l;clearTimeout(n),(l=t)==null||l.disconnect(),t=null}function o(l,c){l===void 0&&(l=!1),c===void 0&&(c=1),a();const d=s.getBoundingClientRect(),{left:h,top:f,width:m,height:p}=d;if(l||e(),!m||!p)return;const x=s1(f),g=s1(r.clientWidth-(h+m)),b=s1(r.clientHeight-(f+p)),v=s1(h),w={rootMargin:-x+"px "+-g+"px "+-b+"px "+-v+"px",threshold:$i(0,Bu(1,c))||1};let S=!0;function j(A){const k=A[0].intersectionRatio;if(k!==c){if(!S)return o();k?o(!1,k):n=setTimeout(()=>{o(!1,1e-7)},1e3)}k===1&&!L6(d,s.getBoundingClientRect())&&o(),S=!1}try{t=new IntersectionObserver(j,{...w,root:r.ownerDocument})}catch{t=new IntersectionObserver(j,w)}t.observe(s)}return o(!0),a}function qae(s,e,t,n){n===void 0&&(n={});const{ancestorScroll:r=!0,ancestorResize:a=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:l=typeof IntersectionObserver=="function",animationFrame:c=!1}=n,d=kM(s),h=r||a?[...d?Wv(d):[],...Wv(e)]:[];h.forEach(v=>{r&&v.addEventListener("scroll",t,{passive:!0}),a&&v.addEventListener("resize",t)});const f=d&&l?Wae(d,t):null;let m=-1,p=null;o&&(p=new ResizeObserver(v=>{let[y]=v;y&&y.target===d&&p&&(p.unobserve(e),cancelAnimationFrame(m),m=requestAnimationFrame(()=>{var w;(w=p)==null||w.observe(e)})),t()}),d&&!c&&p.observe(d),p.observe(e));let x,g=c?dm(s):null;c&&b();function b(){const v=dm(s);g&&!L6(g,v)&&t(),g=v,x=requestAnimationFrame(b)}return t(),()=>{var v;h.forEach(y=>{r&&y.removeEventListener("scroll",t),a&&y.removeEventListener("resize",t)}),f==null||f(),(v=p)==null||v.disconnect(),p=null,c&&cancelAnimationFrame(x)}}const Gae=xae,Yae=yae,Kae=mae,Xae=bae,Qae=pae,KL=fae,Zae=vae,Jae=(s,e,t)=>{const n=new Map,r={platform:Vae,...t},a={...r.platform,_c:n};return hae(s,e,{...r,platform:a})};var eoe=typeof document<"u",toe=function(){},B1=eoe?C.useLayoutEffect:toe;function kS(s,e){if(s===e)return!0;if(typeof s!=typeof e)return!1;if(typeof s=="function"&&s.toString()===e.toString())return!0;let t,n,r;if(s&&e&&typeof s=="object"){if(Array.isArray(s)){if(t=s.length,t!==e.length)return!1;for(n=t;n--!==0;)if(!kS(s[n],e[n]))return!1;return!0}if(r=Object.keys(s),t=r.length,t!==Object.keys(e).length)return!1;for(n=t;n--!==0;)if(!{}.hasOwnProperty.call(e,r[n]))return!1;for(n=t;n--!==0;){const a=r[n];if(!(a==="_owner"&&s.$$typeof)&&!kS(s[a],e[a]))return!1}return!0}return s!==s&&e!==e}function O6(s){return typeof window>"u"?1:(s.ownerDocument.defaultView||window).devicePixelRatio||1}function XL(s,e){const t=O6(s);return Math.round(e*t)/t}function mA(s){const e=C.useRef(s);return B1(()=>{e.current=s}),e}function soe(s){s===void 0&&(s={});const{placement:e="bottom",strategy:t="absolute",middleware:n=[],platform:r,elements:{reference:a,floating:o}={},transform:l=!0,whileElementsMounted:c,open:d}=s,[h,f]=C.useState({x:0,y:0,strategy:t,placement:e,middlewareData:{},isPositioned:!1}),[m,p]=C.useState(n);kS(m,n)||p(n);const[x,g]=C.useState(null),[b,v]=C.useState(null),y=C.useCallback(M=>{M!==A.current&&(A.current=M,g(M))},[]),w=C.useCallback(M=>{M!==k.current&&(k.current=M,v(M))},[]),S=a||x,j=o||b,A=C.useRef(null),k=C.useRef(null),_=C.useRef(h),L=c!=null,D=mA(c),P=mA(r),T=mA(d),B=C.useCallback(()=>{if(!A.current||!k.current)return;const M={placement:e,strategy:t,middleware:m};P.current&&(M.platform=P.current),Jae(A.current,k.current,M).then($=>{const W={...$,isPositioned:T.current!==!1};R.current&&!kS(_.current,W)&&(_.current=W,Gu.flushSync(()=>{f(W)}))})},[m,e,t,P,T]);B1(()=>{d===!1&&_.current.isPositioned&&(_.current.isPositioned=!1,f(M=>({...M,isPositioned:!1})))},[d]);const R=C.useRef(!1);B1(()=>(R.current=!0,()=>{R.current=!1}),[]),B1(()=>{if(S&&(A.current=S),j&&(k.current=j),S&&j){if(D.current)return D.current(S,j,B);B()}},[S,j,B,D,L]);const O=C.useMemo(()=>({reference:A,floating:k,setReference:y,setFloating:w}),[y,w]),I=C.useMemo(()=>({reference:S,floating:j}),[S,j]),U=C.useMemo(()=>{const M={position:t,left:0,top:0};if(!I.floating)return M;const $=XL(I.floating,h.x),W=XL(I.floating,h.y);return l?{...M,transform:"translate("+$+"px, "+W+"px)",...O6(I.floating)>=1.5&&{willChange:"transform"}}:{position:t,left:$,top:W}},[t,l,I.floating,h.x,h.y]);return C.useMemo(()=>({...h,update:B,refs:O,elements:I,floatingStyles:U}),[h,B,O,I,U])}const noe=s=>{function e(t){return{}.hasOwnProperty.call(t,"current")}return{name:"arrow",options:s,fn(t){const{element:n,padding:r}=typeof s=="function"?s(t):s;return n&&e(n)?n.current!=null?KL({element:n.current,padding:r}).fn(t):{}:n?KL({element:n,padding:r}).fn(t):{}}}},roe=(s,e)=>({...Gae(s),options:[s,e]}),ioe=(s,e)=>({...Yae(s),options:[s,e]}),aoe=(s,e)=>({...Zae(s),options:[s,e]}),ooe=(s,e)=>({...Kae(s),options:[s,e]}),loe=(s,e)=>({...Xae(s),options:[s,e]}),coe=(s,e)=>({...Qae(s),options:[s,e]}),doe=(s,e)=>({...noe(s),options:[s,e]});var uoe="Arrow",F6=C.forwardRef((s,e)=>{const{children:t,width:n=10,height:r=5,...a}=s;return i.jsx(ot.svg,{...a,ref:e,width:n,height:r,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:s.asChild?t:i.jsx("polygon",{points:"0,0 30,0 15,10"})})});F6.displayName=uoe;var hoe=F6,NM="Popper",[B6,_k]=Oa(NM),[foe,$6]=B6(NM),U6=s=>{const{__scopePopper:e,children:t}=s,[n,r]=C.useState(null);return i.jsx(foe,{scope:e,anchor:n,onAnchorChange:r,children:t})};U6.displayName=NM;var z6="PopperAnchor",H6=C.forwardRef((s,e)=>{const{__scopePopper:t,virtualRef:n,...r}=s,a=$6(z6,t),o=C.useRef(null),l=Tt(e,o),c=C.useRef(null);return C.useEffect(()=>{const d=c.current;c.current=(n==null?void 0:n.current)||o.current,d!==c.current&&a.onAnchorChange(c.current)}),n?null:i.jsx(ot.div,{...r,ref:l})});H6.displayName=z6;var AM="PopperContent",[moe,poe]=B6(AM),V6=C.forwardRef((s,e)=>{var H,Y,ae,ce,Ue,te;const{__scopePopper:t,side:n="bottom",sideOffset:r=0,align:a="center",alignOffset:o=0,arrowPadding:l=0,avoidCollisions:c=!0,collisionBoundary:d=[],collisionPadding:h=0,sticky:f="partial",hideWhenDetached:m=!1,updatePositionStrategy:p="optimized",onPlaced:x,...g}=s,b=$6(AM,t),[v,y]=C.useState(null),w=Tt(e,J=>y(J)),[S,j]=C.useState(null),A=xk(S),k=(A==null?void 0:A.width)??0,_=(A==null?void 0:A.height)??0,L=n+(a!=="center"?"-"+a:""),D=typeof h=="number"?h:{top:0,right:0,bottom:0,left:0,...h},P=Array.isArray(d)?d:[d],T=P.length>0,B={padding:D,boundary:P.filter(xoe),altBoundary:T},{refs:R,floatingStyles:O,placement:I,isPositioned:U,middlewareData:M}=soe({strategy:"fixed",placement:L,whileElementsMounted:(...J)=>qae(...J,{animationFrame:p==="always"}),elements:{reference:b.anchor},middleware:[roe({mainAxis:r+_,alignmentAxis:o}),c&&ioe({mainAxis:!0,crossAxis:!1,limiter:f==="partial"?aoe():void 0,...B}),c&&ooe({...B}),loe({...B,apply:({elements:J,rects:K,availableWidth:be,availableHeight:Me})=>{const{width:De,height:_t}=K.reference,et=J.floating.style;et.setProperty("--radix-popper-available-width",`${be}px`),et.setProperty("--radix-popper-available-height",`${Me}px`),et.setProperty("--radix-popper-anchor-width",`${De}px`),et.setProperty("--radix-popper-anchor-height",`${_t}px`)}}),S&&doe({element:S,padding:l}),yoe({arrowWidth:k,arrowHeight:_}),m&&coe({strategy:"referenceHidden",...B})]}),[$,W]=G6(I),ee=bl(x);mr(()=>{U&&(ee==null||ee())},[U,ee]);const Z=(H=M.arrow)==null?void 0:H.x,z=(Y=M.arrow)==null?void 0:Y.y,se=((ae=M.arrow)==null?void 0:ae.centerOffset)!==0,[de,ne]=C.useState();return mr(()=>{v&&ne(window.getComputedStyle(v).zIndex)},[v]),i.jsx("div",{ref:R.setFloating,"data-radix-popper-content-wrapper":"",style:{...O,transform:U?O.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:de,"--radix-popper-transform-origin":[(ce=M.transformOrigin)==null?void 0:ce.x,(Ue=M.transformOrigin)==null?void 0:Ue.y].join(" "),...((te=M.hide)==null?void 0:te.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:s.dir,children:i.jsx(moe,{scope:t,placedSide:$,onArrowChange:j,arrowX:Z,arrowY:z,shouldHideArrow:se,children:i.jsx(ot.div,{"data-side":$,"data-align":W,...g,ref:w,style:{...g.style,animation:U?void 0:"none"}})})})});V6.displayName=AM;var W6="PopperArrow",goe={top:"bottom",right:"left",bottom:"top",left:"right"},q6=C.forwardRef(function(e,t){const{__scopePopper:n,...r}=e,a=poe(W6,n),o=goe[a.placedSide];return i.jsx("span",{ref:a.onArrowChange,style:{position:"absolute",left:a.arrowX,top:a.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[a.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[a.placedSide],visibility:a.shouldHideArrow?"hidden":void 0},children:i.jsx(hoe,{...r,ref:t,style:{...r.style,display:"block"}})})});q6.displayName=W6;function xoe(s){return s!==null}var yoe=s=>({name:"transformOrigin",options:s,fn(e){var b,v,y;const{placement:t,rects:n,middlewareData:r}=e,o=((b=r.arrow)==null?void 0:b.centerOffset)!==0,l=o?0:s.arrowWidth,c=o?0:s.arrowHeight,[d,h]=G6(t),f={start:"0%",center:"50%",end:"100%"}[h],m=(((v=r.arrow)==null?void 0:v.x)??0)+l/2,p=(((y=r.arrow)==null?void 0:y.y)??0)+c/2;let x="",g="";return d==="bottom"?(x=o?f:`${m}px`,g=`${-c}px`):d==="top"?(x=o?f:`${m}px`,g=`${n.floating.height+c}px`):d==="right"?(x=`${-c}px`,g=o?f:`${p}px`):d==="left"&&(x=`${n.floating.width+c}px`,g=o?f:`${p}px`),{data:{x,y:g}}}});function G6(s){const[e,t="center"]=s.split("-");return[e,t]}var Y6=U6,K6=H6,X6=V6,Q6=q6;function voe(s){const e=boe(s),t=C.forwardRef((n,r)=>{const{children:a,...o}=n,l=C.Children.toArray(a),c=l.find(Coe);if(c){const d=c.props.children,h=l.map(f=>f===c?C.Children.count(d)>1?C.Children.only(null):C.isValidElement(d)?d.props.children:null:f);return i.jsx(e,{...o,ref:r,children:C.isValidElement(d)?C.cloneElement(d,void 0,h):null})}return i.jsx(e,{...o,ref:r,children:a})});return t.displayName=`${s}.Slot`,t}function boe(s){const e=C.forwardRef((t,n)=>{const{children:r,...a}=t;if(C.isValidElement(r)){const o=joe(r),l=Soe(a,r.props);return r.type!==C.Fragment&&(l.ref=n?qc(n,o):o),C.cloneElement(r,l)}return C.Children.count(r)>1?C.Children.only(null):null});return e.displayName=`${s}.SlotClone`,e}var woe=Symbol("radix.slottable");function Coe(s){return C.isValidElement(s)&&typeof s.type=="function"&&"__radixId"in s.type&&s.type.__radixId===woe}function Soe(s,e){const t={...e};for(const n in e){const r=s[n],a=e[n];/^on[A-Z]/.test(n)?r&&a?t[n]=(...l)=>{const c=a(...l);return r(...l),c}:r&&(t[n]=r):n==="style"?t[n]={...r,...a}:n==="className"&&(t[n]=[r,a].filter(Boolean).join(" "))}return{...s,...t}}function joe(s){var n,r;let e=(n=Object.getOwnPropertyDescriptor(s.props,"ref"))==null?void 0:n.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?s.ref:(e=(r=Object.getOwnPropertyDescriptor(s,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?s.props.ref:s.props.ref||s.ref)}var Z6=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),koe="VisuallyHidden",Noe=C.forwardRef((s,e)=>i.jsx(ot.span,{...s,ref:e,style:{...Z6,...s.style}}));Noe.displayName=koe;var Aoe=[" ","Enter","ArrowUp","ArrowDown"],_oe=[" ","Enter"],um="Select",[Tk,Ek,Toe]=bk(um),[Ux]=Oa(um,[Toe,_k]),Pk=_k(),[Eoe,Xu]=Ux(um),[Poe,Moe]=Ux(um),J6=s=>{const{__scopeSelect:e,children:t,open:n,defaultOpen:r,onOpenChange:a,value:o,defaultValue:l,onValueChange:c,dir:d,name:h,autoComplete:f,disabled:m,required:p,form:x}=s,g=Pk(e),[b,v]=C.useState(null),[y,w]=C.useState(null),[S,j]=C.useState(!1),A=rw(d),[k,_]=Lc({prop:n,defaultProp:r??!1,onChange:a,caller:um}),[L,D]=Lc({prop:o,defaultProp:l,onChange:c,caller:um}),P=C.useRef(null),T=b?x||!!b.closest("form"):!0,[B,R]=C.useState(new Set),O=Array.from(B).map(I=>I.props.value).join(";");return i.jsx(Y6,{...g,children:i.jsxs(Eoe,{required:p,scope:e,trigger:b,onTriggerChange:v,valueNode:y,onValueNodeChange:w,valueNodeHasChildren:S,onValueNodeHasChildrenChange:j,contentId:gl(),value:L,onValueChange:D,open:k,onOpenChange:_,dir:A,triggerPointerDownPosRef:P,disabled:m,children:[i.jsx(Tk.Provider,{scope:e,children:i.jsx(Poe,{scope:s.__scopeSelect,onNativeOptionAdd:C.useCallback(I=>{R(U=>new Set(U).add(I))},[]),onNativeOptionRemove:C.useCallback(I=>{R(U=>{const M=new Set(U);return M.delete(I),M})},[]),children:t})}),T?i.jsxs(SU,{"aria-hidden":!0,required:p,tabIndex:-1,name:h,autoComplete:f,value:L,onChange:I=>D(I.target.value),disabled:m,form:x,children:[L===void 0?i.jsx("option",{value:""}):null,Array.from(B)]},O):null]})})};J6.displayName=um;var eU="SelectTrigger",tU=C.forwardRef((s,e)=>{const{__scopeSelect:t,disabled:n=!1,...r}=s,a=Pk(t),o=Xu(eU,t),l=o.disabled||n,c=Tt(e,o.onTriggerChange),d=Ek(t),h=C.useRef("touch"),[f,m,p]=kU(g=>{const b=d().filter(w=>!w.disabled),v=b.find(w=>w.value===o.value),y=NU(b,g,v);y!==void 0&&o.onValueChange(y.value)}),x=g=>{l||(o.onOpenChange(!0),p()),g&&(o.triggerPointerDownPosRef.current={x:Math.round(g.pageX),y:Math.round(g.pageY)})};return i.jsx(K6,{asChild:!0,...a,children:i.jsx(ot.button,{type:"button",role:"combobox","aria-controls":o.contentId,"aria-expanded":o.open,"aria-required":o.required,"aria-autocomplete":"none",dir:o.dir,"data-state":o.open?"open":"closed",disabled:l,"data-disabled":l?"":void 0,"data-placeholder":jU(o.value)?"":void 0,...r,ref:c,onClick:He(r.onClick,g=>{g.currentTarget.focus(),h.current!=="mouse"&&x(g)}),onPointerDown:He(r.onPointerDown,g=>{h.current=g.pointerType;const b=g.target;b.hasPointerCapture(g.pointerId)&&b.releasePointerCapture(g.pointerId),g.button===0&&g.ctrlKey===!1&&g.pointerType==="mouse"&&(x(g),g.preventDefault())}),onKeyDown:He(r.onKeyDown,g=>{const b=f.current!=="";!(g.ctrlKey||g.altKey||g.metaKey)&&g.key.length===1&&m(g.key),!(b&&g.key===" ")&&Aoe.includes(g.key)&&(x(),g.preventDefault())})})})});tU.displayName=eU;var sU="SelectValue",nU=C.forwardRef((s,e)=>{const{__scopeSelect:t,className:n,style:r,children:a,placeholder:o="",...l}=s,c=Xu(sU,t),{onValueNodeHasChildrenChange:d}=c,h=a!==void 0,f=Tt(e,c.onValueNodeChange);return mr(()=>{d(h)},[d,h]),i.jsx(ot.span,{...l,ref:f,style:{pointerEvents:"none"},children:jU(c.value)?i.jsx(i.Fragment,{children:o}):a})});nU.displayName=sU;var Ioe="SelectIcon",rU=C.forwardRef((s,e)=>{const{__scopeSelect:t,children:n,...r}=s;return i.jsx(ot.span,{"aria-hidden":!0,...r,ref:e,children:n||""})});rU.displayName=Ioe;var Roe="SelectPortal",iU=s=>i.jsx(Jj,{asChild:!0,...s});iU.displayName=Roe;var hm="SelectContent",aU=C.forwardRef((s,e)=>{const t=Xu(hm,s.__scopeSelect),[n,r]=C.useState();if(mr(()=>{r(new DocumentFragment)},[]),!t.open){const a=n;return a?Gu.createPortal(i.jsx(oU,{scope:s.__scopeSelect,children:i.jsx(Tk.Slot,{scope:s.__scopeSelect,children:i.jsx("div",{children:s.children})})}),a):null}return i.jsx(lU,{...s,ref:e})});aU.displayName=hm;var Ha=10,[oU,Qu]=Ux(hm),Doe="SelectContentImpl",Loe=voe("SelectContent.RemoveScroll"),lU=C.forwardRef((s,e)=>{const{__scopeSelect:t,position:n="item-aligned",onCloseAutoFocus:r,onEscapeKeyDown:a,onPointerDownOutside:o,side:l,sideOffset:c,align:d,alignOffset:h,arrowPadding:f,collisionBoundary:m,collisionPadding:p,sticky:x,hideWhenDetached:g,avoidCollisions:b,...v}=s,y=Xu(hm,t),[w,S]=C.useState(null),[j,A]=C.useState(null),k=Tt(e,H=>S(H)),[_,L]=C.useState(null),[D,P]=C.useState(null),T=Ek(t),[B,R]=C.useState(!1),O=C.useRef(!1);C.useEffect(()=>{if(w)return DP(w)},[w]),RP();const I=C.useCallback(H=>{const[Y,...ae]=T().map(te=>te.ref.current),[ce]=ae.slice(-1),Ue=document.activeElement;for(const te of H)if(te===Ue||(te==null||te.scrollIntoView({block:"nearest"}),te===Y&&j&&(j.scrollTop=0),te===ce&&j&&(j.scrollTop=j.scrollHeight),te==null||te.focus(),document.activeElement!==Ue))return},[T,j]),U=C.useCallback(()=>I([_,w]),[I,_,w]);C.useEffect(()=>{B&&U()},[B,U]);const{onOpenChange:M,triggerPointerDownPosRef:$}=y;C.useEffect(()=>{if(w){let H={x:0,y:0};const Y=ce=>{var Ue,te;H={x:Math.abs(Math.round(ce.pageX)-(((Ue=$.current)==null?void 0:Ue.x)??0)),y:Math.abs(Math.round(ce.pageY)-(((te=$.current)==null?void 0:te.y)??0))}},ae=ce=>{H.x<=10&&H.y<=10?ce.preventDefault():w.contains(ce.target)||M(!1),document.removeEventListener("pointermove",Y),$.current=null};return $.current!==null&&(document.addEventListener("pointermove",Y),document.addEventListener("pointerup",ae,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",Y),document.removeEventListener("pointerup",ae,{capture:!0})}}},[w,M,$]),C.useEffect(()=>{const H=()=>M(!1);return window.addEventListener("blur",H),window.addEventListener("resize",H),()=>{window.removeEventListener("blur",H),window.removeEventListener("resize",H)}},[M]);const[W,ee]=kU(H=>{const Y=T().filter(Ue=>!Ue.disabled),ae=Y.find(Ue=>Ue.ref.current===document.activeElement),ce=NU(Y,H,ae);ce&&setTimeout(()=>ce.ref.current.focus())}),Z=C.useCallback((H,Y,ae)=>{const ce=!O.current&&!ae;(y.value!==void 0&&y.value===Y||ce)&&(L(H),ce&&(O.current=!0))},[y.value]),z=C.useCallback(()=>w==null?void 0:w.focus(),[w]),se=C.useCallback((H,Y,ae)=>{const ce=!O.current&&!ae;(y.value!==void 0&&y.value===Y||ce)&&P(H)},[y.value]),de=n==="popper"?CT:cU,ne=de===CT?{side:l,sideOffset:c,align:d,alignOffset:h,arrowPadding:f,collisionBoundary:m,collisionPadding:p,sticky:x,hideWhenDetached:g,avoidCollisions:b}:{};return i.jsx(oU,{scope:t,content:w,viewport:j,onViewportChange:A,itemRefCallback:Z,selectedItem:_,onItemLeave:z,itemTextRefCallback:se,focusSelectedItem:U,selectedItemText:D,position:n,isPositioned:B,searchRef:W,children:i.jsx(tk,{as:Loe,allowPinchZoom:!0,children:i.jsx(Zj,{asChild:!0,trapped:y.open,onMountAutoFocus:H=>{H.preventDefault()},onUnmountAutoFocus:He(r,H=>{var Y;(Y=y.trigger)==null||Y.focus({preventScroll:!0}),H.preventDefault()}),children:i.jsx(Qj,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:a,onPointerDownOutside:o,onFocusOutside:H=>H.preventDefault(),onDismiss:()=>y.onOpenChange(!1),children:i.jsx(de,{role:"listbox",id:y.contentId,"data-state":y.open?"open":"closed",dir:y.dir,onContextMenu:H=>H.preventDefault(),...v,...ne,onPlaced:()=>R(!0),ref:k,style:{display:"flex",flexDirection:"column",outline:"none",...v.style},onKeyDown:He(v.onKeyDown,H=>{const Y=H.ctrlKey||H.altKey||H.metaKey;if(H.key==="Tab"&&H.preventDefault(),!Y&&H.key.length===1&&ee(H.key),["ArrowUp","ArrowDown","Home","End"].includes(H.key)){let ce=T().filter(Ue=>!Ue.disabled).map(Ue=>Ue.ref.current);if(["ArrowUp","End"].includes(H.key)&&(ce=ce.slice().reverse()),["ArrowUp","ArrowDown"].includes(H.key)){const Ue=H.target,te=ce.indexOf(Ue);ce=ce.slice(te+1)}setTimeout(()=>I(ce)),H.preventDefault()}})})})})})})});lU.displayName=Doe;var Ooe="SelectItemAlignedPosition",cU=C.forwardRef((s,e)=>{const{__scopeSelect:t,onPlaced:n,...r}=s,a=Xu(hm,t),o=Qu(hm,t),[l,c]=C.useState(null),[d,h]=C.useState(null),f=Tt(e,k=>h(k)),m=Ek(t),p=C.useRef(!1),x=C.useRef(!0),{viewport:g,selectedItem:b,selectedItemText:v,focusSelectedItem:y}=o,w=C.useCallback(()=>{if(a.trigger&&a.valueNode&&l&&d&&g&&b&&v){const k=a.trigger.getBoundingClientRect(),_=d.getBoundingClientRect(),L=a.valueNode.getBoundingClientRect(),D=v.getBoundingClientRect();if(a.dir!=="rtl"){const Ue=D.left-_.left,te=L.left-Ue,J=k.left-te,K=k.width+J,be=Math.max(K,_.width),Me=window.innerWidth-Ha,De=wS(te,[Ha,Math.max(Ha,Me-be)]);l.style.minWidth=K+"px",l.style.left=De+"px"}else{const Ue=_.right-D.right,te=window.innerWidth-L.right-Ue,J=window.innerWidth-k.right-te,K=k.width+J,be=Math.max(K,_.width),Me=window.innerWidth-Ha,De=wS(te,[Ha,Math.max(Ha,Me-be)]);l.style.minWidth=K+"px",l.style.right=De+"px"}const P=m(),T=window.innerHeight-Ha*2,B=g.scrollHeight,R=window.getComputedStyle(d),O=parseInt(R.borderTopWidth,10),I=parseInt(R.paddingTop,10),U=parseInt(R.borderBottomWidth,10),M=parseInt(R.paddingBottom,10),$=O+I+B+M+U,W=Math.min(b.offsetHeight*5,$),ee=window.getComputedStyle(g),Z=parseInt(ee.paddingTop,10),z=parseInt(ee.paddingBottom,10),se=k.top+k.height/2-Ha,de=T-se,ne=b.offsetHeight/2,H=b.offsetTop+ne,Y=O+I+H,ae=$-Y;if(Y<=se){const Ue=P.length>0&&b===P[P.length-1].ref.current;l.style.bottom="0px";const te=d.clientHeight-g.offsetTop-g.offsetHeight,J=Math.max(de,ne+(Ue?z:0)+te+U),K=Y+J;l.style.height=K+"px"}else{const Ue=P.length>0&&b===P[0].ref.current;l.style.top="0px";const J=Math.max(se,O+g.offsetTop+(Ue?Z:0)+ne)+ae;l.style.height=J+"px",g.scrollTop=Y-se+g.offsetTop}l.style.margin=`${Ha}px 0`,l.style.minHeight=W+"px",l.style.maxHeight=T+"px",n==null||n(),requestAnimationFrame(()=>p.current=!0)}},[m,a.trigger,a.valueNode,l,d,g,b,v,a.dir,n]);mr(()=>w(),[w]);const[S,j]=C.useState();mr(()=>{d&&j(window.getComputedStyle(d).zIndex)},[d]);const A=C.useCallback(k=>{k&&x.current===!0&&(w(),y==null||y(),x.current=!1)},[w,y]);return i.jsx(Boe,{scope:t,contentWrapper:l,shouldExpandOnScrollRef:p,onScrollButtonChange:A,children:i.jsx("div",{ref:c,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:S},children:i.jsx(ot.div,{...r,ref:f,style:{boxSizing:"border-box",maxHeight:"100%",...r.style}})})})});cU.displayName=Ooe;var Foe="SelectPopperPosition",CT=C.forwardRef((s,e)=>{const{__scopeSelect:t,align:n="start",collisionPadding:r=Ha,...a}=s,o=Pk(t);return i.jsx(X6,{...o,...a,ref:e,align:n,collisionPadding:r,style:{boxSizing:"border-box",...a.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});CT.displayName=Foe;var[Boe,_M]=Ux(hm,{}),ST="SelectViewport",dU=C.forwardRef((s,e)=>{const{__scopeSelect:t,nonce:n,...r}=s,a=Qu(ST,t),o=_M(ST,t),l=Tt(e,a.onViewportChange),c=C.useRef(0);return i.jsxs(i.Fragment,{children:[i.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),i.jsx(Tk.Slot,{scope:t,children:i.jsx(ot.div,{"data-radix-select-viewport":"",role:"presentation",...r,ref:l,style:{position:"relative",flex:1,overflow:"hidden auto",...r.style},onScroll:He(r.onScroll,d=>{const h=d.currentTarget,{contentWrapper:f,shouldExpandOnScrollRef:m}=o;if(m!=null&&m.current&&f){const p=Math.abs(c.current-h.scrollTop);if(p>0){const x=window.innerHeight-Ha*2,g=parseFloat(f.style.minHeight),b=parseFloat(f.style.height),v=Math.max(g,b);if(v<x){const y=v+p,w=Math.min(x,y),S=y-w;f.style.height=w+"px",f.style.bottom==="0px"&&(h.scrollTop=S>0?S:0,f.style.justifyContent="flex-end")}}}c.current=h.scrollTop})})})]})});dU.displayName=ST;var uU="SelectGroup",[$oe,Uoe]=Ux(uU),zoe=C.forwardRef((s,e)=>{const{__scopeSelect:t,...n}=s,r=gl();return i.jsx($oe,{scope:t,id:r,children:i.jsx(ot.div,{role:"group","aria-labelledby":r,...n,ref:e})})});zoe.displayName=uU;var hU="SelectLabel",fU=C.forwardRef((s,e)=>{const{__scopeSelect:t,...n}=s,r=Uoe(hU,t);return i.jsx(ot.div,{id:r.id,...n,ref:e})});fU.displayName=hU;var NS="SelectItem",[Hoe,mU]=Ux(NS),pU=C.forwardRef((s,e)=>{const{__scopeSelect:t,value:n,disabled:r=!1,textValue:a,...o}=s,l=Xu(NS,t),c=Qu(NS,t),d=l.value===n,[h,f]=C.useState(a??""),[m,p]=C.useState(!1),x=Tt(e,y=>{var w;return(w=c.itemRefCallback)==null?void 0:w.call(c,y,n,r)}),g=gl(),b=C.useRef("touch"),v=()=>{r||(l.onValueChange(n),l.onOpenChange(!1))};if(n==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return i.jsx(Hoe,{scope:t,value:n,disabled:r,textId:g,isSelected:d,onItemTextChange:C.useCallback(y=>{f(w=>w||((y==null?void 0:y.textContent)??"").trim())},[]),children:i.jsx(Tk.ItemSlot,{scope:t,value:n,disabled:r,textValue:h,children:i.jsx(ot.div,{role:"option","aria-labelledby":g,"data-highlighted":m?"":void 0,"aria-selected":d&&m,"data-state":d?"checked":"unchecked","aria-disabled":r||void 0,"data-disabled":r?"":void 0,tabIndex:r?void 0:-1,...o,ref:x,onFocus:He(o.onFocus,()=>p(!0)),onBlur:He(o.onBlur,()=>p(!1)),onClick:He(o.onClick,()=>{b.current!=="mouse"&&v()}),onPointerUp:He(o.onPointerUp,()=>{b.current==="mouse"&&v()}),onPointerDown:He(o.onPointerDown,y=>{b.current=y.pointerType}),onPointerMove:He(o.onPointerMove,y=>{var w;b.current=y.pointerType,r?(w=c.onItemLeave)==null||w.call(c):b.current==="mouse"&&y.currentTarget.focus({preventScroll:!0})}),onPointerLeave:He(o.onPointerLeave,y=>{var w;y.currentTarget===document.activeElement&&((w=c.onItemLeave)==null||w.call(c))}),onKeyDown:He(o.onKeyDown,y=>{var S;((S=c.searchRef)==null?void 0:S.current)!==""&&y.key===" "||(_oe.includes(y.key)&&v(),y.key===" "&&y.preventDefault())})})})})});pU.displayName=NS;var wy="SelectItemText",gU=C.forwardRef((s,e)=>{const{__scopeSelect:t,className:n,style:r,...a}=s,o=Xu(wy,t),l=Qu(wy,t),c=mU(wy,t),d=Moe(wy,t),[h,f]=C.useState(null),m=Tt(e,v=>f(v),c.onItemTextChange,v=>{var y;return(y=l.itemTextRefCallback)==null?void 0:y.call(l,v,c.value,c.disabled)}),p=h==null?void 0:h.textContent,x=C.useMemo(()=>i.jsx("option",{value:c.value,disabled:c.disabled,children:p},c.value),[c.disabled,c.value,p]),{onNativeOptionAdd:g,onNativeOptionRemove:b}=d;return mr(()=>(g(x),()=>b(x)),[g,b,x]),i.jsxs(i.Fragment,{children:[i.jsx(ot.span,{id:c.textId,...a,ref:m}),c.isSelected&&o.valueNode&&!o.valueNodeHasChildren?Gu.createPortal(a.children,o.valueNode):null]})});gU.displayName=wy;var xU="SelectItemIndicator",yU=C.forwardRef((s,e)=>{const{__scopeSelect:t,...n}=s;return mU(xU,t).isSelected?i.jsx(ot.span,{"aria-hidden":!0,...n,ref:e}):null});yU.displayName=xU;var jT="SelectScrollUpButton",vU=C.forwardRef((s,e)=>{const t=Qu(jT,s.__scopeSelect),n=_M(jT,s.__scopeSelect),[r,a]=C.useState(!1),o=Tt(e,n.onScrollButtonChange);return mr(()=>{if(t.viewport&&t.isPositioned){let l=function(){const d=c.scrollTop>0;a(d)};const c=t.viewport;return l(),c.addEventListener("scroll",l),()=>c.removeEventListener("scroll",l)}},[t.viewport,t.isPositioned]),r?i.jsx(wU,{...s,ref:o,onAutoScroll:()=>{const{viewport:l,selectedItem:c}=t;l&&c&&(l.scrollTop=l.scrollTop-c.offsetHeight)}}):null});vU.displayName=jT;var kT="SelectScrollDownButton",bU=C.forwardRef((s,e)=>{const t=Qu(kT,s.__scopeSelect),n=_M(kT,s.__scopeSelect),[r,a]=C.useState(!1),o=Tt(e,n.onScrollButtonChange);return mr(()=>{if(t.viewport&&t.isPositioned){let l=function(){const d=c.scrollHeight-c.clientHeight,h=Math.ceil(c.scrollTop)<d;a(h)};const c=t.viewport;return l(),c.addEventListener("scroll",l),()=>c.removeEventListener("scroll",l)}},[t.viewport,t.isPositioned]),r?i.jsx(wU,{...s,ref:o,onAutoScroll:()=>{const{viewport:l,selectedItem:c}=t;l&&c&&(l.scrollTop=l.scrollTop+c.offsetHeight)}}):null});bU.displayName=kT;var wU=C.forwardRef((s,e)=>{const{__scopeSelect:t,onAutoScroll:n,...r}=s,a=Qu("SelectScrollButton",t),o=C.useRef(null),l=Ek(t),c=C.useCallback(()=>{o.current!==null&&(window.clearInterval(o.current),o.current=null)},[]);return C.useEffect(()=>()=>c(),[c]),mr(()=>{var h;const d=l().find(f=>f.ref.current===document.activeElement);(h=d==null?void 0:d.ref.current)==null||h.scrollIntoView({block:"nearest"})},[l]),i.jsx(ot.div,{"aria-hidden":!0,...r,ref:e,style:{flexShrink:0,...r.style},onPointerDown:He(r.onPointerDown,()=>{o.current===null&&(o.current=window.setInterval(n,50))}),onPointerMove:He(r.onPointerMove,()=>{var d;(d=a.onItemLeave)==null||d.call(a),o.current===null&&(o.current=window.setInterval(n,50))}),onPointerLeave:He(r.onPointerLeave,()=>{c()})})}),Voe="SelectSeparator",CU=C.forwardRef((s,e)=>{const{__scopeSelect:t,...n}=s;return i.jsx(ot.div,{"aria-hidden":!0,...n,ref:e})});CU.displayName=Voe;var NT="SelectArrow",Woe=C.forwardRef((s,e)=>{const{__scopeSelect:t,...n}=s,r=Pk(t),a=Xu(NT,t),o=Qu(NT,t);return a.open&&o.position==="popper"?i.jsx(Q6,{...r,...n,ref:e}):null});Woe.displayName=NT;var qoe="SelectBubbleInput",SU=C.forwardRef(({__scopeSelect:s,value:e,...t},n)=>{const r=C.useRef(null),a=Tt(n,r),o=gk(e);return C.useEffect(()=>{const l=r.current;if(!l)return;const c=window.HTMLSelectElement.prototype,h=Object.getOwnPropertyDescriptor(c,"value").set;if(o!==e&&h){const f=new Event("change",{bubbles:!0});h.call(l,e),l.dispatchEvent(f)}},[o,e]),i.jsx(ot.select,{...t,style:{...Z6,...t.style},ref:a,defaultValue:e})});SU.displayName=qoe;function jU(s){return s===""||s===void 0}function kU(s){const e=bl(s),t=C.useRef(""),n=C.useRef(0),r=C.useCallback(o=>{const l=t.current+o;e(l),function c(d){t.current=d,window.clearTimeout(n.current),d!==""&&(n.current=window.setTimeout(()=>c(""),1e3))}(l)},[e]),a=C.useCallback(()=>{t.current="",window.clearTimeout(n.current)},[]);return C.useEffect(()=>()=>window.clearTimeout(n.current),[]),[t,r,a]}function NU(s,e,t){const r=e.length>1&&Array.from(e).every(d=>d===e[0])?e[0]:e,a=t?s.indexOf(t):-1;let o=Goe(s,Math.max(a,0));r.length===1&&(o=o.filter(d=>d!==t));const c=o.find(d=>d.textValue.toLowerCase().startsWith(r.toLowerCase()));return c!==t?c:void 0}function Goe(s,e){return s.map((t,n)=>s[(e+n)%s.length])}var Yoe=J6,AU=tU,Koe=nU,Xoe=rU,Qoe=iU,_U=aU,Zoe=dU,TU=fU,EU=pU,Joe=gU,ele=yU,PU=vU,MU=bU,IU=CU;const wt=Yoe,Ct=Koe,gt=C.forwardRef(({className:s,children:e,...t},n)=>i.jsxs(AU,{ref:n,className:Ee("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...t,children:[e,i.jsx(Xoe,{asChild:!0,children:i.jsx(tM,{className:"h-4 w-4 opacity-50"})})]}));gt.displayName=AU.displayName;const RU=C.forwardRef(({className:s,...e},t)=>i.jsx(PU,{ref:t,className:Ee("flex cursor-default items-center justify-center py-1",s),...e,children:i.jsx(v$,{className:"h-4 w-4"})}));RU.displayName=PU.displayName;const DU=C.forwardRef(({className:s,...e},t)=>i.jsx(MU,{ref:t,className:Ee("flex cursor-default items-center justify-center py-1",s),...e,children:i.jsx(tM,{className:"h-4 w-4"})}));DU.displayName=MU.displayName;const xt=C.forwardRef(({className:s,children:e,position:t="popper",...n},r)=>i.jsx(Qoe,{children:i.jsxs(_U,{ref:r,className:Ee("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:t,...n,children:[i.jsx(RU,{}),i.jsx(Zoe,{className:Ee("p-1",t==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:e}),i.jsx(DU,{})]})}));xt.displayName=_U.displayName;const tle=C.forwardRef(({className:s,...e},t)=>i.jsx(TU,{ref:t,className:Ee("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...e}));tle.displayName=TU.displayName;const Ie=C.forwardRef(({className:s,children:e,...t},n)=>i.jsxs(EU,{ref:n,className:Ee("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...t,children:[i.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:i.jsx(ele,{children:i.jsx(eM,{className:"h-4 w-4"})})}),i.jsx(Joe,{children:e})]}));Ie.displayName=EU.displayName;const sle=C.forwardRef(({className:s,...e},t)=>i.jsx(IU,{ref:t,className:Ee("-mx-1 my-1 h-px bg-muted",s),...e}));sle.displayName=IU.displayName;var Mk="Checkbox",[nle]=Oa(Mk),[rle,TM]=nle(Mk);function ile(s){const{__scopeCheckbox:e,checked:t,children:n,defaultChecked:r,disabled:a,form:o,name:l,onCheckedChange:c,required:d,value:h="on",internal_do_not_use_render:f}=s,[m,p]=Lc({prop:t,defaultProp:r??!1,onChange:c,caller:Mk}),[x,g]=C.useState(null),[b,v]=C.useState(null),y=C.useRef(!1),w=x?!!o||!!x.closest("form"):!0,S={checked:m,disabled:a,setChecked:p,control:x,setControl:g,name:l,form:o,value:h,hasConsumerStoppedPropagationRef:y,required:d,defaultChecked:Eu(r)?!1:r,isFormControl:w,bubbleInput:b,setBubbleInput:v};return i.jsx(rle,{scope:e,...S,children:ale(f)?f(S):n})}var LU="CheckboxTrigger",OU=C.forwardRef(({__scopeCheckbox:s,onKeyDown:e,onClick:t,...n},r)=>{const{control:a,value:o,disabled:l,checked:c,required:d,setControl:h,setChecked:f,hasConsumerStoppedPropagationRef:m,isFormControl:p,bubbleInput:x}=TM(LU,s),g=Tt(r,h),b=C.useRef(c);return C.useEffect(()=>{const v=a==null?void 0:a.form;if(v){const y=()=>f(b.current);return v.addEventListener("reset",y),()=>v.removeEventListener("reset",y)}},[a,f]),i.jsx(ot.button,{type:"button",role:"checkbox","aria-checked":Eu(c)?"mixed":c,"aria-required":d,"data-state":zU(c),"data-disabled":l?"":void 0,disabled:l,value:o,...n,ref:g,onKeyDown:He(e,v=>{v.key==="Enter"&&v.preventDefault()}),onClick:He(t,v=>{f(y=>Eu(y)?!0:!y),x&&p&&(m.current=v.isPropagationStopped(),m.current||v.stopPropagation())})})});OU.displayName=LU;var EM=C.forwardRef((s,e)=>{const{__scopeCheckbox:t,name:n,checked:r,defaultChecked:a,required:o,disabled:l,value:c,onCheckedChange:d,form:h,...f}=s;return i.jsx(ile,{__scopeCheckbox:t,checked:r,defaultChecked:a,disabled:l,required:o,onCheckedChange:d,name:n,form:h,value:c,internal_do_not_use_render:({isFormControl:m})=>i.jsxs(i.Fragment,{children:[i.jsx(OU,{...f,ref:e,__scopeCheckbox:t}),m&&i.jsx(UU,{__scopeCheckbox:t})]})})});EM.displayName=Mk;var FU="CheckboxIndicator",BU=C.forwardRef((s,e)=>{const{__scopeCheckbox:t,forceMount:n,...r}=s,a=TM(FU,t);return i.jsx(jl,{present:n||Eu(a.checked)||a.checked===!0,children:i.jsx(ot.span,{"data-state":zU(a.checked),"data-disabled":a.disabled?"":void 0,...r,ref:e,style:{pointerEvents:"none",...s.style}})})});BU.displayName=FU;var $U="CheckboxBubbleInput",UU=C.forwardRef(({__scopeCheckbox:s,...e},t)=>{const{control:n,hasConsumerStoppedPropagationRef:r,checked:a,defaultChecked:o,required:l,disabled:c,name:d,value:h,form:f,bubbleInput:m,setBubbleInput:p}=TM($U,s),x=Tt(t,p),g=gk(a),b=xk(n);C.useEffect(()=>{const y=m;if(!y)return;const w=window.HTMLInputElement.prototype,j=Object.getOwnPropertyDescriptor(w,"checked").set,A=!r.current;if(g!==a&&j){const k=new Event("click",{bubbles:A});y.indeterminate=Eu(a),j.call(y,Eu(a)?!1:a),y.dispatchEvent(k)}},[m,g,a,r]);const v=C.useRef(Eu(a)?!1:a);return i.jsx(ot.input,{type:"checkbox","aria-hidden":!0,defaultChecked:o??v.current,required:l,disabled:c,name:d,value:h,form:f,...e,tabIndex:-1,ref:x,style:{...e.style,...b,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});UU.displayName=$U;function ale(s){return typeof s=="function"}function Eu(s){return s==="indeterminate"}function zU(s){return Eu(s)?"indeterminate":s?"checked":"unchecked"}const ii=C.forwardRef(({className:s,...e},t)=>i.jsx(EM,{ref:t,className:Ee("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...e,children:i.jsx(BU,{className:Ee("flex items-center justify-center text-current"),children:i.jsx(eM,{className:"h-4 w-4"})})}));ii.displayName=EM.displayName;const pA=[{value:"Fetch",label:"Fetch Quest",icon:hl,description:"Retrieve specific items or objects"},{value:"Kill",label:"Elimination",icon:ci,description:"Defeat enemies or creatures"},{value:"Speak",label:"Dialogue",icon:Cs,description:"Communicate with specific NPCs"},{value:"Explore",label:"Exploration",icon:Mn,description:"Discover new locations or areas"},{value:"Puzzle",label:"Puzzle",icon:sM,description:"Solve riddles or mechanical puzzles"},{value:"Deliver",label:"Delivery",icon:ik,description:"Transport items to destinations"},{value:"Escort",label:"Escort",icon:Cs,description:"Protect and guide NPCs safely"},{value:"Custom",label:"Custom Task",icon:ci,description:"Custom objective defined by DM"}],gA=[{value:"NotStarted",label:"Not Started",icon:sM,variant:"outline"},{value:"InProgress",label:"In Progress",icon:Ra,variant:"secondary"},{value:"Completed",label:"Completed",icon:Yi,variant:"default"},{value:"Failed",label:"Failed",icon:E$,variant:"destructive"}];function ole({questId:s,mode:e,readOnly:t=!1}){const{user:n}=Cm(),[r,a]=C.useState(null),[o,l]=C.useState(!1),[c,d]=C.useState("create"),h=Fe(re.questTasks.getQuestTasks,s?{questId:s}:"skip");Fe(re.characters.getCharacters),Fe(re.locations.getLocations),Fe(re.items.getItems);const f=Re(re.questTasks.createQuestTask),m=Re(re.questTasks.updateQuestTask),p=Re(re.questTasks.deleteQuestTask),x=kl({resolver:Nl(Bie),defaultValues:{title:"",description:"",type:"Custom",status:"NotStarted",dependsOn:[],assignedTo:[],locationId:void 0,targetNpcId:void 0,requiredItemIds:[],completionNotes:""}});V.useEffect(()=>{r&&(c==="edit"||c==="view")?x.reset({title:r.title,description:r.description||"",type:r.type,status:r.status,dependsOn:r.dependsOn||[],assignedTo:r.assignedTo||[],locationId:r.locationId||void 0,targetNpcId:r.targetNpcId||void 0,requiredItemIds:r.requiredItemIds||[],completionNotes:r.completionNotes||""}):c==="create"&&x.reset({title:"",description:"",type:"Custom",status:"NotStarted",dependsOn:[],assignedTo:[],locationId:void 0,targetNpcId:void 0,requiredItemIds:[],completionNotes:""})},[r,c,x]);const g=()=>{a(null),d("create"),l(!0)},b=k=>{a(k),d("edit"),l(!0)},v=k=>{a(k),d("view"),l(!0)},y=async k=>{try{await p({id:k}),rt.success("Task deleted successfully!")}catch(_){console.error("Failed to delete task:",_),rt.error("Failed to delete task. Please try again.")}},w=async k=>{if(!s){rt.error("Quest ID is required to create tasks");return}try{c==="create"?(await f({questId:s,...k}),rt.success("Task created successfully!")):c==="edit"&&r&&(await m({id:r._id,...k}),rt.success("Task updated successfully!")),l(!1),x.reset()}catch(_){console.error("Failed to save task:",_),rt.error("Failed to save task. Please try again.")}},S=k=>{const _=pA.find(L=>L.value===k);return _?_.icon:ci},j=k=>gA.find(_=>_.value===k)||gA[0],A=!t&&(e==="create"||e==="edit");return s?i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold",children:"Quest Tasks"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Break down the quest into manageable tasks"})]}),A&&i.jsxs(q,{onClick:g,size:"sm",children:[i.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Add Task"]})]}),i.jsx("div",{className:"space-y-3",children:(h==null?void 0:h.length)===0?i.jsx(oe,{children:i.jsxs(he,{className:"py-8 text-center",children:[i.jsx(ci,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),i.jsx("p",{className:"text-lg font-medium",children:"No Tasks Yet"}),i.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Break this quest down into specific tasks to track progress"}),A&&i.jsxs(q,{onClick:g,variant:"outline",children:[i.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Create First Task"]})]})}):h==null?void 0:h.map(k=>{var P;const _=S(k.type),L=j(k.status),D=L.icon;return i.jsx(oe,{className:"transition-all hover:shadow-md",children:i.jsx(he,{className:"p-4",children:i.jsxs("div",{className:"flex items-start justify-between gap-4",children:[i.jsxs("div",{className:"flex items-start gap-3 flex-1",children:[i.jsx("div",{className:"mt-0.5",children:i.jsx(_,{className:"h-5 w-5 text-muted-foreground"})}),i.jsxs("div",{className:"flex-1 min-w-0",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx("h4",{className:"font-medium truncate",children:k.title}),i.jsxs(ue,{variant:L.variant,children:[i.jsx(D,{className:"h-3 w-3 mr-1"}),L.label]}),i.jsx(ue,{variant:"outline",className:"text-xs",children:(P=pA.find(T=>T.value===k.type))==null?void 0:P.label})]}),k.description&&i.jsx("p",{className:"text-sm text-muted-foreground mb-2 line-clamp-2",children:k.description}),i.jsxs("div",{className:"flex flex-wrap gap-2 text-xs text-muted-foreground",children:[k.assignedTo&&k.assignedTo.length>0&&i.jsxs("span",{className:"flex items-center gap-1",children:[i.jsx(Cs,{className:"h-3 w-3"}),k.assignedTo.length," assigned"]}),k.locationId&&i.jsxs("span",{className:"flex items-center gap-1",children:[i.jsx(Mn,{className:"h-3 w-3"}),"Location set"]}),k.dependsOn&&k.dependsOn.length>0&&i.jsxs("span",{className:"flex items-center gap-1",children:[i.jsx(ik,{className:"h-3 w-3"}),k.dependsOn.length," dependencies"]})]})]})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(q,{variant:"ghost",size:"sm",onClick:()=>v(k),children:"View"}),A&&i.jsxs(i.Fragment,{children:[i.jsx(q,{variant:"ghost",size:"sm",onClick:()=>b(k),children:i.jsx(hS,{className:"h-4 w-4"})}),i.jsxs(g$,{children:[i.jsx(ane,{asChild:!0,children:i.jsx(q,{variant:"ghost",size:"sm",children:i.jsx(kx,{className:"h-4 w-4"})})}),i.jsxs(GP,{children:[i.jsxs(YP,{children:[i.jsx(XP,{children:"Delete Task"}),i.jsxs(QP,{children:['Are you sure you want to delete "',k.title,'"? This action cannot be undone.']})]}),i.jsxs(KP,{children:[i.jsx(JP,{children:"Cancel"}),i.jsx(ZP,{onClick:()=>y(k._id),className:"bg-destructive text-destructive-foreground",children:"Delete"})]})]})]})]})]})]})})},k._id)})}),i.jsx(cs,{open:o,onOpenChange:l,children:i.jsxs(is,{className:"max-w-2xl",children:[i.jsxs(Rs,{children:[i.jsx(Ds,{children:c==="create"?"Create Task":c==="edit"?"Edit Task":"Task Details"}),i.jsx(Lr,{children:c==="create"?"Add a new task to this quest":c==="edit"?"Modify task details":"View task information"})]}),i.jsx(Al,{...x,children:i.jsxs("form",{onSubmit:x.handleSubmit(w),className:"space-y-4",children:[i.jsx(pe,{control:x.control,name:"title",render:({field:k})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Task Title *"}),i.jsx(ge,{children:i.jsx(_e,{...k,disabled:c==="view",placeholder:"Enter task title..."})}),i.jsx(ye,{})]})}),i.jsx(pe,{control:x.control,name:"description",render:({field:k})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Description"}),i.jsx(ge,{children:i.jsx(ps,{...k,disabled:c==="view",placeholder:"Describe what needs to be done...",rows:3})}),i.jsx(ye,{})]})}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsx(pe,{control:x.control,name:"type",render:({field:k})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Task Type"}),i.jsxs(wt,{onValueChange:k.onChange,defaultValue:k.value,disabled:c==="view",children:[i.jsx(ge,{children:i.jsx(gt,{children:i.jsx(Ct,{placeholder:"Select type"})})}),i.jsx(xt,{children:pA.map(_=>i.jsx(Ie,{value:_.value,children:_.label},_.value))})]}),i.jsx(ye,{})]})}),i.jsx(pe,{control:x.control,name:"status",render:({field:k})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Status"}),i.jsxs(wt,{onValueChange:k.onChange,defaultValue:k.value,disabled:c==="view",children:[i.jsx(ge,{children:i.jsx(gt,{children:i.jsx(Ct,{placeholder:"Select status"})})}),i.jsx(xt,{children:gA.map(_=>i.jsx(Ie,{value:_.value,children:_.label},_.value))})]}),i.jsx(ye,{})]})})]}),c==="view"&&(r==null?void 0:r.completionNotes)&&i.jsxs("div",{children:[i.jsx(st,{children:"Completion Notes"}),i.jsx("p",{className:"text-sm text-muted-foreground mt-1 p-3 bg-muted rounded",children:r.completionNotes})]}),c!=="view"&&i.jsx(pe,{control:x.control,name:"completionNotes",render:({field:k})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Completion Notes"}),i.jsx(ge,{children:i.jsx(ps,{...k,placeholder:"Notes about task completion...",rows:2})}),i.jsx(ye,{})]})})]})}),i.jsx(Xn,{children:c==="view"?i.jsx(q,{variant:"outline",onClick:()=>l(!1),children:"Close"}):i.jsxs(i.Fragment,{children:[i.jsx(q,{variant:"outline",onClick:()=>l(!1),children:"Cancel"}),i.jsx(q,{onClick:x.handleSubmit(w),children:c==="create"?"Create Task":"Save Changes"})]})})]})})]}):i.jsxs("div",{className:"text-center text-muted-foreground py-8",children:[i.jsx(lm,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),i.jsx("p",{className:"text-lg",children:"Quest Required"}),i.jsx("p",{className:"text-sm",children:"Save the quest first to manage tasks"})]})}function lw(){const s=qK(re.gptGeneration.generateEntity),[e,t]=C.useState(!1);return{generate:async(r,a)=>{t(!0);try{return await s({entityType:r,additionalContext:a})}catch(o){return console.error("Error generating entity:",o),{success:!1,error:o.message||"Failed to generate entity"}}finally{t(!1)}},isGenerating:e}}const lle=[{value:"idle",label:"Not Started",description:"Quest has not been initiated",icon:Ra},{value:"in_progress",label:"In Progress",description:"Quest is currently active",icon:ci},{value:"completed",label:"Completed",description:"Quest has been successfully completed",icon:Yi},{value:"NotStarted",label:"Pending",description:"Quest awaiting activation",icon:Ra},{value:"InProgress",label:"Active",description:"Quest is actively being pursued",icon:ci},{value:"Failed",label:"Failed",description:"Quest has failed or been abandoned",icon:Na}],QL=[{value:"Main",label:"Main Quest",description:"Critical story quest",icon:Ru},{value:"Side",label:"Side Quest",description:"Optional additional content",icon:Co},{value:"Personal",label:"Personal Quest",description:"Character backstory related",icon:Cs},{value:"Guild",label:"Guild Quest",description:"Organization-specific mission",icon:wo},{value:"Faction",label:"Faction Quest",description:"Faction-related objective",icon:uv}],ZL=[{value:"Easy",label:"Easy",description:"Low challenge, suitable for new players",icon:Co},{value:"Medium",label:"Medium",description:"Moderate challenge",icon:Co},{value:"Hard",label:"Hard",description:"High challenge, experienced players",icon:Co},{value:"Deadly",label:"Deadly",description:"Extreme challenge, risk of character death",icon:Na}];function HU({open:s,onOpenChange:e,mode:t,quest:n,onSuccess:r,defaultTab:a="basic"}){const[o,l]=V.useState(!1);if(V.useEffect(()=>{o&&(console.error("QuestModal encountered an error, resetting state"),l(!1))},[o]),o)return i.jsx(cs,{open:s,onOpenChange:e,children:i.jsxs(is,{className:"max-w-md",children:[i.jsxs(Rs,{children:[i.jsx(Ds,{children:"Error"}),i.jsx(Lr,{children:"An error occurred while loading the quest modal. Please try again."})]}),i.jsxs(Xn,{children:[i.jsx(q,{onClick:()=>l(!1),children:"Retry"}),i.jsx(q,{variant:"outline",onClick:()=>e(!1),children:"Close"})]})]})});const{user:c,isLoading:d}=Cm();if(d)return i.jsx(cs,{open:s,onOpenChange:e,children:i.jsx(is,{children:i.jsx("div",{className:"flex items-center justify-center py-8",children:i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900"}),i.jsx("span",{children:"Loading..."})]})})})});if(!c)return null;const{canAccess:h,isCampaignMaster:f,isAdmin:m}=aw(t,"quest",n),[p,x]=C.useState(a),[g,b]=C.useState(!1),v=Fe(re.campaigns.getMyCampaigns)||[],y=Fe(re.characters.getCharacters)||[],w=Fe(re.locations.getLocations)||[],S=Fe(re.items.getItems)||[],j=Fe(re.timeline.getTimelineEventsByCampaign,n!=null&&n.campaignId?{campaignId:n.campaignId}:"skip")||[],A=Fe(re.quests.getQuestsByCampaign,n!=null&&n.campaignId?{campaignId:n.campaignId}:"skip")||[],k=Re(re.quests.createQuest),_=Re(re.quests.updateQuest),{generate:L,isGenerating:D}=lw(),P=t==="read",T=t==="create",B=t==="edit",R=async()=>{var M;try{rt.info("Generating quest with GPT...",{duration:2e3});const $=await L("quest");$.success&&$.data?(O.reset({name:$.data.name||"",description:$.data.description||"",campaignId:O.getValues("campaignId")||"__no_campaign__",status:$.data.status||"idle",questType:$.data.questType||"Side",difficulty:$.data.difficulty,estimatedSessions:$.data.estimatedSessions,timelineEventId:"__no_timeline_event__",completionXP:$.data.completionXP||((M=$.data.rewards)==null?void 0:M.xp),rewards:$.data.rewards||{xp:void 0,gold:void 0,itemIds:[]},involvedCharacterIds:[],requiredLevel:$.data.requiredLevel,dmNotes:$.data.dmNotes||"",playerNotes:[],isRepeatable:$.data.isRepeatable||!1,prerequisiteQuestIds:[],locationId:"__no_location__"}),rt.success("Quest generated successfully! Review and adjust as needed.",{duration:3e3})):rt.error($.error||"Failed to generate quest")}catch($){rt.error($.message||"Failed to generate quest")}},O=kl({resolver:Nl($ie),defaultValues:{name:(n==null?void 0:n.name)||"",description:(n==null?void 0:n.description)||"",campaignId:(n==null?void 0:n.campaignId)||"__no_campaign__",status:(n==null?void 0:n.status)||"idle",questType:(n==null?void 0:n.questType)||"Side",difficulty:(n==null?void 0:n.difficulty)||void 0,estimatedSessions:(n==null?void 0:n.estimatedSessions)||void 0,timelineEventId:(n==null?void 0:n.timelineEventId)||"__no_timeline_event__",completionXP:(n==null?void 0:n.completionXP)||void 0,rewards:(n==null?void 0:n.rewards)||{xp:void 0,gold:void 0,itemIds:[]},involvedCharacterIds:(n==null?void 0:n.involvedCharacterIds)||[],requiredLevel:(n==null?void 0:n.requiredLevel)||void 0,dmNotes:(n==null?void 0:n.dmNotes)||"",playerNotes:(n==null?void 0:n.playerNotes)||[],isRepeatable:(n==null?void 0:n.isRepeatable)||!1,prerequisiteQuestIds:(n==null?void 0:n.prerequisiteQuestIds)||[],locationId:(n==null?void 0:n.locationId)||"__no_location__"}});V.useEffect(()=>{n&&(t==="edit"||t==="read")&&O.reset({name:n.name,description:n.description||"",campaignId:n.campaignId||"__no_campaign__",status:n.status,questType:n.questType||"Side",difficulty:n.difficulty||void 0,estimatedSessions:n.estimatedSessions||void 0,timelineEventId:n.timelineEventId||"__no_timeline_event__",completionXP:n.completionXP||void 0,rewards:n.rewards||{xp:void 0,gold:void 0,itemIds:[]},involvedCharacterIds:n.involvedCharacterIds||[],requiredLevel:n.requiredLevel||void 0,dmNotes:n.dmNotes||"",playerNotes:n.playerNotes||[],isRepeatable:n.isRepeatable||!1,prerequisiteQuestIds:n.prerequisiteQuestIds||[],locationId:n.locationId||"__no_location__"})},[n,t,O]);const I=async M=>{var $,W,ee,Z,z,se,de;b(!0);try{const ne={...M,campaignId:M.campaignId==="__no_campaign__"?void 0:M.campaignId,locationId:M.locationId==="__no_location__"?void 0:M.locationId,timelineEventId:M.timelineEventId==="__no_timeline_event__"?void 0:M.timelineEventId,rewards:($=M.rewards)!=null&&$.xp||(W=M.rewards)!=null&&W.gold||(Z=(ee=M.rewards)==null?void 0:ee.itemIds)!=null&&Z.length?M.rewards:void 0,involvedCharacterIds:(z=M.involvedCharacterIds)!=null&&z.length?M.involvedCharacterIds:void 0,playerNotes:(se=M.playerNotes)!=null&&se.filter(Boolean).length?M.playerNotes:void 0,prerequisiteQuestIds:(de=M.prerequisiteQuestIds)!=null&&de.length?M.prerequisiteQuestIds:void 0};T?(await k(ne),rt.success("Quest created successfully!")):B&&n&&(await _({id:n._id,...ne}),rt.success("Quest updated successfully!")),r==null||r(),e(!1)}catch(ne){console.error("Failed to save quest:",ne),rt.error(`Failed to ${T?"create":"update"} quest. Please try again.`)}finally{b(!1)}},U=()=>{switch(t){case"create":return"Create Quest";case"edit":return"Edit Quest";case"read":return"Quest Details";default:return"Quest"}};return i.jsx(cs,{open:s,onOpenChange:e,children:i.jsx(is,{className:"max-w-4xl max-h-[90vh] overflow-hidden",children:i.jsxs(V.Suspense,{fallback:i.jsx("div",{className:"flex items-center justify-center h-64",children:i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(Ss,{className:"h-6 w-6 animate-spin"}),i.jsx("span",{children:"Loading..."})]})}),children:[i.jsx(Rs,{children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsxs(Ds,{className:"flex items-center gap-2",children:[i.jsx(ci,{className:"h-5 w-5"}),U()]}),i.jsxs(Lr,{children:[t==="read"&&"View quest details and progress",t==="create"&&"Create a new quest for your campaign",t==="edit"&&"Modify quest details and settings"]})]}),t==="create"&&i.jsx(q,{type:"button",variant:"outline",size:"sm",onClick:R,disabled:D||g,className:"ml-4",children:D?i.jsxs(i.Fragment,{children:[i.jsx(Ss,{className:"mr-2 h-4 w-4 animate-spin"}),"Generating..."]}):i.jsxs(i.Fragment,{children:[i.jsx(Aa,{className:"mr-2 h-4 w-4"}),"Generate with GPT"]})})]})}),i.jsxs(Qn,{value:p,onValueChange:x,className:"flex-1 overflow-hidden",children:[i.jsxs(In,{className:"grid w-full grid-cols-5",children:[i.jsxs(Be,{value:"basic",className:"flex items-center gap-2",children:[i.jsx(wo,{className:"h-4 w-4"}),"Basic Info"]}),i.jsxs(Be,{value:"tasks",className:"flex items-center gap-2",children:[i.jsx(wne,{className:"h-4 w-4"}),"Tasks"]}),i.jsxs(Be,{value:"relationships",className:"flex items-center gap-2",children:[i.jsx(bne,{className:"h-4 w-4"}),"Relationships"]}),i.jsxs(Be,{value:"rewards",className:"flex items-center gap-2",children:[i.jsx(T$,{className:"h-4 w-4"}),"Rewards"]}),i.jsxs(Be,{value:"notes",className:"flex items-center gap-2",children:[i.jsx(aM,{className:"h-4 w-4"}),"Notes"]})]}),i.jsx("div",{className:"overflow-y-auto flex-1 mt-4",children:i.jsx(Al,{...O,children:i.jsxs("form",{onSubmit:O.handleSubmit(I),className:"space-y-6",children:[i.jsx($e,{value:"basic",className:"space-y-6 m-0",children:i.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[i.jsx(pe,{control:O.control,name:"name",render:({field:M})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Quest Name *"}),i.jsx(ge,{children:i.jsx(_e,{...M,disabled:P,placeholder:"Enter quest name..."})}),i.jsx(ye,{})]})}),i.jsx(pe,{control:O.control,name:"description",render:({field:M})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Description"}),i.jsx(ge,{children:i.jsx(ps,{...M,disabled:P,placeholder:"Describe the quest objective and background...",rows:4})}),i.jsx(ye,{})]})}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsx(pe,{control:O.control,name:"campaignId",render:({field:M})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Campaign"}),i.jsxs(wt,{onValueChange:M.onChange,defaultValue:M.value,disabled:P,children:[i.jsx(ge,{children:i.jsx(gt,{children:i.jsx(Ct,{placeholder:"Select campaign"})})}),i.jsxs(xt,{children:[i.jsx(Ie,{value:"__no_campaign__",children:"No Campaign"}),v&&v.length>0&&v.map($=>i.jsx(Ie,{value:$._id,children:$.name},$._id))]})]}),i.jsx(ye,{})]})}),i.jsx(pe,{control:O.control,name:"status",render:({field:M})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Status"}),i.jsxs(wt,{onValueChange:M.onChange,defaultValue:M.value,disabled:P,children:[i.jsx(ge,{children:i.jsx(gt,{children:i.jsx(Ct,{placeholder:"Select status"})})}),i.jsx(xt,{children:lle.map($=>i.jsx(Ie,{value:$.value,children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx($.icon,{className:"h-4 w-4"}),$.label]})},$.value))})]}),i.jsx(ye,{})]})})]}),i.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[i.jsx(pe,{control:O.control,name:"questType",render:({field:M})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Quest Type"}),i.jsxs(wt,{onValueChange:M.onChange,defaultValue:M.value,disabled:P,children:[i.jsx(ge,{children:i.jsx(gt,{children:i.jsx(Ct,{placeholder:"Select type"})})}),i.jsx(xt,{children:QL&&QL.map($=>i.jsx(Ie,{value:$.value,children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx($.icon,{className:"h-4 w-4"}),$.label]})},$.value))})]}),i.jsx(ye,{})]})}),i.jsx(pe,{control:O.control,name:"difficulty",render:({field:M})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Difficulty"}),i.jsxs(wt,{onValueChange:M.onChange,defaultValue:M.value,disabled:P,children:[i.jsx(ge,{children:i.jsx(gt,{children:i.jsx(Ct,{placeholder:"Select difficulty"})})}),i.jsx(xt,{children:ZL&&ZL.map($=>i.jsx(Ie,{value:$.value,children:$.label},$.value))})]}),i.jsx(ye,{})]})}),i.jsx(pe,{control:O.control,name:"estimatedSessions",render:({field:M})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Est. Sessions"}),i.jsx(ge,{children:i.jsx(_e,{...M,type:"number",min:"1",max:"20",disabled:P,placeholder:"Sessions",onChange:$=>M.onChange($.target.value?Number($.target.value):void 0),value:M.value||""})}),i.jsx(ye,{})]})})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsx(pe,{control:O.control,name:"locationId",render:({field:M})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Primary Location"}),i.jsxs(wt,{onValueChange:M.onChange,defaultValue:M.value,disabled:P,children:[i.jsx(ge,{children:i.jsx(gt,{children:i.jsx(Ct,{placeholder:"Select location"})})}),i.jsxs(xt,{children:[i.jsx(Ie,{value:"__no_location__",children:"No Location"}),w&&w.length>0&&w.map($=>i.jsx(Ie,{value:$._id,children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Mn,{className:"h-4 w-4"}),$.name]})},$._id))]})]}),i.jsx(ye,{})]})}),i.jsx(pe,{control:O.control,name:"requiredLevel",render:({field:M})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Required Level"}),i.jsx(ge,{children:i.jsx(_e,{...M,type:"number",min:"1",max:"20",disabled:P,placeholder:"Level",onChange:$=>M.onChange($.target.value?Number($.target.value):void 0),value:M.value||""})}),i.jsx(ye,{})]})})]}),i.jsx(pe,{control:O.control,name:"isRepeatable",render:({field:M})=>i.jsxs(fe,{className:"flex flex-row items-start space-x-3 space-y-0",children:[i.jsx(ge,{children:i.jsx(ii,{checked:M.value,onCheckedChange:M.onChange,disabled:P})}),i.jsxs("div",{className:"space-y-1 leading-none",children:[i.jsx(me,{children:"Repeatable Quest"}),i.jsx(nt,{children:"This quest can be completed multiple times by different characters"})]})]})})]})}),i.jsx($e,{value:"tasks",className:"space-y-6 m-0",children:i.jsx(ole,{questId:n==null?void 0:n._id,mode:t,readOnly:P})}),i.jsx($e,{value:"relationships",className:"space-y-6 m-0",children:i.jsxs("div",{className:"space-y-6",children:[i.jsx(pe,{control:O.control,name:"timelineEventId",render:({field:M})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Linked Timeline Event"}),i.jsxs(wt,{onValueChange:M.onChange,defaultValue:M.value,disabled:P,children:[i.jsx(ge,{children:i.jsx(gt,{children:i.jsx(Ct,{placeholder:"Select timeline event"})})}),i.jsxs(xt,{children:[i.jsx(Ie,{value:"__no_timeline_event__",children:"No Timeline Event"}),j==null?void 0:j.map($=>i.jsx(Ie,{value:$._id,children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Ac,{className:"h-4 w-4"}),$.title]})},$._id))]})]}),i.jsx(nt,{children:"Link this quest to a specific timeline event for narrative flow"}),i.jsx(ye,{})]})}),i.jsx(pe,{control:O.control,name:"involvedCharacterIds",render:({field:M})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Involved NPCs"}),i.jsx(nt,{children:"Select NPCs that play important roles in this quest"}),i.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-40 overflow-y-auto border rounded p-2",children:y==null?void 0:y.filter($=>$.characterType==="npc").map($=>{var W;return i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(ii,{checked:((W=M.value)==null?void 0:W.includes($._id))||!1,onCheckedChange:ee=>{if(P)return;const Z=M.value||[];ee?M.onChange([...Z,$._id]):M.onChange(Z.filter(z=>z!==$._id))},disabled:P}),i.jsx(st,{className:"text-sm font-normal",children:$.name})]},$._id)})}),i.jsx(ye,{})]})}),i.jsx(pe,{control:O.control,name:"prerequisiteQuestIds",render:({field:M})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Prerequisite Quests"}),i.jsx(nt,{children:"Quests that must be completed before this quest can be started"}),i.jsx("div",{className:"grid grid-cols-1 gap-2 max-h-40 overflow-y-auto border rounded p-2",children:A==null?void 0:A.filter($=>$._id!==(n==null?void 0:n._id)).map($=>{var W;return i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(ii,{checked:((W=M.value)==null?void 0:W.includes($._id))||!1,onCheckedChange:ee=>{if(P)return;const Z=M.value||[];ee?M.onChange([...Z,$._id]):M.onChange(Z.filter(z=>z!==$._id))},disabled:P}),i.jsx(st,{className:"text-sm font-normal",children:$.name})]},$._id)})}),i.jsx(ye,{})]})})]})}),i.jsx($e,{value:"rewards",className:"space-y-6 m-0",children:i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsx(pe,{control:O.control,name:"completionXP",render:({field:M})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Base Completion XP"}),i.jsx(ge,{children:i.jsx(_e,{...M,type:"number",min:"0",disabled:P,placeholder:"XP awarded for quest completion",onChange:$=>M.onChange($.target.value?Number($.target.value):void 0),value:M.value||""})}),i.jsx(ye,{})]})}),i.jsx(pe,{control:O.control,name:"rewards.gold",render:({field:M})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Gold Reward"}),i.jsx(ge,{children:i.jsx(_e,{...M,type:"number",min:"0",disabled:P,placeholder:"Gold pieces awarded",onChange:$=>M.onChange($.target.value?Number($.target.value):void 0),value:M.value||""})}),i.jsx(ye,{})]})})]}),i.jsx(pe,{control:O.control,name:"rewards.xp",render:({field:M})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Bonus XP Reward"}),i.jsx(ge,{children:i.jsx(_e,{...M,type:"number",min:"0",disabled:P,placeholder:"Additional XP beyond base completion XP",onChange:$=>M.onChange($.target.value?Number($.target.value):void 0),value:M.value||""})}),i.jsx(nt,{children:"Extra XP for exceptional performance or bonus objectives"}),i.jsx(ye,{})]})}),i.jsx(pe,{control:O.control,name:"rewards.itemIds",render:({field:M})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Item Rewards"}),i.jsx(nt,{children:"Items that will be awarded upon quest completion"}),i.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-40 overflow-y-auto border rounded p-2",children:S==null?void 0:S.map($=>{var W;return i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(ii,{checked:((W=M.value)==null?void 0:W.includes($._id))||!1,onCheckedChange:ee=>{if(P)return;const Z=M.value||[];ee?M.onChange([...Z,$._id]):M.onChange(Z.filter(z=>z!==$._id))},disabled:P}),i.jsxs(st,{className:"text-sm font-normal",children:[$.name," (",$.rarity,")"]})]},$._id)})}),i.jsx(ye,{})]})})]})}),i.jsx($e,{value:"notes",className:"space-y-6 m-0",children:i.jsxs("div",{className:"space-y-6",children:[i.jsx(pe,{control:O.control,name:"dmNotes",render:({field:M})=>i.jsxs(fe,{children:[i.jsx(me,{children:"DM Notes"}),i.jsx(ge,{children:i.jsx(ps,{...M,disabled:P,placeholder:"Private notes for the Dungeon Master...",rows:6,className:"font-mono text-sm"})}),i.jsx(nt,{children:"These notes are only visible to DMs and administrators"}),i.jsx(ye,{})]})}),i.jsxs("div",{children:[i.jsx(st,{children:"Player-Visible Notes"}),i.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Add notes and clues that players can see about this quest"}),!P&&i.jsxs("div",{className:"space-y-2",children:[(O.watch("playerNotes")||[]).map((M,$)=>i.jsxs("div",{className:"flex gap-2",children:[i.jsx(_e,{value:M,onChange:W=>{const ee=O.getValues("playerNotes")||[];ee[$]=W.target.value,O.setValue("playerNotes",ee)},placeholder:"Player note or clue...",className:"flex-1",disabled:P}),i.jsx(q,{type:"button",variant:"outline",size:"sm",onClick:()=>{const W=O.getValues("playerNotes")||[];W.splice($,1),O.setValue("playerNotes",W)},children:i.jsx(Mr,{className:"h-4 w-4"})})]},$)),i.jsxs(q,{type:"button",variant:"outline",size:"sm",onClick:()=>{const M=O.getValues("playerNotes")||[];M.push(""),O.setValue("playerNotes",M)},children:[i.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Add Player Note"]})]}),P&&i.jsxs("div",{className:"space-y-2",children:[((n==null?void 0:n.playerNotes)||[]).map((M,$)=>i.jsx("div",{className:"p-3 bg-muted rounded text-sm",children:M},$)),(!(n!=null&&n.playerNotes)||n.playerNotes.length===0)&&i.jsx("p",{className:"text-sm text-muted-foreground italic",children:"No player notes available"})]})]})]})})]})})})]}),i.jsxs(Xn,{children:[t==="read"&&i.jsx(q,{variant:"outline",onClick:()=>e(!1),children:"Close"}),(t==="create"||t==="edit")&&i.jsxs(i.Fragment,{children:[i.jsx(q,{variant:"outline",onClick:()=>e(!1),children:"Cancel"}),i.jsxs(q,{onClick:O.handleSubmit(I),disabled:g,children:[g&&i.jsx(Ss,{className:"mr-2 h-4 w-4 animate-spin"}),t==="create"?"Create Quest":"Save Changes"]})]})]})]})})})}function fm(s){if(s===null||s===!0||s===!1)return NaN;var e=Number(s);return isNaN(e)?e:e<0?Math.ceil(e):Math.floor(e)}function Br(s,e){if(e.length<s)throw new TypeError(s+" argument"+(s>1?"s":"")+" required, but only "+e.length+" present")}function Tl(s){Br(1,arguments);var e=Object.prototype.toString.call(s);return s instanceof Date||cS(s)==="object"&&e==="[object Date]"?new Date(s.getTime()):typeof s=="number"||e==="[object Number]"?new Date(s):((typeof s=="string"||e==="[object String]")&&typeof console<"u"&&(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://github.com/date-fns/date-fns/blob/master/docs/upgradeGuide.md#string-arguments"),console.warn(new Error().stack)),new Date(NaN))}function cle(s,e){Br(2,arguments);var t=Tl(s).getTime(),n=fm(e);return new Date(t+n)}var dle={};function Ik(){return dle}function ule(s){var e=new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds(),s.getMilliseconds()));return e.setUTCFullYear(s.getFullYear()),s.getTime()-e.getTime()}function hle(s){return Br(1,arguments),s instanceof Date||cS(s)==="object"&&Object.prototype.toString.call(s)==="[object Date]"}function fle(s){if(Br(1,arguments),!hle(s)&&typeof s!="number")return!1;var e=Tl(s);return!isNaN(Number(e))}function mle(s,e){Br(2,arguments);var t=fm(e);return cle(s,-t)}var ple=864e5;function gle(s){Br(1,arguments);var e=Tl(s),t=e.getTime();e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0);var n=e.getTime(),r=t-n;return Math.floor(r/ple)+1}function AS(s){Br(1,arguments);var e=1,t=Tl(s),n=t.getUTCDay(),r=(n<e?7:0)+n-e;return t.setUTCDate(t.getUTCDate()-r),t.setUTCHours(0,0,0,0),t}function VU(s){Br(1,arguments);var e=Tl(s),t=e.getUTCFullYear(),n=new Date(0);n.setUTCFullYear(t+1,0,4),n.setUTCHours(0,0,0,0);var r=AS(n),a=new Date(0);a.setUTCFullYear(t,0,4),a.setUTCHours(0,0,0,0);var o=AS(a);return e.getTime()>=r.getTime()?t+1:e.getTime()>=o.getTime()?t:t-1}function xle(s){Br(1,arguments);var e=VU(s),t=new Date(0);t.setUTCFullYear(e,0,4),t.setUTCHours(0,0,0,0);var n=AS(t);return n}var yle=6048e5;function vle(s){Br(1,arguments);var e=Tl(s),t=AS(e).getTime()-xle(e).getTime();return Math.round(t/yle)+1}function _S(s,e){var t,n,r,a,o,l,c,d;Br(1,arguments);var h=Ik(),f=fm((t=(n=(r=(a=e==null?void 0:e.weekStartsOn)!==null&&a!==void 0?a:e==null||(o=e.locale)===null||o===void 0||(l=o.options)===null||l===void 0?void 0:l.weekStartsOn)!==null&&r!==void 0?r:h.weekStartsOn)!==null&&n!==void 0?n:(c=h.locale)===null||c===void 0||(d=c.options)===null||d===void 0?void 0:d.weekStartsOn)!==null&&t!==void 0?t:0);if(!(f>=0&&f<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var m=Tl(s),p=m.getUTCDay(),x=(p<f?7:0)+p-f;return m.setUTCDate(m.getUTCDate()-x),m.setUTCHours(0,0,0,0),m}function WU(s,e){var t,n,r,a,o,l,c,d;Br(1,arguments);var h=Tl(s),f=h.getUTCFullYear(),m=Ik(),p=fm((t=(n=(r=(a=e==null?void 0:e.firstWeekContainsDate)!==null&&a!==void 0?a:e==null||(o=e.locale)===null||o===void 0||(l=o.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&r!==void 0?r:m.firstWeekContainsDate)!==null&&n!==void 0?n:(c=m.locale)===null||c===void 0||(d=c.options)===null||d===void 0?void 0:d.firstWeekContainsDate)!==null&&t!==void 0?t:1);if(!(p>=1&&p<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var x=new Date(0);x.setUTCFullYear(f+1,0,p),x.setUTCHours(0,0,0,0);var g=_S(x,e),b=new Date(0);b.setUTCFullYear(f,0,p),b.setUTCHours(0,0,0,0);var v=_S(b,e);return h.getTime()>=g.getTime()?f+1:h.getTime()>=v.getTime()?f:f-1}function ble(s,e){var t,n,r,a,o,l,c,d;Br(1,arguments);var h=Ik(),f=fm((t=(n=(r=(a=e==null?void 0:e.firstWeekContainsDate)!==null&&a!==void 0?a:e==null||(o=e.locale)===null||o===void 0||(l=o.options)===null||l===void 0?void 0:l.firstWeekContainsDate)!==null&&r!==void 0?r:h.firstWeekContainsDate)!==null&&n!==void 0?n:(c=h.locale)===null||c===void 0||(d=c.options)===null||d===void 0?void 0:d.firstWeekContainsDate)!==null&&t!==void 0?t:1),m=WU(s,e),p=new Date(0);p.setUTCFullYear(m,0,f),p.setUTCHours(0,0,0,0);var x=_S(p,e);return x}var wle=6048e5;function Cle(s,e){Br(1,arguments);var t=Tl(s),n=_S(t,e).getTime()-ble(t,e).getTime();return Math.round(n/wle)+1}function Qt(s,e){for(var t=s<0?"-":"",n=Math.abs(s).toString();n.length<e;)n="0"+n;return t+n}var Jc={y:function(e,t){var n=e.getUTCFullYear(),r=n>0?n:1-n;return Qt(t==="yy"?r%100:r,t.length)},M:function(e,t){var n=e.getUTCMonth();return t==="M"?String(n+1):Qt(n+1,2)},d:function(e,t){return Qt(e.getUTCDate(),t.length)},a:function(e,t){var n=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return n==="am"?"a.m.":"p.m."}},h:function(e,t){return Qt(e.getUTCHours()%12||12,t.length)},H:function(e,t){return Qt(e.getUTCHours(),t.length)},m:function(e,t){return Qt(e.getUTCMinutes(),t.length)},s:function(e,t){return Qt(e.getUTCSeconds(),t.length)},S:function(e,t){var n=t.length,r=e.getUTCMilliseconds(),a=Math.floor(r*Math.pow(10,n-3));return Qt(a,t.length)}},Rm={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Sle={G:function(e,t,n){var r=e.getUTCFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(r,{width:"abbreviated"});case"GGGGG":return n.era(r,{width:"narrow"});case"GGGG":default:return n.era(r,{width:"wide"})}},y:function(e,t,n){if(t==="yo"){var r=e.getUTCFullYear(),a=r>0?r:1-r;return n.ordinalNumber(a,{unit:"year"})}return Jc.y(e,t)},Y:function(e,t,n,r){var a=WU(e,r),o=a>0?a:1-a;if(t==="YY"){var l=o%100;return Qt(l,2)}return t==="Yo"?n.ordinalNumber(o,{unit:"year"}):Qt(o,t.length)},R:function(e,t){var n=VU(e);return Qt(n,t.length)},u:function(e,t){var n=e.getUTCFullYear();return Qt(n,t.length)},Q:function(e,t,n){var r=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"Q":return String(r);case"QQ":return Qt(r,2);case"Qo":return n.ordinalNumber(r,{unit:"quarter"});case"QQQ":return n.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(r,{width:"wide",context:"formatting"})}},q:function(e,t,n){var r=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"q":return String(r);case"qq":return Qt(r,2);case"qo":return n.ordinalNumber(r,{unit:"quarter"});case"qqq":return n.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(r,{width:"wide",context:"standalone"})}},M:function(e,t,n){var r=e.getUTCMonth();switch(t){case"M":case"MM":return Jc.M(e,t);case"Mo":return n.ordinalNumber(r+1,{unit:"month"});case"MMM":return n.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(r,{width:"wide",context:"formatting"})}},L:function(e,t,n){var r=e.getUTCMonth();switch(t){case"L":return String(r+1);case"LL":return Qt(r+1,2);case"Lo":return n.ordinalNumber(r+1,{unit:"month"});case"LLL":return n.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(r,{width:"wide",context:"standalone"})}},w:function(e,t,n,r){var a=Cle(e,r);return t==="wo"?n.ordinalNumber(a,{unit:"week"}):Qt(a,t.length)},I:function(e,t,n){var r=vle(e);return t==="Io"?n.ordinalNumber(r,{unit:"week"}):Qt(r,t.length)},d:function(e,t,n){return t==="do"?n.ordinalNumber(e.getUTCDate(),{unit:"date"}):Jc.d(e,t)},D:function(e,t,n){var r=gle(e);return t==="Do"?n.ordinalNumber(r,{unit:"dayOfYear"}):Qt(r,t.length)},E:function(e,t,n){var r=e.getUTCDay();switch(t){case"E":case"EE":case"EEE":return n.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(r,{width:"short",context:"formatting"});case"EEEE":default:return n.day(r,{width:"wide",context:"formatting"})}},e:function(e,t,n,r){var a=e.getUTCDay(),o=(a-r.weekStartsOn+8)%7||7;switch(t){case"e":return String(o);case"ee":return Qt(o,2);case"eo":return n.ordinalNumber(o,{unit:"day"});case"eee":return n.day(a,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(a,{width:"short",context:"formatting"});case"eeee":default:return n.day(a,{width:"wide",context:"formatting"})}},c:function(e,t,n,r){var a=e.getUTCDay(),o=(a-r.weekStartsOn+8)%7||7;switch(t){case"c":return String(o);case"cc":return Qt(o,t.length);case"co":return n.ordinalNumber(o,{unit:"day"});case"ccc":return n.day(a,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(a,{width:"narrow",context:"standalone"});case"cccccc":return n.day(a,{width:"short",context:"standalone"});case"cccc":default:return n.day(a,{width:"wide",context:"standalone"})}},i:function(e,t,n){var r=e.getUTCDay(),a=r===0?7:r;switch(t){case"i":return String(a);case"ii":return Qt(a,t.length);case"io":return n.ordinalNumber(a,{unit:"day"});case"iii":return n.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(r,{width:"short",context:"formatting"});case"iiii":default:return n.day(r,{width:"wide",context:"formatting"})}},a:function(e,t,n){var r=e.getUTCHours(),a=r/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(a,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},b:function(e,t,n){var r=e.getUTCHours(),a;switch(r===12?a=Rm.noon:r===0?a=Rm.midnight:a=r/12>=1?"pm":"am",t){case"b":case"bb":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(a,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},B:function(e,t,n){var r=e.getUTCHours(),a;switch(r>=17?a=Rm.evening:r>=12?a=Rm.afternoon:r>=4?a=Rm.morning:a=Rm.night,t){case"B":case"BB":case"BBB":return n.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(a,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(a,{width:"wide",context:"formatting"})}},h:function(e,t,n){if(t==="ho"){var r=e.getUTCHours()%12;return r===0&&(r=12),n.ordinalNumber(r,{unit:"hour"})}return Jc.h(e,t)},H:function(e,t,n){return t==="Ho"?n.ordinalNumber(e.getUTCHours(),{unit:"hour"}):Jc.H(e,t)},K:function(e,t,n){var r=e.getUTCHours()%12;return t==="Ko"?n.ordinalNumber(r,{unit:"hour"}):Qt(r,t.length)},k:function(e,t,n){var r=e.getUTCHours();return r===0&&(r=24),t==="ko"?n.ordinalNumber(r,{unit:"hour"}):Qt(r,t.length)},m:function(e,t,n){return t==="mo"?n.ordinalNumber(e.getUTCMinutes(),{unit:"minute"}):Jc.m(e,t)},s:function(e,t,n){return t==="so"?n.ordinalNumber(e.getUTCSeconds(),{unit:"second"}):Jc.s(e,t)},S:function(e,t){return Jc.S(e,t)},X:function(e,t,n,r){var a=r._originalDate||e,o=a.getTimezoneOffset();if(o===0)return"Z";switch(t){case"X":return eO(o);case"XXXX":case"XX":return ah(o);case"XXXXX":case"XXX":default:return ah(o,":")}},x:function(e,t,n,r){var a=r._originalDate||e,o=a.getTimezoneOffset();switch(t){case"x":return eO(o);case"xxxx":case"xx":return ah(o);case"xxxxx":case"xxx":default:return ah(o,":")}},O:function(e,t,n,r){var a=r._originalDate||e,o=a.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+JL(o,":");case"OOOO":default:return"GMT"+ah(o,":")}},z:function(e,t,n,r){var a=r._originalDate||e,o=a.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+JL(o,":");case"zzzz":default:return"GMT"+ah(o,":")}},t:function(e,t,n,r){var a=r._originalDate||e,o=Math.floor(a.getTime()/1e3);return Qt(o,t.length)},T:function(e,t,n,r){var a=r._originalDate||e,o=a.getTime();return Qt(o,t.length)}};function JL(s,e){var t=s>0?"-":"+",n=Math.abs(s),r=Math.floor(n/60),a=n%60;if(a===0)return t+String(r);var o=e;return t+String(r)+o+Qt(a,2)}function eO(s,e){if(s%60===0){var t=s>0?"-":"+";return t+Qt(Math.abs(s)/60,2)}return ah(s,e)}function ah(s,e){var t=e||"",n=s>0?"-":"+",r=Math.abs(s),a=Qt(Math.floor(r/60),2),o=Qt(r%60,2);return n+a+t+o}var tO=function(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},qU=function(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},jle=function(e,t){var n=e.match(/(P+)(p+)?/)||[],r=n[1],a=n[2];if(!a)return tO(e,t);var o;switch(r){case"P":o=t.dateTime({width:"short"});break;case"PP":o=t.dateTime({width:"medium"});break;case"PPP":o=t.dateTime({width:"long"});break;case"PPPP":default:o=t.dateTime({width:"full"});break}return o.replace("{{date}}",tO(r,t)).replace("{{time}}",qU(a,t))},kle={p:qU,P:jle},Nle=["D","DD"],Ale=["YY","YYYY"];function _le(s){return Nle.indexOf(s)!==-1}function Tle(s){return Ale.indexOf(s)!==-1}function sO(s,e,t){if(s==="YYYY")throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(e,"`) for formatting years to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(s==="YY")throw new RangeError("Use `yy` instead of `YY` (in `".concat(e,"`) for formatting years to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(s==="D")throw new RangeError("Use `d` instead of `D` (in `".concat(e,"`) for formatting days of the month to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"));if(s==="DD")throw new RangeError("Use `dd` instead of `DD` (in `".concat(e,"`) for formatting days of the month to the input `").concat(t,"`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md"))}var Ele={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Ple=function(e,t,n){var r,a=Ele[e];return typeof a=="string"?r=a:t===1?r=a.one:r=a.other.replace("{{count}}",t.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+r:r+" ago":r};function xA(s){return function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.width?String(e.width):s.defaultWidth,n=s.formats[t]||s.formats[s.defaultWidth];return n}}var Mle={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Ile={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Rle={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Dle={date:xA({formats:Mle,defaultWidth:"full"}),time:xA({formats:Ile,defaultWidth:"full"}),dateTime:xA({formats:Rle,defaultWidth:"full"})},Lle={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Ole=function(e,t,n,r){return Lle[e]};function ny(s){return function(e,t){var n=t!=null&&t.context?String(t.context):"standalone",r;if(n==="formatting"&&s.formattingValues){var a=s.defaultFormattingWidth||s.defaultWidth,o=t!=null&&t.width?String(t.width):a;r=s.formattingValues[o]||s.formattingValues[a]}else{var l=s.defaultWidth,c=t!=null&&t.width?String(t.width):s.defaultWidth;r=s.values[c]||s.values[l]}var d=s.argumentCallback?s.argumentCallback(e):e;return r[d]}}var Fle={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Ble={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},$le={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Ule={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},zle={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Hle={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Vle=function(e,t){var n=Number(e),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},Wle={ordinalNumber:Vle,era:ny({values:Fle,defaultWidth:"wide"}),quarter:ny({values:Ble,defaultWidth:"wide",argumentCallback:function(e){return e-1}}),month:ny({values:$le,defaultWidth:"wide"}),day:ny({values:Ule,defaultWidth:"wide"}),dayPeriod:ny({values:zle,defaultWidth:"wide",formattingValues:Hle,defaultFormattingWidth:"wide"})};function ry(s){return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.width,r=n&&s.matchPatterns[n]||s.matchPatterns[s.defaultMatchWidth],a=e.match(r);if(!a)return null;var o=a[0],l=n&&s.parsePatterns[n]||s.parsePatterns[s.defaultParseWidth],c=Array.isArray(l)?Gle(l,function(f){return f.test(o)}):qle(l,function(f){return f.test(o)}),d;d=s.valueCallback?s.valueCallback(c):c,d=t.valueCallback?t.valueCallback(d):d;var h=e.slice(o.length);return{value:d,rest:h}}}function qle(s,e){for(var t in s)if(s.hasOwnProperty(t)&&e(s[t]))return t}function Gle(s,e){for(var t=0;t<s.length;t++)if(e(s[t]))return t}function Yle(s){return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=e.match(s.matchPattern);if(!n)return null;var r=n[0],a=e.match(s.parsePattern);if(!a)return null;var o=s.valueCallback?s.valueCallback(a[0]):a[0];o=t.valueCallback?t.valueCallback(o):o;var l=e.slice(r.length);return{value:o,rest:l}}}var Kle=/^(\d+)(th|st|nd|rd)?/i,Xle=/\d+/i,Qle={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Zle={any:[/^b/i,/^(a|c)/i]},Jle={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},ece={any:[/1/i,/2/i,/3/i,/4/i]},tce={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},sce={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},nce={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},rce={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},ice={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},ace={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},oce={ordinalNumber:Yle({matchPattern:Kle,parsePattern:Xle,valueCallback:function(e){return parseInt(e,10)}}),era:ry({matchPatterns:Qle,defaultMatchWidth:"wide",parsePatterns:Zle,defaultParseWidth:"any"}),quarter:ry({matchPatterns:Jle,defaultMatchWidth:"wide",parsePatterns:ece,defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:ry({matchPatterns:tce,defaultMatchWidth:"wide",parsePatterns:sce,defaultParseWidth:"any"}),day:ry({matchPatterns:nce,defaultMatchWidth:"wide",parsePatterns:rce,defaultParseWidth:"any"}),dayPeriod:ry({matchPatterns:ice,defaultMatchWidth:"any",parsePatterns:ace,defaultParseWidth:"any"})},lce={code:"en-US",formatDistance:Ple,formatLong:Dle,formatRelative:Ole,localize:Wle,match:oce,options:{weekStartsOn:0,firstWeekContainsDate:1}},cce=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,dce=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,uce=/^'([^]*?)'?$/,hce=/''/g,fce=/[a-zA-Z]/;function mce(s,e,t){var n,r,a,o,l,c,d,h,f,m,p,x,g,b;Br(2,arguments);var v=String(e),y=Ik(),w=(n=(r=void 0)!==null&&r!==void 0?r:y.locale)!==null&&n!==void 0?n:lce,S=fm((a=(o=(l=(c=void 0)!==null&&c!==void 0?c:void 0)!==null&&l!==void 0?l:y.firstWeekContainsDate)!==null&&o!==void 0?o:(d=y.locale)===null||d===void 0||(h=d.options)===null||h===void 0?void 0:h.firstWeekContainsDate)!==null&&a!==void 0?a:1);if(!(S>=1&&S<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var j=fm((f=(m=(p=(x=void 0)!==null&&x!==void 0?x:void 0)!==null&&p!==void 0?p:y.weekStartsOn)!==null&&m!==void 0?m:(g=y.locale)===null||g===void 0||(b=g.options)===null||b===void 0?void 0:b.weekStartsOn)!==null&&f!==void 0?f:0);if(!(j>=0&&j<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!w.localize)throw new RangeError("locale must contain localize property");if(!w.formatLong)throw new RangeError("locale must contain formatLong property");var A=Tl(s);if(!fle(A))throw new RangeError("Invalid time value");var k=ule(A),_=mle(A,k),L={firstWeekContainsDate:S,weekStartsOn:j,locale:w,_originalDate:A},D=v.match(dce).map(function(P){var T=P[0];if(T==="p"||T==="P"){var B=kle[T];return B(P,w.formatLong)}return P}).join("").match(cce).map(function(P){if(P==="''")return"'";var T=P[0];if(T==="'")return pce(P);var B=Sle[T];if(B)return Tle(P)&&sO(P,e,String(s)),_le(P)&&sO(P,e,String(s)),B(_,P,w.localize,L);if(T.match(fce))throw new RangeError("Format string contains an unescaped latin alphabet character `"+T+"`");return P}).join("");return D}function pce(s){var e=s.match(uce);return e?e[1].replace(hce,"'"):s}var gce=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],xce=gce.reduce((s,e)=>{const t=WP(`Primitive.${e}`),n=C.forwardRef((r,a)=>{const{asChild:o,...l}=r,c=o?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),i.jsx(c,{...l,ref:a})});return n.displayName=`Primitive.${e}`,{...s,[e]:n}},{}),yce="Separator",nO="horizontal",vce=["horizontal","vertical"],GU=C.forwardRef((s,e)=>{const{decorative:t,orientation:n=nO,...r}=s,a=bce(n)?n:nO,l=t?{role:"none"}:{"aria-orientation":a==="vertical"?a:void 0,role:"separator"};return i.jsx(xce.div,{"data-orientation":a,...l,...r,ref:e})});GU.displayName=yce;function bce(s){return vce.includes(s)}var YU=GU;const On=C.forwardRef(({className:s,orientation:e="horizontal",decorative:t=!0,...n},r)=>i.jsx(YU,{ref:r,decorative:t,orientation:e,className:Ee("shrink-0 bg-border",e==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",s),...n}));On.displayName=YU.displayName;const yA=[{value:"Battle",label:"Battle",icon:En,description:"Combat encounters and wars"},{value:"Alliance",label:"Alliance",icon:lM,description:"Diplomatic agreements and partnerships"},{value:"Discovery",label:"Discovery",icon:Ku,description:"Important revelations or findings"},{value:"Disaster",label:"Disaster",icon:Da,description:"Natural or magical catastrophes"},{value:"Political",label:"Political",icon:Ru,description:"Government and power changes"},{value:"Cultural",label:"Cultural",icon:wo,description:"Religious, artistic, or social events"},{value:"Custom",label:"Custom",icon:ci,description:"Custom campaign-specific events"}],rO=[{value:"idle",label:"Planned",description:"Event is planned but hasn't occurred"},{value:"in_progress",label:"Happening",description:"Event is currently taking place"},{value:"completed",label:"Historical",description:"Event has concluded"}];function wce({open:s,onOpenChange:e,mode:t,timelineEvent:n,onSuccess:r,defaultTab:a="basic"}){var T,B;const{user:o,isLoading:l}=Cm();if(l)return i.jsx(cs,{open:s,onOpenChange:e,children:i.jsx(is,{children:i.jsx("div",{className:"flex items-center justify-center py-8",children:i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900"}),i.jsx("span",{children:"Loading..."})]})})})});if(!o)return null;const{canAccess:c,isCampaignMaster:d,isAdmin:h}=aw(t,"timelineEvent",n),[f,m]=C.useState(a),[p,x]=C.useState(!1),g=Re(re.timeline.createTimelineEvent),b=Re(re.timeline.updateTimelineEvent),v=Fe(re.campaigns.getMyCampaigns);Fe(re.locations.getLocations,n!=null&&n.campaignId?{campaignId:n.campaignId}:"skip"),Fe(re.characters.getCharacters,n!=null&&n.campaignId?{campaignId:n.campaignId}:"skip"),Fe(re.factions.getFactions,n!=null&&n.campaignId?{campaignId:n.campaignId}:"skip");const y=Fe(re.quests.getQuests,n!=null&&n.campaignId?{campaignId:n.campaignId}:"skip"),w=t==="read",S=kl({resolver:Nl(Wie),defaultValues:{title:(n==null?void 0:n.title)||"",description:(n==null?void 0:n.description)||"",date:(n==null?void 0:n.date)||Date.now(),campaignId:(n==null?void 0:n.campaignId)||"",type:(n==null?void 0:n.type)||"Custom",status:(n==null?void 0:n.status)||"idle",relatedLocationIds:(n==null?void 0:n.relatedLocationIds)||[],relatedNpcIds:(n==null?void 0:n.relatedNpcIds)||[],relatedFactionIds:(n==null?void 0:n.relatedFactionIds)||[],relatedQuestIds:(n==null?void 0:n.relatedQuestIds)||[],primaryQuestId:(n==null?void 0:n.primaryQuestId)||void 0,eventConsequences:(n==null?void 0:n.eventConsequences)||[],participantOutcomes:(n==null?void 0:n.participantOutcomes)||[],isPublic:(n==null?void 0:n.isPublic)??!0,dmNotes:(n==null?void 0:n.dmNotes)||"",playerVisibleNotes:(n==null?void 0:n.playerVisibleNotes)||""}});V.useEffect(()=>{n&&(t==="edit"||t==="read")?S.reset({title:n.title,description:n.description,date:n.date,campaignId:n.campaignId,type:n.type,status:n.status,relatedLocationIds:n.relatedLocationIds||[],relatedNpcIds:n.relatedNpcIds||[],relatedFactionIds:n.relatedFactionIds||[],relatedQuestIds:n.relatedQuestIds||[],primaryQuestId:n.primaryQuestId||void 0,eventConsequences:n.eventConsequences||[],participantOutcomes:n.participantOutcomes||[],isPublic:n.isPublic??!0,dmNotes:n.dmNotes||"",playerVisibleNotes:n.playerVisibleNotes||""}):t==="create"&&S.reset({title:"",description:"",date:Date.now(),campaignId:"",type:"Custom",status:"idle",relatedLocationIds:[],relatedNpcIds:[],relatedFactionIds:[],relatedQuestIds:[],primaryQuestId:void 0,eventConsequences:[],participantOutcomes:[],isPublic:!0,dmNotes:"",playerVisibleNotes:""})},[n,t,S]);const j=async R=>{x(!0);try{t==="create"?(await g(R),rt.success("Timeline event created successfully!")):t==="edit"&&n&&(await b({id:n._id,...R}),rt.success("Timeline event updated successfully!")),r==null||r(),e(!1),S.reset()}catch(O){console.error("Failed to save timeline event:",O),rt.error("Failed to save timeline event. Please try again.")}finally{x(!1)}},A=()=>{switch(t){case"create":return"Create Timeline Event";case"edit":return"Edit Timeline Event";case"read":return"Timeline Event Details";default:return"Timeline Event"}},k=()=>{switch(t){case"read":return"View timeline event details and relationships";case"create":return"Create a new timeline event for your campaign";case"edit":return"Modify timeline event details and relationships";default:return""}},_=R=>{const O=yA.find(I=>I.value===R);return O?O.icon:ci},L=R=>{switch(R){case"completed":return"default";case"in_progress":return"secondary";default:return"outline"}},D=R=>mce(new Date(R),"PPP"),P=n?_(n.type):Ac;return i.jsx(cs,{open:s,onOpenChange:e,children:i.jsxs(is,{className:"max-w-4xl max-h-[90vh] overflow-hidden",children:[i.jsxs(Rs,{children:[i.jsxs(Ds,{className:"flex items-center gap-2",children:[i.jsx(P,{className:"h-5 w-5"}),A(),n&&i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(ue,{variant:L(n.status),children:((T=rO.find(R=>R.value===n.status))==null?void 0:T.label)||n.status}),i.jsx(ue,{variant:"outline",children:((B=yA.find(R=>R.value===n.type))==null?void 0:B.label)||n.type})]})]}),i.jsxs(Lr,{children:[k(),n&&i.jsxs("div",{className:"mt-2 text-sm",children:[i.jsx(Ra,{className:"h-4 w-4 inline mr-1"}),D(n.date)]})]})]}),i.jsx(Al,{...S,children:i.jsx("form",{onSubmit:S.handleSubmit(j),className:"space-y-4 flex-1 overflow-hidden",children:i.jsxs(Qn,{value:f,onValueChange:m,className:"flex-1 overflow-hidden",children:[i.jsxs(In,{className:"grid w-full grid-cols-4",children:[i.jsxs(Be,{value:"basic",className:"flex items-center gap-1",children:[i.jsx(Ac,{className:"h-3 w-3"}),"Basic Info"]}),i.jsxs(Be,{value:"relationships",className:"flex items-center gap-1",children:[i.jsx(jx,{className:"h-3 w-3"}),"Relationships"]}),i.jsxs(Be,{value:"details",className:"flex items-center gap-1",children:[i.jsx(Cs,{className:"h-3 w-3"}),"Details"]}),i.jsxs(Be,{value:"notes",className:"flex items-center gap-1",children:[i.jsx(aM,{className:"h-3 w-3"}),"Notes"]})]}),i.jsxs("div",{className:"overflow-y-auto flex-1 mt-4 space-y-4",children:[i.jsx($e,{value:"basic",className:"space-y-4",children:i.jsxs(oe,{children:[i.jsxs(ke,{children:[i.jsx(Ne,{children:"Event Information"}),i.jsx(At,{children:"Core details about this timeline event"})]}),i.jsxs(he,{className:"space-y-4",children:[i.jsx(pe,{control:S.control,name:"title",render:({field:R})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Event Title *"}),i.jsx(ge,{children:i.jsx(_e,{...R,disabled:w,placeholder:"Enter event title..."})}),i.jsx(ye,{})]})}),i.jsx(pe,{control:S.control,name:"description",render:({field:R})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Description *"}),i.jsx(ge,{children:i.jsx(ps,{...R,disabled:w,placeholder:"Describe what happened during this event...",rows:4})}),i.jsx(ye,{})]})}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsx(pe,{control:S.control,name:"campaignId",render:({field:R})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Campaign *"}),i.jsxs(wt,{onValueChange:R.onChange,defaultValue:R.value,disabled:w,children:[i.jsx(ge,{children:i.jsx(gt,{children:i.jsx(Ct,{placeholder:"Select campaign"})})}),i.jsx(xt,{children:v==null?void 0:v.map(O=>i.jsx(Ie,{value:O._id,children:O.name},O._id))})]}),i.jsx(ye,{})]})}),i.jsx(pe,{control:S.control,name:"date",render:({field:R})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Event Date *"}),i.jsx(ge,{children:i.jsx(_e,{type:"datetime-local",...R,disabled:w,value:R.value?new Date(R.value).toISOString().slice(0,16):"",onChange:O=>R.onChange(new Date(O.target.value).getTime())})}),i.jsx(ye,{})]})})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsx(pe,{control:S.control,name:"type",render:({field:R})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Event Type"}),i.jsxs(wt,{onValueChange:R.onChange,defaultValue:R.value,disabled:w,children:[i.jsx(ge,{children:i.jsx(gt,{children:i.jsx(Ct,{placeholder:"Select type"})})}),i.jsx(xt,{children:yA.map(O=>i.jsx(Ie,{value:O.value,children:O.label},O.value))})]}),i.jsx(ye,{})]})}),i.jsx(pe,{control:S.control,name:"status",render:({field:R})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Status"}),i.jsxs(wt,{onValueChange:R.onChange,defaultValue:R.value,disabled:w,children:[i.jsx(ge,{children:i.jsx(gt,{children:i.jsx(Ct,{placeholder:"Select status"})})}),i.jsx(xt,{children:rO.map(O=>i.jsx(Ie,{value:O.value,children:O.label},O.value))})]}),i.jsx(ye,{})]})})]}),i.jsx("div",{className:"flex items-center space-x-2",children:i.jsx(pe,{control:S.control,name:"isPublic",render:({field:R})=>i.jsxs(fe,{className:"flex flex-row items-center space-x-3 space-y-0",children:[i.jsx(ge,{children:i.jsx("input",{type:"checkbox",checked:R.value,onChange:R.onChange,disabled:w,className:"h-4 w-4"})}),i.jsxs("div",{className:"space-y-1 leading-none",children:[i.jsx(me,{children:"Public Event"}),i.jsx(nt,{children:"Should this event be visible to players?"})]}),i.jsx(ye,{})]})})})]})]})}),i.jsx($e,{value:"relationships",className:"space-y-4",children:i.jsxs(oe,{children:[i.jsxs(ke,{children:[i.jsx(Ne,{children:"Entity Relationships"}),i.jsx(At,{children:"Link this event to other campaign entities"})]}),i.jsxs(he,{className:"space-y-4",children:[i.jsx(pe,{control:S.control,name:"primaryQuestId",render:({field:R})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Primary Quest"}),i.jsxs(wt,{onValueChange:R.onChange,defaultValue:R.value,disabled:w,children:[i.jsx(ge,{children:i.jsx(gt,{children:i.jsx(Ct,{placeholder:"Select primary quest"})})}),i.jsx(xt,{children:y==null?void 0:y.map(O=>i.jsx(Ie,{value:O._id,children:O.name},O._id))})]}),i.jsx(nt,{children:"The main quest this event relates to"}),i.jsx(ye,{})]})}),i.jsx(On,{}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("h4",{className:"text-sm font-medium",children:"Related Entities"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Multi-select coming soon - for now, use the primary quest relationship above"})]})]})]})}),i.jsx($e,{value:"details",className:"space-y-4",children:i.jsxs(oe,{children:[i.jsxs(ke,{children:[i.jsx(Ne,{children:"Event Details"}),i.jsx(At,{children:"Consequences and participant outcomes"})]}),i.jsx(he,{className:"space-y-4",children:i.jsxs("div",{className:"text-center text-muted-foreground py-8",children:[i.jsx(Cs,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),i.jsx("p",{className:"text-lg",children:"Event Consequences"}),i.jsx("p",{className:"text-sm",children:"Advanced consequence and outcome tracking coming soon"})]})})]})}),i.jsx($e,{value:"notes",className:"space-y-4",children:i.jsxs(oe,{children:[i.jsxs(ke,{children:[i.jsx(Ne,{children:"Event Notes"}),i.jsx(At,{children:"DM notes and player-visible information"})]}),i.jsxs(he,{className:"space-y-4",children:[i.jsx(pe,{control:S.control,name:"playerVisibleNotes",render:({field:R})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Player-Visible Notes"}),i.jsx(ge,{children:i.jsx(ps,{...R,disabled:w,placeholder:"Information visible to players about this event...",rows:3})}),i.jsx(nt,{children:"This information will be visible to all players in the campaign"}),i.jsx(ye,{})]})}),(d((n==null?void 0:n.campaignId)||"")||h)&&i.jsx(pe,{control:S.control,name:"dmNotes",render:({field:R})=>i.jsxs(fe,{children:[i.jsx(me,{children:"DM Notes (Private)"}),i.jsx(ge,{children:i.jsx(ps,{...R,disabled:w,placeholder:"Private notes for the DM about this event...",rows:4})}),i.jsx(nt,{children:"These notes are only visible to the DM and admins"}),i.jsx(ye,{})]})})]})]})})]})]})})}),i.jsxs(Xn,{children:[t==="read"&&i.jsx(q,{variant:"outline",onClick:()=>e(!1),children:"Close"}),(t==="create"||t==="edit")&&i.jsxs(i.Fragment,{children:[i.jsx(q,{variant:"outline",onClick:()=>e(!1),children:"Cancel"}),i.jsxs(q,{type:"submit",disabled:p,onClick:S.handleSubmit(j),children:[p&&i.jsx(Ss,{className:"mr-2 h-4 w-4 animate-spin"}),t==="create"?"Create Event":"Save Changes"]})]})]})]})})}var KU=["PageUp","PageDown"],XU=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],QU={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},zx="Slider",[AT,Cce,Sce]=bk(zx),[ZU]=Oa(zx,[Sce]),[jce,Rk]=ZU(zx),JU=C.forwardRef((s,e)=>{const{name:t,min:n=0,max:r=100,step:a=1,orientation:o="horizontal",disabled:l=!1,minStepsBetweenThumbs:c=0,defaultValue:d=[n],value:h,onValueChange:f=()=>{},onValueCommit:m=()=>{},inverted:p=!1,form:x,...g}=s,b=C.useRef(new Set),v=C.useRef(0),w=o==="horizontal"?kce:Nce,[S=[],j]=Lc({prop:h,defaultProp:d,onChange:P=>{var B;(B=[...b.current][v.current])==null||B.focus(),f(P)}}),A=C.useRef(S);function k(P){const T=Pce(S,P);D(P,T)}function _(P){D(P,v.current)}function L(){const P=A.current[v.current];S[v.current]!==P&&m(S)}function D(P,T,{commit:B}={commit:!1}){const R=Dce(a),O=Lce(Math.round((P-n)/a)*a+n,R),I=wS(O,[n,r]);j((U=[])=>{const M=Tce(U,I,T);if(Rce(M,c*a)){v.current=M.indexOf(I);const $=String(M)!==String(U);return $&&B&&m(M),$?M:U}else return U})}return i.jsx(jce,{scope:s.__scopeSlider,name:t,disabled:l,min:n,max:r,valueIndexToChangeRef:v,thumbs:b.current,values:S,orientation:o,form:x,children:i.jsx(AT.Provider,{scope:s.__scopeSlider,children:i.jsx(AT.Slot,{scope:s.__scopeSlider,children:i.jsx(w,{"aria-disabled":l,"data-disabled":l?"":void 0,...g,ref:e,onPointerDown:He(g.onPointerDown,()=>{l||(A.current=S)}),min:n,max:r,inverted:p,onSlideStart:l?void 0:k,onSlideMove:l?void 0:_,onSlideEnd:l?void 0:L,onHomeKeyDown:()=>!l&&D(n,0,{commit:!0}),onEndKeyDown:()=>!l&&D(r,S.length-1,{commit:!0}),onStepKeyDown:({event:P,direction:T})=>{if(!l){const O=KU.includes(P.key)||P.shiftKey&&XU.includes(P.key)?10:1,I=v.current,U=S[I],M=a*O*T;D(U+M,I,{commit:!0})}}})})})})});JU.displayName=zx;var[ez,tz]=ZU(zx,{startEdge:"left",endEdge:"right",size:"width",direction:1}),kce=C.forwardRef((s,e)=>{const{min:t,max:n,dir:r,inverted:a,onSlideStart:o,onSlideMove:l,onSlideEnd:c,onStepKeyDown:d,...h}=s,[f,m]=C.useState(null),p=Tt(e,w=>m(w)),x=C.useRef(void 0),g=rw(r),b=g==="ltr",v=b&&!a||!b&&a;function y(w){const S=x.current||f.getBoundingClientRect(),j=[0,S.width],k=PM(j,v?[t,n]:[n,t]);return x.current=S,k(w-S.left)}return i.jsx(ez,{scope:s.__scopeSlider,startEdge:v?"left":"right",endEdge:v?"right":"left",direction:v?1:-1,size:"width",children:i.jsx(sz,{dir:g,"data-orientation":"horizontal",...h,ref:p,style:{...h.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:w=>{const S=y(w.clientX);o==null||o(S)},onSlideMove:w=>{const S=y(w.clientX);l==null||l(S)},onSlideEnd:()=>{x.current=void 0,c==null||c()},onStepKeyDown:w=>{const j=QU[v?"from-left":"from-right"].includes(w.key);d==null||d({event:w,direction:j?-1:1})}})})}),Nce=C.forwardRef((s,e)=>{const{min:t,max:n,inverted:r,onSlideStart:a,onSlideMove:o,onSlideEnd:l,onStepKeyDown:c,...d}=s,h=C.useRef(null),f=Tt(e,h),m=C.useRef(void 0),p=!r;function x(g){const b=m.current||h.current.getBoundingClientRect(),v=[0,b.height],w=PM(v,p?[n,t]:[t,n]);return m.current=b,w(g-b.top)}return i.jsx(ez,{scope:s.__scopeSlider,startEdge:p?"bottom":"top",endEdge:p?"top":"bottom",size:"height",direction:p?1:-1,children:i.jsx(sz,{"data-orientation":"vertical",...d,ref:f,style:{...d.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:g=>{const b=x(g.clientY);a==null||a(b)},onSlideMove:g=>{const b=x(g.clientY);o==null||o(b)},onSlideEnd:()=>{m.current=void 0,l==null||l()},onStepKeyDown:g=>{const v=QU[p?"from-bottom":"from-top"].includes(g.key);c==null||c({event:g,direction:v?-1:1})}})})}),sz=C.forwardRef((s,e)=>{const{__scopeSlider:t,onSlideStart:n,onSlideMove:r,onSlideEnd:a,onHomeKeyDown:o,onEndKeyDown:l,onStepKeyDown:c,...d}=s,h=Rk(zx,t);return i.jsx(ot.span,{...d,ref:e,onKeyDown:He(s.onKeyDown,f=>{f.key==="Home"?(o(f),f.preventDefault()):f.key==="End"?(l(f),f.preventDefault()):KU.concat(XU).includes(f.key)&&(c(f),f.preventDefault())}),onPointerDown:He(s.onPointerDown,f=>{const m=f.target;m.setPointerCapture(f.pointerId),f.preventDefault(),h.thumbs.has(m)?m.focus():n(f)}),onPointerMove:He(s.onPointerMove,f=>{f.target.hasPointerCapture(f.pointerId)&&r(f)}),onPointerUp:He(s.onPointerUp,f=>{const m=f.target;m.hasPointerCapture(f.pointerId)&&(m.releasePointerCapture(f.pointerId),a(f))})})}),nz="SliderTrack",rz=C.forwardRef((s,e)=>{const{__scopeSlider:t,...n}=s,r=Rk(nz,t);return i.jsx(ot.span,{"data-disabled":r.disabled?"":void 0,"data-orientation":r.orientation,...n,ref:e})});rz.displayName=nz;var _T="SliderRange",iz=C.forwardRef((s,e)=>{const{__scopeSlider:t,...n}=s,r=Rk(_T,t),a=tz(_T,t),o=C.useRef(null),l=Tt(e,o),c=r.values.length,d=r.values.map(m=>lz(m,r.min,r.max)),h=c>1?Math.min(...d):0,f=100-Math.max(...d);return i.jsx(ot.span,{"data-orientation":r.orientation,"data-disabled":r.disabled?"":void 0,...n,ref:l,style:{...s.style,[a.startEdge]:h+"%",[a.endEdge]:f+"%"}})});iz.displayName=_T;var TT="SliderThumb",az=C.forwardRef((s,e)=>{const t=Cce(s.__scopeSlider),[n,r]=C.useState(null),a=Tt(e,l=>r(l)),o=C.useMemo(()=>n?t().findIndex(l=>l.ref.current===n):-1,[t,n]);return i.jsx(Ace,{...s,ref:a,index:o})}),Ace=C.forwardRef((s,e)=>{const{__scopeSlider:t,index:n,name:r,...a}=s,o=Rk(TT,t),l=tz(TT,t),[c,d]=C.useState(null),h=Tt(e,y=>d(y)),f=c?o.form||!!c.closest("form"):!0,m=xk(c),p=o.values[n],x=p===void 0?0:lz(p,o.min,o.max),g=Ece(n,o.values.length),b=m==null?void 0:m[l.size],v=b?Mce(b,x,l.direction):0;return C.useEffect(()=>{if(c)return o.thumbs.add(c),()=>{o.thumbs.delete(c)}},[c,o.thumbs]),i.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[l.startEdge]:`calc(${x}% + ${v}px)`},children:[i.jsx(AT.ItemSlot,{scope:s.__scopeSlider,children:i.jsx(ot.span,{role:"slider","aria-label":s["aria-label"]||g,"aria-valuemin":o.min,"aria-valuenow":p,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0,...a,ref:h,style:p===void 0?{display:"none"}:s.style,onFocus:He(s.onFocus,()=>{o.valueIndexToChangeRef.current=n})})}),f&&i.jsx(oz,{name:r??(o.name?o.name+(o.values.length>1?"[]":""):void 0),form:o.form,value:p},n)]})});az.displayName=TT;var _ce="RadioBubbleInput",oz=C.forwardRef(({__scopeSlider:s,value:e,...t},n)=>{const r=C.useRef(null),a=Tt(r,n),o=gk(e);return C.useEffect(()=>{const l=r.current;if(!l)return;const c=window.HTMLInputElement.prototype,h=Object.getOwnPropertyDescriptor(c,"value").set;if(o!==e&&h){const f=new Event("input",{bubbles:!0});h.call(l,e),l.dispatchEvent(f)}},[o,e]),i.jsx(ot.input,{style:{display:"none"},...t,ref:a,defaultValue:e})});oz.displayName=_ce;function Tce(s=[],e,t){const n=[...s];return n[t]=e,n.sort((r,a)=>r-a)}function lz(s,e,t){const a=100/(t-e)*(s-e);return wS(a,[0,100])}function Ece(s,e){return e>2?`Value ${s+1} of ${e}`:e===2?["Minimum","Maximum"][s]:void 0}function Pce(s,e){if(s.length===1)return 0;const t=s.map(r=>Math.abs(r-e)),n=Math.min(...t);return t.indexOf(n)}function Mce(s,e,t){const n=s/2,a=PM([0,50],[0,n]);return(n-a(e)*t)*t}function Ice(s){return s.slice(0,-1).map((e,t)=>s[t+1]-e)}function Rce(s,e){if(e>0){const t=Ice(s);return Math.min(...t)>=e}return!0}function PM(s,e){return t=>{if(s[0]===s[1]||e[0]===e[1])return e[0];const n=(e[1]-e[0])/(s[1]-s[0]);return e[0]+n*(t-s[0])}}function Dce(s){return(String(s).split(".")[1]||"").length}function Lce(s,e){const t=Math.pow(10,e);return Math.round(s*t)/t}var cz=JU,Oce=rz,Fce=iz,Bce=az;const dz=C.forwardRef(({className:s,...e},t)=>i.jsxs(cz,{ref:t,className:Ee("relative flex w-full touch-none select-none items-center",s),...e,children:[i.jsx(Oce,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:i.jsx(Fce,{className:"absolute h-full bg-primary"})}),i.jsx(Bce,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));dz.displayName=cz.displayName;const $ce=[{value:"Government",label:"Government",icon:Ru,description:"Ruling bodies and official organizations"},{value:"Religious",label:"Religious",icon:tw,description:"Churches, temples, and spiritual orders"},{value:"Mercantile",label:"Mercantile",icon:b$,description:"Trade guilds and commercial enterprises"},{value:"Criminal",label:"Criminal",icon:Dr,description:"Thieves' guilds and underground organizations"},{value:"Military",label:"Military",icon:En,description:"Armed forces and warrior orders"},{value:"Scholarly",label:"Scholarly",icon:xne,description:"Academies, libraries, and research institutions"},{value:"Other",label:"Other",icon:wo,description:"Custom faction type"}],Uce=[{value:"Local",label:"Local",description:"Limited to a single settlement or area"},{value:"Regional",label:"Regional",description:"Spans multiple settlements or a region"},{value:"National",label:"National",description:"Country-wide influence and reach"},{value:"International",label:"International",description:"Multi-national or planar influence"}],zce=[{value:"Poor",label:"Poor",description:"Limited resources and struggling financially"},{value:"Modest",label:"Modest",description:"Basic resources to meet essential needs"},{value:"Wealthy",label:"Wealthy",description:"Substantial resources and comfortable funding"},{value:"Rich",label:"Rich",description:"Extensive resources with significant wealth"},{value:"Aristocratic",label:"Aristocratic",description:"Vast wealth rivaling nobility"}];function Hce({open:s,onOpenChange:e,mode:t,faction:n,onSuccess:r,defaultTab:a="basic"}){const{user:o,isLoading:l}=Cm();if(l)return i.jsx(cs,{open:s,onOpenChange:e,children:i.jsx(is,{children:i.jsx("div",{className:"flex items-center justify-center py-8",children:i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900"}),i.jsx("span",{children:"Loading..."})]})})})});if(!o)return null;const{canAccess:c,isCampaignMaster:d,isAdmin:h}=aw(t,"faction",n),[f,m]=C.useState(a),[p,x]=C.useState(!1),g=Fe(re.campaigns.getMyCampaigns),b=Fe(re.characters.getCharacters),v=Fe(re.factions.getFactions,{}),y=Re(re.factions.createFaction),w=Re(re.factions.updateFaction),S=t==="read",j=t==="create",A=t==="edit",k=kl({resolver:Nl(qie),defaultValues:{name:(n==null?void 0:n.name)||"",description:(n==null?void 0:n.description)||"",campaignId:(n==null?void 0:n.campaignId)||"",goals:(n==null?void 0:n.goals)||[],leaderNpcIds:(n==null?void 0:n.leaderNpcIds)||[],alliedFactionIds:(n==null?void 0:n.alliedFactionIds)||[],enemyFactionIds:(n==null?void 0:n.enemyFactionIds)||[],reputation:(n==null?void 0:n.reputation)||[],factionType:(n==null?void 0:n.factionType)||"Other",influence:(n==null?void 0:n.influence)||"Local",resources:(n==null?void 0:n.resources)||"Modest",publicInformation:(n==null?void 0:n.publicInformation)||"",factionSecrets:(n==null?void 0:n.factionSecrets)||"",dmNotes:(n==null?void 0:n.dmNotes)||""}});V.useEffect(()=>{n&&(t==="edit"||t==="read")&&k.reset({name:n.name,description:n.description,campaignId:n.campaignId,goals:n.goals||[],leaderNpcIds:n.leaderNpcIds||[],alliedFactionIds:n.alliedFactionIds||[],enemyFactionIds:n.enemyFactionIds||[],reputation:n.reputation||[],factionType:n.factionType||"Other",influence:n.influence||"Local",resources:n.resources||"Modest",publicInformation:n.publicInformation||"",factionSecrets:n.factionSecrets||"",dmNotes:n.dmNotes||""})},[n,t,k]);const _=async T=>{x(!0);try{j?(await y(T),rt.success("Faction created successfully!")):A&&n&&(await w({id:n._id,...T}),rt.success("Faction updated successfully!")),r==null||r(),e(!1)}catch(B){console.error("Failed to save faction:",B),rt.error(`Failed to ${j?"create":"update"} faction. Please try again.`)}finally{x(!1)}},L=()=>{switch(t){case"create":return"Create Faction";case"edit":return"Edit Faction";case"read":return"Faction Details";default:return"Faction"}},D=T=>T>=75?"text-green-600":T>=25?"text-blue-600":T>=-25?"text-yellow-600":T>=-75?"text-orange-600":"text-red-600",P=T=>T>=75?"Revered":T>=25?"Friendly":T>=-25?"Neutral":T>=-75?"Unfriendly":"Hostile";return i.jsx(cs,{open:s,onOpenChange:e,children:i.jsxs(is,{className:"max-w-4xl max-h-[90vh] overflow-hidden",children:[i.jsxs(Rs,{children:[i.jsxs(Ds,{className:"flex items-center gap-2",children:[i.jsx(Ru,{className:"h-5 w-5"}),L()]}),i.jsxs(Lr,{children:[t==="read"&&"View faction details, relationships, and reputation",t==="create"&&"Create a new faction for your campaign",t==="edit"&&"Modify faction details and relationships"]})]}),i.jsxs(Qn,{value:f,onValueChange:m,className:"flex-1 overflow-hidden",children:[i.jsxs(In,{className:"grid w-full grid-cols-5",children:[i.jsxs(Be,{value:"basic",className:"flex items-center gap-2",children:[i.jsx(wo,{className:"h-4 w-4"}),"Basic Info"]}),i.jsxs(Be,{value:"leadership",className:"flex items-center gap-2",children:[i.jsx(Ru,{className:"h-4 w-4"}),"Leadership"]}),i.jsxs(Be,{value:"relationships",className:"flex items-center gap-2",children:[i.jsx(lM,{className:"h-4 w-4"}),"Relationships"]}),i.jsxs(Be,{value:"reputation",className:"flex items-center gap-2",children:[i.jsx(Co,{className:"h-4 w-4"}),"Reputation"]}),i.jsxs(Be,{value:"notes",className:"flex items-center gap-2",children:[i.jsx(aM,{className:"h-4 w-4"}),"Notes"]})]}),i.jsx("div",{className:"overflow-y-auto flex-1 mt-4",children:i.jsx(Al,{...k,children:i.jsxs("form",{onSubmit:k.handleSubmit(_),className:"space-y-6",children:[i.jsx($e,{value:"basic",className:"space-y-6 m-0",children:i.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[i.jsx(pe,{control:k.control,name:"name",render:({field:T})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Faction Name *"}),i.jsx(ge,{children:i.jsx(_e,{...T,disabled:S,placeholder:"Enter faction name..."})}),i.jsx(ye,{})]})}),i.jsx(pe,{control:k.control,name:"description",render:({field:T})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Description *"}),i.jsx(ge,{children:i.jsx(ps,{...T,disabled:S,placeholder:"Describe the faction's purpose, history, and general information...",rows:4})}),i.jsx(ye,{})]})}),i.jsx(pe,{control:k.control,name:"campaignId",render:({field:T})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Campaign *"}),i.jsxs(wt,{onValueChange:T.onChange,defaultValue:T.value,disabled:S,children:[i.jsx(ge,{children:i.jsx(gt,{children:i.jsx(Ct,{placeholder:"Select campaign"})})}),i.jsx(xt,{children:g==null?void 0:g.map(B=>i.jsx(Ie,{value:B._id,children:B.name},B._id))})]}),i.jsx(ye,{})]})}),i.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[i.jsx(pe,{control:k.control,name:"factionType",render:({field:T})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Faction Type"}),i.jsxs(wt,{onValueChange:T.onChange,defaultValue:T.value,disabled:S,children:[i.jsx(ge,{children:i.jsx(gt,{children:i.jsx(Ct,{placeholder:"Select type"})})}),i.jsx(xt,{children:$ce.map(B=>i.jsx(Ie,{value:B.value,children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(B.icon,{className:"h-4 w-4"}),B.label]})},B.value))})]}),i.jsx(ye,{})]})}),i.jsx(pe,{control:k.control,name:"influence",render:({field:T})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Influence"}),i.jsxs(wt,{onValueChange:T.onChange,defaultValue:T.value,disabled:S,children:[i.jsx(ge,{children:i.jsx(gt,{children:i.jsx(Ct,{placeholder:"Select influence"})})}),i.jsx(xt,{children:Uce.map(B=>i.jsx(Ie,{value:B.value,children:B.label},B.value))})]}),i.jsx(ye,{})]})}),i.jsx(pe,{control:k.control,name:"resources",render:({field:T})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Resources"}),i.jsxs(wt,{onValueChange:T.onChange,defaultValue:T.value,disabled:S,children:[i.jsx(ge,{children:i.jsx(gt,{children:i.jsx(Ct,{placeholder:"Select resources"})})}),i.jsx(xt,{children:zce.map(B=>i.jsx(Ie,{value:B.value,children:B.label},B.value))})]}),i.jsx(ye,{})]})})]}),i.jsxs("div",{children:[i.jsx(st,{children:"Faction Goals"}),i.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Add the faction's objectives and motivations"}),!S&&i.jsxs("div",{className:"space-y-2",children:[(k.watch("goals")||[]).map((T,B)=>i.jsxs("div",{className:"flex gap-2",children:[i.jsx(_e,{value:T,onChange:R=>{const O=k.getValues("goals")||[];O[B]=R.target.value,k.setValue("goals",O)},placeholder:"Faction goal or objective...",className:"flex-1",disabled:S}),i.jsx(q,{type:"button",variant:"outline",size:"sm",onClick:()=>{const R=k.getValues("goals")||[];R.splice(B,1),k.setValue("goals",R)},children:i.jsx(Mr,{className:"h-4 w-4"})})]},B)),i.jsxs(q,{type:"button",variant:"outline",size:"sm",onClick:()=>{const T=k.getValues("goals")||[];T.push(""),k.setValue("goals",T)},children:[i.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Add Goal"]})]}),S&&i.jsxs("div",{className:"space-y-2",children:[((n==null?void 0:n.goals)||[]).map((T,B)=>i.jsx("div",{className:"p-3 bg-muted rounded text-sm",children:T},B)),(!(n!=null&&n.goals)||n.goals.length===0)&&i.jsx("p",{className:"text-sm text-muted-foreground italic",children:"No goals defined"})]})]})]})}),i.jsx($e,{value:"leadership",className:"space-y-6 m-0",children:i.jsx(pe,{control:k.control,name:"leaderNpcIds",render:({field:T})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Faction Leaders"}),i.jsx(nt,{children:"Select NPCs who lead or hold important positions in this faction"}),i.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-40 overflow-y-auto border rounded p-2",children:b==null?void 0:b.filter(B=>B.characterType==="npc").map(B=>{var R;return i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(ii,{checked:((R=T.value)==null?void 0:R.includes(B._id))||!1,onCheckedChange:O=>{if(S)return;const I=T.value||[];O?T.onChange([...I,B._id]):T.onChange(I.filter(U=>U!==B._id))},disabled:S}),i.jsx(st,{className:"text-sm font-normal",children:B.name})]},B._id)})}),i.jsx(ye,{})]})})}),i.jsx($e,{value:"relationships",className:"space-y-6 m-0",children:i.jsxs("div",{className:"space-y-6",children:[i.jsx(pe,{control:k.control,name:"alliedFactionIds",render:({field:T})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Allied Factions"}),i.jsx(nt,{children:"Factions that are friendly or allied with this faction"}),i.jsx("div",{className:"grid grid-cols-1 gap-2 max-h-32 overflow-y-auto border rounded p-2",children:v==null?void 0:v.filter(B=>B._id!==(n==null?void 0:n._id)).map(B=>{var R;return i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(ii,{checked:((R=T.value)==null?void 0:R.includes(B._id))||!1,onCheckedChange:O=>{if(S)return;const I=T.value||[];O?T.onChange([...I,B._id]):T.onChange(I.filter(U=>U!==B._id))},disabled:S}),i.jsx(st,{className:"text-sm font-normal",children:B.name})]},B._id)})}),i.jsx(ye,{})]})}),i.jsx(pe,{control:k.control,name:"enemyFactionIds",render:({field:T})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Enemy Factions"}),i.jsx(nt,{children:"Factions that are hostile or in conflict with this faction"}),i.jsx("div",{className:"grid grid-cols-1 gap-2 max-h-32 overflow-y-auto border rounded p-2",children:v==null?void 0:v.filter(B=>B._id!==(n==null?void 0:n._id)).map(B=>{var R;return i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(ii,{checked:((R=T.value)==null?void 0:R.includes(B._id))||!1,onCheckedChange:O=>{if(S)return;const I=T.value||[];O?T.onChange([...I,B._id]):T.onChange(I.filter(U=>U!==B._id))},disabled:S}),i.jsx(st,{className:"text-sm font-normal",children:B.name})]},B._id)})}),i.jsx(ye,{})]})})]})}),i.jsx($e,{value:"reputation",className:"space-y-6 m-0",children:i.jsxs(oe,{children:[i.jsxs(ke,{children:[i.jsx(Ne,{children:"Player Character Reputation"}),i.jsx(At,{children:"Track how this faction views each player character (-100 to +100)"})]}),i.jsx(he,{children:(b==null?void 0:b.filter(T=>T.characterType==="player").length)===0?i.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"No player characters available for reputation tracking"}):i.jsx("div",{className:"space-y-4",children:b==null?void 0:b.filter(T=>T.characterType==="player").map(T=>{var O;const B=(O=k.watch("reputation"))==null?void 0:O.find(I=>I.playerCharacterId===T._id),R=(B==null?void 0:B.score)||0;return i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx(st,{className:"font-medium",children:T.name}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("span",{className:`text-sm font-medium ${D(R)}`,children:[R>0?"+":"",R]}),i.jsx(ue,{variant:"outline",className:D(R),children:P(R)})]})]}),!S&&i.jsxs("div",{className:"px-3",children:[i.jsx(dz,{value:[R],onValueChange:I=>{const U=I[0],M=k.getValues("reputation")||[],$=M.findIndex(ee=>ee.playerCharacterId===T._id);let W;$>=0?(W=[...M],W[$].score=U):W=[...M,{playerCharacterId:T._id,score:U}],k.setValue("reputation",W)},min:-100,max:100,step:5,className:"w-full"}),i.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground mt-1",children:[i.jsx("span",{children:"Hostile (-100)"}),i.jsx("span",{children:"Neutral (0)"}),i.jsx("span",{children:"Revered (+100)"})]})]})]},T._id)})})})]})}),i.jsx($e,{value:"notes",className:"space-y-6 m-0",children:i.jsxs("div",{className:"space-y-6",children:[i.jsx(pe,{control:k.control,name:"publicInformation",render:({field:T})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Public Information"}),i.jsx(ge,{children:i.jsx(ps,{...T,disabled:S,placeholder:"Information that is commonly known about this faction...",rows:4})}),i.jsx(nt,{children:"This information is visible to all players"}),i.jsx(ye,{})]})}),i.jsx(pe,{control:k.control,name:"factionSecrets",render:({field:T})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Faction Secrets"}),i.jsx(ge,{children:i.jsx(ps,{...T,disabled:S,placeholder:"Hidden information and secrets about this faction...",rows:4,className:"font-mono text-sm"})}),i.jsx(nt,{children:"Secret information only visible to DMs and administrators"}),i.jsx(ye,{})]})}),i.jsx(pe,{control:k.control,name:"dmNotes",render:({field:T})=>i.jsxs(fe,{children:[i.jsx(me,{children:"DM Notes"}),i.jsx(ge,{children:i.jsx(ps,{...T,disabled:S,placeholder:"Private notes for the Dungeon Master...",rows:4,className:"font-mono text-sm"})}),i.jsx(nt,{children:"These notes are only visible to DMs and administrators"}),i.jsx(ye,{})]})})]})})]})})})]}),i.jsxs(Xn,{children:[t==="read"&&i.jsx(q,{variant:"outline",onClick:()=>e(!1),children:"Close"}),(t==="create"||t==="edit")&&i.jsxs(i.Fragment,{children:[i.jsx(q,{variant:"outline",onClick:()=>e(!1),children:"Cancel"}),i.jsxs(q,{onClick:k.handleSubmit(_),disabled:p,children:[p&&i.jsx(Ss,{className:"mr-2 h-4 w-4 animate-spin"}),t==="create"?"Create Faction":"Save Changes"]})]})]})]})})}const iO={Town:{icon:Du,color:"text-blue-600"},City:{icon:Cx,color:"text-purple-600"},Village:{icon:Du,color:"text-green-600"},Dungeon:{icon:Oc,color:"text-red-600"},Castle:{icon:ak,color:"text-gray-600"},Forest:{icon:fk,color:"text-emerald-600"},Mountain:{icon:lk,color:"text-stone-600"},Temple:{icon:tw,color:"text-yellow-600"},Ruins:{icon:Oc,color:"text-orange-600"},Camp:{icon:hk,color:"text-amber-600"},Other:{icon:Mn,color:"text-gray-600"}},Vce=[{value:"walking",label:"Walking",icon:j$,description:"On foot travel"},{value:"horseback",label:"Horseback",icon:une,description:"Mounted travel"},{value:"ship",label:"Ship/Boat",icon:Ine,description:"Water travel"},{value:"teleportation",label:"Teleportation",icon:Da,description:"Magical transport"},{value:"other",label:"Other",icon:tT,description:"Custom travel method"}],Wce=[{value:"easy",label:"Easy",color:"text-green-600",description:"Safe, well-traveled routes"},{value:"moderate",label:"Moderate",color:"text-yellow-600",description:"Some hazards possible"},{value:"hard",label:"Hard",color:"text-orange-600",description:"Dangerous terrain or enemies"},{value:"dangerous",label:"Dangerous",color:"text-red-600",description:"High risk of death"}];function qce({location:s,allLocations:e,isReadOnly:t,onConnectionsUpdated:n}){const[r,a]=C.useState(!1),[o,l]=C.useState(""),[c,d]=C.useState({method:"walking",duration:"",difficulty:"moderate",notes:""}),[h,f]=C.useState(!0),m=Re(re.locations.addLocationConnection),p=Re(re.locations.removeLocationConnection),x=(e==null?void 0:e.filter(w=>{var S;return w._id!==s._id&&!((S=s.linkedLocations)!=null&&S.includes(w._id))&&(!s.campaignId||w.campaignId===s.campaignId)}))||[],g=(e==null?void 0:e.filter(w=>{var S;return(S=s.linkedLocations)==null?void 0:S.includes(w._id)}))||[],b=async()=>{if(!o){rt.error("Please select a location to connect");return}try{await m({locationId:s._id,connectedLocationId:o,bidirectional:h}),rt.success("Connection added successfully!"),a(!1),l(""),d({method:"walking",duration:"",difficulty:"moderate",notes:""}),n==null||n()}catch(w){console.error("Failed to add connection:",w),rt.error("Failed to add connection. Please try again.")}},v=async w=>{try{await p({locationId:s._id,connectedLocationId:w,bidirectional:!0}),rt.success("Connection removed successfully!"),n==null||n()}catch(S){console.error("Failed to remove connection:",S),rt.error("Failed to remove connection. Please try again.")}},y=w=>{var S;return((S=iO[w])==null?void 0:S.icon)||Mn};return i.jsxs("div",{className:"space-y-4",children:[i.jsxs(oe,{children:[i.jsxs(ke,{children:[i.jsxs(Ne,{className:"flex items-center gap-2",children:[i.jsx(jx,{className:"h-5 w-5"}),"Location Connections",i.jsxs(ue,{variant:"secondary",children:[g.length," Connected"]})]}),i.jsx(At,{children:"Manage connections between locations for travel planning and exploration"})]}),i.jsxs(he,{children:[!t&&i.jsxs(cs,{open:r,onOpenChange:a,children:[i.jsx(oT,{asChild:!0,children:i.jsxs(q,{size:"sm",className:"mb-4",children:[i.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Add Connection"]})}),i.jsxs(is,{children:[i.jsxs(Rs,{children:[i.jsx(Ds,{children:"Add Location Connection"}),i.jsx(Lr,{children:"Connect this location to another for travel planning"})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium",children:"Connect to Location"}),i.jsxs(wt,{value:o,onValueChange:l,children:[i.jsx(gt,{children:i.jsx(Ct,{placeholder:"Select a location..."})}),i.jsx(xt,{children:x.map(w=>{const S=y(w.type);return i.jsx(Ie,{value:w._id,children:i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(S,{className:"h-4 w-4"}),i.jsx("span",{children:w.name}),i.jsx(ue,{variant:"outline",className:"text-xs",children:w.type})]})},w._id)})})]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("input",{type:"checkbox",id:"bidirectional",checked:h,onChange:w=>f(w.target.checked),className:"w-4 h-4"}),i.jsx("label",{htmlFor:"bidirectional",className:"text-sm",children:"Bidirectional connection (both ways)"})]})]}),i.jsxs(Xn,{children:[i.jsx(q,{variant:"outline",onClick:()=>a(!1),children:"Cancel"}),i.jsx(q,{onClick:b,disabled:!o,children:"Add Connection"})]})]})]}),g.length===0?i.jsxs("div",{className:"text-center text-muted-foreground py-8",children:[i.jsx(jx,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),i.jsx("p",{className:"text-lg",children:"No Connections"}),i.jsx("p",{className:"text-sm",children:t?"This location has no connections to other places":"Link this location to other places for easier navigation"})]}):i.jsx("div",{className:"space-y-3",children:g.map(w=>{const S=y(w.type),j=iO[w.type];return i.jsxs("div",{className:"flex items-center gap-3 p-4 bg-muted rounded-lg border",children:[i.jsx(S,{className:`h-6 w-6 ${j.color}`}),i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[i.jsx("p",{className:"font-medium",children:w.name}),i.jsx(ue,{variant:"outline",className:"text-xs",children:w.type}),w.campaignId?i.jsx(ue,{variant:"secondary",className:"text-xs",children:"Campaign"}):i.jsx(ue,{variant:"default",className:"text-xs",children:"Global"})]}),i.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(j$,{className:"h-3 w-3"}),i.jsx("span",{children:"Walking"})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(Ra,{className:"h-3 w-3"}),i.jsx("span",{children:"~2 hours"})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(Co,{className:"h-3 w-3 text-yellow-500"}),i.jsx("span",{children:"Moderate"})]})]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(q,{variant:"ghost",size:"sm",onClick:()=>{},children:i.jsx(C$,{className:"h-4 w-4"})}),!t&&i.jsx(q,{variant:"ghost",size:"sm",onClick:()=>v(w._id),className:"text-destructive hover:text-destructive",children:i.jsx(Mr,{className:"h-4 w-4"})})]})]},w._id)})})]})]}),g.length>0&&i.jsxs(oe,{children:[i.jsxs(ke,{children:[i.jsxs(Ne,{className:"flex items-center gap-2",children:[i.jsx(tT,{className:"h-5 w-5"}),"Travel Planning"]}),i.jsx(At,{children:"Quick reference for travel between connected locations"})]}),i.jsx(he,{children:i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2",children:[i.jsx(tT,{className:"h-4 w-4"}),"Travel Methods"]}),i.jsx("div",{className:"space-y-2",children:Vce.slice(0,4).map(w=>{const S=w.icon;return i.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[i.jsx(S,{className:"h-4 w-4 text-muted-foreground"}),i.jsx("span",{children:w.label})]},w.value)})})]}),i.jsxs("div",{children:[i.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2",children:[i.jsx(lm,{className:"h-4 w-4"}),"Difficulty Levels"]}),i.jsx("div",{className:"space-y-2",children:Wce.map(w=>i.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[i.jsx(Co,{className:`h-4 w-4 ${w.color}`}),i.jsx("span",{children:w.label}),i.jsxs("span",{className:"text-muted-foreground text-xs",children:["- ",w.description]})]},w.value))})]})]}),i.jsx(On,{}),i.jsx("div",{className:"text-sm text-muted-foreground",children:i.jsxs("p",{children:[i.jsx("strong",{children:"Note:"})," Advanced travel route management with custom travel times, costs, and encounter tables will be available in a future update."]})})]})})]})]})}const vA=[{value:"Town",label:"Town",icon:Du,description:"Small settlements and communities"},{value:"City",label:"City",icon:Cx,description:"Large urban centers"},{value:"Village",label:"Village",icon:Du,description:"Rural communities and hamlets"},{value:"Dungeon",label:"Dungeon",icon:Oc,description:"Underground complexes and ruins"},{value:"Castle",label:"Castle",icon:ak,description:"Fortified structures and keeps"},{value:"Forest",label:"Forest",icon:fk,description:"Wooded areas and natural groves"},{value:"Mountain",label:"Mountain",icon:lk,description:"Peaks, ranges, and highland areas"},{value:"Temple",label:"Temple",icon:tw,description:"Religious sites and sacred places"},{value:"Ruins",label:"Ruins",icon:Oc,description:"Abandoned and ancient structures"},{value:"Camp",label:"Camp",icon:hk,description:"Temporary settlements and outposts"},{value:"Other",label:"Other",icon:Mn,description:"Custom location types"}];function uz({open:s,onOpenChange:e,mode:t,location:n,onSuccess:r,defaultTab:a="basic"}){var W,ee;const{user:o,isLoading:l}=Cm();if(l)return i.jsx(cs,{open:s,onOpenChange:e,children:i.jsx(is,{children:i.jsx("div",{className:"flex items-center justify-center py-8",children:i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900"}),i.jsx("span",{children:"Loading..."})]})})})});if(!o)return null;const{canAccess:c,isCampaignMaster:d,isAdmin:h}=aw(t,"location",n),[f,m]=C.useState(a),[p,x]=C.useState(!1),[g,b]=C.useState(""),v=Re(re.locations.createLocation),y=Re(re.locations.updateLocation),w=Fe(re.campaigns.getMyCampaigns),S=Fe(re.locations.getLocations,n!=null&&n.campaignId?{campaignId:n.campaignId}:"skip"),j=Fe(re.characters.getCharacters,n!=null&&n.campaignId?{campaignId:n.campaignId}:"skip"),A=Fe(re.interactions.getInteractions,n!=null&&n.campaignId?{campaignId:n.campaignId}:"skip"),k=t==="read",_=kl({resolver:Nl(Yie),defaultValues:{name:(n==null?void 0:n.name)||"",description:(n==null?void 0:n.description)||"",type:(n==null?void 0:n.type)||"Other",campaignId:(n==null?void 0:n.campaignId)||void 0,notableCharacterIds:(n==null?void 0:n.notableCharacterIds)||[],linkedLocations:(n==null?void 0:n.linkedLocations)||[],population:(n==null?void 0:n.population)||void 0,government:(n==null?void 0:n.government)||"",defenses:(n==null?void 0:n.defenses)||"",imageUrls:(n==null?void 0:n.imageUrls)||[],mapId:(n==null?void 0:n.mapId)||void 0,publicInformation:(n==null?void 0:n.publicInformation)||"",secrets:(n==null?void 0:n.secrets)||"",dmNotes:(n==null?void 0:n.dmNotes)||"",interactionsAtLocation:(n==null?void 0:n.interactionsAtLocation)||[]}});V.useEffect(()=>{n&&(t==="edit"||t==="read")?_.reset({name:n.name,description:n.description,type:n.type,campaignId:n.campaignId||void 0,notableCharacterIds:n.notableCharacterIds||[],linkedLocations:n.linkedLocations||[],population:n.population||void 0,government:n.government||"",defenses:n.defenses||"",imageUrls:n.imageUrls||[],mapId:n.mapId||void 0,publicInformation:n.publicInformation||"",secrets:n.secrets||"",dmNotes:n.dmNotes||"",interactionsAtLocation:n.interactionsAtLocation||[]}):t==="create"&&_.reset({name:"",description:"",type:"Other",campaignId:void 0,notableCharacterIds:[],linkedLocations:[],population:void 0,government:"",defenses:"",imageUrls:[],mapId:void 0,publicInformation:"",secrets:"",dmNotes:"",interactionsAtLocation:[]})},[n,t,_]);const L=async Z=>{x(!0);try{t==="create"?(await v(Z),rt.success("Location created successfully!")):t==="edit"&&n&&(await y({id:n._id,...Z}),rt.success("Location updated successfully!")),r==null||r(),e(!1),_.reset()}catch(z){console.error("Failed to save location:",z),rt.error("Failed to save location. Please try again.")}finally{x(!1)}},D=()=>{switch(t){case"create":return"Create Location";case"edit":return"Edit Location";case"read":return"Location Details";default:return"Location"}},P=()=>{switch(t){case"read":return"View location details and connections";case"create":return"Create a new location for your campaign";case"edit":return"Modify location details and connections";default:return""}},T=Z=>{const z=vA.find(se=>se.value===Z);return z?z.icon:Mn},B=()=>{if(g.trim()){const Z=_.getValues("imageUrls")||[];_.setValue("imageUrls",[...Z,g.trim()]),b("")}},R=Z=>{const z=_.getValues("imageUrls")||[];_.setValue("imageUrls",z.filter((se,de)=>de!==Z))},O=Z=>Z>=1e6?`${(Z/1e6).toFixed(1)}M`:Z>=1e3?`${(Z/1e3).toFixed(1)}K`:Z.toString(),I=n?T(n.type):Mn,U=(S==null?void 0:S.filter(Z=>Z._id!==(n==null?void 0:n._id)))||[],M=(j==null?void 0:j.filter(Z=>{var z;return(z=n==null?void 0:n.notableCharacterIds)==null?void 0:z.includes(Z._id)}))||[],$=(A==null?void 0:A.filter(Z=>{var z;return(z=n==null?void 0:n.interactionsAtLocation)==null?void 0:z.includes(Z._id)}))||[];return i.jsx(cs,{open:s,onOpenChange:e,children:i.jsxs(is,{className:"max-w-4xl max-h-[90vh] overflow-hidden",children:[i.jsxs(Rs,{children:[i.jsxs(Ds,{className:"flex items-center gap-2",children:[i.jsx(I,{className:"h-5 w-5"}),D(),n&&i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(ue,{variant:"outline",children:((W=vA.find(Z=>Z.value===n.type))==null?void 0:W.label)||n.type}),n.population&&i.jsxs(ue,{variant:"secondary",children:["Pop: ",O(n.population)]})]})]}),i.jsx(Lr,{children:P()})]}),i.jsx(Al,{..._,children:i.jsx("form",{onSubmit:_.handleSubmit(L),className:"space-y-4 flex-1 overflow-hidden",children:i.jsxs(Qn,{value:f,onValueChange:m,className:"flex-1 overflow-hidden",children:[i.jsxs(In,{className:"grid w-full grid-cols-5",children:[i.jsxs(Be,{value:"basic",className:"flex items-center gap-1",children:[i.jsx(Cx,{className:"h-3 w-3"}),"Basic Info"]}),i.jsxs(Be,{value:"characters",className:"flex items-center gap-1",children:[i.jsx(Cs,{className:"h-3 w-3"}),"Characters"]}),i.jsxs(Be,{value:"connections",className:"flex items-center gap-1",children:[i.jsx(jx,{className:"h-3 w-3"}),"Connections"]}),i.jsxs(Be,{value:"interactions",className:"flex items-center gap-1",children:[i.jsx(Uv,{className:"h-3 w-3"}),"History"]}),i.jsxs(Be,{value:"secrets",className:"flex items-center gap-1",children:[i.jsx(Sx,{className:"h-3 w-3"}),"Secrets"]})]}),i.jsxs("div",{className:"overflow-y-auto flex-1 mt-4 space-y-4",children:[i.jsx($e,{value:"basic",className:"space-y-4",children:i.jsxs(oe,{children:[i.jsxs(ke,{children:[i.jsx(Ne,{children:"Location Information"}),i.jsx(At,{children:"Core details about this location"})]}),i.jsxs(he,{className:"space-y-4",children:[i.jsx(pe,{control:_.control,name:"name",render:({field:Z})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Location Name *"}),i.jsx(ge,{children:i.jsx(_e,{...Z,disabled:k,placeholder:"Enter location name..."})}),i.jsx(ye,{})]})}),i.jsx(pe,{control:_.control,name:"description",render:({field:Z})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Description *"}),i.jsx(ge,{children:i.jsx(ps,{...Z,disabled:k,placeholder:"Describe the location's appearance and atmosphere...",rows:4})}),i.jsx(ye,{})]})}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsx(pe,{control:_.control,name:"type",render:({field:Z})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Location Type"}),i.jsxs(wt,{onValueChange:Z.onChange,defaultValue:Z.value,disabled:k,children:[i.jsx(ge,{children:i.jsx(gt,{children:i.jsx(Ct,{placeholder:"Select type"})})}),i.jsx(xt,{children:vA.map(z=>i.jsx(Ie,{value:z.value,children:z.label},z.value))})]}),i.jsx(ye,{})]})}),i.jsx(pe,{control:_.control,name:"campaignId",render:({field:Z})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Campaign"}),i.jsxs(wt,{onValueChange:Z.onChange,defaultValue:Z.value,disabled:k,children:[i.jsx(ge,{children:i.jsx(gt,{children:i.jsx(Ct,{placeholder:"Select campaign (optional)"})})}),i.jsx(xt,{children:w==null?void 0:w.map(z=>i.jsx(Ie,{value:z._id,children:z.name},z._id))})]}),i.jsx(nt,{children:"Leave empty for global locations"}),i.jsx(ye,{})]})})]}),i.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[i.jsx(pe,{control:_.control,name:"population",render:({field:Z})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Population"}),i.jsx(ge,{children:i.jsx(_e,{...Z,type:"number",min:"0",disabled:k,placeholder:"Number of inhabitants",onChange:z=>Z.onChange(z.target.value?parseInt(z.target.value):void 0)})}),i.jsx(ye,{})]})}),i.jsx(pe,{control:_.control,name:"government",render:({field:Z})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Government"}),i.jsx(ge,{children:i.jsx(_e,{...Z,disabled:k,placeholder:"e.g., Mayor, Lord, Council"})}),i.jsx(ye,{})]})}),i.jsx(pe,{control:_.control,name:"defenses",render:({field:Z})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Defenses"}),i.jsx(ge,{children:i.jsx(_e,{...Z,disabled:k,placeholder:"e.g., City walls, Guards"})}),i.jsx(ye,{})]})})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsx(st,{children:"Location Images"}),i.jsxs("div",{className:"space-y-2",children:[(ee=_.watch("imageUrls"))==null?void 0:ee.map((Z,z)=>i.jsxs("div",{className:"flex items-center gap-2 p-2 bg-muted rounded",children:[i.jsx(k$,{className:"h-4 w-4 text-muted-foreground"}),i.jsx("span",{className:"flex-1 text-sm truncate",children:Z}),i.jsx(q,{type:"button",variant:"ghost",size:"sm",onClick:()=>window.open(Z,"_blank"),children:i.jsx(C$,{className:"h-4 w-4"})}),!k&&i.jsx(q,{type:"button",variant:"ghost",size:"sm",onClick:()=>R(z),children:i.jsx(Mr,{className:"h-4 w-4"})})]},z)),!k&&i.jsxs("div",{className:"flex gap-2",children:[i.jsx(_e,{value:g,onChange:Z=>b(Z.target.value),placeholder:"Enter image URL...",onKeyPress:Z=>Z.key==="Enter"&&(Z.preventDefault(),B())}),i.jsx(q,{type:"button",onClick:B,size:"sm",children:i.jsx(Mt,{className:"h-4 w-4"})})]})]})]})]})]})}),i.jsx($e,{value:"characters",className:"space-y-4",children:i.jsxs(oe,{children:[i.jsxs(ke,{children:[i.jsx(Ne,{children:"Notable Characters"}),i.jsx(At,{children:"NPCs and important figures associated with this location"})]}),i.jsxs(he,{className:"space-y-4",children:[M.length===0?i.jsxs("div",{className:"text-center text-muted-foreground py-8",children:[i.jsx(Cs,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),i.jsx("p",{className:"text-lg",children:"No Notable Characters"}),i.jsx("p",{className:"text-sm",children:"Add characters to see them listed here"})]}):i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:M.map(Z=>i.jsx("div",{className:"p-3 border rounded-lg",children:i.jsx("div",{className:"flex items-start justify-between",children:i.jsxs("div",{children:[i.jsx("h4",{className:"font-medium",children:Z.name}),i.jsxs("p",{className:"text-sm text-muted-foreground",children:[Z.race," ",Z.class]}),Z.characterType==="npc"&&i.jsx(ue,{variant:"secondary",className:"mt-1 text-xs",children:"NPC"})]})})},Z._id))}),i.jsx("div",{className:"text-center text-muted-foreground py-4",children:i.jsx("p",{className:"text-sm",children:"Character assignment management coming soon"})})]})]})}),i.jsx($e,{value:"connections",className:"space-y-4",children:i.jsx(qce,{location:n||_.getValues(),allLocations:U,isReadOnly:k,onConnectionsUpdated:()=>{}})}),i.jsx($e,{value:"interactions",className:"space-y-4",children:i.jsxs(oe,{children:[i.jsxs(ke,{children:[i.jsx(Ne,{children:"Interaction History"}),i.jsx(At,{children:"Past events and interactions that occurred at this location"})]}),i.jsx(he,{className:"space-y-4",children:$.length===0?i.jsxs("div",{className:"text-center text-muted-foreground py-8",children:[i.jsx(Uv,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),i.jsx("p",{className:"text-lg",children:"No Interaction History"}),i.jsx("p",{className:"text-sm",children:"Interactions that happen here will be recorded automatically"})]}):i.jsx("div",{className:"space-y-3",children:$.map(Z=>i.jsx("div",{className:"p-3 border rounded-lg",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{children:[i.jsx("h4",{className:"font-medium",children:Z.name}),i.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(Z.createdAt||0).toLocaleDateString()})]}),i.jsx(ue,{variant:"outline",children:Z.status})]})},Z._id))})})]})}),i.jsx($e,{value:"secrets",className:"space-y-4",children:i.jsxs(oe,{children:[i.jsxs(ke,{children:[i.jsx(Ne,{children:"Location Information"}),i.jsx(At,{children:"Public information and hidden secrets"})]}),i.jsxs(he,{className:"space-y-4",children:[i.jsx(pe,{control:_.control,name:"publicInformation",render:({field:Z})=>i.jsxs(fe,{children:[i.jsxs(me,{className:"flex items-center gap-2",children:[i.jsx(Ku,{className:"h-4 w-4"}),"Public Information"]}),i.jsx(ge,{children:i.jsx(ps,{...Z,disabled:k,placeholder:"Information commonly known about this location...",rows:3})}),i.jsx(nt,{children:"This information is generally known and may be shared with players"}),i.jsx(ye,{})]})}),(d((n==null?void 0:n.campaignId)||"")||h)&&i.jsxs(i.Fragment,{children:[i.jsx(pe,{control:_.control,name:"secrets",render:({field:Z})=>i.jsxs(fe,{children:[i.jsxs(me,{className:"flex items-center gap-2",children:[i.jsx(Sx,{className:"h-4 w-4"}),"Location Secrets"]}),i.jsx(ge,{children:i.jsx(ps,{...Z,disabled:k,placeholder:"Hidden features, secret passages, buried treasures...",rows:3})}),i.jsx(nt,{children:"Secret information that requires investigation or exploration to discover"}),i.jsx(ye,{})]})}),i.jsx(pe,{control:_.control,name:"dmNotes",render:({field:Z})=>i.jsxs(fe,{children:[i.jsx(me,{children:"DM Notes (Private)"}),i.jsx(ge,{children:i.jsx(ps,{...Z,disabled:k,placeholder:"Private notes for the DM about this location...",rows:4})}),i.jsx(nt,{children:"These notes are only visible to the DM and admins"}),i.jsx(ye,{})]})})]})]})]})})]})]})})}),i.jsxs(Xn,{children:[t==="read"&&i.jsx(q,{variant:"outline",onClick:()=>e(!1),children:"Close"}),(t==="create"||t==="edit")&&i.jsxs(i.Fragment,{children:[i.jsx(q,{variant:"outline",onClick:()=>e(!1),children:"Cancel"}),i.jsxs(q,{type:"submit",disabled:p,onClick:_.handleSubmit(L),children:[p&&i.jsx(Ss,{className:"mr-2 h-4 w-4 animate-spin"}),t==="create"?"Create Location":"Save Changes"]})]})]})]})})}function Gce({open:s,onOpenChange:e,mode:t,campaign:n,onSuccess:r,defaultTab:a="overview",dashboardMode:o="dm"}){const[l,c]=C.useState(null),{user:d,isLoading:h}=Cm();if(h)return i.jsx(cs,{open:s,onOpenChange:e,children:i.jsx(is,{children:i.jsx("div",{className:"flex items-center justify-center py-8",children:i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900"}),i.jsx("span",{children:"Loading..."})]})})})});if(!d)return i.jsx(cs,{open:s,onOpenChange:e,children:i.jsxs(is,{children:[i.jsx(Rs,{children:i.jsx(Ds,{children:"Authentication Required"})}),i.jsxs("div",{className:"p-4",children:[i.jsx("p",{className:"text-red-600",children:"You must be signed in to access this feature."}),i.jsx(q,{onClick:()=>e(!1),className:"mt-4",children:"Close"})]})]})});let f;try{f=aw(t,"campaign",n)}catch(ce){return c(`Access error: ${ce instanceof Error?ce.message:"Unknown error"}`),i.jsx(cs,{open:s,onOpenChange:e,children:i.jsxs(is,{children:[i.jsx(Rs,{children:i.jsx(Ds,{children:"Access Error"})}),i.jsxs("div",{className:"p-4",children:[i.jsx("p",{className:"text-red-600",children:l}),i.jsx(q,{onClick:()=>e(!1),className:"mt-4",children:"Close"})]})]})})}const{canAccess:m,isCampaignMaster:p,isPlayer:x,isAdmin:g}=f,[b,v]=C.useState(a),[y,w]=C.useState(!1),[S,j]=C.useState(!1),[A,k]=C.useState(!1),[_,L]=C.useState(!1),[D,P]=C.useState(!1),T=Re(re.campaigns.createCampaign),B=Re(re.campaigns.updateCampaign),R=Fe(re.quests.getQuests,n!=null&&n._id?{campaignId:n._id}:"skip"),O=Fe(re.timeline.getTimelineEvents,n!=null&&n._id?{campaignId:n._id}:"skip"),I=Fe(re.factions.getFactions,n!=null&&n._id?{campaignId:n._id}:"skip"),U=Fe(re.locations.getLocations,n!=null&&n._id?{campaignId:n._id}:"skip"),M=Fe(re.characters.getCharacters,n!=null&&n._id?{campaignId:n._id}:"skip"),$=Fe(re.interactions.getInteractions,n!=null&&n._id?{campaignId:n._id}:"skip"),W=t==="read",ee=o==="dm"&&(n!=null&&n._id?p(n._id):g),Z=o==="player"&&(n!=null&&n._id?x(n._id):!1),z=kl({resolver:Nl(Fie),defaultValues:{name:(n==null?void 0:n.name)||"",description:(n==null?void 0:n.description)||"",worldSetting:(n==null?void 0:n.worldSetting)||"",isPublic:(n==null?void 0:n.isPublic)||!1}});V.useEffect(()=>{n&&(t==="edit"||t==="read")?z.reset({name:n.name,description:n.description||"",worldSetting:n.worldSetting||"",isPublic:n.isPublic}):t==="create"&&z.reset({name:"",description:"",worldSetting:"",isPublic:!1})},[n,t,z]);const se=async ce=>{w(!0);try{t==="create"?(await T(ce),rt.success("Campaign created successfully!")):t==="edit"&&n&&(await B({campaignId:n._id,...ce}),rt.success("Campaign updated successfully!")),r==null||r(),e(!1),z.reset()}catch(Ue){console.error("Failed to save campaign:",Ue),rt.error("Failed to save campaign. Please try again.")}finally{w(!1)}},de=()=>{if(t==="read")return ee?"Campaign Dashboard (DM)":"Campaign Dashboard (Player)";switch(t){case"create":return"Create Campaign";case"edit":return"Edit Campaign";default:return"Campaign"}},ne=()=>{if(t==="read")return ee?"Comprehensive campaign management and oversight":"View campaign information and your progress";switch(t){case"create":return"Create a new D&D campaign";case"edit":return"Modify campaign settings and details";default:return""}},H={totalQuests:(R==null?void 0:R.length)||0,activeQuests:(R==null?void 0:R.filter(ce=>ce.status==="in_progress"||ce.status==="InProgress").length)||0,completedQuests:(R==null?void 0:R.filter(ce=>ce.status==="completed").length)||0,totalTimelineEvents:(O==null?void 0:O.length)||0,totalFactions:(I==null?void 0:I.length)||0,totalLocations:(U==null?void 0:U.length)||0,totalCharacters:(M==null?void 0:M.length)||0,totalInteractions:($==null?void 0:$.length)||0},Y=(M==null?void 0:M.filter(ce=>ce.characterType==="player"))||[],ae=(M==null?void 0:M.filter(ce=>ce.characterType==="npc"))||[];return i.jsxs(cs,{open:s,onOpenChange:e,children:[i.jsxs(is,{className:"max-w-6xl max-h-[90vh] overflow-hidden",children:[i.jsxs(Rs,{children:[i.jsxs(Ds,{className:"flex items-center gap-2",children:[ee?i.jsx(Ru,{className:"h-5 w-5"}):i.jsx(Cs,{className:"h-5 w-5"}),de(),n&&i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(ue,{variant:n.isPublic?"default":"secondary",children:n.isPublic?"Public":"Private"}),ee&&i.jsx(ue,{variant:"outline",children:"DM View"}),Z&&i.jsx(ue,{variant:"outline",children:"Player View"})]})]}),i.jsx(Lr,{children:ne()})]}),i.jsx(Al,{...z,children:i.jsx("form",{onSubmit:z.handleSubmit(se),className:"space-y-4 flex-1 overflow-hidden",children:i.jsxs(Qn,{value:b,onValueChange:v,className:"flex-1 overflow-hidden",children:[i.jsxs(In,{className:`grid w-full ${ee?"grid-cols-7":"grid-cols-5"}`,children:[i.jsxs(Be,{value:"overview",className:"flex items-center gap-1",children:[i.jsx(Rne,{className:"h-3 w-3"}),"Overview"]}),ee&&i.jsxs(Be,{value:"players",className:"flex items-center gap-1",children:[i.jsx(Cs,{className:"h-3 w-3"}),"Players"]}),Z&&i.jsxs(Be,{value:"party",className:"flex items-center gap-1",children:[i.jsx(Cs,{className:"h-3 w-3"}),"Party"]}),i.jsxs(Be,{value:"quests",className:"flex items-center gap-1",children:[i.jsx(cA,{className:"h-3 w-3"}),"Quests"]}),i.jsxs(Be,{value:"timeline",className:"flex items-center gap-1",children:[i.jsx(Ac,{className:"h-3 w-3"}),"Timeline"]}),i.jsxs(Be,{value:"world",className:"flex items-center gap-1",children:[i.jsx(Mn,{className:"h-3 w-3"}),"World"]}),ee&&i.jsxs(Be,{value:"resources",className:"flex items-center gap-1",children:[i.jsx(uk,{className:"h-3 w-3"}),"Resources"]}),ee&&i.jsxs(Be,{value:"settings",className:"flex items-center gap-1",children:[i.jsx(dk,{className:"h-3 w-3"}),"Settings"]})]}),i.jsxs("div",{className:"overflow-y-auto flex-1 mt-4 space-y-4",children:[i.jsx($e,{value:"overview",className:"space-y-4",children:t==="read"?i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[i.jsxs(oe,{children:[i.jsxs(ke,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[i.jsx(Ne,{className:"text-sm font-medium",children:"Total Quests"}),i.jsx(cA,{className:"h-4 w-4 text-muted-foreground"})]}),i.jsxs(he,{children:[i.jsx("div",{className:"text-2xl font-bold",children:H.totalQuests}),i.jsxs("p",{className:"text-xs text-muted-foreground",children:[H.activeQuests," active, ",H.completedQuests," completed"]})]})]}),i.jsxs(oe,{children:[i.jsxs(ke,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[i.jsx(Ne,{className:"text-sm font-medium",children:"Timeline Events"}),i.jsx(Ac,{className:"h-4 w-4 text-muted-foreground"})]}),i.jsxs(he,{children:[i.jsx("div",{className:"text-2xl font-bold",children:H.totalTimelineEvents}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Historical and planned events"})]})]}),i.jsxs(oe,{children:[i.jsxs(ke,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[i.jsx(Ne,{className:"text-sm font-medium",children:"Factions"}),i.jsx(Dr,{className:"h-4 w-4 text-muted-foreground"})]}),i.jsxs(he,{children:[i.jsx("div",{className:"text-2xl font-bold",children:H.totalFactions}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Political organizations"})]})]}),i.jsxs(oe,{children:[i.jsxs(ke,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[i.jsx(Ne,{className:"text-sm font-medium",children:"Locations"}),i.jsx(Mn,{className:"h-4 w-4 text-muted-foreground"})]}),i.jsxs(he,{children:[i.jsx("div",{className:"text-2xl font-bold",children:H.totalLocations}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"Mapped world locations"})]})]})]}):i.jsxs(oe,{children:[i.jsxs(ke,{children:[i.jsx(Ne,{children:"Campaign Information"}),i.jsx(At,{children:"Basic details about your campaign"})]}),i.jsxs(he,{className:"space-y-4",children:[i.jsx(pe,{control:z.control,name:"name",render:({field:ce})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Campaign Name *"}),i.jsx(ge,{children:i.jsx(_e,{...ce,disabled:W,placeholder:"Enter campaign name..."})}),i.jsx(ye,{})]})}),i.jsx(pe,{control:z.control,name:"description",render:({field:ce})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Description"}),i.jsx(ge,{children:i.jsx(ps,{...ce,disabled:W,placeholder:"Describe your campaign setting and story...",rows:3})}),i.jsx(ye,{})]})}),i.jsx(pe,{control:z.control,name:"worldSetting",render:({field:ce})=>i.jsxs(fe,{children:[i.jsx(me,{children:"World Setting"}),i.jsx(ge,{children:i.jsx(_e,{...ce,disabled:W,placeholder:"e.g., Forgotten Realms, Homebrew World..."})}),i.jsx(ye,{})]})}),i.jsx(pe,{control:z.control,name:"isPublic",render:({field:ce})=>i.jsxs(fe,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[i.jsxs("div",{className:"space-y-0.5",children:[i.jsx(me,{className:"text-base",children:"Public Campaign"}),i.jsx(nt,{children:"Allow other users to discover and request to join this campaign"})]}),i.jsx(ge,{children:i.jsx(lT,{checked:ce.value,onCheckedChange:ce.onChange,disabled:W})})]})})]})]})}),ee&&i.jsx($e,{value:"players",className:"space-y-4",children:i.jsxs(oe,{children:[i.jsxs(ke,{children:[i.jsx(Ne,{children:"Player Management"}),i.jsx(At,{children:"Manage player access and character assignments"})]}),i.jsx(he,{className:"space-y-4",children:i.jsxs("div",{className:"text-center text-muted-foreground py-8",children:[i.jsx(lM,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),i.jsx("p",{className:"text-lg",children:"Player Management"}),i.jsx("p",{className:"text-sm",children:"Advanced player invitation and management coming soon"})]})})]})}),Z&&i.jsx($e,{value:"party",className:"space-y-4",children:i.jsxs(oe,{children:[i.jsxs(ke,{children:[i.jsx(Ne,{children:"Party Members"}),i.jsx(At,{children:"Other player characters in this campaign"})]}),i.jsx(he,{className:"space-y-4",children:Y.length===0?i.jsxs("div",{className:"text-center text-muted-foreground py-8",children:[i.jsx(Cs,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),i.jsx("p",{className:"text-lg",children:"No Party Members"}),i.jsx("p",{className:"text-sm",children:"Player characters will appear here when they join"})]}):i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:Y.map(ce=>i.jsxs("div",{className:"p-4 border rounded-lg",children:[i.jsx("h4",{className:"font-medium",children:ce.name}),i.jsxs("p",{className:"text-sm text-muted-foreground",children:["Level ",ce.level," ",ce.race," ",ce.class]}),i.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[i.jsxs(ue,{variant:"outline",children:["AC ",ce.armorClass]}),i.jsxs(ue,{variant:"outline",children:["HP ",ce.hitPoints]})]})]},ce._id))})})]})}),i.jsx($e,{value:"quests",className:"space-y-4",children:i.jsxs(oe,{children:[i.jsxs(ke,{children:[i.jsxs(Ne,{className:"flex items-center justify-between",children:[i.jsx("span",{children:"Campaign Quests"}),ee&&i.jsxs(q,{size:"sm",onClick:()=>j(!0),children:[i.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Add Quest"]})]}),i.jsx(At,{children:ee?"Manage all campaign quests":"Your assigned quests and progress"})]}),i.jsx(he,{children:(R==null?void 0:R.length)===0?i.jsxs("div",{className:"text-center text-muted-foreground py-8",children:[i.jsx(cA,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),i.jsx("p",{className:"text-lg",children:"No Quests Yet"}),i.jsx("p",{className:"text-sm",children:ee?"Create your first quest to get started":"Quests will appear here when assigned"})]}):i.jsxs("div",{className:"space-y-3",children:[R==null?void 0:R.slice(0,5).map(ce=>i.jsxs("div",{className:"flex items-center justify-between p-3 border rounded",children:[i.jsxs("div",{children:[i.jsx("h4",{className:"font-medium",children:ce.name}),i.jsx("p",{className:"text-sm text-muted-foreground",children:ce.description})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(ue,{variant:"outline",children:ce.status}),ee&&i.jsx(q,{variant:"ghost",size:"sm",children:i.jsx(hS,{className:"h-4 w-4"})})]})]},ce._id)),R&&R.length>5&&i.jsxs("p",{className:"text-sm text-muted-foreground text-center",children:["And ",R.length-5," more quests..."]})]})})]})}),i.jsx($e,{value:"timeline",className:"space-y-4",children:i.jsxs(oe,{children:[i.jsxs(ke,{children:[i.jsxs(Ne,{className:"flex items-center justify-between",children:[i.jsx("span",{children:"Campaign Timeline"}),ee&&i.jsxs(q,{size:"sm",onClick:()=>k(!0),children:[i.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Add Event"]})]}),i.jsx(At,{children:ee?"Manage campaign timeline events":"Important campaign events and history"})]}),i.jsx(he,{children:(O==null?void 0:O.length)===0?i.jsxs("div",{className:"text-center text-muted-foreground py-8",children:[i.jsx(Ac,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),i.jsx("p",{className:"text-lg",children:"No Timeline Events"}),i.jsx("p",{className:"text-sm",children:ee?"Create timeline events to track campaign history":"Campaign events will appear here"})]}):i.jsx("div",{className:"space-y-3",children:O==null?void 0:O.slice(0,5).map(ce=>i.jsxs("div",{className:"flex items-center justify-between p-3 border rounded",children:[i.jsxs("div",{children:[i.jsx("h4",{className:"font-medium",children:ce.title}),i.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(ce.date).toLocaleDateString()})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(ue,{variant:"outline",children:ce.type}),ee&&i.jsx(q,{variant:"ghost",size:"sm",children:i.jsx(hS,{className:"h-4 w-4"})})]})]},ce._id))})})]})}),i.jsx($e,{value:"world",className:"space-y-4",children:i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs(oe,{children:[i.jsx(ke,{children:i.jsxs(Ne,{className:"flex items-center justify-between",children:[i.jsx("span",{children:"Locations"}),ee&&i.jsx(q,{size:"sm",onClick:()=>P(!0),children:i.jsx(Mt,{className:"h-4 w-4"})})]})}),i.jsx(he,{children:i.jsxs("p",{className:"text-sm text-muted-foreground",children:[H.totalLocations," locations mapped"]})})]}),i.jsxs(oe,{children:[i.jsx(ke,{children:i.jsxs(Ne,{className:"flex items-center justify-between",children:[i.jsx("span",{children:"Factions"}),ee&&i.jsx(q,{size:"sm",onClick:()=>L(!0),children:i.jsx(Mt,{className:"h-4 w-4"})})]})}),i.jsx(he,{children:i.jsxs("p",{className:"text-sm text-muted-foreground",children:[H.totalFactions," active factions"]})})]})]})}),ee&&i.jsx($e,{value:"resources",className:"space-y-4",children:i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[i.jsxs(oe,{children:[i.jsx(ke,{children:i.jsx(Ne,{children:"NPCs"})}),i.jsxs(he,{children:[i.jsx("p",{className:"text-2xl font-bold",children:ae.length}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Non-player characters"})]})]}),i.jsxs(oe,{children:[i.jsx(ke,{children:i.jsx(Ne,{children:"Monsters"})}),i.jsxs(he,{children:[i.jsx("p",{className:"text-2xl font-bold",children:H.totalCharacters}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Bestiary entries"})]})]}),i.jsxs(oe,{children:[i.jsx(ke,{children:i.jsx(Ne,{children:"Interactions"})}),i.jsxs(he,{children:[i.jsx("p",{className:"text-2xl font-bold",children:H.totalInteractions}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Combat encounters"})]})]})]})}),ee&&i.jsx($e,{value:"settings",className:"space-y-4",children:i.jsxs(oe,{children:[i.jsxs(ke,{children:[i.jsx(Ne,{children:"Campaign Settings"}),i.jsx(At,{children:"Configure campaign permissions and advanced options"})]}),i.jsx(he,{className:"space-y-4",children:i.jsx(pe,{control:z.control,name:"isPublic",render:({field:ce})=>i.jsxs(fe,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[i.jsxs("div",{className:"space-y-0.5",children:[i.jsx(me,{className:"text-base",children:"Public Campaign"}),i.jsx(nt,{children:"Allow other users to discover and request to join this campaign"})]}),i.jsx(ge,{children:i.jsx(lT,{checked:ce.value,onCheckedChange:ce.onChange,disabled:W})})]})})})]})})]})]})})}),i.jsxs(Xn,{children:[t==="read"&&i.jsx(q,{variant:"outline",onClick:()=>e(!1),children:"Close"}),(t==="create"||t==="edit")&&i.jsxs(i.Fragment,{children:[i.jsx(q,{variant:"outline",onClick:()=>e(!1),children:"Cancel"}),i.jsxs(q,{type:"submit",disabled:y,onClick:z.handleSubmit(se),children:[y&&i.jsx(Ss,{className:"mr-2 h-4 w-4 animate-spin"}),t==="create"?"Create Campaign":"Save Changes"]})]})]})]}),i.jsx(HU,{open:S,onOpenChange:j,mode:"create",onSuccess:()=>j(!1)}),i.jsx(wce,{open:A,onOpenChange:k,mode:"create",onSuccess:()=>k(!1)}),i.jsx(Hce,{open:_,onOpenChange:L,mode:"create",onSuccess:()=>L(!1)}),i.jsx(uz,{open:D,onOpenChange:P,mode:"create",onSuccess:()=>P(!1)})]})}const Yce=nk("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),ur=C.forwardRef(({className:s,variant:e,...t},n)=>i.jsx("div",{ref:n,role:"alert",className:Ee(Yce({variant:e}),s),...t}));ur.displayName="Alert";const Kce=C.forwardRef(({className:s,...e},t)=>i.jsx("h5",{ref:t,className:Ee("mb-1 font-medium leading-none tracking-tight",s),...e}));Kce.displayName="AlertTitle";const hr=C.forwardRef(({className:s,...e},t)=>i.jsx("div",{ref:t,className:Ee("text-sm [&_p]:leading-relaxed",s),...e}));hr.displayName="AlertDescription";const Xce="1.0.0",Qce="Sample D&D campaigns for testing and demonstration",Zce=[{name:"The Lost Mines of Phandelver",description:"A classic adventure for new players and DMs. Set in the Sword Coast region of the Forgotten Realms, this adventure takes characters from level 1 to 5 as they investigate the disappearance of a dwarf named Gundren Rockseeker.",worldSetting:"Forgotten Realms",isPublic:!0},{name:"Curse of Strahd",description:"A gothic horror adventure in the land of Barovia. The characters are trapped in a realm ruled by the vampire lord Strahd von Zarovich, and must find a way to escape while confronting the darkness within.",worldSetting:"Ravenloft",isPublic:!0},{name:"Tomb of Annihilation",description:"Adventure in the steaming jungles of Chult to find the cause of a death curse that is affecting the entire world. Explore ancient ruins and face deadly traps in this challenging adventure.",worldSetting:"Forgotten Realms",isPublic:!0},{name:"Waterdeep: Dragon Heist",description:"A caper adventure set in the city of Waterdeep. The characters become embroiled in a conspiracy involving missing gold and must navigate the politics and dangers of the City of Splendors.",worldSetting:"Forgotten Realms",isPublic:!0},{name:"Custom Homebrew Campaign",description:"A completely custom campaign set in a homebrew world where magic has recently returned after being absent for centuries.",worldSetting:"Aethermoor",isPublic:!1}],Cy={version:Xce,description:Qce,campaigns:Zce},Jce="1.0.0",ede="Sample player characters and NPCs",tde=[{name:"Thorin Ironfist",race:"Dwarf",class:"Fighter",level:5,hitPoints:45,armorClass:18,characterType:"PlayerCharacter",abilityScores:{strength:16,dexterity:12,constitution:14,intelligence:10,wisdom:12,charisma:8},abilityModifiers:{strength:3,dexterity:1,constitution:2,intelligence:0,wisdom:1,charisma:-1},classes:[{name:"Fighter",level:5,hitDie:"d10",subclass:"Champion",features:["Fighting Style","Second Wind","Action Surge","Extra Attack","Improved Critical"]}],feats:[],features:[{name:"Fighting Style",description:"You adopt a particular style of fighting as your specialty.",source:"class"},{name:"Second Wind",description:"You have a limited well of stamina that you can draw on to protect yourself from harm.",source:"class"},{name:"Action Surge",description:"You can push yourself beyond your normal limits for a moment.",source:"class"}],experiencePoints:6500,proficiencyBonus:3},{name:"Elara Moonwhisper",race:"Elf",class:"Wizard",level:4,hitPoints:24,armorClass:12,characterType:"PlayerCharacter",abilityScores:{strength:8,dexterity:14,constitution:12,intelligence:18,wisdom:14,charisma:10},abilityModifiers:{strength:-1,dexterity:2,constitution:1,intelligence:4,wisdom:2,charisma:0},classes:[{name:"Wizard",level:4,hitDie:"d6",subclass:"Evocation",features:["Spellcasting","Arcane Recovery","Sculpt Spells"]}],feats:[{name:"Alert",description:"You gain a +5 bonus to initiative. You can't be surprised while you are conscious. Other creatures don't gain advantage on attack rolls against you as a result of being hidden from you."}],features:[{name:"Spellcasting",description:"You are a student of arcane magic.",source:"class"},{name:"Arcane Recovery",description:"You have learned to regain some of your magical energy by studying your spellbook.",source:"class"}],experiencePoints:2700,proficiencyBonus:2},{name:"Brother Marcus",race:"Human",class:"Cleric",level:3,hitPoints:30,armorClass:16,characterType:"PlayerCharacter",abilityScores:{strength:12,dexterity:10,constitution:14,intelligence:12,wisdom:16,charisma:14},abilityModifiers:{strength:1,dexterity:0,constitution:2,intelligence:1,wisdom:3,charisma:2},classes:[{name:"Cleric",level:3,hitDie:"d8",subclass:"Life Domain",features:["Spellcasting","Divine Domain","Channel Divinity","Disciple of Life"]}],feats:[],features:[{name:"Spellcasting",description:"As a conduit for divine power, you can cast cleric spells.",source:"class"},{name:"Divine Domain",description:"Choose one domain related to your deity.",source:"class"}],experiencePoints:900,proficiencyBonus:2},{name:"Whisper",race:"Halfling",class:"Rogue",level:6,hitPoints:38,armorClass:15,characterType:"PlayerCharacter",abilityScores:{strength:10,dexterity:18,constitution:12,intelligence:14,wisdom:12,charisma:16},abilityModifiers:{strength:0,dexterity:4,constitution:1,intelligence:2,wisdom:1,charisma:3},classes:[{name:"Rogue",level:6,hitDie:"d8",subclass:"Swashbuckler",features:["Expertise","Sneak Attack","Thieves' Cant","Cunning Action","Fancy Footwork","Rakish Audacity","Uncanny Dodge"]}],feats:[],features:[{name:"Expertise",description:"At 1st level, choose two of your skill proficiencies.",source:"class"},{name:"Sneak Attack",description:"Beginning at 1st level, you know how to strike subtly and exploit a foe's distraction.",source:"class"},{name:"Rakish Audacity",description:"Starting at 3rd level, your confidence propels you into battle. You can give yourself a bonus to your initiative rolls equal to your Charisma modifier. You also gain an additional way to use your Sneak Attack.",source:"class"}],experiencePoints:14e3,proficiencyBonus:3}],sde=[{name:"Gundren Rockseeker",race:"Dwarf",class:"Fighter",level:3,hitPoints:30,armorClass:16,characterType:"NonPlayerCharacter",abilityScores:{strength:14,dexterity:10,constitution:14,intelligence:12,wisdom:10,charisma:12},abilityModifiers:{strength:2,dexterity:0,constitution:2,intelligence:1,wisdom:0,charisma:1},classes:[{name:"Fighter",level:3,hitDie:"d10",subclass:"Battle Master",features:["Fighting Style","Second Wind","Action Surge","Combat Superiority"]}],feats:[],features:[]},{name:"Sister Garaele",race:"Half-Elf",class:"Cleric",level:4,hitPoints:32,armorClass:15,characterType:"NonPlayerCharacter",abilityScores:{strength:10,dexterity:12,constitution:12,intelligence:14,wisdom:16,charisma:14},abilityModifiers:{strength:0,dexterity:1,constitution:1,intelligence:2,wisdom:3,charisma:2},classes:[{name:"Cleric",level:4,hitDie:"d8",subclass:"Knowledge Domain",features:["Spellcasting","Divine Domain","Channel Divinity","Blessings of Knowledge"]}],feats:[],features:[]},{name:"Toblen Stonehill",race:"Human",class:"Commoner",level:1,hitPoints:8,armorClass:10,characterType:"NonPlayerCharacter",abilityScores:{strength:10,dexterity:10,constitution:10,intelligence:10,wisdom:10,charisma:12},abilityModifiers:{strength:0,dexterity:0,constitution:0,intelligence:0,wisdom:0,charisma:1},classes:[{name:"Commoner",level:1,hitDie:"d4",subclass:null,features:[]}],feats:[],features:[]},{name:"Sildar Hallwinter",race:"Human",class:"Fighter",level:5,hitPoints:45,armorClass:17,characterType:"NonPlayerCharacter",abilityScores:{strength:14,dexterity:12,constitution:14,intelligence:12,wisdom:14,charisma:12},abilityModifiers:{strength:2,dexterity:1,constitution:2,intelligence:1,wisdom:2,charisma:1},classes:[{name:"Fighter",level:5,hitDie:"d10",subclass:"Champion",features:["Fighting Style","Second Wind","Action Surge","Extra Attack","Improved Critical"]}],feats:[{name:"Alert",description:"You gain a +5 bonus to initiative. You can't be surprised while you are conscious. Other creatures don't gain advantage on attack rolls against you as a result of being hidden from you."}],features:[]}],oh={version:Jce,description:ede,playerCharacters:tde,npcs:sde},nde="1.0.0",rde="Sample monsters from D&D Monster Manual",ide=[{name:"Goblin",size:"Small",type:"humanoid",challengeRating:"1/4",hitPoints:7,armorClass:15,speed:{walk:"30 ft."},abilityScores:{strength:8,dexterity:14,constitution:10,intelligence:10,wisdom:8,charisma:8},abilityModifiers:{strength:-1,dexterity:2,constitution:0,intelligence:0,wisdom:0,charisma:-1},traits:[{name:"Nimble Escape",description:"The goblin can take the Disengage or Hide action as a bonus action on each of its turns."},{name:"Pack Tactics",description:"The goblin has advantage on attack rolls against a creature if at least one of the goblin's allies is within 5 feet of the creature and the ally isn't incapacitated."}],actions:[{name:"Scimitar",description:"Melee Weapon Attack: +4 to hit, reach 5 ft., one target. Hit: 5 (1d6 + 2) slashing damage."},{name:"Shortbow",description:"Ranged Weapon Attack: +4 to hit, range 80/320 ft., one target. Hit: 5 (1d6 + 2) piercing damage."}],reactions:[{name:"Opportunistic Strike",description:"When an ally within 5 feet hits a creature with a melee attack, the goblin can make a scimitar attack against the same creature as a reaction."}]},{name:"Orc",size:"Medium",type:"humanoid",challengeRating:"1/2",hitPoints:15,armorClass:13,speed:{walk:"30 ft."},abilityScores:{strength:16,dexterity:12,constitution:16,intelligence:7,wisdom:11,charisma:10},abilityModifiers:{strength:3,dexterity:1,constitution:3,intelligence:-2,wisdom:1,charisma:0},traits:[{name:"Aggressive",description:"As a bonus action, the orc can move up to its speed toward a hostile creature that it can see."},{name:"Relentless Endurance",description:"When the orc is reduced to 0 hit points but not killed outright, it can drop to 1 hit point instead. Once this trait is used, it can't be used again until the orc finishes a long rest."}],actions:[{name:"Greataxe",description:"Melee Weapon Attack: +5 to hit, reach 5 ft., one target. Hit: 9 (1d12 + 3) slashing damage."},{name:"Javelin",description:"Melee or Ranged Weapon Attack: +5 to hit, reach 5 ft. or range 30/120 ft., one target. Hit: 6 (1d6 + 3) piercing damage."}],reactions:[{name:"Battle Fury",description:"When the orc takes damage, it can make a greataxe attack against the source of the damage as a reaction."}]},{name:"Owlbear",size:"Large",type:"monstrosity",challengeRating:"3",hitPoints:59,armorClass:13,speed:{walk:"40 ft."},abilityScores:{strength:19,dexterity:12,constitution:17,intelligence:3,wisdom:12,charisma:7},abilityModifiers:{strength:4,dexterity:1,constitution:3,intelligence:-4,wisdom:1,charisma:-2},traits:[{name:"Keen Sight and Smell",description:"The owlbear has advantage on Wisdom (Perception) checks that rely on sight or smell."},{name:"Pack Tactics",description:"The owlbear has advantage on attack rolls against a creature if at least one of the owlbear's allies is within 5 feet of the creature and the ally isn't incapacitated."}],actions:[{name:"Multiattack",description:"The owlbear makes two attacks: one with its beak and one with its claws."},{name:"Beak",description:"Melee Weapon Attack: +7 to hit, reach 5 ft., one target. Hit: 10 (1d10 + 5) piercing damage."},{name:"Claws",description:"Melee Weapon Attack: +7 to hit, reach 5 ft., one target. Hit: 14 (2d8 + 5) slashing damage."}],reactions:[{name:"Frenzied Retaliation",description:"When the owlbear takes damage from a melee attack, it can immediately make a beak attack against the attacker as a reaction."}]},{name:"Troll",size:"Large",type:"giant",challengeRating:"5",hitPoints:84,armorClass:15,speed:{walk:"30 ft."},abilityScores:{strength:19,dexterity:12,constitution:19,intelligence:7,wisdom:10,charisma:7},abilityModifiers:{strength:4,dexterity:1,constitution:4,intelligence:-2,wisdom:0,charisma:-2},traits:[{name:"Keen Smell",description:"The troll has advantage on Wisdom (Perception) checks that rely on smell."},{name:"Regeneration",description:"The troll regains 10 hit points at the start of its turn. If the troll takes acid or fire damage, this trait doesn't function at the start of the troll's next turn. The troll dies only if it starts its turn with 0 hit points and doesn't regenerate."}],actions:[{name:"Multiattack",description:"The troll makes three attacks: one with its bite and two with its claws."},{name:"Bite",description:"Melee Weapon Attack: +7 to hit, reach 5 ft., one target. Hit: 7 (1d6 + 4) piercing damage."},{name:"Claw",description:"Melee Weapon Attack: +7 to hit, reach 5 ft., one target. Hit: 11 (2d6 + 4) slashing damage."}],reactions:[{name:"Regenerative Surge",description:"When the troll takes damage that would reduce it to 0 hit points, it can choose to regenerate 20 hit points instead. This trait can only be used once per long rest."}],legendaryActions:[{name:"Regeneration",description:"The troll regains 10 hit points at the start of its turn."}]},{name:"Young Red Dragon",size:"Large",type:"dragon",challengeRating:"10",hitPoints:178,armorClass:18,speed:{walk:"40 ft.",fly:"80 ft."},abilityScores:{strength:21,dexterity:10,constitution:19,intelligence:12,wisdom:13,charisma:17},abilityModifiers:{strength:5,dexterity:0,constitution:4,intelligence:1,wisdom:1,charisma:3},traits:[{name:"Damage Immunities",description:"Fire"},{name:"Senses",description:"Blindsight 30 ft., Darkvision 120 ft., Passive Perception 13"},{name:"Languages",description:"Common, Draconic"}],actions:[{name:"Multiattack",description:"The dragon makes three attacks: one with its bite and two with its claws."},{name:"Bite",description:"Melee Weapon Attack: +10 to hit, reach 10 ft., one target. Hit: 17 (2d10 + 6) piercing damage plus 3 (1d6) fire damage."},{name:"Claw",description:"Melee Weapon Attack: +10 to hit, reach 5 ft., one target. Hit: 13 (2d6 + 6) slashing damage."},{name:"Fire Breath",description:"The dragon exhales fire in a 30-foot cone. Each creature in that area must make a DC 17 Dexterity saving throw, taking 56 (16d6) fire damage on a failed save, or half as much damage on a successful one."}],reactions:[{name:"Tail Swipe",description:"When a creature moves into a space within 10 feet of the dragon, the dragon can make a tail attack against that creature as a reaction."}],legendaryActions:[{name:"Detect",description:"The dragon makes a Wisdom (Perception) check."},{name:"Tail Attack",description:"The dragon makes a tail attack."},{name:"Wing Attack",description:"The dragon beats its wings. Each creature within 10 feet of the dragon must succeed on a DC 18 Dexterity saving throw or take 11 (2d6 + 4) bludgeoning damage and be knocked prone."}]},{name:"Ancient Red Dragon",size:"Gargantuan",type:"dragon",challengeRating:"24",hitPoints:546,armorClass:22,speed:{walk:"40 ft.",fly:"80 ft."},abilityScores:{strength:30,dexterity:10,constitution:29,intelligence:18,wisdom:15,charisma:23},abilityModifiers:{strength:10,dexterity:0,constitution:9,intelligence:4,wisdom:2,charisma:6},traits:[{name:"Damage Immunities",description:"Fire"},{name:"Senses",description:"Blindsight 60 ft., Darkvision 120 ft., Passive Perception 21"},{name:"Languages",description:"Common, Draconic"},{name:"Legendary Resistance",description:"If the dragon fails a saving throw, it can choose to succeed instead."}],actions:[{name:"Multiattack",description:"The dragon can use its Frightful Presence. It then makes three attacks: one with its bite and two with its claws."},{name:"Bite",description:"Melee Weapon Attack: +17 to hit, reach 15 ft., one target. Hit: 21 (2d10 + 10) piercing damage plus 14 (4d6) fire damage."},{name:"Claw",description:"Melee Weapon Attack: +17 to hit, reach 10 ft., one target. Hit: 17 (2d6 + 10) slashing damage."},{name:"Tail",description:"Melee Weapon Attack: +17 to hit, reach 20 ft., one target. Hit: 19 (2d8 + 10) bludgeoning damage."},{name:"Frightful Presence",description:"Each creature of the dragon's choice that is within 120 feet of the dragon and aware of it must succeed on a DC 21 Wisdom saving throw or become frightened for 1 minute."},{name:"Fire Breath",description:"The dragon exhales fire in a 90-foot cone. Each creature in that area must make a DC 24 Dexterity saving throw, taking 91 (26d6) fire damage on a failed save, or half as much damage on a successful one."}],reactions:[{name:"Tail Swipe",description:"When a creature moves into a space within 20 feet of the dragon, the dragon can make a tail attack against that creature as a reaction."}],legendaryActions:[{name:"Detect",description:"The dragon makes a Wisdom (Perception) check."},{name:"Tail Attack",description:"The dragon makes a tail attack."},{name:"Wing Attack",description:"The dragon beats its wings. Each creature within 15 feet of the dragon must succeed on a DC 25 Dexterity saving throw or take 17 (2d6 + 10) bludgeoning damage and be knocked prone."}],lairActions:[{name:"Magma Eruption",description:"Magma erupts from a point on the ground the dragon can see within 120 feet of it, creating a 20-foot-high, 10-foot-radius geyser. Each creature in the geyser's area must make a DC 15 Dexterity saving throw, taking 21 (6d6) fire damage on a failed save, or half as much damage on a successful one."},{name:"Volcanic Gases",description:"A cloud of hot, toxic gas fills a 20-foot-radius sphere centered on a point the dragon can see within 120 feet of it. The gas spreads around corners and remains until the initiative count 20 on the next round. Each creature that starts its turn in the gas must succeed on a DC 13 Constitution saving throw or be poisoned until the end of its turn."}]},{name:"Skeleton",size:"Medium",type:"undead",challengeRating:"1/4",hitPoints:13,armorClass:13,speed:{walk:"30 ft."},abilityScores:{strength:10,dexterity:14,constitution:15,intelligence:6,wisdom:8,charisma:5},abilityModifiers:{strength:0,dexterity:2,constitution:3,intelligence:-4,wisdom:0,charisma:-3},traits:[{name:"Damage Vulnerabilities",description:"Bludgeoning"},{name:"Damage Immunities",description:"Poison"},{name:"Condition Immunities",description:"Exhaustion, Poisoned"},{name:"Senses",description:"Darkvision 60 ft., Passive Perception 9"},{name:"Languages",description:"Understands all languages it knew in life but can't speak"}],actions:[{name:"Shortsword",description:"Melee Weapon Attack: +4 to hit, reach 5 ft., one target. Hit: 5 (1d6 + 2) piercing damage."},{name:"Shortbow",description:"Ranged Weapon Attack: +4 to hit, range 80/320 ft., one target. Hit: 5 (1d6 + 2) piercing damage."}],reactions:[{name:"Bone Rattle",description:"When the skeleton takes damage, it can make a shortsword attack against the nearest enemy as a reaction."}]},{name:"Beholder",size:"Large",type:"aberration",challengeRating:"13",hitPoints:180,armorClass:18,speed:{fly:"20 ft."},abilityScores:{strength:10,dexterity:14,constitution:18,intelligence:17,wisdom:15,charisma:17},abilityModifiers:{strength:0,dexterity:2,constitution:4,intelligence:3,wisdom:2,charisma:3},traits:[{name:"Senses",description:"Darkvision 120 ft., Passive Perception 12"},{name:"Languages",description:"Deep Speech, Undercommon"},{name:"Challenge Rating",description:"13 (10,000 XP)"}],actions:[{name:"Eye Rays",description:"The beholder shoots three of the following magical eye rays at random (reroll duplicates), choosing one to three targets it can see within 120 feet of it:"},{name:"1. Charm Ray",description:"The targeted creature must succeed on a DC 16 Wisdom saving throw or be charmed by the beholder for 1 hour, or until the beholder harms the creature."},{name:"2. Paralyzing Ray",description:"The targeted creature must succeed on a DC 16 Constitution saving throw or be paralyzed for 1 minute. The target can repeat the saving throw at the end of each of its turns, ending the effect on itself on a success."},{name:"3. Fear Ray",description:"The targeted creature must succeed on a DC 16 Wisdom saving throw or be frightened for 1 minute. The target can repeat the saving throw at the end of each of its turns, ending the effect on itself on a success."},{name:"4. Slowing Ray",description:"The targeted creature must succeed on a DC 16 Dexterity saving throw. On a failed save, the target's speed is halved for 1 minute. In addition, the creature can't take reactions, and it can take either an action or a bonus action on its turn, not both."},{name:"5. Enervation Ray",description:"The targeted creature must make a DC 16 Constitution saving throw, taking 36 (8d8) necrotic damage on a failed save, or half as much damage on a successful one."},{name:"6. Telekinetic Ray",description:"The targeted creature must succeed on a DC 16 Strength saving throw or be moved up to 30 feet in any direction. It is restrained by the ray's telekinetic grip until the end of the beholder's next turn or until the beholder is incapacitated."},{name:"7. Sleep Ray",description:"The targeted creature must succeed on a DC 16 Wisdom saving throw or fall asleep and remain unconscious for 1 minute. The target awakens if it takes damage or another creature takes an action to wake it. This ray has no effect on constructs and undead."},{name:"8. Petrification Ray",description:"The targeted creature must make a DC 16 Dexterity saving throw. On a failed save, the creature begins to turn to stone and is restrained. It must repeat the saving throw at the end of its next turn. On a success, the effect ends. On a failure, the creature is petrified until freed by the greater restoration spell or other magic."},{name:"9. Disintegration Ray",description:"If the target is a creature, it must succeed on a DC 16 Dexterity saving throw or take 45 (10d8) force damage. If this damage reduces the target to 0 hit points, its body becomes a pile of fine gray dust."},{name:"10. Death Ray",description:"The targeted creature must succeed on a DC 16 Dexterity saving throw or take 55 (10d10) necrotic damage. The target dies if the ray reduces it to 0 hit points."},{name:"Bite",description:"Melee Weapon Attack: +5 to hit, reach 5 ft., one target. Hit: 14 (4d6) piercing damage."}],reactions:[{name:"Eye Ray",description:"The beholder shoots one of its eye rays at a random target."}],legendaryActions:[{name:"Eye Ray",description:"The beholder shoots one of its eye rays at a random target."}]}],Sy={version:nde,description:rde,monsters:ide},ade="1.0.0",ode="Sample magical items and equipment",lde=[{name:"Longsword",type:"Weapon",rarity:"Common",description:"A standard longsword with a sharp steel blade and leather-wrapped hilt.",weight:3,cost:15,damageRolls:[{dice:{count:1,type:"D8"},modifier:0,damageType:"SLASHING"}]},{name:"Potion of Healing",type:"Potion",rarity:"Common",description:"A red magical potion that restores vitality when consumed.",weight:.5,cost:50,effects:"Restores 2d4+2 hit points when consumed"},{name:"Ring of Protection",type:"Ring",rarity:"Rare",description:"A finely crafted silver ring inscribed with protective runes.",weight:0,cost:3500,attunement:!0,abilityModifiers:{constitution:1}},{name:"+1 Shield",type:"Shield",rarity:"Uncommon",description:"A sturdy wooden shield reinforced with iron bands and enchanted for protection.",weight:6,cost:1500,attunement:!1},{name:"Bag of Holding",type:"Wondrous Item",rarity:"Uncommon",description:"This bag has an interior space considerably larger than its outside dimensions.",weight:15,cost:4e3,effects:"Can hold up to 500 pounds, not exceeding a volume of 64 cubic feet"},{name:"Flame Tongue",type:"Weapon",rarity:"Rare",description:"A magical sword that can ignite with flames at the wielder's command.",weight:3,cost:5e3,attunement:!0,damageRolls:[{dice:{count:1,type:"D8"},modifier:0,damageType:"SLASHING"},{dice:{count:2,type:"D6"},modifier:0,damageType:"FIRE"}]},{name:"Cloak of Elvenkind",type:"Wondrous Item",rarity:"Uncommon",description:"This cloak grants its wearer a +2 bonus to Dexterity (Stealth) checks.",weight:1,cost:5e3,attunement:!0,effects:"+2 bonus to Stealth checks"},{name:"Scroll of Fireball",type:"Scroll",rarity:"Uncommon",description:"A magical scroll containing the fireball spell.",weight:0,cost:400,effects:"Casts fireball (3rd level) when read"},{name:"Plate Armor",type:"Armor",rarity:"Common",description:"Full plate armor made of interlocking metal plates.",weight:65,cost:1500,armorClass:18},{name:"Staff of Power",type:"Staff",rarity:"Very Rare",description:"This staff can be wielded as a magic quarterstaff and contains multiple magical abilities.",weight:4,cost:95500,attunement:!0,damageRolls:[{dice:{count:1,type:"D6"},modifier:2,damageType:"BLUDGEONING"}],abilityModifiers:{strength:2,constitution:2}},{name:"Frost-Cleaver Battleaxe",type:"Weapon",rarity:"Rare",description:"A heavy battleaxe made of never-melting ice. It is cold to the touch and leaves a trail of frost in the air when swung.",scope:"global",weight:5,cost:3e3,attunement:!0,effects:"Grants resistance to fire damage while held.",damageRolls:[{dice:{count:1,type:"D8"},modifier:1,damageType:"SLASHING"},{dice:{count:1,type:"D6"},modifier:0,damageType:"COLD"}]},{name:"Mithral Half Plate",type:"Armor",rarity:"Uncommon",description:"Exquisitely crafted armor made of silvery mithral. It is lighter than standard steel and allows for greater stealth.",scope:"global",weight:20,cost:800,attunement:!1,typeOfArmor:"Medium",armorClass:15,effects:"Does not impose disadvantage on Dexterity (Stealth) checks."},{name:"Phial of Volatile Magma",type:"Potion",rarity:"Uncommon",description:"A glass vial containing swirling, bright orange liquid magma. It is hot to the touch.",scope:"global",weight:1,cost:250,effects:"Can be thrown up to 30ft. Explodes on impact dealing 4d6 fire damage in a 10ft radius."},{name:"Wand of Binding",type:"Wand",rarity:"Rare",description:"A twisted piece of driftwood wrapped in iron wire. It hums with abjuration magic.",scope:"global",weight:1,cost:4500,attunement:!0,durability:{current:7,max:7,baseDurability:7},effects:"Allows the user to cast Hold Monster (consumes charges). Regains 1d6+1 charges at dawn."},{name:"Seeker's Shortbow",type:"Weapon",rarity:"Uncommon",description:"A bow carved from yew wood with an eye symbol etched into the grip.",scope:"global",weight:2,cost:600,attunement:!0,damageRolls:[{dice:{count:1,type:"D6"},modifier:1,damageType:"PIERCING"}],effects:"The wielder ignores half cover and three-quarters cover when making ranged attacks with this weapon."},{name:"Helm of Telepathy",type:"Wondrous Item",rarity:"Uncommon",description:"A sleek metal helmet that covers the ears but leaves the face exposed, embedded with a small violet crystal.",scope:"global",weight:3,cost:3e3,attunement:!0,effects:"Allows the user to read thoughts and communicate telepathically."},{name:"Gauntlets of Ogre Power",type:"Wondrous Item",rarity:"Uncommon",description:"Thick iron gauntlets covered in rust-colored fur.",scope:"global",weight:4,cost:500,attunement:!0,abilityModifiers:{strength:19},effects:"Your Strength score is 19 while you wear these gauntlets."},{name:"Lightning Javelin",type:"Weapon",rarity:"Uncommon",description:"A javelin inscribed with zigzagging runes. When thrown, it transforms into a bolt of lightning.",scope:"global",weight:2,cost:1e3,attunement:!1,damageRolls:[{dice:{count:1,type:"D6"},modifier:0,damageType:"PIERCING"},{dice:{count:4,type:"D6"},modifier:0,damageType:"LIGHTNING"}]},{name:"Shield of the Sentinel",type:"Shield",rarity:"Rare",description:"A large tower shield emblazoned with a watching eye.",scope:"global",weight:8,cost:4e3,attunement:!0,typeOfArmor:"Shield",effects:"Advantage on Initiative rolls and Perception checks.",armorClass:2},{name:"Dust of Sneezing and Choking",type:"Adventuring Gear",rarity:"Uncommon",description:"A small pouch containing a fine, irritating powder.",scope:"global",weight:.5,cost:300,effects:"When cast into the air, creatures in a 10-foot radius must save or become incapacitated by fits of sneezing."},{name:"Screaming Bolts (x5)",type:"Ammunition",rarity:"Uncommon",description:"Crossbow bolts with holes drilled in the shaft to create a high-pitched shriek when fired.",scope:"global",weight:.5,cost:150,damageRolls:[{dice:{count:1,type:"D4"},modifier:0,damageType:"THUNDER"}],effects:"On a hit, the target must succeed on a Constitution save or be deafened."},{name:"Ring of Mind Shielding",type:"Ring",rarity:"Uncommon",description:"A ring of fine copper shaped like a snake biting its own tail.",scope:"global",weight:0,cost:1500,attunement:!0,effects:"You are immune to magic that allows other creatures to read your thoughts or determine if you are lying."},{name:"Rod of the Pact Keeper +1",type:"Rod",rarity:"Uncommon",description:"A smooth, black metal rod that feels warm to the touch.",scope:"global",weight:2,cost:2e3,attunement:!0,effects:"Grants +1 to spell attack rolls and saving throw DCs for Warlock spells. Can regain one spell slot per long rest."},{name:"Folding Boat",type:"Vehicle",rarity:"Rare",description:"A small wooden box that unfolds into a boat.",scope:"global",weight:4,cost:5e3,effects:"Can unfold into a 10-foot rowboat or a 24-foot ship upon speaking the command word."},{name:"Sun Blade",type:"Weapon",rarity:"Rare",description:"A sword hilt that projects a blade of pure radiance.",scope:"global",weight:2,cost:4500,attunement:!0,damageRolls:[{dice:{count:1,type:"D8"},modifier:2,damageType:"RADIANT"}],effects:"Deals extra damage to undead. Emits bright light in a 15-foot radius."},{name:"Greataxe of the Void",type:"Weapon",rarity:"Very Rare",description:"A massive axe forged from black iron that seems to absorb the surrounding light. When swinging this weapon, the user feels a hunger emanating from the blade. Requirement: User must have a Strength score of 17 or higher to attune.",weight:12,cost:12e3,attunement:!0,scope:"global",effects:"On a critical hit, the target is banished to a pocket dimension until the end of their next turn.",damageRolls:[{dice:{count:1,type:"D12"},modifier:2,damageType:"SLASHING"},{dice:{count:1,type:"D6"},modifier:0,damageType:"NECROTIC"}]},{name:"Whisperwind Longbow",type:"Weapon",rarity:"Rare",description:"Crafted from hollowed Ash wood, arrows fired from this bow make absolutely no sound. Requirement: Proficiency in Stealth required to utilize the silence feature.",weight:2,cost:4500,attunement:!0,scope:"global",effects:"Attacks made while hidden do not reveal the attacker's position unless the attack misses by 5 or more.",damageRolls:[{dice:{count:1,type:"D8"},modifier:1,damageType:"PIERCING"}]},{name:"Carapace of the Iron Beetle",type:"Armor",typeOfArmor:"Heavy",rarity:"Legendary",description:"Plate armor crafted from the chitins of a subterranean behemoth. It is incredibly heavy and dense. Requirement: Wearer must have Heavy Armor proficiency. Movement speed is reduced by 5ft while worn.",weight:85,cost:75e3,attunement:!0,armorClass:21,scope:"global",effects:"Grant resistance to non-magical Bludgeoning, Piercing, and Slashing damage. The wearer cannot be knocked prone.",abilityModifiers:{dexterity:-2}},{name:"Shadowstep Leather",type:"Armor",typeOfArmor:"Light",rarity:"Very Rare",description:"Dark leather armor that seems to blur at the edges. Requirement: Must be worn by a rogue, ranger, or bard.",weight:8,cost:18e3,attunement:!0,armorClass:13,scope:"global",effects:"As a bonus action, the wearer can teleport up to 30 feet to an unoccupied space they can see that is in dim light or darkness (3 charges/day).",abilityModifiers:{dexterity:2}},{name:"Aegis of the Sun",type:"Armor",typeOfArmor:"Shield",rarity:"Rare",description:"A golden circular shield that is warm to the touch. Requirement: Must be a follower of a deity of light or life.",weight:6,cost:6e3,attunement:!0,armorClass:4,scope:"global",effects:"Sheds bright light in a 20-foot radius. Once per day, use a reaction to blind an attacker who hits you with a melee attack."},{name:"Draught of the Phoenix",type:"Potion",rarity:"Very Rare",description:"A swirling orange liquid that glows with intense heat. The bottle feels like it might melt.",weight:1,cost:2500,attunement:!1,scope:"global",effects:"Upon consumption, the user gains resistance to Fire damage for 1 hour. If the user drops to 0 HP within that hour, they immediately explode in fire (3d6 damage to adjacent enemies) and regain 20 HP."},{name:"Fulminating Pike",type:"Weapon",rarity:"Rare",description:"A long spear tipped with electrum. Static electricity crackles when it strikes metal.",weight:10,cost:5500,attunement:!0,scope:"global",effects:"This weapon has the Thrown property (range 20/60). It immediately returns to the wielder's hand after being thrown.",damageRolls:[{dice:{count:1,type:"D10"},modifier:1,damageType:"PIERCING"},{dice:{count:1,type:"D6"},modifier:0,damageType:"LIGHTNING"}]},{name:"Ring of Temporal Flux",type:"Ring",rarity:"Very Rare",description:"A band of shifting quicksilver that never sits comfortably on the finger.",weight:0,cost:28e3,attunement:!0,scope:"global",effects:"Once per long rest, the wearer can reroll a failed saving throw. Additionally, they are immune to the Slow spell.",abilityModifiers:{initiative:2}},{name:"Staff of Withered Roots",type:"Staff",rarity:"Rare",description:"A gnarled staff made of petrified wood, smelling faintly of grave dirt. Requirement: Spellcaster class.",weight:5,cost:8e3,attunement:!0,scope:"global",effects:"Allows the caster to cast Blight or Speak with Dead once per day without expending a spell slot.",damageRolls:[{dice:{count:1,type:"D6"},modifier:1,damageType:"BLUDGEONING"},{dice:{count:1,type:"D4"},modifier:0,damageType:"NECROTIC"}]},{name:"Scepter of the Tides",type:"Rod",rarity:"Legendary",description:"A rod made of blue coral. You can hear the ocean if you hold it to your ear. Requirement: Must speak Aquan.",weight:3,cost:55e3,attunement:!0,scope:"global",effects:"The wielder can breathe underwater and has a swimming speed of 60ft. Can cast Control Water at will.",abilityModifiers:{charisma:2}},{name:"Cube of Force Containment",type:"Wondrous Item",rarity:"Rare",description:"A small metallic cube with complex gears. When thrown, it expands into a cage of pure force.",weight:1,cost:7e3,attunement:!1,scope:"global",effects:"As an action, throw at a Large or smaller creature. Target must succeed on DC 15 DEX save or be restrained in a force cage for 1 minute.",durability:{current:3,max:3,baseDurability:3}},{name:"Phase-Shift Bolts (x5)",type:"Ammunition",rarity:"Rare",description:"Crossbow bolts etched with runes of transmutation. They shimmer and disappear periodically.",weight:.5,cost:600,attunement:!1,scope:"global",effects:"These bolts ignore half and three-quarters cover. They ignore the AC bonus from shields.",damageRolls:[{dice:{count:1,type:"D6"},modifier:0,damageType:"FORCE"}]},{name:"Clockwork Steed",type:"Mount",rarity:"Very Rare",description:"A mechanical horse constructed of brass and iron. It requires no food, but needs oiling. Requirement: Proficiency in Tinker's Tools to repair.",weight:600,cost:3e4,attunement:!1,scope:"global",effects:"Movement speed 60ft. Immune to exhaustion and poison. Can carry up to 1000 lbs.",durability:{current:100,max:100,baseDurability:100}},{name:"Master Thief's Skeleton Key",type:"Tool",rarity:"Very Rare",description:"A bone-white key that morphs its shape to fit any keyhole. Requirement: Proficiency in Thieves' Tools.",weight:.1,cost:15e3,attunement:!0,scope:"global",effects:"Grants advantage on all checks to pick locks. Can open a magical lock (like Arcane Lock) with a DC 25 check.",abilityModifiers:{dexterity:1}},{name:"Scroll of Mass Teleport",type:"Scroll",rarity:"Legendary",description:"A shimmering parchment that feels as if it is vibrating. The words hurt to look at directly.",weight:0,cost:25e3,attunement:!1,scope:"global",effects:"Teleports up to 10 willing creatures to a known teleportation circle on the same plane of existence. The scroll is consumed on use."}],lh={version:ade,description:ode,items:lde},cde="1.0.0",dde="Sample quests and adventures",ude=[{name:"Rescue the Blacksmith",description:"The local blacksmith, Gronn Ironforge, has been kidnapped by goblins from the nearby caves. The town needs his skills to repair weapons and armor.",status:"idle",completionXP:300,rewards:{xp:300,gold:50,itemIds:[]}},{name:"Clear the Goblin Caves",description:"A group of goblins has taken up residence in the caves north of town. They've been raiding merchant caravans and terrorizing travelers.",status:"idle",completionXP:500,rewards:{xp:500,gold:100,itemIds:[]}},{name:"The Missing Merchant",description:"Trader Bendek Stonehill left town three days ago bound for Neverwinter and hasn't been seen since. His wife fears the worst.",status:"idle",completionXP:400,rewards:{xp:400,gold:75,itemIds:[]}},{name:"Investigate the Haunted Manor",description:"Strange lights and eerie sounds have been reported from the old Blackwood Manor. Locals believe it's haunted and want someone to investigate.",status:"idle",completionXP:750,rewards:{xp:750,gold:200,itemIds:[]}},{name:"Escort the Scholars",description:"A group of scholars from Candlekeep needs safe passage to the ancient ruins east of town. The road is dangerous and they require protection.",status:"idle",completionXP:350,rewards:{xp:350,gold:80,itemIds:[]}},{name:"The Dragon's Hoard",description:"Ancient legends speak of a dragon's treasure hidden deep within Mount Grimfang. Only the bravest adventurers would dare seek such a prize.",status:"idle",completionXP:2e3,rewards:{xp:2e3,gold:1e3,itemIds:[]}},{name:"Bandit Leader Bounty",description:"The notorious bandit leader 'Red Jack' has a 500 gold bounty on his head. He's been spotted near the crossroads south of town.",status:"idle",completionXP:600,rewards:{xp:600,gold:500,itemIds:[]}},{name:"The Corrupted Grove",description:"The sacred grove of the local druids has been corrupted by dark magic. The trees are withering and animals are fleeing the area.",status:"idle",completionXP:800,rewards:{xp:800,gold:150,itemIds:[]}}],jy={version:cde,description:dde,quests:ude},hde="1.0.0",fde="Sample actions for characters and monsters",mde=[{name:"Attack",description:"Make a melee or ranged weapon attack",actionCost:"Action",type:"MELEE_ATTACK",requiresConcentration:!1,sourceBook:"Player's Handbook",attackBonusAbilityScore:"strength",isProficient:!0,damageRolls:[{dice:{count:1,type:"D8"},modifier:0,damageType:"SLASHING"}]},{name:"Dash",description:"Gain extra movement for the current turn",actionCost:"Action",type:"COMMONLY_AVAILABLE_UTILITY",requiresConcentration:!1,sourceBook:"Player's Handbook"},{name:"Disengage",description:"Your movement doesn't provoke opportunity attacks for the rest of the turn",actionCost:"Action",type:"COMMONLY_AVAILABLE_UTILITY",requiresConcentration:!1,sourceBook:"Player's Handbook"},{name:"Dodge",description:"Until the start of your next turn, any attack roll made against you has disadvantage",actionCost:"Action",type:"COMMONLY_AVAILABLE_UTILITY",requiresConcentration:!1,sourceBook:"Player's Handbook"},{name:"Help",description:"You can lend your aid to another creature in the completion of a task",actionCost:"Action",type:"COMMONLY_AVAILABLE_UTILITY",requiresConcentration:!1,sourceBook:"Player's Handbook"},{name:"Hide",description:"Make a Dexterity (Stealth) check in an attempt to hide",actionCost:"Action",type:"COMMONLY_AVAILABLE_UTILITY",requiresConcentration:!1,sourceBook:"Player's Handbook"},{name:"Ready",description:"Choose an action and a trigger condition",actionCost:"Action",type:"COMMONLY_AVAILABLE_UTILITY",requiresConcentration:!0,sourceBook:"Player's Handbook"},{name:"Search",description:"Devote your attention to finding something",actionCost:"Action",type:"COMMONLY_AVAILABLE_UTILITY",requiresConcentration:!1,sourceBook:"Player's Handbook"},{name:"Use an Object",description:"You normally interact with an object while doing something else",actionCost:"Action",type:"COMMONLY_AVAILABLE_UTILITY",requiresConcentration:!1,sourceBook:"Player's Handbook"}],pde={Fighter:[{name:"Second Wind",description:"You have a limited well of stamina that you can draw on to protect yourself from harm",actionCost:"Bonus Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",className:"Fighter",usesPer:"Short Rest",maxUses:1},{name:"Action Surge",description:"You can push yourself beyond your normal limits for a moment",actionCost:"No Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",className:"Fighter",usesPer:"Short Rest",maxUses:1}],Wizard:[{name:"Arcane Recovery",description:"You have learned to regain some of your magical energy by studying your spellbook",actionCost:"No Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",className:"Wizard",usesPer:"Long Rest",maxUses:1},{name:"Ritual Casting",description:"You can cast a wizard spell as a ritual if that spell has the ritual tag",actionCost:"Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",className:"Wizard"}],Cleric:[{name:"Divine Domain",description:"Choose one domain related to your deity",actionCost:"No Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",className:"Cleric"},{name:"Channel Divinity",description:"You gain the ability to channel divine energy directly from your deity",actionCost:"Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",className:"Cleric",usesPer:"Short Rest",maxUses:1}],Rogue:[{name:"Sneak Attack",description:"You know how to strike subtly and exploit a foe's distraction",actionCost:"No Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",className:"Rogue"},{name:"Cunning Action",description:"Your quick thinking and agility allow you to move and act quickly",actionCost:"Bonus Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",className:"Rogue"}],Ranger:[{name:"Favored Enemy",description:"You have significant experience studying, tracking, hunting, and even talking to a certain type of enemy",actionCost:"No Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",className:"Ranger"},{name:"Natural Explorer",description:"You are particularly familiar with one type of natural environment",actionCost:"No Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",className:"Ranger"}],Paladin:[{name:"Divine Sense",description:"The presence of strong evil registers on your senses like a noxious odor",actionCost:"Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",className:"Paladin",usesPer:"Long Rest",maxUses:4},{name:"Lay on Hands",description:"Your blessed touch can heal wounds",actionCost:"Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",className:"Paladin"}],Barbarian:[{name:"Rage",description:"In battle, you fight with primal ferocity",actionCost:"Bonus Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",className:"Barbarian",usesPer:"Long Rest",maxUses:2},{name:"Reckless Attack",description:"You can throw aside all concern for defense to attack with fierce desperation",actionCost:"No Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",className:"Barbarian"}],Bard:[{name:"Bardic Inspiration",description:"You can inspire others through stirring words or music",actionCost:"Bonus Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",className:"Bard",usesPer:"Long Rest",maxUses:3},{name:"Song of Rest",description:"You can use soothing music or oration to help revitalize your wounded allies",actionCost:"No Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",className:"Bard"}],Druid:[{name:"Wild Shape",description:"You can use your action to magically assume the shape of a beast",actionCost:"Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",className:"Druid",usesPer:"Short Rest",maxUses:2},{name:"Druidic",description:"You know Druidic, the secret language of druids",actionCost:"No Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",className:"Druid"}],Monk:[{name:"Unarmored Defense",description:"While you are not wearing any armor, your Armor Class equals 10 + your Dexterity modifier + your Wisdom modifier",actionCost:"No Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",className:"Monk"},{name:"Martial Arts",description:"Your practice of martial arts gives you mastery of combat styles that use unarmed strikes and monk weapons",actionCost:"Bonus Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",className:"Monk"}],Sorcerer:[{name:"Sorcery Points",description:"You have 2 sorcery points, and you gain more as you reach higher levels",actionCost:"No Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",className:"Sorcerer"},{name:"Flexible Casting",description:"You can use your sorcery points to gain additional spell slots",actionCost:"Bonus Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",className:"Sorcerer"}],Warlock:[{name:"Pact Magic",description:"Your arcane research and the magic bestowed on you by your patron have given you facility with spells",actionCost:"No Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",className:"Warlock"},{name:"Eldritch Invocations",description:"In your study of occult lore, you have unearthed eldritch invocations",actionCost:"No Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",className:"Warlock"}]},gde=[{name:"Multiattack",description:"The monster makes two melee attacks",actionCost:"Action",type:"OTHER",requiresConcentration:!1,sourceBook:"Monster Manual"},{name:"Bite",description:"Melee Weapon Attack",actionCost:"Action",type:"MELEE_ATTACK",requiresConcentration:!1,sourceBook:"Monster Manual",attackBonusAbilityScore:"strength",isProficient:!0,damageRolls:[{dice:{count:1,type:"D6"},modifier:2,damageType:"PIERCING"}]},{name:"Claw",description:"Melee Weapon Attack",actionCost:"Action",type:"MELEE_ATTACK",requiresConcentration:!1,sourceBook:"Monster Manual",attackBonusAbilityScore:"strength",isProficient:!0,damageRolls:[{dice:{count:1,type:"D4"},modifier:1,damageType:"SLASHING"}]}],ed={version:hde,description:fde,generalActions:mde,classActions:pde,monsterActions:gde},xde="1.0.0",yde="Sample tactical maps for D&D 5e combat with battle scenarios",vde=[{name:"Goblin Ambush - Forest Road",width:20,height:15,cellSize:40,description:"A narrow road winding through a dense forest. Perfect spot for goblin raiders to ambush unwary travelers. Rocky outcrops and dense undergrowth provide cover.",scenario:"Goblin Ambush",difficulty:"Easy",encounterLevel:1,terrain:{road:[[5,0],[6,0],[5,1],[6,1],[7,1],[5,2],[6,2],[7,2],[8,2],[6,3],[7,3],[8,3],[9,3],[7,4],[8,4],[9,4],[8,5],[9,5]],rockyOutcrops:[[2,3],[3,3],[2,4],[3,4],[17,10],[18,10],[17,11],[18,11]],difficultTerrain:[[1,1],[2,1],[1,2],[2,2],[18,8],[19,8],[18,9],[19,9]]},enemies:[{monsterName:"Goblin",count:4,defaultPosition:[[3,10],[16,4],[10,2],[12,8]]}],allies:[{characterName:"Thorin Ironfist",defaultPosition:[10,12]},{characterName:"Elara Moonwhisper",defaultPosition:[8,13]},{characterName:"Brother Marcus",defaultPosition:[9,12]},{characterName:"Whisper",defaultPosition:[11,13]}]},{name:"Orc War Party - Mountain Pass",width:25,height:18,cellSize:40,description:"A treacherous mountain pass with narrow paths and cliff edges. Orc raiders have set up a temporary camp, blocking the only safe route through.",scenario:"Orc Blockade",difficulty:"Medium",encounterLevel:3,terrain:{narrowPath:[[12,0],[13,0],[12,1],[13,1],[11,2],[12,2],[13,2],[11,3],[12,3],[13,3],[10,4],[11,4],[12,4],[13,4],[9,5],[10,5],[11,5],[12,5],[13,5]],cliffEdges:[[0,8],[1,8],[2,8],[0,9],[1,9],[24,10],[24,11],[23,10],[23,11]],difficultTerrain:[[3,8],[4,8],[5,8],[20,10],[21,10],[22,10],[4,9],[5,9],[20,11],[21,11],[22,11]],hazardousTerrain:[[1,15],[2,15],[3,15],[22,3],[23,3],[24,3]]},enemies:[{monsterName:"Orc",count:3,defaultPosition:[[15,4],[18,6],[14,8]]}],allies:[{characterName:"Sildar Hallwinter",defaultPosition:[12,16]},{characterName:"Gundren Rockseeker",defaultPosition:[11,16]}]},{name:"Owlbear Nest - Cave Entrance",width:16,height:14,cellSize:40,description:"The entrance to a dark cave. Bones and debris litter the ground. A dangerous owlbear has claimed this territory as its hunting ground.",scenario:"Guardian Beast",difficulty:"Hard",encounterLevel:4,terrain:{caveEntrance:[[5,0],[6,0],[7,0],[8,0],[9,0],[10,0],[5,1],[6,1],[7,1],[8,1],[9,1],[10,1],[6,2],[7,2],[8,2],[9,2]],rockyDebris:[[2,3],[3,3],[13,3],[14,3],[1,4],[15,4],[2,11],[3,11],[13,11],[14,11]],difficultTerrain:[[0,2],[1,2],[2,2],[13,2],[14,2],[15,2],[0,12],[1,12],[2,12],[13,12],[14,12],[15,12]]},enemies:[{monsterName:"Owlbear",count:1,defaultPosition:[[8,7]]}],allies:[{characterName:"Thorin Ironfist",defaultPosition:[8,12]},{characterName:"Elara Moonwhisper",defaultPosition:[6,13]},{characterName:"Brother Marcus",defaultPosition:[7,12]},{characterName:"Whisper",defaultPosition:[9,13]}]},{name:"Ancient Tomb - Skeleton Guard",width:22,height:16,cellSize:40,description:"An ancient burial chamber filled with sarcophagi and magical darkness. Animated skeletons guard the entrance to the deeper catacombs.",scenario:"Undead Guardians",difficulty:"Medium",encounterLevel:2,terrain:{sarcophagi:[[4,3],[5,3],[16,3],[17,3],[4,12],[5,12],[16,12],[17,12]],magicalDarkness:[[10,5],[11,5],[10,6],[11,6],[12,6]],difficultTerrain:[[1,1],[2,1],[20,1],[21,1],[1,14],[2,14],[20,14],[21,14]]},enemies:[{monsterName:"Skeleton",count:6,defaultPosition:[[10,2],[11,2],[12,2],[10,8],[11,8],[12,8]]}],allies:[{characterName:"Brother Marcus",defaultPosition:[11,14]},{characterName:"Sister Garaele",defaultPosition:[10,15]}]},{name:"The Green Dragon's Lair",width:28,height:20,cellSize:40,description:"A vast underground cavern with a pool of acidic water and mounds of treasure. A young green dragon has made this its lair. Toxic fumes fill the air.",scenario:"Dragon Encounter",difficulty:"Very Hard",encounterLevel:10,terrain:{acidPool:[[13,8],[14,8],[15,8],[12,9],[13,9],[14,9],[15,9],[16,9],[13,10],[14,10],[15,10],[14,11]],treasureMounds:[[4,3],[5,3],[23,3],[24,3],[4,16],[5,16],[23,16],[24,16]],hazardousTerrain:[[10,6],[11,6],[16,6],[17,6],[10,13],[11,13],[16,13],[17,13]],difficultTerrain:[[2,2],[3,2],[25,2],[26,2],[2,17],[3,17],[25,17],[26,17]]},enemies:[{monsterName:"Young Red Dragon",count:1,defaultPosition:[[14,10]]}],allies:[{characterName:"Thorin Ironfist",defaultPosition:[8,18]},{characterName:"Elara Moonwhisper",defaultPosition:[6,19]},{characterName:"Brother Marcus",defaultPosition:[7,18]},{characterName:"Whisper",defaultPosition:[9,19]},{characterName:"Sildar Hallwinter",defaultPosition:[10,18]}]},{name:"Troll Bridge - River Crossing",width:24,height:14,cellSize:40,description:"A rickety wooden bridge spans a deep ravine. A troll has claimed this crossing and demands tribute from all who pass. The bridge is in poor repair.",scenario:"Troll Encounter",difficulty:"Very Hard",encounterLevel:5,terrain:{bridge:[[11,0],[12,0],[11,1],[12,1],[11,2],[12,2],[11,3],[12,3],[11,4],[12,4],[11,5],[12,5],[11,6],[12,6],[11,7],[12,7],[11,8],[12,8],[11,9],[12,9],[11,10],[12,10],[11,11],[12,11],[11,12],[12,12],[11,13],[12,13]],river:[[8,0],[9,0],[10,0],[13,0],[14,0],[15,0],[7,1],[8,1],[9,1],[10,1],[13,1],[14,1],[15,1],[16,1],[8,13],[9,13],[10,13],[13,13],[14,13],[15,13]],unstable:[[11,6],[12,6],[11,7],[12,7]]},enemies:[{monsterName:"Troll",count:1,defaultPosition:[[11,7]]}],allies:[{characterName:"Thorin Ironfist",defaultPosition:[12,0]},{characterName:"Elara Moonwhisper",defaultPosition:[11,0]},{characterName:"Brother Marcus",defaultPosition:[12,1]},{characterName:"Whisper",defaultPosition:[11,1]}]},{name:"Tavern Brawl - The Sleeping Giant",width:18,height:14,cellSize:40,description:"The interior of a cozy tavern with tables, chairs, and a bar. A heated argument has escalated into an all-out brawl. Patrons scatter as the fight breaks out.",scenario:"Bar Fight",difficulty:"Easy",encounterLevel:1,terrain:{tables:[[4,6],[5,6],[6,6],[12,6],[13,6],[14,6],[8,10],[9,10]],bar:[[0,4],[1,4],[2,4],[3,4],[4,4],[5,4]],chairs:[[3,8],[4,8],[13,8],[14,8]],difficultTerrain:[[0,0],[0,1],[0,13],[17,0],[17,1],[17,13]]},enemies:[{monsterName:"Orc",count:2,defaultPosition:[[10,7],[9,8]]}],allies:[{characterName:"Toblen Stonehill",defaultPosition:[3,4]},{characterName:"Whisper",defaultPosition:[15,9]}]},{name:"Goblin Stronghold - Main Chamber",width:30,height:22,cellSize:40,description:"The central chamber of a goblin cave system. Makeshift fortifications and barricades divide the room. Multiple goblin raiders use superior numbers and terrain advantage.",scenario:"Siege Defense",difficulty:"Hard",encounterLevel:3,terrain:{barricades:[[10,5],[19,5],[10,16],[19,16]],difficultTerrain:[[5,2],[6,2],[24,2],[25,2],[5,19],[6,19],[24,19],[25,19]],hazardousTerrain:[[0,10],[0,11],[29,10],[29,11]]},enemies:[{monsterName:"Goblin",count:8,defaultPosition:[[10,4],[15,3],[19,4],[14,11],[15,11],[14,18],[15,18],[16,18]]}],allies:[{characterName:"Thorin Ironfist",defaultPosition:[15,20]},{characterName:"Elara Moonwhisper",defaultPosition:[13,21]},{characterName:"Brother Marcus",defaultPosition:[14,20]},{characterName:"Whisper",defaultPosition:[16,21]},{characterName:"Sildar Hallwinter",defaultPosition:[17,20]}]}],n1={version:xde,description:yde,maps:vde},iy=[{name:"Attack",description:"Make a weapon attack using a melee or ranged weapon.",actionCost:"Action",type:"MELEE_ATTACK",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"general",isBaseAction:!0,createdAt:Date.now()},{name:"Dodge",description:"Focus entirely on avoiding attacks; impose disadvantage on attacks against you until your next turn.",actionCost:"Action",type:"COMMONLY_AVAILABLE_UTILITY",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"general",isBaseAction:!0,createdAt:Date.now()},{name:"Dash",description:"Move up to twice your speed this turn, using your action for movement.",actionCost:"Action",type:"COMMONLY_AVAILABLE_UTILITY",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"general",isBaseAction:!0,createdAt:Date.now()},{name:"Disengage",description:"Your movement doesnt provoke opportunity attacks for the rest of the turn.",actionCost:"Action",type:"COMMONLY_AVAILABLE_UTILITY",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"general",isBaseAction:!0,createdAt:Date.now()},{name:"Hide",description:"Attempt to conceal yourself from enemies; roll Dexterity (Stealth).",actionCost:"Action",type:"COMMONLY_AVAILABLE_UTILITY",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"general",createdAt:Date.now()},{name:"Help",description:"Give an ally advantage on their next ability check or attack roll against a creature within 5 feet.",actionCost:"Action",type:"COMMONLY_AVAILABLE_UTILITY",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"general",createdAt:Date.now()},{name:"Ready",description:"Prepare to take an action later when a specified trigger occurs.",actionCost:"Action",type:"OTHER",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"general",createdAt:Date.now()},{name:"Use an Object",description:"Interact with an item such as pulling a lever or drinking a potion.",actionCost:"Action",type:"OTHER",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"general",createdAt:Date.now()},{name:"Cast a Spell",description:"Use your action to cast a spell, following its casting time, components, and effects.",actionCost:"Action",type:"SPELL",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"general",createdAt:Date.now()},{name:"Search",description:"Spend your action to look for hidden objects or creatures.",actionCost:"Action",type:"COMMONLY_AVAILABLE_UTILITY",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"general",createdAt:Date.now()},{name:"Rage",description:"Enter a furious battle frenzy, gaining bonus damage and resistance.",actionCost:"Bonus Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Barbarian",targetClass:"Barbarian",usesPer:"Long Rest",maxUses:2,createdAt:Date.now()},{name:"Reckless Attack",description:"Throw caution aside, gaining advantage on melee attacks but granting advantage to enemies that attack you.",actionCost:"Action",type:"MELEE_ATTACK",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Barbarian",targetClass:"Barbarian",createdAt:Date.now()},{name:"Feral Instinct",description:"Gain advantage on initiative rolls and act normally during surprise rounds.",actionCost:"No Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Barbarian",targetClass:"Barbarian",createdAt:Date.now()},{name:"Brutal Critical",description:"Roll extra damage dice when scoring a melee critical hit.",actionCost:"Special",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Barbarian",targetClass:"Barbarian",createdAt:Date.now()},{name:"Relentless Rage",description:"Stay alive when reduced to 0 HP with a successful Constitution saving throw.",actionCost:"Reaction",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Barbarian",targetClass:"Barbarian",createdAt:Date.now()},{name:"Bardic Inspiration",description:"Grant an ally a die to add to ability checks, attacks, or saving throws.",actionCost:"Bonus Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Bard",targetClass:"Bard",usesPer:"Long Rest",maxUses:"Charisma Modifier",createdAt:Date.now()},{name:"Song of Rest",description:"Restore extra hit points to allies during a short rest through soothing music.",actionCost:"No Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Bard",targetClass:"Bard",createdAt:Date.now()},{name:"Countercharm",description:"Use performance to grant allies advantage on saving throws vs fear or charm.",actionCost:"Action",type:"SPELL",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Bard",targetClass:"Bard",createdAt:Date.now()},{name:"Cutting Words",description:"Use wit to subtract from a creature's attack roll or ability check.",actionCost:"Reaction",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Bard",targetClass:"Bard",createdAt:Date.now()},{name:"Magical Secrets",description:"Learn and cast spells from any class list.",actionCost:"No Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Bard",targetClass:"Bard",createdAt:Date.now()},{name:"Channel Divinity",description:"Channel divine energy to fuel special effects unique to your domain.",actionCost:"Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Cleric",targetClass:"Cleric",usesPer:"Short Rest",maxUses:1,createdAt:Date.now()},{name:"Turn Undead",description:"Present your holy symbol to drive away undead.",actionCost:"Action",type:"SPELL",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Cleric",targetClass:"Cleric",createdAt:Date.now()},{name:"Divine Intervention",description:"Call upon your deity for miraculous aid.",actionCost:"Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Cleric",targetClass:"Cleric",usesPer:"Day",createdAt:Date.now()},{name:"Spell: Cure Wounds",description:"Heal a creature you can touch for 1d8 + Wisdom modifier HP.",actionCost:"Action",type:"SPELL",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Cleric",targetClass:"Cleric",spellLevel:1,range:"Touch",components:{verbal:!0,somatic:!0},duration:"Instantaneous",createdAt:Date.now()},{name:"Bless",description:"Up to three creatures gain +1d4 to attack rolls and saving throws.",actionCost:"Action",type:"SPELL",requiresConcentration:!0,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Cleric",targetClass:"Cleric",duration:"Concentration, up to 1 minute",createdAt:Date.now()},{name:"Wild Shape",description:"Transform into a beast you have seen before for up to several hours.",actionCost:"Bonus Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Druid",usesPer:"Short Rest",maxUses:2,createdAt:Date.now()},{name:"Produce Flame",description:"Create a small flame in your hand for light or to hurl as an attack.",actionCost:"Action",type:"SPELL",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Druid",spellLevel:0,createdAt:Date.now()},{name:"Entangle",description:"Grasping weeds sprout from the ground, restraining creatures in range.",actionCost:"Action",type:"SPELL",requiresConcentration:!0,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Druid",targetClass:"Druid",createdAt:Date.now()},{name:"Flame Blade",description:"Conjure a fiery scimitar that deals 3d6 fire damage on hit.",actionCost:"Bonus Action",type:"SPELL",requiresConcentration:!0,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Druid",targetClass:"Druid",createdAt:Date.now()},{name:"Summon Beast",description:"Call forth a beast spirit to fight for you.",actionCost:"Action",type:"SPELL",requiresConcentration:!0,sourceBook:"Tashas Cauldron of Everything",category:"class_specific",requiredClass:"Druid",targetClass:"Druid",createdAt:Date.now()},{name:"Second Wind",description:"Draw on your stamina to regain hit points equal to 1d10 + your fighter level.",actionCost:"Bonus Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Fighter",usesPer:"Short Rest",maxUses:1,createdAt:Date.now()},{name:"Action Surge",description:"Push yourself beyond your limits to take one additional action.",actionCost:"Special",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Fighter",usesPer:"Short Rest",maxUses:1,createdAt:Date.now()},{name:"Indomitable",description:"Reroll a failed saving throw.",actionCost:"Reaction",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Fighter",usesPer:"Long Rest",maxUses:1,createdAt:Date.now()},{name:"Second Strike",description:"Make an additional melee attack as part of an Attack action.",actionCost:"Bonus Action",type:"MELEE_ATTACK",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Fighter",targetClass:"Fighter",createdAt:Date.now()},{name:"Parry",description:"Reduce incoming melee damage by rolling your superiority die and adding your Dexterity modifier.",actionCost:"Reaction",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Fighter",targetClass:"Fighter",createdAt:Date.now()},{name:"Flurry of Blows",description:"After taking the Attack action, spend 1 ki to make two unarmed strikes as a bonus action.",actionCost:"Bonus Action",type:"BONUS_ACTION",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Monk",usesPer:"Special",createdAt:Date.now()},{name:"Patient Defense",description:"Spend 1 ki point to take the Dodge action as a bonus action.",actionCost:"Bonus Action",type:"BONUS_ACTION",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Monk",targetClass:"Monk",createdAt:Date.now()},{name:"Step of the Wind",description:"Spend 1 ki to Disengage or Dash as a bonus action, doubling your jump distance.",actionCost:"Bonus Action",type:"BONUS_ACTION",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Monk",targetClass:"Monk",createdAt:Date.now()},{name:"Deflect Missiles",description:"Reduce or negate ranged weapon damage from an incoming attack.",actionCost:"Reaction",type:"REACTION",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Monk",targetClass:"Monk",createdAt:Date.now()},{name:"Stunning Strike",description:"Spend 1 ki to attempt to stun a creature you hit with a melee weapon attack.",actionCost:"No Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Monk",targetClass:"Monk",createdAt:Date.now()},{name:"Divine Smite",description:"Expend a spell slot to deal radiant damage on a successful melee attack.",actionCost:"No Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Paladin",targetClass:"Paladin",createdAt:Date.now()},{name:"Lay on Hands",description:"Touch a creature to restore a pool of hit points.",actionCost:"Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Paladin",usesPer:"Day",maxUses:"5  Paladin Level",createdAt:Date.now()},{name:"Divine Sense",description:"Know the location of celestial, fiend, or undead within 60 feet.",actionCost:"Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Paladin",usesPer:"Long Rest",maxUses:"1 + Charisma Modifier",createdAt:Date.now()},{name:"Aura of Protection",description:"Add your Charisma modifier to allies' saving throws within 10 feet.",actionCost:"No Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Paladin",targetClass:"Paladin",createdAt:Date.now()},{name:"Sacred Weapon",description:"Channel Divinity to imbue your weapon with divine power, adding your Charisma bonus to attack rolls.",actionCost:"Action",type:"CLASS_FEATURE",requiresConcentration:!0,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Paladin",targetClass:"Paladin",createdAt:Date.now()},{name:"Hunters Mark",description:"Mark a creature to deal extra 1d6 damage and track it more easily.",actionCost:"Bonus Action",type:"SPELL",requiresConcentration:!0,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Ranger",targetClass:"Ranger",createdAt:Date.now()},{name:"Favored Foe",description:"Designate an enemy as your favored target to deal extra damage.",actionCost:"Bonus Action",type:"CLASS_FEATURE",requiresConcentration:!0,sourceBook:"Tashas Cauldron of Everything",category:"class_specific",requiredClass:"Ranger",targetClass:"Ranger",createdAt:Date.now()},{name:"Hide in Plain Sight",description:"Camouflage yourself, gaining +10 to Stealth while stationary.",actionCost:"Action",type:"COMMONLY_AVAILABLE_UTILITY",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Ranger",targetClass:"Ranger",createdAt:Date.now()},{name:"Volley",description:"Make a ranged attack against any number of creatures in an area.",actionCost:"Action",type:"RANGED_ATTACK",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Ranger",targetClass:"Ranger",createdAt:Date.now()},{name:"Evasion",description:"Take no damage from successful Dexterity saves, half on a failure.",actionCost:"Reaction",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Ranger",targetClass:"Ranger",createdAt:Date.now()},{name:"Sneak Attack",description:"Deal extra damage when striking with advantage or when an ally is nearby.",actionCost:"No Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Rogue",targetClass:"Rogue",createdAt:Date.now()},{name:"Cunning Action",description:"Use Dash, Disengage, or Hide as a bonus action.",actionCost:"Bonus Action",type:"BONUS_ACTION",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Rogue",targetClass:"Rogue",createdAt:Date.now()},{name:"Uncanny Dodge",description:"Use your reaction to halve damage from an attacker you can see.",actionCost:"Reaction",type:"REACTION",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Rogue",targetClass:"Rogue",createdAt:Date.now()},{name:"Evasion",description:"Avoid damage entirely on successful Dexterity saves against area effects.",actionCost:"No Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Rogue",targetClass:"Rogue",createdAt:Date.now()},{name:"Reliable Talent",description:"Treat any roll of 9 or lower on proficient checks as a 10.",actionCost:"No Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Rogue",targetClass:"Rogue",createdAt:Date.now()},{name:"Metamagic: Quickened Spell",description:"Spend sorcery points to cast a spell that normally takes an action as a bonus action instead.",actionCost:"Bonus Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Sorcerer",targetClass:"Sorcerer",createdAt:Date.now()},{name:"Metamagic: Twinned Spell",description:"Target a second creature with a single-target spell.",actionCost:"No Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Sorcerer",targetClass:"Sorcerer",createdAt:Date.now()},{name:"Font of Magic",description:"Convert spell slots to sorcery points or vice versa.",actionCost:"Special",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Sorcerer",targetClass:"Sorcerer",createdAt:Date.now()},{name:"Chaos Bolt",description:"Unleash a bolt of chaotic energy that changes damage type randomly.",actionCost:"Action",type:"SPELL",requiresConcentration:!1,sourceBook:"Xanathars Guide to Everything",category:"class_specific",requiredClass:"Sorcerer",targetClass:"Sorcerer",createdAt:Date.now()},{name:"Wild Magic Surge",description:"After casting a spell, roll to trigger a wild magic effect.",actionCost:"Special",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Sorcerer",targetClass:"Sorcerer",createdAt:Date.now()},{name:"Eldritch Blast",description:"Fire a beam of crackling energy that deals force damage on a hit.",actionCost:"Action",type:"SPELL",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Warlock",spellLevel:0,createdAt:Date.now()},{name:"Hex",description:"Curse a creature to deal extra necrotic damage when you hit it.",actionCost:"Bonus Action",type:"SPELL",requiresConcentration:!0,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Warlock",targetClass:"Warlock",createdAt:Date.now()},{name:"Dark Ones Blessing",description:"Gain temporary hit points when you reduce a hostile creature to 0 HP.",actionCost:"No Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Warlock",targetClass:"Warlock",createdAt:Date.now()},{name:"Misty Escape",description:"When damaged, turn invisible and teleport up to 60 feet.",actionCost:"Reaction",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Warlock",targetClass:"Warlock",createdAt:Date.now()},{name:"Pact Weapon Attack",description:"Summon and wield your bonded weapon.",actionCost:"Action",type:"MELEE_ATTACK",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Warlock",targetClass:"Warlock",createdAt:Date.now()},{name:"Arcane Recovery",description:"Regain expended spell slots after a short rest up to half your wizard level.",actionCost:"No Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Wizard",usesPer:"Day",createdAt:Date.now()},{name:"Spell Mastery",description:"Cast certain 1st or 2ndlevel spells at will.",actionCost:"Special",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Wizard",targetClass:"Wizard",createdAt:Date.now()},{name:"Arcane Ward",description:"Automatically create a ward that absorbs damage when you cast abjuration spells.",actionCost:"No Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Wizard",targetClass:"Wizard",createdAt:Date.now()},{name:"Counterspell",description:"Interrupt another creatures spellcasting.",actionCost:"Reaction",type:"SPELL",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Wizard",targetClass:"Wizard",createdAt:Date.now()},{name:"Fireball",description:"Create an explosion of fire dealing 8d6 fire damage in a 20ft radius.",actionCost:"Action",type:"SPELL",requiresConcentration:!1,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Wizard",targetClass:"Wizard",createdAt:Date.now()},{name:"Infuse Item",description:"Imbue mundane objects with temporary magical properties.",actionCost:"Special",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Eberron: Rising from the Last War",category:"class_specific",requiredClass:"Artificer",targetClass:"Artificer",createdAt:Date.now()},{name:"Arcane Jolt",description:"Channel arcane energy through your weapon or infused strike to restore or damage.",actionCost:"No Action",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Tashas Cauldron of Everything",category:"class_specific",requiredClass:"Artificer",targetClass:"Artificer",createdAt:Date.now()},{name:"Steel Defender Command",description:"Command your defender to attack or take another action on your turn.",actionCost:"Bonus Action",type:"BONUS_ACTION",requiresConcentration:!1,sourceBook:"Eberron: Rising from the Last War",category:"class_specific",requiredClass:"Artificer",targetClass:"Artificer",createdAt:Date.now()},{name:"Spell-Storing Item",description:"Store a prepared spell into an infused item for later use.",actionCost:"Special",type:"CLASS_FEATURE",requiresConcentration:!1,sourceBook:"Tashas Cauldron of Everything",category:"class_specific",requiredClass:"Artificer",targetClass:"Artificer",createdAt:Date.now()},{name:"Magic Weapon",description:"Turn a nonmagical weapon into a +1 magical weapon for up to 1 hour.",actionCost:"Bonus Action",type:"SPELL",requiresConcentration:!0,sourceBook:"Player's Handbook",category:"class_specific",requiredClass:"Artificer",targetClass:"Artificer",createdAt:Date.now()},{name:"Fire Breath",description:"The dragon exhales fire in a 15-foot cone. Each creature in that area must make a DC 15 Dexterity saving throw, taking 24 (7d6) fire damage on a failed save, or half as much damage on a successful one.",actionCost:"Action",type:"SPELL",requiresConcentration:!1,sourceBook:"Monster Manual",category:"general",createdAt:Date.now()},{name:"Frightful Presence",description:"Each creature of the dragon's choice that is within 120 feet of the dragon and aware of it must succeed on a DC 16 Wisdom saving throw or become frightened for 1 minute.",actionCost:"Action",type:"SPELL",requiresConcentration:!1,sourceBook:"Monster Manual",category:"general",createdAt:Date.now()},{name:"Shortsword Attack",description:"Melee Weapon Attack: +4 to hit, reach 5 ft., one target. Hit: 5 (1d6 + 2) piercing damage.",actionCost:"Action",type:"MELEE_ATTACK",requiresConcentration:!1,sourceBook:"Monster Manual",category:"general",attackBonusAbilityScore:"strength",isProficient:!0,damageRolls:[{dice:{count:1,type:"D6"},modifier:2,damageType:"PIERCING"}],createdAt:Date.now()},{name:"Shortbow Attack",description:"Ranged Weapon Attack: +4 to hit, range 80/320 ft., one target. Hit: 5 (1d6 + 2) piercing damage.",actionCost:"Action",type:"RANGED_ATTACK",requiresConcentration:!1,sourceBook:"Monster Manual",category:"general",attackBonusAbilityScore:"dexterity",isProficient:!0,damageRolls:[{dice:{count:1,type:"D6"},modifier:2,damageType:"PIERCING"}],createdAt:Date.now()},{name:"Scimitar Attack",description:"Melee Weapon Attack: +4 to hit, reach 5 ft., one target. Hit: 5 (1d6 + 2) slashing damage.",actionCost:"Action",type:"MELEE_ATTACK",requiresConcentration:!1,sourceBook:"Monster Manual",category:"general",attackBonusAbilityScore:"dexterity",isProficient:!0,damageRolls:[{dice:{count:1,type:"D6"},modifier:2,damageType:"SLASHING"}],createdAt:Date.now()},{name:"Greataxe Attack",description:"Melee Weapon Attack: +5 to hit, reach 5 ft., one target. Hit: 9 (1d12 + 3) slashing damage.",actionCost:"Action",type:"MELEE_ATTACK",requiresConcentration:!1,sourceBook:"Monster Manual",category:"general",attackBonusAbilityScore:"strength",isProficient:!0,damageRolls:[{dice:{count:1,type:"D12"},modifier:3,damageType:"SLASHING"}],createdAt:Date.now()},{name:"Javelin Attack",description:"Melee or Ranged Weapon Attack: +5 to hit, reach 5 ft. or range 30/120 ft., one target. Hit: 6 (1d6 + 3) piercing damage.",actionCost:"Action",type:"MELEE_ATTACK",requiresConcentration:!1,sourceBook:"Monster Manual",category:"general",attackBonusAbilityScore:"strength",isProficient:!0,damageRolls:[{dice:{count:1,type:"D6"},modifier:3,damageType:"PIERCING"}],createdAt:Date.now()},{name:"Beak Attack",description:"Melee Weapon Attack: +7 to hit, reach 5 ft., one target. Hit: 10 (1d10 + 5) piercing damage.",actionCost:"Action",type:"MELEE_ATTACK",requiresConcentration:!1,sourceBook:"Monster Manual",category:"general",attackBonusAbilityScore:"strength",isProficient:!0,damageRolls:[{dice:{count:1,type:"D10"},modifier:5,damageType:"PIERCING"}],createdAt:Date.now()},{name:"Regeneration",description:"The troll regains 10 hit points at the start of its turn. If the troll takes acid or fire damage, this trait doesn't function at the start of the troll's next turn.",actionCost:"No Action",type:"OTHER",requiresConcentration:!1,sourceBook:"Monster Manual",category:"general",createdAt:Date.now()},{name:"Antimagic Cone",description:"The beholder's central eye creates a 150-foot cone of antimagic. This works like the antimagic field spell.",actionCost:"Action",type:"SPELL",requiresConcentration:!0,sourceBook:"Monster Manual",category:"general",createdAt:Date.now()},{name:"Eye Ray",description:"The beholder shoots one of its eye rays at a random target within 120 feet. Roll a d8 to determine which ray is used.",actionCost:"Action",type:"SPELL",requiresConcentration:!1,sourceBook:"Monster Manual",category:"general",createdAt:Date.now()},{name:"Multiattack",description:"The monster makes two melee attacks.",actionCost:"Action",type:"OTHER",requiresConcentration:!1,sourceBook:"Monster Manual",category:"general",createdAt:Date.now()},{name:"Bite",description:"Melee Weapon Attack: +4 to hit, reach 5 ft., one target. Hit: 6 (1d6 + 3) piercing damage.",actionCost:"Action",type:"MELEE_ATTACK",requiresConcentration:!1,sourceBook:"Monster Manual",category:"general",attackBonusAbilityScore:"strength",isProficient:!0,damageRolls:[{dice:{count:1,type:"D6"},modifier:3,damageType:"PIERCING"}],createdAt:Date.now()},{name:"Claw",description:"Melee Weapon Attack: +4 to hit, reach 5 ft., one target. Hit: 4 (1d4 + 2) slashing damage.",actionCost:"Action",type:"MELEE_ATTACK",requiresConcentration:!1,sourceBook:"Monster Manual",category:"general",attackBonusAbilityScore:"strength",isProficient:!0,damageRolls:[{dice:{count:1,type:"D4"},modifier:2,damageType:"SLASHING"}],createdAt:Date.now()},{name:"Scimitar",description:"Melee Weapon Attack: +4 to hit, reach 5 ft., one target. Hit: 5 (1d6 + 2) slashing damage.",actionCost:"Action",type:"MELEE_ATTACK",requiresConcentration:!1,sourceBook:"Monster Manual",category:"general",attackBonusAbilityScore:"dexterity",isProficient:!0,damageRolls:[{dice:{count:1,type:"D6"},modifier:2,damageType:"SLASHING"}],createdAt:Date.now()},{name:"Shortbow",description:"Ranged Weapon Attack: +4 to hit, range 80/320 ft., one target. Hit: 5 (1d6 + 2) piercing damage.",actionCost:"Action",type:"RANGED_ATTACK",requiresConcentration:!1,sourceBook:"Monster Manual",category:"general",attackBonusAbilityScore:"dexterity",isProficient:!0,damageRolls:[{dice:{count:1,type:"D6"},modifier:2,damageType:"PIERCING"}],createdAt:Date.now()},{name:"Beak",description:"Melee Weapon Attack: +7 to hit, reach 5 ft., one target. Hit: 10 (1d10 + 5) piercing damage.",actionCost:"Action",type:"MELEE_ATTACK",requiresConcentration:!1,sourceBook:"Monster Manual",category:"general",attackBonusAbilityScore:"strength",isProficient:!0,damageRolls:[{dice:{count:1,type:"D10"},modifier:5,damageType:"PIERCING"}],createdAt:Date.now()},{name:"Claws",description:"Melee Weapon Attack: +7 to hit, reach 5 ft., one target. Hit: 14 (2d8 + 5) slashing damage.",actionCost:"Action",type:"MELEE_ATTACK",requiresConcentration:!1,sourceBook:"Monster Manual",category:"general",attackBonusAbilityScore:"strength",isProficient:!0,damageRolls:[{dice:{count:2,type:"D8"},modifier:5,damageType:"SLASHING"}],createdAt:Date.now()},{name:"Tail",description:"Melee Weapon Attack: +10 to hit, reach 15 ft., one target. Hit: 13 (2d8 + 4) bludgeoning damage.",actionCost:"Action",type:"MELEE_ATTACK",requiresConcentration:!1,sourceBook:"Monster Manual",category:"general",attackBonusAbilityScore:"strength",isProficient:!0,damageRolls:[{dice:{count:2,type:"D8"},modifier:4,damageType:"BLUDGEONING"}],createdAt:Date.now()},{name:"Opportunistic Strike",description:"When an ally within 5 feet hits a creature with a melee attack, the monster can make a melee weapon attack against the same creature as a reaction.",actionCost:"Reaction",type:"MELEE_ATTACK",requiresConcentration:!1,sourceBook:"Monster Manual",category:"general",createdAt:Date.now()},{name:"Battle Fury",description:"When the monster takes damage, it can make a melee weapon attack against the source of the damage as a reaction.",actionCost:"Reaction",type:"MELEE_ATTACK",requiresConcentration:!1,sourceBook:"Monster Manual",category:"general",createdAt:Date.now()},{name:"Tail Swipe",description:"When a creature moves into a space within reach of the monster, the monster can make a tail attack against that creature as a reaction.",actionCost:"Reaction",type:"MELEE_ATTACK",requiresConcentration:!1,sourceBook:"Monster Manual",category:"general",createdAt:Date.now()},{name:"Frenzied Retaliation",description:"When the monster takes damage from a melee attack, it can immediately make a natural weapon attack against the attacker as a reaction.",actionCost:"Reaction",type:"MELEE_ATTACK",requiresConcentration:!1,sourceBook:"Monster Manual",category:"general",createdAt:Date.now()},{name:"Bone Rattle",description:"When the skeleton takes damage, it can make a shortsword attack against the nearest enemy as a reaction.",actionCost:"Reaction",type:"MELEE_ATTACK",requiresConcentration:!1,sourceBook:"Monster Manual",category:"general",createdAt:Date.now()},{name:"Detect",description:"The dragon makes a Wisdom (Perception) check.",actionCost:"Legendary Action",type:"OTHER",requiresConcentration:!1,sourceBook:"Monster Manual",category:"general",createdAt:Date.now()},{name:"Tail Attack",description:"The dragon makes a tail attack.",actionCost:"Legendary Action",type:"MELEE_ATTACK",requiresConcentration:!1,sourceBook:"Monster Manual",category:"general",createdAt:Date.now()},{name:"Wing Attack",description:"The dragon beats its wings. Each creature within reach must succeed on a Dexterity saving throw or take bludgeoning damage and be knocked prone.",actionCost:"Legendary Action",type:"OTHER",requiresConcentration:!1,sourceBook:"Monster Manual",category:"general",createdAt:Date.now()},{name:"Magma Eruption",description:"Magma erupts from a point on the ground the dragon can see within 120 feet, creating a geyser. Each creature in the area must make a Dexterity saving throw, taking fire damage on a failed save, or half as much on a success.",actionCost:"Lair Action",type:"OTHER",requiresConcentration:!1,sourceBook:"Monster Manual",category:"general",createdAt:Date.now()},{name:"Volcanic Gases",description:"A cloud of hot, toxic gas fills an area. The gas remains until initiative count 20 on the next round. Each creature that starts its turn in the gas must succeed on a Constitution saving throw or be poisoned until the end of its turn.",actionCost:"Lair Action",type:"OTHER",requiresConcentration:!1,sourceBook:"Monster Manual",category:"general",createdAt:Date.now()},{name:"Eye Ray",description:"The beholder shoots one of its eye rays at a random target within 120 feet.",actionCost:"Legendary Action",type:"SPELL",requiresConcentration:!1,sourceBook:"Monster Manual",category:"general",createdAt:Date.now()}],r1=[{name:"Travelers Rations",type:"Adventuring Gear",rarity:"Common",description:"Basic dried food for long journeys.",scope:"global",weight:2,cost:5,userId:"user_001"},{name:"Torch",type:"Adventuring Gear",rarity:"Common",description:"Provides bright light in a 20-foot radius.",scope:"global",weight:1,cost:1,userId:"user_001"},{name:"Leather Armor",type:"Armor",rarity:"Common",description:"Light protection offering modest defense.",scope:"global",weight:10,cost:10,typeOfArmor:"Light",armorClass:11,durability:{current:15,max:15,baseDurability:15},userId:"user_001"},{name:"Short Sword",type:"Weapon",rarity:"Common",description:"A simple blade favored by rogues.",scope:"global",weight:2,cost:10,damageRolls:[{dice:{count:1,type:"D6"},modifier:2,damageType:"PIERCING"}],durability:{current:25,max:25,baseDurability:25},userId:"user_001"},{name:"Wooden Shield",type:"Armor",rarity:"Common",description:"A simple round shield offering +2 AC.",scope:"global",typeOfArmor:"Shield",armorClass:2,durability:{current:20,max:20,baseDurability:20},weight:6,cost:10,userId:"user_002"},{name:"Potion of Healing",type:"Potion",rarity:"Common",description:"Restores small amount of hit points when consumed.",scope:"global",weight:.5,effects:"Heals 2d4+2 HP",cost:50,userId:"user_002"},{name:"Dagger of Quickness",type:"Weapon",rarity:"Uncommon",description:"A lightweight blade that moves as fast as thought.",scope:"entitySpecific",weight:1,cost:500,attunement:!0,damageRolls:[{dice:{count:1,type:"D4"},modifier:3,damageType:"PIERCING"}],abilityModifiers:{dexterity:1},userId:"user_003"},{name:"Ring of Water Breathing",type:"Ring",rarity:"Uncommon",description:"Allows the wearer to breathe underwater indefinitely.",scope:"entitySpecific",weight:0,cost:500,attunement:!0,userId:"user_004"},{name:"Cloak of Elvenkind",type:"Wondrous Item",rarity:"Uncommon",description:"Improves stealth and muffles movement.",scope:"entitySpecific",weight:2,cost:250,attunement:!0,abilityModifiers:{dexterity:2},userId:"user_005"},{name:"Scroll of Fire Bolt",type:"Scroll",rarity:"Common",description:"Contains the spell *Fire Bolt*.",scope:"global",weight:.1,effects:"Casts Fire Bolt (1d10 FIRE damage)",cost:100,userId:"user_006"},{name:"Longbow",type:"Weapon",rarity:"Uncommon",description:"A finely crafted longbow with excellent range.",scope:"global",weight:2,cost:50,damageRolls:[{dice:{count:1,type:"D8"},modifier:2,damageType:"PIERCING"}],durability:{current:35,max:35,baseDurability:35},userId:"user_007"},{name:"Wand of Magic Missiles",type:"Wand",rarity:"Uncommon",description:"Casts *Magic Missile* up to 7 charges per day.",scope:"entitySpecific",weight:1,cost:500,attunement:!0,userId:"user_008"},{name:"Boots of Striding and Springing",type:"Wondrous Item",rarity:"Rare",description:"Increases the user's movement and jump distance.",scope:"entitySpecific",weight:1,cost:5e3,attunement:!0,abilityModifiers:{strength:1},userId:"user_009"},{name:"Breastplate of the Guardian",type:"Armor",rarity:"Rare",description:"Offers magical resilience and superior protection.",scope:"campaignSpecific",typeOfArmor:"Medium",armorClass:15,weight:20,cost:400,durability:{current:50,max:50,baseDurability:50},attunement:!0,userId:"user_010"},{name:"Hellfire Dagger",type:"Weapon",rarity:"Rare",description:"Wreathed in eternal flames of the Nine Hells.",scope:"entitySpecific",weight:1,cost:5e3,damageRolls:[{dice:{count:1,type:"D4"},modifier:3,damageType:"FIRE"}],attunement:!0,userId:"user_011"},{name:"Gauntlets of Ogre Power",type:"Wondrous Item",rarity:"Rare",description:"Sets the wearer's Strength to 19.",scope:"entitySpecific",weight:2,cost:5e3,attunement:!0,abilityModifiers:{strength:5},userId:"user_012"},{name:"Potion of Invisibility",type:"Potion",rarity:"Rare",description:"Grants invisibility for 1 hour.",scope:"entitySpecific",weight:.5,cost:500,attunement:!1,userId:"user_013"},{name:"Rod of the Python",type:"Rod",rarity:"Rare",description:"Transforms into a giant constrictor snake on command.",scope:"campaignSpecific",weight:2,cost:5e3,attunement:!0,userId:"user_014"},{name:"Staff of Thunder and Lightning",type:"Staff",rarity:"Very Rare",description:"Crackles with elemental power of storms.",scope:"campaignSpecific",weight:4,cost:5e4,attunement:!0,damageRolls:[{dice:{count:2,type:"D6"},modifier:3,damageType:"LIGHTNING"}],userId:"user_015"},{name:"Plate Armor of Radiant Valor",type:"Armor",rarity:"Very Rare",description:"Shines with holy light; grants resistance to necrotic.",scope:"campaignSpecific",typeOfArmor:"Heavy",armorClass:18,weight:65,cost:5e4,durability:{current:100,max:100,baseDurability:100},attunement:!0,userId:"user_016"},{name:"Sword of Life-Stealing",type:"Weapon",rarity:"Very Rare",description:"Drains vitality from enemies, healing the wielder slightly.",scope:"entitySpecific",weight:3,cost:5e4,attunement:!0,damageRolls:[{dice:{count:1,type:"D8"},modifier:4,damageType:"NECROTIC"}],userId:"user_017"},{name:"Wings of Flying",type:"Wondrous Item",rarity:"Very Rare",description:"Transforms into functional wings when activated.",scope:"entitySpecific",weight:0,cost:5e4,attunement:!0,userId:"user_018"},{name:"Amulet of the Planes",type:"Wondrous Item",rarity:"Very Rare",description:"Grants teleportation between planes of existence.",scope:"campaignSpecific",weight:0,cost:5e4,attunement:!0,userId:"user_019"},{name:"Boundarybreaker Ship",type:"Vehicle",rarity:"Very Rare",description:"A magical flying ship capable of planar travel.",scope:"campaignSpecific",weight:1e4,cost:5e4,userId:"user_020"},{name:"Tome of Clear Thought",type:"Wondrous Item",rarity:"Legendary",description:"Permanently increases the reader's Intelligence.",scope:"entitySpecific",weight:5,cost:5e5,attunement:!1,abilityModifiers:{intelligence:2},userId:"user_021"},{name:"Ring of Three Wishes",type:"Ring",rarity:"Legendary",description:"Contains three charges of the Wish spell.",scope:"campaignSpecific",weight:0,cost:5e5,attunement:!0,userId:"user_022"},{name:"Holy Avenger",type:"Weapon",rarity:"Legendary",description:"A sacred blade that glows with radiant power.",scope:"campaignSpecific",weight:3,cost:5e5,attunement:!0,damageRolls:[{dice:{count:2,type:"D10"},modifier:5,damageType:"RADIANT"}],userId:"user_023"},{name:"Staff of Power",type:"Staff",rarity:"Legendary",description:"A potent focus that enhances spells and defense.",scope:"entitySpecific",weight:4,cost:5e5,attunement:!0,userId:"user_024"},{name:"Crown of the North Star",type:"Wondrous Item",rarity:"Legendary",description:"Radiates light and enhances spellcasting precision.",scope:"entitySpecific",weight:1,cost:5e5,attunement:!0,userId:"user_025"},{name:"Dragonbone Greatsword",type:"Weapon",rarity:"Legendary",description:"Forged from ancient dragon remains.",scope:"campaignSpecific",cost:5e5,attunement:!0,weight:8,damageRolls:[{dice:{count:2,type:"D12"},modifier:5,damageType:"SLASHING"}],durability:{current:150,max:150,baseDurability:150},userId:"user_026"},{name:"Armor of the Deep Sea",type:"Armor",rarity:"Legendary",description:"Allows survival and combat effectiveness underwater.",scope:"campaignSpecific",typeOfArmor:"Heavy",armorClass:19,weight:65,cost:5e5,attunement:!0,userId:"user_027"},{name:"Rod of Lordly Might",type:"Rod",rarity:"Legendary",description:"Shapeshifts into multiple powerful tools or weapons.",scope:"entitySpecific",weight:2,cost:5e5,attunement:!0,userId:"user_028"},{name:"Orb of Dragonkind",type:"Wondrous Item",rarity:"Artifact",description:"Calls and commands dragons across the world.",scope:"campaignSpecific",weight:1,cost:5e6,attunement:!0,userId:"user_029"},{name:"Blackblade of Despair",type:"Weapon",rarity:"Artifact",description:"Consumes souls and whispers madness to its wielder.",scope:"campaignSpecific",weight:3,cost:5e6,attunement:!0,damageRolls:[{dice:{count:3,type:"D10"},modifier:6,damageType:"NECROTIC"}],userId:"user_030"},{name:"Shield of the Hidden Sun",type:"Armor",rarity:"Artifact",description:"A radiant shield that can emit sunlight once per long rest.",scope:"campaignSpecific",typeOfArmor:"Shield",armorClass:3,weight:6,cost:5e6,attunement:!0,userId:"user_031"},{name:"The Heart of the World Tree",type:"Wondrous Item",rarity:"Artifact",description:"A living seed that can restore entire forests or worlds.",scope:"campaignSpecific",weight:.1,cost:5e6,attunement:!0,userId:"user_032"},{name:"Crown of the First Lich",type:"Wondrous Item",rarity:"Artifact",description:"Empowers necromantic magic and grants control over the undead.",scope:"entitySpecific",weight:1,cost:5e6,attunement:!0,abilityModifiers:{intelligence:4,wisdom:2},userId:"user_033"},{name:"Phoenix Feather Cloak",type:"Wondrous Item",rarity:"Unique",description:"Allows resurrection once per year from ashes after death.",scope:"campaignSpecific",weight:1,cost:1e7,attunement:!0,userId:"user_034"},{name:"Soulforged Armor",type:"Armor",rarity:"Unique",description:"Bound to the user's life force; cannot be removed.",scope:"entitySpecific",typeOfArmor:"Heavy",armorClass:21,weight:65,cost:1e7,durability:{current:200,max:200,baseDurability:200},attunement:!0,userId:"user_035"},{name:"Eternal Echo Wand",type:"Wand",rarity:"Unique",description:"Amplifies and stores the echo of every spell cast.",scope:"entitySpecific",weight:1,cost:1e7,attunement:!0,userId:"user_036"},{name:"Horn of Endless War",type:"Wondrous Item",rarity:"Unique",description:"Summons spectral warriors when blown on the battlefield.",scope:"campaignSpecific",weight:2,cost:1e7,attunement:!0,userId:"user_037"},{name:"Mirror of True Reflections",type:"Wondrous Item",rarity:"Unique",description:"Shows the viewer their true selfphysical, mental, and spiritual.",scope:"global",weight:10,cost:1e7,attunement:!1,userId:"user_038"},{name:"Specter's Cloak",type:"Wondrous Item",rarity:"Very Rare",description:"Allows phasing through solid matter a few times per day.",scope:"campaignSpecific",weight:1,cost:5e4,attunement:!0,userId:"user_039"},{name:"Bow of the Eclipse",type:"Weapon",rarity:"Legendary",description:"Channels moonlight and shadow into its arrows.",scope:"campaignSpecific",weight:2,cost:5e5,damageRolls:[{dice:{count:2,type:"D8"},modifier:4,damageType:"RADIANT"}],attunement:!0,userId:"user_040"},{name:"Pegasus Mount",type:"Mount",rarity:"Rare",description:"A winged horse, loyal and noble.",scope:"campaignSpecific",weight:1500,cost:15e3,userId:"user_041"},{name:"Chariot of Fire",type:"Vehicle",rarity:"Legendary",description:"A divine chariot engulfed in harmless flames, traversing skies.",scope:"campaignSpecific",weight:500,cost:5e5,attunement:!0,userId:"user_042"},{name:"Treasure Chest of Endless Coin",type:"Treasure",rarity:"Unique",description:"Produces 10 gold coins a day, but never accumulates wealth.",scope:"global",weight:25,cost:1e7,attunement:!1,userId:"user_043"},{name:"Anvil of Creation",type:"Tool",rarity:"Artifact",description:"Can forge anything, even magical relics, at divine precision.",scope:"campaignSpecific",weight:200,cost:5e6,attunement:!0,userId:"user_044"},{name:"Stone of Dimension Crossing",type:"Wondrous Item",rarity:"Artifact",description:"Allows a single traveler to step between worlds unharmed.",scope:"campaignSpecific",weight:.5,cost:5e6,attunement:!0,userId:"user_045"},{name:"Heartstring Bow",type:"Weapon",rarity:"Rare",description:"The string hums softly with emotion, reacting to the wielder's resolve.",scope:"entitySpecific",weight:2,cost:5e3,attunement:!0,userId:"user_046"},{name:"Mask of Whispers",type:"Wondrous Item",rarity:"Rare",description:"Grants telepathic communication within 100 feet.",scope:"entitySpecific",weight:.5,cost:5e3,attunement:!0,userId:"user_047"},{name:"Crystal Wand of Frost",type:"Wand",rarity:"Rare",description:"Casts freezing magic, slowing enemies.",scope:"entitySpecific",weight:1,cost:5e3,attunement:!0,userId:"user_048"},{name:"Ring of Illusions",type:"Ring",rarity:"Uncommon",description:"Allows minor illusions at will.",scope:"global",weight:0,cost:500,attunement:!0,userId:"user_049"},{name:"Scroll of Meteor Swarm",type:"Scroll",rarity:"Legendary",description:"Contains the spell *Meteor Swarm*.",scope:"campaignSpecific",weight:.1,cost:5e5,attunement:!1,userId:"user_050"}];class aO{static async loadSampleCampaigns(e,t){const n=Cy.campaigns.map(r=>({name:r.name,description:r.description,worldSetting:r.worldSetting,isPublic:r.isPublic,dmId:t,createdAt:Date.now()}));return await e({campaigns:n,clerkId:t})}static async loadSampleCharacters(e,t){const n=c=>{const d=iy.filter(b=>b.isBaseAction===!0||b.category==="general").map(b=>b.name),h=iy.filter(b=>b.targetClass===c).map(b=>b.name),f=["Use an Object","Search","Ready","Cast a Spell"],m=["Attack","Dodge","Dash","Disengage","Help"],p=m.filter(b=>d.includes(b)).concat(d.filter(b=>!m.includes(b))).slice(0,5);if(p.length<5){const b=d.filter(v=>!p.includes(v));p.push(...b.slice(0,5-p.length))}let x;h.length>=2?x=h.slice(0,2):h.length===1?x=[...h,...f.slice(0,1)]:x=f.slice(0,2);const g=[...p,...x];return console.log(`Assigned actions for ${c}:`,{general:p,classSpecific:x,total:g.length}),g},r=(c,d)=>{var L,D,P,T,B,R;const h=[...lh.items,...r1],f=h.filter(O=>O.type==="Armor"||O.type==="Adventuring Gear"||O.type==="Wondrous Item"||O.type==="Ring"||O.type==="Tool"),m=h.filter(O=>O.type==="Weapon"&&!O.name.toLowerCase().includes("bow")&&!O.name.toLowerCase().includes("crossbow")&&!O.name.toLowerCase().includes("sling")),p=h.filter(O=>O.type==="Weapon"&&(O.name.toLowerCase().includes("bow")||O.name.toLowerCase().includes("crossbow")||O.name.toLowerCase().includes("sling"))),x=h.filter(O=>O.type==="Potion"),g=h.filter(O=>O.rarity==="Uncommon"||O.rarity==="Rare"||O.rarity==="Very Rare"||O.rarity==="Legendary"||O.rarity==="Artifact"||O.rarity==="Unique");let b=f.find(O=>O.type==="Armor")||f[0],v=m[0],y=p[0],w=g[0];c==="Wizard"||c==="Sorcerer"?(v=m.find(O=>O.type==="Staff")||v,w=g.find(O=>O.type==="Wand"||O.type==="Staff")||w,b=f.find(O=>O.type==="Armor"&&O.name!=="Plate Armor")||b):c==="Rogue"?(v=m.find(O=>O.name.includes("Dagger")||O.name.includes("Rapier")||O.name.includes("Shortsword"))||v,w=g.find(O=>O.name.includes("Cloak")||O.type==="Ring")||w,b=f.find(O=>O.type==="Armor"&&O.name!=="Plate Armor")||b):c==="Cleric"?(v=m.find(O=>O.name.includes("Mace")||O.name.includes("Hammer")||O.name.includes("Warhammer"))||v,w=g.find(O=>O.type==="Ring"||O.name.includes("Holy"))||w):c==="Fighter"||c==="Paladin"?(b=f.find(O=>O.type==="Armor")||b,v=m.find(O=>O.type==="Weapon"&&!O.name.includes("Staff"))||v,w=g.find(O=>O.type==="Ring"||O.name.includes("Sword"))||w):c==="Barbarian"?(v=m.find(O=>O.type==="Weapon"&&!O.name.includes("Staff"))||v,w=g.find(O=>O.type==="Ring"||O.name.includes("Belt"))||w):c==="Monk"&&(v=m.find(O=>O.type==="Weapon"&&(O.name.includes("Staff")||O.name.includes("Dagger")))||v,w=g.find(O=>O.type==="Ring"||O.name.includes("Belt"))||w,b=f.find(O=>O.type==="Adventuring Gear"||O.type==="Tool")||b),d>=5?w=g.find(O=>O.rarity==="Rare")||w:d>=3&&(w=g.find(O=>O.rarity==="Uncommon"||O.rarity==="Rare")||w);const S=x[0]||{name:"Potion of Healing"},j=[{itemId:b.name,quantity:1},{itemId:v.name,quantity:1},{itemId:y.name,quantity:1},{itemId:S.name,quantity:1},{itemId:w.name,quantity:1}];console.log(`Assigned equipment for ${c} (Level ${d}):`,{equipment:b.name,meleeWeapon:v.name,rangedWeapon:y.name,potion:S.name,magicalItem:w.name,inventoryCount:j.length});const A={chestwear:b.type==="Armor"?b.name:void 0,mainHand:v.name,offHand:void 0,accessories:w.type==="Ring"?[w.name]:[]},_=(b==null?void 0:b.armorClass)||0;return{inventory:{capacity:150,items:j},equipment:A,equipmentBonuses:{armorClass:_,abilityScores:{strength:((L=w==null?void 0:w.abilityModifiers)==null?void 0:L.strength)||0,dexterity:((D=w==null?void 0:w.abilityModifiers)==null?void 0:D.dexterity)||0,constitution:((P=w==null?void 0:w.abilityModifiers)==null?void 0:P.constitution)||0,intelligence:((T=w==null?void 0:w.abilityModifiers)==null?void 0:T.intelligence)||0,wisdom:((B=w==null?void 0:w.abilityModifiers)==null?void 0:B.wisdom)||0,charisma:((R=w==null?void 0:w.abilityModifiers)==null?void 0:R.charisma)||0}}}},a=oh.playerCharacters.map(c=>{var m;const d=r(c.class,c.level),h=n(c.class),f=c.abilityScores||{strength:10+c.abilityModifiers.strength,dexterity:10+c.abilityModifiers.dexterity,constitution:10+c.abilityModifiers.constitution,intelligence:10+c.abilityModifiers.intelligence,wisdom:10+c.abilityModifiers.wisdom,charisma:10+c.abilityModifiers.charisma};return{name:c.name,race:c.race,class:c.class,level:c.level,hitPoints:c.hitPoints,armorClass:c.armorClass,characterType:c.characterType==="PlayerCharacter"?"player":"npc",abilityScores:f,abilityModifiers:c.abilityModifiers,classes:c.classes||[{name:c.class,level:c.level,hitDie:"d8",features:((m=c.features)==null?void 0:m.map(p=>typeof p=="string"?p:p.name))||[]}],feats:c.feats||[],features:c.features||[],skills:[],savingThrows:[],proficiencies:[],background:"Acolyte",alignment:"Lawful Good",actions:h,experiencePoints:c.experiencePoints,proficiencyBonus:c.proficiencyBonus,...d}}),o=oh.npcs.map(c=>{var m;const d=r(c.class,c.level),h=n(c.class),f=c.abilityScores||{strength:10+c.abilityModifiers.strength,dexterity:10+c.abilityModifiers.dexterity,constitution:10+c.abilityModifiers.constitution,intelligence:10+c.abilityModifiers.intelligence,wisdom:10+c.abilityModifiers.wisdom,charisma:10+c.abilityModifiers.charisma};return{name:c.name,race:c.race,class:c.class,level:c.level,hitPoints:c.hitPoints,armorClass:c.armorClass,characterType:c.characterType==="NonPlayerCharacter"?"npc":"player",abilityScores:f,abilityModifiers:c.abilityModifiers,classes:c.classes||[{name:c.class,level:c.level,hitDie:"d8",features:((m=c.features)==null?void 0:m.map(p=>typeof p=="string"?p:p.name))||[]}],feats:c.feats||[],features:c.features||[],skills:[],savingThrows:[],proficiencies:[],background:"Commoner",alignment:"Neutral",actions:h,...d}}),l=[...a,...o];return await e({characters:l,clerkId:t})}static async loadSampleMonsters(e,t){const n=(o,l,c)=>{const d=iy.filter(v=>v.isBaseAction===!0||v.category==="general").map(v=>v.name),h=["Attack","Dash","Dodge"];let f=[];const m=h.filter(v=>d.includes(v));f.push(...m),o==="dragon"?(f.push("Multiattack","Bite","Claw"),c.toLowerCase().includes("red")&&f.push("Fire Breath")):o==="undead"?(f.push("Bite","Claw"),c.toLowerCase().includes("skeleton")&&f.push("Shortsword Attack","Shortbow Attack")):o==="humanoid"?c.toLowerCase().includes("goblin")?f.push("Scimitar Attack","Shortbow Attack"):c.toLowerCase().includes("orc")&&f.push("Greataxe Attack","Javelin Attack"):o==="monstrosity"?(f.push("Multiattack","Bite","Claw"),c.toLowerCase().includes("owlbear")&&f.push("Beak Attack")):o==="giant"?(f.push("Multiattack","Bite","Claw"),c.toLowerCase().includes("troll")&&f.push("Regeneration")):o==="aberration"&&(f.push("Eye Ray","Bite"),c.toLowerCase().includes("beholder")&&f.push("Antimagic Cone","Eye Ray")),(parseFloat(l)||0)>=5&&(f.push("Multiattack"),f.includes("Dodge")||f.push("Dodge"));const x=Math.max(0,5-f.length),g=d.filter(v=>!f.includes(v));f.push(...g.slice(0,x));const b=[...new Set(f)].slice(0,7);return console.log(`Assigned actions for ${c} (${o}, CR ${l}):`,{actions:b,total:b.length}),b},r=(o,l,c)=>{var j,A,k,_,L,D,P,T;const d=[...lh.items,...r1],h=parseFloat(l)||0,f=[],m={accessories:[]},p=d.filter(B=>B.type==="Weapon"),x=d.filter(B=>B.type==="Armor"),g=d.filter(B=>B.type==="Potion"),b=d.filter(B=>B.type==="Ring"),v=d.filter(B=>B.type==="Wondrous Item");if(o.toLowerCase()==="humanoid"){const B=x.find(M=>M.typeOfArmor==="Light"),R=x.find(M=>M.typeOfArmor==="Medium"),O=x.find(M=>M.typeOfArmor==="Heavy"),I=x.find(M=>M.typeOfArmor==="Shield"),U=c.toLowerCase();if(U.includes("goblin")||U.includes("kobold")){B&&(m.chestwear=B.name);const M=p.find(W=>W.name.toLowerCase().includes("shortsword")||W.name.toLowerCase().includes("short sword")),$=p.find(W=>W.name.toLowerCase().includes("scimitar"));m.mainHand=(M==null?void 0:M.name)||($==null?void 0:$.name)||((j=p[0])==null?void 0:j.name)}else if(U.includes("orc")||U.includes("bandit")){R&&(m.chestwear=R.name);const M=p.find(W=>W.name.toLowerCase().includes("greataxe")||W.name.toLowerCase().includes("great axe")),$=p.find(W=>W.name.toLowerCase().includes("longsword")||W.name.toLowerCase().includes("long sword"));m.mainHand=(M==null?void 0:M.name)||($==null?void 0:$.name)||((A=p[0])==null?void 0:A.name),I&&h>=1&&(m.offHand=I.name)}else if(U.includes("knight")||U.includes("guard")){O&&(m.chestwear=O.name),I&&(m.offHand=I.name);const M=p.find($=>$.name.toLowerCase().includes("longsword")||$.name.toLowerCase().includes("long sword"));m.mainHand=(M==null?void 0:M.name)||((k=p[0])==null?void 0:k.name)}else R&&(m.chestwear=R.name),m.mainHand=(_=p[0])==null?void 0:_.name,I&&h>=2&&(m.offHand=I.name);g.length>0&&f.push({itemId:g[0].name,quantity:Math.max(1,Math.floor(h)+1)})}else if(o.toLowerCase()==="undead"){const B=p.find(O=>O.name.toLowerCase().includes("longsword")||O.name.toLowerCase().includes("long sword")),R=p.find(O=>O.name.toLowerCase().includes("shortbow")||O.name.toLowerCase().includes("short bow"));c.toLowerCase().includes("skeleton")?(m.mainHand=(B==null?void 0:B.name)||((L=p[0])==null?void 0:L.name),R&&h>=1&&f.push({itemId:R.name,quantity:1})):m.mainHand=(D=p[0])==null?void 0:D.name}else if(o.toLowerCase()==="dragon")h>=10&&b.length>0&&m.accessories.push(b[0].name),h>=15&&v.length>0&&m.accessories.push(v[0].name);else if(o.toLowerCase()==="giant"){const B=p.find(O=>O.name.toLowerCase().includes("club")),R=p.find(O=>O.name.toLowerCase().includes("greatclub")||O.name.toLowerCase().includes("great club"));m.mainHand=(R==null?void 0:R.name)||(B==null?void 0:B.name)||((P=p[0])==null?void 0:P.name)}else m.mainHand=(T=p[0])==null?void 0:T.name;if(g.length>0&&h>=1&&f.push({itemId:g[0].name,quantity:Math.max(1,Math.floor(h))}),h>=5&&b.length>0){const B=b.filter(R=>!m.accessories.includes(R.name));B.length>0&&m.accessories.push(B[0].name)}return{inventory:{capacity:50+Math.floor(h)*10,items:f},equipment:m,equipmentBonuses:{armorClass:0,abilityScores:{strength:0,dexterity:0,constitution:0,intelligence:0,wisdom:0,charisma:0}}}},a=Sy.monsters.map(o=>{var f,m,p,x,g,b,v,y,w,S,j,A,k,_,L,D;const l=r(o.type,o.challengeRating,o.name),c=n(o.type,o.challengeRating,o.name),d=P=>!P||P.length===0?[]:P.map(T=>T.name||T),h=o.abilityScores||{strength:10+(((f=o.abilityModifiers)==null?void 0:f.strength)||0),dexterity:10+(((m=o.abilityModifiers)==null?void 0:m.dexterity)||0),constitution:10+(((p=o.abilityModifiers)==null?void 0:p.constitution)||0),intelligence:10+(((x=o.abilityModifiers)==null?void 0:x.intelligence)||0),wisdom:10+(((g=o.abilityModifiers)==null?void 0:g.wisdom)||0),charisma:10+(((b=o.abilityModifiers)==null?void 0:b.charisma)||0)};return{name:o.name,size:o.size,type:o.type,challengeRating:o.challengeRating,challengeRatingValue:parseFloat(o.challengeRating)||0,hitPoints:o.hitPoints,armorClass:o.armorClass,speed:{walk:o.speed.walk||"30 ft.",swim:o.speed.swim,fly:o.speed.fly,burrow:o.speed.burrow,climb:o.speed.climb},abilityScores:h,abilityModifiers:o.abilityModifiers,proficiencyBonus:Math.max(1,Math.floor((parseFloat(o.challengeRating)||0)/4)+2),senses:{passivePerception:10+o.abilityModifiers.wisdom,darkvision:(y=(v=o.traits)==null?void 0:v.find(P=>P.name.includes("Darkvision")))==null?void 0:y.description,blindsight:(S=(w=o.traits)==null?void 0:w.find(P=>P.name.includes("Blindsight")))==null?void 0:S.description,tremorsense:(A=(j=o.traits)==null?void 0:j.find(P=>P.name.includes("Tremorsense")))==null?void 0:A.description,truesight:(_=(k=o.traits)==null?void 0:k.find(P=>P.name.includes("Truesight")))==null?void 0:_.description},languages:((D=(L=o.traits)==null?void 0:L.find(P=>P.name==="Languages"))==null?void 0:D.description)||"Common",experiencePoints:Math.floor((parseFloat(o.challengeRating)||0)*100),alignment:"Neutral",hitDice:{count:Math.ceil(o.hitPoints/6),die:"d8"},traits:o.traits||[],actions:c,reactions:d(o.reactions),legendaryActions:d(o.legendaryActions),lairActions:d(o.lairActions),...l}});return await e({monsters:a,clerkId:t})}static async loadSampleItems(e,t){const n=lh.items.map(o=>({name:o.name,type:o.type==="Shield"?"Armor":o.type,rarity:o.rarity,description:o.description,weight:o.weight,cost:o.cost,damageRolls:o.damageRolls,effects:o.effects,attunement:o.attunement,abilityModifiers:o.abilityModifiers,armorClass:o.armorClass,scope:"global",typeOfArmor:o.type==="Armor"?"Heavy":void 0})),r=r1.map(o=>({name:o.name,type:o.type==="Shield"?"Armor":o.type,rarity:o.rarity,description:o.description,weight:o.weight,cost:o.cost,damageRolls:o.damageRolls,effects:o.effects,attunement:o.attunement,abilityModifiers:o.abilityModifiers,armorClass:o.armorClass,scope:o.scope||"global",typeOfArmor:o.typeOfArmor||(o.type==="Armor"?"Heavy":void 0),durability:o.durability})),a=[...n,...r];return await e({items:a,clerkId:t})}static async loadSampleQuests(e,t){const n=jy.quests.map(r=>({name:r.name,description:r.description,status:r.status,completionXP:r.completionXP,rewards:r.rewards,taskIds:[],createdAt:Date.now()}));return await e({quests:n,clerkId:t})}static async loadSampleActions(e,t){const n=l=>JSON.stringify({name:l.name,description:l.description,actionCost:l.actionCost,type:l.type,requiresConcentration:l.requiresConcentration,sourceBook:l.sourceBook,attackBonusAbilityScore:l.attackBonusAbilityScore,isProficient:l.isProficient,damageRolls:l.damageRolls,className:l.className||l.requiredClass,usesPer:l.usesPer,maxUses:l.maxUses,category:l.category,tags:l.tags,requiredLevel:l.requiredLevel,spellLevel:l.spellLevel,isBaseAction:l.isBaseAction,targetClass:l.targetClass}),r=[...ed.generalActions.map(l=>({name:l.name,description:l.description,actionCost:l.actionCost,type:l.type,requiresConcentration:l.requiresConcentration,sourceBook:l.sourceBook,attackBonusAbilityScore:l.attackBonusAbilityScore||void 0,isProficient:l.isProficient||void 0,damageRolls:l.damageRolls||void 0,className:l.className||void 0,usesPer:l.usesPer,maxUses:l.maxUses||void 0,category:"general"})),...Object.entries(ed.classActions).flatMap(([l,c])=>c.map(d=>({name:d.name,description:d.description,actionCost:d.actionCost,type:d.type,requiresConcentration:d.requiresConcentration,sourceBook:d.sourceBook,attackBonusAbilityScore:d.attackBonusAbilityScore||void 0,isProficient:d.isProficient||void 0,damageRolls:d.damageRolls||void 0,className:l,targetClass:l,usesPer:d.usesPer,maxUses:d.maxUses||void 0,category:"class_specific"}))),...ed.monsterActions.map(l=>({name:l.name,description:l.description,actionCost:l.actionCost,type:l.type,requiresConcentration:l.requiresConcentration,sourceBook:l.sourceBook,attackBonusAbilityScore:l.attackBonusAbilityScore||void 0,isProficient:l.isProficient||void 0,damageRolls:l.damageRolls||void 0,className:l.className||void 0,usesPer:l.usesPer,maxUses:l.maxUses||void 0,category:"general"})),...iy.map(l=>({name:l.name,description:l.description,actionCost:l.actionCost,type:l.type,requiresConcentration:l.requiresConcentration,sourceBook:l.sourceBook,attackBonusAbilityScore:l.attackBonusAbilityScore||void 0,isProficient:l.isProficient||void 0,damageRolls:l.damageRolls||void 0,className:l.requiredClass||void 0,usesPer:l.usesPer,maxUses:l.maxUses||void 0,category:l.category||"general",tags:l.tags||void 0,requiredLevel:l.requiredLevel||void 0,spellLevel:l.spellLevel||void 0,isBaseAction:l.isBaseAction||void 0,targetClass:l.targetClass||void 0}))],a=new Set,o=r.filter(l=>{const c=n(l);return a.has(c)?(console.log(`Skipping duplicate action: ${l.name}`),!1):(a.add(c),!0)});return console.log(`Loaded ${o.length} unique actions (${r.length-o.length} duplicates removed)`),await e({actions:o,clerkId:t})}static async deleteAllSampleData(e,t){return await e({clerkId:t})}static async loadSampleData(e,t,n){switch(e){case"campaigns":return await this.loadSampleCampaigns(t,n);case"characters":return await this.loadSampleCharacters(t,n);case"monsters":return await this.loadSampleMonsters(t,n);case"items":return await this.loadSampleItems(t,n);case"quests":return await this.loadSampleQuests(t,n);case"actions":return await this.loadSampleActions(t,n);case"maps":return await this.loadSampleMaps(t,n);default:throw new Error(`Unknown entity type: ${e}`)}}static async loadSampleMaps(e,t){const n=n1.maps.map(r=>({name:r.name,cols:r.width,rows:r.height,cellSize:r.cellSize,scenario:r.scenario,difficulty:r.difficulty,encounterLevel:r.encounterLevel,terrain:r.terrain,enemies:r.enemies,allies:r.allies}));return await e({maps:n,clerkId:t})}static getSampleDataInfo(){const e=Object.values(ed.classActions).reduce((t,n)=>t+n.length,0);return{campaigns:{version:Cy.version,description:Cy.description,count:Cy.campaigns.length},characters:{version:oh.version,description:oh.description,count:oh.playerCharacters.length+oh.npcs.length},monsters:{version:Sy.version,description:Sy.description,count:Sy.monsters.length},items:{version:lh.version,description:lh.description,count:lh.items.length+r1.length},quests:{version:jy.version,description:jy.description,count:jy.quests.length},actions:{version:ed.version,description:ed.description,count:ed.generalActions.length+e+ed.monsterActions.length+iy.length},maps:{version:n1.version,description:n1.description,count:n1.maps.length}}}}function bde(){var t;const{user:s,isSignedIn:e}=Wc();return!s||!e?null:{id:s.id,email:((t=s.emailAddresses[0])==null?void 0:t.emailAddress)||"",firstName:s.firstName||void 0,lastName:s.lastName||void 0,imageUrl:s.imageUrl||void 0,isSignedIn:!0}}function cw(){return Fe(re.users.getCurrentUser)}function wde(){const s=bde(),e=cw(),{isSignedIn:t,isLoaded:n}=Ji();return{clerkUser:s,databaseUser:e,isLoading:!n||e===void 0,isSignedIn:t||!1}}function Cde(){const{user:s,isSignedIn:e}=Wc(),t=Re(re.users.upsertUser);C.useEffect(()=>{e&&s&&(async()=>{var r;try{await t({clerkId:s.id,email:((r=s.emailAddresses[0])==null?void 0:r.emailAddress)||"",firstName:s.firstName||void 0,lastName:s.lastName||void 0,imageUrl:s.imageUrl||void 0})}catch(a){console.error("Failed to sync user with database:",a)}})()},[e,s,t])}const oO="user_2z9b8vd97dQR6ddsQwYI9y7yi72";function Zu({entityType:s,onDataLoaded:e}){const[t,n]=C.useState(!1),[r,a]=C.useState(null),[o,l]=C.useState(null),[c,d]=C.useState(!1),{isSignedIn:h,isLoading:f,clerkUser:m}=wde(),p=Re(re.sampleData.loadSampleCampaigns),x=Re(re.sampleData.loadSampleCharacters),g=Re(re.sampleData.loadSampleMonsters),b=Re(re.sampleData.loadSampleItems),v=Re(re.sampleData.loadSampleQuests),y=Re(re.sampleData.loadSampleActions),w=Re(re.sampleData.loadSampleMaps),S=Re(re.sampleData.deleteAllSampleCampaigns),j=Re(re.sampleData.deleteAllSampleCharacters),A=Re(re.sampleData.deleteAllSampleMonsters),k=Re(re.sampleData.deleteAllSampleItems),_=Re(re.sampleData.deleteAllSampleQuests),L=Re(re.sampleData.deleteAllSampleActions),D=Re(re.sampleData.deleteAllSampleMaps),T=aO.getSampleDataInfo()[s],B=async()=>{if(!m){a("User not authenticated");return}n(!0),a(null),l(null);try{let O;switch(s){case"campaigns":O=p;break;case"characters":O=x;break;case"monsters":O=g;break;case"items":O=b;break;case"quests":O=v;break;case"actions":O=y;break;case"maps":O=w;break;default:throw new Error(`Unknown entity type: ${s}`)}const I=await aO.loadSampleData(s,O,oO);l(`Sample ${s} loaded successfully! (${T.count} items)`),e==null||e()}catch(O){a(O instanceof Error?O.message:"Failed to load sample data")}finally{n(!1)}},R=async()=>{if(!m){a("User not authenticated");return}if(confirm(`Are you sure you want to delete all ${s}? This action cannot be undone.`)){n(!0),a(null),l(null);try{let O;switch(s){case"campaigns":O=S;break;case"characters":O=j;break;case"monsters":O=A;break;case"items":O=k;break;case"quests":O=_;break;case"actions":O=L;break;case"maps":O=D;break;default:throw new Error(`Unknown entity type: ${s}`)}const I=await O({clerkId:oO});l(`All ${s} deleted successfully! (${I.deleted} items)`),e==null||e()}catch(O){a(O instanceof Error?O.message:"Failed to delete data")}finally{n(!1)}}};return i.jsxs(oe,{className:"mb-6",children:[i.jsx(ke,{className:"cursor-pointer",onClick:()=>d(!c),children:i.jsxs(Ne,{className:"flex items-center justify-between gap-2",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(nL,{className:"h-5 w-5"}),"Sample Data Management"]}),i.jsx(q,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:O=>{O.stopPropagation(),d(!c)},children:c?i.jsx(tM,{className:"h-4 w-4"}):i.jsx(v$,{className:"h-4 w-4"})})]})}),!c&&i.jsxs(he,{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[i.jsx(ok,{className:"h-4 w-4"}),i.jsx("span",{children:T.description}),i.jsxs(ue,{variant:"outline",children:["v",T.version]})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(q,{onClick:B,disabled:t||!h||f,className:"flex items-center gap-2",children:[t?i.jsx(Ss,{className:"h-4 w-4 animate-spin"}):i.jsx(nL,{className:"h-4 w-4"}),"Load ",T.count," Sample ",s.charAt(0).toUpperCase()+s.slice(1)]}),i.jsxs(q,{variant:"destructive",onClick:R,disabled:t||!h||f,className:"flex items-center gap-2",children:[t?i.jsx(Ss,{className:"h-4 w-4 animate-spin"}):i.jsx(kx,{className:"h-4 w-4"}),"Delete All ",s.charAt(0).toUpperCase()+s.slice(1)]})]}),r&&i.jsx(ur,{variant:"destructive",children:i.jsx(hr,{children:r})}),o&&i.jsx(ur,{children:i.jsx(hr,{children:o})})]})]})}function Sde(){const{databaseUser:s}=Sk(),e=Re(re.users.ensureAdminRole),t=async()=>{try{await e(),window.location.reload()}catch(n){console.error("Failed to make admin:",n)}};return!s||s.role==="admin"?null:i.jsxs(oe,{className:"mb-4 border-yellow-200 bg-yellow-50",children:[i.jsx(ke,{children:i.jsx(Ne,{className:"text-yellow-800",children:"Admin Setup"})}),i.jsxs(he,{children:[i.jsx("p",{className:"text-yellow-700 mb-4",children:"You are currently a regular user. As the app creator, you may want to upgrade to admin role for full access."}),i.jsx(q,{onClick:t,variant:"outline",children:"Make Me Admin"})]})]})}function jde(){const s=Fe(re.campaigns.getCampaigns),e=Fe(re.campaigns.getMyCampaigns),[t,n]=C.useState(!1),[r,a]=C.useState("create"),[o,l]=C.useState(null),c=m=>{const p=[...e||[],...s||[]].find(x=>x._id===m);p&&(l(p),a("read"),n(!0))},d=m=>{const p=e==null?void 0:e.find(x=>x._id===m);p&&(l(p),a("edit"),n(!0))},h=()=>{l(null),a("create"),n(!0)},f=()=>{};return i.jsxs("div",{className:"container mx-auto py-6",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-3xl font-bold",children:"Campaigns"}),i.jsx("p",{className:"text-muted-foreground",children:"Manage your D&D campaigns and join others"})]}),i.jsx(Rr,{children:i.jsxs(q,{onClick:h,children:[i.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Create Campaign"]})})]}),i.jsx(Yu,{children:i.jsxs(oe,{children:[i.jsx(ke,{children:i.jsx(Ne,{children:"Sign in to view campaigns"})}),i.jsx(he,{children:i.jsx("p",{className:"text-muted-foreground",children:"Please sign in to view and manage your D&D campaigns."})})]})}),i.jsxs(Rr,{children:[i.jsx(Sde,{}),i.jsx(Zu,{entityType:"campaigns",onDataLoaded:()=>{}}),i.jsxs("div",{className:"mb-8",children:[i.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"My Campaigns"}),e===void 0?i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(3)].map((m,p)=>i.jsx("div",{className:"h-48 bg-muted animate-pulse rounded-lg"},p))}):e.length===0?i.jsx(oe,{children:i.jsxs(he,{className:"flex flex-col items-center justify-center py-12",children:[i.jsx("p",{className:"text-muted-foreground mb-4",children:"You haven't created any campaigns yet."}),i.jsxs(q,{onClick:h,children:[i.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Create Your First Campaign"]})]})}):i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:e.map(m=>i.jsx(cL,{campaign:m,dmName:"You",onView:c,onEdit:d,canEdit:!0},m._id))})]}),i.jsxs("div",{children:[i.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Public Campaigns"}),s===void 0?i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(6)].map((m,p)=>i.jsx("div",{className:"h-48 bg-muted animate-pulse rounded-lg"},p))}):s.length===0?i.jsx(oe,{children:i.jsx(he,{className:"flex flex-col items-center justify-center py-12",children:i.jsx("p",{className:"text-muted-foreground",children:"No public campaigns available."})})}):i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.filter(m=>m.isPublic).map(m=>i.jsx(cL,{campaign:m,dmName:"DM",onView:c,canEdit:!1},m._id))})]})]}),i.jsx(Gce,{open:t,onOpenChange:n,mode:r,campaign:o,onSuccess:f})]})}function xu(s,...e){const{handleAuthError:t}=sw();return Fe(s,...e)}function hz(s){const{handleAuthError:e}=sw(),t=Re(s);return C.useCallback(async(...r)=>{try{return await t(...r)}catch(a){throw e(a),a}},[t,e])}function kde({character:s,onView:e,onEdit:t,onClone:n,canEdit:r=!1,canClone:a=!1}){const o=Re(re.characters.cloneCharacter),l=async()=>{try{await o({characterId:s._id}),rt.success(`${s.name} cloned successfully!`),n==null||n()}catch(h){console.error("Failed to clone character:",h),rt.error("Failed to clone character")}},c=s.characterType==="player",d=s.speed||"30 ft.";return i.jsxs(oe,{className:"hover:shadow-md transition-shadow cursor-pointer",children:[i.jsx(ke,{className:"pb-3",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{children:[i.jsx(Ne,{className:"text-lg line-clamp-1",children:s.name}),i.jsxs("p",{className:"text-sm text-muted-foreground",children:["Level ",s.level," ",s.race," ",s.class]})]}),i.jsxs("div",{className:"flex flex-col items-end gap-1",children:[i.jsx(ue,{variant:c?"level":"secondary",className:"shrink-0",children:c?"PC":"NPC"}),s.experiencePoints!==void 0&&i.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.experiencePoints," XP"]})]})]})}),i.jsxs(he,{className:"space-y-3",children:[i.jsxs("div",{className:"grid grid-cols-3 gap-3 text-sm",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(nM,{className:"h-4 w-4 text-red-500"}),i.jsx("span",{className:"font-medium",children:s.hitPoints}),i.jsx("span",{className:"text-muted-foreground",children:"HP"})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(Dr,{className:"h-4 w-4 text-blue-500"}),i.jsx("span",{className:"font-medium",children:s.armorClass}),i.jsx("span",{className:"text-muted-foreground",children:"AC"})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(Da,{className:"h-4 w-4 text-yellow-500"}),i.jsx("span",{className:"font-medium",children:d})]})]}),s.proficiencyBonus&&i.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[i.jsx(cM,{className:"h-4 w-4 text-purple-500"}),i.jsx("span",{className:"text-muted-foreground",children:"Proficiency:"}),i.jsx("span",{className:"font-medium",children:lr(s.proficiencyBonus)})]}),s.abilityModifiers&&i.jsxs("div",{className:"grid grid-cols-6 gap-1 text-xs",children:[i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-muted-foreground",children:"STR"}),i.jsx("div",{className:"font-medium",children:lr(s.abilityModifiers.strength)})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-muted-foreground",children:"DEX"}),i.jsx("div",{className:"font-medium",children:lr(s.abilityModifiers.dexterity)})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-muted-foreground",children:"CON"}),i.jsx("div",{className:"font-medium",children:lr(s.abilityModifiers.constitution)})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-muted-foreground",children:"INT"}),i.jsx("div",{className:"font-medium",children:lr(s.abilityModifiers.intelligence)})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-muted-foreground",children:"WIS"}),i.jsx("div",{className:"font-medium",children:lr(s.abilityModifiers.wisdom)})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-muted-foreground",children:"CHA"}),i.jsx("div",{className:"font-medium",children:lr(s.abilityModifiers.charisma)})]})]}),i.jsxs("div",{className:"flex gap-2 pt-2",children:[i.jsx(q,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>e==null?void 0:e(s._id),children:"View Sheet"}),r&&i.jsx(q,{size:"sm",className:"flex-1",onClick:()=>t==null?void 0:t(s._id),children:"Edit"}),a&&i.jsx(q,{variant:"outline",size:"sm",onClick:l,className:"px-3",children:i.jsx(w$,{className:"h-4 w-4"})})]})]})]})}const Nde={Artificer:"d8",Barbarian:"d12",Bard:"d8",Cleric:"d8",Druid:"d8",Fighter:"d10",Monk:"d8",Paladin:"d10",Ranger:"d10",Rogue:"d8",Sorcerer:"d6",Warlock:"d8",Wizard:"d6"},fz={Artificer:"Intelligence",Bard:"Charisma",Cleric:"Wisdom",Druid:"Wisdom",Paladin:"Charisma",Ranger:"Wisdom",Sorcerer:"Charisma",Warlock:"Charisma",Wizard:"Intelligence"},Tp=Ze({strength:le().int().min(1).max(30),dexterity:le().int().min(1).max(30),constitution:le().int().min(1).max(30),intelligence:le().int().min(1).max(30),wisdom:le().int().min(1).max(30),charisma:le().int().min(1).max(30)}),mz=Ze({name:X().min(1),level:le().int().min(1).max(20),hitDie:Vt(["d6","d8","d10","d12"]),features:Ae(X()).optional(),subclass:X().optional()}),pz=Ze({die:Vt(["d6","d8","d10","d12"]),current:le().int().min(0),max:le().int().min(0)}),gz=Ze({skill:X(),proficient:Tn(),expertise:Tn().optional(),source:X().optional()}),xz=Ze({ability:X(),proficient:Tn(),source:X().optional()}),yz=Ze({name:X().min(1),description:X().min(1)}),vz=Ze({name:X().min(1),description:X().min(1),source:X().min(1),uses:Ze({current:le().int().min(0),max:le().int().min(0),resetOn:Vt(["short_rest","long_rest","dawn"])}).optional()}),bz=Ze({name:X().min(1),description:X().min(1)}),wz=Ze({level:le().int().min(1).max(9),total:le().int().min(0),used:le().int().min(0)}),Cz=Ze({walking:le().int().min(0).optional(),swimming:le().int().min(0).optional(),flying:le().int().min(0).optional(),climbing:le().int().min(0).optional(),burrowing:le().int().min(0).optional()}),Sz=Ze({headgear:X().optional(),armwear:X().optional(),chestwear:X().optional(),legwear:X().optional(),footwear:X().optional(),mainHand:X().optional(),offHand:X().optional(),accessories:Ae(X()).optional()}),jz=Ze({name:X().min(1),quantity:le().int().min(1),description:X().optional(),weight:le().min(0).optional(),value:le().min(0).optional()}),kz=Ze({successes:le().int().min(0).max(3),failures:le().int().min(0).max(3)}),Ade=Ze({name:X().min(2).max(100),race:X().min(1),subrace:X().optional(),classes:Ae(mz).min(1),background:X().min(1),alignment:X().optional(),level:le().int().min(1).max(20),experiencePoints:le().int().min(0),abilityScores:Tp,baseAbilityScores:Tp.optional(),racialAbilityScoreImprovements:Tp.optional(),hitPoints:le().int().min(1),maxHitPoints:le().int().min(1).optional(),currentHitPoints:le().int().min(0).optional(),tempHitPoints:le().int().min(0).optional(),hitDice:Ae(pz).optional(),armorClass:le().int().min(1).max(30),baseArmorClass:le().int().min(1).max(30).optional(),skills:Ae(X()),skillProficiencies:Ae(gz).optional(),savingThrows:Ae(X()),savingThrowProficiencies:Ae(xz).optional(),proficiencies:Ae(X()),weaponProficiencies:Ae(X()).optional(),armorProficiencies:Ae(X()).optional(),toolProficiencies:Ae(X()).optional(),traits:Ae(X()).optional(),racialTraits:Ae(yz).optional(),features:Ae(vz).optional(),feats:Ae(bz).optional(),languages:Ae(X()).optional(),speed:X().optional(),speeds:Cz.optional(),initiative:le().optional(),passivePerception:le().int().min(0).optional(),passiveInvestigation:le().int().min(0).optional(),passiveInsight:le().int().min(0).optional(),spellcastingAbility:Vt(["Intelligence","Wisdom","Charisma"]).optional(),spellSaveDC:le().int().min(8).max(30).optional(),spellAttackBonus:le().int().optional(),spellSlots:Ae(wz).optional(),spellsKnown:Ae(X()).optional(),cantripsKnown:Ae(X()).optional(),inspiration:Tn().optional(),deathSaves:kz.optional(),equipment:Sz.optional(),inventory:Ae(jz).optional(),importSource:Vt(["dnd_beyond","json","pdf","manual"]).optional(),originalData:vM().optional()});Ze({name:X().min(2).max(100),race:X().min(1),class:X().min(1),background:X().min(1),alignment:X().optional(),level:le().int().min(1).max(20),abilityScores:Tp,hitPoints:le().int().min(1),armorClass:le().int().min(1).max(30),speed:X().optional(),skills:Ae(X()),savingThrows:Ae(X()),proficiencies:Ae(X()),subrace:X().optional(),classes:Ae(mz).optional(),baseAbilityScores:Tp.optional(),racialAbilityScoreImprovements:Tp.optional(),maxHitPoints:le().int().min(1).optional(),currentHitPoints:le().int().min(0).optional(),tempHitPoints:le().int().min(0).optional(),hitDice:Ae(pz).optional(),baseArmorClass:le().int().min(1).max(30).optional(),skillProficiencies:Ae(gz).optional(),savingThrowProficiencies:Ae(xz).optional(),weaponProficiencies:Ae(X()).optional(),armorProficiencies:Ae(X()).optional(),toolProficiencies:Ae(X()).optional(),traits:Ae(X()).optional(),racialTraits:Ae(yz).optional(),features:Ae(vz).optional(),feats:Ae(bz).optional(),languages:Ae(X()).optional(),speeds:Cz.optional(),initiative:le().optional(),passivePerception:le().int().min(0).optional(),passiveInvestigation:le().int().min(0).optional(),passiveInsight:le().int().min(0).optional(),spellcastingAbility:Vt(["Intelligence","Wisdom","Charisma"]).optional(),spellSaveDC:le().int().min(8).max(30).optional(),spellAttackBonus:le().int().optional(),spellSlots:Ae(wz).optional(),spellsKnown:Ae(X()).optional(),cantripsKnown:Ae(X()).optional(),inspiration:Tn().optional(),deathSaves:kz.optional(),equipment:Sz.optional(),inventory:Ae(jz).optional(),importedFrom:X().optional(),importData:vM().optional()});class ul extends Error{constructor(e,t){super(e),this.field=t,this.name="CharacterImportError"}}function Dm(s){return Math.floor((s-10)/2)}function _de(s){return Math.ceil(s/4)+1}function Tde(s,e){return 8+s+e}function Ede(s,e){return s+e}function MM(s){return Nde[s]||"d8"}function Pde(s){return fz[s]}function Mde(s,e,t){return 10+s+(t?e:0)}function Ide(s,e,t){return 10+s+(t?e:0)}function Rde(s,e,t){return 10+s+(t?e:0)}function IM(s){return s.reduce((e,t)=>e+t.level,0)}function RM(s){const e=new Map;return s.forEach(t=>{const n=MM(t.name),r=e.get(n)||0;e.set(n,r+t.level)}),Array.from(e.entries()).map(([t,n])=>({die:t,current:n,max:n}))}function Nz(s){try{const e=Dde(s);return Ade.parse(e)}catch(e){throw e instanceof Error?new ul(`Failed to parse JSON character data: ${e.message}`):new ul("Failed to parse JSON character data: Unknown error")}}function Dde(s){var e,t,n,r;return s.name&&s.classes&&Array.isArray(s.classes)&&((t=(e=s.classes[0])==null?void 0:e.definition)!=null&&t.name)?Lde(s):s.name&&s.classes&&Array.isArray(s.classes)&&((n=s.classes[0])!=null&&n.name)&&((r=s.classes[0])!=null&&r.level)?s:s.name&&s.class&&!s.classes?Ode(s):s}function Lde(s){var o,l,c,d,h,f,m,p,x,g,b,v,y,w,S,j,A,k,_,L,D,P,T,B,R,O,I,U,M;const e={strength:((l=(o=s.stats)==null?void 0:o[0])==null?void 0:l.value)||s.strength||10,dexterity:((d=(c=s.stats)==null?void 0:c[1])==null?void 0:d.value)||s.dexterity||10,constitution:((f=(h=s.stats)==null?void 0:h[2])==null?void 0:f.value)||s.constitution||10,intelligence:((p=(m=s.stats)==null?void 0:m[3])==null?void 0:p.value)||s.intelligence||10,wisdom:((g=(x=s.stats)==null?void 0:x[4])==null?void 0:g.value)||s.wisdom||10,charisma:((v=(b=s.stats)==null?void 0:b[5])==null?void 0:v.value)||s.charisma||10},t=((y=s.classes)==null?void 0:y.map($=>{var W,ee,Z,z;return{name:((W=$.definition)==null?void 0:W.name)||$.name,level:$.level||1,hitDie:MM(((ee=$.definition)==null?void 0:ee.name)||$.name),subclass:((Z=$.subclassDefinition)==null?void 0:Z.name)||$.subclass,features:((z=$.classFeatures)==null?void 0:z.map(se=>{var de;return((de=se.definition)==null?void 0:de.name)||se.name}))||[]}}))||[],n=IM(t),r=((S=(w=s.modifiers)==null?void 0:w.filter($=>$.type==="proficiency"&&$.subType==="ability-check"))==null?void 0:S.map($=>$.friendlySubtypeName))||[],a=((A=(j=s.modifiers)==null?void 0:j.filter($=>$.type==="proficiency"&&$.subType==="saving-throws"))==null?void 0:A.map($=>$.friendlySubtypeName))||[];return{name:s.name,race:((k=s.race)==null?void 0:k.fullName)||((_=s.race)==null?void 0:_.baseName)||"Human",subrace:(L=s.race)==null?void 0:L.subRaceShortName,classes:t,background:((P=(D=s.background)==null?void 0:D.definition)==null?void 0:P.name)||((T=s.background)==null?void 0:T.name)||"Folk Hero",alignment:s.alignmentId?Fde(s.alignmentId):void 0,level:n,experiencePoints:s.currentXp||0,abilityScores:e,hitPoints:s.baseHitPoints||s.hitPoints||1,maxHitPoints:s.baseHitPoints||s.hitPoints||1,currentHitPoints:s.hitPoints||s.baseHitPoints||1,armorClass:s.armorClass||10,skills:r,savingThrows:a,proficiencies:[],speed:`${((O=(R=(B=s.race)==null?void 0:B.weightSpeeds)==null?void 0:R.normal)==null?void 0:O.walk)||30} ft.`,hitDice:RM(t),languages:((I=s.languages)==null?void 0:I.map($=>{var W;return((W=$.definition)==null?void 0:W.name)||$.name}))||[],traits:((U=s.traits)==null?void 0:U.map($=>{var W;return((W=$.definition)==null?void 0:W.name)||$.name}))||[],features:((M=s.classFeatures)==null?void 0:M.map($=>{var W,ee;return{name:((W=$.definition)==null?void 0:W.name)||$.name,description:((ee=$.definition)==null?void 0:ee.description)||$.description||"",source:"class"}}))||[],importSource:"dnd_beyond",originalData:s}}function Ode(s){var t,n,r,a,o,l;const e=s.classes||[{name:s.class,level:s.level||1,hitDie:MM(s.class),subclass:s.subclass}];return{name:s.name,race:s.race,subrace:s.subrace,classes:e,background:s.background,alignment:s.alignment,level:s.level||IM(e),experiencePoints:s.experiencePoints||s.xp||0,abilityScores:{strength:((t=s.abilityScores)==null?void 0:t.strength)||s.strength||10,dexterity:((n=s.abilityScores)==null?void 0:n.dexterity)||s.dexterity||10,constitution:((r=s.abilityScores)==null?void 0:r.constitution)||s.constitution||10,intelligence:((a=s.abilityScores)==null?void 0:a.intelligence)||s.intelligence||10,wisdom:((o=s.abilityScores)==null?void 0:o.wisdom)||s.wisdom||10,charisma:((l=s.abilityScores)==null?void 0:l.charisma)||s.charisma||10},hitPoints:s.hitPoints||s.hp||1,maxHitPoints:s.maxHitPoints||s.maxHp||s.hitPoints||s.hp||1,currentHitPoints:s.currentHitPoints||s.currentHp||s.hitPoints||s.hp||1,armorClass:s.armorClass||s.ac||10,skills:s.skills||[],savingThrows:s.savingThrows||[],proficiencies:s.proficiencies||[],speed:s.speed,languages:s.languages||[],traits:s.traits||[],hitDice:s.hitDice||RM(e),importSource:"json",originalData:s}}function Fde(s){return{1:"Lawful Good",2:"Neutral Good",3:"Chaotic Good",4:"Lawful Neutral",5:"True Neutral",6:"Chaotic Neutral",7:"Lawful Evil",8:"Neutral Evil",9:"Chaotic Evil"}[s]||"True Neutral"}function lO(s){var d,h;const e=IM(s.classes),t=_de(e),n={strength:Dm(s.abilityScores.strength),dexterity:Dm(s.abilityScores.dexterity),constitution:Dm(s.abilityScores.constitution),intelligence:Dm(s.abilityScores.intelligence),wisdom:Dm(s.abilityScores.wisdom),charisma:Dm(s.abilityScores.charisma)},r=s.skills.includes("Perception"),a=s.skills.includes("Investigation"),o=s.skills.includes("Insight"),l={...s,level:e,passivePerception:s.passivePerception||Mde(n.wisdom,t,r),passiveInvestigation:s.passiveInvestigation||Ide(n.intelligence,t,a),passiveInsight:s.passiveInsight||Rde(n.wisdom,t,o),initiative:s.initiative||n.dexterity,hitDice:s.hitDice||RM(s.classes)},c=s.classes.filter(f=>fz[f.name]);if(c.length>0&&!s.spellcastingAbility){const f=c[0],m=Pde(f.name);if(m){const p=m.toLowerCase(),x=n[p];l.spellcastingAbility=m,l.spellSaveDC=s.spellSaveDC||Tde(x,t),l.spellAttackBonus=s.spellAttackBonus||Ede(x,t)}}if((d=s.originalData)!=null&&d.parsedEquipment){const f=Bde(s.originalData.parsedEquipment);l.equipment=f.equipment,l.inventory=f.inventory.items.map(m=>({name:m.itemId,quantity:m.quantity,description:"Imported from character sheet",weight:0,value:0}))}if((h=s.originalData)!=null&&h.parsedActions){const f=$de(s.originalData.parsedActions),m=l.features||[],p=f.actions.map(x=>({name:x,description:"Imported action from character sheet",source:"character_import"}));if(l.features=[...m,...p],f.weaponProficiencies.length>0&&(l.weaponProficiencies=[...l.weaponProficiencies||[],...f.weaponProficiencies]),f.combatNotes){const x=l.notes||"";l.notes=x?`${x}

Combat Actions:
${f.combatNotes}`:`Combat Actions:
${f.combatNotes}`}}return l}async function Az(s){const e=s.type,t=s.name.toLowerCase();try{if(e==="application/json"||t.endsWith(".json")){const n=await s.text(),r=JSON.parse(n);return Nz(r)}if(e==="application/pdf"||t.endsWith(".pdf")){const n=new Worker(new URL("/assets/parseWorker-vIgX5ZzT.js",import.meta.url),{type:"module"}),r=await s.arrayBuffer(),a=await new Promise((m,p)=>{const x=g=>{const b=g.data;!b||!b.type||b.type!=="progress"&&b.type==="result"&&(n.removeEventListener("message",x),n.terminate(),b.ok?m(b.parsed):p(new ul(b.error)))};n.addEventListener("message",x),n.postMessage({type:"parse",fileBuffer:r,fileName:t,fileSize:s.size,ocrAllowed:!0})}),{confidence:o,parseLog:l,uncapturedData:c,parsedEquipment:d,parsedActions:h,...f}=a;return f.originalData||(f.originalData={}),f.originalData.confidence=o,f.originalData.parseLog=l,f.originalData.uncapturedData=c,f.originalData.parsedEquipment=d,f.originalData.parsedActions=h,f}throw e==="text/plain"||t.endsWith(".txt")?new ul("Text file import is not yet supported. Please use JSON format or manual entry."):new ul(`Unsupported file type: ${e}`)}catch(n){throw n instanceof ul?n:new ul(`Failed to parse character file: ${n instanceof Error?n.message:"Unknown error"}`)}}function Bde(s){var n;const e=s.inventory.map(r=>({itemId:Ml(r.name,r.type),quantity:r.quantity})),t={headgear:s.equipment.headgear?Ml(s.equipment.headgear,"armor"):void 0,armwear:s.equipment.armwear?Ml(s.equipment.armwear,"armor"):void 0,chestwear:s.equipment.chestwear?Ml(s.equipment.chestwear,"armor"):void 0,legwear:s.equipment.legwear?Ml(s.equipment.legwear,"armor"):void 0,footwear:s.equipment.footwear?Ml(s.equipment.footwear,"armor"):void 0,mainHand:s.equipment.mainHand?Ml(s.equipment.mainHand,"weapon"):void 0,offHand:s.equipment.offHand?Ml(s.equipment.offHand,"weapon"):void 0,accessories:((n=s.equipment.accessories)==null?void 0:n.map(r=>Ml(r,"gear")))||[]};return{inventory:{capacity:Ude(s.inventory),items:e},equipment:t}}function $de(s){const e=[...s.weaponAttacks.map(r=>r.name),...s.spellAttacks.map(r=>r.name),...s.featureActions.map(r=>r.name)],t=s.weaponAttacks.map(r=>zde(r.name)).filter((r,a,o)=>o.indexOf(r)===a),n=Hde(s);return{actions:e,weaponProficiencies:t,combatNotes:n}}function Ml(s,e){return`item_${s.toLowerCase().replace(/\s+/g,"_")}_${e}`}function Ude(s){const t=s.reduce((n,r)=>n+r.quantity,0);return Math.max(100,t*10)}function zde(s){const e=s.toLowerCase();return e.includes("sword")?"Sword":e.includes("axe")?"Axe":e.includes("hammer")?"Hammer":e.includes("bow")?"Bow":e.includes("crossbow")?"Crossbow":e.includes("dagger")?"Dagger":e.includes("spear")?"Spear":e.includes("staff")?"Staff":e.includes("mace")?"Mace":e.includes("flail")?"Flail":e.includes("glaive")?"Glaive":e.includes("halberd")?"Halberd":e.includes("lance")?"Lance":e.includes("rapier")?"Rapier":e.includes("scimitar")?"Scimitar":e.includes("trident")?"Trident":e.includes("whip")?"Whip":"Weapon"}function Hde(s){const e=[];return s.weaponAttacks.length>0&&(e.push("Weapon Attacks:"),s.weaponAttacks.forEach(t=>{const n=Object.keys(t.properties||{}).join(", ");e.push(`  ${t.name}: +${t.attackBonus} to hit, ${t.damage} ${t.damageType} damage${t.range?`, ${t.range}`:""}${n?` (${n})`:""}`)})),s.spellAttacks.length>0&&(e.push("Spell Attacks:"),s.spellAttacks.forEach(t=>{e.push(`  ${t.name}: +${t.attackBonus} to hit, ${t.damage} ${t.damageType} damage, ${t.range}`)})),s.featureActions.length>0&&(e.push("Feature Actions:"),s.featureActions.forEach(t=>{let n=`  ${t.name}`;t.damage&&(n+=`: ${t.damage} ${t.damageType} damage`),t.saveDC&&(n+=`, DC ${t.saveDC}`),t.range&&(n+=`, ${t.range}`),t.uses&&(n+=` (${t.uses.current}/${t.uses.max} ${t.uses.resetOn})`),e.push(n)})),e.join(`
`)}const Sr=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),ET=[.001,0,0,.001,0,0],bA=1.35,Ii={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},md={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},qv="pdfjs_internal_editor_",pt={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},Lt={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},Vde={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},PT={TRIANGLES:1,LATTICE:2},Ln={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},$1={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},sn={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},Vm={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},Dk={ERRORS:0,WARNINGS:1,INFOS:5},Gv={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},ay={moveTo:0,lineTo:1,curveTo:2,quadraticCurveTo:3,closePath:4},Wde={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let Lk=Dk.WARNINGS;function qde(s){Number.isInteger(s)&&(Lk=s)}function Gde(){return Lk}function Ok(s){Lk>=Dk.INFOS&&console.info(`Info: ${s}`)}function ut(s){Lk>=Dk.WARNINGS&&console.warn(`Warning: ${s}`)}function ds(s){throw new Error(s)}function Ot(s,e){s||ds(e)}function Yde(s){switch(s==null?void 0:s.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function _z(s,e=null,t=null){if(!s)return null;if(t&&typeof s=="string"){if(t.addDefaultProtocol&&s.startsWith("www.")){const r=s.match(/\./g);(r==null?void 0:r.length)>=2&&(s=`http://${s}`)}if(t.tryConvertEncoding)try{s=Jde(s)}catch{}}const n=e?URL.parse(s,e):URL.parse(s);return Yde(n)?n:null}function Tz(s,e,t=!1){const n=URL.parse(s);return n?(n.hash=e,n.href):t&&_z(s,"http://example.com")?s.split("#",1)[0]+`${e?`#${e}`:""}`:""}function bt(s,e,t,n=!1){return Object.defineProperty(s,e,{value:t,enumerable:!n,configurable:!0,writable:!1}),t}const Sm=function(){function e(t,n){this.message=t,this.name=n}return e.prototype=new Error,e.constructor=e,e}();class cO extends Sm{constructor(e,t){super(e,"PasswordException"),this.code=t}}class wA extends Sm{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class MT extends Sm{constructor(e){super(e,"InvalidPDFException")}}class TS extends Sm{constructor(e,t,n){super(e,"ResponseException"),this.status=t,this.missing=n}}class Kde extends Sm{constructor(e){super(e,"FormatError")}}class Uu extends Sm{constructor(e){super(e,"AbortException")}}function Ez(s){(typeof s!="object"||(s==null?void 0:s.length)===void 0)&&ds("Invalid argument for bytesToString");const e=s.length,t=8192;if(e<t)return String.fromCharCode.apply(null,s);const n=[];for(let r=0;r<e;r+=t){const a=Math.min(r+t,e),o=s.subarray(r,a);n.push(String.fromCharCode.apply(null,o))}return n.join("")}function dw(s){typeof s!="string"&&ds("Invalid argument for stringToBytes");const e=s.length,t=new Uint8Array(e);for(let n=0;n<e;++n)t[n]=s.charCodeAt(n)&255;return t}function Xde(s){return String.fromCharCode(s>>24&255,s>>16&255,s>>8&255,s&255)}function Qde(){const s=new Uint8Array(4);return s[0]=1,new Uint32Array(s.buffer,0,1)[0]===1}function Zde(){try{return new Function(""),!0}catch{return!1}}class Yn{static get isLittleEndian(){return bt(this,"isLittleEndian",Qde())}static get isEvalSupported(){return bt(this,"isEvalSupported",Zde())}static get isOffscreenCanvasSupported(){return bt(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return bt(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get isFloat16ArraySupported(){return bt(this,"isFloat16ArraySupported",typeof Float16Array<"u")}static get isSanitizerSupported(){return bt(this,"isSanitizerSupported",typeof Sanitizer<"u")}static get platform(){const{platform:e,userAgent:t}=navigator;return bt(this,"platform",{isAndroid:t.includes("Android"),isLinux:e.includes("Linux"),isMac:e.includes("Mac"),isWindows:e.includes("Win"),isFirefox:t.includes("Firefox")})}static get isCSSRoundSupported(){var e,t;return bt(this,"isCSSRoundSupported",(t=(e=globalThis.CSS)==null?void 0:e.supports)==null?void 0:t.call(e,"width: round(1.5px, 1px)"))}}const CA=Array.from(Array(256).keys(),s=>s.toString(16).padStart(2,"0"));var _c,U1,IT;class Ge{static makeHexColor(e,t,n){return`#${CA[e]}${CA[t]}${CA[n]}`}static domMatrixToTransform(e){return[e.a,e.b,e.c,e.d,e.e,e.f]}static scaleMinMax(e,t){let n;e[0]?(e[0]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[3],t[3]*=e[3]):(n=t[0],t[0]=t[1],t[1]=n,n=t[2],t[2]=t[3],t[3]=n,e[1]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static multiplyByDOMMatrix(e,t){return[e[0]*t.a+e[2]*t.b,e[1]*t.a+e[3]*t.b,e[0]*t.c+e[2]*t.d,e[1]*t.c+e[3]*t.d,e[0]*t.e+e[2]*t.f+e[4],e[1]*t.e+e[3]*t.f+e[5]]}static applyTransform(e,t,n=0){const r=e[n],a=e[n+1];e[n]=r*t[0]+a*t[2]+t[4],e[n+1]=r*t[1]+a*t[3]+t[5]}static applyTransformToBezier(e,t,n=0){const r=t[0],a=t[1],o=t[2],l=t[3],c=t[4],d=t[5];for(let h=0;h<6;h+=2){const f=e[n+h],m=e[n+h+1];e[n+h]=f*r+m*o+c,e[n+h+1]=f*a+m*l+d}}static applyInverseTransform(e,t){const n=e[0],r=e[1],a=t[0]*t[3]-t[1]*t[2];e[0]=(n*t[3]-r*t[2]+t[2]*t[5]-t[4]*t[3])/a,e[1]=(-n*t[1]+r*t[0]+t[4]*t[1]-t[5]*t[0])/a}static axialAlignedBoundingBox(e,t,n){const r=t[0],a=t[1],o=t[2],l=t[3],c=t[4],d=t[5],h=e[0],f=e[1],m=e[2],p=e[3];let x=r*h+c,g=x,b=r*m+c,v=b,y=l*f+d,w=y,S=l*p+d,j=S;if(a!==0||o!==0){const A=a*h,k=a*m,_=o*f,L=o*p;x+=_,v+=_,b+=L,g+=L,y+=A,j+=A,S+=k,w+=k}n[0]=Math.min(n[0],x,b,g,v),n[1]=Math.min(n[1],y,S,w,j),n[2]=Math.max(n[2],x,b,g,v),n[3]=Math.max(n[3],y,S,w,j)}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e,t){const n=e[0],r=e[1],a=e[2],o=e[3],l=n**2+r**2,c=n*a+r*o,d=a**2+o**2,h=(l+d)/2,f=Math.sqrt(h**2-(l*d-c**2));t[0]=Math.sqrt(h+f||1),t[1]=Math.sqrt(h-f||1)}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const n=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),r=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(n>r)return null;const a=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),o=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return a>o?null:[n,a,r,o]}static pointBoundingBox(e,t,n){n[0]=Math.min(n[0],e),n[1]=Math.min(n[1],t),n[2]=Math.max(n[2],e),n[3]=Math.max(n[3],t)}static rectBoundingBox(e,t,n,r,a){a[0]=Math.min(a[0],e,n),a[1]=Math.min(a[1],t,r),a[2]=Math.max(a[2],e,n),a[3]=Math.max(a[3],t,r)}static bezierBoundingBox(e,t,n,r,a,o,l,c,d){d[0]=Math.min(d[0],e,l),d[1]=Math.min(d[1],t,c),d[2]=Math.max(d[2],e,l),d[3]=Math.max(d[3],t,c),F(this,_c,IT).call(this,e,n,a,l,t,r,o,c,3*(-e+3*(n-a)+l),6*(e-2*n+a),3*(n-e),d),F(this,_c,IT).call(this,e,n,a,l,t,r,o,c,3*(-t+3*(r-o)+c),6*(t-2*r+o),3*(r-t),d)}}_c=new WeakSet,U1=function(e,t,n,r,a,o,l,c,d,h){if(d<=0||d>=1)return;const f=1-d,m=d*d,p=m*d,x=f*(f*(f*e+3*d*t)+3*m*n)+p*r,g=f*(f*(f*a+3*d*o)+3*m*l)+p*c;h[0]=Math.min(h[0],x),h[1]=Math.min(h[1],g),h[2]=Math.max(h[2],x),h[3]=Math.max(h[3],g)},IT=function(e,t,n,r,a,o,l,c,d,h,f,m){if(Math.abs(d)<1e-12){Math.abs(h)>=1e-12&&F(this,_c,U1).call(this,e,t,n,r,a,o,l,c,-f/h,m);return}const p=h**2-4*f*d;if(p<0)return;const x=Math.sqrt(p),g=2*d;F(this,_c,U1).call(this,e,t,n,r,a,o,l,c,(-h+x)/g,m),F(this,_c,U1).call(this,e,t,n,r,a,o,l,c,(-h-x)/g,m)},E(Ge,_c);function Jde(s){return decodeURIComponent(escape(s))}let SA=null,dO=null;function eue(s){return SA||(SA=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,dO=new Map([["","t"]])),s.replaceAll(SA,(e,t,n)=>t?t.normalize("NFKC"):dO.get(n))}function Pz(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const s=new Uint8Array(32);return crypto.getRandomValues(s),Ez(s)}const fp="pdfjs_internal_id_";function tue(s,e,t){if(!Array.isArray(t)||t.length<2)return!1;const[n,r,...a]=t;if(!s(n)&&!Number.isInteger(n)||!e(r))return!1;const o=a.length;let l=!0;switch(r.name){case"XYZ":if(o<2||o>3)return!1;break;case"Fit":case"FitB":return o===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(o>1)return!1;break;case"FitR":if(o!==4)return!1;l=!1;break;default:return!1}for(const c of a)if(!(typeof c=="number"||l&&c===null))return!1;return!0}function jr(s,e,t){return Math.min(Math.max(s,e),t)}function Mz(s){return Uint8Array.prototype.toBase64?s.toBase64():btoa(Ez(s))}function sue(s){return Uint8Array.fromBase64?Uint8Array.fromBase64(s):dw(atob(s))}typeof Promise.try!="function"&&(Promise.try=function(s,...e){return new Promise(t=>{t(s(...e))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(s){return s.reduce((e,t)=>e+t,0)});class Yv{static textContent(e){const t=[],n={items:t,styles:Object.create(null)};function r(a){var c;if(!a)return;let o=null;const l=a.name;if(l==="#text")o=a.value;else if(Yv.shouldBuildText(l))(c=a==null?void 0:a.attributes)!=null&&c.textContent?o=a.attributes.textContent:a.value&&(o=a.value);else return;if(o!==null&&t.push({str:o}),!!a.children)for(const d of a.children)r(d)}return r(e),n}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}class Iz{static setupStorage(e,t,n,r,a){const o=r.getValue(t,{value:null});switch(n.name){case"textarea":if(o.value!==null&&(e.textContent=o.value),a==="print")break;e.addEventListener("input",l=>{r.setValue(t,{value:l.target.value})});break;case"input":if(n.attributes.type==="radio"||n.attributes.type==="checkbox"){if(o.value===n.attributes.xfaOn?e.setAttribute("checked",!0):o.value===n.attributes.xfaOff&&e.removeAttribute("checked"),a==="print")break;e.addEventListener("change",l=>{r.setValue(t,{value:l.target.checked?l.target.getAttribute("xfaOn"):l.target.getAttribute("xfaOff")})})}else{if(o.value!==null&&e.setAttribute("value",o.value),a==="print")break;e.addEventListener("input",l=>{r.setValue(t,{value:l.target.value})})}break;case"select":if(o.value!==null){e.setAttribute("value",o.value);for(const l of n.children)l.attributes.value===o.value?l.attributes.selected=!0:l.attributes.hasOwnProperty("selected")&&delete l.attributes.selected}e.addEventListener("input",l=>{const c=l.target.options,d=c.selectedIndex===-1?"":c[c.selectedIndex].value;r.setValue(t,{value:d})});break}}static setAttributes({html:e,element:t,storage:n=null,intent:r,linkService:a}){const{attributes:o}=t,l=e instanceof HTMLAnchorElement;o.type==="radio"&&(o.name=`${o.name}-${r}`);for(const[c,d]of Object.entries(o))if(d!=null)switch(c){case"class":d.length&&e.setAttribute(c,d.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",d);break;case"style":Object.assign(e.style,d);break;case"textContent":e.textContent=d;break;default:(!l||c!=="href"&&c!=="newWindow")&&e.setAttribute(c,d)}l&&a.addLinkAttributes(e,o.href,o.newWindow),n&&o.dataId&&this.setupStorage(e,o.dataId,t,n)}static render(e){var f,m;const t=e.annotationStorage,n=e.linkService,r=e.xfaHtml,a=e.intent||"display",o=document.createElement(r.name);r.attributes&&this.setAttributes({html:o,element:r,intent:a,linkService:n});const l=a!=="richText",c=e.div;if(c.append(o),e.viewport){const p=`matrix(${e.viewport.transform.join(",")})`;c.style.transform=p}l&&c.setAttribute("class","xfaLayer xfaFont");const d=[];if(r.children.length===0){if(r.value){const p=document.createTextNode(r.value);o.append(p),l&&Yv.shouldBuildText(r.name)&&d.push(p)}return{textDivs:d}}const h=[[r,-1,o]];for(;h.length>0;){const[p,x,g]=h.at(-1);if(x+1===p.children.length){h.pop();continue}const b=p.children[++h.at(-1)[1]];if(b===null)continue;const{name:v}=b;if(v==="#text"){const w=document.createTextNode(b.value);d.push(w),g.append(w);continue}const y=(f=b==null?void 0:b.attributes)!=null&&f.xmlns?document.createElementNS(b.attributes.xmlns,v):document.createElement(v);if(g.append(y),b.attributes&&this.setAttributes({html:y,element:b,storage:t,intent:a,linkService:n}),((m=b.children)==null?void 0:m.length)>0)h.push([b,-1,y]);else if(b.value){const w=document.createTextNode(b.value);l&&Yv.shouldBuildText(v)&&d.push(w),y.append(w)}}for(const p of c.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))p.setAttribute("readOnly",!0);return{textDivs:d}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const Rl="http://www.w3.org/2000/svg",mh=class mh{};Ce(mh,"CSS",96),Ce(mh,"PDF",72),Ce(mh,"PDF_TO_CSS_UNITS",mh.CSS/mh.PDF);let zu=mh;async function uw(s,e="text"){if(ky(s,document.baseURI)){const t=await fetch(s);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,n)=>{const r=new XMLHttpRequest;r.open("GET",s,!0),r.responseType=e,r.onreadystatechange=()=>{if(r.readyState===XMLHttpRequest.DONE){if(r.status===200||r.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(r.response);return}t(r.responseText);return}n(new Error(r.statusText))}},r.send(null)})}class hw{constructor({viewBox:e,userUnit:t,scale:n,rotation:r,offsetX:a=0,offsetY:o=0,dontFlip:l=!1}){this.viewBox=e,this.userUnit=t,this.scale=n,this.rotation=r,this.offsetX=a,this.offsetY=o,n*=t;const c=(e[2]+e[0])/2,d=(e[3]+e[1])/2;let h,f,m,p;switch(r%=360,r<0&&(r+=360),r){case 180:h=-1,f=0,m=0,p=1;break;case 90:h=0,f=1,m=1,p=0;break;case 270:h=0,f=-1,m=-1,p=0;break;case 0:h=1,f=0,m=0,p=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}l&&(m=-m,p=-p);let x,g,b,v;h===0?(x=Math.abs(d-e[1])*n+a,g=Math.abs(c-e[0])*n+o,b=(e[3]-e[1])*n,v=(e[2]-e[0])*n):(x=Math.abs(c-e[0])*n+a,g=Math.abs(d-e[1])*n+o,b=(e[2]-e[0])*n,v=(e[3]-e[1])*n),this.transform=[h*n,f*n,m*n,p*n,x-h*n*c-m*n*d,g-f*n*c-p*n*d],this.width=b,this.height=v}get rawDims(){const e=this.viewBox;return bt(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:n=this.offsetX,offsetY:r=this.offsetY,dontFlip:a=!1}={}){return new hw({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:r,dontFlip:a})}convertToViewportPoint(e,t){const n=[e,t];return Ge.applyTransform(n,this.transform),n}convertToViewportRectangle(e){const t=[e[0],e[1]];Ge.applyTransform(t,this.transform);const n=[e[2],e[3]];return Ge.applyTransform(n,this.transform),[t[0],t[1],n[0],n[1]]}convertToPdfPoint(e,t){const n=[e,t];return Ge.applyInverseTransform(n,this.transform),n}}class DM extends Sm{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function Fk(s){const e=s.length;let t=0;for(;t<e&&s[t].trim()==="";)t++;return s.substring(t,t+5).toLowerCase()==="data:"}function LM(s){return typeof s=="string"&&/\.pdf$/i.test(s)}function nue(s){return[s]=s.split(/[#?]/,1),s.substring(s.lastIndexOf("/")+1)}function rue(s,e="document.pdf"){if(typeof s!="string")return e;if(Fk(s))return ut('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const n=(l=>{try{return new URL(l)}catch{try{return new URL(decodeURIComponent(l))}catch{try{return new URL(l,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(l),"https://foo.bar")}catch{return null}}}}})(s);if(!n)return e;const r=l=>{try{let c=decodeURIComponent(l);return c.includes("/")?(c=c.split("/").at(-1),c.test(/^\.pdf$/i)?c:l):c}catch{return l}},a=/\.pdf$/i,o=n.pathname.split("/").at(-1);if(a.test(o))return r(o);if(n.searchParams.size>0){const l=Array.from(n.searchParams.values()).reverse();for(const d of l)if(a.test(d))return r(d);const c=Array.from(n.searchParams.keys()).reverse();for(const d of c)if(a.test(d))return r(d)}if(n.hash){const c=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(n.hash);if(c)return r(c[0])}return e}class uO{constructor(){Ce(this,"started",Object.create(null));Ce(this,"times",[])}time(e){e in this.started&&ut(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||ut(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:n}of this.times)t=Math.max(n.length,t);for(const{name:n,start:r,end:a}of this.times)e.push(`${n.padEnd(t)} ${a-r}ms
`);return e.join("")}}function ky(s,e){const t=e?URL.parse(s,e):URL.parse(s);return(t==null?void 0:t.protocol)==="http:"||(t==null?void 0:t.protocol)==="https:"}function La(s){s.preventDefault()}function Gs(s){s.preventDefault(),s.stopPropagation()}function iue(s){console.log("Deprecated API usage: "+s)}var ib;class ES{static toDateObject(e){if(e instanceof Date)return e;if(!e||typeof e!="string")return null;u(this,ib)||N(this,ib,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const t=u(this,ib).exec(e);if(!t)return null;const n=parseInt(t[1],10);let r=parseInt(t[2],10);r=r>=1&&r<=12?r-1:0;let a=parseInt(t[3],10);a=a>=1&&a<=31?a:1;let o=parseInt(t[4],10);o=o>=0&&o<=23?o:0;let l=parseInt(t[5],10);l=l>=0&&l<=59?l:0;let c=parseInt(t[6],10);c=c>=0&&c<=59?c:0;const d=t[7]||"Z";let h=parseInt(t[8],10);h=h>=0&&h<=23?h:0;let f=parseInt(t[9],10)||0;return f=f>=0&&f<=59?f:0,d==="-"?(o+=h,l+=f):d==="+"&&(o-=h,l-=f),new Date(Date.UTC(n,r,a,o,l,c))}}ib=new WeakMap,E(ES,ib);function aue(s,{scale:e=1,rotation:t=0}){const{width:n,height:r}=s.attributes.style,a=[0,0,parseInt(n),parseInt(r)];return new hw({viewBox:a,userUnit:1,scale:e,rotation:t})}function fw(s){if(s.startsWith("#")){const e=parseInt(s.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return s.startsWith("rgb(")?s.slice(4,-1).split(",").map(e=>parseInt(e)):s.startsWith("rgba(")?s.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(ut(`Not a valid color format: "${s}"`),[0,0,0])}function oue(s){const e=document.createElement("span");e.style.visibility="hidden",e.style.colorScheme="only light",document.body.append(e);for(const t of s.keys()){e.style.color=t;const n=window.getComputedStyle(e).color;s.set(t,fw(n))}e.remove()}function Ps(s){const{a:e,b:t,c:n,d:r,e:a,f:o}=s.getTransform();return[e,t,n,r,a,o]}function Mo(s){const{a:e,b:t,c:n,d:r,e:a,f:o}=s.getTransform().invertSelf();return[e,t,n,r,a,o]}function mm(s,e,t=!1,n=!0){if(e instanceof hw){const{pageWidth:r,pageHeight:a}=e.rawDims,{style:o}=s,l=Yn.isCSSRoundSupported,c=`var(--total-scale-factor) * ${r}px`,d=`var(--total-scale-factor) * ${a}px`,h=l?`round(down, ${c}, var(--scale-round-x))`:`calc(${c})`,f=l?`round(down, ${d}, var(--scale-round-y))`:`calc(${d})`;!t||e.rotation%180===0?(o.width=h,o.height=f):(o.width=f,o.height=h)}n&&s.setAttribute("data-main-rotation",e.rotation)}class Cl{constructor(){const{pixelRatio:e}=Cl;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(e,t,n,r,a=-1){let o=1/0,l=1/0,c=1/0;n=Cl.capPixels(n,a),n>0&&(o=Math.sqrt(n/(e*t))),r!==-1&&(l=r/e,c=r/t);const d=Math.min(o,l,c);return this.sx>d||this.sy>d?(this.sx=d,this.sy=d,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(e,t){if(t>=0){const n=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+t/100));return e>0?Math.min(e,n):n}return e}}const RT=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class lue{static get isDarkMode(){var e;return bt(this,"isDarkMode",!!((e=window==null?void 0:window.matchMedia)!=null&&e.call(window,"(prefers-color-scheme: dark)").matches))}}class cue{static get commentForegroundColor(){const e=document.createElement("span");e.classList.add("comment","sidebar");const{style:t}=e;t.width=t.height="0",t.display="none",t.color="var(--comment-fg-color)",document.body.append(e);const{color:n}=window.getComputedStyle(e);return e.remove(),bt(this,"commentForegroundColor",fw(n))}}function due(s,e,t,n){n=Math.min(Math.max(n??1,0),1);const r=255*(1-n);return s=Math.round(s*n+r),e=Math.round(e*n+r),t=Math.round(t*n+r),[s,e,t]}function hO(s,e){const t=s[0]/255,n=s[1]/255,r=s[2]/255,a=Math.max(t,n,r),o=Math.min(t,n,r),l=(a+o)/2;if(a===o)e[0]=e[1]=0;else{const c=a-o;switch(e[1]=l<.5?c/(a+o):c/(2-a-o),a){case t:e[0]=((n-r)/c+(n<r?6:0))*60;break;case n:e[0]=((r-t)/c+2)*60;break;case r:e[0]=((t-n)/c+4)*60;break}}e[2]=l}function DT(s,e){const t=s[0],n=s[1],r=s[2],a=(1-Math.abs(2*r-1))*n,o=a*(1-Math.abs(t/60%2-1)),l=r-a/2;switch(Math.floor(t/60)){case 0:e[0]=a+l,e[1]=o+l,e[2]=l;break;case 1:e[0]=o+l,e[1]=a+l,e[2]=l;break;case 2:e[0]=l,e[1]=a+l,e[2]=o+l;break;case 3:e[0]=l,e[1]=o+l,e[2]=a+l;break;case 4:e[0]=o+l,e[1]=l,e[2]=a+l;break;case 5:case 6:e[0]=a+l,e[1]=l,e[2]=o+l;break}}function fO(s){return s<=.03928?s/12.92:((s+.055)/1.055)**2.4}function mO(s,e,t){DT(s,t),t.map(fO);const n=.2126*t[0]+.7152*t[1]+.0722*t[2];DT(e,t),t.map(fO);const r=.2126*t[0]+.7152*t[1]+.0722*t[2];return n>r?(n+.05)/(r+.05):(r+.05)/(n+.05)}const pO=new Map;function uue(s,e){const t=s[0]+s[1]*256+s[2]*65536+e[0]*16777216+e[1]*4294967296+e[2]*1099511627776;let n=pO.get(t);if(n)return n;const r=new Float32Array(9),a=r.subarray(0,3),o=r.subarray(3,6);hO(s,o);const l=r.subarray(6,9);hO(e,l);const c=l[2]<.5,d=c?12:4.5;if(o[2]=c?Math.sqrt(o[2]):1-Math.sqrt(1-o[2]),mO(o,l,a)<d){let h,f;c?(h=o[2],f=1):(h=0,f=o[2]);const m=.005;for(;f-h>m;){const p=o[2]=(h+f)/2;c===mO(o,l,a)<d?h=p:f=p}o[2]=c?f:h}return DT(o,a),n=Ge.makeHexColor(Math.round(a[0]*255),Math.round(a[1]*255),Math.round(a[2]*255)),pO.set(t,n),n}function Rz({html:s,dir:e,className:t},n){const r=document.createDocumentFragment();if(typeof s=="string"){const a=document.createElement("p");a.dir=e||"auto";const o=s.split(/(?:\r\n?|\n)/);for(let l=0,c=o.length;l<c;++l){const d=o[l];a.append(document.createTextNode(d)),l<c-1&&a.append(document.createElement("br"))}r.append(a)}else Iz.render({xfaHtml:s,div:r,intent:"richText"});r.firstChild.classList.add("richText",t),n.append(r)}function Dz(s){const e=new Path2D;if(!s)return e;for(let t=0,n=s.length;t<n;)switch(s[t++]){case ay.moveTo:e.moveTo(s[t++],s[t++]);break;case ay.lineTo:e.lineTo(s[t++],s[t++]);break;case ay.curveTo:e.bezierCurveTo(s[t++],s[t++],s[t++],s[t++],s[t++],s[t++]);break;case ay.quadraticCurveTo:e.quadraticCurveTo(s[t++],s[t++],s[t++],s[t++]);break;case ay.closePath:e.closePath();break;default:ut(`Unrecognized drawing path operator: ${s[t-1]}`);break}return e}var wd,Cd,la,ca,ab,Sd,Bp,$p,ob,GS,Lz,qn,Oz,Fz,Wm,Ny;const Fl=class Fl{constructor(e){E(this,qn);E(this,wd,null);E(this,Cd,null);E(this,la);E(this,ca,null);E(this,ab,null);E(this,Sd,null);E(this,Bp,null);E(this,$p,null);N(this,la,e),u(Fl,ob)||N(Fl,ob,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"}))}render(){const e=N(this,wd,document.createElement("div"));e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=u(this,la)._uiManager._signal;t instanceof AbortSignal&&!t.aborted&&(e.addEventListener("contextmenu",La,{signal:t}),e.addEventListener("pointerdown",F(Fl,GS,Lz),{signal:t}));const n=N(this,ca,document.createElement("div"));n.className="buttons",e.append(n);const r=u(this,la).toolbarPosition;if(r){const{style:a}=e,o=u(this,la)._uiManager.direction==="ltr"?1-r[0]:r[0];a.insetInlineEnd=`${100*o}%`,a.top=`calc(${100*r[1]}% + var(--editor-toolbar-vert-offset))`}return e}get div(){return u(this,wd)}hide(){var e;u(this,wd).classList.add("hidden"),(e=u(this,Cd))==null||e.hideDropdown()}show(){var e,t;u(this,wd).classList.remove("hidden"),(e=u(this,ab))==null||e.shown(),(t=u(this,Sd))==null||t.shown()}addDeleteButton(){const{editorType:e,_uiManager:t}=u(this,la),n=document.createElement("button");n.classList.add("basic","deleteButton"),n.tabIndex=0,n.setAttribute("data-l10n-id",u(Fl,ob)[e]),F(this,qn,Wm).call(this,n)&&n.addEventListener("click",r=>{t.delete()},{signal:t._signal}),u(this,ca).append(n)}async addAltText(e){const t=await e.render();F(this,qn,Wm).call(this,t),u(this,ca).append(t,u(this,qn,Ny)),N(this,ab,e)}addComment(e,t=null){if(u(this,Sd))return;const n=e.renderForToolbar();if(!n)return;F(this,qn,Wm).call(this,n);const r=N(this,Bp,u(this,qn,Ny));t?(u(this,ca).insertBefore(n,t),u(this,ca).insertBefore(r,t)):u(this,ca).append(n,r),N(this,Sd,e),e.toolbar=this}addColorPicker(e){if(u(this,Cd))return;N(this,Cd,e);const t=e.renderButton();F(this,qn,Wm).call(this,t),u(this,ca).append(t,u(this,qn,Ny))}async addEditSignatureButton(e){const t=N(this,$p,await e.renderEditButton(u(this,la)));F(this,qn,Wm).call(this,t),u(this,ca).append(t,u(this,qn,Ny))}removeButton(e){var t,n;switch(e){case"comment":(t=u(this,Sd))==null||t.removeToolbarCommentButton(),N(this,Sd,null),(n=u(this,Bp))==null||n.remove(),N(this,Bp,null);break}}async addButton(e,t){switch(e){case"colorPicker":t&&this.addColorPicker(t);break;case"altText":t&&await this.addAltText(t);break;case"editSignature":t&&await this.addEditSignatureButton(t);break;case"delete":this.addDeleteButton();break;case"comment":t&&this.addComment(t);break}}async addButtonBefore(e,t,n){if(!t&&e==="comment")return;const r=u(this,ca).querySelector(n);r&&e==="comment"&&this.addComment(t,r)}updateEditSignatureButton(e){u(this,$p)&&(u(this,$p).title=e)}remove(){var e;u(this,wd).remove(),(e=u(this,Cd))==null||e.destroy(),N(this,Cd,null)}};wd=new WeakMap,Cd=new WeakMap,la=new WeakMap,ca=new WeakMap,ab=new WeakMap,Sd=new WeakMap,Bp=new WeakMap,$p=new WeakMap,ob=new WeakMap,GS=new WeakSet,Lz=function(e){e.stopPropagation()},qn=new WeakSet,Oz=function(e){u(this,la)._focusEventsAllowed=!1,Gs(e)},Fz=function(e){u(this,la)._focusEventsAllowed=!0,Gs(e)},Wm=function(e){const t=u(this,la)._uiManager._signal;return!(t instanceof AbortSignal)||t.aborted?!1:(e.addEventListener("focusin",F(this,qn,Oz).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",F(this,qn,Fz).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",La,{signal:t}),!0)},Ny=function(){const e=document.createElement("div");return e.className="divider",e},E(Fl,GS),E(Fl,ob,null);let LT=Fl;var lb,Th,Hl,Uc,Bz,$z,OT;class hue{constructor(e){E(this,Uc);E(this,lb,null);E(this,Th,null);E(this,Hl);N(this,Hl,e)}show(e,t,n){const[r,a]=F(this,Uc,$z).call(this,t,n),{style:o}=u(this,Th)||N(this,Th,F(this,Uc,Bz).call(this));e.append(u(this,Th)),o.insetInlineEnd=`${100*r}%`,o.top=`calc(${100*a}% + var(--editor-toolbar-vert-offset))`}hide(){u(this,Th).remove()}}lb=new WeakMap,Th=new WeakMap,Hl=new WeakMap,Uc=new WeakSet,Bz=function(){const e=N(this,Th,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar");const t=u(this,Hl)._signal;t instanceof AbortSignal&&!t.aborted&&e.addEventListener("contextmenu",La,{signal:t});const n=N(this,lb,document.createElement("div"));return n.className="buttons",e.append(n),u(this,Hl).hasCommentManager()&&F(this,Uc,OT).call(this,"commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{u(this,Hl).commentSelection("floating_button")}),F(this,Uc,OT).call(this,"highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{u(this,Hl).highlightSelection("floating_button")}),e},$z=function(e,t){let n=0,r=0;for(const a of e){const o=a.y+a.height;if(o<n)continue;const l=a.x+(t?a.width:0);if(o>n){r=l,n=o;continue}t?l>r&&(r=l):l<r&&(r=l)}return[t?1-r:r,n]},OT=function(e,t,n,r){const a=document.createElement("button");a.classList.add("basic",e),a.tabIndex=0,a.setAttribute("data-l10n-id",t);const o=document.createElement("span");a.append(o),o.className="visuallyHidden",o.setAttribute("data-l10n-id",n);const l=u(this,Hl)._signal;l instanceof AbortSignal&&!l.aborted&&(a.addEventListener("contextmenu",La,{signal:l}),a.addEventListener("click",r,{signal:l})),u(this,lb).append(a)};function Uz(s,e,t){for(const n of t)e.addEventListener(n,s[n].bind(s))}var Eh,Ph,Up,Mh;const Jt=class Jt{static initializeAndAddPointerId(e){(u(Jt,Ph)||N(Jt,Ph,new Set)).add(e)}static setPointer(e,t){u(Jt,Eh)||N(Jt,Eh,t),u(Jt,Mh)??N(Jt,Mh,e)}static setTimeStamp(e){N(Jt,Up,e)}static isSamePointerId(e){return u(Jt,Eh)===e}static isSamePointerIdOrRemove(e){var t;return u(Jt,Eh)===e?!0:((t=u(Jt,Ph))==null||t.delete(e),!1)}static isSamePointerType(e){return u(Jt,Mh)===e}static isInitializedAndDifferentPointerType(e){return u(Jt,Mh)!==null&&!Jt.isSamePointerType(e)}static isSameTimeStamp(e){return u(Jt,Up)===e}static isUsingMultiplePointers(){var e;return((e=u(Jt,Ph))==null?void 0:e.size)>=1}static clearPointerType(){N(Jt,Mh,null)}static clearPointerIds(){N(Jt,Eh,NaN),N(Jt,Ph,null)}static clearTimeStamp(){N(Jt,Up,NaN)}};Eh=new WeakMap,Ph=new WeakMap,Up=new WeakMap,Mh=new WeakMap,E(Jt,Eh,NaN),E(Jt,Ph,null),E(Jt,Up,NaN),E(Jt,Mh,null);let sr=Jt;var YS;class fue{constructor(){E(this,YS,0)}get id(){return`${qv}${Fs(this,YS)._++}`}}YS=new WeakMap;var zp,cb,nr,Hp,z1;const nI=class nI{constructor(){E(this,Hp);E(this,zp,Pz());E(this,cb,0);E(this,nr,null)}static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',n=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),r=new Image;r.src=e;const a=r.decode().then(()=>(n.drawImage(r,0,0,1,1,0,0,1,3),new Uint32Array(n.getImageData(0,0,1,1).data.buffer)[0]===0));return bt(this,"_isSVGFittingCanvas",a)}async getFromFile(e){const{lastModified:t,name:n,size:r,type:a}=e;return F(this,Hp,z1).call(this,`${t}_${n}_${r}_${a}`,e)}async getFromUrl(e){return F(this,Hp,z1).call(this,e,e)}async getFromBlob(e,t){const n=await t;return F(this,Hp,z1).call(this,e,n)}async getFromId(e){u(this,nr)||N(this,nr,new Map);const t=u(this,nr).get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:n}=t;return delete t.blobPromise,this.getFromBlob(t.id,n)}return this.getFromUrl(t.url)}getFromCanvas(e,t){u(this,nr)||N(this,nr,new Map);let n=u(this,nr).get(e);if(n!=null&&n.bitmap)return n.refCounter+=1,n;const r=new OffscreenCanvas(t.width,t.height);return r.getContext("2d").drawImage(t,0,0),n={bitmap:r.transferToImageBitmap(),id:`image_${u(this,zp)}_${Fs(this,cb)._++}`,refCounter:1,isSvg:!1},u(this,nr).set(e,n),u(this,nr).set(n.id,n),n}getSvgUrl(e){const t=u(this,nr).get(e);return t!=null&&t.isSvg?t.svgUrl:null}deleteId(e){var r;u(this,nr)||N(this,nr,new Map);const t=u(this,nr).get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:n}=t;if(!t.url&&!t.file){const a=new OffscreenCanvas(n.width,n.height);a.getContext("bitmaprenderer").transferFromImageBitmap(n),t.blobPromise=a.convertToBlob()}(r=n.close)==null||r.call(n),t.bitmap=null}isValidId(e){return e.startsWith(`image_${u(this,zp)}_`)}};zp=new WeakMap,cb=new WeakMap,nr=new WeakMap,Hp=new WeakSet,z1=async function(e,t){u(this,nr)||N(this,nr,new Map);let n=u(this,nr).get(e);if(n===null)return null;if(n!=null&&n.bitmap)return n.refCounter+=1,n;try{n||(n={bitmap:null,id:`image_${u(this,zp)}_${Fs(this,cb)._++}`,refCounter:0,isSvg:!1});let r;if(typeof t=="string"?(n.url=t,r=await uw(t,"blob")):t instanceof File?r=n.file=t:t instanceof Blob&&(r=t),r.type==="image/svg+xml"){const a=nI._isSVGFittingCanvas,o=new FileReader,l=new Image,c=new Promise((d,h)=>{l.onload=()=>{n.bitmap=l,n.isSvg=!0,d()},o.onload=async()=>{const f=n.svgUrl=o.result;l.src=await a?`${f}#svgView(preserveAspectRatio(none))`:f},l.onerror=o.onerror=h});o.readAsDataURL(r),await c}else n.bitmap=await createImageBitmap(r);n.refCounter=1}catch(r){ut(r),n=null}return u(this,nr).set(e,n),n&&u(this,nr).set(n.id,n),n};let FT=nI;var Xs,jd,db,Es;class mue{constructor(e=128){E(this,Xs,[]);E(this,jd,!1);E(this,db);E(this,Es,-1);N(this,db,e)}add({cmd:e,undo:t,post:n,mustExec:r,type:a=NaN,overwriteIfSameType:o=!1,keepUndo:l=!1}){if(r&&e(),u(this,jd))return;const c={cmd:e,undo:t,post:n,type:a};if(u(this,Es)===-1){u(this,Xs).length>0&&(u(this,Xs).length=0),N(this,Es,0),u(this,Xs).push(c);return}if(o&&u(this,Xs)[u(this,Es)].type===a){l&&(c.undo=u(this,Xs)[u(this,Es)].undo),u(this,Xs)[u(this,Es)]=c;return}const d=u(this,Es)+1;d===u(this,db)?u(this,Xs).splice(0,1):(N(this,Es,d),d<u(this,Xs).length&&u(this,Xs).splice(d)),u(this,Xs).push(c)}undo(){if(u(this,Es)===-1)return;N(this,jd,!0);const{undo:e,post:t}=u(this,Xs)[u(this,Es)];e(),t==null||t(),N(this,jd,!1),N(this,Es,u(this,Es)-1)}redo(){if(u(this,Es)<u(this,Xs).length-1){N(this,Es,u(this,Es)+1),N(this,jd,!0);const{cmd:e,post:t}=u(this,Xs)[u(this,Es)];e(),t==null||t(),N(this,jd,!1)}}hasSomethingToUndo(){return u(this,Es)!==-1}hasSomethingToRedo(){return u(this,Es)<u(this,Xs).length-1}cleanType(e){if(u(this,Es)!==-1){for(let t=u(this,Es);t>=0;t--)if(u(this,Xs)[t].type!==e){u(this,Xs).splice(t+1,u(this,Es)-t),N(this,Es,t);return}u(this,Xs).length=0,N(this,Es,-1)}}destroy(){N(this,Xs,null)}}Xs=new WeakMap,jd=new WeakMap,db=new WeakMap,Es=new WeakMap;var KS,zz;class mw{constructor(e){E(this,KS);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=Yn.platform;for(const[n,r,a={}]of e)for(const o of n){const l=o.startsWith("mac+");t&&l?(this.callbacks.set(o.slice(4),{callback:r,options:a}),this.allKeys.add(o.split("+").at(-1))):!t&&!l&&(this.callbacks.set(o,{callback:r,options:a}),this.allKeys.add(o.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;const n=this.callbacks.get(F(this,KS,zz).call(this,t));if(!n)return;const{callback:r,options:{bubbles:a=!1,args:o=[],checker:l=null}}=n;l&&!l(e,t)||(r.bind(e,...o,t)(),a||Gs(t))}}KS=new WeakSet,zz=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t};const XS=class XS{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return oue(e),bt(this,"_colors",e)}convert(e){const t=fw(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[n,r]of this._colors)if(r.every((a,o)=>a===t[o]))return XS._colorsMapping.get(n);return t}getHexCode(e){const t=this._colors.get(e);return t?Ge.makeHexColor(...t):e}};Ce(XS,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let BT=XS;var Vp,pi,Wp,$s,mn,qp,da,Gp,ua,rr,kd,Nd,Yp,Ad,$o,ha,Ih,ub,hb,Kp,fb,Uo,_d,Xp,Td,zo,QS,Ed,Qp,mb,Pd,Rh,Zp,Md,pb,nn,Yt,Vl,Id,Rd,gb,Jp,xb,Dd,Ho,Wl,yb,vb,fa,Oe,H1,$T,Hz,Vz,Ay,Wz,qz,Gz,UT,Yz,Kz,Xz,Qz,gr,Dl,Zz,Jz,zT,eH,_y,HT;const pp=class pp{constructor(e,t,n,r,a,o,l,c,d,h,f,m,p,x,g,b){E(this,Oe);E(this,Vp,new AbortController);E(this,pi,null);E(this,Wp,null);E(this,$s,new Map);E(this,mn,new Map);E(this,qp,null);E(this,da,null);E(this,Gp,null);E(this,ua,new mue);E(this,rr,null);E(this,kd,null);E(this,Nd,null);E(this,Yp,0);E(this,Ad,new Set);E(this,$o,null);E(this,ha,null);E(this,Ih,new Set);Ce(this,"_editorUndoBar",null);E(this,ub,!1);E(this,hb,!1);E(this,Kp,!1);E(this,fb,null);E(this,Uo,null);E(this,_d,null);E(this,Xp,null);E(this,Td,!1);E(this,zo,null);E(this,QS,new fue);E(this,Ed,!1);E(this,Qp,!1);E(this,mb,!1);E(this,Pd,null);E(this,Rh,null);E(this,Zp,null);E(this,Md,null);E(this,pb,null);E(this,nn,pt.NONE);E(this,Yt,new Set);E(this,Vl,null);E(this,Id,null);E(this,Rd,null);E(this,gb,null);E(this,Jp,null);E(this,xb,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});E(this,Dd,[0,0]);E(this,Ho,null);E(this,Wl,null);E(this,yb,null);E(this,vb,null);E(this,fa,null);const v=this._signal=u(this,Vp).signal;N(this,Wl,e),N(this,yb,t),N(this,vb,n),N(this,qp,r),N(this,rr,a),N(this,Id,o),N(this,Jp,c),this._eventBus=l,l._on("editingaction",this.onEditingAction.bind(this),{signal:v}),l._on("pagechanging",this.onPageChanging.bind(this),{signal:v}),l._on("scalechanging",this.onScaleChanging.bind(this),{signal:v}),l._on("rotationchanging",this.onRotationChanging.bind(this),{signal:v}),l._on("setpreference",this.onSetPreference.bind(this),{signal:v}),l._on("switchannotationeditorparams",y=>this.updateParams(y.type,y.value),{signal:v}),window.addEventListener("pointerdown",()=>{N(this,Qp,!0)},{capture:!0,signal:v}),window.addEventListener("pointerup",()=>{N(this,Qp,!1)},{capture:!0,signal:v}),F(this,Oe,Wz).call(this),F(this,Oe,Qz).call(this),F(this,Oe,UT).call(this),N(this,da,c.annotationStorage),N(this,fb,c.filterFactory),N(this,Rd,d),N(this,Xp,h||null),N(this,ub,f),N(this,hb,m),N(this,Kp,p),N(this,pb,x||null),this.viewParameters={realScale:zu.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=g||null,this._supportsPinchToZoom=b!==!1,a==null||a.setSidebarUiManager(this)}static get _keyboardManager(){const e=pp.prototype,t=o=>u(o,Wl).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&o.hasSomethingToControl(),n=(o,{target:l})=>{if(l instanceof HTMLInputElement){const{type:c}=l;return c!=="text"&&c!=="number"}return!0},r=this.TRANSLATE_SMALL,a=this.TRANSLATE_BIG;return bt(this,"_keyboardManager",new mw([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],e.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:n}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(o,{target:l})=>!(l instanceof HTMLButtonElement)&&u(o,Wl).contains(l)&&!o.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(o,{target:l})=>!(l instanceof HTMLButtonElement)&&u(o,Wl).contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-a,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[a,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-a],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,a],checker:t}]]))}destroy(){var e,t,n,r,a,o,l,c,d;(e=u(this,fa))==null||e.resolve(),N(this,fa,null),(t=u(this,Vp))==null||t.abort(),N(this,Vp,null),this._signal=null;for(const h of u(this,mn).values())h.destroy();u(this,mn).clear(),u(this,$s).clear(),u(this,Ih).clear(),(n=u(this,Md))==null||n.clear(),N(this,pi,null),u(this,Yt).clear(),u(this,ua).destroy(),(r=u(this,qp))==null||r.destroy(),(a=u(this,rr))==null||a.destroy(),(o=u(this,Id))==null||o.destroy(),(l=u(this,zo))==null||l.hide(),N(this,zo,null),(c=u(this,Zp))==null||c.destroy(),N(this,Zp,null),N(this,Wp,null),u(this,Uo)&&(clearTimeout(u(this,Uo)),N(this,Uo,null)),u(this,Ho)&&(clearTimeout(u(this,Ho)),N(this,Ho,null)),(d=this._editorUndoBar)==null||d.destroy(),N(this,Jp,null)}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return u(this,pb)}get useNewAltTextFlow(){return u(this,hb)}get useNewAltTextWhenAddingImage(){return u(this,Kp)}get hcmFilter(){return bt(this,"hcmFilter",u(this,Rd)?u(this,fb).addHCMFilter(u(this,Rd).foreground,u(this,Rd).background):"none")}get direction(){return bt(this,"direction",getComputedStyle(u(this,Wl)).direction)}get _highlightColors(){return bt(this,"_highlightColors",u(this,Xp)?new Map(u(this,Xp).split(",").map(e=>(e=e.split("=").map(t=>t.trim()),e[1]=e[1].toUpperCase(),e))):null)}get highlightColors(){const{_highlightColors:e}=this;if(!e)return bt(this,"highlightColors",null);const t=new Map,n=!!u(this,Rd);for(const[r,a]of e){const o=r.endsWith("_HCM");if(n&&o){t.set(r.replace("_HCM",""),a);continue}!n&&!o&&t.set(r,a)}return bt(this,"highlightColors",t)}get highlightColorNames(){return bt(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}getNonHCMColor(e){if(!this._highlightColors)return e;const t=this.highlightColorNames.get(e);return this._highlightColors.get(t)||e}getNonHCMColorName(e){return this.highlightColorNames.get(e)||e}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),N(this,Nd,e)}setMainHighlightColorPicker(e){N(this,Zp,e)}editAltText(e,t=!1){var n;(n=u(this,qp))==null||n.editAltText(this,e,t)}hasCommentManager(){return!!u(this,rr)}editComment(e,t,n,r){var a;(a=u(this,rr))==null||a.showDialog(this,e,t,n,r)}selectComment(e,t){const n=u(this,mn).get(e),r=n==null?void 0:n.getEditorByUID(t);r==null||r.toggleComment(!0,!0)}updateComment(e){var t;(t=u(this,rr))==null||t.updateComment(e.getData())}updatePopupColor(e){var t;(t=u(this,rr))==null||t.updatePopupColor(e)}removeComment(e){var t;(t=u(this,rr))==null||t.removeComments([e.uid])}toggleComment(e,t,n=void 0){var r;(r=u(this,rr))==null||r.toggleCommentPopup(e,t,n)}makeCommentColor(e,t){var n;return e&&((n=u(this,rr))==null?void 0:n.makeCommentColor(e,t))||null}getCommentDialogElement(){var e;return((e=u(this,rr))==null?void 0:e.dialogElement)||null}async waitForEditorsRendered(e){if(u(this,mn).has(e-1))return;const{resolve:t,promise:n}=Promise.withResolvers(),r=a=>{a.pageNumber===e&&(this._eventBus._off("editorsrendered",r),t())};this._eventBus.on("editorsrendered",r),await n}getSignature(e){var t;(t=u(this,Id))==null||t.getSignature({uiManager:this,editor:e})}get signatureManager(){return u(this,Id)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":N(this,Kp,t);break}}onPageChanging({pageNumber:e}){N(this,Yp,e-1)}focusMainContainer(){u(this,Wl).focus()}findParent(e,t){for(const n of u(this,mn).values()){const{x:r,y:a,width:o,height:l}=n.div.getBoundingClientRect();if(e>=r&&e<=r+o&&t>=a&&t<=a+l)return n}return null}disableUserSelect(e=!1){u(this,yb).classList.toggle("noUserSelect",e)}addShouldRescale(e){u(this,Ih).add(e)}removeShouldRescale(e){u(this,Ih).delete(e)}onScaleChanging({scale:e}){var t;this.commitOrRemove(),this.viewParameters.realScale=e*zu.PDF_TO_CSS_UNITS;for(const n of u(this,Ih))n.onScaleChanging();(t=u(this,Nd))==null||t.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e="",t=!1){const n=document.getSelection();if(!n||n.isCollapsed)return;const{anchorNode:r,anchorOffset:a,focusNode:o,focusOffset:l}=n,c=n.toString(),h=F(this,Oe,H1).call(this,n).closest(".textLayer"),f=this.getSelectionBoxes(h);if(!f)return;n.empty();const m=F(this,Oe,$T).call(this,h),p=u(this,nn)===pt.NONE,x=()=>{const g=m==null?void 0:m.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:f,anchorNode:r,anchorOffset:a,focusNode:o,focusOffset:l,text:c});p&&this.showAllEditors("highlight",!0,!0),t&&(g==null||g.editComment())};if(p){this.switchToMode(pt.HIGHLIGHT,x);return}x()}commentSelection(e=""){this.highlightSelection(e,!0)}getAndRemoveDataFromAnnotationStorage(e){if(!u(this,da))return null;const t=`${qv}${e}`,n=u(this,da).getRawValue(t);return n&&u(this,da).remove(t),n}addToAnnotationStorage(e){!e.isEmpty()&&u(this,da)&&!u(this,da).has(e.id)&&u(this,da).setValue(e.id,e)}a11yAlert(e,t=null){const n=u(this,vb);n&&(n.setAttribute("data-l10n-id",e),t?n.setAttribute("data-l10n-args",JSON.stringify(t)):n.removeAttribute("data-l10n-args"))}blur(){if(this.isShiftKeyDown=!1,u(this,Td)&&(N(this,Td,!1),F(this,Oe,Ay).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of u(this,Yt))if(t.div.contains(e)){N(this,Rh,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!u(this,Rh))return;const[e,t]=u(this,Rh);N(this,Rh,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){F(this,Oe,UT).call(this),this.setEditingState(!0)}removeEditListeners(){F(this,Oe,Yz).call(this),this.setEditingState(!1)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const n of u(this,ha))if(n.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const n of u(this,ha))if(n.isHandlingMimeForPasting(t.type)){n.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){var n;if(e.preventDefault(),(n=u(this,pi))==null||n.commitOrRemove(),!this.hasSelection)return;const t=[];for(const r of u(this,Yt)){const a=r.serialize(!0);a&&t.push(a)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const a of t.items)for(const o of u(this,ha))if(o.isHandlingMimeForPasting(a.type)){o.paste(a,this.currentLayer);return}let n=t.getData("application/pdfjs");if(!n)return;try{n=JSON.parse(n)}catch(a){ut(`paste: "${a.message}".`);return}if(!Array.isArray(n))return;this.unselectAll();const r=this.currentLayer;try{const a=[];for(const c of n){const d=await r.deserialize(c);if(!d)return;a.push(d)}const o=()=>{for(const c of a)F(this,Oe,zT).call(this,c);F(this,Oe,HT).call(this,a)},l=()=>{for(const c of a)c.remove()};this.addCommands({cmd:o,undo:l,mustExec:!0})}catch(a){ut(`paste: "${a.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),u(this,nn)!==pt.NONE&&!this.isEditorHandlingKeyboard&&pp._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,u(this,Td)&&(N(this,Td,!1),F(this,Oe,Ay).call(this,"main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}setEditingState(e){e?(F(this,Oe,qz).call(this),F(this,Oe,Kz).call(this),F(this,Oe,gr).call(this,{isEditing:u(this,nn)!==pt.NONE,isEmpty:F(this,Oe,_y).call(this),hasSomethingToUndo:u(this,ua).hasSomethingToUndo(),hasSomethingToRedo:u(this,ua).hasSomethingToRedo(),hasSelectedEditor:!1})):(F(this,Oe,Gz).call(this),F(this,Oe,Xz).call(this),F(this,Oe,gr).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!u(this,ha)){N(this,ha,e);for(const t of u(this,ha))F(this,Oe,Dl).call(this,t.defaultPropertiesToUpdate)}}getId(){return u(this,QS).id}get currentLayer(){return u(this,mn).get(u(this,Yp))}getLayer(e){return u(this,mn).get(e)}get currentPageIndex(){return u(this,Yp)}addLayer(e){u(this,mn).set(e.pageIndex,e),u(this,Ed)?e.enable():e.disable()}removeLayer(e){u(this,mn).delete(e.pageIndex)}async updateMode(e,t=null,n=!1,r=!1,a=!1){var o,l,c,d,h,f;if(u(this,nn)!==e&&!(u(this,fa)&&(await u(this,fa).promise,!u(this,fa)))){if(N(this,fa,Promise.withResolvers()),(o=u(this,Nd))==null||o.commitOrRemove(),u(this,nn)===pt.POPUP&&((l=u(this,rr))==null||l.hideSidebar()),(c=u(this,rr))==null||c.destroyPopup(),N(this,nn,e),e===pt.NONE){this.setEditingState(!1),F(this,Oe,Jz).call(this);for(const m of u(this,$s).values())m.hideStandaloneCommentButton();(d=this._editorUndoBar)==null||d.hide(),this.toggleComment(null),u(this,fa).resolve();return}for(const m of u(this,$s).values())m.addStandaloneCommentButton();e===pt.SIGNATURE&&await((h=u(this,Id))==null?void 0:h.loadSignatures()),this.setEditingState(!0),await F(this,Oe,Zz).call(this),this.unselectAll();for(const m of u(this,mn).values())m.updateMode(e);if(e===pt.POPUP){u(this,Wp)||N(this,Wp,await u(this,Jp).getAnnotationsByType(new Set(u(this,ha).map(x=>x._editorType))));const m=new Set,p=[];for(const x of u(this,$s).values()){const{annotationElementId:g,hasComment:b,deleted:v}=x;g&&m.add(g),b&&!v&&p.push(x.getData())}for(const x of u(this,Wp)){const{id:g,popupRef:b,contentsObj:v}=x;b&&(v!=null&&v.str)&&!m.has(g)&&!u(this,Ad).has(g)&&p.push(x)}(f=u(this,rr))==null||f.showSidebar(p)}if(!t){n&&this.addNewEditorFromKeyboard(),u(this,fa).resolve();return}for(const m of u(this,$s).values())m.uid===t?(this.setSelected(m),a?m.editComment():r?m.enterInEditMode():m.focus()):m.unselect();u(this,fa).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e.mode!==u(this,nn)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...e})}updateParams(e,t){if(u(this,ha)){switch(e){case Lt.CREATE:this.currentLayer.addNewEditor(t);return;case Lt.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(u(this,gb)||N(this,gb,new Map)).set(e,t),this.showAllEditors("highlight",t);break}if(this.hasSelection)for(const n of u(this,Yt))n.updateParams(e,t);else for(const n of u(this,ha))n.updateDefaultParams(e,t)}}showAllEditors(e,t,n=!1){var a;for(const o of u(this,$s).values())o.editorType===e&&o.show(t);(((a=u(this,gb))==null?void 0:a.get(Lt.HIGHLIGHT_SHOW_ALL))??!0)!==t&&F(this,Oe,Dl).call(this,[[Lt.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(u(this,mb)!==e){N(this,mb,e);for(const t of u(this,mn).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}*getEditors(e){for(const t of u(this,$s).values())t.pageIndex===e&&(yield t)}getEditor(e){return u(this,$s).get(e)}addEditor(e){u(this,$s).set(e.id,e)}removeEditor(e){var t,n;e.div.contains(document.activeElement)&&(u(this,Uo)&&clearTimeout(u(this,Uo)),N(this,Uo,setTimeout(()=>{this.focusMainContainer(),N(this,Uo,null)},0))),u(this,$s).delete(e.id),e.annotationElementId&&((t=u(this,Md))==null||t.delete(e.annotationElementId)),this.unselect(e),(!e.annotationElementId||!u(this,Ad).has(e.annotationElementId))&&((n=u(this,da))==null||n.remove(e.id))}addDeletedAnnotationElement(e){u(this,Ad).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return u(this,Ad).has(e)}removeDeletedAnnotationElement(e){u(this,Ad).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){u(this,pi)!==e&&(N(this,pi,e),e&&F(this,Oe,Dl).call(this,e.propertiesToUpdate))}updateUI(e){u(this,Oe,eH)===e&&F(this,Oe,Dl).call(this,e.propertiesToUpdate)}updateUIForDefaultProperties(e){F(this,Oe,Dl).call(this,e.defaultPropertiesToUpdate)}toggleSelected(e){if(u(this,Yt).has(e)){u(this,Yt).delete(e),e.unselect(),F(this,Oe,gr).call(this,{hasSelectedEditor:this.hasSelection});return}u(this,Yt).add(e),e.select(),F(this,Oe,Dl).call(this,e.propertiesToUpdate),F(this,Oe,gr).call(this,{hasSelectedEditor:!0})}setSelected(e){var t;this.updateToolbar({mode:e.mode,editId:e.uid}),(t=u(this,Nd))==null||t.commitOrRemove();for(const n of u(this,Yt))n!==e&&n.unselect();u(this,Yt).clear(),u(this,Yt).add(e),e.select(),F(this,Oe,Dl).call(this,e.propertiesToUpdate),F(this,Oe,gr).call(this,{hasSelectedEditor:!0})}isSelected(e){return u(this,Yt).has(e)}get firstSelectedEditor(){return u(this,Yt).values().next().value}unselect(e){e.unselect(),u(this,Yt).delete(e),F(this,Oe,gr).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return u(this,Yt).size!==0}get isEnterHandled(){return u(this,Yt).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var e;u(this,ua).undo(),F(this,Oe,gr).call(this,{hasSomethingToUndo:u(this,ua).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:F(this,Oe,_y).call(this)}),(e=this._editorUndoBar)==null||e.hide()}redo(){u(this,ua).redo(),F(this,Oe,gr).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:u(this,ua).hasSomethingToRedo(),isEmpty:F(this,Oe,_y).call(this)})}addCommands(e){u(this,ua).add(e),F(this,Oe,gr).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:F(this,Oe,_y).call(this)})}cleanUndoStack(e){u(this,ua).cleanType(e)}delete(){var a;this.commitOrRemove();const e=(a=this.currentLayer)==null?void 0:a.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...u(this,Yt)],n=()=>{var o;(o=this._editorUndoBar)==null||o.show(r,t.length===1?t[0].editorType:t.length);for(const l of t)l.remove()},r=()=>{for(const o of t)F(this,Oe,zT).call(this,o)};this.addCommands({cmd:n,undo:r,mustExec:!0})}commitOrRemove(){var e;(e=u(this,pi))==null||e.commitOrRemove()}hasSomethingToControl(){return u(this,pi)||this.hasSelection}selectAll(){for(const e of u(this,Yt))e.commit();F(this,Oe,HT).call(this,u(this,$s).values())}unselectAll(){var e;if(!(u(this,pi)&&(u(this,pi).commitOrRemove(),u(this,nn)!==pt.NONE))&&!((e=u(this,Nd))!=null&&e.commitOrRemove())&&this.hasSelection){for(const t of u(this,Yt))t.unselect();u(this,Yt).clear(),F(this,Oe,gr).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,n=!1){if(n||this.commitOrRemove(),!this.hasSelection)return;u(this,Dd)[0]+=e,u(this,Dd)[1]+=t;const[r,a]=u(this,Dd),o=[...u(this,Yt)],l=1e3;u(this,Ho)&&clearTimeout(u(this,Ho)),N(this,Ho,setTimeout(()=>{N(this,Ho,null),u(this,Dd)[0]=u(this,Dd)[1]=0,this.addCommands({cmd:()=>{for(const c of o)u(this,$s).has(c.id)&&(c.translateInPage(r,a),c.translationDone())},undo:()=>{for(const c of o)u(this,$s).has(c.id)&&(c.translateInPage(-r,-a),c.translationDone())},mustExec:!1})},l));for(const c of o)c.translateInPage(e,t),c.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),N(this,$o,new Map);for(const e of u(this,Yt))u(this,$o).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!u(this,$o))return!1;this.disableUserSelect(!1);const e=u(this,$o);N(this,$o,null);let t=!1;for(const[{x:r,y:a,pageIndex:o},l]of e)l.newX=r,l.newY=a,l.newPageIndex=o,t||(t=r!==l.savedX||a!==l.savedY||o!==l.savedPageIndex);if(!t)return!1;const n=(r,a,o,l)=>{if(u(this,$s).has(r.id)){const c=u(this,mn).get(l);c?r._setParentAndPosition(c,a,o):(r.pageIndex=l,r.x=a,r.y=o)}};return this.addCommands({cmd:()=>{for(const[r,{newX:a,newY:o,newPageIndex:l}]of e)n(r,a,o,l)},undo:()=>{for(const[r,{savedX:a,savedY:o,savedPageIndex:l}]of e)n(r,a,o,l)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(u(this,$o))for(const n of u(this,$o).keys())n.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){var e;return((e=this.getActive())==null?void 0:e.shouldGetKeyboardEvents())||u(this,Yt).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return u(this,pi)===e}getActive(){return u(this,pi)}getMode(){return u(this,nn)}isEditingMode(){return u(this,nn)!==pt.NONE}get imageManager(){return bt(this,"imageManager",new FT)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let d=0,h=t.rangeCount;d<h;d++)if(!e.contains(t.getRangeAt(d).commonAncestorContainer))return null;const{x:n,y:r,width:a,height:o}=e.getBoundingClientRect();let l;switch(e.getAttribute("data-main-rotation")){case"90":l=(d,h,f,m)=>({x:(h-r)/o,y:1-(d+f-n)/a,width:m/o,height:f/a});break;case"180":l=(d,h,f,m)=>({x:1-(d+f-n)/a,y:1-(h+m-r)/o,width:f/a,height:m/o});break;case"270":l=(d,h,f,m)=>({x:1-(h+m-r)/o,y:(d-n)/a,width:m/o,height:f/a});break;default:l=(d,h,f,m)=>({x:(d-n)/a,y:(h-r)/o,width:f/a,height:m/o});break}const c=[];for(let d=0,h=t.rangeCount;d<h;d++){const f=t.getRangeAt(d);if(!f.collapsed)for(const{x:m,y:p,width:x,height:g}of f.getClientRects())x===0||g===0||c.push(l(m,p,x,g))}return c.length===0?null:c}addChangedExistingAnnotation({annotationElementId:e,id:t}){(u(this,Gp)||N(this,Gp,new Map)).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){var t;(t=u(this,Gp))==null||t.delete(e)}renderAnnotationElement(e){var r;const t=(r=u(this,Gp))==null?void 0:r.get(e.data.id);if(!t)return;const n=u(this,da).getRawValue(t);n&&(u(this,nn)===pt.NONE&&!n.hasBeenModified||n.renderAnnotationElement(e))}setMissingCanvas(e,t,n){var a;const r=(a=u(this,Md))==null?void 0:a.get(e);r&&(r.setCanvas(t,n),u(this,Md).delete(e))}addMissingCanvas(e,t){(u(this,Md)||N(this,Md,new Map)).set(e,t)}};Vp=new WeakMap,pi=new WeakMap,Wp=new WeakMap,$s=new WeakMap,mn=new WeakMap,qp=new WeakMap,da=new WeakMap,Gp=new WeakMap,ua=new WeakMap,rr=new WeakMap,kd=new WeakMap,Nd=new WeakMap,Yp=new WeakMap,Ad=new WeakMap,$o=new WeakMap,ha=new WeakMap,Ih=new WeakMap,ub=new WeakMap,hb=new WeakMap,Kp=new WeakMap,fb=new WeakMap,Uo=new WeakMap,_d=new WeakMap,Xp=new WeakMap,Td=new WeakMap,zo=new WeakMap,QS=new WeakMap,Ed=new WeakMap,Qp=new WeakMap,mb=new WeakMap,Pd=new WeakMap,Rh=new WeakMap,Zp=new WeakMap,Md=new WeakMap,pb=new WeakMap,nn=new WeakMap,Yt=new WeakMap,Vl=new WeakMap,Id=new WeakMap,Rd=new WeakMap,gb=new WeakMap,Jp=new WeakMap,xb=new WeakMap,Dd=new WeakMap,Ho=new WeakMap,Wl=new WeakMap,yb=new WeakMap,vb=new WeakMap,fa=new WeakMap,Oe=new WeakSet,H1=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},$T=function(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const n of u(this,mn).values())if(n.hasTextLayer(e))return n;return null},Hz=function(){const e=document.getSelection();if(!e||e.isCollapsed)return;const n=F(this,Oe,H1).call(this,e).closest(".textLayer"),r=this.getSelectionBoxes(n);r&&(u(this,zo)||N(this,zo,new hue(this)),u(this,zo).show(n,r,this.direction==="ltr"))},Vz=function(){var a,o,l;const e=document.getSelection();if(!e||e.isCollapsed){u(this,Vl)&&((a=u(this,zo))==null||a.hide(),N(this,Vl,null),F(this,Oe,gr).call(this,{hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===u(this,Vl))return;const r=F(this,Oe,H1).call(this,e).closest(".textLayer");if(!r){u(this,Vl)&&((o=u(this,zo))==null||o.hide(),N(this,Vl,null),F(this,Oe,gr).call(this,{hasSelectedText:!1}));return}if((l=u(this,zo))==null||l.hide(),N(this,Vl,t),F(this,Oe,gr).call(this,{hasSelectedText:!0}),!(u(this,nn)!==pt.HIGHLIGHT&&u(this,nn)!==pt.NONE)&&(u(this,nn)===pt.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),N(this,Td,this.isShiftKeyDown),!this.isShiftKeyDown)){const c=u(this,nn)===pt.HIGHLIGHT?F(this,Oe,$T).call(this,r):null;if(c==null||c.toggleDrawing(),u(this,Qp)){const d=new AbortController,h=this.combinedSignal(d),f=m=>{m.type==="pointerup"&&m.button!==0||(d.abort(),c==null||c.toggleDrawing(!0),m.type==="pointerup"&&F(this,Oe,Ay).call(this,"main_toolbar"))};window.addEventListener("pointerup",f,{signal:h}),window.addEventListener("blur",f,{signal:h})}else c==null||c.toggleDrawing(!0),F(this,Oe,Ay).call(this,"main_toolbar")}},Ay=function(e=""){u(this,nn)===pt.HIGHLIGHT?this.highlightSelection(e):u(this,ub)&&F(this,Oe,Hz).call(this)},Wz=function(){document.addEventListener("selectionchange",F(this,Oe,Vz).bind(this),{signal:this._signal})},qz=function(){if(u(this,_d))return;N(this,_d,new AbortController);const e=this.combinedSignal(u(this,_d));window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})},Gz=function(){var e;(e=u(this,_d))==null||e.abort(),N(this,_d,null)},UT=function(){if(u(this,Pd))return;N(this,Pd,new AbortController);const e=this.combinedSignal(u(this,Pd));window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})},Yz=function(){var e;(e=u(this,Pd))==null||e.abort(),N(this,Pd,null)},Kz=function(){if(u(this,kd))return;N(this,kd,new AbortController);const e=this.combinedSignal(u(this,kd));document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})},Xz=function(){var e;(e=u(this,kd))==null||e.abort(),N(this,kd,null)},Qz=function(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})},gr=function(e){Object.entries(e).some(([n,r])=>u(this,xb)[n]!==r)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(u(this,xb),e)}),u(this,nn)===pt.HIGHLIGHT&&e.hasSelectedEditor===!1&&F(this,Oe,Dl).call(this,[[Lt.HIGHLIGHT_FREE,!0]]))},Dl=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},Zz=async function(){if(!u(this,Ed)){N(this,Ed,!0);const e=[];for(const t of u(this,mn).values())e.push(t.enable());await Promise.all(e);for(const t of u(this,$s).values())t.enable()}},Jz=function(){if(this.unselectAll(),u(this,Ed)){N(this,Ed,!1);for(const e of u(this,mn).values())e.disable();for(const e of u(this,$s).values())e.disable()}},zT=function(e){const t=u(this,mn).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},eH=function(){let e=null;for(e of u(this,Yt));return e},_y=function(){if(u(this,$s).size===0)return!0;if(u(this,$s).size===1)for(const e of u(this,$s).values())return e.isEmpty();return!1},HT=function(e){for(const t of u(this,Yt))t.unselect();u(this,Yt).clear();for(const t of e)t.isEmpty()||(u(this,Yt).add(t),t.select());F(this,Oe,gr).call(this,{hasSelectedEditor:this.hasSelection})},Ce(pp,"TRANSLATE_SMALL",1),Ce(pp,"TRANSLATE_BIG",10);let pm=pp;var wn,Vo,Ka,eg,Wo,gi,tg,qo,qr,ql,Dh,Go,Ld,xo,Ty,V1;const xr=class xr{constructor(e){E(this,xo);E(this,wn,null);E(this,Vo,!1);E(this,Ka,null);E(this,eg,null);E(this,Wo,null);E(this,gi,null);E(this,tg,!1);E(this,qo,null);E(this,qr,null);E(this,ql,null);E(this,Dh,null);E(this,Go,!1);N(this,qr,e),N(this,Go,e._uiManager.useNewAltTextFlow),u(xr,Ld)||N(xr,Ld,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(e){xr._l10n??(xr._l10n=e)}async render(){const e=N(this,Ka,document.createElement("button"));e.className="altText",e.tabIndex="0";const t=N(this,eg,document.createElement("span"));e.append(t),u(this,Go)?(e.classList.add("new"),e.setAttribute("data-l10n-id",u(xr,Ld).missing),t.setAttribute("data-l10n-id",u(xr,Ld)["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const n=u(this,qr)._uiManager._signal;e.addEventListener("contextmenu",La,{signal:n}),e.addEventListener("pointerdown",a=>a.stopPropagation(),{signal:n});const r=a=>{a.preventDefault(),u(this,qr)._uiManager.editAltText(u(this,qr)),u(this,Go)&&u(this,qr)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:u(this,xo,Ty)}})};return e.addEventListener("click",r,{capture:!0,signal:n}),e.addEventListener("keydown",a=>{a.target===e&&a.key==="Enter"&&(N(this,tg,!0),r(a))},{signal:n}),await F(this,xo,V1).call(this),e}finish(){u(this,Ka)&&(u(this,Ka).focus({focusVisible:u(this,tg)}),N(this,tg,!1))}isEmpty(){return u(this,Go)?u(this,wn)===null:!u(this,wn)&&!u(this,Vo)}hasData(){return u(this,Go)?u(this,wn)!==null||!!u(this,ql):this.isEmpty()}get guessedText(){return u(this,ql)}async setGuessedText(e){u(this,wn)===null&&(N(this,ql,e),N(this,Dh,await xr._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e})),F(this,xo,V1).call(this))}toggleAltTextBadge(e=!1){var t;if(!u(this,Go)||u(this,wn)){(t=u(this,qo))==null||t.remove(),N(this,qo,null);return}if(!u(this,qo)){const n=N(this,qo,document.createElement("div"));n.className="noAltTextBadge",u(this,qr).div.append(n)}u(this,qo).classList.toggle("hidden",!e)}serialize(e){let t=u(this,wn);return!e&&u(this,ql)===t&&(t=u(this,Dh)),{altText:t,decorative:u(this,Vo),guessedText:u(this,ql),textWithDisclaimer:u(this,Dh)}}get data(){return{altText:u(this,wn),decorative:u(this,Vo)}}set data({altText:e,decorative:t,guessedText:n,textWithDisclaimer:r,cancel:a=!1}){n&&(N(this,ql,n),N(this,Dh,r)),!(u(this,wn)===e&&u(this,Vo)===t)&&(a||(N(this,wn,e),N(this,Vo,t)),F(this,xo,V1).call(this))}toggle(e=!1){u(this,Ka)&&(!e&&u(this,gi)&&(clearTimeout(u(this,gi)),N(this,gi,null)),u(this,Ka).disabled=!e)}shown(){u(this,qr)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:u(this,xo,Ty)}})}destroy(){var e,t;(e=u(this,Ka))==null||e.remove(),N(this,Ka,null),N(this,eg,null),N(this,Wo,null),(t=u(this,qo))==null||t.remove(),N(this,qo,null)}};wn=new WeakMap,Vo=new WeakMap,Ka=new WeakMap,eg=new WeakMap,Wo=new WeakMap,gi=new WeakMap,tg=new WeakMap,qo=new WeakMap,qr=new WeakMap,ql=new WeakMap,Dh=new WeakMap,Go=new WeakMap,Ld=new WeakMap,xo=new WeakSet,Ty=function(){return u(this,wn)&&"added"||u(this,wn)===null&&this.guessedText&&"review"||"missing"},V1=async function(){var r,a,o;const e=u(this,Ka);if(!e)return;if(u(this,Go)){if(e.classList.toggle("done",!!u(this,wn)),e.setAttribute("data-l10n-id",u(xr,Ld)[u(this,xo,Ty)]),(r=u(this,eg))==null||r.setAttribute("data-l10n-id",u(xr,Ld)[`${u(this,xo,Ty)}-label`]),!u(this,wn)){(a=u(this,Wo))==null||a.remove();return}}else{if(!u(this,wn)&&!u(this,Vo)){e.classList.remove("done"),(o=u(this,Wo))==null||o.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=u(this,Wo);if(!t){N(this,Wo,t=document.createElement("span")),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${u(this,qr).id}`;const l=100,c=u(this,qr)._uiManager._signal;c.addEventListener("abort",()=>{clearTimeout(u(this,gi)),N(this,gi,null)},{once:!0}),e.addEventListener("mouseenter",()=>{N(this,gi,setTimeout(()=>{N(this,gi,null),u(this,Wo).classList.add("show"),u(this,qr)._reportTelemetry({action:"alt_text_tooltip"})},l))},{signal:c}),e.addEventListener("mouseleave",()=>{var d;u(this,gi)&&(clearTimeout(u(this,gi)),N(this,gi,null)),(d=u(this,Wo))==null||d.classList.remove("show")},{signal:c})}u(this,Vo)?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=u(this,wn)),t.parentNode||e.append(t);const n=u(this,qr).getElementForAltText();n==null||n.setAttribute("aria-describedby",t.id)},E(xr,Ld,null),Ce(xr,"_l10n",null);let PS=xr;var Fn,ma,Lh,hs,bb,Oh,Xa,Fh,Bh,$h,wb,VT;class i1{constructor(e){E(this,wb);E(this,Fn,null);E(this,ma,null);E(this,Lh,!1);E(this,hs,null);E(this,bb,null);E(this,Oh,null);E(this,Xa,null);E(this,Fh,null);E(this,Bh,!1);E(this,$h,null);N(this,hs,e)}renderForToolbar(){const e=N(this,ma,document.createElement("button"));return e.className="comment",F(this,wb,VT).call(this,e,!1)}renderForStandalone(){const e=N(this,Fn,document.createElement("button"));e.className="annotationCommentButton";const t=u(this,hs).commentButtonPosition;if(t){const{style:n}=e;n.insetInlineEnd=`calc(${100*(u(this,hs)._uiManager.direction==="ltr"?1-t[0]:t[0])}% - var(--comment-button-dim))`,n.top=`calc(${100*t[1]}% - var(--comment-button-dim))`;const r=u(this,hs).commentButtonColor;r&&(n.backgroundColor=r)}return F(this,wb,VT).call(this,e,!0)}focusButton(){setTimeout(()=>{var e;(e=u(this,Fn)??u(this,ma))==null||e.focus()},0)}onUpdatedColor(){if(!u(this,Fn))return;const e=u(this,hs).commentButtonColor;e&&(u(this,Fn).style.backgroundColor=e),u(this,hs)._uiManager.updatePopupColor(u(this,hs))}get commentButtonWidth(){var e;return(((e=u(this,Fn))==null?void 0:e.getBoundingClientRect().width)??0)/u(this,hs).parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(u(this,$h))return u(this,$h);if(!u(this,Fn))return null;const{x:e,y:t,height:n}=u(this,Fn).getBoundingClientRect(),{x:r,y:a,width:o,height:l}=u(this,hs).parent.boundingClientRect;return[(e-r)/o,(t+n-a)/l]}set commentPopupPositionInLayer(e){N(this,$h,e)}hasDefaultPopupPosition(){return u(this,$h)===null}removeStandaloneCommentButton(){var e;(e=u(this,Fn))==null||e.remove(),N(this,Fn,null)}removeToolbarCommentButton(){var e;(e=u(this,ma))==null||e.remove(),N(this,ma,null)}setCommentButtonStates({selected:e,hasPopup:t}){u(this,Fn)&&(u(this,Fn).classList.toggle("selected",e),u(this,Fn).ariaExpanded=t)}edit(e){const t=this.commentPopupPositionInLayer;let n,r;if(t)[n,r]=t;else{[n,r]=u(this,hs).commentButtonPosition;const{width:h,height:f,x:m,y:p}=u(this,hs);n=m+n*h,r=p+r*f}const a=u(this,hs).parent.boundingClientRect,{x:o,y:l,width:c,height:d}=a;u(this,hs)._uiManager.editComment(u(this,hs),o+n*c,l+r*d,{...e,parentDimensions:a})}finish(){u(this,ma)&&(u(this,ma).focus({focusVisible:u(this,Lh)}),N(this,Lh,!1))}isDeleted(){return u(this,Bh)||u(this,Xa)===""}isEmpty(){return u(this,Xa)===null}hasBeenEdited(){return this.isDeleted()||u(this,Xa)!==u(this,bb)}serialize(){return this.data}get data(){return{text:u(this,Xa),richText:u(this,Oh),date:u(this,Fh),deleted:this.isDeleted()}}set data(e){if(e!==u(this,Xa)&&N(this,Oh,null),e===null){N(this,Xa,""),N(this,Bh,!0);return}N(this,Xa,e),N(this,Fh,new Date),N(this,Bh,!1)}setInitialText(e,t=null){N(this,bb,e),this.data=e,N(this,Fh,null),N(this,Oh,t)}shown(){}destroy(){var e,t;(e=u(this,ma))==null||e.remove(),N(this,ma,null),(t=u(this,Fn))==null||t.remove(),N(this,Fn,null),N(this,Xa,""),N(this,Oh,null),N(this,Fh,null),N(this,hs,null),N(this,Lh,!1),N(this,Bh,!1)}}Fn=new WeakMap,ma=new WeakMap,Lh=new WeakMap,hs=new WeakMap,bb=new WeakMap,Oh=new WeakMap,Xa=new WeakMap,Fh=new WeakMap,Bh=new WeakMap,$h=new WeakMap,wb=new WeakSet,VT=function(e,t){if(!u(this,hs)._uiManager.hasCommentManager())return null;e.tabIndex="0",e.ariaHasPopup="dialog",t?(e.ariaControls="commentPopup",e.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(e.ariaControlsElements=[u(this,hs)._uiManager.getCommentDialogElement()],e.setAttribute("data-l10n-id","pdfjs-editor-add-comment-button"));const n=u(this,hs)._uiManager._signal;if(!(n instanceof AbortSignal)||n.aborted)return e;e.addEventListener("contextmenu",La,{signal:n}),t&&(e.addEventListener("focusin",a=>{u(this,hs)._focusEventsAllowed=!1,Gs(a)},{capture:!0,signal:n}),e.addEventListener("focusout",a=>{u(this,hs)._focusEventsAllowed=!0,Gs(a)},{capture:!0,signal:n})),e.addEventListener("pointerdown",a=>a.stopPropagation(),{signal:n});const r=a=>{a.preventDefault(),e===u(this,ma)?this.edit():u(this,hs).toggleComment(!0)};return e.addEventListener("click",r,{capture:!0,signal:n}),e.addEventListener("keydown",a=>{a.target===e&&a.key==="Enter"&&(N(this,Lh,!0),r(a))},{signal:n}),e.addEventListener("pointerenter",()=>{u(this,hs).toggleComment(!1,!0)},{signal:n}),e.addEventListener("pointerleave",()=>{u(this,hs).toggleComment(!1,!1)},{signal:n}),e};var sg,Uh,Cb,Sb,jb,kb,Nb,Gl,zh,Yl,Hh,Kl,Hu,tH,sH,nH;const rI=class rI{constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:n=null,onPinchStart:r=null,onPinching:a=null,onPinchEnd:o=null,signal:l}){E(this,Hu);E(this,sg);E(this,Uh,!1);E(this,Cb,null);E(this,Sb);E(this,jb);E(this,kb);E(this,Nb);E(this,Gl,null);E(this,zh);E(this,Yl,null);E(this,Hh);E(this,Kl,null);N(this,sg,e),N(this,Cb,n),N(this,Sb,t),N(this,jb,r),N(this,kb,a),N(this,Nb,o),N(this,Hh,new AbortController),N(this,zh,AbortSignal.any([l,u(this,Hh).signal])),e.addEventListener("touchstart",F(this,Hu,tH).bind(this),{passive:!1,signal:u(this,zh)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/Cl.pixelRatio}destroy(){var e,t;(e=u(this,Hh))==null||e.abort(),N(this,Hh,null),(t=u(this,Gl))==null||t.abort(),N(this,Gl,null)}};sg=new WeakMap,Uh=new WeakMap,Cb=new WeakMap,Sb=new WeakMap,jb=new WeakMap,kb=new WeakMap,Nb=new WeakMap,Gl=new WeakMap,zh=new WeakMap,Yl=new WeakMap,Hh=new WeakMap,Kl=new WeakMap,Hu=new WeakSet,tH=function(e){var r,a,o;if((r=u(this,Sb))!=null&&r.call(this))return;if(e.touches.length===1){if(u(this,Gl))return;const l=N(this,Gl,new AbortController),c=AbortSignal.any([u(this,zh),l.signal]),d=u(this,sg),h={capture:!0,signal:c,passive:!1},f=m=>{var p;m.pointerType==="touch"&&((p=u(this,Gl))==null||p.abort(),N(this,Gl,null))};d.addEventListener("pointerdown",m=>{m.pointerType==="touch"&&(Gs(m),f(m))},h),d.addEventListener("pointerup",f,h),d.addEventListener("pointercancel",f,h);return}if(!u(this,Kl)){N(this,Kl,new AbortController);const l=AbortSignal.any([u(this,zh),u(this,Kl).signal]),c=u(this,sg),d={signal:l,capture:!1,passive:!1};c.addEventListener("touchmove",F(this,Hu,sH).bind(this),d);const h=F(this,Hu,nH).bind(this);c.addEventListener("touchend",h,d),c.addEventListener("touchcancel",h,d),d.capture=!0,c.addEventListener("pointerdown",Gs,d),c.addEventListener("pointermove",Gs,d),c.addEventListener("pointercancel",Gs,d),c.addEventListener("pointerup",Gs,d),(a=u(this,jb))==null||a.call(this)}if(Gs(e),e.touches.length!==2||(o=u(this,Cb))!=null&&o.call(this)){N(this,Yl,null);return}let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]),N(this,Yl,{touch0X:t.screenX,touch0Y:t.screenY,touch1X:n.screenX,touch1Y:n.screenY})},sH=function(e){var S;if(!u(this,Yl)||e.touches.length!==2)return;Gs(e);let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]);const{screenX:r,screenY:a}=t,{screenX:o,screenY:l}=n,c=u(this,Yl),{touch0X:d,touch0Y:h,touch1X:f,touch1Y:m}=c,p=f-d,x=m-h,g=o-r,b=l-a,v=Math.hypot(g,b)||1,y=Math.hypot(p,x)||1;if(!u(this,Uh)&&Math.abs(y-v)<=rI.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(c.touch0X=r,c.touch0Y=a,c.touch1X=o,c.touch1Y=l,!u(this,Uh)){N(this,Uh,!0);return}const w=[(r+o)/2,(a+l)/2];(S=u(this,kb))==null||S.call(this,w,y,v)},nH=function(e){var t;e.touches.length>=2||(u(this,Kl)&&(u(this,Kl).abort(),N(this,Kl,null),(t=u(this,Nb))==null||t.call(this)),u(this,Yl)&&(Gs(e),N(this,Yl,null),N(this,Uh,!1)))};let MS=rI;var Vh,Qa,As,as,Xl,ng,Od,Ab,Bn,Wh,Ql,pa,Fd,_b,qh,xi,Tb,Gh,Zl,Yo,rg,ig,ga,Yh,Eb,ZS,at,WT,Pb,qT,W1,rH,iH,GT,q1,YT,aH,oH,lH,KT,cH,XT,dH,uH,hH,QT,Ey;const mt=class mt{constructor(e){E(this,at);E(this,Vh,null);E(this,Qa,null);E(this,As,null);E(this,as,null);E(this,Xl,null);E(this,ng,!1);E(this,Od,null);E(this,Ab,"");E(this,Bn,null);E(this,Wh,null);E(this,Ql,null);E(this,pa,null);E(this,Fd,null);E(this,_b,"");E(this,qh,!1);E(this,xi,null);E(this,Tb,!1);E(this,Gh,!1);E(this,Zl,!1);E(this,Yo,null);E(this,rg,0);E(this,ig,0);E(this,ga,null);E(this,Yh,null);Ce(this,"isSelected",!1);Ce(this,"_isCopy",!1);Ce(this,"_editToolbar",null);Ce(this,"_initialOptions",Object.create(null));Ce(this,"_initialData",null);Ce(this,"_isVisible",!0);Ce(this,"_uiManager",null);Ce(this,"_focusEventsAllowed",!0);E(this,Eb,!1);E(this,ZS,mt._zIndex++);this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null,this.annotationElementId=e.annotationElementId||null,this.creationDate=e.creationDate||new Date,this.modificationDate=e.modificationDate||null,this.canAddComment=!0;const{rotation:t,rawDims:{pageWidth:n,pageHeight:r,pageX:a,pageY:o}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,r],this.pageTranslation=[a,o];const[l,c]=this.parentDimensions;this.x=e.x/l,this.y=e.y/c,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const e=mt.prototype._resizeWithKeyboard,t=pm.TRANSLATE_SMALL,n=pm.TRANSLATE_BIG;return bt(this,"_resizerKeyboardManager",new mw([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,n]}],[["Escape","mac+Escape"],mt.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return bt(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new pue({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(mt._l10n??(mt._l10n=e),mt._l10nResizer||(mt._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),mt._borderLineWidth!==-1)return;const n=getComputedStyle(document.documentElement);mt._borderLineWidth=parseFloat(n.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){ds("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return u(this,Eb)}set _isDraggable(e){var t;N(this,Eb,e),(t=this.div)==null||t.classList.toggle("draggable",e)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=u(this,ZS)}setParent(e){var t;e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):(F(this,at,Ey).call(this),(t=u(this,pa))==null||t.remove(),N(this,pa,null)),this.parent=e}focusin(e){this._focusEventsAllowed&&(u(this,qh)?N(this,qh,!1):this.parent.setSelected(this))}focusout(e){var n;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const t=e.relatedTarget;t!=null&&t.closest(`#${this.id}`)||(e.preventDefault(),(n=this.parent)!=null&&n.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,n,r){const[a,o]=this.parentDimensions;[n,r]=this.screenToPageTranslation(n,r),this.x=(e+n)/a,this.y=(t+r)/o,this.fixAndSetPosition()}_moveAfterPaste(e,t){const[n,r]=this.parentDimensions;this.setAt(e*n,t*r,this.width*n,this.height*r),this._onTranslated()}translate(e,t){F(this,at,WT).call(this,this.parentDimensions,e,t)}translateInPage(e,t){u(this,xi)||N(this,xi,[this.x,this.y,this.width,this.height]),F(this,at,WT).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(e,t){u(this,xi)||N(this,xi,[this.x,this.y,this.width,this.height]);const{div:n,parentDimensions:[r,a]}=this;if(this.x+=e/r,this.y+=t/a,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:f,y:m}=this.div.getBoundingClientRect();this.parent.findNewParent(this,f,m)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:o,y:l}=this;const[c,d]=this.getBaseTranslation();o+=c,l+=d;const{style:h}=n;h.left=`${(100*o).toFixed(2)}%`,h.top=`${(100*l).toFixed(2)}%`,this._onTranslating(o,l),n.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!u(this,xi)&&(u(this,xi)[0]!==this.x||u(this,xi)[1]!==this.y)}get _hasBeenResized(){return!!u(this,xi)&&(u(this,xi)[2]!==this.width||u(this,xi)[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:n}=mt,r=n/e,a=n/t;switch(this.rotation){case 90:return[-r,a];case 180:return[r,a];case 270:return[r,-a];default:return[-r,-a]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[n,r]}=this;let{x:a,y:o,width:l,height:c}=this;if(l*=n,c*=r,a*=n,o*=r,this._mustFixPosition)switch(e){case 0:a=jr(a,0,n-l),o=jr(o,0,r-c);break;case 90:a=jr(a,0,n-c),o=jr(o,l,r);break;case 180:a=jr(a,l,n),o=jr(o,c,r);break;case 270:a=jr(a,c,n),o=jr(o,0,r-l);break}this.x=a/=n,this.y=o/=r;const[d,h]=this.getBaseTranslation();a+=d,o+=h,t.left=`${(100*a).toFixed(2)}%`,t.top=`${(100*o).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){var n;return F(n=mt,Pb,qT).call(n,e,t,this.parentRotation)}pageTranslationToScreen(e,t){var n;return F(n=mt,Pb,qT).call(n,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,n]}=this;return[t*e,n*e]}setDims(){const{div:{style:e},width:t,height:n}=this;e.width=`${(100*t).toFixed(2)}%`,e.height=`${(100*n).toFixed(2)}%`}getInitialTranslation(){return[0,0]}_onResized(){}static _round(e){return Math.round(e*1e4)/1e4}_onResizing(){}altTextFinish(){var e;(e=u(this,As))==null||e.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||u(this,Gh))return this._editToolbar;this._editToolbar=new LT(this),this.div.append(this._editToolbar.render());const{toolbarButtons:e}=this;if(e)for(const[t,n]of e)await this._editToolbar.addButton(t,n);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){var e;(e=this._editToolbar)==null||e.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){var e;(e=this._editToolbar)==null||e.removeButton("comment")}removeEditToolbar(){var e,t;(e=this._editToolbar)==null||e.remove(),this._editToolbar=null,(t=u(this,As))==null||t.destroy()}addContainer(e){var n;const t=(n=this._editToolbar)==null?void 0:n.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return u(this,As)||(PS.initialize(mt._l10n),N(this,As,new PS(this)),u(this,Vh)&&(u(this,As).data=u(this,Vh),N(this,Vh,null))),u(this,As)}get altTextData(){var e;return(e=u(this,As))==null?void 0:e.data}set altTextData(e){u(this,As)&&(u(this,As).data=e)}get guessedAltText(){var e;return(e=u(this,As))==null?void 0:e.guessedText}async setGuessedAltText(e){var t;await((t=u(this,As))==null?void 0:t.setGuessedText(e))}serializeAltText(e){var t;return(t=u(this,As))==null?void 0:t.serialize(e)}hasAltText(){return!!u(this,As)&&!u(this,As).isEmpty()}hasAltTextData(){var e;return((e=u(this,As))==null?void 0:e.hasData())??!1}focusCommentButton(){var e;(e=u(this,as))==null||e.focusButton()}addCommentButton(){return this.canAddComment?u(this,as)||N(this,as,new i1(this)):null}addStandaloneCommentButton(){if(this._uiManager.hasCommentManager()){if(u(this,Xl)){this._uiManager.isEditingMode()&&u(this,Xl).classList.remove("hidden");return}this.hasComment&&(N(this,Xl,u(this,as).renderForStandalone()),this.div.append(u(this,Xl)))}}removeStandaloneCommentButton(){u(this,as).removeStandaloneCommentButton(),N(this,Xl,null)}hideStandaloneCommentButton(){var e;(e=u(this,Xl))==null||e.classList.add("hidden")}get comment(){const{data:{richText:e,text:t,date:n,deleted:r}}=u(this,as);return{text:t,richText:e,date:n,deleted:r,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(e){u(this,as)||N(this,as,new i1(this)),u(this,as).data=e,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:e,popupRef:t,richText:n}){if(!t||(u(this,as)||N(this,as,new i1(this)),u(this,as).setInitialText(e,n),!this.annotationElementId))return;const r=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);r&&this.updateFromAnnotationLayer(r)}get hasEditedComment(){var e;return(e=u(this,as))==null?void 0:e.hasBeenEdited()}get hasDeletedComment(){var e;return(e=u(this,as))==null?void 0:e.isDeleted()}get hasComment(){return!!u(this,as)&&!u(this,as).isEmpty()&&!u(this,as).isDeleted()}async editComment(e){u(this,as)||N(this,as,new i1(this)),u(this,as).edit(e)}toggleComment(e,t=void 0){this.hasComment&&this._uiManager.toggleComment(this,e,t)}setSelectedCommentButton(e){u(this,as).setSelectedButton(e)}addComment(e){if(this.hasEditedComment){const[,,,r]=e.rect,[a]=this.pageDimensions,[o]=this.pageTranslation,l=o+a+1,c=r-100,d=l+180;e.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[l,c,d,r]}}}updateFromAnnotationLayer({popup:{contents:e,deleted:t}}){u(this,as).data=t?null:e}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){var o;const e=this.div=document.createElement("div");e.setAttribute("data-editor-rotation",(360-this.rotation)%360),e.className=this.name,e.setAttribute("id",this.id),e.tabIndex=u(this,ng)?-1:0,e.setAttribute("role","application"),this.defaultL10nId&&e.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||e.classList.add("hidden"),this.setInForeground(),F(this,at,XT).call(this);const[t,n]=this.parentDimensions;this.parentRotation%180!==0&&(e.style.maxWidth=`${(100*n/t).toFixed(2)}%`,e.style.maxHeight=`${(100*t/n).toFixed(2)}%`);const[r,a]=this.getInitialTranslation();return this.translate(r,a),Uz(this,e,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(u(this,Yh)||N(this,Yh,new MS({container:e,isPinchingDisabled:()=>!this.isSelected,onPinchStart:F(this,at,aH).bind(this),onPinching:F(this,at,oH).bind(this),onPinchEnd:F(this,at,lH).bind(this),signal:this._uiManager._signal}))),this.addStandaloneCommentButton(),(o=this._uiManager._editorUndoBar)==null||o.hide(),e}pointerdown(e){const{isMac:t}=Yn.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(N(this,qh,!0),this._isDraggable){F(this,at,cH).call(this,e);return}F(this,at,KT).call(this,e)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){u(this,Yo)&&clearTimeout(u(this,Yo)),N(this,Yo,setTimeout(()=>{var e;N(this,Yo,null),(e=this.parent)==null||e.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,n){e.changeParent(this),this.x=t,this.y=n,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,n=this.rotation){const r=this.parentScale,[a,o]=this.pageDimensions,[l,c]=this.pageTranslation,d=e/r,h=t/r,f=this.x*a,m=this.y*o,p=this.width*a,x=this.height*o;switch(n){case 0:return[f+d+l,o-m-h-x+c,f+d+p+l,o-m-h+c];case 90:return[f+h+l,o-m+d+c,f+h+x+l,o-m+d+p+c];case 180:return[f-d-p+l,o-m+h+c,f-d+l,o-m+h+x+c];case 270:return[f-h-x+l,o-m-d-p+c,f-h+l,o-m-d+c];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[n,r,a,o]=e,l=a-n,c=o-r;switch(this.rotation){case 0:return[n,t-o,l,c];case 90:return[n,t-r,c,l];case 180:return[a,t-r,l,c];case 270:return[a,t-o,c,l];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&mt._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){var e;(e=u(this,as))==null||e.onUpdatedColor()}getData(){const{comment:{text:e,color:t,date:n,opacity:r,deleted:a,richText:o},uid:l,pageIndex:c,creationDate:d,modificationDate:h}=this;return{id:l,pageIndex:c,rect:this.getPDFRect(),richText:o,contentsObj:{str:e},creationDate:d,modificationDate:n||h,popupRef:!a,color:t,opacity:r}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),N(this,Gh,!0),!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),N(this,Gh,!1),!0):!1}isInEditMode(){return u(this,Gh)}shouldGetKeyboardEvents(){return u(this,Zl)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:n,right:r}=this.getClientDimensions(),{innerHeight:a,innerWidth:o}=window;return t<o&&r>0&&e<a&&n>0}rebuild(){F(this,at,XT).call(this)}rotate(e){}resize(){}serializeDeleted(){var e;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((e=this._initialData)==null?void 0:e.popupRef)||""}}serialize(e=!1,t=null){var n;return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:((n=this._initialData)==null?void 0:n.popupRef)||""}}static async deserialize(e,t,n){const r=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:n,annotationElementId:e.annotationElementId,creationDate:e.creationDate,modificationDate:e.modificationDate});r.rotation=e.rotation,N(r,Vh,e.accessibilityData),r._isCopy=e.isCopy||!1;const[a,o]=r.pageDimensions,[l,c,d,h]=r.getRectInCurrentCoords(e.rect,o);return r.x=l/a,r.y=c/o,r.width=d/a,r.height=h/o,r}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var e,t,n;if((e=u(this,Fd))==null||e.abort(),N(this,Fd,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.hideCommentPopup(),u(this,Yo)&&(clearTimeout(u(this,Yo)),N(this,Yo,null)),F(this,at,Ey).call(this),this.removeEditToolbar(),u(this,ga)){for(const r of u(this,ga).values())clearTimeout(r);N(this,ga,null)}this.parent=null,(t=u(this,Yh))==null||t.destroy(),N(this,Yh,null),(n=u(this,pa))==null||n.remove(),N(this,pa,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(F(this,at,rH).call(this),u(this,Bn).classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return this._uiManager.direction==="ltr"?[1,0]:[0,0]}get commentButtonPositionInPage(){const{commentButtonPosition:[e,t]}=this,[n,r,a,o]=this.getPDFRect();return[mt._round(n+(a-n)*e),mt._round(r+(o-r)*(1-t))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return u(this,as).commentPopupPositionInLayer}set commentPopupPosition(e){u(this,as).commentPopupPositionInLayer=e}hasDefaultPopupPosition(){return u(this,as).hasDefaultPopupPosition()}get commentButtonWidth(){return u(this,as).commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(e){var t;(t=u(this,as))==null||t.setCommentButtonStates(e)}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),N(this,Ql,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const t=u(this,Bn).children;if(!u(this,Qa)){N(this,Qa,Array.from(t));const o=F(this,at,dH).bind(this),l=F(this,at,uH).bind(this),c=this._uiManager._signal;for(const d of u(this,Qa)){const h=d.getAttribute("data-resizer-name");d.setAttribute("role","spinbutton"),d.addEventListener("keydown",o,{signal:c}),d.addEventListener("blur",l,{signal:c}),d.addEventListener("focus",F(this,at,hH).bind(this,h),{signal:c}),d.setAttribute("data-l10n-id",mt._l10nResizer[h])}}const n=u(this,Qa)[0];let r=0;for(const o of t){if(o===n)break;r++}const a=(360-this.rotation+this.parentRotation)%360/90*(u(this,Qa).length/4);if(a!==r){if(a<r)for(let l=0;l<r-a;l++)u(this,Bn).append(u(this,Bn).firstChild);else if(a>r)for(let l=0;l<a-r;l++)u(this,Bn).firstChild.before(u(this,Bn).lastChild);let o=0;for(const l of t){const d=u(this,Qa)[o++].getAttribute("data-resizer-name");l.setAttribute("data-l10n-id",mt._l10nResizer[d])}}F(this,at,QT).call(this,0),N(this,Zl,!0),u(this,Bn).firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){u(this,Zl)&&F(this,at,YT).call(this,u(this,_b),{deltaX:e,deltaY:t,fromKeyboard:!0})}_stopResizingWithKeyboard(){F(this,at,Ey).call(this),this.div.focus()}select(){var e,t,n;if(this.isSelected&&this._editToolbar){this._editToolbar.show();return}if(this.isSelected=!0,this.makeResizable(),(e=this.div)==null||e.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var r,a;(r=this.div)!=null&&r.classList.contains("selectedEditor")&&((a=this._editToolbar)==null||a.show())});return}(t=this._editToolbar)==null||t.show(),(n=u(this,As))==null||n.toggleAltTextBadge(!1)}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>{var e;return(e=this.div)==null?void 0:e.focus({preventScroll:!0})},0)}unselect(){var e,t,n,r,a;this.isSelected&&(this.isSelected=!1,(e=u(this,Bn))==null||e.classList.add("hidden"),(t=this.div)==null||t.classList.remove("selectedEditor"),(n=this.div)!=null&&n.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(r=this._editToolbar)==null||r.hide(),(a=u(this,As))==null||a.toggleAltTextBadge(!0),this.hideCommentPopup())}hideCommentPopup(){this.hasComment&&this._uiManager.toggleComment(null)}updateParams(e,t){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(e){e.target.nodeName!=="BUTTON"&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.uid}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return u(this,Tb)}set isEditing(e){N(this,Tb,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){u(this,ga)||N(this,ga,new Map);const{action:n}=e;let r=u(this,ga).get(n);r&&clearTimeout(r),r=setTimeout(()=>{this._reportTelemetry(e),u(this,ga).delete(n),u(this,ga).size===0&&N(this,ga,null)},mt._telemetryTimeout),u(this,ga).set(n,r);return}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),N(this,ng,!1)}disable(){this.div&&(this.div.tabIndex=-1),N(this,ng,!0)}updateFakeAnnotationElement(e){if(!u(this,pa)&&!this.deleted){N(this,pa,e.addFakeAnnotation(this));return}if(this.deleted){u(this,pa).remove(),N(this,pa,null);return}(this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&u(this,pa).updateEdited({rect:this.getPDFRect(),popup:this.comment})}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const n=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),n.before(t)}return t}resetAnnotationElement(e){const{firstChild:t}=e.container;(t==null?void 0:t.nodeName)==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}};Vh=new WeakMap,Qa=new WeakMap,As=new WeakMap,as=new WeakMap,Xl=new WeakMap,ng=new WeakMap,Od=new WeakMap,Ab=new WeakMap,Bn=new WeakMap,Wh=new WeakMap,Ql=new WeakMap,pa=new WeakMap,Fd=new WeakMap,_b=new WeakMap,qh=new WeakMap,xi=new WeakMap,Tb=new WeakMap,Gh=new WeakMap,Zl=new WeakMap,Yo=new WeakMap,rg=new WeakMap,ig=new WeakMap,ga=new WeakMap,Yh=new WeakMap,Eb=new WeakMap,ZS=new WeakMap,at=new WeakSet,WT=function([e,t],n,r){[n,r]=this.screenToPageTranslation(n,r),this.x+=n/e,this.y+=r/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},Pb=new WeakSet,qT=function(e,t,n){switch(n){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},W1=function(e){switch(e){case 90:{const[t,n]=this.pageDimensions;return[0,-t/n,n/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,n]=this.pageDimensions;return[0,t/n,-n/t,0]}default:return[1,0,0,1]}},rH=function(){if(u(this,Bn))return;N(this,Bn,document.createElement("div")),u(this,Bn).classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const n of e){const r=document.createElement("div");u(this,Bn).append(r),r.classList.add("resizer",n),r.setAttribute("data-resizer-name",n),r.addEventListener("pointerdown",F(this,at,iH).bind(this,n),{signal:t}),r.addEventListener("contextmenu",La,{signal:t}),r.tabIndex=-1}this.div.prepend(u(this,Bn))},iH=function(e,t){var h;t.preventDefault();const{isMac:n}=Yn.platform;if(t.button!==0||t.ctrlKey&&n)return;(h=u(this,As))==null||h.toggle(!1);const r=this._isDraggable;this._isDraggable=!1,N(this,Wh,[t.screenX,t.screenY]);const a=new AbortController,o=this._uiManager.combinedSignal(a);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",F(this,at,YT).bind(this,e),{passive:!0,capture:!0,signal:o}),window.addEventListener("touchmove",Gs,{passive:!1,signal:o}),window.addEventListener("contextmenu",La,{signal:o}),N(this,Ql,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const l=this.parent.div.style.cursor,c=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const d=()=>{var f;a.abort(),this.parent.togglePointerEvents(!0),(f=u(this,As))==null||f.toggle(!0),this._isDraggable=r,this.parent.div.style.cursor=l,this.div.style.cursor=c,F(this,at,q1).call(this)};window.addEventListener("pointerup",d,{signal:o}),window.addEventListener("blur",d,{signal:o})},GT=function(e,t,n,r){this.width=n,this.height=r,this.x=e,this.y=t,this.setDims(),this.fixAndSetPosition(),this._onResized()},q1=function(){if(!u(this,Ql))return;const{savedX:e,savedY:t,savedWidth:n,savedHeight:r}=u(this,Ql);N(this,Ql,null);const a=this.x,o=this.y,l=this.width,c=this.height;a===e&&o===t&&l===n&&c===r||this.addCommands({cmd:F(this,at,GT).bind(this,a,o,l,c),undo:F(this,at,GT).bind(this,e,t,n,r),mustExec:!0})},YT=function(e,t){const[n,r]=this.parentDimensions,a=this.x,o=this.y,l=this.width,c=this.height,d=mt.MIN_SIZE/n,h=mt.MIN_SIZE/r,f=F(this,at,W1).call(this,this.rotation),m=(I,U)=>[f[0]*I+f[2]*U,f[1]*I+f[3]*U],p=F(this,at,W1).call(this,360-this.rotation),x=(I,U)=>[p[0]*I+p[2]*U,p[1]*I+p[3]*U];let g,b,v=!1,y=!1;switch(e){case"topLeft":v=!0,g=(I,U)=>[0,0],b=(I,U)=>[I,U];break;case"topMiddle":g=(I,U)=>[I/2,0],b=(I,U)=>[I/2,U];break;case"topRight":v=!0,g=(I,U)=>[I,0],b=(I,U)=>[0,U];break;case"middleRight":y=!0,g=(I,U)=>[I,U/2],b=(I,U)=>[0,U/2];break;case"bottomRight":v=!0,g=(I,U)=>[I,U],b=(I,U)=>[0,0];break;case"bottomMiddle":g=(I,U)=>[I/2,U],b=(I,U)=>[I/2,0];break;case"bottomLeft":v=!0,g=(I,U)=>[0,U],b=(I,U)=>[I,0];break;case"middleLeft":y=!0,g=(I,U)=>[0,U/2],b=(I,U)=>[I,U/2];break}const w=g(l,c),S=b(l,c);let j=m(...S);const A=mt._round(a+j[0]),k=mt._round(o+j[1]);let _=1,L=1,D,P;if(t.fromKeyboard)({deltaX:D,deltaY:P}=t);else{const{screenX:I,screenY:U}=t,[M,$]=u(this,Wh);[D,P]=this.screenToPageTranslation(I-M,U-$),u(this,Wh)[0]=I,u(this,Wh)[1]=U}if([D,P]=x(D/n,P/r),v){const I=Math.hypot(l,c);_=L=Math.max(Math.min(Math.hypot(S[0]-w[0]-D,S[1]-w[1]-P)/I,1/l,1/c),d/l,h/c)}else y?_=jr(Math.abs(S[0]-w[0]-D),d,1)/l:L=jr(Math.abs(S[1]-w[1]-P),h,1)/c;const T=mt._round(l*_),B=mt._round(c*L);j=m(...b(T,B));const R=A-j[0],O=k-j[1];u(this,xi)||N(this,xi,[this.x,this.y,this.width,this.height]),this.width=T,this.height=B,this.x=R,this.y=O,this.setDims(),this.fixAndSetPosition(),this._onResizing()},aH=function(){var e;N(this,Ql,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(e=u(this,As))==null||e.toggle(!1),this.parent.togglePointerEvents(!1)},oH=function(e,t,n){let a=.7*(n/t)+1-.7;if(a===1)return;const o=F(this,at,W1).call(this,this.rotation),l=(A,k)=>[o[0]*A+o[2]*k,o[1]*A+o[3]*k],[c,d]=this.parentDimensions,h=this.x,f=this.y,m=this.width,p=this.height,x=mt.MIN_SIZE/c,g=mt.MIN_SIZE/d;a=Math.max(Math.min(a,1/m,1/p),x/m,g/p);const b=mt._round(m*a),v=mt._round(p*a);if(b===m&&v===p)return;u(this,xi)||N(this,xi,[h,f,m,p]);const y=l(m/2,p/2),w=mt._round(h+y[0]),S=mt._round(f+y[1]),j=l(b/2,v/2);this.x=w-j[0],this.y=S-j[1],this.width=b,this.height=v,this.setDims(),this.fixAndSetPosition(),this._onResizing()},lH=function(){var e;(e=u(this,As))==null||e.toggle(!0),this.parent.togglePointerEvents(!0),F(this,at,q1).call(this)},KT=function(e){const{isMac:t}=Yn.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},cH=function(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let n=!1;const r=new AbortController,a=this._uiManager.combinedSignal(r),o={capture:!0,passive:!1,signal:a},l=d=>{r.abort(),N(this,Od,null),N(this,qh,!1),this._uiManager.endDragSession()||F(this,at,KT).call(this,d),n&&this._onStopDragging()};t&&(N(this,rg,e.clientX),N(this,ig,e.clientY),N(this,Od,e.pointerId),N(this,Ab,e.pointerType),window.addEventListener("pointermove",d=>{n||(n=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());const{clientX:h,clientY:f,pointerId:m}=d;if(m!==u(this,Od)){Gs(d);return}const[p,x]=this.screenToPageTranslation(h-u(this,rg),f-u(this,ig));N(this,rg,h),N(this,ig,f),this._uiManager.dragSelectedEditors(p,x)},o),window.addEventListener("touchmove",Gs,o),window.addEventListener("pointerdown",d=>{d.pointerType===u(this,Ab)&&(u(this,Yh)||d.isPrimary)&&l(d),Gs(d)},o));const c=d=>{if(!u(this,Od)||u(this,Od)===d.pointerId){l(d);return}Gs(d)};window.addEventListener("pointerup",c,{signal:a}),window.addEventListener("blur",c,{signal:a})},XT=function(){if(u(this,Fd)||!this.div)return;N(this,Fd,new AbortController);const e=this._uiManager.combinedSignal(u(this,Fd));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})},dH=function(e){mt._resizerKeyboardManager.exec(this,e)},uH=function(e){var t;u(this,Zl)&&((t=e.relatedTarget)==null?void 0:t.parentNode)!==u(this,Bn)&&F(this,at,Ey).call(this)},hH=function(e){N(this,_b,u(this,Zl)?e:"")},QT=function(e){if(u(this,Qa))for(const t of u(this,Qa))t.tabIndex=e},Ey=function(){N(this,Zl,!1),F(this,at,QT).call(this,-1),F(this,at,q1).call(this)},E(mt,Pb),Ce(mt,"_l10n",null),Ce(mt,"_l10nResizer",null),Ce(mt,"_borderLineWidth",-1),Ce(mt,"_colorManager",new BT),Ce(mt,"_zIndex",1),Ce(mt,"_telemetryTimeout",1e3);let ms=mt;class pue extends ms{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const gO=3285377520,na=4294901760,Io=65535;class fH{constructor(e){this.h1=e?e&4294967295:gO,this.h2=e?e&4294967295:gO}update(e){let t,n;if(typeof e=="string"){t=new Uint8Array(e.length*2),n=0;for(let g=0,b=e.length;g<b;g++){const v=e.charCodeAt(g);v<=255?t[n++]=v:(t[n++]=v>>>8,t[n++]=v&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),n=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const r=n>>2,a=n-r*4,o=new Uint32Array(t.buffer,0,r);let l=0,c=0,d=this.h1,h=this.h2;const f=3432918353,m=461845907,p=f&Io,x=m&Io;for(let g=0;g<r;g++)g&1?(l=o[g],l=l*f&na|l*p&Io,l=l<<15|l>>>17,l=l*m&na|l*x&Io,d^=l,d=d<<13|d>>>19,d=d*5+3864292196):(c=o[g],c=c*f&na|c*p&Io,c=c<<15|c>>>17,c=c*m&na|c*x&Io,h^=c,h=h<<13|h>>>19,h=h*5+3864292196);switch(l=0,a){case 3:l^=t[r*4+2]<<16;case 2:l^=t[r*4+1]<<8;case 1:l^=t[r*4],l=l*f&na|l*p&Io,l=l<<15|l>>>17,l=l*m&na|l*x&Io,r&1?d^=l:h^=l}this.h1=d,this.h2=h}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&na|e*36045&Io,t=t*4283543511&na|((t<<16|e>>>16)*2950163797&na)>>>16,e^=t>>>1,e=e*444984403&na|e*60499&Io,t=t*3301882366&na|((t<<16|e>>>16)*3120437893&na)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const ZT=Object.freeze({map:null,hash:"",transfer:void 0});var Kh,Xh,Jl,$n,JS,mH;class OM{constructor(){E(this,JS);E(this,Kh,!1);E(this,Xh,null);E(this,Jl,null);E(this,$n,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const n=u(this,$n).get(e);return n===void 0?t:Object.assign(t,n)}getRawValue(e){return u(this,$n).get(e)}remove(e){const t=u(this,$n).get(e);if(t!==void 0&&(t instanceof ms&&u(this,Jl).delete(t.annotationElementId),u(this,$n).delete(e),u(this,$n).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function")){for(const n of u(this,$n).values())if(n instanceof ms)return;this.onAnnotationEditor(null)}}setValue(e,t){const n=u(this,$n).get(e);let r=!1;if(n!==void 0)for(const[a,o]of Object.entries(t))n[a]!==o&&(r=!0,n[a]=o);else r=!0,u(this,$n).set(e,t);r&&F(this,JS,mH).call(this),t instanceof ms&&((u(this,Jl)||N(this,Jl,new Map)).set(t.annotationElementId,t),typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type))}has(e){return u(this,$n).has(e)}get size(){return u(this,$n).size}resetModified(){u(this,Kh)&&(N(this,Kh,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new pH(this)}get serializable(){if(u(this,$n).size===0)return ZT;const e=new Map,t=new fH,n=[],r=Object.create(null);let a=!1;for(const[o,l]of u(this,$n)){const c=l instanceof ms?l.serialize(!1,r):l;c&&(e.set(o,c),t.update(`${o}:${JSON.stringify(c)}`),a||(a=!!c.bitmap))}if(a)for(const o of e.values())o.bitmap&&n.push(o.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:n}:ZT}get editorStats(){let e=null;const t=new Map;let n=0,r=0;for(const a of u(this,$n).values()){if(!(a instanceof ms)){a.popup&&(a.popup.deleted?r+=1:n+=1);continue}a.isCommentDeleted?r+=1:a.hasEditedComment&&(n+=1);const o=a.telemetryFinalData;if(!o)continue;const{type:l}=o;t.has(l)||t.set(l,Object.getPrototypeOf(a).constructor),e||(e=Object.create(null));const c=e[l]||(e[l]=new Map);for(const[d,h]of Object.entries(o)){if(d==="type")continue;let f=c.get(d);f||(f=new Map,c.set(d,f));const m=f.get(h)??0;f.set(h,m+1)}}if((r>0||n>0)&&(e||(e=Object.create(null)),e.comments={deleted:r,edited:n}),!e)return null;for(const[a,o]of t)e[a]=o.computeTelemetryFinalData(e[a]);return e}resetModifiedIds(){N(this,Xh,null)}updateEditor(e,t){var r;const n=(r=u(this,Jl))==null?void 0:r.get(e);return n?(n.updateFromAnnotationLayer(t),!0):!1}getEditor(e){var t;return((t=u(this,Jl))==null?void 0:t.get(e))||null}get modifiedIds(){if(u(this,Xh))return u(this,Xh);const e=[];if(u(this,Jl))for(const t of u(this,Jl).values())t.serialize()&&e.push(t.annotationElementId);return N(this,Xh,{ids:new Set(e),hash:e.join(",")})}[Symbol.iterator](){return u(this,$n).entries()}}Kh=new WeakMap,Xh=new WeakMap,Jl=new WeakMap,$n=new WeakMap,JS=new WeakSet,mH=function(){u(this,Kh)||(N(this,Kh,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var Mb;class pH extends OM{constructor(t){super();E(this,Mb);const{map:n,hash:r,transfer:a}=t.serializable,o=structuredClone(n,a?{transfer:a}:null);N(this,Mb,{map:o,hash:r,transfer:a})}get print(){ds("Should not call PrintAnnotationStorage.print")}get serializable(){return u(this,Mb)}get modifiedIds(){return bt(this,"modifiedIds",{ids:new Set,hash:""})}}Mb=new WeakMap;var ag;class gue{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){E(this,ag,new Set);this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),u(this,ag).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,disableFontFace:t,_inspectFont:n}){if(!(!e||u(this,ag).has(e.loadedName))){if(Ot(!t,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:r,src:a,style:o}=e,l=new FontFace(r,a,o);this.addNativeFontFace(l);try{await l.load(),u(this,ag).add(r),n==null||n(e)}catch{ut(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(l)}return}ds("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const n=e.createNativeFontFace();if(n){this.addNativeFontFace(n);try{await n.loaded}catch(r){throw ut(`Failed to load font '${n.family}': '${r}'.`),e.disableFontFace=!0,r}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(n=>{const r=this._queueLoadingCallback(n);this._prepareFontLoadEvent(e,r)})}}get isFontLoadingAPISupported(){var t;const e=!!((t=this._document)!=null&&t.fonts);return bt(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){return bt(this,"isSyncFontLoadingSupported",Sr||Yn.platform.isFirefox)}_queueLoadingCallback(e){function t(){for(Ot(!r.done,"completeRequest() cannot be called twice."),r.done=!0;n.length>0&&n[0].done;){const a=n.shift();setTimeout(a.callback,0)}}const{loadingRequests:n}=this,r={done:!1,complete:t,callback:e};return n.push(r),r}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return bt(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function n(S,j){return S.charCodeAt(j)<<24|S.charCodeAt(j+1)<<16|S.charCodeAt(j+2)<<8|S.charCodeAt(j+3)&255}function r(S,j,A,k){const _=S.substring(0,j),L=S.substring(j+A);return _+k+L}let a,o;const l=this._document.createElement("canvas");l.width=1,l.height=1;const c=l.getContext("2d");let d=0;function h(S,j){if(++d>30){ut("Load test font never loaded."),j();return}if(c.font="30px "+S,c.fillText(".",0,20),c.getImageData(0,0,1,1).data[3]>0){j();return}setTimeout(h.bind(null,S,j))}const f=`lt${Date.now()}${this.loadTestFontId++}`;let m=this._loadTestFont;m=r(m,976,f.length,f);const x=16,g=1482184792;let b=n(m,x);for(a=0,o=f.length-3;a<o;a+=4)b=b-g+n(f,a)|0;a<f.length&&(b=b-g+n(f+"XXX",a)|0),m=r(m,x,4,Xde(b));const v=`url(data:font/opentype;base64,${btoa(m)});`,y=`@font-face {font-family:"${f}";src:${v}}`;this.insertRule(y);const w=this._document.createElement("div");w.style.visibility="hidden",w.style.width=w.style.height="10px",w.style.position="absolute",w.style.top=w.style.left="0px";for(const S of[e.loadedName,f]){const j=this._document.createElement("span");j.textContent="Hi",j.style.fontFamily=S,w.append(j)}this._document.body.append(w),h(f,()=>{w.remove(),t.complete()})}}ag=new WeakMap;var es;class xue{constructor(e,t=null,n,r){E(this,es);this.compiledGlyphs=Object.create(null),N(this,es,e),this._inspectFont=t,n&&Object.assign(this,n),r&&(this.charProcOperatorList=r)}createNativeFontFace(){var t;if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const n={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(n.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,n)}return(t=this._inspectFont)==null||t.call(this,this),e}createFontFaceRule(){var n;if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${Mz(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let r=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(r+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${r}src:${e}}`}return(n=this._inspectFont)==null||n.call(this,this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const n=this.loadedName+"_path_"+t;let r;try{r=e.get(n)}catch(o){ut(`getPathGenerator - ignoring character: "${o}".`)}const a=Dz(r);return this.fontExtraProperties||e.delete(n),this.compiledGlyphs[t]=a}get black(){return u(this,es).black}get bold(){return u(this,es).bold}get disableFontFace(){return u(this,es).disableFontFace??!1}get fontExtraProperties(){return u(this,es).fontExtraProperties??!1}get isInvalidPDFjsFont(){return u(this,es).isInvalidPDFjsFont}get isType3Font(){return u(this,es).isType3Font}get italic(){return u(this,es).italic}get missingFile(){return u(this,es).missingFile}get remeasure(){return u(this,es).remeasure}get vertical(){return u(this,es).vertical}get ascent(){return u(this,es).ascent}get defaultWidth(){return u(this,es).defaultWidth}get descent(){return u(this,es).descent}get bbox(){return u(this,es).bbox}get fontMatrix(){return u(this,es).fontMatrix}get fallbackName(){return u(this,es).fallbackName}get loadedName(){return u(this,es).loadedName}get mimetype(){return u(this,es).mimetype}get name(){return u(this,es).name}get data(){return u(this,es).data}clearData(){u(this,es).clearData()}get cssFontInfo(){return u(this,es).cssFontInfo}get systemFontInfo(){return u(this,es).systemFontInfo}get defaultVMetrics(){return u(this,es).defaultVMetrics}}es=new WeakMap;var og,lg,Ib,cg,G1;const gp=class gp{constructor(e){E(this,cg);E(this,og);E(this,lg);E(this,Ib);N(this,og,e),N(this,lg,new DataView(u(this,og))),N(this,Ib,new TextDecoder)}static write(e){const t=new TextEncoder,n={};let r=0;for(const d of gp.strings){const h=t.encode(e[d]);n[d]=h,r+=4+h.length}const a=new ArrayBuffer(r),o=new Uint8Array(a),l=new DataView(a);let c=0;for(const d of gp.strings){const h=n[d],f=h.length;l.setUint32(c,f),o.set(h,c+4),c+=4+f}return Ot(c===a.byteLength,"CssFontInfo.write: Buffer overflow"),a}get fontFamily(){return F(this,cg,G1).call(this,0)}get fontWeight(){return F(this,cg,G1).call(this,1)}get italicAngle(){return F(this,cg,G1).call(this,2)}};og=new WeakMap,lg=new WeakMap,Ib=new WeakMap,cg=new WeakSet,G1=function(e){Ot(e<gp.strings.length,"Invalid string index");let t=0;for(let r=0;r<e;r++)t+=u(this,lg).getUint32(t)+4;const n=u(this,lg).getUint32(t);return u(this,Ib).decode(new Uint8Array(u(this,og),t+4,n))},Ce(gp,"strings",["fontFamily","fontWeight","italicAngle"]);let IS=gp;var Bd,Ko,Qh,Zh,Py;const xp=class xp{constructor(e){E(this,Zh);E(this,Bd);E(this,Ko);E(this,Qh);N(this,Bd,e),N(this,Ko,new DataView(u(this,Bd))),N(this,Qh,new TextDecoder)}static write(e){const t=new TextEncoder,n={};let r=0;for(const m of xp.strings){const p=t.encode(e[m]);n[m]=p,r+=4+p.length}r+=4;let a,o,l=1+r;e.style&&(a=t.encode(e.style.style),o=t.encode(e.style.weight),l+=4+a.length+4+o.length);const c=new ArrayBuffer(l),d=new Uint8Array(c),h=new DataView(c);let f=0;h.setUint8(f++,e.guessFallback?1:0),h.setUint32(f,0),f+=4,r=0;for(const m of xp.strings){const p=n[m],x=p.length;r+=4+x,h.setUint32(f,x),d.set(p,f+4),f+=4+x}return h.setUint32(f-r-4,r),e.style&&(h.setUint32(f,a.length),d.set(a,f+4),f+=4+a.length,h.setUint32(f,o.length),d.set(o,f+4),f+=4+o.length),Ot(f<=c.byteLength,"SubstitionInfo.write: Buffer overflow"),c.transferToFixedLength(f)}get guessFallback(){return u(this,Ko).getUint8(0)!==0}get css(){return F(this,Zh,Py).call(this,0)}get loadedName(){return F(this,Zh,Py).call(this,1)}get baseFontName(){return F(this,Zh,Py).call(this,2)}get src(){return F(this,Zh,Py).call(this,3)}get style(){let e=1;e+=4+u(this,Ko).getUint32(e);const t=u(this,Ko).getUint32(e),n=u(this,Qh).decode(new Uint8Array(u(this,Bd),e+4,t));e+=4+t;const r=u(this,Ko).getUint32(e),a=u(this,Qh).decode(new Uint8Array(u(this,Bd),e+4,r));return{style:n,weight:a}}};Bd=new WeakMap,Ko=new WeakMap,Qh=new WeakMap,Zh=new WeakSet,Py=function(e){Ot(e<xp.strings.length,"Invalid string index");let t=5;for(let r=0;r<e;r++)t+=u(this,Ko).getUint32(t)+4;const n=u(this,Ko).getUint32(t);return u(this,Qh).decode(new Uint8Array(u(this,Bd),t+4,n))},Ce(xp,"strings",["css","loadedName","baseFontName","src"]);let RS=xp;var dg,ug,hg,fg,yi,Xo,Rb,ts,Vs,za,Y1,My;const yt=class yt{constructor({data:e,extra:t}){E(this,Vs);E(this,Xo);E(this,Rb);E(this,ts);N(this,Xo,e),N(this,Rb,new TextDecoder),N(this,ts,new DataView(u(this,Xo))),t&&Object.assign(this,t)}get black(){return F(this,Vs,za).call(this,0)}get bold(){return F(this,Vs,za).call(this,1)}get disableFontFace(){return F(this,Vs,za).call(this,2)}get fontExtraProperties(){return F(this,Vs,za).call(this,3)}get isInvalidPDFjsFont(){return F(this,Vs,za).call(this,4)}get isType3Font(){return F(this,Vs,za).call(this,5)}get italic(){return F(this,Vs,za).call(this,6)}get missingFile(){return F(this,Vs,za).call(this,7)}get remeasure(){return F(this,Vs,za).call(this,8)}get vertical(){return F(this,Vs,za).call(this,9)}get ascent(){return F(this,Vs,Y1).call(this,0)}get defaultWidth(){return F(this,Vs,Y1).call(this,1)}get descent(){return F(this,Vs,Y1).call(this,2)}get bbox(){let e=u(yt,ug);if(u(this,ts).getUint8(e)===0)return;e+=1;const n=[];for(let r=0;r<4;r++)n.push(u(this,ts).getInt16(e,!0)),e+=2;return n}get fontMatrix(){let e=u(yt,hg);if(u(this,ts).getUint8(e)===0)return;e+=1;const n=[];for(let r=0;r<6;r++)n.push(u(this,ts).getFloat64(e,!0)),e+=8;return n}get defaultVMetrics(){let e=u(yt,fg);if(u(this,ts).getUint8(e)===0)return;e+=1;const n=[];for(let r=0;r<3;r++)n.push(u(this,ts).getInt16(e,!0)),e+=2;return n}get fallbackName(){return F(this,Vs,My).call(this,0)}get loadedName(){return F(this,Vs,My).call(this,1)}get mimetype(){return F(this,Vs,My).call(this,2)}get name(){return F(this,Vs,My).call(this,3)}get data(){let e=u(yt,yi);const t=u(this,ts).getUint32(e);e+=4+t;const n=u(this,ts).getUint32(e);e+=4+n;const r=u(this,ts).getUint32(e);e+=4+r;const a=u(this,ts).getUint32(e);if(a!==0)return new Uint8Array(u(this,Xo),e+4,a)}clearData(){let e=u(yt,yi);const t=u(this,ts).getUint32(e);e+=4+t;const n=u(this,ts).getUint32(e);e+=4+n;const r=u(this,ts).getUint32(e);e+=4+r;const a=u(this,ts).getUint32(e);new Uint8Array(u(this,Xo),e+4,a).fill(0),u(this,ts).setUint32(e,0)}get cssFontInfo(){let e=u(yt,yi);const t=u(this,ts).getUint32(e);e+=4+t;const n=u(this,ts).getUint32(e);e+=4+n;const r=u(this,ts).getUint32(e);if(r===0)return null;const a=new Uint8Array(r);return a.set(new Uint8Array(u(this,Xo),e+4,r)),new IS(a.buffer)}get systemFontInfo(){let e=u(yt,yi);const t=u(this,ts).getUint32(e);e+=4+t;const n=u(this,ts).getUint32(e);if(n===0)return null;const r=new Uint8Array(n);return r.set(new Uint8Array(u(this,Xo),e+4,n)),new RS(r.buffer)}static write(e){const t=e.systemFontInfo?RS.write(e.systemFontInfo):null,n=e.cssFontInfo?IS.write(e.cssFontInfo):null,r=new TextEncoder,a={};let o=0;for(const g of yt.strings)a[g]=r.encode(e[g]),o+=4+a[g].length;const l=u(yt,yi)+4+o+4+(t?t.byteLength:0)+4+(n?n.byteLength:0)+4+(e.data?e.data.length:0),c=new ArrayBuffer(l),d=new Uint8Array(c),h=new DataView(c);let f=0;const m=yt.bools.length;let p=0,x=0;for(let g=0;g<m;g++){const b=e[yt.bools[g]];p|=(b===void 0?0:b?2:1)<<x,x+=2,(x===8||g===m-1)&&(h.setUint8(f++,p),p=0,x=0)}Ot(f===u(yt,dg),"FontInfo.write: Boolean properties offset mismatch");for(const g of yt.numbers)h.setFloat64(f,e[g]),f+=8;if(Ot(f===u(yt,ug),"FontInfo.write: Number properties offset mismatch"),e.bbox){h.setUint8(f++,4);for(const g of e.bbox)h.setInt16(f,g,!0),f+=2}else h.setUint8(f++,0),f+=2*4;if(Ot(f===u(yt,hg),"FontInfo.write: BBox properties offset mismatch"),e.fontMatrix){h.setUint8(f++,6);for(const g of e.fontMatrix)h.setFloat64(f,g,!0),f+=8}else h.setUint8(f++,0),f+=8*6;if(Ot(f===u(yt,fg),"FontInfo.write: FontMatrix properties offset mismatch"),e.defaultVMetrics){h.setUint8(f++,1);for(const g of e.defaultVMetrics)h.setInt16(f,g,!0),f+=2}else h.setUint8(f++,0),f+=3*2;Ot(f===u(yt,yi),"FontInfo.write: DefaultVMetrics properties offset mismatch"),h.setUint32(u(yt,yi),0),f+=4;for(const g of yt.strings){const b=a[g],v=b.length;h.setUint32(f,v),d.set(b,f+4),f+=4+v}if(h.setUint32(u(yt,yi),f-u(yt,yi)-4),!t)h.setUint32(f,0),f+=4;else{const g=t.byteLength;h.setUint32(f,g),Ot(f+4+g<=c.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),d.set(new Uint8Array(t),f+4),f+=4+g}if(!n)h.setUint32(f,0),f+=4;else{const g=n.byteLength;h.setUint32(f,g),Ot(f+4+g<=c.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),d.set(new Uint8Array(n),f+4),f+=4+g}return e.data===void 0?(h.setUint32(f,0),f+=4):(h.setUint32(f,e.data.length),d.set(e.data,f+4),f+=4+e.data.length),Ot(f<=c.byteLength,"FontInfo.write: Buffer overflow"),c.transferToFixedLength(f)}};dg=new WeakMap,ug=new WeakMap,hg=new WeakMap,fg=new WeakMap,yi=new WeakMap,Xo=new WeakMap,Rb=new WeakMap,ts=new WeakMap,Vs=new WeakSet,za=function(e){Ot(e<yt.bools.length,"Invalid boolean index");const t=Math.floor(e/4),n=e*2%8,r=u(this,ts).getUint8(t)>>n&3;return r===0?void 0:r===2},Y1=function(e){return Ot(e<yt.numbers.length,"Invalid number index"),u(this,ts).getFloat64(u(yt,dg)+e*8)},My=function(e){Ot(e<yt.strings.length,"Invalid string index");let t=u(yt,yi)+4;for(let a=0;a<e;a++)t+=u(this,ts).getUint32(t)+4;const n=u(this,ts).getUint32(t),r=new Uint8Array(n);return r.set(new Uint8Array(u(this,Xo),t+4,n)),u(this,Rb).decode(r)},Ce(yt,"bools",["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"]),Ce(yt,"numbers",["ascent","defaultWidth","descent"]),Ce(yt,"strings",["fallbackName","loadedName","mimetype","name"]),E(yt,dg,Math.ceil(yt.bools.length*2/8)),E(yt,ug,u(yt,dg)+yt.numbers.length*8),E(yt,hg,u(yt,ug)+1+2*4),E(yt,fg,u(yt,hg)+1+8*6),E(yt,yi,u(yt,fg)+1+2*3);let JT=yt;var Db,Lb,Ob,Fb,Bb,$b,Ub,zb;const us=class us{constructor(e){this.buffer=e,this.view=new DataView(e),this.data=new Uint8Array(e)}static write(e){let t,n=null,r=[],a=[],o=[],l=[],c=null,d=null;switch(e[0]){case"RadialAxial":t=e[1]==="axial"?1:2,n=e[2],o=e[3],t===1?r.push(...e[4],...e[5]):r.push(e[4][0],e[4][1],e[6],e[5][0],e[5][1],e[7]);break;case"Mesh":t=3,c=e[1],r=e[2],a=e[3],l=e[4]||[],n=e[6],d=e[7];break;default:throw new Error(`Unsupported pattern type: ${e[0]}`)}const h=Math.floor(r.length/2),f=Math.floor(a.length/3),m=o.length,p=l.length;let x=0;for(const j of l)x+=1,x=Math.ceil(x/4)*4,x+=4+j.coords.length*4,x+=4+j.colors.length*4,j.verticesPerRow!==void 0&&(x+=4);const g=20+h*8+f*3+m*8+(n?16:0)+(d?3:0)+x,b=new ArrayBuffer(g),v=new DataView(b),y=new Uint8Array(b);v.setUint8(u(us,Db),t),v.setUint8(u(us,Lb),n?1:0),v.setUint8(u(us,Ob),d?1:0),v.setUint8(u(us,Fb),c),v.setUint32(u(us,Bb),h,!0),v.setUint32(u(us,$b),f,!0),v.setUint32(u(us,Ub),m,!0),v.setUint32(u(us,zb),p,!0);let w=20;new Float32Array(b,w,h*2).set(r),w+=h*8,y.set(a,w),w+=f*3;for(const[j,A]of o)v.setFloat32(w,j,!0),w+=4,v.setUint32(w,parseInt(A.slice(1),16),!0),w+=4;if(n)for(const j of n)v.setFloat32(w,j,!0),w+=4;d&&(y.set(d,w),w+=3);for(let j=0;j<l.length;j++){const A=l[j];v.setUint8(w,A.type),w+=1,w=Math.ceil(w/4)*4,v.setUint32(w,A.coords.length,!0),w+=4,new Int32Array(b,w,A.coords.length).set(A.coords),w+=A.coords.length*4,v.setUint32(w,A.colors.length,!0),w+=4,new Int32Array(b,w,A.colors.length).set(A.colors),w+=A.colors.length*4,A.verticesPerRow!==void 0&&(v.setUint32(w,A.verticesPerRow,!0),w+=4)}return b}getIR(){const e=this.view,t=this.data[u(us,Db)],n=!!this.data[u(us,Lb)],r=!!this.data[u(us,Ob)],a=e.getUint32(u(us,Bb),!0),o=e.getUint32(u(us,$b),!0),l=e.getUint32(u(us,Ub),!0),c=e.getUint32(u(us,zb),!0);let d=20;const h=new Float32Array(this.buffer,d,a*2);d+=a*8;const f=new Uint8Array(this.buffer,d,o*3);d+=o*3;const m=[];for(let b=0;b<l;++b){const v=e.getFloat32(d,!0);d+=4;const y=e.getUint32(d,!0);d+=4,m.push([v,`#${y.toString(16).padStart(6,"0")}`])}let p=null;if(n){p=[];for(let b=0;b<4;++b)p.push(e.getFloat32(d,!0)),d+=4}let x=null;r&&(x=new Uint8Array(this.buffer,d,3),d+=3);const g=[];for(let b=0;b<c;++b){const v=e.getUint8(d);d+=1,d=Math.ceil(d/4)*4;const y=e.getUint32(d,!0);d+=4;const w=new Int32Array(this.buffer,d,y);d+=y*4;const S=e.getUint32(d,!0);d+=4;const j=new Int32Array(this.buffer,d,S);d+=S*4;const A={type:v,coords:w,colors:j};v===PT.LATTICE&&(A.verticesPerRow=e.getUint32(d,!0),d+=4),g.push(A)}if(t===1)return["RadialAxial","axial",p,m,Array.from(h.slice(0,2)),Array.from(h.slice(2,4)),null,null];if(t===2)return["RadialAxial","radial",p,m,[h[0],h[1]],[h[3],h[4]],h[2],h[5]];if(t===3){const b=this.data[u(us,Fb)];let v=null;if(h.length>0){let y=h[0],w=h[0],S=h[1],j=h[1];for(let A=0;A<h.length;A+=2){const k=h[A],_=h[A+1];y=y>k?k:y,S=S>_?_:S,w=w<k?k:w,j=j<_?_:j}v=[y,S,w,j]}return["Mesh",b,h,f,g,v,p,x]}throw new Error(`Unsupported pattern kind: ${t}`)}};Db=new WeakMap,Lb=new WeakMap,Ob=new WeakMap,Fb=new WeakMap,Bb=new WeakMap,$b=new WeakMap,Ub=new WeakMap,zb=new WeakMap,E(us,Db,0),E(us,Lb,1),E(us,Ob,2),E(us,Fb,3),E(us,Bb,4),E(us,$b,8),E(us,Ub,12),E(us,zb,16);let e2=us;function yue(s){if(s instanceof URL)return s.href;if(typeof s=="string"){if(Sr)return s;const e=URL.parse(s,window.location);if(e)return e.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function vue(s){if(Sr&&typeof Buffer<"u"&&s instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(s instanceof Uint8Array&&s.byteLength===s.buffer.byteLength)return s;if(typeof s=="string")return dw(s);if(s instanceof ArrayBuffer||ArrayBuffer.isView(s)||typeof s=="object"&&!isNaN(s==null?void 0:s.length))return new Uint8Array(s);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function a1(s){if(typeof s!="string")return null;if(s.endsWith("/"))return s;throw new Error(`Invalid factory url: "${s}" must include trailing slash.`)}const t2=s=>typeof s=="object"&&Number.isInteger(s==null?void 0:s.num)&&s.num>=0&&Number.isInteger(s==null?void 0:s.gen)&&s.gen>=0,bue=s=>typeof s=="object"&&typeof(s==null?void 0:s.name)=="string",wue=tue.bind(null,t2,bue);var ec,ej;class Cue{constructor(){E(this,ec,new Map);E(this,ej,Promise.resolve())}postMessage(e,t){const n={data:structuredClone(e,t?{transfer:t}:null)};u(this,ej).then(()=>{for(const[r]of u(this,ec))r.call(this,n)})}addEventListener(e,t,n=null){let r=null;if((n==null?void 0:n.signal)instanceof AbortSignal){const{signal:a}=n;if(a.aborted){ut("LoopbackPort - cannot use an `aborted` signal.");return}const o=()=>this.removeEventListener(e,t);r=()=>a.removeEventListener("abort",o),a.addEventListener("abort",o)}u(this,ec).set(t,r)}removeEventListener(e,t){const n=u(this,ec).get(t);n==null||n(),u(this,ec).delete(t)}terminate(){for(const[,e]of u(this,ec))e==null||e();u(this,ec).clear()}}ec=new WeakMap,ej=new WeakMap;const o1={DATA:1,ERROR:2},en={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function xO(){}function Vr(s){if(s instanceof Uu||s instanceof MT||s instanceof cO||s instanceof TS||s instanceof wA)return s;switch(s instanceof Error||typeof s=="object"&&s!==null||ds('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),s.name){case"AbortException":return new Uu(s.message);case"InvalidPDFException":return new MT(s.message);case"PasswordException":return new cO(s.message,s.code);case"ResponseException":return new TS(s.message,s.status,s.missing);case"UnknownErrorException":return new wA(s.message,s.details)}return new wA(s.message,s.toString())}var mg,Pa,gH,xH,yH,K1;class Iy{constructor(e,t,n){E(this,Pa);E(this,mg,new AbortController);this.sourceName=e,this.targetName=t,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),n.addEventListener("message",F(this,Pa,gH).bind(this),{signal:u(this,mg).signal})}on(e,t){const n=this.actionHandler;if(n[e])throw new Error(`There is already an actionName called "${e}"`);n[e]=t}send(e,t,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},n)}sendWithPromise(e,t,n){const r=this.callbackId++,a=Promise.withResolvers();this.callbackCapabilities[r]=a;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:r,data:t},n)}catch(o){a.reject(o)}return a.promise}sendWithStream(e,t,n,r){const a=this.streamId++,o=this.sourceName,l=this.targetName,c=this.comObj;return new ReadableStream({start:d=>{const h=Promise.withResolvers();return this.streamControllers[a]={controller:d,startCall:h,pullCall:null,cancelCall:null,isClosed:!1},c.postMessage({sourceName:o,targetName:l,action:e,streamId:a,data:t,desiredSize:d.desiredSize},r),h.promise},pull:d=>{const h=Promise.withResolvers();return this.streamControllers[a].pullCall=h,c.postMessage({sourceName:o,targetName:l,stream:en.PULL,streamId:a,desiredSize:d.desiredSize}),h.promise},cancel:d=>{Ot(d instanceof Error,"cancel must have a valid reason");const h=Promise.withResolvers();return this.streamControllers[a].cancelCall=h,this.streamControllers[a].isClosed=!0,c.postMessage({sourceName:o,targetName:l,stream:en.CANCEL,streamId:a,reason:Vr(d)}),h.promise}},n)}destroy(){var e;(e=u(this,mg))==null||e.abort(),N(this,mg,null)}}mg=new WeakMap,Pa=new WeakSet,gH=function({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){F(this,Pa,yH).call(this,e);return}if(e.callback){const n=e.callbackId,r=this.callbackCapabilities[n];if(!r)throw new Error(`Cannot resolve callback ${n}`);if(delete this.callbackCapabilities[n],e.callback===o1.DATA)r.resolve(e.data);else if(e.callback===o1.ERROR)r.reject(Vr(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const n=this.sourceName,r=e.sourceName,a=this.comObj;Promise.try(t,e.data).then(function(o){a.postMessage({sourceName:n,targetName:r,callback:o1.DATA,callbackId:e.callbackId,data:o})},function(o){a.postMessage({sourceName:n,targetName:r,callback:o1.ERROR,callbackId:e.callbackId,reason:Vr(o)})});return}if(e.streamId){F(this,Pa,xH).call(this,e);return}t(e.data)},xH=function(e){const t=e.streamId,n=this.sourceName,r=e.sourceName,a=this.comObj,o=this,l=this.actionHandler[e.action],c={enqueue(d,h=1,f){if(this.isCancelled)return;const m=this.desiredSize;this.desiredSize-=h,m>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),a.postMessage({sourceName:n,targetName:r,stream:en.ENQUEUE,streamId:t,chunk:d},f)},close(){this.isCancelled||(this.isCancelled=!0,a.postMessage({sourceName:n,targetName:r,stream:en.CLOSE,streamId:t}),delete o.streamSinks[t])},error(d){Ot(d instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,a.postMessage({sourceName:n,targetName:r,stream:en.ERROR,streamId:t,reason:Vr(d)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};c.sinkCapability.resolve(),c.ready=c.sinkCapability.promise,this.streamSinks[t]=c,Promise.try(l,e.data,c).then(function(){a.postMessage({sourceName:n,targetName:r,stream:en.START_COMPLETE,streamId:t,success:!0})},function(d){a.postMessage({sourceName:n,targetName:r,stream:en.START_COMPLETE,streamId:t,reason:Vr(d)})})},yH=function(e){const t=e.streamId,n=this.sourceName,r=e.sourceName,a=this.comObj,o=this.streamControllers[t],l=this.streamSinks[t];switch(e.stream){case en.START_COMPLETE:e.success?o.startCall.resolve():o.startCall.reject(Vr(e.reason));break;case en.PULL_COMPLETE:e.success?o.pullCall.resolve():o.pullCall.reject(Vr(e.reason));break;case en.PULL:if(!l){a.postMessage({sourceName:n,targetName:r,stream:en.PULL_COMPLETE,streamId:t,success:!0});break}l.desiredSize<=0&&e.desiredSize>0&&l.sinkCapability.resolve(),l.desiredSize=e.desiredSize,Promise.try(l.onPull||xO).then(function(){a.postMessage({sourceName:n,targetName:r,stream:en.PULL_COMPLETE,streamId:t,success:!0})},function(d){a.postMessage({sourceName:n,targetName:r,stream:en.PULL_COMPLETE,streamId:t,reason:Vr(d)})});break;case en.ENQUEUE:if(Ot(o,"enqueue should have stream controller"),o.isClosed)break;o.controller.enqueue(e.chunk);break;case en.CLOSE:if(Ot(o,"close should have stream controller"),o.isClosed)break;o.isClosed=!0,o.controller.close(),F(this,Pa,K1).call(this,o,t);break;case en.ERROR:Ot(o,"error should have stream controller"),o.controller.error(Vr(e.reason)),F(this,Pa,K1).call(this,o,t);break;case en.CANCEL_COMPLETE:e.success?o.cancelCall.resolve():o.cancelCall.reject(Vr(e.reason)),F(this,Pa,K1).call(this,o,t);break;case en.CANCEL:if(!l)break;const c=Vr(e.reason);Promise.try(l.onCancel||xO,c).then(function(){a.postMessage({sourceName:n,targetName:r,stream:en.CANCEL_COMPLETE,streamId:t,success:!0})},function(d){a.postMessage({sourceName:n,targetName:r,stream:en.CANCEL_COMPLETE,streamId:t,reason:Vr(d)})}),l.sinkCapability.reject(c),l.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},K1=async function(e,t){var n,r,a;await Promise.allSettled([(n=e.startCall)==null?void 0:n.promise,(r=e.pullCall)==null?void 0:r.promise,(a=e.cancelCall)==null?void 0:a.promise]),delete this.streamControllers[t]};var Hb;class vH{constructor({enableHWA:e=!1}){E(this,Hb,!1);N(this,Hb,e)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const n=this._createCanvas(e,t);return{canvas:n,context:n.getContext("2d",{willReadFrequently:!u(this,Hb)})}}reset(e,t,n){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||n<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=n}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){ds("Abstract method `_createCanvas` called.")}}Hb=new WeakMap;class Sue extends vH{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const n=this._document.createElement("canvas");return n.width=e,n.height=t,n}}class bH{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(n=>({cMapData:n,isCompressed:this.isCompressed})).catch(n=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){ds("Abstract method `_fetch` called.")}}class yO extends bH{async _fetch(e){const t=await uw(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):dw(t)}}class wH{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,n,r,a){return"none"}destroy(e=!1){}}var Jh,pg,tc,sc,ir,ef,tf,Ve,tr,Ry,qm,X1,Gm,CH,s2,Ym,Dy,Ly,n2,Oy;class jue extends wH{constructor({docId:t,ownerDocument:n=globalThis.document}){super();E(this,Ve);E(this,Jh);E(this,pg);E(this,tc);E(this,sc);E(this,ir);E(this,ef);E(this,tf,0);N(this,sc,t),N(this,ir,n)}addFilter(t){if(!t)return"none";let n=u(this,Ve,tr).get(t);if(n)return n;const[r,a,o]=F(this,Ve,X1).call(this,t),l=t.length===1?r:`${r}${a}${o}`;if(n=u(this,Ve,tr).get(l),n)return u(this,Ve,tr).set(t,n),n;const c=`g_${u(this,sc)}_transfer_map_${Fs(this,tf)._++}`,d=F(this,Ve,Gm).call(this,c);u(this,Ve,tr).set(t,d),u(this,Ve,tr).set(l,d);const h=F(this,Ve,Ym).call(this,c);return F(this,Ve,Ly).call(this,r,a,o,h),d}addHCMFilter(t,n){var x;const r=`${t}-${n}`,a="base";let o=u(this,Ve,Ry).get(a);if((o==null?void 0:o.key)===r||(o?((x=o.filter)==null||x.remove(),o.key=r,o.url="none",o.filter=null):(o={key:r,url:"none",filter:null},u(this,Ve,Ry).set(a,o)),!t||!n))return o.url;const l=F(this,Ve,Oy).call(this,t);t=Ge.makeHexColor(...l);const c=F(this,Ve,Oy).call(this,n);if(n=Ge.makeHexColor(...c),u(this,Ve,qm).style.color="",t==="#000000"&&n==="#ffffff"||t===n)return o.url;const d=new Array(256);for(let g=0;g<=255;g++){const b=g/255;d[g]=b<=.03928?b/12.92:((b+.055)/1.055)**2.4}const h=d.join(","),f=`g_${u(this,sc)}_hcm_filter`,m=o.filter=F(this,Ve,Ym).call(this,f);F(this,Ve,Ly).call(this,h,h,h,m),F(this,Ve,s2).call(this,m);const p=(g,b)=>{const v=l[g]/255,y=c[g]/255,w=new Array(b+1);for(let S=0;S<=b;S++)w[S]=v+S/b*(y-v);return w.join(",")};return F(this,Ve,Ly).call(this,p(0,5),p(1,5),p(2,5),m),o.url=F(this,Ve,Gm).call(this,f),o.url}addAlphaFilter(t){let n=u(this,Ve,tr).get(t);if(n)return n;const[r]=F(this,Ve,X1).call(this,[t]),a=`alpha_${r}`;if(n=u(this,Ve,tr).get(a),n)return u(this,Ve,tr).set(t,n),n;const o=`g_${u(this,sc)}_alpha_map_${Fs(this,tf)._++}`,l=F(this,Ve,Gm).call(this,o);u(this,Ve,tr).set(t,l),u(this,Ve,tr).set(a,l);const c=F(this,Ve,Ym).call(this,o);return F(this,Ve,n2).call(this,r,c),l}addLuminosityFilter(t){let n=u(this,Ve,tr).get(t||"luminosity");if(n)return n;let r,a;if(t?([r]=F(this,Ve,X1).call(this,[t]),a=`luminosity_${r}`):a="luminosity",n=u(this,Ve,tr).get(a),n)return u(this,Ve,tr).set(t,n),n;const o=`g_${u(this,sc)}_luminosity_map_${Fs(this,tf)._++}`,l=F(this,Ve,Gm).call(this,o);u(this,Ve,tr).set(t,l),u(this,Ve,tr).set(a,l);const c=F(this,Ve,Ym).call(this,o);return F(this,Ve,CH).call(this,c),t&&F(this,Ve,n2).call(this,r,c),l}addHighlightHCMFilter(t,n,r,a,o){var y;const l=`${n}-${r}-${a}-${o}`;let c=u(this,Ve,Ry).get(t);if((c==null?void 0:c.key)===l||(c?((y=c.filter)==null||y.remove(),c.key=l,c.url="none",c.filter=null):(c={key:l,url:"none",filter:null},u(this,Ve,Ry).set(t,c)),!n||!r))return c.url;const[d,h]=[n,r].map(F(this,Ve,Oy).bind(this));let f=Math.round(.2126*d[0]+.7152*d[1]+.0722*d[2]),m=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),[p,x]=[a,o].map(F(this,Ve,Oy).bind(this));m<f&&([f,m,p,x]=[m,f,x,p]),u(this,Ve,qm).style.color="";const g=(w,S,j)=>{const A=new Array(256),k=(m-f)/j,_=w/255,L=(S-w)/(255*j);let D=0;for(let P=0;P<=j;P++){const T=Math.round(f+P*k),B=_+P*L;for(let R=D;R<=T;R++)A[R]=B;D=T+1}for(let P=D;P<256;P++)A[P]=A[D-1];return A.join(",")},b=`g_${u(this,sc)}_hcm_${t}_filter`,v=c.filter=F(this,Ve,Ym).call(this,b);return F(this,Ve,s2).call(this,v),F(this,Ve,Ly).call(this,g(p[0],x[0],5),g(p[1],x[1],5),g(p[2],x[2],5),v),c.url=F(this,Ve,Gm).call(this,b),c.url}destroy(t=!1){var n,r,a,o;t&&((n=u(this,ef))!=null&&n.size)||((r=u(this,tc))==null||r.parentNode.parentNode.remove(),N(this,tc,null),(a=u(this,pg))==null||a.clear(),N(this,pg,null),(o=u(this,ef))==null||o.clear(),N(this,ef,null),N(this,tf,0))}}Jh=new WeakMap,pg=new WeakMap,tc=new WeakMap,sc=new WeakMap,ir=new WeakMap,ef=new WeakMap,tf=new WeakMap,Ve=new WeakSet,tr=function(){return u(this,pg)||N(this,pg,new Map)},Ry=function(){return u(this,ef)||N(this,ef,new Map)},qm=function(){if(!u(this,tc)){const t=u(this,ir).createElement("div"),{style:n}=t;n.visibility="hidden",n.contain="strict",n.width=n.height=0,n.position="absolute",n.top=n.left=0,n.zIndex=-1;const r=u(this,ir).createElementNS(Rl,"svg");r.setAttribute("width",0),r.setAttribute("height",0),N(this,tc,u(this,ir).createElementNS(Rl,"defs")),t.append(r),r.append(u(this,tc)),u(this,ir).body.append(t)}return u(this,tc)},X1=function(t){if(t.length===1){const d=t[0],h=new Array(256);for(let m=0;m<256;m++)h[m]=d[m]/255;const f=h.join(",");return[f,f,f]}const[n,r,a]=t,o=new Array(256),l=new Array(256),c=new Array(256);for(let d=0;d<256;d++)o[d]=n[d]/255,l[d]=r[d]/255,c[d]=a[d]/255;return[o.join(","),l.join(","),c.join(",")]},Gm=function(t){if(u(this,Jh)===void 0){N(this,Jh,"");const n=u(this,ir).URL;n!==u(this,ir).baseURI&&(Fk(n)?ut('#createUrl: ignore "data:"-URL for performance reasons.'):N(this,Jh,Tz(n,"")))}return`url(${u(this,Jh)}#${t})`},CH=function(t){const n=u(this,ir).createElementNS(Rl,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(n)},s2=function(t){const n=u(this,ir).createElementNS(Rl,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(n)},Ym=function(t){const n=u(this,ir).createElementNS(Rl,"filter");return n.setAttribute("color-interpolation-filters","sRGB"),n.setAttribute("id",t),u(this,Ve,qm).append(n),n},Dy=function(t,n,r){const a=u(this,ir).createElementNS(Rl,n);a.setAttribute("type","discrete"),a.setAttribute("tableValues",r),t.append(a)},Ly=function(t,n,r,a){const o=u(this,ir).createElementNS(Rl,"feComponentTransfer");a.append(o),F(this,Ve,Dy).call(this,o,"feFuncR",t),F(this,Ve,Dy).call(this,o,"feFuncG",n),F(this,Ve,Dy).call(this,o,"feFuncB",r)},n2=function(t,n){const r=u(this,ir).createElementNS(Rl,"feComponentTransfer");n.append(r),F(this,Ve,Dy).call(this,r,"feFuncA",t)},Oy=function(t){return u(this,Ve,qm).style.color=t,fw(getComputedStyle(u(this,Ve,qm)).getPropertyValue("color"))};class SH{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(n=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){ds("Abstract method `_fetch` called.")}}class vO extends SH{async _fetch(e){const t=await uw(e,"arraybuffer");return new Uint8Array(t)}}class jH{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!e)throw new Error("Wasm filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(n=>{throw new Error(`Unable to load wasm data at: ${t}`)})}async _fetch(e){ds("Abstract method `_fetch` called.")}}class bO extends jH{async _fetch(e){const t=await uw(e,"arraybuffer");return new Uint8Array(t)}}Sr&&ut("Please use the `legacy` build in Node.js environments.");async function FM(s){const t=await process.getBuiltinModule("fs").promises.readFile(s);return new Uint8Array(t)}class kue extends wH{}class Nue extends vH{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class Aue extends bH{async _fetch(e){return FM(e)}}class _ue extends SH{async _fetch(e){return FM(e)}}class Tue extends jH{async _fetch(e){return FM(e)}}const Lm="__forcedDependency",{floor:wO,ceil:CO}=Math;function l1(s,e,t,n,r,a){s[e*4+0]=Math.min(s[e*4+0],t),s[e*4+1]=Math.min(s[e*4+1],n),s[e*4+2]=Math.max(s[e*4+2],r),s[e*4+3]=Math.max(s[e*4+3],a)}const r2=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];var gg,$d;class Eue{constructor(e,t){E(this,gg);E(this,$d);N(this,gg,e),N(this,$d,t)}get length(){return u(this,gg).length}isEmpty(e){return u(this,gg)[e]===r2}minX(e){return u(this,$d)[e*4+0]/256}minY(e){return u(this,$d)[e*4+1]/256}maxX(e){return(u(this,$d)[e*4+2]+1)/256}maxY(e){return(u(this,$d)[e*4+3]+1)/256}}gg=new WeakMap,$d=new WeakMap;const c1=(s,e)=>{if(!s)return;let t=s.get(e);return t||(t={dependencies:new Set,isRenderingOperation:!1},s.set(e,t)),t};var Gr,Yr,sf,Za,nf,nc,Kt,ss,rc,Kr,Vb,xg,rf,af,ic,ar,Qo,Wb,i2;class Pue{constructor(e,t,n=!1){E(this,Wb);E(this,Gr,{__proto__:null});E(this,Yr,{__proto__:null,transform:[],moveText:[],sameLineText:[],[Lm]:[]});E(this,sf,new Map);E(this,Za,[]);E(this,nf,[]);E(this,nc,[[1,0,0,1,0,0]]);E(this,Kt,[-1/0,-1/0,1/0,1/0]);E(this,ss,new Float64Array([1/0,1/0,-1/0,-1/0]));E(this,rc,-1);E(this,Kr,new Set);E(this,Vb,new Map);E(this,xg,new Map);E(this,rf);E(this,af);E(this,ic);E(this,ar);E(this,Qo);N(this,rf,e.width),N(this,af,e.height),F(this,Wb,i2).call(this,t),n&&N(this,Qo,new Map)}growOperationsCount(e){e>=u(this,ar).length&&F(this,Wb,i2).call(this,e,u(this,ar))}save(e){return N(this,Gr,{__proto__:u(this,Gr)}),N(this,Yr,{__proto__:u(this,Yr),transform:{__proto__:u(this,Yr).transform},moveText:{__proto__:u(this,Yr).moveText},sameLineText:{__proto__:u(this,Yr).sameLineText},[Lm]:{__proto__:u(this,Yr)[Lm]}}),N(this,Kt,{__proto__:u(this,Kt)}),u(this,Za).push(e),this}restore(e){var r;const t=Object.getPrototypeOf(u(this,Gr));if(t===null)return this;N(this,Gr,t),N(this,Yr,Object.getPrototypeOf(u(this,Yr))),N(this,Kt,Object.getPrototypeOf(u(this,Kt)));const n=u(this,Za).pop();return n!==void 0&&((r=c1(u(this,Qo),e))==null||r.dependencies.add(n),u(this,ar)[e]=u(this,ar)[n]),this}recordOpenMarker(e){return u(this,Za).push(e),this}getOpenMarker(){return u(this,Za).length===0?null:u(this,Za).at(-1)}recordCloseMarker(e){var n;const t=u(this,Za).pop();return t!==void 0&&((n=c1(u(this,Qo),e))==null||n.dependencies.add(t),u(this,ar)[e]=u(this,ar)[t]),this}beginMarkedContent(e){return u(this,nf).push(e),this}endMarkedContent(e){var n;const t=u(this,nf).pop();return t!==void 0&&((n=c1(u(this,Qo),e))==null||n.dependencies.add(t),u(this,ar)[e]=u(this,ar)[t]),this}pushBaseTransform(e){return u(this,nc).push(Ge.multiplyByDOMMatrix(u(this,nc).at(-1),e.getTransform())),this}popBaseTransform(){return u(this,nc).length>1&&u(this,nc).pop(),this}recordSimpleData(e,t){return u(this,Gr)[e]=t,this}recordIncrementalData(e,t){return u(this,Yr)[e].push(t),this}resetIncrementalData(e,t){return u(this,Yr)[e].length=0,this}recordNamedData(e,t){return u(this,sf).set(e,t),this}recordSimpleDataFromNamed(e,t,n){u(this,Gr)[e]=u(this,sf).get(t)??n}recordFutureForcedDependency(e,t){return this.recordIncrementalData(Lm,t),this}inheritSimpleDataAsFutureForcedDependencies(e){for(const t of e)t in u(this,Gr)&&this.recordFutureForcedDependency(t,u(this,Gr)[t]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const e of u(this,Kr))this.recordFutureForcedDependency(Lm,e);return this}resetBBox(e){return u(this,rc)!==e&&(N(this,rc,e),u(this,ss)[0]=1/0,u(this,ss)[1]=1/0,u(this,ss)[2]=-1/0,u(this,ss)[3]=-1/0),this}recordClipBox(e,t,n,r,a,o){const l=Ge.multiplyByDOMMatrix(u(this,nc).at(-1),t.getTransform()),c=[1/0,1/0,-1/0,-1/0];Ge.axialAlignedBoundingBox([n,a,r,o],l,c);const d=Ge.intersect(u(this,Kt),c);return d?(u(this,Kt)[0]=d[0],u(this,Kt)[1]=d[1],u(this,Kt)[2]=d[2],u(this,Kt)[3]=d[3]):(u(this,Kt)[0]=u(this,Kt)[1]=1/0,u(this,Kt)[2]=u(this,Kt)[3]=-1/0),this}recordBBox(e,t,n,r,a,o){const l=u(this,Kt);if(l[0]===1/0)return this;const c=Ge.multiplyByDOMMatrix(u(this,nc).at(-1),t.getTransform());if(l[0]===-1/0)return Ge.axialAlignedBoundingBox([n,a,r,o],c,u(this,ss)),this;const d=[1/0,1/0,-1/0,-1/0];return Ge.axialAlignedBoundingBox([n,a,r,o],c,d),u(this,ss)[0]=Math.min(u(this,ss)[0],Math.max(d[0],l[0])),u(this,ss)[1]=Math.min(u(this,ss)[1],Math.max(d[1],l[1])),u(this,ss)[2]=Math.max(u(this,ss)[2],Math.min(d[2],l[2])),u(this,ss)[3]=Math.max(u(this,ss)[3],Math.min(d[3],l[3])),this}recordCharacterBBox(e,t,n,r=1,a=0,o=0,l){const c=n.bbox;let d,h;if(c&&(d=c[2]!==c[0]&&c[3]!==c[1]&&u(this,xg).get(n),d!==!1&&(h=[0,0,0,0],Ge.axialAlignedBoundingBox(c,n.fontMatrix,h),(r!==1||a!==0||o!==0)&&Ge.scaleMinMax([r,0,0,-r,a,o],h),d)))return this.recordBBox(e,t,h[0],h[2],h[1],h[3]);if(!l)return this.recordFullPageBBox(e);const f=l();return c&&h&&d===void 0&&(d=h[0]<=a-f.actualBoundingBoxLeft&&h[2]>=a+f.actualBoundingBoxRight&&h[1]<=o-f.actualBoundingBoxAscent&&h[3]>=o+f.actualBoundingBoxDescent,u(this,xg).set(n,d),d)?this.recordBBox(e,t,h[0],h[2],h[1],h[3]):this.recordBBox(e,t,a-f.actualBoundingBoxLeft,a+f.actualBoundingBoxRight,o-f.actualBoundingBoxAscent,o+f.actualBoundingBoxDescent)}recordFullPageBBox(e){return u(this,ss)[0]=Math.max(0,u(this,Kt)[0]),u(this,ss)[1]=Math.max(0,u(this,Kt)[1]),u(this,ss)[2]=Math.min(u(this,rf),u(this,Kt)[2]),u(this,ss)[3]=Math.min(u(this,af),u(this,Kt)[3]),this}getSimpleIndex(e){return u(this,Gr)[e]}recordDependencies(e,t){const n=u(this,Kr),r=u(this,Gr),a=u(this,Yr);for(const o of t)o in u(this,Gr)?n.add(r[o]):o in a&&a[o].forEach(n.add,n);return this}recordNamedDependency(e,t){return u(this,sf).has(t)&&u(this,Kr).add(u(this,sf).get(t)),this}recordOperation(e,t=!1){if(this.recordDependencies(e,[Lm]),u(this,Qo)){const n=c1(u(this,Qo),e),{dependencies:r}=n;u(this,Kr).forEach(r.add,r),u(this,Za).forEach(r.add,r),u(this,nf).forEach(r.add,r),r.delete(e),n.isRenderingOperation=!0}if(u(this,rc)===e){const n=wO(u(this,ss)[0]*256/u(this,rf)),r=wO(u(this,ss)[1]*256/u(this,af)),a=CO(u(this,ss)[2]*256/u(this,rf)),o=CO(u(this,ss)[3]*256/u(this,af));l1(u(this,ic),e,n,r,a,o);for(const l of u(this,Kr))l!==e&&l1(u(this,ic),l,n,r,a,o);for(const l of u(this,Za))l!==e&&l1(u(this,ic),l,n,r,a,o);for(const l of u(this,nf))l!==e&&l1(u(this,ic),l,n,r,a,o);t||(u(this,Kr).clear(),N(this,rc,-1))}return this}recordShowTextOperation(e,t=!1){const n=Array.from(u(this,Kr));this.recordOperation(e,t),this.recordIncrementalData("sameLineText",e);for(const r of n)this.recordIncrementalData("sameLineText",r);return this}bboxToClipBoxDropOperation(e,t=!1){return u(this,rc)===e&&(N(this,rc,-1),u(this,Kt)[0]=Math.max(u(this,Kt)[0],u(this,ss)[0]),u(this,Kt)[1]=Math.max(u(this,Kt)[1],u(this,ss)[1]),u(this,Kt)[2]=Math.min(u(this,Kt)[2],u(this,ss)[2]),u(this,Kt)[3]=Math.min(u(this,Kt)[3],u(this,ss)[3]),t||u(this,Kr).clear()),this}_takePendingDependencies(){const e=u(this,Kr);return N(this,Kr,new Set),e}_extractOperation(e){const t=u(this,Vb).get(e);return u(this,Vb).delete(e),t}_pushPendingDependencies(e){for(const t of e)u(this,Kr).add(t)}take(){return u(this,xg).clear(),new Eue(u(this,ar),u(this,ic))}takeDebugMetadata(){return u(this,Qo)}}Gr=new WeakMap,Yr=new WeakMap,sf=new WeakMap,Za=new WeakMap,nf=new WeakMap,nc=new WeakMap,Kt=new WeakMap,ss=new WeakMap,rc=new WeakMap,Kr=new WeakMap,Vb=new WeakMap,xg=new WeakMap,rf=new WeakMap,af=new WeakMap,ic=new WeakMap,ar=new WeakMap,Qo=new WeakMap,Wb=new WeakSet,i2=function(e,t){const n=new ArrayBuffer(e*4);N(this,ic,new Uint8ClampedArray(n)),N(this,ar,new Uint32Array(n)),t&&t.length>0?(u(this,ar).set(t),u(this,ar).fill(r2,t.length)):u(this,ar).fill(r2)};var os,Us,Ja,yg,vg;const iI=class iI{constructor(e,t,n){E(this,os);E(this,Us);E(this,Ja);E(this,yg,0);E(this,vg,0);if(e instanceof iI&&u(e,Ja)===!!n)return e;N(this,os,e),N(this,Us,t),N(this,Ja,!!n)}growOperationsCount(){throw new Error("Unreachable")}save(e){return Fs(this,vg)._++,u(this,os).save(u(this,Us)),this}restore(e){return u(this,vg)>0&&(u(this,os).restore(u(this,Us)),Fs(this,vg)._--),this}recordOpenMarker(e){return Fs(this,yg)._++,this}getOpenMarker(){return u(this,yg)>0?u(this,Us):u(this,os).getOpenMarker()}recordCloseMarker(e){return Fs(this,yg)._--,this}beginMarkedContent(e){return this}endMarkedContent(e){return this}pushBaseTransform(e){return u(this,os).pushBaseTransform(e),this}popBaseTransform(){return u(this,os).popBaseTransform(),this}recordSimpleData(e,t){return u(this,os).recordSimpleData(e,u(this,Us)),this}recordIncrementalData(e,t){return u(this,os).recordIncrementalData(e,u(this,Us)),this}resetIncrementalData(e,t){return u(this,os).resetIncrementalData(e,u(this,Us)),this}recordNamedData(e,t){return this}recordSimpleDataFromNamed(e,t,n){return u(this,os).recordSimpleDataFromNamed(e,t,u(this,Us)),this}recordFutureForcedDependency(e,t){return u(this,os).recordFutureForcedDependency(e,u(this,Us)),this}inheritSimpleDataAsFutureForcedDependencies(e){return u(this,os).inheritSimpleDataAsFutureForcedDependencies(e),this}inheritPendingDependenciesAsFutureForcedDependencies(){return u(this,os).inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(e){return u(this,Ja)||u(this,os).resetBBox(u(this,Us)),this}recordClipBox(e,t,n,r,a,o){return u(this,Ja)||u(this,os).recordClipBox(u(this,Us),t,n,r,a,o),this}recordBBox(e,t,n,r,a,o){return u(this,Ja)||u(this,os).recordBBox(u(this,Us),t,n,r,a,o),this}recordCharacterBBox(e,t,n,r,a,o,l){return u(this,Ja)||u(this,os).recordCharacterBBox(u(this,Us),t,n,r,a,o,l),this}recordFullPageBBox(e){return u(this,Ja)||u(this,os).recordFullPageBBox(u(this,Us)),this}getSimpleIndex(e){return u(this,os).getSimpleIndex(e)}recordDependencies(e,t){return u(this,os).recordDependencies(u(this,Us),t),this}recordNamedDependency(e,t){return u(this,os).recordNamedDependency(u(this,Us),t),this}recordOperation(e){return u(this,os).recordOperation(u(this,Us),!0),this}recordShowTextOperation(e){return u(this,os).recordShowTextOperation(u(this,Us),!0),this}bboxToClipBoxDropOperation(e){return u(this,Ja)||u(this,os).bboxToClipBoxDropOperation(u(this,Us),!0),this}take(){throw new Error("Unreachable")}takeDebugMetadata(){throw new Error("Unreachable")}};os=new WeakMap,Us=new WeakMap,Ja=new WeakMap,yg=new WeakMap,vg=new WeakMap;let DS=iI;const ra={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],transform:["transform"],transformAndFill:["transform","fillColor"]},Vn={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function a2(s,e){if(!e)return;const t=e[2]-e[0],n=e[3]-e[1],r=new Path2D;r.rect(e[0],e[1],t,n),s.clip(r)}class BM{isModifyingCurrentTransform(){return!1}getPattern(){ds("Abstract method `getPattern` called.")}}class Mue extends BM{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const n of this._colorStops)t.addColorStop(n[0],n[1]);return t}getPattern(e,t,n,r){let a;if(r===Vn.STROKE||r===Vn.FILL){const o=t.current.getClippedPathBoundingBox(r,Ps(e))||[0,0,0,0],l=Math.ceil(o[2]-o[0])||1,c=Math.ceil(o[3]-o[1])||1,d=t.cachedCanvases.getCanvas("pattern",l,c),h=d.context;h.clearRect(0,0,h.canvas.width,h.canvas.height),h.beginPath(),h.rect(0,0,h.canvas.width,h.canvas.height),h.translate(-o[0],-o[1]),n=Ge.transform(n,[1,0,0,1,o[0],o[1]]),h.transform(...t.baseTransform),this.matrix&&h.transform(...this.matrix),a2(h,this._bbox),h.fillStyle=this._createGradient(h),h.fill(),a=e.createPattern(d.canvas,"no-repeat");const f=new DOMMatrix(n);a.setTransform(f)}else a2(e,this._bbox),a=this._createGradient(e);return a}}function jA(s,e,t,n,r,a,o,l){const c=e.coords,d=e.colors,h=s.data,f=s.width*4;let m;c[t+1]>c[n+1]&&(m=t,t=n,n=m,m=a,a=o,o=m),c[n+1]>c[r+1]&&(m=n,n=r,r=m,m=o,o=l,l=m),c[t+1]>c[n+1]&&(m=t,t=n,n=m,m=a,a=o,o=m);const p=(c[t]+e.offsetX)*e.scaleX,x=(c[t+1]+e.offsetY)*e.scaleY,g=(c[n]+e.offsetX)*e.scaleX,b=(c[n+1]+e.offsetY)*e.scaleY,v=(c[r]+e.offsetX)*e.scaleX,y=(c[r+1]+e.offsetY)*e.scaleY;if(x>=y)return;const w=d[a],S=d[a+1],j=d[a+2],A=d[o],k=d[o+1],_=d[o+2],L=d[l],D=d[l+1],P=d[l+2],T=Math.round(x),B=Math.round(y);let R,O,I,U,M,$,W,ee;for(let Z=T;Z<=B;Z++){if(Z<b){const H=Z<x?0:(x-Z)/(x-b);R=p-(p-g)*H,O=w-(w-A)*H,I=S-(S-k)*H,U=j-(j-_)*H}else{let H;Z>y?H=1:b===y?H=0:H=(b-Z)/(b-y),R=g-(g-v)*H,O=A-(A-L)*H,I=k-(k-D)*H,U=_-(_-P)*H}let z;Z<x?z=0:Z>y?z=1:z=(x-Z)/(x-y),M=p-(p-v)*z,$=w-(w-L)*z,W=S-(S-D)*z,ee=j-(j-P)*z;const se=Math.round(Math.min(R,M)),de=Math.round(Math.max(R,M));let ne=f*Z+se*4;for(let H=se;H<=de;H++)z=(R-H)/(R-M),z<0?z=0:z>1&&(z=1),h[ne++]=O-(O-$)*z|0,h[ne++]=I-(I-W)*z|0,h[ne++]=U-(U-ee)*z|0,h[ne++]=255}}function Iue(s,e,t){const n=e.coords,r=e.colors;let a,o;switch(e.type){case PT.LATTICE:const l=e.verticesPerRow,c=Math.floor(n.length/l)-1,d=l-1;for(a=0;a<c;a++){let h=a*l;for(let f=0;f<d;f++,h++)jA(s,t,n[h],n[h+1],n[h+l],r[h],r[h+1],r[h+l]),jA(s,t,n[h+l+1],n[h+1],n[h+l],r[h+l+1],r[h+1],r[h+l])}break;case PT.TRIANGLES:for(a=0,o=n.length;a<o;a+=3)jA(s,t,n[a],n[a+1],n[a+2],r[a],r[a+1],r[a+2]);break;default:throw new Error("illegal figure")}}class Rue extends BM{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[6],this._background=e[7],this.matrix=null}_createMeshCanvas(e,t,n){const l=Math.floor(this._bounds[0]),c=Math.floor(this._bounds[1]),d=Math.ceil(this._bounds[2])-l,h=Math.ceil(this._bounds[3])-c,f=Math.min(Math.ceil(Math.abs(d*e[0]*1.1)),3e3),m=Math.min(Math.ceil(Math.abs(h*e[1]*1.1)),3e3),p=d/f,x=h/m,g={coords:this._coords,colors:this._colors,offsetX:-l,offsetY:-c,scaleX:1/p,scaleY:1/x},b=f+2*2,v=m+2*2,y=n.getCanvas("mesh",b,v),w=y.context,S=w.createImageData(f,m);if(t){const A=S.data;for(let k=0,_=A.length;k<_;k+=4)A[k]=t[0],A[k+1]=t[1],A[k+2]=t[2],A[k+3]=255}for(const A of this._figures)Iue(S,A,g);return w.putImageData(S,2,2),{canvas:y.canvas,offsetX:l-2*p,offsetY:c-2*x,scaleX:p,scaleY:x}}isModifyingCurrentTransform(){return!0}getPattern(e,t,n,r){a2(e,this._bbox);const a=new Float32Array(2);if(r===Vn.SHADING)Ge.singularValueDecompose2dScale(Ps(e),a);else if(this.matrix){Ge.singularValueDecompose2dScale(this.matrix,a);const[l,c]=a;Ge.singularValueDecompose2dScale(t.baseTransform,a),a[0]*=l,a[1]*=c}else Ge.singularValueDecompose2dScale(t.baseTransform,a);const o=this._createMeshCanvas(a,r===Vn.SHADING?null:this._background,t.cachedCanvases);return r!==Vn.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(o.offsetX,o.offsetY),e.scale(o.scaleX,o.scaleY),e.createPattern(o.canvas,"no-repeat")}}class Due extends BM{getPattern(){return"hotpink"}}function Lue(s){switch(s[0]){case"RadialAxial":return new Mue(s);case"Mesh":return new Rue(s);case"Dummy":return new Due}throw new Error(`Unknown IR type: ${s[0]}`)}const SO={COLORED:1,UNCOLORED:2},tj=class tj{constructor(e,t,n,r){this.color=e[1],this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.ctx=t,this.canvasGraphicsFactory=n,this.baseTransform=r}createPatternCanvas(e,t){var $,W;const{bbox:n,operatorList:r,paintType:a,tilingType:o,color:l,canvasGraphicsFactory:c}=this;let{xstep:d,ystep:h}=this;d=Math.abs(d),h=Math.abs(h),Ok("TilingType: "+o);const f=n[0],m=n[1],p=n[2],x=n[3],g=p-f,b=x-m,v=new Float32Array(2);Ge.singularValueDecompose2dScale(this.matrix,v);const[y,w]=v;Ge.singularValueDecompose2dScale(this.baseTransform,v);const S=y*v[0],j=w*v[1];let A=g,k=b,_=!1,L=!1;const D=Math.ceil(d*S),P=Math.ceil(h*j),T=Math.ceil(g*S),B=Math.ceil(b*j);D>=T?A=d:_=!0,P>=B?k=h:L=!0;const R=this.getSizeAndScale(A,this.ctx.canvas.width,S),O=this.getSizeAndScale(k,this.ctx.canvas.height,j),I=e.cachedCanvases.getCanvas("pattern",R.size,O.size),U=I.context,M=c.createCanvasGraphics(U,t);if(M.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(M,a,l),U.translate(-R.scale*f,-O.scale*m),M.transform(0,R.scale,0,0,O.scale,0,0),U.save(),($=M.dependencyTracker)==null||$.save(),this.clipBbox(M,f,m,p,x),M.baseTransform=Ps(M.ctx),M.executeOperatorList(r),M.endDrawing(),(W=M.dependencyTracker)==null||W.restore(),U.restore(),_||L){const ee=I.canvas;_&&(A=d),L&&(k=h);const Z=this.getSizeAndScale(A,this.ctx.canvas.width,S),z=this.getSizeAndScale(k,this.ctx.canvas.height,j),se=Z.size,de=z.size,ne=e.cachedCanvases.getCanvas("pattern-workaround",se,de),H=ne.context,Y=_?Math.floor(g/d):0,ae=L?Math.floor(b/h):0;for(let ce=0;ce<=Y;ce++)for(let Ue=0;Ue<=ae;Ue++)H.drawImage(ee,se*ce,de*Ue,se,de,0,0,se,de);return{canvas:ne.canvas,scaleX:Z.scale,scaleY:z.scale,offsetX:f,offsetY:m}}return{canvas:I.canvas,scaleX:R.scale,scaleY:O.scale,offsetX:f,offsetY:m}}getSizeAndScale(e,t,n){const r=Math.max(tj.MAX_PATTERN_SIZE,t);let a=Math.ceil(e*n);return a>=r?a=r:n=a/e,{scale:n,size:a}}clipBbox(e,t,n,r,a){const o=r-t,l=a-n;e.ctx.rect(t,n,o,l),Ge.axialAlignedBoundingBox([t,n,r,a],Ps(e.ctx),e.current.minMax),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,n){const r=e.ctx,a=e.current;switch(t){case SO.COLORED:const{fillStyle:o,strokeStyle:l}=this.ctx;r.fillStyle=a.fillColor=o,r.strokeStyle=a.strokeColor=l;break;case SO.UNCOLORED:r.fillStyle=r.strokeStyle=n,a.fillColor=a.strokeColor=n;break;default:throw new Kde(`Unsupported paint type: ${t}`)}}isModifyingCurrentTransform(){return!1}getPattern(e,t,n,r,a){let o=n;r!==Vn.SHADING&&(o=Ge.transform(o,t.baseTransform),this.matrix&&(o=Ge.transform(o,this.matrix)));const l=this.createPatternCanvas(t,a);let c=new DOMMatrix(o);c=c.translate(l.offsetX,l.offsetY),c=c.scale(1/l.scaleX,1/l.scaleY);const d=e.createPattern(l.canvas,"repeat");return d.setTransform(c),d}};Ce(tj,"MAX_PATTERN_SIZE",3e3);let o2=tj;function Oue({src:s,srcPos:e=0,dest:t,width:n,height:r,nonBlackColor:a=4294967295,inverseDecode:o=!1}){const l=Yn.isLittleEndian?4278190080:255,[c,d]=o?[a,l]:[l,a],h=n>>3,f=n&7,m=s.length;t=new Uint32Array(t.buffer);let p=0;for(let x=0;x<r;x++){for(const b=e+h;e<b;e++){const v=e<m?s[e]:255;t[p++]=v&128?d:c,t[p++]=v&64?d:c,t[p++]=v&32?d:c,t[p++]=v&16?d:c,t[p++]=v&8?d:c,t[p++]=v&4?d:c,t[p++]=v&2?d:c,t[p++]=v&1?d:c}if(f===0)continue;const g=e<m?s[e++]:255;for(let b=0;b<f;b++)t[p++]=g&1<<7-b?d:c}return{srcPos:e,destPos:p}}const jO=16,kO=100,Fue=15,NO=10,ei=16,kA=new DOMMatrix,Fi=new Float32Array(2),mp=new Float32Array([1/0,1/0,-1/0,-1/0]);function Bue(s,e){if(s._removeMirroring)throw new Error("Context is already forwarding operations.");s.__originalSave=s.save,s.__originalRestore=s.restore,s.__originalRotate=s.rotate,s.__originalScale=s.scale,s.__originalTranslate=s.translate,s.__originalTransform=s.transform,s.__originalSetTransform=s.setTransform,s.__originalResetTransform=s.resetTransform,s.__originalClip=s.clip,s.__originalMoveTo=s.moveTo,s.__originalLineTo=s.lineTo,s.__originalBezierCurveTo=s.bezierCurveTo,s.__originalRect=s.rect,s.__originalClosePath=s.closePath,s.__originalBeginPath=s.beginPath,s._removeMirroring=()=>{s.save=s.__originalSave,s.restore=s.__originalRestore,s.rotate=s.__originalRotate,s.scale=s.__originalScale,s.translate=s.__originalTranslate,s.transform=s.__originalTransform,s.setTransform=s.__originalSetTransform,s.resetTransform=s.__originalResetTransform,s.clip=s.__originalClip,s.moveTo=s.__originalMoveTo,s.lineTo=s.__originalLineTo,s.bezierCurveTo=s.__originalBezierCurveTo,s.rect=s.__originalRect,s.closePath=s.__originalClosePath,s.beginPath=s.__originalBeginPath,delete s._removeMirroring},s.save=function(){e.save(),this.__originalSave()},s.restore=function(){e.restore(),this.__originalRestore()},s.translate=function(t,n){e.translate(t,n),this.__originalTranslate(t,n)},s.scale=function(t,n){e.scale(t,n),this.__originalScale(t,n)},s.transform=function(t,n,r,a,o,l){e.transform(t,n,r,a,o,l),this.__originalTransform(t,n,r,a,o,l)},s.setTransform=function(t,n,r,a,o,l){e.setTransform(t,n,r,a,o,l),this.__originalSetTransform(t,n,r,a,o,l)},s.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},s.rotate=function(t){e.rotate(t),this.__originalRotate(t)},s.clip=function(t){e.clip(t),this.__originalClip(t)},s.moveTo=function(t,n){e.moveTo(t,n),this.__originalMoveTo(t,n)},s.lineTo=function(t,n){e.lineTo(t,n),this.__originalLineTo(t,n)},s.bezierCurveTo=function(t,n,r,a,o,l){e.bezierCurveTo(t,n,r,a,o,l),this.__originalBezierCurveTo(t,n,r,a,o,l)},s.rect=function(t,n,r,a){e.rect(t,n,r,a),this.__originalRect(t,n,r,a)},s.closePath=function(){e.closePath(),this.__originalClosePath()},s.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class $ue{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,n){let r;return this.cache[e]!==void 0?(r=this.cache[e],this.canvasFactory.reset(r,t,n)):(r=this.canvasFactory.create(t,n),this.cache[e]=r),r}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function d1(s,e,t,n,r,a,o,l,c,d){const[h,f,m,p,x,g]=Ps(s);if(f===0&&m===0){const y=o*h+x,w=Math.round(y),S=l*p+g,j=Math.round(S),A=(o+c)*h+x,k=Math.abs(Math.round(A)-w)||1,_=(l+d)*p+g,L=Math.abs(Math.round(_)-j)||1;return s.setTransform(Math.sign(h),0,0,Math.sign(p),w,j),s.drawImage(e,t,n,r,a,0,0,k,L),s.setTransform(h,f,m,p,x,g),[k,L]}if(h===0&&p===0){const y=l*m+x,w=Math.round(y),S=o*f+g,j=Math.round(S),A=(l+d)*m+x,k=Math.abs(Math.round(A)-w)||1,_=(o+c)*f+g,L=Math.abs(Math.round(_)-j)||1;return s.setTransform(0,Math.sign(f),Math.sign(m),0,w,j),s.drawImage(e,t,n,r,a,0,0,L,k),s.setTransform(h,f,m,p,x,g),[L,k]}s.drawImage(e,t,n,r,a,o,l,c,d);const b=Math.hypot(h,f),v=Math.hypot(m,p);return[b*c,v*d]}class AO{constructor(e,t,n){Ce(this,"alphaIsShape",!1);Ce(this,"fontSize",0);Ce(this,"fontSizeScale",1);Ce(this,"textMatrix",null);Ce(this,"textMatrixScale",1);Ce(this,"fontMatrix",ET);Ce(this,"leading",0);Ce(this,"x",0);Ce(this,"y",0);Ce(this,"lineX",0);Ce(this,"lineY",0);Ce(this,"charSpacing",0);Ce(this,"wordSpacing",0);Ce(this,"textHScale",1);Ce(this,"textRenderingMode",Ln.FILL);Ce(this,"textRise",0);Ce(this,"fillColor","#000000");Ce(this,"strokeColor","#000000");Ce(this,"patternFill",!1);Ce(this,"patternStroke",!1);Ce(this,"fillAlpha",1);Ce(this,"strokeAlpha",1);Ce(this,"lineWidth",1);Ce(this,"activeSMask",null);Ce(this,"transferMaps","none");n==null||n(this),this.clipBox=new Float32Array([0,0,e,t]),this.minMax=mp.slice()}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e.minMax=this.minMax.slice(),e}getPathBoundingBox(e=Vn.FILL,t=null){const n=this.minMax.slice();if(e===Vn.STROKE){t||ds("Stroke bounding box must include transform."),Ge.singularValueDecompose2dScale(t,Fi);const r=Fi[0]*this.lineWidth/2,a=Fi[1]*this.lineWidth/2;n[0]-=r,n[1]-=a,n[2]+=r,n[3]+=a}return n}updateClipFromPath(){const e=Ge.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(e){this.clipBox.set(e,0),this.minMax.set(mp,0)}getClippedPathBoundingBox(e=Vn.FILL,t=null){return Ge.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function _O(s,e){if(e instanceof ImageData){s.putImageData(e,0,0);return}const t=e.height,n=e.width,r=t%ei,a=(t-r)/ei,o=r===0?a:a+1,l=s.createImageData(n,ei);let c=0,d;const h=e.data,f=l.data;let m,p,x,g;if(e.kind===$1.GRAYSCALE_1BPP){const b=h.byteLength,v=new Uint32Array(f.buffer,0,f.byteLength>>2),y=v.length,w=n+7>>3,S=4294967295,j=Yn.isLittleEndian?4278190080:255;for(m=0;m<o;m++){for(x=m<a?ei:r,d=0,p=0;p<x;p++){const A=b-c;let k=0;const _=A>w?n:A*8-7,L=_&-8;let D=0,P=0;for(;k<L;k+=8)P=h[c++],v[d++]=P&128?S:j,v[d++]=P&64?S:j,v[d++]=P&32?S:j,v[d++]=P&16?S:j,v[d++]=P&8?S:j,v[d++]=P&4?S:j,v[d++]=P&2?S:j,v[d++]=P&1?S:j;for(;k<_;k++)D===0&&(P=h[c++],D=128),v[d++]=P&D?S:j,D>>=1}for(;d<y;)v[d++]=0;s.putImageData(l,0,m*ei)}}else if(e.kind===$1.RGBA_32BPP){for(p=0,g=n*ei*4,m=0;m<a;m++)f.set(h.subarray(c,c+g)),c+=g,s.putImageData(l,0,p),p+=ei;m<o&&(g=n*r*4,f.set(h.subarray(c,c+g)),s.putImageData(l,0,p))}else if(e.kind===$1.RGB_24BPP)for(x=ei,g=n*x,m=0;m<o;m++){for(m>=a&&(x=r,g=n*x),d=0,p=g;p--;)f[d++]=h[c++],f[d++]=h[c++],f[d++]=h[c++],f[d++]=255;s.putImageData(l,0,m*ei)}else throw new Error(`bad image kind: ${e.kind}`)}function TO(s,e){if(e.bitmap){s.drawImage(e.bitmap,0,0);return}const t=e.height,n=e.width,r=t%ei,a=(t-r)/ei,o=r===0?a:a+1,l=s.createImageData(n,ei);let c=0;const d=e.data,h=l.data;for(let f=0;f<o;f++){const m=f<a?ei:r;({srcPos:c}=Oue({src:d,srcPos:c,dest:h,width:n,height:m,nonBlackColor:0})),s.putImageData(l,0,f*ei)}}function oy(s,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const n of t)s[n]!==void 0&&(e[n]=s[n]);s.setLineDash!==void 0&&(e.setLineDash(s.getLineDash()),e.lineDashOffset=s.lineDashOffset)}function u1(s){s.strokeStyle=s.fillStyle="#000000",s.fillRule="nonzero",s.globalAlpha=1,s.lineWidth=1,s.lineCap="butt",s.lineJoin="miter",s.miterLimit=10,s.globalCompositeOperation="source-over",s.font="10px sans-serif",s.setLineDash!==void 0&&(s.setLineDash([]),s.lineDashOffset=0);const{filter:e}=s;e!=="none"&&e!==""&&(s.filter="none")}function EO(s,e){if(e)return!0;Ge.singularValueDecompose2dScale(s,Fi);const t=Math.fround(Cl.pixelRatio*zu.PDF_TO_CSS_UNITS);return Fi[0]<=t&&Fi[1]<=t}const Uue=["butt","round","square"],zue=["miter","round","bevel"],Hue={},PO={};var Ao,l2,c2,d2;const aI=class aI{constructor(e,t,n,r,a,{optionalContentConfig:o,markedContentStack:l=null},c,d,h){E(this,Ao);this.ctx=e,this.current=new AO(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=n,this.canvasFactory=r,this.filterFactory=a,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=l||[],this.optionalContentConfig=o,this.cachedCanvases=new $ue(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=c,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=d,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=h??null}getObject(e,t,n=null){var r;return typeof t=="string"?((r=this.dependencyTracker)==null||r.recordNamedDependency(e,t),t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t)):n}beginDrawing({transform:e,viewport:t,transparency:n=!1,background:r=null}){const a=this.ctx.canvas.width,o=this.ctx.canvas.height,l=this.ctx.fillStyle;if(this.ctx.fillStyle=r||"#ffffff",this.ctx.fillRect(0,0,a,o),this.ctx.fillStyle=l,n){const c=this.cachedCanvases.getCanvas("transparent",a,o);this.compositeCtx=this.ctx,this.transparentCanvas=c.canvas,this.ctx=c.context,this.ctx.save(),this.ctx.transform(...Ps(this.compositeCtx))}this.ctx.save(),u1(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=Ps(this.ctx)}executeOperatorList(e,t,n,r,a){var v;const o=e.argsArray,l=e.fnArray;let c=t||0;const d=o.length;if(d===c)return c;const h=d-c>NO&&typeof n=="function",f=h?Date.now()+Fue:0;let m=0;const p=this.commonObjs,x=this.objs;let g,b;for(;;){if(r!==void 0&&c===r.nextBreakPoint)return r.breakIt(c,n),c;if(!a||a(c))if(g=l[c],b=o[c]??null,g!==Gv.dependency)b===null?this[g](c):this[g](c,...b);else for(const y of b){(v=this.dependencyTracker)==null||v.recordNamedData(y,c);const w=y.startsWith("g_")?p:x;if(!w.has(y))return w.get(y,n),c}if(c++,c===d)return c;if(h&&++m>NO){if(Date.now()>f)return n(),c;m=0}}}endDrawing(){F(this,Ao,l2).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),F(this,Ao,c2).call(this)}_scaleImage(e,t){const n=e.width??e.displayWidth,r=e.height??e.displayHeight;let a=Math.max(Math.hypot(t[0],t[1]),1),o=Math.max(Math.hypot(t[2],t[3]),1),l=n,c=r,d="prescale1",h,f;for(;a>2&&l>1||o>2&&c>1;){let m=l,p=c;a>2&&l>1&&(m=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l/2),a/=l/m),o>2&&c>1&&(p=c>=16384?Math.floor(c/2)-1||1:Math.ceil(c)/2,o/=c/p),h=this.cachedCanvases.getCanvas(d,m,p),f=h.context,f.clearRect(0,0,m,p),f.drawImage(e,0,0,l,c,0,0,m,p),e=h.canvas,l=m,c=p,d=d==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:l,paintHeight:c}}_createMaskCanvas(e,t){var D,P;const n=this.ctx,{width:r,height:a}=t,o=this.current.fillColor,l=this.current.patternFill,c=Ps(n);let d,h,f,m;if((t.bitmap||t.data)&&t.count>1){const T=t.bitmap||t.data.buffer;h=JSON.stringify(l?c:[c.slice(0,4),o]),d=this._cachedBitmapsMap.get(T),d||(d=new Map,this._cachedBitmapsMap.set(T,d));const B=d.get(h);if(B&&!l){const R=Math.round(Math.min(c[0],c[2])+c[4]),O=Math.round(Math.min(c[1],c[3])+c[5]);return(D=this.dependencyTracker)==null||D.recordDependencies(e,ra.transformAndFill),{canvas:B,offsetX:R,offsetY:O}}f=B}f||(m=this.cachedCanvases.getCanvas("maskCanvas",r,a),TO(m.context,t));let p=Ge.transform(c,[1/r,0,0,-1/a,0,0]);p=Ge.transform(p,[1,0,0,1,0,-a]);const x=mp.slice();Ge.axialAlignedBoundingBox([0,0,r,a],p,x);const[g,b,v,y]=x,w=Math.round(v-g)||1,S=Math.round(y-b)||1,j=this.cachedCanvases.getCanvas("fillCanvas",w,S),A=j.context,k=g,_=b;A.translate(-k,-_),A.transform(...p),f||(f=this._scaleImage(m.canvas,Mo(A)),f=f.img,d&&l&&d.set(h,f)),A.imageSmoothingEnabled=EO(Ps(A),t.interpolate),d1(A,f,0,0,f.width,f.height,0,0,r,a),A.globalCompositeOperation="source-in";const L=Ge.transform(Mo(A),[1,0,0,1,-k,-_]);return A.fillStyle=l?o.getPattern(n,this,L,Vn.FILL,e):o,A.fillRect(0,0,r,a),d&&!l&&(this.cachedCanvases.delete("fillCanvas"),d.set(h,j.canvas)),(P=this.dependencyTracker)==null||P.recordDependencies(e,ra.transformAndFill),{canvas:j.canvas,offsetX:Math.round(k),offsetY:Math.round(_)}}setLineWidth(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("lineWidth",e),t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("lineCap",e),this.ctx.lineCap=Uue[t]}setLineJoin(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("lineJoin",e),this.ctx.lineJoin=zue[t]}setMiterLimit(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("miterLimit",e),this.ctx.miterLimit=t}setDash(e,t,n){var a;(a=this.dependencyTracker)==null||a.recordSimpleData("dash",e);const r=this.ctx;r.setLineDash!==void 0&&(r.setLineDash(t),r.lineDashOffset=n)}setRenderingIntent(e,t){}setFlatness(e,t){}setGState(e,t){var n,r,a,o,l;for(const[c,d]of t)switch(c){case"LW":this.setLineWidth(e,d);break;case"LC":this.setLineCap(e,d);break;case"LJ":this.setLineJoin(e,d);break;case"ML":this.setMiterLimit(e,d);break;case"D":this.setDash(e,d[0],d[1]);break;case"RI":this.setRenderingIntent(e,d);break;case"FL":this.setFlatness(e,d);break;case"Font":this.setFont(e,d[0],d[1]);break;case"CA":(n=this.dependencyTracker)==null||n.recordSimpleData("strokeAlpha",e),this.current.strokeAlpha=d;break;case"ca":(r=this.dependencyTracker)==null||r.recordSimpleData("fillAlpha",e),this.ctx.globalAlpha=this.current.fillAlpha=d;break;case"BM":(a=this.dependencyTracker)==null||a.recordSimpleData("globalCompositeOperation",e),this.ctx.globalCompositeOperation=d;break;case"SMask":(o=this.dependencyTracker)==null||o.recordSimpleData("SMask",e),this.current.activeSMask=d?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":(l=this.dependencyTracker)==null||l.recordSimpleData("filter",e),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(d);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(e){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const t=this.ctx.canvas.width,n=this.ctx.canvas.height,r="smaskGroupAt"+this.groupLevel,a=this.cachedCanvases.getCanvas(r,t,n);this.suspendedCtx=this.ctx;const o=this.ctx=a.context;o.setTransform(this.suspendedCtx.getTransform()),oy(this.suspendedCtx,o),Bue(o,this.suspendedCtx),this.setGState(e,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),oy(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,n,r){const a=r[0],o=r[1],l=r[2]-a,c=r[3]-o;l===0||c===0||(this.genericComposeSMask(t.context,n,l,c,t.subtype,t.backdrop,t.transferMap,a,o,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(n.canvas,0,0),e.restore())}genericComposeSMask(e,t,n,r,a,o,l,c,d,h,f){let m=e.canvas,p=c-h,x=d-f;if(o)if(p<0||x<0||p+n>m.width||x+r>m.height){const b=this.cachedCanvases.getCanvas("maskExtension",n,r),v=b.context;v.drawImage(m,-p,-x),v.globalCompositeOperation="destination-atop",v.fillStyle=o,v.fillRect(0,0,n,r),v.globalCompositeOperation="source-over",m=b.canvas,p=x=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const b=new Path2D;b.rect(p,x,n,r),e.clip(b),e.globalCompositeOperation="destination-atop",e.fillStyle=o,e.fillRect(p,x,n,r),e.restore()}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),a==="Alpha"&&l?t.filter=this.filterFactory.addAlphaFilter(l):a==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(l));const g=new Path2D;g.rect(c,d,n,r),t.clip(g),t.globalCompositeOperation="destination-in",t.drawImage(m,p,x,n,r,c,d,n,r),t.restore()}save(e){var n;this.inSMaskMode&&oy(this.ctx,this.suspendedCtx),this.ctx.save();const t=this.current;this.stateStack.push(t),this.current=t.clone(),(n=this.dependencyTracker)==null||n.save(e)}restore(e){var t;if((t=this.dependencyTracker)==null||t.restore(e),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&oy(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(e,t,n,r,a,o,l){var c;(c=this.dependencyTracker)==null||c.recordIncrementalData("transform",e),this.ctx.transform(t,n,r,a,o,l),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,n,r){let[a]=n;if(!r){a||(a=n[0]=new Path2D),this[t](e,a);return}if(this.dependencyTracker!==null){const o=t===Gv.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(e).recordBBox(e,this.ctx,r[0]-o,r[2]+o,r[1]-o,r[3]+o).recordDependencies(e,["transform"])}a instanceof Path2D||(a=n[0]=Dz(a)),Ge.axialAlignedBoundingBox(r,Ps(this.ctx),this.current.minMax),this[t](e,a),this._pathStartIdx=e}closePath(e){this.ctx.closePath()}stroke(e,t,n=!0){var o;const r=this.ctx,a=this.current.strokeColor;if(r.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof a=="object"&&(a!=null&&a.getPattern)){const l=a.isModifyingCurrentTransform()?r.getTransform():null;if(r.save(),r.strokeStyle=a.getPattern(r,this,Mo(r),Vn.STROKE,e),l){const c=new Path2D;c.addPath(t,r.getTransform().invertSelf().multiplySelf(l)),t=c}this.rescaleAndStroke(t,!1),r.restore()}else this.rescaleAndStroke(t,!0);(o=this.dependencyTracker)==null||o.recordDependencies(e,ra.stroke),n&&this.consumePath(e,t,this.current.getClippedPathBoundingBox(Vn.STROKE,Ps(this.ctx))),r.globalAlpha=this.current.fillAlpha}closeStroke(e,t){this.stroke(e,t)}fill(e,t,n=!0){var d,h,f;const r=this.ctx,a=this.current.fillColor,o=this.current.patternFill;let l=!1;if(o){const m=a.isModifyingCurrentTransform()?r.getTransform():null;if((d=this.dependencyTracker)==null||d.save(e),r.save(),r.fillStyle=a.getPattern(r,this,Mo(r),Vn.FILL,e),m){const p=new Path2D;p.addPath(t,r.getTransform().invertSelf().multiplySelf(m)),t=p}l=!0}const c=this.current.getClippedPathBoundingBox();this.contentVisible&&c!==null&&(this.pendingEOFill?(r.fill(t,"evenodd"),this.pendingEOFill=!1):r.fill(t)),(h=this.dependencyTracker)==null||h.recordDependencies(e,ra.fill),l&&(r.restore(),(f=this.dependencyTracker)==null||f.restore(e)),n&&this.consumePath(e,t,c)}eoFill(e,t){this.pendingEOFill=!0,this.fill(e,t)}fillStroke(e,t){this.fill(e,t,!1),this.stroke(e,t,!1),this.consumePath(e,t)}eoFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}closeFillStroke(e,t){this.fillStroke(e,t)}closeEOFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}endPath(e,t){this.consumePath(e,t)}rawFillPath(e,t){var n;this.ctx.fill(t),(n=this.dependencyTracker)==null||n.recordDependencies(e,ra.rawFillPath).recordOperation(e)}clip(e){var t;(t=this.dependencyTracker)==null||t.recordFutureForcedDependency("clipMode",e),this.pendingClip=Hue}eoClip(e){var t;(t=this.dependencyTracker)==null||t.recordFutureForcedDependency("clipMode",e),this.pendingClip=PO}beginText(e){var t;this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,(t=this.dependencyTracker)==null||t.recordOpenMarker(e).resetIncrementalData("sameLineText").resetIncrementalData("moveText",e)}endText(e){const t=this.pendingTextPaths,n=this.ctx;if(this.dependencyTracker){const{dependencyTracker:r}=this;t!==void 0&&r.recordFutureForcedDependency("textClip",r.getOpenMarker()).recordFutureForcedDependency("textClip",e),r.recordCloseMarker(e)}if(t!==void 0){const r=new Path2D,a=n.getTransform().invertSelf();for(const{transform:o,x:l,y:c,fontSize:d,path:h}of t)h&&r.addPath(h,new DOMMatrix(o).preMultiplySelf(a).translate(l,c).scale(d,-d));n.clip(r)}delete this.pendingTextPaths}setCharSpacing(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("charSpacing",e),this.current.charSpacing=t}setWordSpacing(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("wordSpacing",e),this.current.wordSpacing=t}setHScale(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("hScale",e),this.current.textHScale=t/100}setLeading(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("leading",e),this.current.leading=-t}setFont(e,t,n){var f,m;(f=this.dependencyTracker)==null||f.recordSimpleData("font",e).recordSimpleDataFromNamed("fontObj",t,e);const r=this.commonObjs.get(t),a=this.current;if(!r)throw new Error(`Can't find font for ${t}`);if(a.fontMatrix=r.fontMatrix||ET,(a.fontMatrix[0]===0||a.fontMatrix[3]===0)&&ut("Invalid font matrix for font "+t),n<0?(n=-n,a.fontDirection=-1):a.fontDirection=1,this.current.font=r,this.current.fontSize=n,r.isType3Font)return;const o=r.loadedName||"sans-serif",l=((m=r.systemFontInfo)==null?void 0:m.css)||`"${o}", ${r.fallbackName}`;let c="normal";r.black?c="900":r.bold&&(c="bold");const d=r.italic?"italic":"normal";let h=n;n<jO?h=jO:n>kO&&(h=kO),this.current.fontSizeScale=n/h,this.ctx.font=`${d} ${c} ${h}px ${l}`}setTextRenderingMode(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("textRenderingMode",e),this.current.textRenderingMode=t}setTextRise(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("textRise",e),this.current.textRise=t}moveText(e,t,n){var r;(r=this.dependencyTracker)==null||r.resetIncrementalData("sameLineText").recordIncrementalData("moveText",e),this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=n}setLeadingMoveText(e,t,n){this.setLeading(e,-n),this.moveText(e,t,n)}setTextMatrix(e,t){var r;(r=this.dependencyTracker)==null||r.resetIncrementalData("sameLineText").recordSimpleData("textMatrix",e);const{current:n}=this;n.textMatrix=t,n.textMatrixScale=Math.hypot(t[0],t[1]),n.x=n.lineX=0,n.y=n.lineY=0}nextLine(e){var t;this.moveText(e,0,this.current.leading),(t=this.dependencyTracker)==null||t.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??e)}paintChar(e,t,n,r,a,o){var v,y,w,S;const l=this.ctx,c=this.current,d=c.font,h=c.textRenderingMode,f=c.fontSize/c.fontSizeScale,m=h&Ln.FILL_STROKE_MASK,p=!!(h&Ln.ADD_TO_PATH_FLAG),x=c.patternFill&&!d.missingFile,g=c.patternStroke&&!d.missingFile;let b;if((d.disableFontFace||p||x||g)&&!d.missingFile&&(b=d.getPathGenerator(this.commonObjs,t)),b&&(d.disableFontFace||x||g)){l.save(),l.translate(n,r),l.scale(f,-f),(v=this.dependencyTracker)==null||v.recordCharacterBBox(e,l,d);let j;if(m===Ln.FILL||m===Ln.FILL_STROKE)if(a){j=l.getTransform(),l.setTransform(...a);const A=F(this,Ao,d2).call(this,b,j,a);l.fill(A)}else l.fill(b);if(m===Ln.STROKE||m===Ln.FILL_STROKE)if(o){j||(j=l.getTransform()),l.setTransform(...o);const{a:A,b:k,c:_,d:L}=j,D=Ge.inverseTransform(o),P=Ge.transform([A,k,_,L,0,0],D);Ge.singularValueDecompose2dScale(P,Fi),l.lineWidth*=Math.max(Fi[0],Fi[1])/f,l.stroke(F(this,Ao,d2).call(this,b,j,o))}else l.lineWidth/=f,l.stroke(b);l.restore()}else(m===Ln.FILL||m===Ln.FILL_STROKE)&&(l.fillText(t,n,r),(y=this.dependencyTracker)==null||y.recordCharacterBBox(e,l,d,f,n,r,()=>l.measureText(t))),(m===Ln.STROKE||m===Ln.FILL_STROKE)&&(this.dependencyTracker&&((w=this.dependencyTracker)==null||w.recordCharacterBBox(e,l,d,f,n,r,()=>l.measureText(t)).recordDependencies(e,ra.stroke)),l.strokeText(t,n,r));p&&((this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:Ps(l),x:n,y:r,fontSize:f,path:b}),(S=this.dependencyTracker)==null||S.recordCharacterBBox(e,l,d,f,n,r))}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let n=!1;for(let r=3;r<t.length;r+=4)if(t[r]>0&&t[r]<255){n=!0;break}return bt(this,"isFontSubpixelAAEnabled",n)}showText(e,t){var _,L,D,P;this.dependencyTracker&&(this.dependencyTracker.recordDependencies(e,ra.showText).resetBBox(e),this.current.textRenderingMode&Ln.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",e).inheritPendingDependenciesAsFutureForcedDependencies());const n=this.current,r=n.font;if(r.isType3Font){this.showType3Text(e,t),(_=this.dependencyTracker)==null||_.recordShowTextOperation(e);return}const a=n.fontSize;if(a===0){(L=this.dependencyTracker)==null||L.recordOperation(e);return}const o=this.ctx,l=n.fontSizeScale,c=n.charSpacing,d=n.wordSpacing,h=n.fontDirection,f=n.textHScale*h,m=t.length,p=r.vertical,x=p?1:-1,g=r.defaultVMetrics,b=a*n.fontMatrix[0],v=n.textRenderingMode===Ln.FILL&&!r.disableFontFace&&!n.patternFill;o.save(),n.textMatrix&&o.transform(...n.textMatrix),o.translate(n.x,n.y+n.textRise),h>0?o.scale(f,-1):o.scale(f,1);let y,w;if(n.patternFill){o.save();const T=n.fillColor.getPattern(o,this,Mo(o),Vn.FILL,e);y=Ps(o),o.restore(),o.fillStyle=T}if(n.patternStroke){o.save();const T=n.strokeColor.getPattern(o,this,Mo(o),Vn.STROKE,e);w=Ps(o),o.restore(),o.strokeStyle=T}let S=n.lineWidth;const j=n.textMatrixScale;if(j===0||S===0){const T=n.textRenderingMode&Ln.FILL_STROKE_MASK;(T===Ln.STROKE||T===Ln.FILL_STROKE)&&(S=this.getSinglePixelWidth())}else S/=j;if(l!==1&&(o.scale(l,l),S/=l),o.lineWidth=S,r.isInvalidPDFjsFont){const T=[];let B=0;for(const O of t)T.push(O.unicode),B+=O.width;const R=T.join("");if(o.fillText(R,0,0),this.dependencyTracker!==null){const O=o.measureText(R);this.dependencyTracker.recordBBox(e,this.ctx,-O.actualBoundingBoxLeft,O.actualBoundingBoxRight,-O.actualBoundingBoxAscent,O.actualBoundingBoxDescent).recordShowTextOperation(e)}n.x+=B*b*f,o.restore(),this.compose();return}let A=0,k;for(k=0;k<m;++k){const T=t[k];if(typeof T=="number"){A+=x*T*a/1e3;continue}let B=!1;const R=(T.isSpace?d:0)+c,O=T.fontChar,I=T.accent;let U,M,$=T.width;if(p){const Z=T.vmetric||g,z=-(T.vmetric?Z[1]:$*.5)*b,se=Z[2]*b;$=Z?-Z[0]:$,U=z/l,M=(A+se)/l}else U=A/l,M=0;let W;if(r.remeasure&&$>0){W=o.measureText(O);const Z=W.width*1e3/a*l;if($<Z&&this.isFontSubpixelAAEnabled){const z=$/Z;B=!0,o.save(),o.scale(z,1),U/=z}else $!==Z&&(U+=($-Z)/2e3*a/l)}if(this.contentVisible&&(T.isInFont||r.missingFile)){if(v&&!I)o.fillText(O,U,M),(D=this.dependencyTracker)==null||D.recordCharacterBBox(e,o,W?{bbox:null}:r,a/l,U,M,()=>W??o.measureText(O));else if(this.paintChar(e,O,U,M,y,w),I){const Z=U+a*I.offset.x/l,z=M-a*I.offset.y/l;this.paintChar(e,I.fontChar,Z,z,y,w)}}const ee=p?$*b-R*h:$*b+R*h;A+=ee,B&&o.restore()}p?n.y-=A:n.x+=A*f,o.restore(),this.compose(),(P=this.dependencyTracker)==null||P.recordShowTextOperation(e)}showType3Text(e,t){const n=this.ctx,r=this.current,a=r.font,o=r.fontSize,l=r.fontDirection,c=a.vertical?1:-1,d=r.charSpacing,h=r.wordSpacing,f=r.textHScale*l,m=r.fontMatrix||ET,p=t.length,x=r.textRenderingMode===Ln.INVISIBLE;let g,b,v,y;if(x||o===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,n.save(),r.textMatrix&&n.transform(...r.textMatrix),n.translate(r.x,r.y+r.textRise),n.scale(f,l);const w=this.dependencyTracker;for(this.dependencyTracker=w?new DS(w,e):null,g=0;g<p;++g){if(b=t[g],typeof b=="number"){y=c*b*o/1e3,this.ctx.translate(y,0),r.x+=y*f;continue}const S=(b.isSpace?h:0)+d,j=a.charProcOperatorList[b.operatorListId];j?this.contentVisible&&(this.save(),n.scale(o,o),n.transform(...m),this.executeOperatorList(j),this.restore()):ut(`Type3 character "${b.operatorListId}" is not available.`);const A=[b.width,0];Ge.applyTransform(A,m),v=A[0]*o+S,n.translate(v,0),r.x+=v*f}n.restore(),w&&(this.dependencyTracker=w)}setCharWidth(e,t,n){}setCharWidthAndBounds(e,t,n,r,a,o,l){var d;const c=new Path2D;c.rect(r,a,o-r,l-a),this.ctx.clip(c),(d=this.dependencyTracker)==null||d.recordBBox(e,this.ctx,r,o,a,l).recordClipBox(e,this.ctx,r,o,a,l),this.endPath(e)}getColorN_Pattern(e,t){let n;if(t[0]==="TilingPattern"){const r=this.baseTransform||Ps(this.ctx),a={createCanvasGraphics:(o,l)=>new aI(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new DS(this.dependencyTracker,l,!0):null)};n=new o2(t,this.ctx,a,r)}else n=this._getPattern(e,t[1],t[2]);return n}setStrokeColorN(e,...t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("strokeColor",e),this.current.strokeColor=this.getColorN_Pattern(e,t),this.current.patternStroke=!0}setFillColorN(e,...t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("fillColor",e),this.current.fillColor=this.getColorN_Pattern(e,t),this.current.patternFill=!0}setStrokeRGBColor(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor=t,this.current.patternStroke=!1}setStrokeTransparent(e){var t;(t=this.dependencyTracker)==null||t.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor=t,this.current.patternFill=!1}setFillTransparent(e){var t;(t=this.dependencyTracker)==null||t.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t,n=null){let r;return this.cachedPatterns.has(t)?r=this.cachedPatterns.get(t):(r=Lue(this.getObject(e,t)),this.cachedPatterns.set(t,r)),n&&(r.matrix=n),r}shadingFill(e,t){var o;if(!this.contentVisible)return;const n=this.ctx;this.save(e);const r=this._getPattern(e,t);n.fillStyle=r.getPattern(n,this,Mo(n),Vn.SHADING,e);const a=Mo(n);if(a){const{width:l,height:c}=n.canvas,d=mp.slice();Ge.axialAlignedBoundingBox([0,0,l,c],a,d);const[h,f,m,p]=d;this.ctx.fillRect(h,f,m-h,p-f)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);(o=this.dependencyTracker)==null||o.resetBBox(e).recordFullPageBBox(e).recordDependencies(e,ra.transform).recordDependencies(e,ra.fill).recordOperation(e),this.compose(this.current.getClippedPathBoundingBox()),this.restore(e)}beginInlineImage(){ds("Should not call beginInlineImage")}beginImageData(){ds("Should not call beginImageData")}paintFormXObjectBegin(e,t,n){var r;if(this.contentVisible&&(this.save(e),this.baseTransformStack.push(this.baseTransform),t&&this.transform(e,...t),this.baseTransform=Ps(this.ctx),n)){Ge.axialAlignedBoundingBox(n,this.baseTransform,this.current.minMax);const[a,o,l,c]=n,d=new Path2D;d.rect(a,o,l-a,c-o),this.ctx.clip(d),(r=this.dependencyTracker)==null||r.recordClipBox(e,this.ctx,a,l,o,c),this.endPath(e)}}paintFormXObjectEnd(e){this.contentVisible&&(this.restore(e),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e,t){var w;if(!this.contentVisible)return;this.save(e),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const n=this.ctx;t.isolated||Ok("TODO: Support non-isolated groups."),t.knockout&&ut("Knockout groups not supported.");const r=Ps(n);if(t.matrix&&n.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let a=mp.slice();Ge.axialAlignedBoundingBox(t.bbox,Ps(n),a);const o=[0,0,n.canvas.width,n.canvas.height];a=Ge.intersect(a,o)||[0,0,0,0];const l=Math.floor(a[0]),c=Math.floor(a[1]),d=Math.max(Math.ceil(a[2])-l,1),h=Math.max(Math.ceil(a[3])-c,1);this.current.startNewPathAndClipBox([0,0,d,h]);let f="groupAt"+this.groupLevel;t.smask&&(f+="_smask_"+this.smaskCounter++%2);const m=this.cachedCanvases.getCanvas(f,d,h),p=m.context;p.translate(-l,-c),p.transform(...r);let x=new Path2D;const[g,b,v,y]=t.bbox;if(x.rect(g,b,v-g,y-b),t.matrix){const S=new Path2D;S.addPath(x,new DOMMatrix(t.matrix)),x=S}p.clip(x),t.smask&&this.smaskStack.push({canvas:m.canvas,context:p,offsetX:l,offsetY:c,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}),(!t.smask||this.dependencyTracker)&&(n.setTransform(1,0,0,1,0,0),n.translate(l,c),n.save()),oy(n,p),this.ctx=p,(w=this.dependencyTracker)==null||w.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(n),this.setGState(e,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(n),this.groupLevel++}endGroup(e,t){var a;if(!this.contentVisible)return;this.groupLevel--;const n=this.ctx,r=this.groupStack.pop();if(this.ctx=r,this.ctx.imageSmoothingEnabled=!1,(a=this.dependencyTracker)==null||a.popBaseTransform(),t.smask)this.tempSMask=this.smaskStack.pop(),this.restore(e),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const o=Ps(this.ctx);this.restore(e),this.ctx.save(),this.ctx.setTransform(...o);const l=mp.slice();Ge.axialAlignedBoundingBox([0,0,n.canvas.width,n.canvas.height],o,l),this.ctx.drawImage(n.canvas,0,0),this.ctx.restore(),this.compose(l)}}beginAnnotation(e,t,n,r,a,o){if(F(this,Ao,l2).call(this),u1(this.ctx),this.ctx.save(),this.save(e),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),n){const l=n[2]-n[0],c=n[3]-n[1];if(o&&this.annotationCanvasMap){r=r.slice(),r[4]-=n[0],r[5]-=n[1],n=n.slice(),n[0]=n[1]=0,n[2]=l,n[3]=c,Ge.singularValueDecompose2dScale(Ps(this.ctx),Fi);const{viewportScale:d}=this,h=Math.ceil(l*this.outputScaleX*d),f=Math.ceil(c*this.outputScaleY*d);this.annotationCanvas=this.canvasFactory.create(h,f);const{canvas:m,context:p}=this.annotationCanvas;this.annotationCanvasMap.set(t,m),this.annotationCanvas.savedCtx=this.ctx,this.ctx=p,this.ctx.save(),this.ctx.setTransform(Fi[0],0,0,-Fi[1],0,c*Fi[1]),u1(this.ctx)}else{u1(this.ctx),this.endPath(e);const d=new Path2D;d.rect(n[0],n[1],l,c),this.ctx.clip(d)}}this.current=new AO(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(e,...r),this.transform(e,...a)}endAnnotation(e){this.annotationCanvas&&(this.ctx.restore(),F(this,Ao,c2).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e,t){var l;if(!this.contentVisible)return;const n=t.count;t=this.getObject(e,t.data,t),t.count=n;const r=this.ctx,a=this._createMaskCanvas(e,t),o=a.canvas;r.save(),r.setTransform(1,0,0,1,0,0),r.drawImage(o,a.offsetX,a.offsetY),(l=this.dependencyTracker)==null||l.resetBBox(e).recordBBox(e,this.ctx,a.offsetX,a.offsetX+o.width,a.offsetY,a.offsetY+o.height).recordOperation(e),r.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,n,r=0,a=0,o,l){var f,m,p;if(!this.contentVisible)return;t=this.getObject(e,t.data,t);const c=this.ctx;c.save();const d=Ps(c);c.transform(n,r,a,o,0,0);const h=this._createMaskCanvas(e,t);c.setTransform(1,0,0,1,h.offsetX-d[4],h.offsetY-d[5]),(f=this.dependencyTracker)==null||f.resetBBox(e);for(let x=0,g=l.length;x<g;x+=2){const b=Ge.transform(d,[n,r,a,o,l[x],l[x+1]]);c.drawImage(h.canvas,b[4],b[5]),(m=this.dependencyTracker)==null||m.recordBBox(e,this.ctx,b[4],b[4]+h.canvas.width,b[5],b[5]+h.canvas.height)}c.restore(),this.compose(),(p=this.dependencyTracker)==null||p.recordOperation(e)}paintImageMaskXObjectGroup(e,t){var o,l,c;if(!this.contentVisible)return;const n=this.ctx,r=this.current.fillColor,a=this.current.patternFill;(o=this.dependencyTracker)==null||o.resetBBox(e).recordDependencies(e,ra.transformAndFill);for(const d of t){const{data:h,width:f,height:m,transform:p}=d,x=this.cachedCanvases.getCanvas("maskCanvas",f,m),g=x.context;g.save();const b=this.getObject(e,h,d);TO(g,b),g.globalCompositeOperation="source-in",g.fillStyle=a?r.getPattern(g,this,Mo(n),Vn.FILL,e):r,g.fillRect(0,0,f,m),g.restore(),n.save(),n.transform(...p),n.scale(1,-1),d1(n,x.canvas,0,0,f,m,0,-1,1,1),(l=this.dependencyTracker)==null||l.recordBBox(e,n,0,f,0,m),n.restore()}this.compose(),(c=this.dependencyTracker)==null||c.recordOperation(e)}paintImageXObject(e,t){if(!this.contentVisible)return;const n=this.getObject(e,t);if(!n){ut("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e,n)}paintImageXObjectRepeat(e,t,n,r,a){if(!this.contentVisible)return;const o=this.getObject(e,t);if(!o){ut("Dependent image isn't ready yet");return}const l=o.width,c=o.height,d=[];for(let h=0,f=a.length;h<f;h+=2)d.push({transform:[n,0,0,r,a[h],a[h+1]],x:0,y:0,w:l,h:c});this.paintInlineImageXObjectGroup(e,o,d)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:n,height:r}=e,a=this.cachedCanvases.getCanvas("inlineImage",n,r),o=a.context;return o.filter=this.current.transferMaps,o.drawImage(t,0,0),o.filter="none",a.canvas}paintInlineImageXObject(e,t){var d;if(!this.contentVisible)return;const n=t.width,r=t.height,a=this.ctx;this.save(e);const{filter:o}=a;o!=="none"&&o!==""&&(a.filter="none"),a.scale(1/n,-1/r);let l;if(t.bitmap)l=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)l=t;else{const f=this.cachedCanvases.getCanvas("inlineImage",n,r).context;_O(f,t),l=this.applyTransferMapsToCanvas(f)}const c=this._scaleImage(l,Mo(a));a.imageSmoothingEnabled=EO(Ps(a),t.interpolate),(d=this.dependencyTracker)==null||d.resetBBox(e).recordBBox(e,a,0,n,-r,0).recordDependencies(e,ra.imageXObject).recordOperation(e),d1(a,c.img,0,0,c.paintWidth,c.paintHeight,0,-r,n,r),this.compose(),this.restore(e)}paintInlineImageXObjectGroup(e,t,n){var o,l,c;if(!this.contentVisible)return;const r=this.ctx;let a;if(t.bitmap)a=t.bitmap;else{const d=t.width,h=t.height,m=this.cachedCanvases.getCanvas("inlineImage",d,h).context;_O(m,t),a=this.applyTransferMapsToCanvas(m)}(o=this.dependencyTracker)==null||o.resetBBox(e);for(const d of n)r.save(),r.transform(...d.transform),r.scale(1,-1),d1(r,a,d.x,d.y,d.w,d.h,0,-1,1,1),(l=this.dependencyTracker)==null||l.recordBBox(e,r,0,1,-1,0),r.restore();(c=this.dependencyTracker)==null||c.recordOperation(e),this.compose()}paintSolidColorImageMask(e){var t;this.contentVisible&&((t=this.dependencyTracker)==null||t.resetBBox(e).recordBBox(e,this.ctx,0,1,0,1).recordDependencies(e,ra.fill).recordOperation(e),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e,t){}markPointProps(e,t,n){}beginMarkedContent(e,t){var n;(n=this.dependencyTracker)==null||n.beginMarkedContent(e),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t,n){var r;(r=this.dependencyTracker)==null||r.beginMarkedContent(e),t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(n)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(e){var t;(t=this.dependencyTracker)==null||t.endMarkedContent(e),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(e){}endCompat(e){}consumePath(e,t,n){var o,l;const r=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(n);const a=this.ctx;this.pendingClip?(r||(this.pendingClip===PO?a.clip(t,"evenodd"):a.clip(t)),this.pendingClip=null,(o=this.dependencyTracker)==null||o.bboxToClipBoxDropOperation(e).recordFutureForcedDependency("clipPath",e)):(l=this.dependencyTracker)==null||l.recordOperation(e),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=Ps(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),n=Math.hypot(e[0],e[2]),r=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(n,r)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:n,c:r,d:a}=this.ctx.getTransform();let o,l;if(n===0&&r===0){const c=Math.abs(t),d=Math.abs(a);if(c===d)if(e===0)o=l=1/c;else{const h=c*e;o=l=h<1?1/h:1}else if(e===0)o=1/c,l=1/d;else{const h=c*e,f=d*e;o=h<1?1/h:1,l=f<1?1/f:1}}else{const c=Math.abs(t*a-n*r),d=Math.hypot(t,n),h=Math.hypot(r,a);if(e===0)o=h/c,l=d/c;else{const f=e*c;o=h>f?h/f:1,l=d>f?d/f:1}}this._cachedScaleForStroking[0]=o,this._cachedScaleForStroking[1]=l}return this._cachedScaleForStroking}rescaleAndStroke(e,t){const{ctx:n,current:{lineWidth:r}}=this,[a,o]=this.getScaleForStroking();if(a===o){n.lineWidth=(r||1)*a,n.stroke(e);return}const l=n.getLineDash();t&&n.save(),n.scale(a,o),kA.a=1/a,kA.d=1/o;const c=new Path2D;if(c.addPath(e,kA),l.length>0){const d=Math.max(a,o);n.setLineDash(l.map(h=>h/d)),n.lineDashOffset/=d}n.lineWidth=r||1,n.stroke(c),t&&n.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};Ao=new WeakSet,l2=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},c2=function(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},d2=function(e,t,n){const r=new Path2D;return r.addPath(e,new DOMMatrix(n).invertSelf().multiplySelf(t)),r};let Ep=aI;for(const s in Gv)Ep.prototype[s]!==void 0&&(Ep.prototype[Gv[s]]=Ep.prototype[s]);var qb,Gb;class dr{static get workerPort(){return u(this,qb)}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");N(this,qb,e)}static get workerSrc(){return u(this,Gb)}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");N(this,Gb,e)}}qb=new WeakMap,Gb=new WeakMap,E(dr,qb,null),E(dr,Gb,"");var bg,Yb;class Vue{constructor({parsedData:e,rawData:t}){E(this,bg);E(this,Yb);N(this,bg,e),N(this,Yb,t)}getRaw(){return u(this,Yb)}get(e){return u(this,bg).get(e)??null}[Symbol.iterator](){return u(this,bg).entries()}}bg=new WeakMap,Yb=new WeakMap;const Km=Symbol("INTERNAL");var Kb,Xb,Qb,wg;class Wue{constructor(e,{name:t,intent:n,usage:r,rbGroups:a}){E(this,Kb,!1);E(this,Xb,!1);E(this,Qb,!1);E(this,wg,!0);N(this,Kb,!!(e&Ii.DISPLAY)),N(this,Xb,!!(e&Ii.PRINT)),this.name=t,this.intent=n,this.usage=r,this.rbGroups=a}get visible(){if(u(this,Qb))return u(this,wg);if(!u(this,wg))return!1;const{print:e,view:t}=this.usage;return u(this,Kb)?(t==null?void 0:t.viewState)!=="OFF":u(this,Xb)?(e==null?void 0:e.printState)!=="OFF":!0}_setVisible(e,t,n=!1){e!==Km&&ds("Internal method `_setVisible` called."),N(this,Qb,n),N(this,wg,t)}}Kb=new WeakMap,Xb=new WeakMap,Qb=new WeakMap,wg=new WeakMap;var Ud,ns,Cg,Sg,Zb,u2;class que{constructor(e,t=Ii.DISPLAY){E(this,Zb);E(this,Ud,null);E(this,ns,new Map);E(this,Cg,null);E(this,Sg,null);if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,N(this,Sg,e.order);for(const n of e.groups)u(this,ns).set(n.id,new Wue(t,n));if(e.baseState==="OFF")for(const n of u(this,ns).values())n._setVisible(Km,!1);for(const n of e.on)u(this,ns).get(n)._setVisible(Km,!0);for(const n of e.off)u(this,ns).get(n)._setVisible(Km,!1);N(this,Cg,this.getHash())}}isVisible(e){if(u(this,ns).size===0)return!0;if(!e)return Ok("Optional content group not defined."),!0;if(e.type==="OCG")return u(this,ns).has(e.id)?u(this,ns).get(e.id).visible:(ut(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return F(this,Zb,u2).call(this,e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!u(this,ns).has(t))return ut(`Optional content group not found: ${t}`),!0;if(u(this,ns).get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!u(this,ns).has(t))return ut(`Optional content group not found: ${t}`),!0;if(!u(this,ns).get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!u(this,ns).has(t))return ut(`Optional content group not found: ${t}`),!0;if(!u(this,ns).get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!u(this,ns).has(t))return ut(`Optional content group not found: ${t}`),!0;if(u(this,ns).get(t).visible)return!1}return!0}return ut(`Unknown optional content policy ${e.policy}.`),!0}return ut(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,n=!0){var a;const r=u(this,ns).get(e);if(!r){ut(`Optional content group not found: ${e}`);return}if(n&&t&&r.rbGroups.length)for(const o of r.rbGroups)for(const l of o)l!==e&&((a=u(this,ns).get(l))==null||a._setVisible(Km,!1,!0));r._setVisible(Km,!!t,!0),N(this,Ud,null)}setOCGState({state:e,preserveRB:t}){let n;for(const r of e){switch(r){case"ON":case"OFF":case"Toggle":n=r;continue}const a=u(this,ns).get(r);if(a)switch(n){case"ON":this.setVisibility(r,!0,t);break;case"OFF":this.setVisibility(r,!1,t);break;case"Toggle":this.setVisibility(r,!a.visible,t);break}}N(this,Ud,null)}get hasInitialVisibility(){return u(this,Cg)===null||this.getHash()===u(this,Cg)}getOrder(){return u(this,ns).size?u(this,Sg)?u(this,Sg).slice():[...u(this,ns).keys()]:null}getGroup(e){return u(this,ns).get(e)||null}getHash(){if(u(this,Ud)!==null)return u(this,Ud);const e=new fH;for(const[t,n]of u(this,ns))e.update(`${t}:${n.visible}`);return N(this,Ud,e.hexdigest())}[Symbol.iterator](){return u(this,ns).entries()}}Ud=new WeakMap,ns=new WeakMap,Cg=new WeakMap,Sg=new WeakMap,Zb=new WeakSet,u2=function(e){const t=e.length;if(t<2)return!0;const n=e[0];for(let r=1;r<t;r++){const a=e[r];let o;if(Array.isArray(a))o=F(this,Zb,u2).call(this,a);else if(u(this,ns).has(a))o=u(this,ns).get(a).visible;else return ut(`Optional content group not found: ${a}`),!0;switch(n){case"And":if(!o)return!1;break;case"Or":if(o)return!0;break;case"Not":return!o;default:return!0}}return n==="And"};class Gue{constructor(e,{disableRange:t=!1,disableStream:n=!1}){Ot(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:r,initialData:a,progressiveDone:o,contentDispositionFilename:l}=e;if(this._queuedChunks=[],this._progressiveDone=o,this._contentDispositionFilename=l,(a==null?void 0:a.length)>0){const c=a instanceof Uint8Array&&a.byteLength===a.buffer.byteLength?a.buffer:new Uint8Array(a).buffer;this._queuedChunks.push(c)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!n,this._isRangeSupported=!t,this._contentLength=r,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((c,d)=>{this._onReceiveData({begin:c,chunk:d})}),e.addProgressListener((c,d)=>{this._onProgress({loaded:c,total:d})}),e.addProgressiveReadListener(c=>{this._onReceiveData({chunk:c})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const n=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(n):this._queuedChunks.push(n);else{const r=this._rangeReaders.some(function(a){return a._begin!==e?!1:(a._enqueue(n),!0)});Ot(r,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}_onProgress(e){var t,n,r,a;e.total===void 0?(n=(t=this._rangeReaders[0])==null?void 0:t.onProgress)==null||n.call(t,{loaded:e.loaded}):(a=(r=this._fullRequestReader)==null?void 0:r.onProgress)==null||a.call(r,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;(e=this._fullRequestReader)==null||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){Ot(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new Yue(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new Kue(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const n of this._rangeReaders.slice(0))n.cancel(e);this._pdfDataRangeTransport.abort()}}class Yue{constructor(e,t,n=!1,r=null){this._stream=e,this._done=n||!1,this._filename=LM(r)?r:null,this._queuedChunks=t||[],this._loaded=0;for(const a of this._queuedChunks)this._loaded+=a.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class Kue{constructor(e,t,n){this._stream=e,this._begin=t,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function Xue(s){let e=!0,t=n("filename\\*","i").exec(s);if(t){t=t[1];let h=l(t);return h=unescape(h),h=c(h),h=d(h),a(h)}if(t=o(s),t){const h=d(t);return a(h)}if(t=n("filename","i").exec(s),t){t=t[1];let h=l(t);return h=d(h),a(h)}function n(h,f){return new RegExp("(?:^|;)\\s*"+h+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',f)}function r(h,f){if(h){if(!/^[\x00-\xFF]+$/.test(f))return f;try{const m=new TextDecoder(h,{fatal:!0}),p=dw(f);f=m.decode(p),e=!1}catch{}}return f}function a(h){return e&&/[\x80-\xff]/.test(h)&&(h=r("utf-8",h),e&&(h=r("iso-8859-1",h))),h}function o(h){const f=[];let m;const p=n("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(m=p.exec(h))!==null;){let[,g,b,v]=m;if(g=parseInt(g,10),g in f){if(g===0)break;continue}f[g]=[b,v]}const x=[];for(let g=0;g<f.length&&g in f;++g){let[b,v]=f[g];v=l(v),b&&(v=unescape(v),g===0&&(v=c(v))),x.push(v)}return x.join("")}function l(h){if(h.startsWith('"')){const f=h.slice(1).split('\\"');for(let m=0;m<f.length;++m){const p=f[m].indexOf('"');p!==-1&&(f[m]=f[m].slice(0,p),f.length=m+1),f[m]=f[m].replaceAll(/\\(.)/g,"$1")}h=f.join('"')}return h}function c(h){const f=h.indexOf("'");if(f===-1)return h;const m=h.slice(0,f),x=h.slice(f+1).replace(/^[^']*'/,"");return r(m,x)}function d(h){return!h.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(h)?h:h.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(f,m,p,x){if(p==="q"||p==="Q")return x=x.replaceAll("_"," "),x=x.replaceAll(/=([0-9a-fA-F]{2})/g,function(g,b){return String.fromCharCode(parseInt(b,16))}),r(m,x);try{x=atob(x)}catch{}return r(m,x)})}return""}function kH(s,e){const t=new Headers;if(!s||!e||typeof e!="object")return t;for(const n in e){const r=e[n];r!==void 0&&t.append(n,r)}return t}function Bk(s){var e;return((e=URL.parse(s))==null?void 0:e.origin)??null}function NH({responseHeaders:s,isHttp:e,rangeChunkSize:t,disableRange:n}){const r={allowRangeRequests:!1,suggestedLength:void 0},a=parseInt(s.get("Content-Length"),10);return!Number.isInteger(a)||(r.suggestedLength=a,a<=2*t)||n||!e||s.get("Accept-Ranges")!=="bytes"||(s.get("Content-Encoding")||"identity")!=="identity"||(r.allowRangeRequests=!0),r}function AH(s){const e=s.get("Content-Disposition");if(e){let t=Xue(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(LM(t))return t}return null}function pw(s,e){return new TS(`Unexpected server response (${s}) while retrieving PDF "${e}".`,s,s===404||s===0&&e.startsWith("file:"))}function _H(s){return s===200||s===206}function TH(s,e,t){return{method:"GET",headers:s,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function EH(s){return s instanceof Uint8Array?s.buffer:s instanceof ArrayBuffer?s:(ut(`getArrayBuffer - unexpected data format: ${s}`),new Uint8Array(s).buffer)}class Que{constructor(e){Ce(this,"_responseOrigin",null);this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=kH(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return Ot(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new Zue(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new Jue(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const n of this._rangeRequestReaders.slice(0))n.cancel(e)}}class Zue{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const n=new Headers(e.headers),r=t.url;fetch(r,TH(n,this._withCredentials,this._abortController)).then(a=>{if(e._responseOrigin=Bk(a.url),!_H(a.status))throw pw(a.status,r);this._reader=a.body.getReader(),this._headersCapability.resolve();const o=a.headers,{allowRangeRequests:l,suggestedLength:c}=NH({responseHeaders:o,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=l,this._contentLength=c||this._contentLength,this._filename=AH(o),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Uu("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded,total:this._contentLength}),{value:EH(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}class Jue{constructor(e,t,n){this._stream=e,this._reader=null,this._loaded=0;const r=e.source;this._withCredentials=r.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!r.disableStream,this._abortController=new AbortController;const a=new Headers(e.headers);a.append("Range",`bytes=${t}-${n-1}`);const o=r.url;fetch(o,TH(a,this._withCredentials,this._abortController)).then(l=>{const c=Bk(l.url);if(c!==e._responseOrigin)throw new Error(`Expected range response-origin "${c}" to match "${e._responseOrigin}".`);if(!_H(l.status))throw pw(l.status,o);this._readCapability.resolve(),this._reader=l.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded}),{value:EH(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}const NA=200,AA=206;function ehe(s){const e=s.response;return typeof e!="string"?e:dw(e).buffer}class the{constructor({url:e,httpHeaders:t,withCredentials:n}){Ce(this,"_responseOrigin",null);this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=kH(this.isHttp,t),this.withCredentials=n||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,n=this.currXhrId++,r=this.pendingRequests[n]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[a,o]of this.headers)t.setRequestHeader(a,o);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),r.expectedStatus=AA):r.expectedStatus=NA,t.responseType="arraybuffer",Ot(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,n),t.onprogress=this.onProgress.bind(this,n),r.onHeadersReceived=e.onHeadersReceived,r.onDone=e.onDone,r.onError=e.onError,r.onProgress=e.onProgress,t.send(null),n}onProgress(e,t){var r;const n=this.pendingRequests[e];n&&((r=n.onProgress)==null||r.call(n,t))}onStateChange(e,t){const n=this.pendingRequests[e];if(!n)return;const r=n.xhr;if(r.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),r.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],r.status===0&&this.isHttp){n.onError(r.status);return}const a=r.status||NA;if(!(a===NA&&n.expectedStatus===AA)&&a!==n.expectedStatus){n.onError(r.status);return}const l=ehe(r);if(a===AA){const c=r.getResponseHeader("Content-Range"),d=/bytes (\d+)-(\d+)\/(\d+)/.exec(c);d?n.onDone({begin:parseInt(d[1],10),chunk:l}):(ut('Missing or invalid "Content-Range" header.'),n.onError(0))}else l?n.onDone({begin:0,chunk:l}):n.onError(r.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class she{constructor(e){this._source=e,this._manager=new the(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return Ot(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new nhe(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const n=new rhe(this._manager,e,t);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const n of this._rangeRequestReaders.slice(0))n.cancel(e)}}class nhe{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=Bk(t.responseURL);const n=t.getAllResponseHeaders(),r=new Headers(n?n.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(l=>{const[c,...d]=l.split(": ");return[c,d.join(": ")]}):[]),{allowRangeRequests:a,suggestedLength:o}=NH({responseHeaders:r,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});a&&(this._isRangeSupported=!0),this._contentLength=o||this._contentLength,this._filename=AH(r),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=pw(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;(t=this.onProgress)==null||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class rhe{constructor(e,t,n){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:n,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var t;const e=Bk((t=this._manager.getRequestXhr(this._requestId))==null?void 0:t.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var e;(e=this.onClosed)==null||e.call(this,this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??(this._storedError=pw(e,this._url));for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||(t=this.onProgress)==null||t.call(this,{loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const ihe=/^[a-z][a-z0-9\-+.]+:/i;function ahe(s){if(ihe.test(s))return new URL(s);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(s))}class ohe{constructor(e){this.source=e,this.url=ahe(e.url),Ot(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return Ot(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new lhe(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new che(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const n of this._rangeRequestReaders.slice(0))n.cancel(e)}}class lhe{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const n=process.getBuiltinModule("fs");n.promises.lstat(this._url).then(r=>{this._contentLength=r.size,this._setReadableStream(n.createReadStream(this._url)),this._headersCapability.resolve()},r=>{r.code==="ENOENT"&&(r=pw(0,this._url.href)),this._storedError=r,this._headersCapability.reject(r)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new Uu("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class che{constructor(e,t,n){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const r=e.source;this._isStreamingSupported=!r.disableStream;const a=process.getBuiltinModule("fs");this._setReadableStream(a.createReadStream(this._url,{start:t,end:n-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const ly=Symbol("INITIAL_DATA");var vi,Jb,h2;class PH{constructor(){E(this,Jb);E(this,vi,Object.create(null))}get(e,t=null){if(t){const r=F(this,Jb,h2).call(this,e);return r.promise.then(()=>t(r.data)),null}const n=u(this,vi)[e];if(!n||n.data===ly)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return n.data}has(e){const t=u(this,vi)[e];return!!t&&t.data!==ly}delete(e){const t=u(this,vi)[e];return!t||t.data===ly?!1:(delete u(this,vi)[e],!0)}resolve(e,t=null){const n=F(this,Jb,h2).call(this,e);n.data=t,n.resolve()}clear(){var e;for(const t in u(this,vi)){const{data:n}=u(this,vi)[t];(e=n==null?void 0:n.bitmap)==null||e.close()}N(this,vi,Object.create(null))}*[Symbol.iterator](){for(const e in u(this,vi)){const{data:t}=u(this,vi)[e];t!==ly&&(yield[e,t])}}}vi=new WeakMap,Jb=new WeakSet,h2=function(e){var t;return(t=u(this,vi))[e]||(t[e]={...Promise.withResolvers(),data:ly})};const dhe=1e5,MO=30;var l4,zd,Xr,e0,t0,of,ac,s0,n0,lf,jg,kg,Hd,Ng,r0,Ag,cf,i0,a0,_g,df,o0,Vd,Tg,zc,MH,IH,f2,qi,Q1,m2,RH,DH;const hn=class hn{constructor({textContentSource:e,container:t,viewport:n}){E(this,zc);E(this,zd,Promise.withResolvers());E(this,Xr,null);E(this,e0,!1);E(this,t0,!!((l4=globalThis.FontInspector)!=null&&l4.enabled));E(this,of,null);E(this,ac,null);E(this,s0,0);E(this,n0,0);E(this,lf,null);E(this,jg,null);E(this,kg,0);E(this,Hd,0);E(this,Ng,Object.create(null));E(this,r0,[]);E(this,Ag,null);E(this,cf,[]);E(this,i0,new WeakMap);E(this,a0,null);var c;if(e instanceof ReadableStream)N(this,Ag,e);else if(typeof e=="object")N(this,Ag,new ReadableStream({start(d){d.enqueue(e),d.close()}}));else throw new Error('No "textContentSource" parameter specified.');N(this,Xr,N(this,jg,t)),N(this,Hd,n.scale*Cl.pixelRatio),N(this,kg,n.rotation),N(this,ac,{div:null,properties:null,ctx:null});const{pageWidth:r,pageHeight:a,pageX:o,pageY:l}=n.rawDims;N(this,a0,[1,0,0,-1,-o,l+a]),N(this,n0,r),N(this,s0,a),F(c=hn,qi,RH).call(c),mm(t,n),u(this,zd).promise.finally(()=>{u(hn,Tg).delete(this),N(this,ac,null),N(this,Ng,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=Yn.platform;return bt(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{u(this,lf).read().then(({value:t,done:n})=>{if(n){u(this,zd).resolve();return}u(this,of)??N(this,of,t.lang),Object.assign(u(this,Ng),t.styles),F(this,zc,MH).call(this,t.items),e()},u(this,zd).reject)};return N(this,lf,u(this,Ag).getReader()),u(hn,Tg).add(this),e(),u(this,zd).promise}update({viewport:e,onBefore:t=null}){var a;const n=e.scale*Cl.pixelRatio,r=e.rotation;if(r!==u(this,kg)&&(t==null||t(),N(this,kg,r),mm(u(this,jg),{rotation:r})),n!==u(this,Hd)){t==null||t(),N(this,Hd,n);const o={div:null,properties:null,ctx:F(a=hn,qi,Q1).call(a,u(this,of))};for(const l of u(this,cf))o.properties=u(this,i0).get(l),o.div=l,F(this,zc,f2).call(this,o)}}cancel(){var t;const e=new Uu("TextLayer task cancelled.");(t=u(this,lf))==null||t.cancel(e).catch(()=>{}),N(this,lf,null),u(this,zd).reject(e)}get textDivs(){return u(this,cf)}get textContentItemsStr(){return u(this,r0)}static cleanup(){if(!(u(this,Tg).size>0)){u(this,_g).clear();for(const{canvas:e}of u(this,df).values())e.remove();u(this,df).clear()}}};zd=new WeakMap,Xr=new WeakMap,e0=new WeakMap,t0=new WeakMap,of=new WeakMap,ac=new WeakMap,s0=new WeakMap,n0=new WeakMap,lf=new WeakMap,jg=new WeakMap,kg=new WeakMap,Hd=new WeakMap,Ng=new WeakMap,r0=new WeakMap,Ag=new WeakMap,cf=new WeakMap,i0=new WeakMap,a0=new WeakMap,_g=new WeakMap,df=new WeakMap,o0=new WeakMap,Vd=new WeakMap,Tg=new WeakMap,zc=new WeakSet,MH=function(e){var r,a;if(u(this,e0))return;(a=u(this,ac)).ctx??(a.ctx=F(r=hn,qi,Q1).call(r,u(this,of)));const t=u(this,cf),n=u(this,r0);for(const o of e){if(t.length>dhe){ut("Ignoring additional textDivs for performance reasons."),N(this,e0,!0);return}if(o.str===void 0){if(o.type==="beginMarkedContentProps"||o.type==="beginMarkedContent"){const l=u(this,Xr);N(this,Xr,document.createElement("span")),u(this,Xr).classList.add("markedContent"),o.id&&u(this,Xr).setAttribute("id",`${o.id}`),l.append(u(this,Xr))}else o.type==="endMarkedContent"&&N(this,Xr,u(this,Xr).parentNode);continue}n.push(o.str),F(this,zc,IH).call(this,o)}},IH=function(e){var g;const t=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};u(this,cf).push(t);const r=Ge.transform(u(this,a0),e.transform);let a=Math.atan2(r[1],r[0]);const o=u(this,Ng)[e.fontName];o.vertical&&(a+=Math.PI/2);let l=u(this,t0)&&o.fontSubstitution||o.fontFamily;l=hn.fontFamilyMap.get(l)||l;const c=Math.hypot(r[2],r[3]),d=c*F(g=hn,qi,DH).call(g,l,o,u(this,of));let h,f;a===0?(h=r[4],f=r[5]-d):(h=r[4]+d*Math.sin(a),f=r[5]-d*Math.cos(a));const m="calc(var(--total-scale-factor) *",p=t.style;u(this,Xr)===u(this,jg)?(p.left=`${(100*h/u(this,n0)).toFixed(2)}%`,p.top=`${(100*f/u(this,s0)).toFixed(2)}%`):(p.left=`${m}${h.toFixed(2)}px)`,p.top=`${m}${f.toFixed(2)}px)`),p.fontSize=`${m}${(u(hn,Vd)*c).toFixed(2)}px)`,p.fontFamily=l,n.fontSize=c,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,u(this,t0)&&(t.dataset.fontName=o.fontSubstitutionLoadedName||e.fontName),a!==0&&(n.angle=a*(180/Math.PI));let x=!1;if(e.str.length>1)x=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const b=Math.abs(e.transform[0]),v=Math.abs(e.transform[3]);b!==v&&Math.max(b,v)/Math.min(b,v)>1.5&&(x=!0)}if(x&&(n.canvasWidth=o.vertical?e.height:e.width),u(this,i0).set(t,n),u(this,ac).div=t,u(this,ac).properties=n,F(this,zc,f2).call(this,u(this,ac)),n.hasText&&u(this,Xr).append(t),n.hasEOL){const b=document.createElement("br");b.setAttribute("role","presentation"),u(this,Xr).append(b)}},f2=function(e){var l;const{div:t,properties:n,ctx:r}=e,{style:a}=t;let o="";if(u(hn,Vd)>1&&(o=`scale(${1/u(hn,Vd)})`),n.canvasWidth!==0&&n.hasText){const{fontFamily:c}=a,{canvasWidth:d,fontSize:h}=n;F(l=hn,qi,m2).call(l,r,h*u(this,Hd),c);const{width:f}=r.measureText(t.textContent);f>0&&(o=`scaleX(${d*u(this,Hd)/f}) ${o}`)}n.angle!==0&&(o=`rotate(${n.angle}deg) ${o}`),o.length>0&&(a.transform=o)},qi=new WeakSet,Q1=function(e=null){let t=u(this,df).get(e||(e=""));if(!t){const n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=e,document.body.append(n),t=n.getContext("2d",{alpha:!1,willReadFrequently:!0}),u(this,df).set(e,t),u(this,o0).set(t,{size:0,family:""})}return t},m2=function(e,t,n){const r=u(this,o0).get(e);t===r.size&&n===r.family||(e.font=`${t}px ${n}`,r.size=t,r.family=n)},RH=function(){if(u(this,Vd)!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),N(this,Vd,e.getBoundingClientRect().height),e.remove()},DH=function(e,t,n){const r=u(this,_g).get(e);if(r)return r;const a=F(this,qi,Q1).call(this,n);a.canvas.width=a.canvas.height=MO,F(this,qi,m2).call(this,a,MO,e);const o=a.measureText(""),l=o.fontBoundingBoxAscent,c=Math.abs(o.fontBoundingBoxDescent);a.canvas.width=a.canvas.height=0;let d=.8;return l?d=l/(l+c):(Yn.platform.isFirefox&&ut("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),t.ascent?d=t.ascent:t.descent&&(d=1+t.descent)),u(this,_g).set(e,d),d},E(hn,qi),E(hn,_g,new Map),E(hn,df,new Map),E(hn,o0,new WeakMap),E(hn,Vd,null),E(hn,Tg,new Set);let Kv=hn;const uhe=100;function LH(s={}){typeof s=="string"||s instanceof URL?s={url:s}:(s instanceof ArrayBuffer||ArrayBuffer.isView(s))&&(s={data:s});const e=new p2,{docId:t}=e,n=s.url?yue(s.url):null,r=s.data?vue(s.data):null,a=s.httpHeaders||null,o=s.withCredentials===!0,l=s.password??null,c=s.range instanceof OH?s.range:null,d=Number.isInteger(s.rangeChunkSize)&&s.rangeChunkSize>0?s.rangeChunkSize:2**16;let h=s.worker instanceof Xv?s.worker:null;const f=s.verbosity,m=typeof s.docBaseUrl=="string"&&!Fk(s.docBaseUrl)?s.docBaseUrl:null,p=a1(s.cMapUrl),x=s.cMapPacked!==!1,g=s.CMapReaderFactory||(Sr?Aue:yO),b=a1(s.iccUrl),v=a1(s.standardFontDataUrl),y=s.StandardFontDataFactory||(Sr?_ue:vO),w=a1(s.wasmUrl),S=s.WasmFactory||(Sr?Tue:bO),j=s.stopAtErrors!==!0,A=Number.isInteger(s.maxImageSize)&&s.maxImageSize>-1?s.maxImageSize:-1,k=s.isEvalSupported!==!1,_=typeof s.isOffscreenCanvasSupported=="boolean"?s.isOffscreenCanvasSupported:!Sr,L=typeof s.isImageDecoderSupported=="boolean"?s.isImageDecoderSupported:!Sr&&(Yn.platform.isFirefox||!globalThis.chrome),D=Number.isInteger(s.canvasMaxAreaInBytes)?s.canvasMaxAreaInBytes:-1,P=typeof s.disableFontFace=="boolean"?s.disableFontFace:Sr,T=s.fontExtraProperties===!0,B=s.enableXfa===!0,R=s.ownerDocument||globalThis.document,O=s.disableRange===!0,I=s.disableStream===!0,U=s.disableAutoFetch===!0,M=s.pdfBug===!0,$=s.CanvasFactory||(Sr?Nue:Sue),W=s.FilterFactory||(Sr?kue:jue),ee=s.enableHWA===!0,Z=s.useWasm!==!1,z=c?c.length:s.length??NaN,se=typeof s.useSystemFonts=="boolean"?s.useSystemFonts:!Sr&&!P,de=typeof s.useWorkerFetch=="boolean"?s.useWorkerFetch:!!(g===yO&&y===vO&&S===bO&&p&&v&&w&&ky(p,document.baseURI)&&ky(v,document.baseURI)&&ky(w,document.baseURI)),ne=null;qde(f);const H={canvasFactory:new $({ownerDocument:R,enableHWA:ee}),filterFactory:new W({docId:t,ownerDocument:R}),cMapReaderFactory:de?null:new g({baseUrl:p,isCompressed:x}),standardFontDataFactory:de?null:new y({baseUrl:v}),wasmFactory:de?null:new S({baseUrl:w})};h||(h=Xv.create({verbosity:f,port:dr.workerPort}),e._worker=h);const Y={docId:t,apiVersion:"5.4.394",data:r,password:l,disableAutoFetch:U,rangeChunkSize:d,length:z,docBaseUrl:m,enableXfa:B,evaluatorOptions:{maxImageSize:A,disableFontFace:P,ignoreErrors:j,isEvalSupported:k,isOffscreenCanvasSupported:_,isImageDecoderSupported:L,canvasMaxAreaInBytes:D,fontExtraProperties:T,useSystemFonts:se,useWasm:Z,useWorkerFetch:de,cMapUrl:p,iccUrl:b,standardFontDataUrl:v,wasmUrl:w}},ae={ownerDocument:R,pdfBug:M,styleElement:ne,loadingParams:{disableAutoFetch:U,enableXfa:B}};return h.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const ce=h.messageHandler.sendWithPromise("GetDocRequest",Y,r?[r.buffer]:null);let Ue;if(c)Ue=new Gue(c,{disableRange:O,disableStream:I});else if(!r){if(!n)throw new Error("getDocument - no `url` parameter provided.");const te=ky(n)?Que:Sr?ohe:she;Ue=new te({url:n,length:z,httpHeaders:a,withCredentials:o,rangeChunkSize:d,disableRange:O,disableStream:I})}return ce.then(te=>{if(e.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const J=new Iy(t,te,h.port),K=new mhe(J,e,Ue,ae,H,ee);e._transport=K,J.send("Ready",null)})}).catch(e._capability.reject),e}var sj;const nj=class nj{constructor(){Ce(this,"_capability",Promise.withResolvers());Ce(this,"_transport",null);Ce(this,"_worker",null);Ce(this,"docId",`d${Fs(nj,sj)._++}`);Ce(this,"destroyed",!1);Ce(this,"onPassword",null);Ce(this,"onProgress",null)}get promise(){return this._capability.promise}async destroy(){var e,t,n,r;this.destroyed=!0;try{(e=this._worker)!=null&&e.port&&(this._worker._pendingDestroy=!0),await((t=this._transport)==null?void 0:t.destroy())}catch(a){throw(n=this._worker)!=null&&n.port&&delete this._worker._pendingDestroy,a}this._transport=null,(r=this._worker)==null||r.destroy(),this._worker=null}async getData(){return this._transport.getData()}};sj=new WeakMap,E(nj,sj,0);let p2=nj;var uf,l0,c0,d0,u0;class OH{constructor(e,t,n=!1,r=null){E(this,uf,Promise.withResolvers());E(this,l0,[]);E(this,c0,[]);E(this,d0,[]);E(this,u0,[]);this.length=e,this.initialData=t,this.progressiveDone=n,this.contentDispositionFilename=r}addRangeListener(e){u(this,u0).push(e)}addProgressListener(e){u(this,d0).push(e)}addProgressiveReadListener(e){u(this,c0).push(e)}addProgressiveDoneListener(e){u(this,l0).push(e)}onDataRange(e,t){for(const n of u(this,u0))n(e,t)}onDataProgress(e,t){u(this,uf).promise.then(()=>{for(const n of u(this,d0))n(e,t)})}onDataProgressiveRead(e){u(this,uf).promise.then(()=>{for(const t of u(this,c0))t(e)})}onDataProgressiveDone(){u(this,uf).promise.then(()=>{for(const e of u(this,l0))e()})}transportReady(){u(this,uf).resolve()}requestDataRange(e,t){ds("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}uf=new WeakMap,l0=new WeakMap,c0=new WeakMap,d0=new WeakMap,u0=new WeakMap;class hhe{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return bt(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(e,t){return this._transport.getAnnotationsByType(e,t)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var oc,hf,Fy;class fhe{constructor(e,t,n,r=!1){E(this,hf);E(this,oc,!1);this._pageIndex=e,this._pageInfo=t,this._transport=n,this._stats=r?new uO:null,this._pdfBug=r,this.commonObjs=n.commonObjs,this.objs=new PH,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:n=0,offsetY:r=0,dontFlip:a=!1}={}){return new hw({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:r,dontFlip:a})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return bt(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var e;return((e=this._transport._htmlForXfa)==null?void 0:e.children[this._pageIndex])||null}render({canvasContext:e,canvas:t=e.canvas,viewport:n,intent:r="display",annotationMode:a=md.ENABLE,transform:o=null,background:l=null,optionalContentConfigPromise:c=null,annotationCanvasMap:d=null,pageColors:h=null,printAnnotationStorage:f=null,isEditing:m=!1,recordOperations:p=!1,operationsFilter:x=null}){var L,D,P;(L=this._stats)==null||L.time("Overall");const g=this._transport.getRenderingIntent(r,a,f,m),{renderingIntent:b,cacheKey:v}=g;N(this,oc,!1),c||(c=this._transport.getOptionalContentConfig(b));let y=this._intentStates.get(v);y||(y=Object.create(null),this._intentStates.set(v,y)),y.streamReaderCancelTimeout&&(clearTimeout(y.streamReaderCancelTimeout),y.streamReaderCancelTimeout=null);const w=!!(b&Ii.PRINT);y.displayReadyCapability||(y.displayReadyCapability=Promise.withResolvers(),y.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(D=this._stats)==null||D.time("Page Request"),this._pumpOperatorList(g));const S=!!(this._pdfBug&&((P=globalThis.StepperManager)!=null&&P.enabled)),j=!this.recordedBBoxes&&(p||S),A=T=>{var B,R;if(y.renderTasks.delete(k),j){const O=(B=k.gfx)==null?void 0:B.dependencyTracker.take();O&&(k.stepper&&k.stepper.setOperatorBBoxes(O,k.gfx.dependencyTracker.takeDebugMetadata()),p&&(this.recordedBBoxes=O))}w&&N(this,oc,!0),F(this,hf,Fy).call(this),T?(k.capability.reject(T),this._abortOperatorList({intentState:y,reason:T instanceof Error?T:new Error(T)})):k.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(R=globalThis.Stats)!=null&&R.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},k=new g2({callback:A,params:{canvas:t,canvasContext:e,dependencyTracker:j?new Pue(t,y.operatorList.length,S):null,viewport:n,transform:o,background:l},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:d,operatorList:y.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!w,pdfBug:this._pdfBug,pageColors:h,enableHWA:this._transport.enableHWA,operationsFilter:x});(y.renderTasks||(y.renderTasks=new Set)).add(k);const _=k.task;return Promise.all([y.displayReadyCapability.promise,c]).then(([T,B])=>{var R;if(this.destroyed){A();return}if((R=this._stats)==null||R.time("Rendering"),!(B.renderingIntent&b))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");k.initializeGraphics({transparency:T,optionalContentConfig:B}),k.operatorListChanged()}).catch(A),_}getOperatorList({intent:e="display",annotationMode:t=md.ENABLE,printAnnotationStorage:n=null,isEditing:r=!1}={}){var d;function a(){l.operatorList.lastChunk&&(l.opListReadCapability.resolve(l.operatorList),l.renderTasks.delete(c))}const o=this._transport.getRenderingIntent(e,t,n,r,!0);let l=this._intentStates.get(o.cacheKey);l||(l=Object.create(null),this._intentStates.set(o.cacheKey,l));let c;return l.opListReadCapability||(c=Object.create(null),c.operatorListChanged=a,l.opListReadCapability=Promise.withResolvers(),(l.renderTasks||(l.renderTasks=new Set)).add(c),l.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(d=this._stats)==null||d.time("Page Request"),this._pumpOperatorList(o)),l.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(r){return r.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(n=>Yv.textContent(n));const t=this.streamTextContent(e);return new Promise(function(n,r){function a(){o.read().then(function({value:c,done:d}){if(d){n(l);return}l.lang??(l.lang=c.lang),Object.assign(l.styles,c.styles),l.items.push(...c.items),a()},r)}const o=t.getReader(),l={items:[],styles:Object.create(null),lang:null};a()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const n of t.renderTasks)e.push(n.completed),n.cancel();return this.objs.clear(),N(this,oc,!1),Promise.all(e)}cleanup(e=!1){N(this,oc,!0);const t=F(this,hf,Fy).call(this);return e&&t&&this._stats&&(this._stats=new uO),t}_startRenderPage(e,t){var r,a;const n=this._intentStates.get(t);n&&((r=this._stats)==null||r.timeEnd("Page Request"),(a=n.displayReadyCapability)==null||a.resolve(e))}_renderPageChunk(e,t){for(let n=0,r=e.length;n<r;n++)t.operatorList.fnArray.push(e.fnArray[n]),t.operatorList.argsArray.push(e.argsArray[n]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const n of t.renderTasks)n.operatorListChanged();e.lastChunk&&F(this,hf,Fy).call(this)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:n,modifiedIds:r}){const{map:a,transfer:o}=n,c=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:a,modifiedIds:r},o).getReader(),d=this._intentStates.get(t);d.streamReader=c;const h=()=>{c.read().then(({value:f,done:m})=>{if(m){d.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(f,d),h())},f=>{if(d.streamReader=null,!this._transport.destroyed){if(d.operatorList){d.operatorList.lastChunk=!0;for(const m of d.renderTasks)m.operatorListChanged();F(this,hf,Fy).call(this)}if(d.displayReadyCapability)d.displayReadyCapability.reject(f);else if(d.opListReadCapability)d.opListReadCapability.reject(f);else throw f}})};h()}_abortOperatorList({intentState:e,reason:t,force:n=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!n){if(e.renderTasks.size>0)return;if(t instanceof DM){let r=uhe;t.extraDelay>0&&t.extraDelay<1e3&&(r+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},r);return}}if(e.streamReader.cancel(new Uu(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[r,a]of this._intentStates)if(a===e){this._intentStates.delete(r);break}this.cleanup()}}}get stats(){return this._stats}}oc=new WeakMap,hf=new WeakSet,Fy=function(){if(!u(this,oc)||this.destroyed)return!1;for(const{renderTasks:e,operatorList:t}of this._intentStates.values())if(e.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),N(this,oc,!1),!0};var Wd,eo,lc,ff,rj,mf,pf,Tr,Z1,FH,BH,By,Eg,J1;const Ns=class Ns{constructor({name:e=null,port:t=null,verbosity:n=Gde()}={}){E(this,Tr);E(this,Wd,Promise.withResolvers());E(this,eo,null);E(this,lc,null);E(this,ff,null);if(this.name=e,this.destroyed=!1,this.verbosity=n,t){if(u(Ns,pf).has(t))throw new Error("Cannot use more than one PDFWorker per port.");u(Ns,pf).set(t,this),F(this,Tr,FH).call(this,t)}else F(this,Tr,BH).call(this)}get promise(){return u(this,Wd).promise}get port(){return u(this,lc)}get messageHandler(){return u(this,eo)}destroy(){var e,t;this.destroyed=!0,(e=u(this,ff))==null||e.terminate(),N(this,ff,null),u(Ns,pf).delete(u(this,lc)),N(this,lc,null),(t=u(this,eo))==null||t.destroy(),N(this,eo,null)}static create(e){const t=u(this,pf).get(e==null?void 0:e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new Ns(e)}static get workerSrc(){if(dr.workerSrc)return dr.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return bt(this,"_setupFakeWorkerGlobal",(async()=>u(this,Eg,J1)?u(this,Eg,J1):(await import(this.workerSrc)).WorkerMessageHandler)())}};Wd=new WeakMap,eo=new WeakMap,lc=new WeakMap,ff=new WeakMap,rj=new WeakMap,mf=new WeakMap,pf=new WeakMap,Tr=new WeakSet,Z1=function(){u(this,Wd).resolve(),u(this,eo).send("configure",{verbosity:this.verbosity})},FH=function(e){N(this,lc,e),N(this,eo,new Iy("main","worker",e)),u(this,eo).on("ready",()=>{}),F(this,Tr,Z1).call(this)},BH=function(){if(u(Ns,mf)||u(Ns,Eg,J1)){F(this,Tr,By).call(this);return}let{workerSrc:e}=Ns;try{Ns._isSameOrigin(window.location,e)||(e=Ns._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),n=new Iy("main","worker",t),r=()=>{a.abort(),n.destroy(),t.terminate(),this.destroyed?u(this,Wd).reject(new Error("Worker was destroyed")):F(this,Tr,By).call(this)},a=new AbortController;t.addEventListener("error",()=>{u(this,ff)||r()},{signal:a.signal}),n.on("test",l=>{if(a.abort(),this.destroyed||!l){r();return}N(this,eo,n),N(this,lc,t),N(this,ff,t),F(this,Tr,Z1).call(this)}),n.on("ready",l=>{if(a.abort(),this.destroyed){r();return}try{o()}catch{F(this,Tr,By).call(this)}});const o=()=>{const l=new Uint8Array;n.send("test",l,[l.buffer])};o();return}catch{Ok("The worker has been disabled.")}F(this,Tr,By).call(this)},By=function(){u(Ns,mf)||(ut("Setting up fake worker."),N(Ns,mf,!0)),Ns._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){u(this,Wd).reject(new Error("Worker was destroyed"));return}const t=new Cue;N(this,lc,t);const n=`fake${Fs(Ns,rj)._++}`,r=new Iy(n+"_worker",n,t);e.setup(r,t),N(this,eo,new Iy(n,n+"_worker",t)),F(this,Tr,Z1).call(this)}).catch(e=>{u(this,Wd).reject(new Error(`Setting up fake worker failed: "${e.message}".`))})},Eg=new WeakSet,J1=function(){var e;try{return((e=globalThis.pdfjsWorker)==null?void 0:e.WorkerMessageHandler)||null}catch{return null}},E(Ns,Eg),E(Ns,rj,0),E(Ns,mf,!1),E(Ns,pf,new WeakMap),Sr&&(N(Ns,mf,!0),dr.workerSrc||(dr.workerSrc="./pdf.worker.mjs")),Ns._isSameOrigin=(e,t)=>{const n=URL.parse(e);if(!(n!=null&&n.origin)||n.origin==="null")return!1;const r=new URL(t,n);return n.origin===r.origin},Ns._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},Ns.fromPort=e=>{if(iue("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!(e!=null&&e.port))throw new Error("PDFWorker.fromPort - invalid method signature.");return Ns.create(e)};let Xv=Ns;var cc,Zo,Pg,Mg,dc,gf,$y;class mhe{constructor(e,t,n,r,a,o){E(this,gf);E(this,cc,new Map);E(this,Zo,new Map);E(this,Pg,new Map);E(this,Mg,new Map);E(this,dc,null);this.messageHandler=e,this.loadingTask=t,this.commonObjs=new PH,this.fontLoader=new gue({ownerDocument:r.ownerDocument,styleElement:r.styleElement}),this.loadingParams=r.loadingParams,this._params=r,this.canvasFactory=a.canvasFactory,this.filterFactory=a.filterFactory,this.cMapReaderFactory=a.cMapReaderFactory,this.standardFontDataFactory=a.standardFontDataFactory,this.wasmFactory=a.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=o,this.setupMessageHandler()}get annotationStorage(){return bt(this,"annotationStorage",new OM)}getRenderingIntent(e,t=md.ENABLE,n=null,r=!1,a=!1){let o=Ii.DISPLAY,l=ZT;switch(e){case"any":o=Ii.ANY;break;case"display":break;case"print":o=Ii.PRINT;break;default:ut(`getRenderingIntent - invalid intent: ${e}`)}const c=o&Ii.PRINT&&n instanceof pH?n:this.annotationStorage;switch(t){case md.DISABLE:o+=Ii.ANNOTATIONS_DISABLE;break;case md.ENABLE:break;case md.ENABLE_FORMS:o+=Ii.ANNOTATIONS_FORMS;break;case md.ENABLE_STORAGE:o+=Ii.ANNOTATIONS_STORAGE,l=c.serializable;break;default:ut(`getRenderingIntent - invalid annotationMode: ${t}`)}r&&(o+=Ii.IS_EDITING),a&&(o+=Ii.OPLIST);const{ids:d,hash:h}=c.modifiedIds,f=[o,l.hash,h];return{renderingIntent:o,cacheKey:f.join("_"),annotationStorageSerializable:l,modifiedIds:d}}destroy(){var n;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(n=u(this,dc))==null||n.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const r of u(this,Zo).values())e.push(r._destroy());u(this,Zo).clear(),u(this,Pg).clear(),u(this,Mg).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{var r,a;this.commonObjs.clear(),this.fontLoader.clear(),u(this,cc).clear(),this.filterFactory.destroy(),Kv.cleanup(),(r=this._networkStream)==null||r.cancelAllRequests(new Uu("Worker was terminated.")),(a=this.messageHandler)==null||a.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(n,r)=>{Ot(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=a=>{this._lastProgress={loaded:a.loaded,total:a.total}},r.onPull=()=>{this._fullReader.read().then(function({value:a,done:o}){if(o){r.close();return}Ot(a instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(a),1,[a])}).catch(a=>{r.error(a)})},r.onCancel=a=>{this._fullReader.cancel(a),r.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("ReaderHeadersReady",async n=>{var l;await this._fullReader.headersReady;const{isStreamingSupported:r,isRangeSupported:a,contentLength:o}=this._fullReader;return(!r||!a)&&(this._lastProgress&&((l=t.onProgress)==null||l.call(t,this._lastProgress)),this._fullReader.onProgress=c=>{var d;(d=t.onProgress)==null||d.call(t,{loaded:c.loaded,total:c.total})}),{isStreamingSupported:r,isRangeSupported:a,contentLength:o}}),e.on("GetRangeReader",(n,r)=>{Ot(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const a=this._networkStream.getRangeReader(n.begin,n.end);if(!a){r.close();return}r.onPull=()=>{a.read().then(function({value:o,done:l}){if(l){r.close();return}Ot(o instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{r.error(o)})},r.onCancel=o=>{a.cancel(o),r.ready.catch(l=>{if(!this.destroyed)throw l})}}),e.on("GetDoc",({pdfInfo:n})=>{this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,t._capability.resolve(new hhe(n,this))}),e.on("DocException",n=>{t._capability.reject(Vr(n))}),e.on("PasswordRequest",n=>{N(this,dc,Promise.withResolvers());try{if(!t.onPassword)throw Vr(n);const r=a=>{a instanceof Error?u(this,dc).reject(a):u(this,dc).resolve({password:a})};t.onPassword(r,n.code)}catch(r){u(this,dc).reject(r)}return u(this,dc).promise}),e.on("DataLoaded",n=>{var r;(r=t.onProgress)==null||r.call(t,{loaded:n.length,total:n.length}),this.downloadInfoCapability.resolve(n)}),e.on("StartRenderPage",n=>{if(this.destroyed)return;u(this,Zo).get(n.pageIndex)._startRenderPage(n.transparency,n.cacheKey)}),e.on("commonobj",([n,r,a])=>{var o;if(this.destroyed||this.commonObjs.has(n))return null;switch(r){case"Font":if("error"in a){const m=a.error;ut(`Error during font loading: ${m}`),this.commonObjs.resolve(n,m);break}const l=new JT(a),c=this._params.pdfBug&&((o=globalThis.FontInspector)!=null&&o.enabled)?(m,p)=>globalThis.FontInspector.fontAdded(m,p):null,d=new xue(l,c,a.extra,a.charProcOperatorList);this.fontLoader.bind(d).catch(()=>e.sendWithPromise("FontFallback",{id:n})).finally(()=>{!d.fontExtraProperties&&d.data&&d.clearData(),this.commonObjs.resolve(n,d)});break;case"CopyLocalImage":const{imageRef:h}=a;Ot(h,"The imageRef must be defined.");for(const m of u(this,Zo).values())for(const[,p]of m.objs)if((p==null?void 0:p.ref)===h)return p.dataLen?(this.commonObjs.resolve(n,structuredClone(p)),p.dataLen):null;break;case"FontPath":case"Image":this.commonObjs.resolve(n,a);break;case"Pattern":const f=new e2(a);this.commonObjs.resolve(n,f.getIR());break;default:throw new Error(`Got unknown common object type ${r}`)}return null}),e.on("obj",([n,r,a,o])=>{var c;if(this.destroyed)return;const l=u(this,Zo).get(r);if(!l.objs.has(n)){if(l._intentStates.size===0){(c=o==null?void 0:o.bitmap)==null||c.close();return}switch(a){case"Image":case"Pattern":l.objs.resolve(n,o);break;default:throw new Error(`Got unknown object type ${a}`)}}}),e.on("DocProgress",n=>{var r;this.destroyed||(r=t.onProgress)==null||r.call(t,{loaded:n.loaded,total:n.total})}),e.on("FetchBinaryData",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");const r=this[n.type];if(!r)throw new Error(`${n.type} not initialized, see the \`useWorkerFetch\` parameter.`);return r.fetch(n)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var n;this.annotationStorage.size<=0&&ut("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:((n=this._fullReader)==null?void 0:n.filename)??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,n=u(this,Pg).get(t);if(n)return n;const r=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(a=>{if(this.destroyed)throw new Error("Transport destroyed");a.refStr&&u(this,Mg).set(a.refStr,e);const o=new fhe(t,a,this,this._params.pdfBug);return u(this,Zo).set(t,o),o});return u(this,Pg).set(t,r),r}getPageIndex(e){return t2(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return F(this,gf,$y).call(this,"GetFieldObjects")}hasJSActions(){return F(this,gf,$y).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(e,t){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:e,pageIndexesToSkip:t})}getDocJSActions(){return F(this,gf,$y).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return F(this,gf,$y).call(this,"GetOptionalContentConfig").then(t=>new que(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=u(this,cc).get(e);if(t)return t;const n=this.messageHandler.sendWithPromise(e,null).then(r=>{var a,o;return{info:r[0],metadata:r[1]?new Vue(r[1]):null,contentDispositionFilename:((a=this._fullReader)==null?void 0:a.filename)??null,contentLength:((o=this._fullReader)==null?void 0:o.contentLength)??null}});return u(this,cc).set(e,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of u(this,Zo).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),u(this,cc).clear(),this.filterFactory.destroy(!0),Kv.cleanup()}}cachedPageNumber(e){if(!t2(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return u(this,Mg).get(t)??null}}cc=new WeakMap,Zo=new WeakMap,Pg=new WeakMap,Mg=new WeakMap,dc=new WeakMap,gf=new WeakSet,$y=function(e,t=null){const n=u(this,cc).get(e);if(n)return n;const r=this.messageHandler.sendWithPromise(e,t);return u(this,cc).set(e,r),r};var qd;class phe{constructor(e){E(this,qd,null);Ce(this,"onContinue",null);Ce(this,"onError",null);N(this,qd,e)}get promise(){return u(this,qd).capability.promise}cancel(e=0){u(this,qd).cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=u(this,qd).operatorList;if(!e)return!1;const{annotationCanvasMap:t}=u(this,qd);return e.form||e.canvas&&(t==null?void 0:t.size)>0}}qd=new WeakMap;var Gd,xf;const ph=class ph{constructor({callback:e,params:t,objs:n,commonObjs:r,annotationCanvasMap:a,operatorList:o,pageIndex:l,canvasFactory:c,filterFactory:d,useRequestAnimationFrame:h=!1,pdfBug:f=!1,pageColors:m=null,enableHWA:p=!1,operationsFilter:x=null}){E(this,Gd,null);this.callback=e,this.params=t,this.objs=n,this.commonObjs=r,this.annotationCanvasMap=a,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=l,this.canvasFactory=c,this.filterFactory=d,this._pdfBug=f,this.pageColors=m,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=h===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new phe(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvas,this._canvasContext=t.canvas?null:t.canvasContext,this._enableHWA=p,this._dependencyTracker=t.dependencyTracker,this._operationsFilter=x}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){var c,d;if(this.cancelled)return;if(this._canvas){if(u(ph,xf).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");u(ph,xf).add(this._canvas)}this._pdfBug&&((c=globalThis.StepperManager)!=null&&c.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:n,transform:r,background:a,dependencyTracker:o}=this.params,l=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new Ep(l,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors,o),this.gfx.beginDrawing({transform:r,viewport:n,transparency:e,background:a}),this.operatorListIdx=0,this.graphicsReady=!0,(d=this.graphicsReadyCallback)==null||d.call(this)}cancel(e=null,t=0){var n,r,a;this.running=!1,this.cancelled=!0,(n=this.gfx)==null||n.endDrawing(),u(this,Gd)&&(window.cancelAnimationFrame(u(this,Gd)),N(this,Gd,null)),u(ph,xf).delete(this._canvas),e||(e=new DM(`Rendering cancelled, page ${this._pageIndex+1}`,t)),this.callback(e),(a=(r=this.task).onError)==null||a.call(r,e)}operatorListChanged(){var e,t;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(e=this.gfx.dependencyTracker)==null||e.growOperationsCount(this.operatorList.fnArray.length),(t=this.stepper)==null||t.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?N(this,Gd,window.requestAnimationFrame(()=>{N(this,Gd,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),u(ph,xf).delete(this._canvas),this.callback())))}};Gd=new WeakMap,xf=new WeakMap,E(ph,xf,new WeakSet);let g2=ph;const $H="5.4.394",ghe="2cc809ade";var bi,yf,Ig,pn,h0,Rg,uc,f0,Yd,to,m0,rs,x2,y2,v2,ch,UH,id;const Wr=class Wr{constructor({editor:e=null,uiManager:t=null}){E(this,rs);E(this,bi,null);E(this,yf,null);E(this,Ig);E(this,pn,null);E(this,h0,!1);E(this,Rg,!1);E(this,uc,null);E(this,f0);E(this,Yd,null);E(this,to,null);var n,r;e?(N(this,Rg,!1),N(this,uc,e)):N(this,Rg,!0),N(this,to,(e==null?void 0:e._uiManager)||t),N(this,f0,u(this,to)._eventBus),N(this,Ig,((n=e==null?void 0:e.color)==null?void 0:n.toUpperCase())||((r=u(this,to))==null?void 0:r.highlightColors.values().next().value)||"#FFFF98"),u(Wr,m0)||N(Wr,m0,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return bt(this,"_keyboardManager",new mw([[["Escape","mac+Escape"],Wr.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Wr.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Wr.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Wr.prototype._moveToPrevious],[["Home","mac+Home"],Wr.prototype._moveToBeginning],[["End","mac+End"],Wr.prototype._moveToEnd]]))}renderButton(){const e=N(this,bi,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.ariaHasPopup="true",u(this,uc)&&(e.ariaControls=`${u(this,uc).id}_colorpicker_dropdown`);const t=u(this,to)._signal;e.addEventListener("click",F(this,rs,ch).bind(this),{signal:t}),e.addEventListener("keydown",F(this,rs,v2).bind(this),{signal:t});const n=N(this,yf,document.createElement("span"));return n.className="swatch",n.ariaHidden="true",n.style.backgroundColor=u(this,Ig),e.append(n),e}renderMainDropdown(){const e=N(this,pn,F(this,rs,x2).call(this));return e.ariaOrientation="horizontal",e.ariaLabelledBy="highlightColorPickerLabel",e}_colorSelectFromKeyboard(e){if(e.target===u(this,bi)){F(this,rs,ch).call(this,e);return}const t=e.target.getAttribute("data-color");t&&F(this,rs,y2).call(this,t,e)}_moveToNext(e){var t,n;if(!u(this,rs,id)){F(this,rs,ch).call(this,e);return}if(e.target===u(this,bi)){(t=u(this,pn).firstChild)==null||t.focus();return}(n=e.target.nextSibling)==null||n.focus()}_moveToPrevious(e){var t,n;if(e.target===((t=u(this,pn))==null?void 0:t.firstChild)||e.target===u(this,bi)){u(this,rs,id)&&this._hideDropdownFromKeyboard();return}u(this,rs,id)||F(this,rs,ch).call(this,e),(n=e.target.previousSibling)==null||n.focus()}_moveToBeginning(e){var t;if(!u(this,rs,id)){F(this,rs,ch).call(this,e);return}(t=u(this,pn).firstChild)==null||t.focus()}_moveToEnd(e){var t;if(!u(this,rs,id)){F(this,rs,ch).call(this,e);return}(t=u(this,pn).lastChild)==null||t.focus()}hideDropdown(){var e,t;(e=u(this,pn))==null||e.classList.add("hidden"),u(this,bi).ariaExpanded="false",(t=u(this,Yd))==null||t.abort(),N(this,Yd,null)}_hideDropdownFromKeyboard(){var e;if(!u(this,Rg)){if(!u(this,rs,id)){(e=u(this,uc))==null||e.unselect();return}this.hideDropdown(),u(this,bi).focus({preventScroll:!0,focusVisible:u(this,h0)})}}updateColor(e){if(u(this,yf)&&(u(this,yf).style.backgroundColor=e),!u(this,pn))return;const t=u(this,to).highlightColors.values();for(const n of u(this,pn).children)n.ariaSelected=t.next().value===e.toUpperCase()}destroy(){var e,t;(e=u(this,bi))==null||e.remove(),N(this,bi,null),N(this,yf,null),(t=u(this,pn))==null||t.remove(),N(this,pn,null)}};bi=new WeakMap,yf=new WeakMap,Ig=new WeakMap,pn=new WeakMap,h0=new WeakMap,Rg=new WeakMap,uc=new WeakMap,f0=new WeakMap,Yd=new WeakMap,to=new WeakMap,m0=new WeakMap,rs=new WeakSet,x2=function(){const e=document.createElement("div"),t=u(this,to)._signal;e.addEventListener("contextmenu",La,{signal:t}),e.className="dropdown",e.role="listbox",e.ariaMultiSelectable="false",e.ariaOrientation="vertical",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),u(this,uc)&&(e.id=`${u(this,uc).id}_colorpicker_dropdown`);for(const[n,r]of u(this,to).highlightColors){const a=document.createElement("button");a.tabIndex="0",a.role="option",a.setAttribute("data-color",r),a.title=n,a.setAttribute("data-l10n-id",u(Wr,m0)[n]);const o=document.createElement("span");a.append(o),o.className="swatch",o.style.backgroundColor=r,a.ariaSelected=r===u(this,Ig),a.addEventListener("click",F(this,rs,y2).bind(this,r),{signal:t}),e.append(a)}return e.addEventListener("keydown",F(this,rs,v2).bind(this),{signal:t}),e},y2=function(e,t){t.stopPropagation(),u(this,f0).dispatch("switchannotationeditorparams",{source:this,type:Lt.HIGHLIGHT_COLOR,value:e}),this.updateColor(e)},v2=function(e){Wr._keyboardManager.exec(this,e)},ch=function(e){if(u(this,rs,id)){this.hideDropdown();return}if(N(this,h0,e.detail===0),u(this,Yd)||(N(this,Yd,new AbortController),window.addEventListener("pointerdown",F(this,rs,UH).bind(this),{signal:u(this,to).combinedSignal(u(this,Yd))})),u(this,bi).ariaExpanded="true",u(this,pn)){u(this,pn).classList.remove("hidden");return}const t=N(this,pn,F(this,rs,x2).call(this));u(this,bi).append(t)},UH=function(e){var t;(t=u(this,pn))!=null&&t.contains(e.target)||this.hideDropdown()},id=function(){return u(this,pn)&&!u(this,pn).classList.contains("hidden")},E(Wr,m0,null);let LS=Wr;var Jo,p0,Dg,g0;const gh=class gh{constructor(e){E(this,Jo,null);E(this,p0,null);E(this,Dg,null);N(this,p0,e),N(this,Dg,e._uiManager),u(gh,g0)||N(gh,g0,Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"}))}renderButton(){if(u(this,Jo))return u(this,Jo);const{editorType:e,colorType:t,color:n}=u(this,p0),r=N(this,Jo,document.createElement("input"));return r.type="color",r.value=n||"#000000",r.className="basicColorPicker",r.tabIndex=0,r.setAttribute("data-l10n-id",u(gh,g0)[e]),r.addEventListener("input",()=>{u(this,Dg).updateParams(t,r.value)},{signal:u(this,Dg)._signal}),r}update(e){u(this,Jo)&&(u(this,Jo).value=e)}destroy(){var e;(e=u(this,Jo))==null||e.remove(),N(this,Jo,null)}hideDropdown(){}};Jo=new WeakMap,p0=new WeakMap,Dg=new WeakMap,g0=new WeakMap,E(gh,g0,null);let OS=gh;function IO(s){return Math.floor(Math.max(0,Math.min(1,s))*255).toString(16).padStart(2,"0")}function cy(s){return Math.max(0,Math.min(255,255*s))}class RO{static CMYK_G([e,t,n,r]){return["G",1-Math.min(1,.3*e+.59*n+.11*t+r)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=cy(e),[e,e,e]}static G_HTML([e]){const t=IO(e);return`#${t}${t}${t}`}static RGB_G([e,t,n]){return["G",.3*e+.59*t+.11*n]}static RGB_rgb(e){return e.map(cy)}static RGB_HTML(e){return`#${e.map(IO).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,n,r]){return["RGB",1-Math.min(1,e+r),1-Math.min(1,n+r),1-Math.min(1,t+r)]}static CMYK_rgb([e,t,n,r]){return[cy(1-Math.min(1,e+r)),cy(1-Math.min(1,n+r)),cy(1-Math.min(1,t+r))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,n]){const r=1-e,a=1-t,o=1-n,l=Math.min(r,a,o);return["CMYK",r,a,o,l]}}class xhe{create(e,t,n=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const r=this._createSVG("svg:svg");return r.setAttribute("version","1.1"),n||(r.setAttribute("width",`${e}px`),r.setAttribute("height",`${t}px`)),r.setAttribute("preserveAspectRatio","none"),r.setAttribute("viewBox",`0 0 ${e} ${t}`),r}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){ds("Abstract method `_createSVG` called.")}}class FS extends xhe{_createSVG(e){return document.createElementNS(Rl,e)}}const yhe=9,gm=new WeakSet,vhe=new Date().getTimezoneOffset()*60*1e3;class _A{static create(e){switch(e.data.annotationType){case sn.LINK:return new $M(e);case sn.TEXT:return new whe(e);case sn.WIDGET:switch(e.data.fieldType){case"Tx":return new Che(e);case"Btn":return e.data.radioButton?new VH(e):e.data.checkBox?new jhe(e):new khe(e);case"Ch":return new Nhe(e);case"Sig":return new She(e)}return new jm(e);case sn.POPUP:return new w2(e);case sn.FREETEXT:return new KH(e);case sn.LINE:return new _he(e);case sn.SQUARE:return new The(e);case sn.CIRCLE:return new Ehe(e);case sn.POLYLINE:return new XH(e);case sn.CARET:return new Mhe(e);case sn.INK:return new UM(e);case sn.POLYGON:return new Phe(e);case sn.HIGHLIGHT:return new QH(e);case sn.UNDERLINE:return new Ihe(e);case sn.SQUIGGLY:return new Rhe(e);case sn.STRIKEOUT:return new Dhe(e);case sn.STAMP:return new ZH(e);case sn.FILEATTACHMENT:return new Lhe(e);default:return new Ls(e)}}}var vf,Lg,xa,x0,b2;const oI=class oI{constructor(e,{isRenderable:t=!1,ignoreBorder:n=!1,createQuadrilaterals:r=!1}={}){E(this,x0);E(this,vf,null);E(this,Lg,!1);E(this,xa,null);this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableComment=e.enableComment,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,this.hasOwnCommentButton=!1,t&&(this.contentElement=this.container=this._createContainer(n)),r&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:e,richText:t}){return!!(e!=null&&e.str||t!=null&&t.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return oI._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){var n;const{data:e}=this,t=(n=this.annotationStorage)==null?void 0:n.getEditor(e.id);return t?t.getData():e}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){var l;const e=(l=this.annotationStorage)==null?void 0:l.getEditor(this.data.id);if(e)return e.commentButtonPositionInPage;const{quadPoints:t,inkLists:n,rect:r}=this.data;let a=-1/0,o=-1/0;if((t==null?void 0:t.length)>=8){for(let c=0;c<t.length;c+=8)t[c+1]>o?(o=t[c+1],a=t[c+2]):t[c+1]===o&&(a=Math.max(a,t[c+2]));return[a,o]}if((n==null?void 0:n.length)>=1){for(const c of n)for(let d=0,h=c.length;d<h;d+=2)c[d+1]>o?(o=c[d+1],a=c[d]):c[d+1]===o&&(a=Math.max(a,c[d]));if(a!==1/0)return[a,o]}return r?[r[2],r[3]]:null}_normalizePoint(e){const{page:{view:t},viewport:{rawDims:{pageWidth:n,pageHeight:r,pageX:a,pageY:o}}}=this.parent;return e[1]=t[3]-e[1]+t[1],e[0]=100*(e[0]-a)/n,e[1]=100*(e[1]-o)/r,e}get commentText(){var t,n,r;const{data:e}=this;return((n=(t=this.annotationStorage.getRawValue(`${qv}${e.id}`))==null?void 0:t.popup)==null?void 0:n.contents)||((r=e.contentsObj)==null?void 0:r.str)||""}set commentText(e){const{data:t}=this,n={deleted:!e,contents:e||""};this.annotationStorage.updateEditor(t.id,{popup:n})||this.annotationStorage.setValue(`${qv}${t.id}`,{id:t.id,annotationType:t.annotationType,pageIndex:this.parent.page._pageIndex,popup:n,popupRef:t.popupRef,modificationDate:new Date}),e||this.removePopup()}removePopup(){var e,t;(t=((e=u(this,xa))==null?void 0:e.popup)||this.popup)==null||t.remove(),N(this,xa,this.popup=null)}updateEdited(e){var a;if(!this.container)return;e.rect&&(u(this,vf)||N(this,vf,{rect:this.data.rect.slice(0)}));const{rect:t,popup:n}=e;t&&F(this,x0,b2).call(this,t);let r=((a=u(this,xa))==null?void 0:a.popup)||this.popup;!r&&(n!=null&&n.text)&&(this._createPopup(n),r=u(this,xa).popup),r&&(r.updateEdited(e),n!=null&&n.deleted&&(r.remove(),N(this,xa,null),this.popup=null))}resetEdited(){var e;u(this,vf)&&(F(this,x0,b2).call(this,u(this,vf).rect),(e=u(this,xa))==null||e.popup.resetEdited(),N(this,vf,null))}_createContainer(e){const{data:t,parent:{page:n,viewport:r}}=this,a=document.createElement("section");a.setAttribute("data-annotation-id",t.id),!(this instanceof jm)&&!(this instanceof $M)&&(a.tabIndex=0);const{style:o}=a;if(o.zIndex=this.parent.zIndex,this.parent.zIndex+=2,t.alternativeText&&(a.title=t.alternativeText),t.noRotate&&a.classList.add("norotate"),!t.rect||this instanceof w2){const{rotation:g}=t;return!t.hasOwnCanvas&&g!==0&&this.setRotation(g,a),a}const{width:l,height:c}=this;if(!e&&t.borderStyle.width>0){o.borderWidth=`${t.borderStyle.width}px`;const g=t.borderStyle.horizontalCornerRadius,b=t.borderStyle.verticalCornerRadius;if(g>0||b>0){const y=`calc(${g}px * var(--total-scale-factor)) / calc(${b}px * var(--total-scale-factor))`;o.borderRadius=y}else if(this instanceof VH){const y=`calc(${l}px * var(--total-scale-factor)) / calc(${c}px * var(--total-scale-factor))`;o.borderRadius=y}switch(t.borderStyle.style){case Vm.SOLID:o.borderStyle="solid";break;case Vm.DASHED:o.borderStyle="dashed";break;case Vm.BEVELED:ut("Unimplemented border style: beveled");break;case Vm.INSET:ut("Unimplemented border style: inset");break;case Vm.UNDERLINE:o.borderBottomStyle="solid";break}const v=t.borderColor||null;v?(N(this,Lg,!0),o.borderColor=Ge.makeHexColor(v[0]|0,v[1]|0,v[2]|0)):o.borderWidth=0}const d=Ge.normalizeRect([t.rect[0],n.view[3]-t.rect[1]+n.view[1],t.rect[2],n.view[3]-t.rect[3]+n.view[1]]),{pageWidth:h,pageHeight:f,pageX:m,pageY:p}=r.rawDims;o.left=`${100*(d[0]-m)/h}%`,o.top=`${100*(d[1]-p)/f}%`;const{rotation:x}=t;return t.hasOwnCanvas||x===0?(o.width=`${100*l/h}%`,o.height=`${100*c/f}%`):this.setRotation(x,a),a}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:n,pageHeight:r}=this.parent.viewport.rawDims;let{width:a,height:o}=this;e%180!==0&&([a,o]=[o,a]),t.style.width=`${100*a/n}%`,t.style.height=`${100*o/r}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,n,r)=>{const a=r.detail[t],o=a[0],l=a.slice(1);r.target.style[n]=RO[`${o}_HTML`](l),this.annotationStorage.setValue(this.data.id,{[n]:RO[`${o}_rgb`](l)})};return bt(this,"_commonActions",{display:t=>{const{display:n}=t.detail,r=n%2===1;this.container.style.visibility=r?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:r,noPrint:n===1||n===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:n}=t.detail;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:n,noView:n})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const n=t.detail.rotation;this.setRotation(n),this.annotationStorage.setValue(this.data.id,{rotation:n})}})}_dispatchEventFromSandbox(e,t){const n=this._commonActions;for(const r of Object.keys(t.detail)){const a=e[r]||n[r];a==null||a(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const n=this._commonActions;for(const[r,a]of Object.entries(t)){const o=n[r];if(o){const l={detail:{[r]:a},target:e};o(l),delete t[r]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,n,r,a]=this.data.rect.map(g=>Math.fround(g));if(e.length===8){const[g,b,v,y]=e.subarray(2,6);if(r===g&&a===b&&t===v&&n===y)return}const{style:o}=this.container;let l;if(u(this,Lg)){const{borderColor:g,borderWidth:b}=o;o.borderWidth=0,l=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${g}" stroke-width="${b}">`],this.container.classList.add("hasBorder")}const c=r-t,d=a-n,{svgFactory:h}=this,f=h.createElement("svg");f.classList.add("quadrilateralsContainer"),f.setAttribute("width",0),f.setAttribute("height",0),f.role="none";const m=h.createElement("defs");f.append(m);const p=h.createElement("clipPath"),x=`clippath_${this.data.id}`;p.setAttribute("id",x),p.setAttribute("clipPathUnits","objectBoundingBox"),m.append(p);for(let g=2,b=e.length;g<b;g+=8){const v=e[g],y=e[g+1],w=e[g+2],S=e[g+3],j=h.createElement("rect"),A=(w-t)/c,k=(a-y)/d,_=(v-w)/c,L=(y-S)/d;j.setAttribute("x",A),j.setAttribute("y",k),j.setAttribute("width",_),j.setAttribute("height",L),p.append(j),l==null||l.push(`<rect vector-effect="non-scaling-stroke" x="${A}" y="${k}" width="${_}" height="${L}"/>`)}u(this,Lg)&&(l.push("</g></svg>')"),o.backgroundImage=l.join("")),this.container.append(f),this.container.style.clipPath=`url(#${x})`}_createPopup(e=null){const{data:t}=this;let n,r;e?(n={str:e.text},r=e.date):(n=t.contentsObj,r=t.modificationDate),N(this,xa,new w2({data:{color:t.color,titleObj:t.titleObj,modificationDate:r,contentsObj:n,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]}))}get hasPopupElement(){return!!(u(this,xa)||this.popup||this.data.popupRef)}get extraPopupElement(){return u(this,xa)}render(){ds("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const n=[];if(this._fieldObjects){const r=this._fieldObjects[e];if(r)for(const{page:a,id:o,exportValues:l}of r){if(a===-1||o===t)continue;const c=typeof l=="string"?l:null,d=document.querySelector(`[data-element-id="${o}"]`);if(d&&!gm.has(d)){ut(`_getElementsByName - element not allowed: ${o}`);continue}n.push({id:o,exportValue:c,domElement:d})}return n}for(const r of document.getElementsByName(e)){const{exportValue:a}=r,o=r.getAttribute("data-element-id");o!==t&&gm.has(r)&&n.push({id:o,exportValue:a,domElement:r})}return n}show(){var e;this.container&&(this.container.hidden=!1),(e=this.popup)==null||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),(e=this.popup)==null||e.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{var n;(n=this.linkService.eventBus)==null||n.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}};vf=new WeakMap,Lg=new WeakMap,xa=new WeakMap,x0=new WeakSet,b2=function(e){const{container:{style:t},data:{rect:n,rotation:r},parent:{viewport:{rawDims:{pageWidth:a,pageHeight:o,pageX:l,pageY:c}}}}=this;n==null||n.splice(0,4,...e),t.left=`${100*(e[0]-l)/a}%`,t.top=`${100*(o-e[3]+c)/o}%`,r===0?(t.width=`${100*(e[2]-e[0])/a}%`,t.height=`${100*(e[3]-e[1])/o}%`):this.setRotation(r)};let Ls=oI;class bhe extends Ls{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.editor=e.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){const{editor:e}=this;e.hasComment&&this._createPopup(e.comment)}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(e){this.editor.comment=e,e||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.parent.removeAnnotation(this.data.id),this.container.remove(),this.container=null,this.removePopup()}}var Ui,dh,zH,HH;class $M extends Ls{constructor(t,n=null){super(t,{isRenderable:!0,ignoreBorder:!!(n!=null&&n.ignoreBorder),createQuadrilaterals:!0});E(this,Ui);this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:n}=this,r=document.createElement("a");r.setAttribute("data-element-id",t.id);let a=!1;return t.url?(n.addLinkAttributes(r,t.url,t.newWindow),a=!0):t.action?(this._bindNamedAction(r,t.action,t.overlaidText),a=!0):t.attachment?(F(this,Ui,zH).call(this,r,t.attachment,t.overlaidText,t.attachmentDest),a=!0):t.setOCGState?(F(this,Ui,HH).call(this,r,t.setOCGState,t.overlaidText),a=!0):t.dest?(this._bindLink(r,t.dest,t.overlaidText),a=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(r,t),a=!0),t.resetForm?(this._bindResetFormAction(r,t.resetForm),a=!0):this.isTooltipOnly&&!a&&(this._bindLink(r,""),a=!0)),this.container.classList.add("linkAnnotation"),a&&(this.contentElement=r,this.container.append(r)),this.container}_bindLink(t,n,r=""){t.href=this.linkService.getDestinationHash(n),t.onclick=()=>(n&&this.linkService.goToDestination(n),!1),(n||n==="")&&F(this,Ui,dh).call(this),r&&(t.title=r)}_bindNamedAction(t,n,r=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(n),!1),r&&(t.title=r),F(this,Ui,dh).call(this)}_bindJSAction(t,n){t.href=this.linkService.getAnchorUrl("");const r=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const a of Object.keys(n.actions)){const o=r.get(a);o&&(t[o]=()=>{var l;return(l=this.linkService.eventBus)==null||l.dispatch("dispatcheventinsandbox",{source:this,detail:{id:n.id,name:a}}),!1})}n.overlaidText&&(t.title=n.overlaidText),t.onclick||(t.onclick=()=>!1),F(this,Ui,dh).call(this)}_bindResetFormAction(t,n){const r=t.onclick;if(r||(t.href=this.linkService.getAnchorUrl("")),F(this,Ui,dh).call(this),!this._fieldObjects){ut('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),r||(t.onclick=()=>!1);return}t.onclick=()=>{var f;r==null||r();const{fields:a,refs:o,include:l}=n,c=[];if(a.length!==0||o.length!==0){const m=new Set(o);for(const p of a){const x=this._fieldObjects[p]||[];for(const{id:g}of x)m.add(g)}for(const p of Object.values(this._fieldObjects))for(const x of p)m.has(x.id)===l&&c.push(x)}else for(const m of Object.values(this._fieldObjects))c.push(...m);const d=this.annotationStorage,h=[];for(const m of c){const{id:p}=m;switch(h.push(p),m.type){case"text":{const g=m.defaultValue||"";d.setValue(p,{value:g});break}case"checkbox":case"radiobutton":{const g=m.defaultValue===m.exportValues;d.setValue(p,{value:g});break}case"combobox":case"listbox":{const g=m.defaultValue||"";d.setValue(p,{value:g});break}default:continue}const x=document.querySelector(`[data-element-id="${p}"]`);if(x){if(!gm.has(x)){ut(`_bindResetFormAction - element not allowed: ${p}`);continue}}else continue;x.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((f=this.linkService.eventBus)==null||f.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:h,name:"ResetForm"}})),!1}}}Ui=new WeakSet,dh=function(){this.container.setAttribute("data-internal-link","")},zH=function(t,n,r="",a=null){t.href=this.linkService.getAnchorUrl(""),n.description?t.title=n.description:r&&(t.title=r),t.onclick=()=>{var o;return(o=this.downloadManager)==null||o.openOrDownloadData(n.content,n.filename,a),!1},F(this,Ui,dh).call(this)},HH=function(t,n,r=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(n),!1),r&&(t.title=r),F(this,Ui,dh).call(this)};class whe extends Ls{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(e),this.container}}class jm extends Ls{render(){return this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&(((t=e.previousSibling)==null?void 0:t.nodeName)==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return Yn.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,n,r,a){n.includes("mouse")?e.addEventListener(n,o=>{var l;(l=this.linkService.eventBus)==null||l.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:a(o),shift:o.shiftKey,modifier:this._getKeyModifier(o)}})}):e.addEventListener(n,o=>{var l;if(n==="blur"){if(!t.focused||!o.relatedTarget)return;t.focused=!1}else if(n==="focus"){if(t.focused)return;t.focused=!0}a&&((l=this.linkService.eventBus)==null||l.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:a(o)}}))})}_setEventListeners(e,t,n,r){var a,o,l;for(const[c,d]of n)(d==="Action"||(a=this.data.actions)!=null&&a[d])&&((d==="Focus"||d==="Blur")&&(t||(t={focused:!1})),this._setEventListener(e,t,c,d,r),d==="Focus"&&!((o=this.data.actions)!=null&&o.Blur)?this._setEventListener(e,t,"blur","Blur",null):d==="Blur"&&!((l=this.data.actions)!=null&&l.Focus)&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":Ge.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:n}=this.data.defaultAppearanceData,r=this.data.defaultAppearanceData.fontSize||yhe,a=e.style;let o;const l=2,c=d=>Math.round(10*d)/10;if(this.data.multiLine){const d=Math.abs(this.data.rect[3]-this.data.rect[1]-l),h=Math.round(d/(bA*r))||1,f=d/h;o=Math.min(r,c(f/bA))}else{const d=Math.abs(this.data.rect[3]-this.data.rect[1]-l);o=Math.min(r,c(d/bA))}a.fontSize=`calc(${o}px * var(--total-scale-factor))`,a.color=Ge.makeHexColor(n[0],n[1],n[2]),this.data.textAlignment!==null&&(a.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class Che extends jm{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,n,r){const a=this.annotationStorage;for(const o of this._getElementsByName(e.name,e.id))o.domElement&&(o.domElement[t]=n),a.setValue(o.id,{[r]:n})}render(){var r,a;const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let n=null;if(this.renderForms){const o=e.getValue(t,{value:this.data.fieldValue});let l=o.value||"";const c=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;c&&l.length>c&&(l=l.slice(0,c));let d=o.formattedValue||((r=this.data.textContent)==null?void 0:r.join(`
`))||null;d&&this.data.comb&&(d=d.replaceAll(/\s+/g,""));const h={userValue:l,formattedValue:d,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=d??l,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type=this.data.password?"password":"text",n.setAttribute("value",d??l),this.data.doNotScroll&&(n.style.overflowX="hidden")),this.data.hasOwnCanvas&&(n.hidden=!0),gm.add(n),this.contentElement=n,n.setAttribute("data-element-id",t),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=0;const{datetimeFormat:f,datetimeType:m,timeStep:p}=this.data,x=!!m&&this.enableScripting;f&&(n.title=f),this._setRequired(n,this.data.required),c&&(n.maxLength=c),n.addEventListener("input",b=>{e.setValue(t,{value:b.target.value}),this.setPropertyOnSiblings(n,"value",b.target.value,"value"),h.formattedValue=null}),n.addEventListener("resetform",b=>{const v=this.data.defaultFieldValue??"";n.value=h.userValue=v,h.formattedValue=null});let g=b=>{const{formattedValue:v}=h;v!=null&&(b.target.value=v),b.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",v=>{var w;if(h.focused)return;const{target:y}=v;if(x&&(y.type=m,p&&(y.step=p)),h.userValue){const S=h.userValue;if(x)if(m==="time"){const j=new Date(S),A=[j.getHours(),j.getMinutes(),j.getSeconds()];y.value=A.map(k=>k.toString().padStart(2,"0")).join(":")}else y.value=new Date(S-vhe).toISOString().split(m==="date"?"T":".",1)[0];else y.value=S}h.lastCommittedValue=y.value,h.commitKey=1,(w=this.data.actions)!=null&&w.Focus||(h.focused=!0)}),n.addEventListener("updatefromsandbox",v=>{this.showElementAndHideCanvas(v.target);const y={value(w){h.userValue=w.detail.value??"",x||e.setValue(t,{value:h.userValue.toString()}),w.target.value=h.userValue},formattedValue(w){const{formattedValue:S}=w.detail;h.formattedValue=S,S!=null&&w.target!==document.activeElement&&(w.target.value=S);const j={formattedValue:S};x&&(j.value=S),e.setValue(t,j)},selRange(w){w.target.setSelectionRange(...w.detail.selRange)},charLimit:w=>{var k;const{charLimit:S}=w.detail,{target:j}=w;if(S===0){j.removeAttribute("maxLength");return}j.setAttribute("maxLength",S);let A=h.userValue;!A||A.length<=S||(A=A.slice(0,S),j.value=h.userValue=A,e.setValue(t,{value:A}),(k=this.linkService.eventBus)==null||k.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:A,willCommit:!0,commitKey:1,selStart:j.selectionStart,selEnd:j.selectionEnd}}))}};this._dispatchEventFromSandbox(y,v)}),n.addEventListener("keydown",v=>{var S;h.commitKey=1;let y=-1;if(v.key==="Escape"?y=0:v.key==="Enter"&&!this.data.multiLine?y=2:v.key==="Tab"&&(h.commitKey=3),y===-1)return;const{value:w}=v.target;h.lastCommittedValue!==w&&(h.lastCommittedValue=w,h.userValue=w,(S=this.linkService.eventBus)==null||S.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:w,willCommit:!0,commitKey:y,selStart:v.target.selectionStart,selEnd:v.target.selectionEnd}}))});const b=g;g=null,n.addEventListener("blur",v=>{var S,j;if(!h.focused||!v.relatedTarget)return;(S=this.data.actions)!=null&&S.Blur||(h.focused=!1);const{target:y}=v;let{value:w}=y;if(x){if(w&&m==="time"){const A=w.split(":").map(k=>parseInt(k,10));w=new Date(2e3,0,1,A[0],A[1],A[2]||0).valueOf(),y.step=""}else w.includes("T")||(w=`${w}T00:00`),w=new Date(w).valueOf();y.type="text"}h.userValue=w,h.lastCommittedValue!==w&&((j=this.linkService.eventBus)==null||j.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:w,willCommit:!0,commitKey:h.commitKey,selStart:v.target.selectionStart,selEnd:v.target.selectionEnd}})),b(v)}),(a=this.data.actions)!=null&&a.Keystroke&&n.addEventListener("beforeinput",v=>{var L;h.lastCommittedValue=null;const{data:y,target:w}=v,{value:S,selectionStart:j,selectionEnd:A}=w;let k=j,_=A;switch(v.inputType){case"deleteWordBackward":{const D=S.substring(0,j).match(/\w*[^\w]*$/);D&&(k-=D[0].length);break}case"deleteWordForward":{const D=S.substring(j).match(/^[^\w]*\w*/);D&&(_+=D[0].length);break}case"deleteContentBackward":j===A&&(k-=1);break;case"deleteContentForward":j===A&&(_+=1);break}v.preventDefault(),(L=this.linkService.eventBus)==null||L.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:S,change:y||"",willCommit:!1,selStart:k,selEnd:_}})}),this._setEventListeners(n,h,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],v=>v.target.value)}if(g&&n.addEventListener("blur",g),this.data.comb){const v=(this.data.rect[2]-this.data.rect[0])/c;n.classList.add("comb"),n.style.letterSpacing=`calc(${v}px * var(--total-scale-factor) - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class She extends jm{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class jhe extends jm{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,n=t.id;let r=e.getValue(n,{value:t.exportValue===t.fieldValue}).value;typeof r=="string"&&(r=r!=="Off",e.setValue(n,{value:r})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const a=document.createElement("input");return gm.add(a),a.setAttribute("data-element-id",n),a.disabled=t.readOnly,this._setRequired(a,this.data.required),a.type="checkbox",a.name=t.fieldName,r&&a.setAttribute("checked",!0),a.setAttribute("exportValue",t.exportValue),a.tabIndex=0,a.addEventListener("change",o=>{const{name:l,checked:c}=o.target;for(const d of this._getElementsByName(l,n)){const h=c&&d.exportValue===t.exportValue;d.domElement&&(d.domElement.checked=h),e.setValue(d.id,{value:h})}e.setValue(n,{value:c})}),a.addEventListener("resetform",o=>{const l=t.defaultFieldValue||"Off";o.target.checked=l===t.exportValue}),this.enableScripting&&this.hasJSActions&&(a.addEventListener("updatefromsandbox",o=>{const l={value(c){c.target.checked=c.detail.value!=="Off",e.setValue(n,{value:c.target.checked})}};this._dispatchEventFromSandbox(l,o)}),this._setEventListeners(a,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)),this._setBackgroundColor(a),this._setDefaultPropertiesFromJS(a),this.container.append(a),this.container}}class VH extends jm{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,n=t.id;let r=e.getValue(n,{value:t.fieldValue===t.buttonValue}).value;if(typeof r=="string"&&(r=r!==t.buttonValue,e.setValue(n,{value:r})),r)for(const o of this._getElementsByName(t.fieldName,n))e.setValue(o.id,{value:!1});const a=document.createElement("input");if(gm.add(a),a.setAttribute("data-element-id",n),a.disabled=t.readOnly,this._setRequired(a,this.data.required),a.type="radio",a.name=t.fieldName,r&&a.setAttribute("checked",!0),a.tabIndex=0,a.addEventListener("change",o=>{const{name:l,checked:c}=o.target;for(const d of this._getElementsByName(l,n))e.setValue(d.id,{value:!1});e.setValue(n,{value:c})}),a.addEventListener("resetform",o=>{const l=t.defaultFieldValue;o.target.checked=l!=null&&l===t.buttonValue}),this.enableScripting&&this.hasJSActions){const o=t.buttonValue;a.addEventListener("updatefromsandbox",l=>{const c={value:d=>{const h=o===d.detail.value;for(const f of this._getElementsByName(d.target.name)){const m=h&&f.id===n;f.domElement&&(f.domElement.checked=m),e.setValue(f.id,{value:m})}}};this._dispatchEventFromSandbox(c,l)}),this._setEventListeners(a,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],l=>l.target.checked)}return this._setBackgroundColor(a),this._setDefaultPropertiesFromJS(a),this.container.append(a),this.container}}class khe extends $M{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",n=>{this._dispatchEventFromSandbox({},n)})),e}}class Nhe extends jm{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,n=e.getValue(t,{value:this.data.fieldValue}),r=document.createElement("select");gm.add(r),r.setAttribute("data-element-id",t),r.disabled=this.data.readOnly,this._setRequired(r,this.data.required),r.name=this.data.fieldName,r.tabIndex=0;let a=this.data.combo&&this.data.options.length>0;this.data.combo||(r.size=this.data.options.length,this.data.multiSelect&&(r.multiple=!0)),r.addEventListener("resetform",h=>{const f=this.data.defaultFieldValue;for(const m of r.options)m.selected=m.value===f});for(const h of this.data.options){const f=document.createElement("option");f.textContent=h.displayValue,f.value=h.exportValue,n.value.includes(h.exportValue)&&(f.setAttribute("selected",!0),a=!1),r.append(f)}let o=null;if(a){const h=document.createElement("option");h.value=" ",h.setAttribute("hidden",!0),h.setAttribute("selected",!0),r.prepend(h),o=()=>{h.remove(),r.removeEventListener("input",o),o=null},r.addEventListener("input",o)}const l=h=>{const f=h?"value":"textContent",{options:m,multiple:p}=r;return p?Array.prototype.filter.call(m,x=>x.selected).map(x=>x[f]):m.selectedIndex===-1?null:m[m.selectedIndex][f]};let c=l(!1);const d=h=>{const f=h.target.options;return Array.prototype.map.call(f,m=>({displayValue:m.textContent,exportValue:m.value}))};return this.enableScripting&&this.hasJSActions?(r.addEventListener("updatefromsandbox",h=>{const f={value(m){o==null||o();const p=m.detail.value,x=new Set(Array.isArray(p)?p:[p]);for(const g of r.options)g.selected=x.has(g.value);e.setValue(t,{value:l(!0)}),c=l(!1)},multipleSelection(m){r.multiple=!0},remove(m){const p=r.options,x=m.detail.remove;p[x].selected=!1,r.remove(x),p.length>0&&Array.prototype.findIndex.call(p,b=>b.selected)===-1&&(p[0].selected=!0),e.setValue(t,{value:l(!0),items:d(m)}),c=l(!1)},clear(m){for(;r.length!==0;)r.remove(0);e.setValue(t,{value:null,items:[]}),c=l(!1)},insert(m){const{index:p,displayValue:x,exportValue:g}=m.detail.insert,b=r.children[p],v=document.createElement("option");v.textContent=x,v.value=g,b?b.before(v):r.append(v),e.setValue(t,{value:l(!0),items:d(m)}),c=l(!1)},items(m){const{items:p}=m.detail;for(;r.length!==0;)r.remove(0);for(const x of p){const{displayValue:g,exportValue:b}=x,v=document.createElement("option");v.textContent=g,v.value=b,r.append(v)}r.options.length>0&&(r.options[0].selected=!0),e.setValue(t,{value:l(!0),items:d(m)}),c=l(!1)},indices(m){const p=new Set(m.detail.indices);for(const x of m.target.options)x.selected=p.has(x.index);e.setValue(t,{value:l(!0)}),c=l(!1)},editable(m){m.target.disabled=!m.detail.editable}};this._dispatchEventFromSandbox(f,h)}),r.addEventListener("input",h=>{var p;const f=l(!0),m=l(!1);e.setValue(t,{value:f}),h.preventDefault(),(p=this.linkService.eventBus)==null||p.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:c,change:m,changeEx:f,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(r,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],h=>h.target.value)):r.addEventListener("input",function(h){e.setValue(t,{value:l(!0)})}),this.data.combo&&this._setTextStyle(r),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}var y0,C2;class w2 extends Ls{constructor(t){const{data:n,elements:r,parent:a}=t,o=!!a._commentManager;super(t,{isRenderable:!o&&Ls._hasPopupData(n)});E(this,y0);if(this.elements=r,o&&Ls._hasPopupData(n)){const l=this.popup=F(this,y0,C2).call(this);for(const c of r)c.popup=l}else this.popup=null}render(){const{container:t}=this;t.classList.add("popupAnnotation"),t.role="comment";const n=this.popup=F(this,y0,C2).call(this),r=[];for(const a of this.elements)a.popup=n,a.container.ariaHasPopup="dialog",r.push(a.data.id),a.addHighlightArea();return this.container.setAttribute("aria-controls",r.map(a=>`${fp}${a}`).join(",")),this.container}}y0=new WeakSet,C2=function(){return new Ahe({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})};var wi,Kd,ij,aj,Og,Fg,zs,el,Xd,bf,Bg,$g,tl,Ci,hc,fc,Hs,mc,Qd,v0,pc,Ug,wf,Zd,Cn,Jd,Nt,eC,S2,j2,k2,tC,N2,WH,qH,GH,YH,sC,nC,A2;class Ahe{constructor({container:e,color:t,elements:n,titleObj:r,modificationDate:a,contentsObj:o,richText:l,parent:c,rect:d,parentRect:h,open:f,commentManager:m=null}){E(this,Nt);E(this,wi,null);E(this,Kd,F(this,Nt,GH).bind(this));E(this,ij,F(this,Nt,A2).bind(this));E(this,aj,F(this,Nt,nC).bind(this));E(this,Og,F(this,Nt,sC).bind(this));E(this,Fg,null);E(this,zs,null);E(this,el,null);E(this,Xd,null);E(this,bf,null);E(this,Bg,null);E(this,$g,null);E(this,tl,!1);E(this,Ci,null);E(this,hc,null);E(this,fc,null);E(this,Hs,null);E(this,mc,null);E(this,Qd,null);E(this,v0,null);E(this,pc,null);E(this,Ug,null);E(this,wf,null);E(this,Zd,!1);E(this,Cn,null);E(this,Jd,null);N(this,zs,e),N(this,Ug,r),N(this,el,o),N(this,pc,l),N(this,Bg,c),N(this,Fg,t),N(this,v0,d),N(this,$g,h),N(this,bf,n),N(this,wi,m),N(this,Cn,n[0]),N(this,Xd,ES.toDateObject(a)),this.trigger=n.flatMap(p=>p.getElementsToTriggerPopup()),m||(F(this,Nt,eC).call(this),u(this,zs).hidden=!0,f&&F(this,Nt,sC).call(this))}renderCommentButton(){if(u(this,Hs)){u(this,Hs).parentNode||u(this,Cn).container.after(u(this,Hs));return}if(u(this,mc)||F(this,Nt,S2).call(this),!u(this,mc))return;const{signal:e}=N(this,hc,new AbortController),t=u(this,Cn).hasOwnCommentButton,n=()=>{u(this,wi).toggleCommentPopup(this,!0,void 0,!t)},r=()=>{u(this,wi).toggleCommentPopup(this,!1,!0,!t)},a=()=>{u(this,wi).toggleCommentPopup(this,!1,!1)};if(t){N(this,Hs,u(this,Cn).container);for(const o of this.trigger)o.ariaHasPopup="dialog",o.ariaControls="commentPopup",o.addEventListener("keydown",u(this,Kd),{signal:e}),o.addEventListener("click",n,{signal:e}),o.addEventListener("pointerenter",r,{signal:e}),o.addEventListener("pointerleave",a,{signal:e}),o.classList.add("popupTriggerArea")}else{const o=N(this,Hs,document.createElement("button"));o.className="annotationCommentButton";const l=u(this,Cn).container;o.style.zIndex=l.style.zIndex+1,o.tabIndex=0,o.ariaHasPopup="dialog",o.ariaControls="commentPopup",o.setAttribute("data-l10n-id","pdfjs-show-comment-button"),F(this,Nt,k2).call(this),F(this,Nt,j2).call(this),o.addEventListener("keydown",u(this,Kd),{signal:e}),o.addEventListener("click",n,{signal:e}),o.addEventListener("pointerenter",r,{signal:e}),o.addEventListener("pointerleave",a,{signal:e}),l.after(o)}}get commentButtonColor(){const{color:e,opacity:t}=u(this,Cn).commentData;return e?u(this,Bg)._commentManager.makeCommentColor(e,t):null}focusCommentButton(){setTimeout(()=>{var e;(e=u(this,Hs))==null||e.focus()},0)}getData(){const{richText:e,color:t,opacity:n,creationDate:r,modificationDate:a}=u(this,Cn).commentData;return{contentsObj:{str:this.comment},richText:e,color:t,opacity:n,creationDate:r,modificationDate:a}}get elementBeforePopup(){return u(this,Hs)}get comment(){return u(this,Jd)||N(this,Jd,u(this,Cn).commentText),u(this,Jd)}set comment(e){e!==this.comment&&(u(this,Cn).commentText=N(this,Jd,e))}focus(){var e;(e=u(this,Cn).container)==null||e.focus()}get parentBoundingClientRect(){return u(this,Cn).layer.getBoundingClientRect()}setCommentButtonStates({selected:e,hasPopup:t}){u(this,Hs)&&(u(this,Hs).classList.toggle("selected",e),u(this,Hs).ariaExpanded=t)}setSelectedCommentButton(e){u(this,Hs).classList.toggle("selected",e)}get commentPopupPosition(){if(u(this,Qd))return u(this,Qd);const{x:e,y:t,height:n}=u(this,Hs).getBoundingClientRect(),{x:r,y:a,width:o,height:l}=u(this,Cn).layer.getBoundingClientRect();return[(e-r)/o,(t+n-a)/l]}set commentPopupPosition(e){N(this,Qd,e)}hasDefaultPopupPosition(){return u(this,Qd)===null}get commentButtonPosition(){return u(this,mc)}get commentButtonWidth(){return u(this,Hs).getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(e){const[t,n]=u(this,Qd)||this.commentButtonPosition.map(d=>d/100),r=this.parentBoundingClientRect,{x:a,y:o,width:l,height:c}=r;u(this,wi).showDialog(null,this,a+t*l,o+n*c,{...e,parentDimensions:r})}render(){var n,r;if(u(this,Ci))return;const e=N(this,Ci,document.createElement("div"));if(e.className="popup",u(this,Fg)){const a=e.style.outlineColor=Ge.makeHexColor(...u(this,Fg));e.style.backgroundColor=`color-mix(in srgb, ${a} 30%, white)`}const t=document.createElement("span");if(t.className="header",(n=u(this,Ug))!=null&&n.str){const a=document.createElement("span");a.className="title",t.append(a),{dir:a.dir,str:a.textContent}=u(this,Ug)}if(e.append(t),u(this,Xd)){const a=document.createElement("time");a.className="popupDate",a.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),a.setAttribute("data-l10n-args",JSON.stringify({dateObj:u(this,Xd).valueOf()})),a.dateTime=u(this,Xd).toISOString(),t.append(a)}Rz({html:u(this,Nt,tC)||u(this,el).str,dir:(r=u(this,el))==null?void 0:r.dir,className:"popupContent"},e),u(this,zs).append(e)}updateEdited({rect:e,popup:t,deleted:n}){var r;if(u(this,wi)){n?(this.remove(),N(this,Jd,null)):t&&(t.deleted?this.remove():(F(this,Nt,k2).call(this),N(this,Jd,t.text))),e&&(N(this,mc,null),F(this,Nt,S2).call(this),F(this,Nt,j2).call(this));return}if(n||t!=null&&t.deleted){this.remove();return}F(this,Nt,eC).call(this),u(this,wf)||N(this,wf,{contentsObj:u(this,el),richText:u(this,pc)}),e&&N(this,fc,null),t&&t.text&&(N(this,pc,F(this,Nt,qH).call(this,t.text)),N(this,Xd,ES.toDateObject(t.date)),N(this,el,null)),(r=u(this,Ci))==null||r.remove(),N(this,Ci,null)}resetEdited(){var e;u(this,wf)&&({contentsObj:Fs(this,el)._,richText:Fs(this,pc)._}=u(this,wf),N(this,wf,null),(e=u(this,Ci))==null||e.remove(),N(this,Ci,null),N(this,fc,null))}remove(){var e,t,n;if((e=u(this,hc))==null||e.abort(),N(this,hc,null),(t=u(this,Ci))==null||t.remove(),N(this,Ci,null),N(this,Zd,!1),N(this,tl,!1),(n=u(this,Hs))==null||n.remove(),N(this,Hs,null),this.trigger)for(const r of this.trigger)r.classList.remove("popupTriggerArea")}forceHide(){N(this,Zd,this.isVisible),u(this,Zd)&&(u(this,zs).hidden=!0)}maybeShow(){u(this,wi)||(F(this,Nt,eC).call(this),u(this,Zd)&&(u(this,Ci)||F(this,Nt,nC).call(this),N(this,Zd,!1),u(this,zs).hidden=!1))}get isVisible(){return u(this,wi)?!1:u(this,zs).hidden===!1}}wi=new WeakMap,Kd=new WeakMap,ij=new WeakMap,aj=new WeakMap,Og=new WeakMap,Fg=new WeakMap,zs=new WeakMap,el=new WeakMap,Xd=new WeakMap,bf=new WeakMap,Bg=new WeakMap,$g=new WeakMap,tl=new WeakMap,Ci=new WeakMap,hc=new WeakMap,fc=new WeakMap,Hs=new WeakMap,mc=new WeakMap,Qd=new WeakMap,v0=new WeakMap,pc=new WeakMap,Ug=new WeakMap,wf=new WeakMap,Zd=new WeakMap,Cn=new WeakMap,Jd=new WeakMap,Nt=new WeakSet,eC=function(){var t;if(u(this,hc))return;N(this,hc,new AbortController);const{signal:e}=u(this,hc);for(const n of this.trigger)n.addEventListener("click",u(this,Og),{signal:e}),n.addEventListener("pointerenter",u(this,aj),{signal:e}),n.addEventListener("pointerleave",u(this,ij),{signal:e}),n.classList.add("popupTriggerArea");for(const n of u(this,bf))(t=n.container)==null||t.addEventListener("keydown",u(this,Kd),{signal:e})},S2=function(){const e=u(this,bf).find(t=>t.hasCommentButton);e&&N(this,mc,e._normalizePoint(e.commentButtonPosition))},j2=function(){if(u(this,Cn).extraPopupElement&&!u(this,Cn).editor)return;u(this,Hs)||this.renderCommentButton();const[e,t]=u(this,mc),{style:n}=u(this,Hs);n.left=`calc(${e}%)`,n.top=`calc(${t}% - var(--comment-button-dim))`},k2=function(){u(this,Cn).extraPopupElement||(u(this,Hs)||this.renderCommentButton(),u(this,Hs).style.backgroundColor=this.commentButtonColor||"")},tC=function(){const e=u(this,pc),t=u(this,el);return e!=null&&e.str&&(!(t!=null&&t.str)||t.str===e.str)&&u(this,pc).html||null},N2=function(){var e,t,n;return((n=(t=(e=u(this,Nt,tC))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:n.fontSize)||0},WH=function(){var e,t,n;return((n=(t=(e=u(this,Nt,tC))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:n.color)||null},qH=function(e){const t=[],n={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},r={style:{color:u(this,Nt,WH),fontSize:u(this,Nt,N2)?`calc(${u(this,Nt,N2)}px * var(--total-scale-factor))`:""}};for(const a of e.split(`
`))t.push({name:"span",value:a,attributes:r});return n},GH=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&u(this,tl))&&F(this,Nt,sC).call(this)},YH=function(){if(u(this,fc)!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:n,pageX:r,pageY:a}}}=u(this,Bg);let o=!!u(this,$g),l=o?u(this,$g):u(this,v0);for(const x of u(this,bf))if(!l||Ge.intersect(x.data.rect,l)!==null){l=x.data.rect,o=!0;break}const c=Ge.normalizeRect([l[0],e[3]-l[1]+e[1],l[2],e[3]-l[3]+e[1]]),h=o?l[2]-l[0]+5:0,f=c[0]+h,m=c[1];N(this,fc,[100*(f-r)/t,100*(m-a)/n]);const{style:p}=u(this,zs);p.left=`${u(this,fc)[0]}%`,p.top=`${u(this,fc)[1]}%`},sC=function(){if(u(this,wi)){u(this,wi).toggleCommentPopup(this,!1);return}N(this,tl,!u(this,tl)),u(this,tl)?(F(this,Nt,nC).call(this),u(this,zs).addEventListener("click",u(this,Og)),u(this,zs).addEventListener("keydown",u(this,Kd))):(F(this,Nt,A2).call(this),u(this,zs).removeEventListener("click",u(this,Og)),u(this,zs).removeEventListener("keydown",u(this,Kd)))},nC=function(){u(this,Ci)||this.render(),this.isVisible?u(this,tl)&&u(this,zs).classList.add("focused"):(F(this,Nt,YH).call(this),u(this,zs).hidden=!1,u(this,zs).style.zIndex=parseInt(u(this,zs).style.zIndex)+1e3)},A2=function(){u(this,zs).classList.remove("focused"),!(u(this,tl)||!this.isVisible)&&(u(this,zs).hidden=!0,u(this,zs).style.zIndex=parseInt(u(this,zs).style.zIndex)-1e3)};class KH extends Ls{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=pt.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=this.contentElement=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const n=document.createElement("span");n.textContent=t,e.append(n)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}var b0;class _he extends Ls{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});E(this,b0,null)}render(){this.container.classList.add("lineAnnotation");const{data:t,width:n,height:r}=this,a=this.svgFactory.create(n,r,!0),o=N(this,b0,this.svgFactory.createElement("svg:line"));return o.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),o.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),o.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),o.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),o.setAttribute("stroke-width",t.borderStyle.width||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),a.append(o),this.container.append(a),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return u(this,b0)}addHighlightArea(){this.container.classList.add("highlightArea")}}b0=new WeakMap;var w0;class The extends Ls{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});E(this,w0,null)}render(){this.container.classList.add("squareAnnotation");const{data:t,width:n,height:r}=this,a=this.svgFactory.create(n,r,!0),o=t.borderStyle.width,l=N(this,w0,this.svgFactory.createElement("svg:rect"));return l.setAttribute("x",o/2),l.setAttribute("y",o/2),l.setAttribute("width",n-o),l.setAttribute("height",r-o),l.setAttribute("stroke-width",o||1),l.setAttribute("stroke","transparent"),l.setAttribute("fill","transparent"),a.append(l),this.container.append(a),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return u(this,w0)}addHighlightArea(){this.container.classList.add("highlightArea")}}w0=new WeakMap;var C0;class Ehe extends Ls{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});E(this,C0,null)}render(){this.container.classList.add("circleAnnotation");const{data:t,width:n,height:r}=this,a=this.svgFactory.create(n,r,!0),o=t.borderStyle.width,l=N(this,C0,this.svgFactory.createElement("svg:ellipse"));return l.setAttribute("cx",n/2),l.setAttribute("cy",r/2),l.setAttribute("rx",n/2-o/2),l.setAttribute("ry",r/2-o/2),l.setAttribute("stroke-width",o||1),l.setAttribute("stroke","transparent"),l.setAttribute("fill","transparent"),a.append(l),this.container.append(a),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return u(this,C0)}addHighlightArea(){this.container.classList.add("highlightArea")}}C0=new WeakMap;var S0;class XH extends Ls{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});E(this,S0,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:n,borderStyle:r,popupRef:a},width:o,height:l}=this;if(!n)return this.container;const c=this.svgFactory.create(o,l,!0);let d=[];for(let f=0,m=n.length;f<m;f+=2){const p=n[f]-t[0],x=t[3]-n[f+1];d.push(`${p},${x}`)}d=d.join(" ");const h=N(this,S0,this.svgFactory.createElement(this.svgElementName));return h.setAttribute("points",d),h.setAttribute("stroke-width",r.width||1),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),c.append(h),this.container.append(c),!a&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return u(this,S0)}addHighlightArea(){this.container.classList.add("highlightArea")}}S0=new WeakMap;class Phe extends XH{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Mhe extends Ls{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}}var j0,Cf,k0,_2;class UM extends Ls{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});E(this,k0);E(this,j0,null);E(this,Cf,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?pt.HIGHLIGHT:pt.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:n,inkLists:r,borderStyle:a,popupRef:o}}=this,{transform:l,width:c,height:d}=F(this,k0,_2).call(this,n,t),h=this.svgFactory.create(c,d,!0),f=N(this,j0,this.svgFactory.createElement("svg:g"));h.append(f),f.setAttribute("stroke-width",a.width||1),f.setAttribute("stroke-linecap","round"),f.setAttribute("stroke-linejoin","round"),f.setAttribute("stroke-miterlimit",10),f.setAttribute("stroke","transparent"),f.setAttribute("fill","transparent"),f.setAttribute("transform",l);for(let m=0,p=r.length;m<p;m++){const x=this.svgFactory.createElement(this.svgElementName);u(this,Cf).push(x),x.setAttribute("points",r[m].join(",")),f.append(x)}return!o&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(h),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:n,points:r,rect:a}=t,o=u(this,j0);if(n>=0&&o.setAttribute("stroke-width",n||1),r)for(let l=0,c=u(this,Cf).length;l<c;l++)u(this,Cf)[l].setAttribute("points",r[l].join(","));if(a){const{transform:l,width:c,height:d}=F(this,k0,_2).call(this,this.data.rotation,a);o.parentElement.setAttribute("viewBox",`0 0 ${c} ${d}`),o.setAttribute("transform",l)}}getElementsToTriggerPopup(){return u(this,Cf)}addHighlightArea(){this.container.classList.add("highlightArea")}}j0=new WeakMap,Cf=new WeakMap,k0=new WeakSet,_2=function(t,n){switch(t){case 90:return{transform:`rotate(90) translate(${-n[0]},${n[1]}) scale(1,-1)`,width:n[3]-n[1],height:n[2]-n[0]};case 180:return{transform:`rotate(180) translate(${-n[2]},${n[1]}) scale(1,-1)`,width:n[2]-n[0],height:n[3]-n[1]};case 270:return{transform:`rotate(270) translate(${-n[2]},${n[3]}) scale(1,-1)`,width:n[3]-n[1],height:n[2]-n[0]};default:return{transform:`translate(${-n[0]},${n[3]}) scale(1,-1)`,width:n[2]-n[0],height:n[3]-n[1]}}};class QH extends Ls{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=pt.HIGHLIGHT}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),e){const n=document.createElement("mark");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class Ihe extends Ls{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("underlineAnnotation"),e){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class Rhe extends Ls{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("squigglyAnnotation"),e){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class Dhe extends Ls{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("strikeoutAnnotation"),e){const n=document.createElement("s");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class ZH extends Ls{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=pt.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}var N0,A0,T2;class Lhe extends Ls{constructor(t){var r;super(t,{isRenderable:!0});E(this,A0);E(this,N0,null);const{file:n}=this.data;this.filename=n.filename,this.content=n.content,(r=this.linkService.eventBus)==null||r.dispatch("fileattachmentannotation",{source:this,...n})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:n}=this;let r;n.hasAppearance||n.fillAlpha===0?r=document.createElement("div"):(r=document.createElement("img"),r.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(n.name)?"paperclip":"pushpin"}.svg`,n.fillAlpha&&n.fillAlpha<1&&(r.style=`filter: opacity(${Math.round(n.fillAlpha*100)}%);`)),r.addEventListener("dblclick",F(this,A0,T2).bind(this)),N(this,N0,r);const{isMac:a}=Yn.platform;return t.addEventListener("keydown",o=>{o.key==="Enter"&&(a?o.metaKey:o.ctrlKey)&&F(this,A0,T2).call(this)}),!n.popupRef&&this.hasPopupData?(this.hasOwnCommentButton=!0,this._createPopup()):r.classList.add("popupTriggerArea"),t.append(r),t}getElementsToTriggerPopup(){return u(this,N0)}addHighlightArea(){this.container.classList.add("highlightArea")}}N0=new WeakMap,A0=new WeakSet,T2=function(){var t;(t=this.downloadManager)==null||t.openOrDownloadData(this.content,this.filename)};var Sf,jf,zg,eu,_0,kf,Si,T0,Tc,rC,P2;const lI=class lI{constructor({div:e,accessibilityManager:t,annotationCanvasMap:n,annotationEditorUIManager:r,page:a,viewport:o,structTreeLayer:l,commentManager:c,linkService:d,annotationStorage:h}){E(this,Tc);E(this,Sf,null);E(this,jf,null);E(this,zg,null);E(this,eu,new Map);E(this,_0,null);E(this,kf,null);E(this,Si,[]);E(this,T0,!1);this.div=e,N(this,Sf,t),N(this,jf,n),N(this,_0,l||null),N(this,kf,d||null),N(this,zg,h||new OM),this.page=a,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=r,this._commentManager=c||null}hasEditableAnnotations(){return u(this,eu).size>0}async render(e){var l;const{annotations:t}=e,n=this.div;mm(n,this.viewport);const r=new Map,a=[],o={data:null,layer:n,linkService:u(this,kf),downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new FS,annotationStorage:u(this,zg),enableComment:e.enableComment===!0,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const c of t){if(c.noHTML)continue;const d=c.annotationType===sn.POPUP;if(d){const m=r.get(c.id);if(!m)continue;if(!this._commentManager){a.push(c);continue}o.elements=m}else if(c.rect[2]===c.rect[0]||c.rect[3]===c.rect[1])continue;o.data=c;const h=_A.create(o);if(!h.isRenderable)continue;if(!d&&(u(this,Si).push(h),c.popupRef)){const m=r.get(c.popupRef);m?m.push(h):r.set(c.popupRef,[h])}const f=h.render();c.hidden&&(f.style.visibility="hidden"),h._isEditable&&(u(this,eu).set(h.data.id,h),(l=this._annotationEditorUIManager)==null||l.renderAnnotationElement(h))}await F(this,Tc,rC).call(this);for(const c of a){const d=o.elements=r.get(c.id);o.data=c;const h=_A.create(o);if(!h.isRenderable)continue;const f=h.render();h.contentElement.id=`${fp}${c.id}`,c.hidden&&(f.style.visibility="hidden"),d.at(-1).container.after(f)}F(this,Tc,P2).call(this)}async addLinkAnnotations(e){const t={data:null,layer:this.div,linkService:u(this,kf),svgFactory:new FS,parent:this};for(const n of e){n.borderStyle||(n.borderStyle=lI._defaultBorderStyle),t.data=n;const r=_A.create(t);r.isRenderable&&(r.render(),r.contentElement.id=`${fp}${n.id}`,u(this,Si).push(r))}await F(this,Tc,rC).call(this)}update({viewport:e}){const t=this.div;this.viewport=e,mm(t,{rotation:e.rotation}),F(this,Tc,P2).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(u(this,eu).values())}getEditableAnnotation(e){return u(this,eu).get(e)}addFakeAnnotation(e){const{div:t}=this,{id:n,rotation:r}=e,a=new bhe({data:{id:n,rect:e.getPDFRect(),rotation:r},editor:e,layer:t,parent:this,enableComment:!!this._commentManager,linkService:u(this,kf),annotationStorage:u(this,zg)});return a.render(),a.contentElement.id=`${fp}${n}`,a.createOrUpdatePopup(),u(this,Si).push(a),a}removeAnnotation(e){var r;const t=u(this,Si).findIndex(a=>a.data.id===e);if(t<0)return;const[n]=u(this,Si).splice(t,1);(r=u(this,Sf))==null||r.removePointerInTextLayer(n.contentElement)}updateFakeAnnotations(e){if(e.length!==0){for(const t of e)t.updateFakeAnnotationElement(this);F(this,Tc,rC).call(this)}}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}static get _defaultBorderStyle(){return bt(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:Vm.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}};Sf=new WeakMap,jf=new WeakMap,zg=new WeakMap,eu=new WeakMap,_0=new WeakMap,kf=new WeakMap,Si=new WeakMap,T0=new WeakMap,Tc=new WeakSet,rC=async function(){var n,r,a;if(u(this,Si).length===0)return;this.div.replaceChildren();const e=[];if(!u(this,T0)){N(this,T0,!0);for(const{contentElement:o,data:{id:l}}of u(this,Si)){const c=o.id=`${fp}${l}`;e.push((n=u(this,_0))==null?void 0:n.getAriaAttributes(c).then(d=>{if(d)for(const[h,f]of d)o.setAttribute(h,f)}))}}u(this,Si).sort(({data:{rect:[o,l,c,d]}},{data:{rect:[h,f,m,p]}})=>{if(o===c&&l===d)return 1;if(h===m&&f===p)return-1;const x=d,g=l,b=(l+d)/2,v=p,y=f,w=(f+p)/2;if(b>=v&&w<=g)return-1;if(w>=x&&b<=y)return 1;const S=(o+c)/2,j=(h+m)/2;return S-j});const t=document.createDocumentFragment();for(const o of u(this,Si))t.append(o.container),this._commentManager?(a=((r=o.extraPopupElement)==null?void 0:r.popup)||o.popup)==null||a.renderCommentButton():o.extraPopupElement&&t.append(o.extraPopupElement.render());if(this.div.append(t),await Promise.all(e),u(this,Sf))for(const o of u(this,Si))u(this,Sf).addPointerInTextLayer(o.contentElement,!1)},P2=function(){var t;if(!u(this,jf))return;const e=this.div;for(const[n,r]of u(this,jf)){const a=e.querySelector(`[data-annotation-id="${n}"]`);if(!a)continue;r.className="annotationContent";const{firstChild:o}=a;o?o.nodeName==="CANVAS"?o.replaceWith(r):o.classList.contains("annotationContent")?o.after(r):o.before(r):a.append(r);const l=u(this,eu).get(n);l&&(l._hasNoCanvas?((t=this._annotationEditorUIManager)==null||t.setMissingCanvas(n,a.id,r),l._hasNoCanvas=!1):l.canvas=r)}u(this,jf).clear()};let E2=lI;const h1=/\r\n?|\n/g;var ji,E0,Nf,ki,ln,JH,eV,tV,iC,Ec,aC,oC,sV,I2,nV;const bs=class bs extends ms{constructor(t){super({...t,name:"freeTextEditor"});E(this,ln);E(this,ji,"");E(this,E0,`${this.id}-editor`);E(this,Nf,null);E(this,ki);Ce(this,"_colorPicker",null);this.color=t.color||bs._defaultColor||ms._defaultLineColor,N(this,ki,t.fontSize||bs._defaultFontSize),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert"),this.canAddComment=!1}static get _keyboardManager(){const t=bs.prototype,n=o=>o.isEmpty(),r=pm.TRANSLATE_SMALL,a=pm.TRANSLATE_BIG;return bt(this,"_keyboardManager",new mw([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-r,0],checker:n}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-a,0],checker:n}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[r,0],checker:n}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[a,0],checker:n}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-r],checker:n}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-a],checker:n}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,r],checker:n}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,a],checker:n}]]))}static initialize(t,n){ms.initialize(t,n);const r=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(r.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,n){switch(t){case Lt.FREETEXT_SIZE:bs._defaultFontSize=n;break;case Lt.FREETEXT_COLOR:bs._defaultColor=n;break}}updateParams(t,n){switch(t){case Lt.FREETEXT_SIZE:F(this,ln,JH).call(this,n);break;case Lt.FREETEXT_COLOR:F(this,ln,eV).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[Lt.FREETEXT_SIZE,bs._defaultFontSize],[Lt.FREETEXT_COLOR,bs._defaultColor||ms._defaultLineColor]]}get propertiesToUpdate(){return[[Lt.FREETEXT_SIZE,u(this,ki)],[Lt.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||(this._colorPicker=new OS(this)),[["colorPicker",this._colorPicker]]}get colorType(){return Lt.FREETEXT_COLOR}onUpdatedColor(){var t;this.editorDiv.style.color=this.color,(t=this._colorPicker)==null||t.update(this.color),super.onUpdatedColor()}_translateEmpty(t,n){this._uiManager.translateSelectedEditors(t,n,!0)}getInitialTranslation(){const t=this.parentScale;return[-bs._internalPadding*t,-(bs._internalPadding+u(this,ki))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),N(this,Nf,new AbortController);const t=this._uiManager.combinedSignal(u(this,Nf));return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){var t;return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",u(this,E0)),this._isDraggable=!0,(t=u(this,Nf))==null||t.abort(),N(this,Nf,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){var n;this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),(n=this._initialOptions)!=null&&n.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=u(this,ji),n=N(this,ji,F(this,ln,tV).call(this).trimEnd());if(t===n)return;const r=a=>{if(N(this,ji,a),!a){this.remove();return}F(this,ln,oC).call(this),this._uiManager.rebuild(this),F(this,ln,iC).call(this)};this.addCommands({cmd:()=>{r(n)},undo:()=>{r(t)},mustExec:!1}),F(this,ln,iC).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){bs._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,n;(this._isCopy||this.annotationElementId)&&(t=this.x,n=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",u(this,E0)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:r}=this.editorDiv;if(r.fontSize=`calc(${u(this,ki)}px * var(--total-scale-factor))`,r.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[a,o]=this.parentDimensions;if(this.annotationElementId){const{position:l}=this._initialData;let[c,d]=this.getInitialTranslation();[c,d]=this.pageTranslationToScreen(c,d);const[h,f]=this.pageDimensions,[m,p]=this.pageTranslation;let x,g;switch(this.rotation){case 0:x=t+(l[0]-m)/h,g=n+this.height-(l[1]-p)/f;break;case 90:x=t+(l[0]-m)/h,g=n-(l[1]-p)/f,[c,d]=[d,-c];break;case 180:x=t-this.width+(l[0]-m)/h,g=n-(l[1]-p)/f,[c,d]=[-c,-d];break;case 270:x=t+(l[0]-m-this.height*f)/h,g=n+(l[1]-p-this.width*h)/f,[c,d]=[-d,c];break}this.setAt(x*a,g*o,c,d)}else this._moveAfterPaste(t,n);F(this,ln,oC).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var x,g,b;const n=t.clipboardData||window.clipboardData,{types:r}=n;if(r.length===1&&r[0]==="text/plain")return;t.preventDefault();const a=F(x=bs,Ec,I2).call(x,n.getData("text")||"").replaceAll(h1,`
`);if(!a)return;const o=window.getSelection();if(!o.rangeCount)return;this.editorDiv.normalize(),o.deleteFromDocument();const l=o.getRangeAt(0);if(!a.includes(`
`)){l.insertNode(document.createTextNode(a)),this.editorDiv.normalize(),o.collapseToStart();return}const{startContainer:c,startOffset:d}=l,h=[],f=[];if(c.nodeType===Node.TEXT_NODE){const v=c.parentElement;if(f.push(c.nodeValue.slice(d).replaceAll(h1,"")),v!==this.editorDiv){let y=h;for(const w of this.editorDiv.childNodes){if(w===v){y=f;continue}y.push(F(g=bs,Ec,aC).call(g,w))}}h.push(c.nodeValue.slice(0,d).replaceAll(h1,""))}else if(c===this.editorDiv){let v=h,y=0;for(const w of this.editorDiv.childNodes)y++===d&&(v=f),v.push(F(b=bs,Ec,aC).call(b,w))}N(this,ji,`${h.join(`
`)}${a}${f.join(`
`)}`),F(this,ln,oC).call(this);const m=new Range;let p=Math.sumPrecise(h.map(v=>v.length));for(const{firstChild:v}of this.editorDiv.childNodes)if(v.nodeType===Node.TEXT_NODE){const y=v.nodeValue.length;if(p<=y){m.setStart(v,p),m.setEnd(v,p);break}p-=y}o.removeAllRanges(),o.addRange(m)}get contentDiv(){return this.editorDiv}getPDFRect(){const t=bs._internalPadding*this.parentScale;return this.getRect(t,t)}static async deserialize(t,n,r){var l;let a=null;if(t instanceof KH){const{data:{defaultAppearanceData:{fontSize:c,fontColor:d},rect:h,rotation:f,id:m,popupRef:p,richText:x,contentsObj:g,creationDate:b,modificationDate:v},textContent:y,textPosition:w,parent:{page:{pageNumber:S}}}=t;if(!y||y.length===0)return null;a=t={annotationType:pt.FREETEXT,color:Array.from(d),fontSize:c,value:y.join(`
`),position:w,pageIndex:S-1,rect:h.slice(0),rotation:f,annotationElementId:m,id:m,deleted:!1,popupRef:p,comment:(g==null?void 0:g.str)||null,richText:x,creationDate:b,modificationDate:v}}const o=await super.deserialize(t,n,r);return N(o,ki,t.fontSize),o.color=Ge.makeHexColor(...t.color),N(o,ji,F(l=bs,Ec,I2).call(l,t.value)),o._initialData=a,t.comment&&o.setCommentData(t),o}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const n=ms._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),r=Object.assign(super.serialize(t),{color:n,fontSize:u(this,ki),value:F(this,ln,sV).call(this)});return this.addComment(r),t?(r.isCopy=!0,r):this.annotationElementId&&!F(this,ln,nV).call(this,r)?null:(r.id=this.annotationElementId,r)}renderAnnotationElement(t){const n=super.renderAnnotationElement(t);if(!n)return null;const{style:r}=n;r.fontSize=`calc(${u(this,ki)}px * var(--total-scale-factor))`,r.color=this.color,n.replaceChildren();for(const a of u(this,ji).split(`
`)){const o=document.createElement("div");o.append(a?document.createTextNode(a):document.createElement("br")),n.append(o)}return t.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:u(this,ji)}}),n}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}};ji=new WeakMap,E0=new WeakMap,Nf=new WeakMap,ki=new WeakMap,ln=new WeakSet,JH=function(t){const n=a=>{this.editorDiv.style.fontSize=`calc(${a}px * var(--total-scale-factor))`,this.translate(0,-(a-u(this,ki))*this.parentScale),N(this,ki,a),F(this,ln,iC).call(this)},r=u(this,ki);this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Lt.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},eV=function(t){const n=a=>{this.color=a,this.onUpdatedColor()},r=this.color;this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Lt.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},tV=function(){var r;const t=[];this.editorDiv.normalize();let n=null;for(const a of this.editorDiv.childNodes)(n==null?void 0:n.nodeType)===Node.TEXT_NODE&&a.nodeName==="BR"||(t.push(F(r=bs,Ec,aC).call(r,a)),n=a);return t.join(`
`)},iC=function(){const[t,n]=this.parentDimensions;let r;if(this.isAttachedToDOM)r=this.div.getBoundingClientRect();else{const{currentLayer:a,div:o}=this,l=o.style.display,c=o.classList.contains("hidden");o.classList.remove("hidden"),o.style.display="hidden",a.div.append(this.div),r=o.getBoundingClientRect(),o.remove(),o.style.display=l,o.classList.toggle("hidden",c)}this.rotation%180===this.parentRotation%180?(this.width=r.width/t,this.height=r.height/n):(this.width=r.height/t,this.height=r.width/n),this.fixAndSetPosition()},Ec=new WeakSet,aC=function(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(h1,"")},oC=function(){if(this.editorDiv.replaceChildren(),!!u(this,ji))for(const t of u(this,ji).split(`
`)){const n=document.createElement("div");n.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(n)}},sV=function(){return u(this,ji).replaceAll(""," ")},I2=function(t){return t.replaceAll(" ","")},nV=function(t){const{value:n,fontSize:r,color:a,pageIndex:o}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||t.value!==n||t.fontSize!==r||t.color.some((l,c)=>l!==a[c])||t.pageIndex!==o},E(bs,Ec),Ce(bs,"_freeTextDefaultContent",""),Ce(bs,"_internalPadding",0),Ce(bs,"_defaultColor",null),Ce(bs,"_defaultFontSize",10),Ce(bs,"_type","freetext"),Ce(bs,"_editorType",pt.FREETEXT);let M2=bs;class We{toSVGPath(){ds("Abstract method `toSVGPath` must be implemented.")}get box(){ds("Abstract getter `box` must be implemented.")}serialize(e,t){ds("Abstract method `serialize` must be implemented.")}static _rescale(e,t,n,r,a,o){o||(o=new Float32Array(e.length));for(let l=0,c=e.length;l<c;l+=2)o[l]=t+e[l]*r,o[l+1]=n+e[l+1]*a;return o}static _rescaleAndSwap(e,t,n,r,a,o){o||(o=new Float32Array(e.length));for(let l=0,c=e.length;l<c;l+=2)o[l]=t+e[l+1]*r,o[l+1]=n+e[l]*a;return o}static _translate(e,t,n,r){r||(r=new Float32Array(e.length));for(let a=0,o=e.length;a<o;a+=2)r[a]=t+e[a],r[a+1]=n+e[a+1];return r}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,n,r,a){switch(a){case 90:return[1-t/n,e/r];case 180:return[1-e/n,1-t/r];case 270:return[t/n,1-e/r];default:return[e/n,t/r]}}static _normalizePagePoint(e,t,n){switch(n){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,n,r,a,o){return[(e+5*n)/6,(t+5*r)/6,(5*n+a)/6,(5*r+o)/6,(n+a)/2,(r+o)/2]}}Ce(We,"PRECISION",1e-4);var Ni,so,Hg,Vg,sl,Et,Af,_f,P0,M0,Wg,qg,tu,I0,oj,lj,yn,Uy,rV,iV,aV,oV,lV,cV;const Bl=class Bl{constructor({x:e,y:t},n,r,a,o,l=0){E(this,yn);E(this,Ni);E(this,so,[]);E(this,Hg);E(this,Vg);E(this,sl,[]);E(this,Et,new Float32Array(18));E(this,Af);E(this,_f);E(this,P0);E(this,M0);E(this,Wg);E(this,qg);E(this,tu,[]);N(this,Ni,n),N(this,qg,a*r),N(this,Vg,o),u(this,Et).set([NaN,NaN,NaN,NaN,e,t],6),N(this,Hg,l),N(this,M0,u(Bl,I0)*r),N(this,P0,u(Bl,lj)*r),N(this,Wg,r),u(this,tu).push(e,t)}isEmpty(){return isNaN(u(this,Et)[8])}add({x:e,y:t}){var L;N(this,Af,e),N(this,_f,t);const[n,r,a,o]=u(this,Ni);let[l,c,d,h]=u(this,Et).subarray(8,12);const f=e-d,m=t-h,p=Math.hypot(f,m);if(p<u(this,P0))return!1;const x=p-u(this,M0),g=x/p,b=g*f,v=g*m;let y=l,w=c;l=d,c=h,d+=b,h+=v,(L=u(this,tu))==null||L.push(e,t);const S=-v/x,j=b/x,A=S*u(this,qg),k=j*u(this,qg);return u(this,Et).set(u(this,Et).subarray(2,8),0),u(this,Et).set([d+A,h+k],4),u(this,Et).set(u(this,Et).subarray(14,18),12),u(this,Et).set([d-A,h-k],16),isNaN(u(this,Et)[6])?(u(this,sl).length===0&&(u(this,Et).set([l+A,c+k],2),u(this,sl).push(NaN,NaN,NaN,NaN,(l+A-n)/a,(c+k-r)/o),u(this,Et).set([l-A,c-k],14),u(this,so).push(NaN,NaN,NaN,NaN,(l-A-n)/a,(c-k-r)/o)),u(this,Et).set([y,w,l,c,d,h],6),!this.isEmpty()):(u(this,Et).set([y,w,l,c,d,h],6),Math.abs(Math.atan2(w-c,y-l)-Math.atan2(v,b))<Math.PI/2?([l,c,d,h]=u(this,Et).subarray(2,6),u(this,sl).push(NaN,NaN,NaN,NaN,((l+d)/2-n)/a,((c+h)/2-r)/o),[l,c,y,w]=u(this,Et).subarray(14,18),u(this,so).push(NaN,NaN,NaN,NaN,((y+l)/2-n)/a,((w+c)/2-r)/o),!0):([y,w,l,c,d,h]=u(this,Et).subarray(0,6),u(this,sl).push(((y+5*l)/6-n)/a,((w+5*c)/6-r)/o,((5*l+d)/6-n)/a,((5*c+h)/6-r)/o,((l+d)/2-n)/a,((c+h)/2-r)/o),[d,h,l,c,y,w]=u(this,Et).subarray(12,18),u(this,so).push(((y+5*l)/6-n)/a,((w+5*c)/6-r)/o,((5*l+d)/6-n)/a,((5*c+h)/6-r)/o,((l+d)/2-n)/a,((c+h)/2-r)/o),!0))}toSVGPath(){if(this.isEmpty())return"";const e=u(this,sl),t=u(this,so);if(isNaN(u(this,Et)[6])&&!this.isEmpty())return F(this,yn,rV).call(this);const n=[];n.push(`M${e[4]} ${e[5]}`);for(let r=6;r<e.length;r+=6)isNaN(e[r])?n.push(`L${e[r+4]} ${e[r+5]}`):n.push(`C${e[r]} ${e[r+1]} ${e[r+2]} ${e[r+3]} ${e[r+4]} ${e[r+5]}`);F(this,yn,aV).call(this,n);for(let r=t.length-6;r>=6;r-=6)isNaN(t[r])?n.push(`L${t[r+4]} ${t[r+5]}`):n.push(`C${t[r]} ${t[r+1]} ${t[r+2]} ${t[r+3]} ${t[r+4]} ${t[r+5]}`);return F(this,yn,iV).call(this,n),n.join(" ")}newFreeDrawOutline(e,t,n,r,a,o){return new dV(e,t,n,r,a,o)}getOutlines(){var f;const e=u(this,sl),t=u(this,so),n=u(this,Et),[r,a,o,l]=u(this,Ni),c=new Float32Array((((f=u(this,tu))==null?void 0:f.length)??0)+2);for(let m=0,p=c.length-2;m<p;m+=2)c[m]=(u(this,tu)[m]-r)/o,c[m+1]=(u(this,tu)[m+1]-a)/l;if(c[c.length-2]=(u(this,Af)-r)/o,c[c.length-1]=(u(this,_f)-a)/l,isNaN(n[6])&&!this.isEmpty())return F(this,yn,oV).call(this,c);const d=new Float32Array(u(this,sl).length+24+u(this,so).length);let h=e.length;for(let m=0;m<h;m+=2){if(isNaN(e[m])){d[m]=d[m+1]=NaN;continue}d[m]=e[m],d[m+1]=e[m+1]}h=F(this,yn,cV).call(this,d,h);for(let m=t.length-6;m>=6;m-=6)for(let p=0;p<6;p+=2){if(isNaN(t[m+p])){d[h]=d[h+1]=NaN,h+=2;continue}d[h]=t[m+p],d[h+1]=t[m+p+1],h+=2}return F(this,yn,lV).call(this,d,h),this.newFreeDrawOutline(d,c,u(this,Ni),u(this,Wg),u(this,Hg),u(this,Vg))}};Ni=new WeakMap,so=new WeakMap,Hg=new WeakMap,Vg=new WeakMap,sl=new WeakMap,Et=new WeakMap,Af=new WeakMap,_f=new WeakMap,P0=new WeakMap,M0=new WeakMap,Wg=new WeakMap,qg=new WeakMap,tu=new WeakMap,I0=new WeakMap,oj=new WeakMap,lj=new WeakMap,yn=new WeakSet,Uy=function(){const e=u(this,Et).subarray(4,6),t=u(this,Et).subarray(16,18),[n,r,a,o]=u(this,Ni);return[(u(this,Af)+(e[0]-t[0])/2-n)/a,(u(this,_f)+(e[1]-t[1])/2-r)/o,(u(this,Af)+(t[0]-e[0])/2-n)/a,(u(this,_f)+(t[1]-e[1])/2-r)/o]},rV=function(){const[e,t,n,r]=u(this,Ni),[a,o,l,c]=F(this,yn,Uy).call(this);return`M${(u(this,Et)[2]-e)/n} ${(u(this,Et)[3]-t)/r} L${(u(this,Et)[4]-e)/n} ${(u(this,Et)[5]-t)/r} L${a} ${o} L${l} ${c} L${(u(this,Et)[16]-e)/n} ${(u(this,Et)[17]-t)/r} L${(u(this,Et)[14]-e)/n} ${(u(this,Et)[15]-t)/r} Z`},iV=function(e){const t=u(this,so);e.push(`L${t[4]} ${t[5]} Z`)},aV=function(e){const[t,n,r,a]=u(this,Ni),o=u(this,Et).subarray(4,6),l=u(this,Et).subarray(16,18),[c,d,h,f]=F(this,yn,Uy).call(this);e.push(`L${(o[0]-t)/r} ${(o[1]-n)/a} L${c} ${d} L${h} ${f} L${(l[0]-t)/r} ${(l[1]-n)/a}`)},oV=function(e){const t=u(this,Et),[n,r,a,o]=u(this,Ni),[l,c,d,h]=F(this,yn,Uy).call(this),f=new Float32Array(36);return f.set([NaN,NaN,NaN,NaN,(t[2]-n)/a,(t[3]-r)/o,NaN,NaN,NaN,NaN,(t[4]-n)/a,(t[5]-r)/o,NaN,NaN,NaN,NaN,l,c,NaN,NaN,NaN,NaN,d,h,NaN,NaN,NaN,NaN,(t[16]-n)/a,(t[17]-r)/o,NaN,NaN,NaN,NaN,(t[14]-n)/a,(t[15]-r)/o],0),this.newFreeDrawOutline(f,e,u(this,Ni),u(this,Wg),u(this,Hg),u(this,Vg))},lV=function(e,t){const n=u(this,so);return e.set([NaN,NaN,NaN,NaN,n[4],n[5]],t),t+=6},cV=function(e,t){const n=u(this,Et).subarray(4,6),r=u(this,Et).subarray(16,18),[a,o,l,c]=u(this,Ni),[d,h,f,m]=F(this,yn,Uy).call(this);return e.set([NaN,NaN,NaN,NaN,(n[0]-a)/l,(n[1]-o)/c,NaN,NaN,NaN,NaN,d,h,NaN,NaN,NaN,NaN,f,m,NaN,NaN,NaN,NaN,(r[0]-a)/l,(r[1]-o)/c],t),t+=24},E(Bl,I0,8),E(Bl,oj,2),E(Bl,lj,u(Bl,I0)+u(Bl,oj));let BS=Bl;var Gg,Tf,gc,R0,Ai,D0,Qs,cj,uV;class dV extends We{constructor(t,n,r,a,o,l){super();E(this,cj);E(this,Gg);E(this,Tf,new Float32Array(4));E(this,gc);E(this,R0);E(this,Ai);E(this,D0);E(this,Qs);N(this,Qs,t),N(this,Ai,n),N(this,Gg,r),N(this,D0,a),N(this,gc,o),N(this,R0,l),this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],F(this,cj,uV).call(this,l);const[c,d,h,f]=u(this,Tf);for(let m=0,p=t.length;m<p;m+=2)t[m]=(t[m]-c)/h,t[m+1]=(t[m+1]-d)/f;for(let m=0,p=n.length;m<p;m+=2)n[m]=(n[m]-c)/h,n[m+1]=(n[m+1]-d)/f}toSVGPath(){const t=[`M${u(this,Qs)[4]} ${u(this,Qs)[5]}`];for(let n=6,r=u(this,Qs).length;n<r;n+=6){if(isNaN(u(this,Qs)[n])){t.push(`L${u(this,Qs)[n+4]} ${u(this,Qs)[n+5]}`);continue}t.push(`C${u(this,Qs)[n]} ${u(this,Qs)[n+1]} ${u(this,Qs)[n+2]} ${u(this,Qs)[n+3]} ${u(this,Qs)[n+4]} ${u(this,Qs)[n+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,n,r,a],o){const l=r-t,c=a-n;let d,h;switch(o){case 0:d=We._rescale(u(this,Qs),t,a,l,-c),h=We._rescale(u(this,Ai),t,a,l,-c);break;case 90:d=We._rescaleAndSwap(u(this,Qs),t,n,l,c),h=We._rescaleAndSwap(u(this,Ai),t,n,l,c);break;case 180:d=We._rescale(u(this,Qs),r,n,-l,c),h=We._rescale(u(this,Ai),r,n,-l,c);break;case 270:d=We._rescaleAndSwap(u(this,Qs),r,a,-l,-c),h=We._rescaleAndSwap(u(this,Ai),r,a,-l,-c);break}return{outline:Array.from(d),points:[Array.from(h)]}}get box(){return u(this,Tf)}newOutliner(t,n,r,a,o,l=0){return new BS(t,n,r,a,o,l)}getNewOutline(t,n){const[r,a,o,l]=u(this,Tf),[c,d,h,f]=u(this,Gg),m=o*h,p=l*f,x=r*h+c,g=a*f+d,b=this.newOutliner({x:u(this,Ai)[0]*m+x,y:u(this,Ai)[1]*p+g},u(this,Gg),u(this,D0),t,u(this,R0),n??u(this,gc));for(let v=2;v<u(this,Ai).length;v+=2)b.add({x:u(this,Ai)[v]*m+x,y:u(this,Ai)[v+1]*p+g});return b.getOutlines()}}Gg=new WeakMap,Tf=new WeakMap,gc=new WeakMap,R0=new WeakMap,Ai=new WeakMap,D0=new WeakMap,Qs=new WeakMap,cj=new WeakSet,uV=function(t){const n=u(this,Qs);let r=n[4],a=n[5];const o=[r,a,r,a];let l=r,c=a,d=r,h=a;const f=t?Math.max:Math.min,m=new Float32Array(4);for(let x=6,g=n.length;x<g;x+=6){const b=n[x+4],v=n[x+5];isNaN(n[x])?(Ge.pointBoundingBox(b,v,o),c>v?(l=b,c=v):c===v&&(l=f(l,b)),h<v?(d=b,h=v):h===v&&(d=f(d,b))):(m[0]=m[1]=1/0,m[2]=m[3]=-1/0,Ge.bezierBoundingBox(r,a,...n.slice(x,x+6),m),Ge.rectBoundingBox(m[0],m[1],m[2],m[3],o),c>m[1]?(l=m[0],c=m[1]):c===m[1]&&(l=f(l,m[0])),h<m[3]?(d=m[2],h=m[3]):h===m[3]&&(d=f(d,m[2]))),r=b,a=v}const p=u(this,Tf);p[0]=o[0]-u(this,gc),p[1]=o[1]-u(this,gc),p[2]=o[2]-o[0]+2*u(this,gc),p[3]=o[3]-o[1]+2*u(this,gc),this.firstPoint=[l,c],this.lastPoint=[d,h]};var L0,O0,F0,su,no,Ir,hV,lC,fV,mV,D2;class R2{constructor(e,t=0,n=0,r=!0){E(this,Ir);E(this,L0);E(this,O0);E(this,F0);E(this,su,[]);E(this,no,[]);const a=[1/0,1/0,-1/0,-1/0],o=10**-4;for(const{x:g,y:b,width:v,height:y}of e){const w=Math.floor((g-t)/o)*o,S=Math.ceil((g+v+t)/o)*o,j=Math.floor((b-t)/o)*o,A=Math.ceil((b+y+t)/o)*o,k=[w,j,A,!0],_=[S,j,A,!1];u(this,su).push(k,_),Ge.rectBoundingBox(w,j,S,A,a)}const l=a[2]-a[0]+2*n,c=a[3]-a[1]+2*n,d=a[0]-n,h=a[1]-n;let f=r?-1/0:1/0,m=1/0;const p=u(this,su).at(r?-1:-2),x=[p[0],p[2]];for(const g of u(this,su)){const[b,v,y,w]=g;!w&&r?v<m?(m=v,f=b):v===m&&(f=Math.max(f,b)):w&&!r&&(v<m?(m=v,f=b):v===m&&(f=Math.min(f,b))),g[0]=(b-d)/l,g[1]=(v-h)/c,g[2]=(y-h)/c}N(this,L0,new Float32Array([d,h,l,c])),N(this,O0,[f,m]),N(this,F0,x)}getOutlines(){u(this,su).sort((t,n)=>t[0]-n[0]||t[1]-n[1]||t[2]-n[2]);const e=[];for(const t of u(this,su))t[3]?(e.push(...F(this,Ir,D2).call(this,t)),F(this,Ir,fV).call(this,t)):(F(this,Ir,mV).call(this,t),e.push(...F(this,Ir,D2).call(this,t)));return F(this,Ir,hV).call(this,e)}}L0=new WeakMap,O0=new WeakMap,F0=new WeakMap,su=new WeakMap,no=new WeakMap,Ir=new WeakSet,hV=function(e){const t=[],n=new Set;for(const o of e){const[l,c,d]=o;t.push([l,c,o],[l,d,o])}t.sort((o,l)=>o[1]-l[1]||o[0]-l[0]);for(let o=0,l=t.length;o<l;o+=2){const c=t[o][2],d=t[o+1][2];c.push(d),d.push(c),n.add(c),n.add(d)}const r=[];let a;for(;n.size>0;){const o=n.values().next().value;let[l,c,d,h,f]=o;n.delete(o);let m=l,p=c;for(a=[l,d],r.push(a);;){let x;if(n.has(h))x=h;else if(n.has(f))x=f;else break;n.delete(x),[l,c,d,h,f]=x,m!==l&&(a.push(m,p,l,p===c?c:d),m=l),p=p===c?d:c}a.push(m,p)}return new Ohe(r,u(this,L0),u(this,O0),u(this,F0))},lC=function(e){const t=u(this,no);let n=0,r=t.length-1;for(;n<=r;){const a=n+r>>1,o=t[a][0];if(o===e)return a;o<e?n=a+1:r=a-1}return r+1},fV=function([,e,t]){const n=F(this,Ir,lC).call(this,e);u(this,no).splice(n,0,[e,t])},mV=function([,e,t]){const n=F(this,Ir,lC).call(this,e);for(let r=n;r<u(this,no).length;r++){const[a,o]=u(this,no)[r];if(a!==e)break;if(a===e&&o===t){u(this,no).splice(r,1);return}}for(let r=n-1;r>=0;r--){const[a,o]=u(this,no)[r];if(a!==e)break;if(a===e&&o===t){u(this,no).splice(r,1);return}}},D2=function(e){const[t,n,r]=e,a=[[t,n,r]],o=F(this,Ir,lC).call(this,r);for(let l=0;l<o;l++){const[c,d]=u(this,no)[l];for(let h=0,f=a.length;h<f;h++){const[,m,p]=a[h];if(!(d<=m||p<=c)){if(m>=c){if(p>d)a[h][1]=d;else{if(f===1)return[];a.splice(h,1),h--,f--}continue}a[h][2]=c,p>d&&a.push([t,d,p])}}}return a};var B0,Yg;class Ohe extends We{constructor(t,n,r,a){super();E(this,B0);E(this,Yg);N(this,Yg,t),N(this,B0,n),this.firstPoint=r,this.lastPoint=a}toSVGPath(){const t=[];for(const n of u(this,Yg)){let[r,a]=n;t.push(`M${r} ${a}`);for(let o=2;o<n.length;o+=2){const l=n[o],c=n[o+1];l===r?(t.push(`V${c}`),a=c):c===a&&(t.push(`H${l}`),r=l)}t.push("Z")}return t.join(" ")}serialize([t,n,r,a],o){const l=[],c=r-t,d=a-n;for(const h of u(this,Yg)){const f=new Array(h.length);for(let m=0;m<h.length;m+=2)f[m]=t+h[m]*c,f[m+1]=a-h[m+1]*d;l.push(f)}return l}get box(){return u(this,B0)}get classNamesForOutlining(){return["highlightOutline"]}}B0=new WeakMap,Yg=new WeakMap;class L2 extends BS{newFreeDrawOutline(e,t,n,r,a,o){return new Fhe(e,t,n,r,a,o)}}class Fhe extends dV{newOutliner(e,t,n,r,a,o=0){return new L2(e,t,n,r,a,o)}}var Kg,$0,xc,Ef,U0,Qr,z0,H0,Pf,_i,Ti,Un,Xg,Qg,or,Zg,ya,V0,kt,O2,cC,pV,gV,xV,F2,uh,ja,Xm,yV,dC,uC,vV,bV,wV,CV,SV;const qt=class qt extends ms{constructor(t){super({...t,name:"highlightEditor"});E(this,kt);E(this,Kg,null);E(this,$0,0);E(this,xc);E(this,Ef,null);E(this,U0,null);E(this,Qr,null);E(this,z0,null);E(this,H0,0);E(this,Pf,null);E(this,_i,null);E(this,Ti,null);E(this,Un,!1);E(this,Xg,null);E(this,Qg,null);E(this,or,null);E(this,Zg,"");E(this,ya);E(this,V0,"");this.color=t.color||qt._defaultColor,N(this,ya,t.thickness||qt._defaultThickness),this.opacity=t.opacity||qt._defaultOpacity,N(this,xc,t.boxes||null),N(this,V0,t.methodOfCreation||""),N(this,Zg,t.text||""),this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(N(this,Un,!0),F(this,kt,cC).call(this,t),F(this,kt,uh).call(this)):u(this,xc)&&(N(this,Kg,t.anchorNode),N(this,$0,t.anchorOffset),N(this,z0,t.focusNode),N(this,H0,t.focusOffset),F(this,kt,O2).call(this),F(this,kt,uh).call(this),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}static get _keyboardManager(){const t=qt.prototype;return bt(this,"_keyboardManager",new mw([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:u(this,Un)?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:u(this,ya),methodOfCreation:u(this,V0)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,n){var r;ms.initialize(t,n),qt._defaultColor||(qt._defaultColor=((r=n.highlightColors)==null?void 0:r.values().next().value)||"#fff066")}static updateDefaultParams(t,n){switch(t){case Lt.HIGHLIGHT_COLOR:qt._defaultColor=n;break;case Lt.HIGHLIGHT_THICKNESS:qt._defaultThickness=n;break}}translateInPage(t,n){}get toolbarPosition(){return u(this,Qg)}get commentButtonPosition(){return u(this,Xg)}updateParams(t,n){switch(t){case Lt.HIGHLIGHT_COLOR:F(this,kt,pV).call(this,n);break;case Lt.HIGHLIGHT_THICKNESS:F(this,kt,gV).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[Lt.HIGHLIGHT_COLOR,qt._defaultColor],[Lt.HIGHLIGHT_THICKNESS,qt._defaultThickness]]}get propertiesToUpdate(){return[[Lt.HIGHLIGHT_COLOR,this.color||qt._defaultColor],[Lt.HIGHLIGHT_THICKNESS,u(this,ya)||qt._defaultThickness],[Lt.HIGHLIGHT_FREE,u(this,Un)]]}onUpdatedColor(){var t,n;(t=this.parent)==null||t.drawLayer.updateProperties(u(this,Ti),{root:{fill:this.color,"fill-opacity":this.opacity}}),(n=u(this,U0))==null||n.updateColor(this.color),super.onUpdatedColor()}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",N(this,U0,new LS({editor:this}))]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(F(this,kt,uC).call(this))}getBaseTranslation(){return[0,0]}getRect(t,n){return super.getRect(t,n,F(this,kt,uC).call(this))}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){F(this,kt,F2).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(F(this,kt,uh).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var r;let n=!1;this.parent&&!t?F(this,kt,F2).call(this):t&&(F(this,kt,uh).call(this,t),n=!this.parent&&((r=this.div)==null?void 0:r.classList.contains("selectedEditor"))),super.setParent(t),this.show(this._isVisible),n&&this.select()}rotate(t){var a,o,l;const{drawLayer:n}=this.parent;let r;u(this,Un)?(t=(t-this.rotation+360)%360,r=F(a=qt,ja,Xm).call(a,u(this,_i).box,t)):r=F(o=qt,ja,Xm).call(o,[this.x,this.y,this.width,this.height],t),n.updateProperties(u(this,Ti),{bbox:r,root:{"data-main-rotation":t}}),n.updateProperties(u(this,or),{bbox:F(l=qt,ja,Xm).call(l,u(this,Qr).box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();u(this,Zg)&&(t.setAttribute("aria-label",u(this,Zg)),t.setAttribute("role","mark")),u(this,Un)?t.classList.add("free"):this.div.addEventListener("keydown",F(this,kt,yV).bind(this),{signal:this._uiManager._signal});const n=N(this,Pf,document.createElement("div"));return t.append(n),n.setAttribute("aria-hidden","true"),n.className="internal",n.style.clipPath=u(this,Ef),this.setDims(),Uz(this,u(this,Pf),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(u(this,or),{rootClass:{hovered:!0}})}pointerleave(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(u(this,or),{rootClass:{hovered:!1}})}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:F(this,kt,dC).call(this,!0);break;case 1:case 3:F(this,kt,dC).call(this,!1);break}}select(){var t;super.select(),u(this,or)&&((t=this.parent)==null||t.drawLayer.updateProperties(u(this,or),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var t;super.unselect(),u(this,or)&&((t=this.parent)==null||t.drawLayer.updateProperties(u(this,or),{rootClass:{selected:!1}}),u(this,Un)||F(this,kt,dC).call(this,!1))}get _mustFixPosition(){return!u(this,Un)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(u(this,Ti),{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(u(this,or),{rootClass:{hidden:!t}}))}static startHighlighting(t,n,{target:r,x:a,y:o}){const{x:l,y:c,width:d,height:h}=r.getBoundingClientRect(),f=new AbortController,m=t.combinedSignal(f),p=x=>{f.abort(),F(this,ja,CV).call(this,t,x)};window.addEventListener("blur",p,{signal:m}),window.addEventListener("pointerup",p,{signal:m}),window.addEventListener("pointerdown",Gs,{capture:!0,passive:!1,signal:m}),window.addEventListener("contextmenu",La,{signal:m}),r.addEventListener("pointermove",F(this,ja,wV).bind(this,t),{signal:m}),this._freeHighlight=new L2({x:a,y:o},[l,c,d,h],t.scale,this._defaultThickness/2,n,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(t,n,r){var g,b,v,y;let a=null;if(t instanceof QH){const{data:{quadPoints:w,rect:S,rotation:j,id:A,color:k,opacity:_,popupRef:L,richText:D,contentsObj:P,creationDate:T,modificationDate:B},parent:{page:{pageNumber:R}}}=t;a=t={annotationType:pt.HIGHLIGHT,color:Array.from(k),opacity:_,quadPoints:w,boxes:null,pageIndex:R-1,rect:S.slice(0),rotation:j,annotationElementId:A,id:A,deleted:!1,popupRef:L,richText:D,comment:(P==null?void 0:P.str)||null,creationDate:T,modificationDate:B}}else if(t instanceof UM){const{data:{inkLists:w,rect:S,rotation:j,id:A,color:k,borderStyle:{rawWidth:_},popupRef:L,richText:D,contentsObj:P,creationDate:T,modificationDate:B},parent:{page:{pageNumber:R}}}=t;a=t={annotationType:pt.HIGHLIGHT,color:Array.from(k),thickness:_,inkLists:w,boxes:null,pageIndex:R-1,rect:S.slice(0),rotation:j,annotationElementId:A,id:A,deleted:!1,popupRef:L,richText:D,comment:(P==null?void 0:P.str)||null,creationDate:T,modificationDate:B}}const{color:o,quadPoints:l,inkLists:c,opacity:d}=t,h=await super.deserialize(t,n,r);h.color=Ge.makeHexColor(...o),h.opacity=d||1,c&&N(h,ya,t.thickness),h._initialData=a,t.comment&&h.setCommentData(t);const[f,m]=h.pageDimensions,[p,x]=h.pageTranslation;if(l){const w=N(h,xc,[]);for(let S=0;S<l.length;S+=8)w.push({x:(l[S]-p)/f,y:1-(l[S+1]-x)/m,width:(l[S+2]-l[S])/f,height:(l[S+1]-l[S+5])/m});F(g=h,kt,O2).call(g),F(b=h,kt,uh).call(b),h.rotate(h.rotation)}else if(c){N(h,Un,!0);const w=c[0],S={x:w[0]-p,y:m-(w[1]-x)},j=new L2(S,[0,0,f,m],1,u(h,ya)/2,!0,.001);for(let _=0,L=w.length;_<L;_+=2)S.x=w[_]-p,S.y=m-(w[_+1]-x),j.add(S);const{id:A,clipPathId:k}=n.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:h.color,"fill-opacity":h._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:j.toSVGPath()}},!0,!0);F(v=h,kt,cC).call(v,{highlightOutlines:j.getOutlines(),highlightId:A,clipPathId:k}),F(y=h,kt,uh).call(y),h.rotate(h.parentRotation)}return h}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const n=ms._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),r=super.serialize(t);return Object.assign(r,{color:n,opacity:this.opacity,thickness:u(this,ya),quadPoints:F(this,kt,vV).call(this),outlines:F(this,kt,bV).call(this,r.rect)}),this.addComment(r),this.annotationElementId&&!F(this,kt,SV).call(this,r)?null:(r.id=this.annotationElementId,r)}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}static canCreateNewEmptyEditor(){return!1}};Kg=new WeakMap,$0=new WeakMap,xc=new WeakMap,Ef=new WeakMap,U0=new WeakMap,Qr=new WeakMap,z0=new WeakMap,H0=new WeakMap,Pf=new WeakMap,_i=new WeakMap,Ti=new WeakMap,Un=new WeakMap,Xg=new WeakMap,Qg=new WeakMap,or=new WeakMap,Zg=new WeakMap,ya=new WeakMap,V0=new WeakMap,kt=new WeakSet,O2=function(){const t=new R2(u(this,xc),.001);N(this,_i,t.getOutlines()),[this.x,this.y,this.width,this.height]=u(this,_i).box;const n=new R2(u(this,xc),.0025,.001,this._uiManager.direction==="ltr");N(this,Qr,n.getOutlines());const{firstPoint:r}=u(this,_i);N(this,Xg,[(r[0]-this.x)/this.width,(r[1]-this.y)/this.height]);const{lastPoint:a}=u(this,Qr);N(this,Qg,[(a[0]-this.x)/this.width,(a[1]-this.y)/this.height])},cC=function({highlightOutlines:t,highlightId:n,clipPathId:r}){var m,p;if(N(this,_i,t),N(this,Qr,t.getNewOutline(u(this,ya)/2+1.5,.0025)),n>=0)N(this,Ti,n),N(this,Ef,r),this.parent.drawLayer.finalizeDraw(n,{bbox:t.box,path:{d:t.toSVGPath()}}),N(this,or,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:u(this,Qr).box,path:{d:u(this,Qr).toSVGPath()}},!0));else if(this.parent){const x=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(u(this,Ti),{bbox:F(m=qt,ja,Xm).call(m,u(this,_i).box,(x-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(u(this,or),{bbox:F(p=qt,ja,Xm).call(p,u(this,Qr).box,x),path:{d:u(this,Qr).toSVGPath()}})}const[o,l,c,d]=t.box;switch(this.rotation){case 0:this.x=o,this.y=l,this.width=c,this.height=d;break;case 90:{const[x,g]=this.parentDimensions;this.x=l,this.y=1-o,this.width=c*g/x,this.height=d*x/g;break}case 180:this.x=1-o,this.y=1-l,this.width=c,this.height=d;break;case 270:{const[x,g]=this.parentDimensions;this.x=1-l,this.y=o,this.width=c*g/x,this.height=d*x/g;break}}const{firstPoint:h}=t;N(this,Xg,[(h[0]-o)/c,(h[1]-l)/d]);const{lastPoint:f}=u(this,Qr);N(this,Qg,[(f[0]-o)/c,(f[1]-l)/d])},pV=function(t){const n=(o,l)=>{this.color=o,this.opacity=l,this.onUpdatedColor()},r=this.color,a=this.opacity;this.addCommands({cmd:n.bind(this,t,qt._defaultOpacity),undo:n.bind(this,r,a),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Lt.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(t)},!0)},gV=function(t){const n=u(this,ya),r=a=>{N(this,ya,a),F(this,kt,xV).call(this,a)};this.addCommands({cmd:r.bind(this,t),undo:r.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Lt.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)},xV=function(t){u(this,Un)&&(F(this,kt,cC).call(this,{highlightOutlines:u(this,_i).getNewOutline(t/2)}),this.fixAndSetPosition(),this.setDims())},F2=function(){u(this,Ti)===null||!this.parent||(this.parent.drawLayer.remove(u(this,Ti)),N(this,Ti,null),this.parent.drawLayer.remove(u(this,or)),N(this,or,null))},uh=function(t=this.parent){u(this,Ti)===null&&({id:Fs(this,Ti)._,clipPathId:Fs(this,Ef)._}=t.drawLayer.draw({bbox:u(this,_i).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:u(this,Un)},path:{d:u(this,_i).toSVGPath()}},!1,!0),N(this,or,t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:u(this,Un)},bbox:u(this,Qr).box,path:{d:u(this,Qr).toSVGPath()}},u(this,Un))),u(this,Pf)&&(u(this,Pf).style.clipPath=u(this,Ef)))},ja=new WeakSet,Xm=function([t,n,r,a],o){switch(o){case 90:return[1-n-a,t,a,r];case 180:return[1-t-r,1-n-a,r,a];case 270:return[n,1-t-r,a,r]}return[t,n,r,a]},yV=function(t){qt._keyboardManager.exec(this,t)},dC=function(t){if(!u(this,Kg))return;const n=window.getSelection();t?n.setPosition(u(this,Kg),u(this,$0)):n.setPosition(u(this,z0),u(this,H0))},uC=function(){return u(this,Un)?this.rotation:0},vV=function(){if(u(this,Un))return null;const[t,n]=this.pageDimensions,[r,a]=this.pageTranslation,o=u(this,xc),l=new Float32Array(o.length*8);let c=0;for(const{x:d,y:h,width:f,height:m}of o){const p=d*t+r,x=(1-h)*n+a;l[c]=l[c+4]=p,l[c+1]=l[c+3]=x,l[c+2]=l[c+6]=p+f*t,l[c+5]=l[c+7]=x-m*n,c+=8}return l},bV=function(t){return u(this,_i).serialize(t,F(this,kt,uC).call(this))},wV=function(t,n){this._freeHighlight.add(n)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},CV=function(t,n){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(n,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},SV=function(t){const{color:n}=this._initialData;return this.hasEditedComment||t.color.some((r,a)=>r!==n[a])},E(qt,ja),Ce(qt,"_defaultColor",null),Ce(qt,"_defaultOpacity",1),Ce(qt,"_defaultThickness",12),Ce(qt,"_type","highlight"),Ce(qt,"_editorType",pt.HIGHLIGHT),Ce(qt,"_freeHighlightId",-1),Ce(qt,"_freeHighlight",null),Ce(qt,"_freeHighlightClipId","");let $S=qt;var Mf;class jV{constructor(){E(this,Mf,Object.create(null))}updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,n]of Object.entries(e))t.startsWith("_")||this.updateProperty(t,n)}updateSVGProperty(e,t){u(this,Mf)[e]=t}toSVGProperties(){const e=u(this,Mf);return N(this,Mf,Object.create(null)),{root:e}}reset(){N(this,Mf,Object.create(null))}updateAll(e=this){this.updateProperties(e)}clone(){ds("Not implemented")}}Mf=new WeakMap;var Ei,Jg,Sn,If,Rf,$t,B2,$2,U2,zy,kV,hC,Hy,Qm;const Rt=class Rt extends ms{constructor(t){super(t);E(this,$t);E(this,Ei,null);E(this,Jg);Ce(this,"_colorPicker",null);Ce(this,"_drawId",null);N(this,Jg,t.mustBeCommitted||!1),this._addOutlines(t)}onUpdatedColor(){var t;(t=this._colorPicker)==null||t.update(this.color),super.onUpdatedColor()}_addOutlines(t){t.drawOutlines&&(F(this,$t,B2).call(this,t),F(this,$t,zy).call(this))}static _mergeSVGProperties(t,n){const r=new Set(Object.keys(t));for(const[a,o]of Object.entries(n))r.has(a)?Object.assign(t[a],o):t[a]=o;return t}static getDefaultDrawingOptions(t){ds("Not implemented")}static get typesMap(){ds("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,n){const r=this.typesMap.get(t);r&&this._defaultDrawingOptions.updateProperty(r,n),this._currentParent&&(u(Rt,Sn).updateProperty(r,n),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,n){const r=this.constructor.typesMap.get(t);r&&this._updateProperty(t,r,n)}static get defaultPropertiesToUpdate(){const t=[],n=this._defaultDrawingOptions;for(const[r,a]of this.typesMap)t.push([r,n[a]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:n}=this;for(const[r,a]of this.constructor.typesMap)t.push([r,n[a]]);return t}_updateProperty(t,n,r){const a=this._drawingOptions,o=a[n],l=c=>{var h;a.updateProperty(n,c);const d=u(this,Ei).updateProperty(n,c);d&&F(this,$t,Hy).call(this,d),(h=this.parent)==null||h.drawLayer.updateProperties(this._drawId,a.toSVGProperties()),t===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:l.bind(this,r),undo:l.bind(this,o),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,Rt._mergeSVGProperties(u(this,Ei).getPathResizingSVGProperties(F(this,$t,hC).call(this)),{bbox:F(this,$t,Qm).call(this)}))}_onResized(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,Rt._mergeSVGProperties(u(this,Ei).getPathResizedSVGProperties(F(this,$t,hC).call(this)),{bbox:F(this,$t,Qm).call(this)}))}_onTranslating(t,n){var r;(r=this.parent)==null||r.drawLayer.updateProperties(this._drawId,{bbox:F(this,$t,Qm).call(this)})}_onTranslated(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,Rt._mergeSVGProperties(u(this,Ei).getPathTranslatedSVGProperties(F(this,$t,hC).call(this),this.parentDimensions),{bbox:F(this,$t,Qm).call(this)}))}_onStartDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,u(this,Jg)&&(N(this,Jg,!1),this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){F(this,$t,U2).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(F(this,$t,zy).call(this),F(this,$t,Hy).call(this,u(this,Ei).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var r;let n=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),F(this,$t,U2).call(this)):t&&(this._uiManager.addShouldRescale(this),F(this,$t,zy).call(this,t),n=!this.parent&&((r=this.div)==null?void 0:r.classList.contains("selectedEditor"))),super.setParent(t),n&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,Rt._mergeSVGProperties({bbox:F(this,$t,Qm).call(this)},u(this,Ei).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&F(this,$t,Hy).call(this,u(this,Ei).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,n;this._isCopy&&(t=this.x,n=this.y);const r=super.render();r.classList.add("draw");const a=document.createElement("div");return r.append(a),a.setAttribute("aria-hidden","true"),a.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,n),r}static createDrawerInstance(t,n,r,a,o){ds("Not implemented")}static startDrawing(t,n,r,a){var b;const{target:o,offsetX:l,offsetY:c,pointerId:d,pointerType:h}=a;if(sr.isInitializedAndDifferentPointerType(h))return;const{viewport:{rotation:f}}=t,{width:m,height:p}=o.getBoundingClientRect(),x=N(Rt,If,new AbortController),g=t.combinedSignal(x);if(sr.setPointer(h,d),window.addEventListener("pointerup",v=>{sr.isSamePointerIdOrRemove(v.pointerId)&&this._endDraw(v)},{signal:g}),window.addEventListener("pointercancel",v=>{sr.isSamePointerIdOrRemove(v.pointerId)&&this._currentParent.endDrawingSession()},{signal:g}),window.addEventListener("pointerdown",v=>{sr.isSamePointerType(v.pointerType)&&(sr.initializeAndAddPointerId(v.pointerId),u(Rt,Sn).isCancellable()&&(u(Rt,Sn).removeLastElement(),u(Rt,Sn).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:g}),window.addEventListener("contextmenu",La,{signal:g}),o.addEventListener("pointermove",this._drawMove.bind(this),{signal:g}),o.addEventListener("touchmove",v=>{sr.isSameTimeStamp(v.timeStamp)&&Gs(v)},{signal:g}),t.toggleDrawing(),(b=n._editorUndoBar)==null||b.hide(),u(Rt,Sn)){t.drawLayer.updateProperties(this._currentDrawId,u(Rt,Sn).startNew(l,c,m,p,f));return}n.updateUIForDefaultProperties(this),N(Rt,Sn,this.createDrawerInstance(l,c,m,p,f)),N(Rt,Rf,this.getDefaultDrawingOptions()),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(u(Rt,Rf).toSVGProperties(),u(Rt,Sn).defaultSVGProperties),!0,!1)}static _drawMove(t){if(sr.isSameTimeStamp(t.timeStamp),!u(Rt,Sn))return;const{offsetX:n,offsetY:r,pointerId:a}=t;if(sr.isSamePointerId(a)){if(sr.isUsingMultiplePointers()){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,u(Rt,Sn).add(n,r)),sr.setTimeStamp(t.timeStamp),Gs(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,N(Rt,Sn,null),N(Rt,Rf,null),sr.clearPointerType(),sr.clearTimeStamp()),u(Rt,If)&&(u(Rt,If).abort(),N(Rt,If,null),sr.clearPointerIds())}static _endDraw(t){const n=this._currentParent;if(n){if(n.toggleDrawing(!0),this._cleanup(!1),(t==null?void 0:t.target)===n.div&&n.drawLayer.updateProperties(this._currentDrawId,u(Rt,Sn).end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const r=u(Rt,Sn),a=this._currentDrawId,o=r.getLastElement();n.addCommands({cmd:()=>{n.drawLayer.updateProperties(a,r.setLastElement(o))},undo:()=>{n.drawLayer.updateProperties(a,r.removeLastElement())},mustExec:!1,type:Lt.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const n=this._currentParent;if(!n)return null;if(n.toggleDrawing(!0),n.cleanUndoStack(Lt.DRAW_STEP),!u(Rt,Sn).isEmpty()){const{pageDimensions:[r,a],scale:o}=n,l=n.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:u(Rt,Sn).getOutlines(r*o,a*o,o,this._INNER_MARGIN),drawingOptions:u(Rt,Rf),mustBeCommitted:!t});return this._cleanup(!0),l}return n.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,n,r,a,o,l){ds("Not implemented")}static async deserialize(t,n,r){var f,m;const{rawDims:{pageWidth:a,pageHeight:o,pageX:l,pageY:c}}=n.viewport,d=this.deserializeDraw(l,c,a,o,this._INNER_MARGIN,t),h=await super.deserialize(t,n,r);return h.createDrawingOptions(t),F(f=h,$t,B2).call(f,{drawOutlines:d}),F(m=h,$t,zy).call(m),h.onScaleChanging(),h.rotate(),h}serializeDraw(t){const[n,r]=this.pageTranslation,[a,o]=this.pageDimensions;return u(this,Ei).serialize([n,r,a,o],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}};Ei=new WeakMap,Jg=new WeakMap,Sn=new WeakMap,If=new WeakMap,Rf=new WeakMap,$t=new WeakSet,B2=function({drawOutlines:t,drawId:n,drawingOptions:r}){N(this,Ei,t),this._drawingOptions||(this._drawingOptions=r),this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),n>=0?(this._drawId=n,this.parent.drawLayer.finalizeDraw(n,t.defaultProperties)):this._drawId=F(this,$t,$2).call(this,t,this.parent),F(this,$t,Hy).call(this,t.box)},$2=function(t,n){const{id:r}=n.drawLayer.draw(Rt._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return r},U2=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},zy=function(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=F(this,$t,$2).call(this,u(this,Ei),t)}},kV=function([t,n,r,a]){const{parentDimensions:[o,l],rotation:c}=this;switch(c){case 90:return[n,1-t,r*(l/o),a*(o/l)];case 180:return[1-t,1-n,r,a];case 270:return[1-n,t,r*(l/o),a*(o/l)];default:return[t,n,r,a]}},hC=function(){const{x:t,y:n,width:r,height:a,parentDimensions:[o,l],rotation:c}=this;switch(c){case 90:return[1-n,t,r*(o/l),a*(l/o)];case 180:return[1-t,1-n,r,a];case 270:return[n,1-t,r*(o/l),a*(l/o)];default:return[t,n,r,a]}},Hy=function(t){[this.x,this.y,this.width,this.height]=F(this,$t,kV).call(this,t),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()},Qm=function(){const{x:t,y:n,width:r,height:a,rotation:o,parentRotation:l,parentDimensions:[c,d]}=this;switch((o*4+l)/90){case 1:return[1-n-a,t,a,r];case 2:return[1-t-r,1-n-a,r,a];case 3:return[n,1-t-r,a,r];case 4:return[t,n-r*(c/d),a*(d/c),r*(c/d)];case 5:return[1-n,t,r*(c/d),a*(d/c)];case 6:return[1-t-a*(d/c),1-n,a*(d/c),r*(c/d)];case 7:return[n-r*(c/d),1-t-a*(d/c),r*(c/d),a*(d/c)];case 8:return[t-r,n-a,r,a];case 9:return[1-n,t-r,a,r];case 10:return[1-t,1-n,r,a];case 11:return[n-a,1-t,a,r];case 12:return[t-a*(d/c),n,a*(d/c),r*(c/d)];case 13:return[1-n-r*(c/d),t-a*(d/c),r*(c/d),a*(d/c)];case 14:return[1-t,1-n-r*(c/d),a*(d/c),r*(c/d)];case 15:return[n,1-t,r*(c/d),a*(d/c)];default:return[t,n,r,a]}},Ce(Rt,"_currentDrawId",-1),Ce(Rt,"_currentParent",null),E(Rt,Sn,null),E(Rt,If,null),E(Rt,Rf,null),Ce(Rt,"_INNER_MARGIN",3);let US=Rt;var nl,jn,kn,Df,ex,vr,zn,va,Lf,Of,Ff,tx,fC;class Bhe{constructor(e,t,n,r,a,o){E(this,tx);E(this,nl,new Float64Array(6));E(this,jn);E(this,kn);E(this,Df);E(this,ex);E(this,vr);E(this,zn,"");E(this,va,0);E(this,Lf,new gw);E(this,Of);E(this,Ff);N(this,Of,n),N(this,Ff,r),N(this,Df,a),N(this,ex,o),[e,t]=F(this,tx,fC).call(this,e,t);const l=N(this,jn,[NaN,NaN,NaN,NaN,e,t]);N(this,vr,[e,t]),N(this,kn,[{line:l,points:u(this,vr)}]),u(this,nl).set(l,0)}updateProperty(e,t){e==="stroke-width"&&N(this,ex,t)}isEmpty(){return!u(this,kn)||u(this,kn).length===0}isCancellable(){return u(this,vr).length<=10}add(e,t){[e,t]=F(this,tx,fC).call(this,e,t);const[n,r,a,o]=u(this,nl).subarray(2,6),l=e-a,c=t-o;return Math.hypot(u(this,Of)*l,u(this,Ff)*c)<=2?null:(u(this,vr).push(e,t),isNaN(n)?(u(this,nl).set([a,o,e,t],2),u(this,jn).push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(u(this,nl)[0])&&u(this,jn).splice(6,6),u(this,nl).set([n,r,a,o,e,t],0),u(this,jn).push(...We.createBezierPoints(n,r,a,o,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const n=this.add(e,t);return n||(u(this,vr).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,n,r,a){N(this,Of,n),N(this,Ff,r),N(this,Df,a),[e,t]=F(this,tx,fC).call(this,e,t);const o=N(this,jn,[NaN,NaN,NaN,NaN,e,t]);N(this,vr,[e,t]);const l=u(this,kn).at(-1);return l&&(l.line=new Float32Array(l.line),l.points=new Float32Array(l.points)),u(this,kn).push({line:o,points:u(this,vr)}),u(this,nl).set(o,0),N(this,va,0),this.toSVGPath(),null}getLastElement(){return u(this,kn).at(-1)}setLastElement(e){return u(this,kn)?(u(this,kn).push(e),N(this,jn,e.line),N(this,vr,e.points),N(this,va,0),{path:{d:this.toSVGPath()}}):u(this,Lf).setLastElement(e)}removeLastElement(){if(!u(this,kn))return u(this,Lf).removeLastElement();u(this,kn).pop(),N(this,zn,"");for(let e=0,t=u(this,kn).length;e<t;e++){const{line:n,points:r}=u(this,kn)[e];N(this,jn,n),N(this,vr,r),N(this,va,0),this.toSVGPath()}return{path:{d:u(this,zn)}}}toSVGPath(){const e=We.svgRound(u(this,jn)[4]),t=We.svgRound(u(this,jn)[5]);if(u(this,vr).length===2)return N(this,zn,`${u(this,zn)} M ${e} ${t} Z`),u(this,zn);if(u(this,vr).length<=6){const r=u(this,zn).lastIndexOf("M");N(this,zn,`${u(this,zn).slice(0,r)} M ${e} ${t}`),N(this,va,6)}if(u(this,vr).length===4){const r=We.svgRound(u(this,jn)[10]),a=We.svgRound(u(this,jn)[11]);return N(this,zn,`${u(this,zn)} L ${r} ${a}`),N(this,va,12),u(this,zn)}const n=[];u(this,va)===0&&(n.push(`M ${e} ${t}`),N(this,va,6));for(let r=u(this,va),a=u(this,jn).length;r<a;r+=6){const[o,l,c,d,h,f]=u(this,jn).slice(r,r+6).map(We.svgRound);n.push(`C${o} ${l} ${c} ${d} ${h} ${f}`)}return N(this,zn,u(this,zn)+n.join(" ")),N(this,va,u(this,jn).length),u(this,zn)}getOutlines(e,t,n,r){const a=u(this,kn).at(-1);return a.line=new Float32Array(a.line),a.points=new Float32Array(a.points),u(this,Lf).build(u(this,kn),e,t,n,u(this,Df),u(this,ex),r),N(this,nl,null),N(this,jn,null),N(this,kn,null),N(this,zn,null),u(this,Lf)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}nl=new WeakMap,jn=new WeakMap,kn=new WeakMap,Df=new WeakMap,ex=new WeakMap,vr=new WeakMap,zn=new WeakMap,va=new WeakMap,Lf=new WeakMap,Of=new WeakMap,Ff=new WeakMap,tx=new WeakSet,fC=function(e,t){return We._normalizePoint(e,t,u(this,Of),u(this,Ff),u(this,Df))};var br,W0,q0,Pi,rl,il,sx,nx,Bf,Wn,Ll,NV,AV,_V;class gw extends We{constructor(){super(...arguments);E(this,Wn);E(this,br);E(this,W0,0);E(this,q0);E(this,Pi);E(this,rl);E(this,il);E(this,sx);E(this,nx);E(this,Bf)}build(t,n,r,a,o,l,c){N(this,rl,n),N(this,il,r),N(this,sx,a),N(this,nx,o),N(this,Bf,l),N(this,q0,c??0),N(this,Pi,t),F(this,Wn,AV).call(this)}get thickness(){return u(this,Bf)}setLastElement(t){return u(this,Pi).push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return u(this,Pi).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:n}of u(this,Pi)){if(t.push(`M${We.svgRound(n[4])} ${We.svgRound(n[5])}`),n.length===6){t.push("Z");continue}if(n.length===12&&isNaN(n[6])){t.push(`L${We.svgRound(n[10])} ${We.svgRound(n[11])}`);continue}for(let r=6,a=n.length;r<a;r+=6){const[o,l,c,d,h,f]=n.subarray(r,r+6).map(We.svgRound);t.push(`C${o} ${l} ${c} ${d} ${h} ${f}`)}}return t.join("")}serialize([t,n,r,a],o){const l=[],c=[],[d,h,f,m]=F(this,Wn,NV).call(this);let p,x,g,b,v,y,w,S,j;switch(u(this,nx)){case 0:j=We._rescale,p=t,x=n+a,g=r,b=-a,v=t+d*r,y=n+(1-h-m)*a,w=t+(d+f)*r,S=n+(1-h)*a;break;case 90:j=We._rescaleAndSwap,p=t,x=n,g=r,b=a,v=t+h*r,y=n+d*a,w=t+(h+m)*r,S=n+(d+f)*a;break;case 180:j=We._rescale,p=t+r,x=n,g=-r,b=a,v=t+(1-d-f)*r,y=n+h*a,w=t+(1-d)*r,S=n+(h+m)*a;break;case 270:j=We._rescaleAndSwap,p=t+r,x=n+a,g=-r,b=-a,v=t+(1-h-m)*r,y=n+(1-d-f)*a,w=t+(1-h)*r,S=n+(1-d)*a;break}for(const{line:A,points:k}of u(this,Pi))l.push(j(A,p,x,g,b,o?new Array(A.length):null)),c.push(j(k,p,x,g,b,o?new Array(k.length):null));return{lines:l,points:c,rect:[v,y,w,S]}}static deserialize(t,n,r,a,o,{paths:{lines:l,points:c},rotation:d,thickness:h}){const f=[];let m,p,x,g,b;switch(d){case 0:b=We._rescale,m=-t/r,p=n/a+1,x=1/r,g=-1/a;break;case 90:b=We._rescaleAndSwap,m=-n/a,p=-t/r,x=1/a,g=1/r;break;case 180:b=We._rescale,m=t/r+1,p=-n/a,x=-1/r,g=1/a;break;case 270:b=We._rescaleAndSwap,m=n/a+1,p=t/r+1,x=-1/a,g=-1/r;break}if(!l){l=[];for(const y of c){const w=y.length;if(w===2){l.push(new Float32Array([NaN,NaN,NaN,NaN,y[0],y[1]]));continue}if(w===4){l.push(new Float32Array([NaN,NaN,NaN,NaN,y[0],y[1],NaN,NaN,NaN,NaN,y[2],y[3]]));continue}const S=new Float32Array(3*(w-2));l.push(S);let[j,A,k,_]=y.subarray(0,4);S.set([NaN,NaN,NaN,NaN,j,A],0);for(let L=4;L<w;L+=2){const D=y[L],P=y[L+1];S.set(We.createBezierPoints(j,A,k,_,D,P),(L-2)*3),[j,A,k,_]=[k,_,D,P]}}}for(let y=0,w=l.length;y<w;y++)f.push({line:b(l[y].map(S=>S??NaN),m,p,x,g),points:b(c[y].map(S=>S??NaN),m,p,x,g)});const v=new this.prototype.constructor;return v.build(f,r,a,1,d,h,o),v}get box(){return u(this,br)}updateProperty(t,n){return t==="stroke-width"?F(this,Wn,_V).call(this,n):null}updateParentDimensions([t,n],r){const[a,o]=F(this,Wn,Ll).call(this);N(this,rl,t),N(this,il,n),N(this,sx,r);const[l,c]=F(this,Wn,Ll).call(this),d=l-a,h=c-o,f=u(this,br);return f[0]-=d,f[1]-=h,f[2]+=2*d,f[3]+=2*h,f}updateRotation(t){return N(this,W0,t),{path:{transform:this.rotationTransform}}}get viewBox(){return u(this,br).map(We.svgRound).join(" ")}get defaultProperties(){const[t,n]=u(this,br);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${We.svgRound(t)} ${We.svgRound(n)}`}}}get rotationTransform(){const[,,t,n]=u(this,br);let r=0,a=0,o=0,l=0,c=0,d=0;switch(u(this,W0)){case 90:a=n/t,o=-t/n,c=t;break;case 180:r=-1,l=-1,c=t,d=n;break;case 270:a=-n/t,o=t/n,d=n;break;default:return""}return`matrix(${r} ${a} ${o} ${l} ${We.svgRound(c)} ${We.svgRound(d)})`}getPathResizingSVGProperties([t,n,r,a]){const[o,l]=F(this,Wn,Ll).call(this),[c,d,h,f]=u(this,br);if(Math.abs(h-o)<=We.PRECISION||Math.abs(f-l)<=We.PRECISION){const b=t+r/2-(c+h/2),v=n+a/2-(d+f/2);return{path:{"transform-origin":`${We.svgRound(t)} ${We.svgRound(n)}`,transform:`${this.rotationTransform} translate(${b} ${v})`}}}const m=(r-2*o)/(h-2*o),p=(a-2*l)/(f-2*l),x=h/r,g=f/a;return{path:{"transform-origin":`${We.svgRound(c)} ${We.svgRound(d)}`,transform:`${this.rotationTransform} scale(${x} ${g}) translate(${We.svgRound(o)} ${We.svgRound(l)}) scale(${m} ${p}) translate(${We.svgRound(-o)} ${We.svgRound(-l)})`}}}getPathResizedSVGProperties([t,n,r,a]){const[o,l]=F(this,Wn,Ll).call(this),c=u(this,br),[d,h,f,m]=c;if(c[0]=t,c[1]=n,c[2]=r,c[3]=a,Math.abs(f-o)<=We.PRECISION||Math.abs(m-l)<=We.PRECISION){const v=t+r/2-(d+f/2),y=n+a/2-(h+m/2);for(const{line:w,points:S}of u(this,Pi))We._translate(w,v,y,w),We._translate(S,v,y,S);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${We.svgRound(t)} ${We.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const p=(r-2*o)/(f-2*o),x=(a-2*l)/(m-2*l),g=-p*(d+o)+t+o,b=-x*(h+l)+n+l;if(p!==1||x!==1||g!==0||b!==0)for(const{line:v,points:y}of u(this,Pi))We._rescale(v,g,b,p,x,v),We._rescale(y,g,b,p,x,y);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${We.svgRound(t)} ${We.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,n],r){const[a,o]=r,l=u(this,br),c=t-l[0],d=n-l[1];if(u(this,rl)===a&&u(this,il)===o)for(const{line:h,points:f}of u(this,Pi))We._translate(h,c,d,h),We._translate(f,c,d,f);else{const h=u(this,rl)/a,f=u(this,il)/o;N(this,rl,a),N(this,il,o);for(const{line:m,points:p}of u(this,Pi))We._rescale(m,c,d,h,f,m),We._rescale(p,c,d,h,f,p);l[2]*=h,l[3]*=f}return l[0]=t,l[1]=n,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${We.svgRound(t)} ${We.svgRound(n)}`}}}get defaultSVGProperties(){const t=u(this,br);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${We.svgRound(t[0])} ${We.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}br=new WeakMap,W0=new WeakMap,q0=new WeakMap,Pi=new WeakMap,rl=new WeakMap,il=new WeakMap,sx=new WeakMap,nx=new WeakMap,Bf=new WeakMap,Wn=new WeakSet,Ll=function(t=u(this,Bf)){const n=u(this,q0)+t/2*u(this,sx);return u(this,nx)%180===0?[n/u(this,rl),n/u(this,il)]:[n/u(this,il),n/u(this,rl)]},NV=function(){const[t,n,r,a]=u(this,br),[o,l]=F(this,Wn,Ll).call(this,0);return[t+o,n+l,r-2*o,a-2*l]},AV=function(){const t=N(this,br,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:a}of u(this,Pi)){if(a.length<=12){for(let c=4,d=a.length;c<d;c+=6)Ge.pointBoundingBox(a[c],a[c+1],t);continue}let o=a[4],l=a[5];for(let c=6,d=a.length;c<d;c+=6){const[h,f,m,p,x,g]=a.subarray(c,c+6);Ge.bezierBoundingBox(o,l,h,f,m,p,x,g,t),o=x,l=g}}const[n,r]=F(this,Wn,Ll).call(this);t[0]=jr(t[0]-n,0,1),t[1]=jr(t[1]-r,0,1),t[2]=jr(t[2]+n,0,1),t[3]=jr(t[3]+r,0,1),t[2]-=t[0],t[3]-=t[1]},_V=function(t){const[n,r]=F(this,Wn,Ll).call(this);N(this,Bf,t);const[a,o]=F(this,Wn,Ll).call(this),[l,c]=[a-n,o-r],d=u(this,br);return d[0]-=l,d[1]-=c,d[2]+=2*l,d[3]+=2*c,d};class $k extends jV{constructor(e){super(),this._viewParameters=e,super.updateProperties({fill:"none",stroke:ms._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,t){e==="stroke-width"&&(t??(t=this["stroke-width"]),t*=this._viewParameters.realScale),super.updateSVGProperty(e,t)}clone(){const e=new $k(this._viewParameters);return e.updateAll(this),e}}var dj,TV;const yp=class yp extends US{constructor(t){super({...t,name:"inkEditor"});E(this,dj);this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,n){ms.initialize(t,n),this._defaultDrawingOptions=new $k(n.viewParameters)}static getDefaultDrawingOptions(t){const n=this._defaultDrawingOptions.clone();return n.updateProperties(t),n}static get supportMultipleDrawings(){return!0}static get typesMap(){return bt(this,"typesMap",new Map([[Lt.INK_THICKNESS,"stroke-width"],[Lt.INK_COLOR,"stroke"],[Lt.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,n,r,a,o){return new Bhe(t,n,r,a,o,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,n,r,a,o,l){return gw.deserialize(t,n,r,a,o,l)}static async deserialize(t,n,r){let a=null;if(t instanceof UM){const{data:{inkLists:l,rect:c,rotation:d,id:h,color:f,opacity:m,borderStyle:{rawWidth:p},popupRef:x,richText:g,contentsObj:b,creationDate:v,modificationDate:y},parent:{page:{pageNumber:w}}}=t;a=t={annotationType:pt.INK,color:Array.from(f),thickness:p,opacity:m,paths:{points:l},boxes:null,pageIndex:w-1,rect:c.slice(0),rotation:d,annotationElementId:h,id:h,deleted:!1,popupRef:x,richText:g,comment:(b==null?void 0:b.str)||null,creationDate:v,modificationDate:y}}const o=await super.deserialize(t,n,r);return o._initialData=a,t.comment&&o.setCommentData(t),o}get toolbarButtons(){return this._colorPicker||(this._colorPicker=new OS(this)),[["colorPicker",this._colorPicker]]}get colorType(){return Lt.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:n,parent:r}=this;n.updateSVGProperty("stroke-width"),r.drawLayer.updateProperties(t,n.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:n,opacity:r}){this._drawingOptions=yp.getDefaultDrawingOptions({stroke:Ge.makeHexColor(...t),"stroke-width":n,"stroke-opacity":r})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:n,points:r}=this.serializeDraw(t),{_drawingOptions:{stroke:a,"stroke-opacity":o,"stroke-width":l}}=this,c=Object.assign(super.serialize(t),{color:ms._colorManager.convert(a),opacity:o,thickness:l,paths:{lines:n,points:r}});return this.addComment(c),t?(c.isCopy=!0,c):this.annotationElementId&&!F(this,dj,TV).call(this,c)?null:(c.id=this.annotationElementId,c)}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const{points:n,rect:r}=this.serializeDraw(!1);return t.updateEdited({rect:r,thickness:this._drawingOptions["stroke-width"],points:n,popup:this.comment}),null}};dj=new WeakSet,TV=function(t){const{color:n,thickness:r,opacity:a,pageIndex:o}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||t.color.some((l,c)=>l!==n[c])||t.thickness!==r||t.opacity!==a||t.pageIndex!==o},Ce(yp,"_type","ink"),Ce(yp,"_editorType",pt.INK),Ce(yp,"_defaultDrawingOptions",null);let z2=yp;class H2 extends gw{toSVGPath(){let e=super.toSVGPath();return e.endsWith("Z")||(e+="Z"),e}}const f1=8,dy=3;var $f,Gt,V2,ro,EV,PV,W2,mC,MV,IV,RV,q2,G2,DV;class Sc{static extractContoursFromText(e,{fontFamily:t,fontStyle:n,fontWeight:r},a,o,l,c){let d=new OffscreenCanvas(1,1),h=d.getContext("2d",{alpha:!1});const f=200,m=h.font=`${n} ${r} ${f}px ${t}`,{actualBoundingBoxLeft:p,actualBoundingBoxRight:x,actualBoundingBoxAscent:g,actualBoundingBoxDescent:b,fontBoundingBoxAscent:v,fontBoundingBoxDescent:y,width:w}=h.measureText(e),S=1.5,j=Math.ceil(Math.max(Math.abs(p)+Math.abs(x)||0,w)*S),A=Math.ceil(Math.max(Math.abs(g)+Math.abs(b)||f,Math.abs(v)+Math.abs(y)||f)*S);d=new OffscreenCanvas(j,A),h=d.getContext("2d",{alpha:!0,willReadFrequently:!0}),h.font=m,h.filter="grayscale(1)",h.fillStyle="white",h.fillRect(0,0,j,A),h.fillStyle="black",h.fillText(e,j*(S-1)/2,A*(3-S)/2);const k=F(this,Gt,q2).call(this,h.getImageData(0,0,j,A).data),_=F(this,Gt,RV).call(this,k),L=F(this,Gt,G2).call(this,_),D=F(this,Gt,W2).call(this,k,j,A,L);return this.processDrawnLines({lines:{curves:D,width:j,height:A},pageWidth:a,pageHeight:o,rotation:l,innerMargin:c,mustSmooth:!0,areContours:!0})}static process(e,t,n,r,a){const[o,l,c]=F(this,Gt,DV).call(this,e),[d,h]=F(this,Gt,IV).call(this,o,l,c,Math.hypot(l,c)*u(this,$f).sigmaSFactor,u(this,$f).sigmaR,u(this,$f).kernelSize),f=F(this,Gt,G2).call(this,h),m=F(this,Gt,W2).call(this,d,l,c,f);return this.processDrawnLines({lines:{curves:m,width:l,height:c},pageWidth:t,pageHeight:n,rotation:r,innerMargin:a,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:e,pageWidth:t,pageHeight:n,rotation:r,innerMargin:a,mustSmooth:o,areContours:l}){r%180!==0&&([t,n]=[n,t]);const{curves:c,width:d,height:h}=e,f=e.thickness??0,m=[],p=Math.min(t/d,n/h),x=p/t,g=p/n,b=[];for(const{points:y}of c){const w=o?F(this,Gt,MV).call(this,y):y;if(!w)continue;b.push(w);const S=w.length,j=new Float32Array(S),A=new Float32Array(3*(S===2?2:S-2));if(m.push({line:A,points:j}),S===2){j[0]=w[0]*x,j[1]=w[1]*g,A.set([NaN,NaN,NaN,NaN,j[0],j[1]],0);continue}let[k,_,L,D]=w;k*=x,_*=g,L*=x,D*=g,j.set([k,_,L,D],0),A.set([NaN,NaN,NaN,NaN,k,_],0);for(let P=4;P<S;P+=2){const T=j[P]=w[P]*x,B=j[P+1]=w[P+1]*g;A.set(We.createBezierPoints(k,_,L,D,T,B),(P-2)*3),[k,_,L,D]=[L,D,T,B]}}if(m.length===0)return null;const v=l?new H2:new gw;return v.build(m,t,n,1,r,l?0:f,a),{outline:v,newCurves:b,areContours:l,thickness:f,width:d,height:h}}static async compressSignature({outlines:e,areContours:t,thickness:n,width:r,height:a}){let o=1/0,l=-1/0,c=0;for(const w of e){c+=w.length;for(let S=2,j=w.length;S<j;S++){const A=w[S]-w[S-2];o=Math.min(o,A),l=Math.max(l,A)}}let d;o>=-128&&l<=127?d=Int8Array:o>=-32768&&l<=32767?d=Int16Array:d=Int32Array;const h=e.length,f=f1+dy*h,m=new Uint32Array(f);let p=0;m[p++]=f*Uint32Array.BYTES_PER_ELEMENT+(c-2*h)*d.BYTES_PER_ELEMENT,m[p++]=0,m[p++]=r,m[p++]=a,m[p++]=t?0:1,m[p++]=Math.max(0,Math.floor(n??0)),m[p++]=h,m[p++]=d.BYTES_PER_ELEMENT;for(const w of e)m[p++]=w.length-2,m[p++]=w[0],m[p++]=w[1];const x=new CompressionStream("deflate-raw"),g=x.writable.getWriter();await g.ready,g.write(m);const b=d.prototype.constructor;for(const w of e){const S=new b(w.length-2);for(let j=2,A=w.length;j<A;j++)S[j-2]=w[j]-w[j-2];g.write(S)}g.close();const v=await new Response(x.readable).arrayBuffer(),y=new Uint8Array(v);return Mz(y)}static async decompressSignature(e){try{const t=sue(e),{readable:n,writable:r}=new DecompressionStream("deflate-raw"),a=r.getWriter();await a.ready,a.write(t).then(async()=>{await a.ready,await a.close()}).catch(()=>{});let o=null,l=0;for await(const w of n)o||(o=new Uint8Array(new Uint32Array(w.buffer,0,4)[0])),o.set(w,l),l+=w.length;const c=new Uint32Array(o.buffer,0,o.length>>2),d=c[1];if(d!==0)throw new Error(`Invalid version: ${d}`);const h=c[2],f=c[3],m=c[4]===0,p=c[5],x=c[6],g=c[7],b=[],v=(f1+dy*x)*Uint32Array.BYTES_PER_ELEMENT;let y;switch(g){case Int8Array.BYTES_PER_ELEMENT:y=new Int8Array(o.buffer,v);break;case Int16Array.BYTES_PER_ELEMENT:y=new Int16Array(o.buffer,v);break;case Int32Array.BYTES_PER_ELEMENT:y=new Int32Array(o.buffer,v);break}l=0;for(let w=0;w<x;w++){const S=c[dy*w+f1],j=new Float32Array(S+2);b.push(j);for(let A=0;A<dy-1;A++)j[A]=c[dy*w+f1+A+1];for(let A=0;A<S;A++)j[A+2]=j[A]+y[l++]}return{areContours:m,thickness:p,outlines:b,width:h,height:f}}catch(t){return ut(`decompressSignature: ${t}`),null}}}$f=new WeakMap,Gt=new WeakSet,V2=function(e,t,n,r){return n-=e,r-=t,n===0?r>0?0:4:n===1?r+6:2-r},ro=new WeakMap,EV=function(e,t,n,r,a,o,l){const c=F(this,Gt,V2).call(this,n,r,a,o);for(let d=0;d<8;d++){const h=(-d+c-l+16)%8,f=u(this,ro)[2*h],m=u(this,ro)[2*h+1];if(e[(n+f)*t+(r+m)]!==0)return h}return-1},PV=function(e,t,n,r,a,o,l){const c=F(this,Gt,V2).call(this,n,r,a,o);for(let d=0;d<8;d++){const h=(d+c+l+16)%8,f=u(this,ro)[2*h],m=u(this,ro)[2*h+1];if(e[(n+f)*t+(r+m)]!==0)return h}return-1},W2=function(e,t,n,r){const a=e.length,o=new Int32Array(a);for(let h=0;h<a;h++)o[h]=e[h]<=r?1:0;for(let h=1;h<n-1;h++)o[h*t]=o[h*t+t-1]=0;for(let h=0;h<t;h++)o[h]=o[t*n-1-h]=0;let l=1,c;const d=[];for(let h=1;h<n-1;h++){c=1;for(let f=1;f<t-1;f++){const m=h*t+f,p=o[m];if(p===0)continue;let x=h,g=f;if(p===1&&o[m-1]===0)l+=1,g-=1;else if(p>=1&&o[m+1]===0)l+=1,g+=1,p>1&&(c=p);else{p!==1&&(c=Math.abs(p));continue}const b=[f,h],v=g===f+1,y={isHole:v,points:b,id:l,parent:0};d.push(y);let w;for(const P of d)if(P.id===c){w=P;break}w?w.isHole?y.parent=v?w.parent:c:y.parent=v?c:w.parent:y.parent=v?c:0;const S=F(this,Gt,EV).call(this,o,t,h,f,x,g,0);if(S===-1){o[m]=-l,o[m]!==1&&(c=Math.abs(o[m]));continue}let j=u(this,ro)[2*S],A=u(this,ro)[2*S+1];const k=h+j,_=f+A;x=k,g=_;let L=h,D=f;for(;;){const P=F(this,Gt,PV).call(this,o,t,L,D,x,g,1);j=u(this,ro)[2*P],A=u(this,ro)[2*P+1];const T=L+j,B=D+A;b.push(B,T);const R=L*t+D;if(o[R+1]===0?o[R]=-l:o[R]===1&&(o[R]=l),T===h&&B===f&&L===k&&D===_){o[m]!==1&&(c=Math.abs(o[m]));break}else x=L,g=D,L=T,D=B}}}return d},mC=function(e,t,n,r){if(n-t<=4){for(let k=t;k<n-2;k+=2)r.push(e[k],e[k+1]);return}const a=e[t],o=e[t+1],l=e[n-4]-a,c=e[n-3]-o,d=Math.hypot(l,c),h=l/d,f=c/d,m=h*o-f*a,p=c/l,x=1/d,g=Math.atan(p),b=Math.cos(g),v=Math.sin(g),y=x*(Math.abs(b)+Math.abs(v)),w=x*(1-y+y**2),S=Math.max(Math.atan(Math.abs(v+b)*w),Math.atan(Math.abs(v-b)*w));let j=0,A=t;for(let k=t+2;k<n-2;k+=2){const _=Math.abs(m-h*e[k+1]+f*e[k]);_>j&&(A=k,j=_)}j>(d*S)**2?(F(this,Gt,mC).call(this,e,t,A+2,r),F(this,Gt,mC).call(this,e,A,n,r)):r.push(a,o)},MV=function(e){const t=[],n=e.length;return F(this,Gt,mC).call(this,e,0,n,t),t.push(e[n-2],e[n-1]),t.length<=4?null:t},IV=function(e,t,n,r,a,o){const l=new Float32Array(o**2),c=-2*r**2,d=o>>1;for(let g=0;g<o;g++){const b=(g-d)**2;for(let v=0;v<o;v++)l[g*o+v]=Math.exp((b+(v-d)**2)/c)}const h=new Float32Array(256),f=-2*a**2;for(let g=0;g<256;g++)h[g]=Math.exp(g**2/f);const m=e.length,p=new Uint8Array(m),x=new Uint32Array(256);for(let g=0;g<n;g++)for(let b=0;b<t;b++){const v=g*t+b,y=e[v];let w=0,S=0;for(let A=0;A<o;A++){const k=g+A-d;if(!(k<0||k>=n))for(let _=0;_<o;_++){const L=b+_-d;if(L<0||L>=t)continue;const D=e[k*t+L],P=l[A*o+_]*h[Math.abs(D-y)];w+=D*P,S+=P}}const j=p[v]=Math.round(w/S);x[j]++}return[p,x]},RV=function(e){const t=new Uint32Array(256);for(const n of e)t[n]++;return t},q2=function(e){const t=e.length,n=new Uint8ClampedArray(t>>2);let r=-1/0,a=1/0;for(let l=0,c=n.length;l<c;l++){const d=n[l]=e[l<<2];r=Math.max(r,d),a=Math.min(a,d)}const o=255/(r-a);for(let l=0,c=n.length;l<c;l++)n[l]=(n[l]-a)*o;return n},G2=function(e){let t,n=-1/0,r=-1/0;const a=e.findIndex(c=>c!==0);let o=a,l=a;for(t=a;t<256;t++){const c=e[t];c>n&&(t-o>r&&(r=t-o,l=t-1),n=c,o=t)}for(t=l-1;t>=0&&!(e[t]>e[t+1]);t--);return t},DV=function(e){const t=e,{width:n,height:r}=e,{maxDim:a}=u(this,$f);let o=n,l=r;if(n>a||r>a){let m=n,p=r,x=Math.log2(Math.max(n,r)/a);const g=Math.floor(x);x=x===g?g-1:g;for(let v=0;v<x;v++){o=Math.ceil(m/2),l=Math.ceil(p/2);const y=new OffscreenCanvas(o,l);y.getContext("2d").drawImage(e,0,0,m,p,0,0,o,l),m=o,p=l,e!==t&&e.close(),e=y.transferToImageBitmap()}const b=Math.min(a/o,a/l);o=Math.round(o*b),l=Math.round(l*b)}const d=new OffscreenCanvas(o,l).getContext("2d",{willReadFrequently:!0});d.fillStyle="white",d.fillRect(0,0,o,l),d.filter="grayscale(1)",d.drawImage(e,0,0,e.width,e.height,0,0,o,l);const h=d.getImageData(0,0,o,l).data;return[F(this,Gt,q2).call(this,h),o,l]},E(Sc,Gt),E(Sc,$f,{maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16}),E(Sc,ro,new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]));class zM extends jV{constructor(){super(),super.updateProperties({fill:ms._defaultLineColor,"stroke-width":0})}clone(){const e=new zM;return e.updateAll(this),e}}class HM extends $k{constructor(e){super(e),super.updateProperties({stroke:ms._defaultLineColor,"stroke-width":1})}clone(){const e=new HM(this._viewParameters);return e.updateAll(this),e}}var nu,al,ru,Uf;const mi=class mi extends US{constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"});E(this,nu,!1);E(this,al,null);E(this,ru,null);E(this,Uf,null);this._willKeepAspectRatio=!0,N(this,ru,t.signatureData||null),N(this,al,null),this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,n){ms.initialize(t,n),this._defaultDrawingOptions=new zM,this._defaultDrawnSignatureOptions=new HM(n.viewParameters)}static getDefaultDrawingOptions(t){const n=this._defaultDrawingOptions.clone();return n.updateProperties(t),n}static get supportMultipleDrawings(){return!1}static get typesMap(){return bt(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!u(this,al)}}static computeTelemetryFinalData(t){const n=t.get("hasDescription");return{hasAltText:n.get(!0)??0,hasNoAltText:n.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,n;const{_isCopy:r}=this;if(r&&(this._isCopy=!1,t=this.x,n=this.y),super.render(),this._drawId===null)if(u(this,ru)){const{lines:a,mustSmooth:o,areContours:l,description:c,uuid:d,heightInPage:h}=u(this,ru),{rawDims:{pageWidth:f,pageHeight:m},rotation:p}=this.parent.viewport,x=Sc.processDrawnLines({lines:a,pageWidth:f,pageHeight:m,rotation:p,innerMargin:mi._INNER_MARGIN,mustSmooth:o,areContours:l});this.addSignature(x,h,c,d)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:u(this,al)||""}));return r&&(this._isCopy=!0,this._moveAfterPaste(t,n)),this.div}setUuid(t){N(this,Uf,t),this.addEditToolbar()}getUuid(){return u(this,Uf)}get description(){return u(this,al)}set description(t){N(this,al,t),this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:t})),super.addEditToolbar().then(n=>{n==null||n.updateEditSignatureButton(t)}))}getSignaturePreview(){const{newCurves:t,areContours:n,thickness:r,width:a,height:o}=u(this,ru),l=Math.max(a,o),c=Sc.processDrawnLines({lines:{curves:t.map(d=>({points:d})),thickness:r,width:a,height:o},pageWidth:l,pageHeight:l,rotation:0,innerMargin:0,mustSmooth:!1,areContours:n});return{areContours:n,outline:c.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(t,n,r,a){const{x:o,y:l}=this,{outline:c}=N(this,ru,t);N(this,nu,c instanceof H2),this.description=r;let d;u(this,nu)?d=mi.getDefaultDrawingOptions():(d=mi._defaultDrawnSignatureOptions.clone(),d.updateProperties({"stroke-width":c.thickness})),this._addOutlines({drawOutlines:c,drawingOptions:d});const[,h]=this.pageDimensions;let f=n/h;f=f>=1?.5:f,this.width*=f/this.height,this.width>=1&&(f*=.9/this.width,this.width=.9),this.height=f,this.setDims(),this.x=o,this.y=l,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(a),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!a,hasDescription:!!r}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:n,pageHeight:r},rotation:a}=this.parent.viewport;return Sc.process(t,n,r,a,mi._INNER_MARGIN)}getFromText(t,n){const{rawDims:{pageWidth:r,pageHeight:a},rotation:o}=this.parent.viewport;return Sc.extractContoursFromText(t,n,r,a,o,mi._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:n,pageHeight:r},rotation:a}=this.parent.viewport;return Sc.processDrawnLines({lines:t,pageWidth:n,pageHeight:r,rotation:a,innerMargin:mi._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:n}){t?this._drawingOptions=mi.getDefaultDrawingOptions():(this._drawingOptions=mi._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":n}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:n,points:r}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":a}}=this,o=Object.assign(super.serialize(t),{isSignature:!0,areContours:u(this,nu),color:[0,0,0],thickness:u(this,nu)?0:a});return this.addComment(o),t?(o.paths={lines:n,points:r},o.uuid=u(this,Uf),o.isCopy=!0):o.lines=n,u(this,al)&&(o.accessibilityData={type:"Figure",alt:u(this,al)}),o}static deserializeDraw(t,n,r,a,o,l){return l.areContours?H2.deserialize(t,n,r,a,o,l):gw.deserialize(t,n,r,a,o,l)}static async deserialize(t,n,r){var o;const a=await super.deserialize(t,n,r);return N(a,nu,t.areContours),a.description=((o=t.accessibilityData)==null?void 0:o.alt)||"",N(a,Uf,t.uuid),a}};nu=new WeakMap,al=new WeakMap,ru=new WeakMap,Uf=new WeakMap,Ce(mi,"_type","signature"),Ce(mi,"_editorType",pt.SIGNATURE),Ce(mi,"_defaultDrawingOptions",null);let Y2=mi;var _s,Nn,iu,yc,au,rx,vc,zf,ol,Mi,ix,Ut,Vy,Wy,pC,gC,xC,X2,yC,LV;class K2 extends ms{constructor(t){super({...t,name:"stampEditor"});E(this,Ut);E(this,_s,null);E(this,Nn,null);E(this,iu,null);E(this,yc,null);E(this,au,null);E(this,rx,"");E(this,vc,null);E(this,zf,!1);E(this,ol,null);E(this,Mi,!1);E(this,ix,!1);N(this,yc,t.bitmapUrl),N(this,au,t.bitmapFile),this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,n){ms.initialize(t,n)}static isHandlingMimeForPasting(t){return RT.includes(t)}static paste(t,n){n.pasteEditor({mode:pt.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var t;return{type:"stamp",hasAltText:!!((t=this.altTextData)!=null&&t.altText)}}static computeTelemetryFinalData(t){const n=t.get("hasAltText");return{hasAltText:n.get(!0)??0,hasNoAltText:n.get(!1)??0}}async mlGuessAltText(t=null,n=!0){if(this.hasAltTextData())return null;const{mlManager:r}=this._uiManager;if(!r)throw new Error("No ML.");if(!await r.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:a,width:o,height:l}=t||this.copyCanvas(null,null,!0).imageData,c=await r.guess({name:"altText",request:{data:a,width:o,height:l,channels:a.length/(o*l)}});if(!c)throw new Error("No response from the AI service.");if(c.error)throw new Error("Error from the AI service.");if(c.cancel)return null;if(!c.output)throw new Error("No valid response from the AI service.");const d=c.output;return await this.setGuessedAltText(d),n&&!this.hasAltTextData()&&(this.altTextData={alt:d,decorative:!1}),d}remove(){var t;u(this,Nn)&&(N(this,_s,null),this._uiManager.imageManager.deleteId(u(this,Nn)),(t=u(this,vc))==null||t.remove(),N(this,vc,null),u(this,ol)&&(clearTimeout(u(this,ol)),N(this,ol,null))),super.remove()}rebuild(){if(!this.parent){u(this,Nn)&&F(this,Ut,pC).call(this);return}super.rebuild(),this.div!==null&&(u(this,Nn)&&u(this,vc)===null&&F(this,Ut,pC).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(u(this,iu)||u(this,_s)||u(this,yc)||u(this,au)||u(this,Nn)||u(this,zf))}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let t,n;return this._isCopy&&(t=this.x,n=this.y),super.render(),this.div.hidden=!0,this.createAltText(),u(this,zf)||(u(this,_s)?F(this,Ut,gC).call(this):F(this,Ut,pC).call(this)),this._isCopy&&this._moveAfterPaste(t,n),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,n){const{id:r,bitmap:a}=this._uiManager.imageManager.getFromCanvas(t,n);n.remove(),r&&this._uiManager.imageManager.isValidId(r)&&(N(this,Nn,r),a&&N(this,_s,a),N(this,zf,!1),F(this,Ut,gC).call(this))}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;u(this,ol)!==null&&clearTimeout(u(this,ol)),N(this,ol,setTimeout(()=>{N(this,ol,null),F(this,Ut,X2).call(this)},200))}copyCanvas(t,n,r=!1){t||(t=224);const{width:a,height:o}=u(this,_s),l=new Cl;let c=u(this,_s),d=a,h=o,f=null;if(n){if(a>n||o>n){const k=Math.min(n/a,n/o);d=Math.floor(a*k),h=Math.floor(o*k)}f=document.createElement("canvas");const p=f.width=Math.ceil(d*l.sx),x=f.height=Math.ceil(h*l.sy);u(this,Mi)||(c=F(this,Ut,xC).call(this,p,x));const g=f.getContext("2d");g.filter=this._uiManager.hcmFilter;let b="white",v="#cfcfd8";this._uiManager.hcmFilter!=="none"?v="black":lue.isDarkMode&&(b="#8f8f9d",v="#42414d");const y=15,w=y*l.sx,S=y*l.sy,j=new OffscreenCanvas(w*2,S*2),A=j.getContext("2d");A.fillStyle=b,A.fillRect(0,0,w*2,S*2),A.fillStyle=v,A.fillRect(0,0,w,S),A.fillRect(w,S,w,S),g.fillStyle=g.createPattern(j,"repeat"),g.fillRect(0,0,p,x),g.drawImage(c,0,0,c.width,c.height,0,0,p,x)}let m=null;if(r){let p,x;if(l.symmetric&&c.width<t&&c.height<t)p=c.width,x=c.height;else if(c=u(this,_s),a>t||o>t){const v=Math.min(t/a,t/o);p=Math.floor(a*v),x=Math.floor(o*v),u(this,Mi)||(c=F(this,Ut,xC).call(this,p,x))}const b=new OffscreenCanvas(p,x).getContext("2d",{willReadFrequently:!0});b.drawImage(c,0,0,c.width,c.height,0,0,p,x),m={width:p,height:x,data:b.getImageData(0,0,p,x).data}}return{canvas:f,width:d,height:h,imageData:m}}static async deserialize(t,n,r){var b;let a=null,o=!1;if(t instanceof ZH){const{data:{rect:v,rotation:y,id:w,structParent:S,popupRef:j,richText:A,contentsObj:k,creationDate:_,modificationDate:L},container:D,parent:{page:{pageNumber:P}},canvas:T}=t;let B,R;T?(delete t.canvas,{id:B,bitmap:R}=r.imageManager.getFromCanvas(D.id,T),T.remove()):(o=!0,t._hasNoCanvas=!0);const O=((b=await n._structTree.getAriaAttributes(`${fp}${w}`))==null?void 0:b.get("aria-label"))||"";a=t={annotationType:pt.STAMP,bitmapId:B,bitmap:R,pageIndex:P-1,rect:v.slice(0),rotation:y,annotationElementId:w,id:w,deleted:!1,accessibilityData:{decorative:!1,altText:O},isSvg:!1,structParent:S,popupRef:j,richText:A,comment:(k==null?void 0:k.str)||null,creationDate:_,modificationDate:L}}const l=await super.deserialize(t,n,r),{rect:c,bitmap:d,bitmapUrl:h,bitmapId:f,isSvg:m,accessibilityData:p}=t;o?(r.addMissingCanvas(t.id,l),N(l,zf,!0)):f&&r.imageManager.isValidId(f)?(N(l,Nn,f),d&&N(l,_s,d)):N(l,yc,h),N(l,Mi,m);const[x,g]=l.pageDimensions;return l.width=(c[2]-c[0])/x,l.height=(c[3]-c[1])/g,p&&(l.altTextData=p),l._initialData=a,t.comment&&l.setCommentData(t),N(l,ix,!!a),l}serialize(t=!1,n=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const r=Object.assign(super.serialize(t),{bitmapId:u(this,Nn),isSvg:u(this,Mi)});if(this.addComment(r),t)return r.bitmapUrl=F(this,Ut,yC).call(this,!0),r.accessibilityData=this.serializeAltText(!0),r.isCopy=!0,r;const{decorative:a,altText:o}=this.serializeAltText(!1);if(!a&&o&&(r.accessibilityData={type:"Figure",alt:o}),this.annotationElementId){const c=F(this,Ut,LV).call(this,r);return c.isSame?null:(c.isSameAltText?delete r.accessibilityData:r.accessibilityData.structParent=this._initialData.structParent??-1,r.id=this.annotationElementId,delete r.bitmapId,r)}if(n===null)return r;n.stamps||(n.stamps=new Map);const l=u(this,Mi)?(r.rect[2]-r.rect[0])*(r.rect[3]-r.rect[1]):null;if(!n.stamps.has(u(this,Nn)))n.stamps.set(u(this,Nn),{area:l,serialized:r}),r.bitmap=F(this,Ut,yC).call(this,!1);else if(u(this,Mi)){const c=n.stamps.get(u(this,Nn));l>c.area&&(c.area=l,c.serialized.bitmap.close(),c.serialized.bitmap=F(this,Ut,yC).call(this,!1))}return r}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}}_s=new WeakMap,Nn=new WeakMap,iu=new WeakMap,yc=new WeakMap,au=new WeakMap,rx=new WeakMap,vc=new WeakMap,zf=new WeakMap,ol=new WeakMap,Mi=new WeakMap,ix=new WeakMap,Ut=new WeakSet,Vy=function(t,n=!1){if(!t){this.remove();return}N(this,_s,t.bitmap),n||(N(this,Nn,t.id),N(this,Mi,t.isSvg)),t.file&&N(this,rx,t.file.name),F(this,Ut,gC).call(this)},Wy=function(){if(N(this,iu,null),this._uiManager.enableWaiting(!1),!!u(this,vc)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&u(this,_s)){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&u(this,_s)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},pC=function(){if(u(this,Nn)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(u(this,Nn)).then(r=>F(this,Ut,Vy).call(this,r,!0)).finally(()=>F(this,Ut,Wy).call(this));return}if(u(this,yc)){const r=u(this,yc);N(this,yc,null),this._uiManager.enableWaiting(!0),N(this,iu,this._uiManager.imageManager.getFromUrl(r).then(a=>F(this,Ut,Vy).call(this,a)).finally(()=>F(this,Ut,Wy).call(this)));return}if(u(this,au)){const r=u(this,au);N(this,au,null),this._uiManager.enableWaiting(!0),N(this,iu,this._uiManager.imageManager.getFromFile(r).then(a=>F(this,Ut,Vy).call(this,a)).finally(()=>F(this,Ut,Wy).call(this)));return}const t=document.createElement("input");t.type="file",t.accept=RT.join(",");const n=this._uiManager._signal;N(this,iu,new Promise(r=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const a=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),F(this,Ut,Vy).call(this,a)}r()},{signal:n}),t.addEventListener("cancel",()=>{this.remove(),r()},{signal:n})}).finally(()=>F(this,Ut,Wy).call(this))),t.click()},gC=function(){var d;const{div:t}=this;let{width:n,height:r}=u(this,_s);const[a,o]=this.pageDimensions,l=.75;if(this.width)n=this.width*a,r=this.height*o;else if(n>l*a||r>l*o){const h=Math.min(l*a/n,l*o/r);n*=h,r*=h}this._uiManager.enableWaiting(!1);const c=N(this,vc,document.createElement("canvas"));c.setAttribute("role","img"),this.addContainer(c),this.width=n/a,this.height=r/o,this.setDims(),(d=this._initialOptions)!=null&&d.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),F(this,Ut,X2).call(this),u(this,ix)||(this.parent.addUndoableEditor(this),N(this,ix,!0)),this._reportTelemetry({action:"inserted_image"}),u(this,rx)&&this.div.setAttribute("aria-description",u(this,rx)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")},xC=function(t,n){const{width:r,height:a}=u(this,_s);let o=r,l=a,c=u(this,_s);for(;o>2*t||l>2*n;){const d=o,h=l;o>2*t&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2)),l>2*n&&(l=l>=16384?Math.floor(l/2)-1:Math.ceil(l/2));const f=new OffscreenCanvas(o,l);f.getContext("2d").drawImage(c,0,0,d,h,0,0,o,l),c=f.transferToImageBitmap()}return c},X2=function(){const[t,n]=this.parentDimensions,{width:r,height:a}=this,o=new Cl,l=Math.ceil(r*t*o.sx),c=Math.ceil(a*n*o.sy),d=u(this,vc);if(!d||d.width===l&&d.height===c)return;d.width=l,d.height=c;const h=u(this,Mi)?u(this,_s):F(this,Ut,xC).call(this,l,c),f=d.getContext("2d");f.filter=this._uiManager.hcmFilter,f.drawImage(h,0,0,h.width,h.height,0,0,l,c)},yC=function(t){if(t){if(u(this,Mi)){const a=this._uiManager.imageManager.getSvgUrl(u(this,Nn));if(a)return a}const n=document.createElement("canvas");return{width:n.width,height:n.height}=u(this,_s),n.getContext("2d").drawImage(u(this,_s),0,0),n.toDataURL()}if(u(this,Mi)){const[n,r]=this.pageDimensions,a=Math.round(this.width*n*zu.PDF_TO_CSS_UNITS),o=Math.round(this.height*r*zu.PDF_TO_CSS_UNITS),l=new OffscreenCanvas(a,o);return l.getContext("2d").drawImage(u(this,_s),0,0,u(this,_s).width,u(this,_s).height,0,0,a,o),l.transferToImageBitmap()}return structuredClone(u(this,_s))},LV=function(t){var l;const{pageIndex:n,accessibilityData:{altText:r}}=this._initialData,a=t.pageIndex===n,o=(((l=t.accessibilityData)==null?void 0:l.alt)||"")===r;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&a&&o,isSameAltText:o}},Ce(K2,"_type","stamp"),Ce(K2,"_editorType",pt.STAMP);var Hf,ax,ou,lu,bc,Zr,cu,ox,lx,io,wc,An,Cc,du,cx,Qe,uu,ls,Z2,OV,Do,J2,eE,vC;const Va=class Va{constructor({uiManager:e,pageIndex:t,div:n,structTreeLayer:r,accessibilityManager:a,annotationLayer:o,drawLayer:l,textLayer:c,viewport:d,l10n:h}){E(this,ls);E(this,Hf);E(this,ax,!1);E(this,ou,null);E(this,lu,null);E(this,bc,null);E(this,Zr,new Map);E(this,cu,!1);E(this,ox,!1);E(this,lx,!1);E(this,io,null);E(this,wc,null);E(this,An,null);E(this,Cc,null);E(this,du,null);E(this,cx,-1);E(this,Qe);const f=[...u(Va,uu).values()];if(!Va._initialized){Va._initialized=!0;for(const m of f)m.initialize(h,e)}e.registerEditorTypes(f),N(this,Qe,e),this.pageIndex=t,this.div=n,N(this,Hf,a),N(this,ou,o),this.viewport=d,N(this,An,c),this.drawLayer=l,this._structTree=r,u(this,Qe).addLayer(this)}get isEmpty(){return u(this,Zr).size===0}get isInvisible(){return this.isEmpty&&u(this,Qe).getMode()===pt.NONE}updateToolbar(e){u(this,Qe).updateToolbar(e)}updateMode(e=u(this,Qe).getMode()){switch(F(this,ls,vC).call(this),e){case pt.NONE:this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case pt.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case pt.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;if(t.toggle("nonEditing",!1),e===pt.POPUP)t.toggle("commentEditing",!0);else{t.toggle("commentEditing",!1);for(const n of u(Va,uu).values())t.toggle(`${n._type}Editing`,e===n._editorType)}this.div.hidden=!1}hasTextLayer(e){var t;return e===((t=u(this,An))==null?void 0:t.div)}setEditingState(e){u(this,Qe).setEditingState(e)}addCommands(e){u(this,Qe).addCommands(e)}cleanUndoStack(e){u(this,Qe).cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){var t;(t=u(this,ou))==null||t.togglePointerEvents(e)}async enable(){var n;N(this,lx,!0),this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),(n=u(this,du))==null||n.abort(),N(this,du,null);const e=new Set;for(const r of u(this,ls,Z2))r.enableEditing(),r.show(!0),r.annotationElementId&&(u(this,Qe).removeChangedExistingAnnotation(r),e.add(r.annotationElementId));const t=u(this,ou);if(t)for(const r of t.getEditableAnnotations()){if(r.hide(),u(this,Qe).isDeletedAnnotationElement(r.data.id)||e.has(r.data.id))continue;const a=await this.deserialize(r);a&&(this.addOrRebuild(a),a.enableEditing())}N(this,lx,!1),u(this,Qe)._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){var r;if(N(this,ox,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),u(this,An)&&!u(this,du)){N(this,du,new AbortController);const a=u(this,Qe).combinedSignal(u(this,du));u(this,An).div.addEventListener("pointerdown",o=>{const{clientX:c,clientY:d,timeStamp:h}=o,f=u(this,cx);if(h-f>500){N(this,cx,h);return}N(this,cx,-1);const{classList:m}=this.div;m.toggle("getElements",!0);const p=document.elementsFromPoint(c,d);if(m.toggle("getElements",!1),!this.div.contains(p[0]))return;let x;const g=new RegExp(`^${qv}[0-9]+$`);for(const v of p)if(g.test(v.id)){x=v.id;break}if(!x)return;const b=u(this,Zr).get(x);(b==null?void 0:b.annotationElementId)===null&&(o.stopPropagation(),o.preventDefault(),b.dblclick(o))},{signal:a,capture:!0})}const e=u(this,ou),t=[];if(e){const a=new Map,o=new Map;for(const c of u(this,ls,Z2)){if(c.disableEditing(),!c.annotationElementId){t.push(c);continue}if(c.serialize()!==null){a.set(c.annotationElementId,c);continue}else o.set(c.annotationElementId,c);(r=this.getEditableAnnotation(c.annotationElementId))==null||r.show(),c.remove()}const l=e.getEditableAnnotations();for(const c of l){const{id:d}=c.data;if(u(this,Qe).isDeletedAnnotationElement(d)){c.updateEdited({deleted:!0});continue}let h=o.get(d);if(h){h.resetAnnotationElement(c),h.show(!1),c.show();continue}h=a.get(d),h&&(u(this,Qe).addChangedExistingAnnotation(h),h.renderAnnotationElement(c)&&h.show(!1)),c.show()}}F(this,ls,vC).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:n}=this.div;for(const a of u(Va,uu).values())n.remove(`${a._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),e==null||e.updateFakeAnnotations(t),N(this,ox,!1)}getEditableAnnotation(e){var t;return((t=u(this,ou))==null?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){u(this,Qe).getActive()!==e&&u(this,Qe).setActiveEditor(e)}enableTextSelection(){var e;if(this.div.tabIndex=-1,(e=u(this,An))!=null&&e.div&&!u(this,Cc)){N(this,Cc,new AbortController);const t=u(this,Qe).combinedSignal(u(this,Cc));u(this,An).div.addEventListener("pointerdown",F(this,ls,OV).bind(this),{signal:t}),u(this,An).div.classList.add("highlighting")}}disableTextSelection(){var e;this.div.tabIndex=0,(e=u(this,An))!=null&&e.div&&u(this,Cc)&&(u(this,Cc).abort(),N(this,Cc,null),u(this,An).div.classList.remove("highlighting"))}enableClick(){if(u(this,lu))return;N(this,lu,new AbortController);const e=u(this,Qe).combinedSignal(u(this,lu));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){var e;(e=u(this,lu))==null||e.abort(),N(this,lu,null)}attach(e){u(this,Zr).set(e.id,e);const{annotationElementId:t}=e;t&&u(this,Qe).isDeletedAnnotationElement(t)&&u(this,Qe).removeDeletedAnnotationElement(e)}detach(e){var t;u(this,Zr).delete(e.id),(t=u(this,Hf))==null||t.removePointerInTextLayer(e.contentDiv),!u(this,ox)&&e.annotationElementId&&u(this,Qe).addDeletedAnnotationElement(e)}remove(e){this.detach(e),u(this,Qe).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){var t;e.parent!==this&&(e.parent&&e.annotationElementId&&(u(this,Qe).addDeletedAnnotationElement(e.annotationElementId),ms.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),(t=e.parent)==null||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),u(this,Qe).addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!u(this,lx)),u(this,Qe).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){var n;if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!u(this,bc)&&(e._focusEventsAllowed=!1,N(this,bc,setTimeout(()=>{N(this,bc,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:u(this,Qe)._signal}),t.focus())},0))),e._structTreeParentId=(n=u(this,Hf))==null?void 0:n.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),n=()=>{e.remove()};this.addCommands({cmd:t,undo:n,mustExec:!1})}getEditorByUID(e){for(const t of u(this,Zr).values())if(t.uid===e)return t;return null}getNextId(){return u(this,Qe).getId()}combinedSignal(e){return u(this,Qe).combinedSignal(e)}canCreateNewEmptyEditor(){var e;return(e=u(this,ls,Do))==null?void 0:e.canCreateNewEmptyEditor()}async pasteEditor(e,t){this.updateToolbar(e),await u(this,Qe).updateMode(e.mode);const{offsetX:n,offsetY:r}=F(this,ls,eE).call(this),a=this.getNextId(),o=F(this,ls,J2).call(this,{parent:this,id:a,x:n,y:r,uiManager:u(this,Qe),isCentered:!0,...t});o&&this.add(o)}async deserialize(e){var t;return await((t=u(Va,uu).get(e.annotationType??e.annotationEditorType))==null?void 0:t.deserialize(e,this,u(this,Qe)))||null}createAndAddNewEditor(e,t,n={}){const r=this.getNextId(),a=F(this,ls,J2).call(this,{parent:this,id:r,x:e.offsetX,y:e.offsetY,uiManager:u(this,Qe),isCentered:t,...n});return a&&this.add(a),a}get boundingClientRect(){return this.div.getBoundingClientRect()}addNewEditor(e={}){this.createAndAddNewEditor(F(this,ls,eE).call(this),!0,e)}setSelected(e){u(this,Qe).setSelected(e)}toggleSelected(e){u(this,Qe).toggleSelected(e)}unselect(e){u(this,Qe).unselect(e)}pointerup(e){var r;const{isMac:t}=Yn.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div||!u(this,cu)||(N(this,cu,!1),(r=u(this,ls,Do))!=null&&r.isDrawer&&u(this,ls,Do).supportMultipleDrawings))return;if(!u(this,ax)){N(this,ax,!0);return}const n=u(this,Qe).getMode();if(n===pt.STAMP||n===pt.SIGNATURE){u(this,Qe).unselectAll();return}this.createAndAddNewEditor(e,!1)}pointerdown(e){var r;if(u(this,Qe).getMode()===pt.HIGHLIGHT&&this.enableTextSelection(),u(this,cu)){N(this,cu,!1);return}const{isMac:t}=Yn.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(N(this,cu,!0),(r=u(this,ls,Do))!=null&&r.isDrawer){this.startDrawingSession(e);return}const n=u(this,Qe).getActive();N(this,ax,!n||n.isEmpty())}startDrawingSession(e){if(this.div.focus({preventScroll:!0}),u(this,io)){u(this,ls,Do).startDrawing(this,u(this,Qe),!1,e);return}u(this,Qe).setCurrentDrawingSession(this),N(this,io,new AbortController);const t=u(this,Qe).combinedSignal(u(this,io));this.div.addEventListener("blur",({relatedTarget:n})=>{n&&!this.div.contains(n)&&(N(this,wc,null),this.commitOrRemove())},{signal:t}),u(this,ls,Do).startDrawing(this,u(this,Qe),!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&N(this,wc,t);return}u(this,wc)&&setTimeout(()=>{var t;(t=u(this,wc))==null||t.focus(),N(this,wc,null)},0)}endDrawingSession(e=!1){return u(this,io)?(u(this,Qe).setCurrentDrawingSession(null),u(this,io).abort(),N(this,io,null),N(this,wc,null),u(this,ls,Do).endDrawing(e)):null}findNewParent(e,t,n){const r=u(this,Qe).findParent(t,n);return r===null||r===this?!1:(r.changeParent(e),!0)}commitOrRemove(){return u(this,io)?(this.endDrawingSession(),!0):!1}onScaleChanging(){u(this,io)&&u(this,ls,Do).onScaleChangingWhenDrawing(this)}destroy(){var e,t;this.commitOrRemove(),((e=u(this,Qe).getActive())==null?void 0:e.parent)===this&&(u(this,Qe).commitOrRemove(),u(this,Qe).setActiveEditor(null)),u(this,bc)&&(clearTimeout(u(this,bc)),N(this,bc,null));for(const n of u(this,Zr).values())(t=u(this,Hf))==null||t.removePointerInTextLayer(n.contentDiv),n.setParent(null),n.isAttachedToDOM=!1,n.div.remove();this.div=null,u(this,Zr).clear(),u(this,Qe).removeLayer(this)}render({viewport:e}){this.viewport=e,mm(this.div,e);for(const t of u(this,Qe).getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){u(this,Qe).commitOrRemove(),F(this,ls,vC).call(this);const t=this.viewport.rotation,n=e.rotation;if(this.viewport=e,mm(this.div,{rotation:n}),t!==n)for(const r of u(this,Zr).values())r.rotate(n)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return u(this,Qe).viewParameters.realScale}};Hf=new WeakMap,ax=new WeakMap,ou=new WeakMap,lu=new WeakMap,bc=new WeakMap,Zr=new WeakMap,cu=new WeakMap,ox=new WeakMap,lx=new WeakMap,io=new WeakMap,wc=new WeakMap,An=new WeakMap,Cc=new WeakMap,du=new WeakMap,cx=new WeakMap,Qe=new WeakMap,uu=new WeakMap,ls=new WeakSet,Z2=function(){return u(this,Zr).size!==0?u(this,Zr).values():u(this,Qe).getEditors(this.pageIndex)},OV=function(e){u(this,Qe).unselectAll();const{target:t}=e;if(t===u(this,An).div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&u(this,An).div.contains(t)){const{isMac:n}=Yn.platform;if(e.button!==0||e.ctrlKey&&n)return;u(this,Qe).showAllEditors("highlight",!0,!0),u(this,An).div.classList.add("free"),this.toggleDrawing(),$S.startHighlighting(this,u(this,Qe).direction==="ltr",{target:u(this,An).div,x:e.x,y:e.y}),u(this,An).div.addEventListener("pointerup",()=>{u(this,An).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:u(this,Qe)._signal}),e.preventDefault()}},Do=function(){return u(Va,uu).get(u(this,Qe).getMode())},J2=function(e){const t=u(this,ls,Do);return t?new t.prototype.constructor(e):null},eE=function(){const{x:e,y:t,width:n,height:r}=this.boundingClientRect,a=Math.max(0,e),o=Math.max(0,t),l=Math.min(window.innerWidth,e+n),c=Math.min(window.innerHeight,t+r),d=(a+l)/2-e,h=(o+c)/2-t,[f,m]=this.viewport.rotation%180===0?[d,h]:[h,d];return{offsetX:f,offsetY:m}},vC=function(){for(const e of u(this,Zr).values())e.isEmpty()&&e.remove()},Ce(Va,"_initialized",!1),E(Va,uu,new Map([M2,z2,K2,$S,Y2].map(e=>[e._editorType,e])));let Q2=Va;var ao,wr,Vf,G0,uj,FV,Sl,sE,BV,nE;const fn=class fn{constructor({pageIndex:e}){E(this,Sl);E(this,ao,null);E(this,wr,new Map);E(this,Vf,new Map);this.pageIndex=e}setParent(e){if(!u(this,ao)){N(this,ao,e);return}if(u(this,ao)!==e){if(u(this,wr).size>0)for(const t of u(this,wr).values())t.remove(),e.append(t);N(this,ao,e)}}static get _svgFactory(){return bt(this,"_svgFactory",new FS)}draw(e,t=!1,n=!1){const r=Fs(fn,G0)._++,a=F(this,Sl,sE).call(this),o=fn._svgFactory.createElement("defs");a.append(o);const l=fn._svgFactory.createElement("path");o.append(l);const c=`path_p${this.pageIndex}_${r}`;l.setAttribute("id",c),l.setAttribute("vector-effect","non-scaling-stroke"),t&&u(this,Vf).set(r,l);const d=n?F(this,Sl,BV).call(this,o,c):null,h=fn._svgFactory.createElement("use");return a.append(h),h.setAttribute("href",`#${c}`),this.updateProperties(a,e),u(this,wr).set(r,a),{id:r,clipPathId:`url(#${d})`}}drawOutline(e,t){const n=Fs(fn,G0)._++,r=F(this,Sl,sE).call(this),a=fn._svgFactory.createElement("defs");r.append(a);const o=fn._svgFactory.createElement("path");a.append(o);const l=`path_p${this.pageIndex}_${n}`;o.setAttribute("id",l),o.setAttribute("vector-effect","non-scaling-stroke");let c;if(t){const f=fn._svgFactory.createElement("mask");a.append(f),c=`mask_p${this.pageIndex}_${n}`,f.setAttribute("id",c),f.setAttribute("maskUnits","objectBoundingBox");const m=fn._svgFactory.createElement("rect");f.append(m),m.setAttribute("width","1"),m.setAttribute("height","1"),m.setAttribute("fill","white");const p=fn._svgFactory.createElement("use");f.append(p),p.setAttribute("href",`#${l}`),p.setAttribute("stroke","none"),p.setAttribute("fill","black"),p.setAttribute("fill-rule","nonzero"),p.classList.add("mask")}const d=fn._svgFactory.createElement("use");r.append(d),d.setAttribute("href",`#${l}`),c&&d.setAttribute("mask",`url(#${c})`);const h=d.cloneNode();return r.append(h),d.classList.add("mainOutline"),h.classList.add("secondaryOutline"),this.updateProperties(r,e),u(this,wr).set(n,r),n}finalizeDraw(e,t){u(this,Vf).delete(e),this.updateProperties(e,t)}updateProperties(e,t){var c;if(!t)return;const{root:n,bbox:r,rootClass:a,path:o}=t,l=typeof e=="number"?u(this,wr).get(e):e;if(l){if(n&&F(this,Sl,nE).call(this,l,n),r&&F(c=fn,uj,FV).call(c,l,r),a){const{classList:d}=l;for(const[h,f]of Object.entries(a))d.toggle(h,f)}if(o){const h=l.firstChild.firstChild;F(this,Sl,nE).call(this,h,o)}}}updateParent(e,t){if(t===this)return;const n=u(this,wr).get(e);n&&(u(t,ao).append(n),u(this,wr).delete(e),u(t,wr).set(e,n))}remove(e){u(this,Vf).delete(e),u(this,ao)!==null&&(u(this,wr).get(e).remove(),u(this,wr).delete(e))}destroy(){N(this,ao,null);for(const e of u(this,wr).values())e.remove();u(this,wr).clear(),u(this,Vf).clear()}};ao=new WeakMap,wr=new WeakMap,Vf=new WeakMap,G0=new WeakMap,uj=new WeakSet,FV=function(e,[t,n,r,a]){const{style:o}=e;o.top=`${100*n}%`,o.left=`${100*t}%`,o.width=`${100*r}%`,o.height=`${100*a}%`},Sl=new WeakSet,sE=function(){const e=fn._svgFactory.create(1,1,!0);return u(this,ao).append(e),e.setAttribute("aria-hidden",!0),e},BV=function(e,t){const n=fn._svgFactory.createElement("clipPath");e.append(n);const r=`clip_${t}`;n.setAttribute("id",r),n.setAttribute("clipPathUnits","objectBoundingBox");const a=fn._svgFactory.createElement("use");return n.append(a),a.setAttribute("href",`#${t}`),a.classList.add("clip"),r},nE=function(e,t){for(const[n,r]of Object.entries(t))r===null?e.removeAttribute(n):e.setAttribute(n,r)},E(fn,uj),E(fn,G0,0);let tE=fn;globalThis._pdfjsTestingUtils={HighlightOutliner:R2};globalThis.pdfjsLib={AbortException:Uu,AnnotationEditorLayer:Q2,AnnotationEditorParamsType:Lt,AnnotationEditorType:pt,AnnotationEditorUIManager:pm,AnnotationLayer:E2,AnnotationMode:md,AnnotationType:sn,applyOpacity:due,build:ghe,ColorPicker:LS,createValidAbsoluteUrl:_z,CSSConstants:cue,DOMSVGFactory:FS,DrawLayer:tE,FeatureTest:Yn,fetchData:uw,findContrastColor:uue,getDocument:LH,getFilenameFromUrl:nue,getPdfFilenameFromUrl:rue,getRGB:fw,getUuid:Pz,getXfaPageViewport:aue,GlobalWorkerOptions:dr,ImageKind:$1,InvalidPDFException:MT,isDataScheme:Fk,isPdfFile:LM,isValidExplicitDest:wue,MathClamp:jr,noContextMenu:La,normalizeUnicode:eue,OPS:Gv,OutputScale:Cl,PasswordResponses:Wde,PDFDataRangeTransport:OH,PDFDateString:ES,PDFWorker:Xv,PermissionFlag:Vde,PixelsPerInch:zu,RenderingCancelledException:DM,renderRichText:Rz,ResponseException:TS,setLayerDimensions:mm,shadow:bt,SignatureExtractor:Sc,stopEvent:Gs,SupportedImageMimeTypes:RT,TextLayer:Kv,TouchManager:MS,updateUrlHash:Tz,Util:Ge,VerbosityLevel:Dk,version:$H,XfaLayer:Iz};const $he="/assets/pdf.worker.min-Cpi8b8z3.mjs";function Uhe(){if(typeof window>"u"){dr.workerSrc="";return}try{dr.workerSrc=$he}catch(s){console.warn("Failed to configure PDF.js worker with unpkg, trying fallback...",s);try{dr.workerSrc=`https://cdn.jsdelivr.net/npm/pdfjs-dist@${$H}/build/pdf.worker.min.mjs`}catch(e){console.warn("Failed to configure PDF.js worker with jsDelivr, using main thread...",e),dr.workerSrc=""}}}Uhe();function $V(s){var h,f,m,p,x,g,b,v;if(!s)return console.warn("mapEquipmentToForm: parsedEquipment is undefined"),{weapons:[],armor:[],gear:[],tools:[],ammunition:[],potions:[],books:[],valuables:[],equipment:{},inventory:{capacity:100,items:[]},currency:{copper:0,silver:0,electrum:0,gold:0,platinum:0}};const e=s.weapons||((h=s.inventory)==null?void 0:h.filter(y=>y.type==="weapon"))||[],t=s.armor||((f=s.inventory)==null?void 0:f.filter(y=>y.type==="armor"))||[],n=s.gear||((m=s.inventory)==null?void 0:m.filter(y=>y.type==="gear"))||[],r=s.tools||((p=s.inventory)==null?void 0:p.filter(y=>y.type==="tool"))||[],a=s.ammunition||((x=s.inventory)==null?void 0:x.filter(y=>y.type==="ammunition"))||[],o=s.potions||((g=s.inventory)==null?void 0:g.filter(y=>y.type==="potion"))||[],l=s.books||((b=s.inventory)==null?void 0:b.filter(y=>y.type==="book"))||[],c=s.valuables||((v=s.inventory)==null?void 0:v.filter(y=>y.type==="valuable"))||[];return{weapons:e.map(y=>({name:y.name,type:y.type||"weapon",quantity:y.quantity||1,weight:y.weight||0,value:y.value||0,properties:{},notes:"",equipped:!1,attackBonus:0,damage:"",damageType:"",range:"",ammunition:void 0})),armor:t.map(y=>({name:y.name,type:y.type||"armor",quantity:y.quantity||1,weight:y.weight||0,value:y.value||0,properties:{},notes:"",equipped:!1,armorClass:0,armorType:"light",stealthDisadvantage:!1})),gear:n.map(y=>({name:y.name,type:y.type||"gear",quantity:y.quantity||1,weight:y.weight||0,value:y.value||0,properties:{},notes:"",equipped:!1})),tools:r.map(y=>({name:y.name,type:y.type||"tool",quantity:y.quantity||1,weight:y.weight||0,value:y.value||0,properties:{},notes:"",equipped:!1,proficiency:!1})),ammunition:a.map(y=>({name:y.name,type:y.type||"ammunition",quantity:y.quantity||1,weight:y.weight||0,value:y.value||0,properties:{},notes:"",equipped:!1})),potions:o.map(y=>({name:y.name,type:y.type||"potion",quantity:y.quantity||1,weight:y.weight||0,value:y.value||0,properties:{},notes:"",equipped:!1,rarity:"common"})),books:l.map(y=>({name:y.name,type:y.type||"book",quantity:y.quantity||1,weight:y.weight||0,value:y.value||0,properties:{},notes:"",equipped:!1,language:"common"})),valuables:c.map(y=>({name:y.name,type:y.type||"valuable",quantity:y.quantity||1,weight:y.weight||0,value:y.value||0,properties:{},notes:"",equipped:!1})),currency:s.currency||{copper:0,silver:0,electrum:0,gold:0,platinum:0},inventory:{capacity:100,items:[...e.map((y,w)=>({itemId:`weapon_${w}`,quantity:y.quantity||1})),...t.map((y,w)=>({itemId:`armor_${w}`,quantity:y.quantity||1})),...n.map((y,w)=>({itemId:`gear_${w}`,quantity:y.quantity||1})),...r.map((y,w)=>({itemId:`tool_${w}`,quantity:y.quantity||1})),...a.map((y,w)=>({itemId:`ammo_${w}`,quantity:y.quantity||1})),...o.map((y,w)=>({itemId:`potion_${w}`,quantity:y.quantity||1})),...l.map((y,w)=>({itemId:`book_${w}`,quantity:y.quantity||1})),...c.map((y,w)=>({itemId:`valuable_${w}`,quantity:y.quantity||1}))]},equipment:{headgear:void 0,armwear:void 0,chestwear:void 0,legwear:void 0,footwear:void 0,mainHand:void 0,offHand:void 0,accessories:[]}}}function zhe(s){return s?{weaponAttacks:(s.weaponAttacks||[]).map(t=>({name:t.name,type:"MELEE_ATTACK",actionCost:"Action",attackBonus:t.attackBonus,damage:t.damage,damageType:t.damageType,range:t.range||"5 ft.",properties:t.properties,requiresConcentration:!1,sourceBook:"Character Sheet",isProficient:!0})),spellAttacks:(s.spellAttacks||[]).map(t=>({name:t.name,type:"SPELL",actionCost:"Action",attackBonus:t.attackBonus,damage:t.damage,damageType:t.damageType,range:t.range,saveDC:t.saveDC,requiresConcentration:!1,sourceBook:"Character Sheet",isProficient:!0})),featureActions:(s.featureActions||[]).map(t=>({name:t.name,type:"CLASS_FEATURE",actionCost:"Action",description:t.description,damage:t.damage,damageType:t.damageType,range:t.range,saveDC:t.saveDC,uses:t.uses,requiresConcentration:!1,sourceBook:"Character Sheet",isProficient:!0}))}:(console.warn("mapActionsToForm: parsedActions is undefined"),{weaponAttacks:[],spellAttacks:[],featureActions:[],actions:[]})}function Hhe(s){return{cp:s.cp||s.copper||0,sp:s.sp||s.silver||0,ep:s.ep||s.electrum||0,gp:s.gp||s.gold||0,pp:s.pp||s.platinum||0}}function Vhe(s){return{armor:s.armor||[],weapons:s.weapons||[],tools:s.tools||[],languages:s.languages||[],savingThrows:s.savingThrows||[],skills:s.skills||[]}}function Whe(s){return{cantrips:s.cantrips||[],firstLevel:s.firstLevel||[],secondLevel:s.secondLevel||[],thirdLevel:s.thirdLevel||[],fourthLevel:s.fourthLevel||[],fifthLevel:s.fifthLevel||[],sixthLevel:s.sixthLevel||[],seventhLevel:s.seventhLevel||[],eighthLevel:s.eighthLevel||[],ninthLevel:s.ninthLevel||[]}}function qy(s){var t;const e={basicInfo:{name:s.name||"",race:s.race||"",subrace:s.subrace||"",background:s.background||"",alignment:s.alignment||"",level:s.level||1,experience:s.experience||0},abilityScores:s.abilityScores||{strength:10,dexterity:10,constitution:10,intelligence:10,wisdom:10,charisma:10},equipment:$V(s.parsedEquipment||{}),actions:zhe(s.parsedActions||{}),proficiencies:Vhe(s.proficiencies||{}),spells:Whe(s.spellcasting||{}),features:s.features||[],currency:Hhe(((t=s.parsedEquipment)==null?void 0:t.currency)||{}),confidence:s.confidence||{},parseLog:s.parseLog||[],importedFrom:s.importedFrom||"",importData:s.importData||{},importedAt:s.importedAt||Date.now()};return qhe(e)}function qhe(s){return s.equipment.weapons||(s.equipment.weapons=[]),s.equipment.armor||(s.equipment.armor=[]),s.equipment.gear||(s.equipment.gear=[]),s.equipment.tools||(s.equipment.tools=[]),s.equipment.ammunition||(s.equipment.ammunition=[]),s.equipment.potions||(s.equipment.potions=[]),s.equipment.books||(s.equipment.books=[]),s.equipment.valuables||(s.equipment.valuables=[]),s.equipment.inventory||(s.equipment.inventory={capacity:100,items:[]}),s.equipment.equipment||(s.equipment.equipment={headgear:void 0,armwear:void 0,chestwear:void 0,legwear:void 0,footwear:void 0,mainHand:void 0,offHand:void 0,accessories:[]}),s.currency||(s.currency={cp:0,sp:0,ep:0,gp:0,pp:0}),Object.keys(s.abilityScores).forEach(e=>{const t=s.abilityScores[e];(typeof t!="number"||t<1||t>30)&&(console.warn(`Invalid ability score for ${e}: ${t}, setting to 10`),s.abilityScores[e]=10)}),s}function Ghe({onImportSuccess:s,onImportError:e,disabled:t=!1,enableServerImport:n=!1}){const[r,a]=C.useState(!1),[o,l]=C.useState("file"),[c,d]=C.useState(""),[h,f]=C.useState(""),[m,p]=C.useState(null),x=Re(re.importParsedCharacter.default),g=S=>{var A,k,_,L,D;const j=S.parsedActions||((A=S.originalData)==null?void 0:A.parsedActions);if(j){const P=[];return(k=j.weaponAttacks)==null||k.forEach(T=>{P.push({name:T.name,type:"weapon_attack",description:`${T.name}: +${T.attackBonus} to hit, ${T.damage} ${T.damageType} damage${T.range?`, ${T.range}`:""}`,attackBonus:T.attackBonus,damage:T.damage,damageType:T.damageType,range:T.range,properties:T.properties})}),(_=j.spellAttacks)==null||_.forEach(T=>{P.push({name:T.name,type:"spell_attack",description:`${T.name}: +${T.attackBonus} to hit, ${T.damage} ${T.damageType} damage, ${T.range}`,attackBonus:T.attackBonus,damage:T.damage,damageType:T.damageType,range:T.range,saveDC:T.saveDC})}),(L=j.featureActions)==null||L.forEach(T=>{P.push({name:T.name,type:"feature_action",description:T.description,damage:T.damage,damageType:T.damageType,saveDC:T.saveDC,range:T.range,uses:T.uses})}),P}return((D=S.actions)==null?void 0:D.map(P=>({name:P,type:"basic_action",description:`Basic action: ${P}`})))||[]},b=async S=>{var A;const j=(A=S.target.files)==null?void 0:A[0];if(j){a(!0),p(null);try{const k=await Az(j),_=lO(k);if(n){const L=await x({parsedCharacter:{..._,parsedActions:g(_)}}),D=qy(_);s(L.characterId,{..._,formData:D}),p("success")}else{const L=qy(_);s("",{..._,formData:L}),p("success")}}catch(k){let _="Failed to import character file";k instanceof ul?_=k.message:k instanceof Error&&(k.message.includes("worker")?_="PDF processing encountered a network issue. Please try again or use a JSON export instead.":k.message.includes("CORS")?_="PDF processing blocked by browser security. Please try again or use a JSON export.":_=k.message),e(_),p("error")}finally{a(!1),S.target.value=""}}},v=async()=>{if(!c.trim()){e("Please enter JSON character data");return}a(!0),p(null);try{const S=JSON.parse(c),j=Nz(S),A=lO(j);if(n){const k=await x({parsedCharacter:{...A,parsedActions:g(A)}}),_=qy(A);s(k.characterId,{...A,formData:_}),p("success")}else{const k=qy(A);s("",{...A,formData:k}),p("success")}d("")}catch(S){const j=S instanceof ul?S.message:S instanceof SyntaxError?"Invalid JSON format":"Failed to import character data";e(j),p("error")}finally{a(!1)}},y=()=>{e("D&D Beyond integration is not yet available. Please use JSON export instead.")},w=()=>{const S={name:"Elara Moonwhisper",race:"Half-Elf",subrace:"",classes:[{name:"Ranger",level:3,hitDie:"d10",subclass:"Hunter",features:["Favored Enemy","Natural Explorer","Fighting Style","Spellcasting"]},{name:"Rogue",level:2,hitDie:"d8",subclass:"",features:["Expertise","Sneak Attack","Thieves' Cant","Cunning Action"]}],background:"Outlander",alignment:"Chaotic Good",level:5,experiencePoints:6500,abilityScores:{strength:13,dexterity:17,constitution:14,intelligence:12,wisdom:15,charisma:14},hitPoints:42,maxHitPoints:42,currentHitPoints:42,tempHitPoints:0,armorClass:15,skills:["Stealth","Perception","Survival","Investigation","Insight"],savingThrows:["Strength","Dexterity"],proficiencies:["Light armor","Medium armor","Shields","Simple weapons","Martial weapons"],languages:["Common","Elvish","Sylvan"],speed:"30 ft.",racialTraits:[{name:"Darkvision",description:"You can see in dim light within 60 feet as if it were bright light."},{name:"Fey Ancestry",description:"You have advantage on saving throws against being charmed."}],features:[{name:"Favored Enemy",description:"You have studied, tracked, and learned to hunt a certain type of creature.",source:"class"}]},j=new Blob([JSON.stringify(S,null,2)],{type:"application/json"}),A=URL.createObjectURL(j),k=document.createElement("a");k.href=A,k.download="sample-dnd-character.json",k.click(),URL.revokeObjectURL(A)};return i.jsxs(oe,{className:"w-full",children:[i.jsx(ke,{children:i.jsxs(Ne,{className:"flex items-center gap-2",children:[i.jsx(oM,{className:"h-5 w-5"}),"Import D&D 5e Character"]})}),i.jsxs(he,{className:"space-y-6",children:[i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(q,{variant:o==="file"?"default":"outline",size:"sm",onClick:()=>l("file"),disabled:t,children:[i.jsx($v,{className:"h-4 w-4 mr-2"}),"File Upload"]}),i.jsx(q,{variant:o==="json"?"default":"outline",size:"sm",onClick:()=>l("json"),disabled:t,children:"JSON Data"}),i.jsx(q,{variant:o==="dnd_beyond"?"default":"outline",size:"sm",onClick:()=>l("dnd_beyond"),disabled:t,children:"D&D Beyond"})]}),o==="file"&&i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx(st,{htmlFor:"character-file",children:"Character File (JSON, PDF, or TXT)"}),i.jsx(_e,{id:"character-file",type:"file",accept:".json,.pdf,.txt",onChange:b,disabled:t||r,className:"mt-1"})]}),i.jsxs(ur,{children:[i.jsx(Na,{className:"h-4 w-4"}),i.jsxs(hr,{children:["Supported formats: JSON character exports, PDF character sheets (D&D Beyond printable). PDF parsing uses geometry-aware extraction to identify ability scores, classes, and other character data.",n?" Characters will be saved directly to your account.":" You can preview and edit before saving."]})]})]}),o==="json"&&i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx(st,{htmlFor:"json-input",children:"Paste JSON Character Data"}),i.jsx("textarea",{id:"json-input",className:"w-full mt-1 p-3 border rounded-md min-h-[200px] font-mono text-sm",placeholder:"Paste your character JSON data here...",value:c,onChange:S=>d(S.target.value),disabled:t||r})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(q,{onClick:v,disabled:t||r||!c.trim(),children:r?"Importing...":"Import Character"}),i.jsxs(q,{variant:"outline",onClick:w,disabled:t,children:[i.jsx(F1,{className:"h-4 w-4 mr-2"}),"Download Sample"]})]})]}),o==="dnd_beyond"&&i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx(st,{htmlFor:"dnd-beyond-url",children:"D&D Beyond Character URL"}),i.jsx(_e,{id:"dnd-beyond-url",type:"url",placeholder:"https://www.dndbeyond.com/characters/...",value:h,onChange:S=>f(S.target.value),disabled:t||r,className:"mt-1"})]}),i.jsx(q,{onClick:y,disabled:t||r||!h.trim(),children:r?"Importing...":"Import from D&D Beyond"}),i.jsxs(ur,{children:[i.jsx(Na,{className:"h-4 w-4"}),i.jsx(hr,{children:"D&D Beyond integration is coming soon. For now, please export your character as JSON from D&D Beyond and use the JSON import method."})]})]}),m==="success"&&i.jsxs(ur,{className:"border-green-200 bg-green-50",children:[i.jsx(Yi,{className:"h-4 w-4 text-green-600"}),i.jsx(hr,{className:"text-green-800",children:"Character imported successfully! You can now review and customize the data."})]}),m==="error"&&i.jsxs(ur,{className:"border-red-200 bg-red-50",children:[i.jsx(Na,{className:"h-4 w-4 text-red-600"}),i.jsx(hr,{className:"text-red-800",children:"Import failed. Please check your file format and try again."})]}),i.jsxs("div",{className:"text-sm text-muted-foreground space-y-2",children:[i.jsx("p",{children:i.jsx("strong",{children:"Supported Sources:"})}),i.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[i.jsx("li",{children:"D&D Beyond character exports (JSON)"}),i.jsx("li",{children:"Standard D&D 5e JSON character sheets"}),i.jsx("li",{children:"PDF character sheets (fillable and text-based)"}),i.jsx("li",{children:"Roll20 character exports (coming soon)"})]}),i.jsx("p",{children:"The import system supports multiclass characters and will automatically calculate derived stats like AC, saving throws, and passive scores."})]})]})]})}const go=C.forwardRef(({className:s,children:e,...t},n)=>i.jsx("div",{ref:n,className:Ee("relative overflow-hidden",s),...t,children:i.jsx("div",{className:"h-full w-full rounded-[inherit] overflow-auto",children:e})}));go.displayName="ScrollArea";function Yhe({characterData:s,className:e,onCharacterDataChange:t,showConfidenceFlags:n=!1}){var v,y,w,S,j,A,k,_,L,D,P,T,B,R,O,I,U,M,$,W,ee,Z;const[r,a]=C.useState(null),[o,l]=C.useState(s),c=z=>Math.floor((z-10)/2),d=o.classes.reduce((z,se)=>z+se.level,0),h=Math.ceil(d/4)+1,f=((v=o.originalData)==null?void 0:v.confidence)||{},m=((y=o.originalData)==null?void 0:y.parseLog)||[],p=z=>{if(!n||!f[z])return null;const se=f[z],de={high:"bg-green-100 text-green-800 border-green-200",medium:"bg-yellow-100 text-yellow-800 border-yellow-200",low:"bg-red-100 text-red-800 border-red-200"},H={high:Yi,medium:Na,low:lm}[se];return i.jsxs(ue,{variant:"outline",className:Ee("ml-2 text-xs",de[se]),children:[i.jsx(H,{className:"w-3 h-3 mr-1"}),se]})},x=(z,se)=>{const de={...o};g(de,z,se),l(de),t&&t(de)},g=(z,se,de)=>{const ne=se.split(".");let H=z;for(let Y=0;Y<ne.length-1;Y++)ne[Y]in H||(H[ne[Y]]={}),H=H[ne[Y]];H[ne[ne.length-1]]=de},b=({label:z,value:se,fieldName:de,type:ne="text",multiline:H=!1})=>r===de?i.jsxs("div",{className:"space-y-2",children:[i.jsxs(st,{className:"text-sm text-muted-foreground flex items-center",children:[z,p(de)]}),i.jsxs("div",{className:"flex items-center gap-2",children:[H?i.jsx(ps,{value:se||"",onChange:ae=>x(de,ae.target.value),className:"flex-1",rows:3}):i.jsx(_e,{type:ne,value:se||"",onChange:ae=>{const ce=ne==="number"?parseInt(ae.target.value)||0:ae.target.value;x(de,ce)},className:"flex-1"}),i.jsx(q,{size:"sm",variant:"outline",onClick:()=>a(null),children:i.jsx(A$,{className:"w-4 h-4"})}),i.jsx(q,{size:"sm",variant:"outline",onClick:()=>{l(s),a(null)},children:i.jsx(Mr,{className:"w-4 h-4"})})]})]}):i.jsxs("div",{className:"group",children:[i.jsxs("div",{className:"text-sm text-muted-foreground flex items-center",children:[z,p(de),t&&i.jsx(q,{size:"sm",variant:"ghost",className:"ml-auto opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>a(de),children:i.jsx(Ene,{className:"w-3 h-3"})})]}),i.jsx("div",{className:"font-medium",children:se||"Not specified"})]});return i.jsxs(oe,{className:Ee("overflow-hidden",e),children:[i.jsx(ke,{children:i.jsxs(Ne,{className:"flex items-center justify-between",children:["Character Preview",n&&i.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[i.jsx("span",{className:"text-muted-foreground",children:"Confidence:"}),i.jsxs(ue,{variant:"outline",className:"bg-green-100 text-green-800",children:[i.jsx(Yi,{className:"w-3 h-3 mr-1"}),Object.values(f).filter(z=>z==="high").length," High"]}),i.jsxs(ue,{variant:"outline",className:"bg-yellow-100 text-yellow-800",children:[i.jsx(Na,{className:"w-3 h-3 mr-1"}),Object.values(f).filter(z=>z==="medium").length," Medium"]}),i.jsxs(ue,{variant:"outline",className:"bg-red-100 text-red-800",children:[i.jsx(lm,{className:"w-3 h-3 mr-1"}),Object.values(f).filter(z=>z==="low").length," Low"]})]})]})}),i.jsx(he,{children:i.jsx(go,{className:"h-[600px] pr-4",children:i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Basic Information"}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsx(b,{label:"Name",value:o.name,fieldName:"name"}),i.jsx(b,{label:"Race",value:`${o.race}${o.subrace?` (${o.subrace})`:""}`,fieldName:"race"}),i.jsx(b,{label:"Background",value:o.background,fieldName:"background"}),i.jsx(b,{label:"Alignment",value:o.alignment,fieldName:"alignment"}),i.jsxs("div",{children:[i.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Level"}),i.jsx("div",{className:"font-medium",children:d})]}),i.jsxs("div",{children:[i.jsx("div",{className:"text-sm text-muted-foreground",children:"Experience Points"}),i.jsx("div",{className:"font-medium",children:((w=s.experiencePoints)==null?void 0:w.toLocaleString())||"Not specified"})]})]})]}),i.jsx(On,{}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Classes"}),i.jsx("div",{className:"space-y-2",children:s.classes.map((z,se)=>i.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"font-medium",children:[z.name," ",z.level,z.subclass&&` (${z.subclass})`]}),i.jsxs("div",{className:"text-sm text-muted-foreground",children:["Hit Die: ",z.hitDie]})]}),i.jsxs(ue,{variant:"secondary",children:["Level ",z.level]})]},se))})]}),i.jsx(On,{}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Ability Scores"}),i.jsx("div",{className:"grid grid-cols-3 gap-4",children:Object.entries(s.abilityScores).map(([z,se])=>i.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[i.jsx("div",{className:"text-sm text-muted-foreground uppercase",children:z.slice(0,3)}),i.jsx("div",{className:"text-2xl font-bold",children:se}),i.jsx("div",{className:"text-sm text-muted-foreground",children:lr(c(se))})]},z))})]}),i.jsx(On,{}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Combat Statistics"}),i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[i.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[i.jsx("div",{className:"text-sm text-muted-foreground",children:"Hit Points"}),i.jsx("div",{className:"text-xl font-bold",children:s.hitPoints})]}),i.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[i.jsx("div",{className:"text-sm text-muted-foreground",children:"Armor Class"}),i.jsx("div",{className:"text-xl font-bold",children:s.armorClass})]}),i.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[i.jsx("div",{className:"text-sm text-muted-foreground",children:"Proficiency"}),i.jsx("div",{className:"text-xl font-bold",children:lr(h)})]}),i.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[i.jsx("div",{className:"text-sm text-muted-foreground",children:"Speed"}),i.jsx("div",{className:"text-xl font-bold",children:s.speed||"30 ft."})]})]})]}),i.jsx(On,{}),(s.passivePerception||s.passiveInvestigation||s.passiveInsight)&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Passive Scores"}),i.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[s.passivePerception&&i.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[i.jsx("div",{className:"text-sm text-muted-foreground",children:"Perception"}),i.jsx("div",{className:"text-xl font-bold",children:s.passivePerception})]}),s.passiveInvestigation&&i.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[i.jsx("div",{className:"text-sm text-muted-foreground",children:"Investigation"}),i.jsx("div",{className:"text-xl font-bold",children:s.passiveInvestigation})]}),s.passiveInsight&&i.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[i.jsx("div",{className:"text-sm text-muted-foreground",children:"Insight"}),i.jsx("div",{className:"text-xl font-bold",children:s.passiveInsight})]})]})]}),i.jsx(On,{})]}),s.skills.length>0&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Skills"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:s.skills.map((z,se)=>i.jsx(ue,{variant:"outline",children:z},se))})]}),i.jsx(On,{})]}),s.savingThrows.length>0&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Saving Throw Proficiencies"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:s.savingThrows.map((z,se)=>i.jsx(ue,{variant:"outline",children:z},se))})]}),i.jsx(On,{})]}),s.languages&&s.languages.length>0&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Languages"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:s.languages.map((z,se)=>i.jsx(ue,{variant:"secondary",children:z},se))})]}),i.jsx(On,{})]}),s.spellcastingAbility&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Spellcasting"}),i.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[i.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[i.jsx("div",{className:"text-sm text-muted-foreground",children:"Ability"}),i.jsx("div",{className:"text-lg font-bold",children:s.spellcastingAbility})]}),s.spellSaveDC&&i.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[i.jsx("div",{className:"text-sm text-muted-foreground",children:"Save DC"}),i.jsx("div",{className:"text-lg font-bold",children:s.spellSaveDC})]}),s.spellAttackBonus&&i.jsxs("div",{className:"text-center p-3 border rounded-lg",children:[i.jsx("div",{className:"text-sm text-muted-foreground",children:"Attack Bonus"}),i.jsx("div",{className:"text-lg font-bold",children:lr(s.spellAttackBonus)})]})]}),s.spellSlots&&s.spellSlots.length>0&&i.jsxs("div",{className:"mt-4",children:[i.jsx("h4",{className:"font-medium mb-2",children:"Spell Slots"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:s.spellSlots.map((z,se)=>i.jsxs("div",{className:"text-center p-2 border rounded text-sm",children:[i.jsxs("div",{children:["Level ",z.level]}),i.jsxs("div",{children:[z.used,"/",z.total]})]},se))})]}),s.spellsKnown&&s.spellsKnown.length>0&&i.jsxs("div",{className:"mt-4",children:[i.jsx("h4",{className:"font-medium mb-2",children:"Spells Known"}),i.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.spellsKnown.slice(0,10).map((z,se)=>i.jsx(ue,{variant:"outline",children:z},se)),s.spellsKnown.length>10&&i.jsxs(ue,{variant:"secondary",children:["+",s.spellsKnown.length-10," more"]})]})]}),s.cantripsKnown&&s.cantripsKnown.length>0&&i.jsxs("div",{className:"mt-4",children:[i.jsx("h4",{className:"font-medium mb-2",children:"Cantrips Known"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:s.cantripsKnown.map((z,se)=>i.jsx(ue,{variant:"outline",children:z},se))})]})]}),i.jsx(On,{})]}),(s.equipment||s.inventory)&&i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Equipment & Inventory"}),s.equipment&&i.jsxs("div",{className:"mb-4",children:[i.jsx("h4",{className:"font-medium mb-2",children:"Equipped Items"}),i.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[s.equipment.headgear&&i.jsxs("div",{className:"p-2 border rounded text-sm",children:[i.jsx("div",{className:"font-medium",children:"Headgear"}),i.jsx("div",{className:"text-muted-foreground",children:s.equipment.headgear})]}),s.equipment.chestwear&&i.jsxs("div",{className:"p-2 border rounded text-sm",children:[i.jsx("div",{className:"font-medium",children:"Chest"}),i.jsx("div",{className:"text-muted-foreground",children:s.equipment.chestwear})]}),s.equipment.mainHand&&i.jsxs("div",{className:"p-2 border rounded text-sm",children:[i.jsx("div",{className:"font-medium",children:"Main Hand"}),i.jsx("div",{className:"text-muted-foreground",children:s.equipment.mainHand})]}),s.equipment.offHand&&i.jsxs("div",{className:"p-2 border rounded text-sm",children:[i.jsx("div",{className:"font-medium",children:"Off Hand"}),i.jsx("div",{className:"text-muted-foreground",children:s.equipment.offHand})]})]})]}),s.inventory&&s.inventory.length>0&&i.jsxs("div",{children:[i.jsx("h4",{className:"font-medium mb-2",children:"Inventory Items"}),i.jsxs("div",{className:"space-y-2",children:[s.inventory.slice(0,10).map((z,se)=>i.jsxs("div",{className:"flex justify-between items-center p-2 border rounded text-sm",children:[i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:z.name}),z.description&&i.jsxs("span",{className:"text-muted-foreground ml-2",children:["- ",z.description]})]}),i.jsxs(ue,{variant:"outline",children:["",z.quantity]})]},se)),s.inventory.length>10&&i.jsxs("div",{className:"text-center p-2 border border-dashed rounded text-muted-foreground",children:["+",s.inventory.length-10," more items"]})]})]}),i.jsx(On,{})]}),s.parsedEquipment&&i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Parsed Equipment Details"}),((S=s.parsedEquipment.weapons)==null?void 0:S.length)>0&&i.jsxs("div",{className:"mb-4",children:[i.jsx("h4",{className:"font-medium mb-2",children:"Weapons"}),i.jsx("div",{className:"space-y-2",children:s.parsedEquipment.weapons.map((z,se)=>i.jsx("div",{className:"p-3 border rounded-lg",children:i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"font-medium",children:z.name}),i.jsxs("div",{className:"text-sm text-muted-foreground",children:[z.damage&&`${z.damage} ${z.damageType}`,z.range&&`  ${z.range}`,z.attackBonus&&`  +${z.attackBonus} to hit`]}),z.notes&&i.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:z.notes})]}),i.jsxs("div",{className:"text-right text-sm",children:[i.jsxs("div",{children:[z.weight," lb"]}),i.jsxs("div",{className:"text-muted-foreground",children:[z.value," gp"]}),z.equipped&&i.jsx(ue,{variant:"secondary",className:"mt-1",children:"Equipped"})]})]})},se))})]}),((j=s.parsedEquipment.armor)==null?void 0:j.length)>0&&i.jsxs("div",{className:"mb-4",children:[i.jsx("h4",{className:"font-medium mb-2",children:"Armor"}),i.jsx("div",{className:"space-y-2",children:s.parsedEquipment.armor.map((z,se)=>i.jsx("div",{className:"p-3 border rounded-lg",children:i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"font-medium",children:z.name}),i.jsxs("div",{className:"text-sm text-muted-foreground",children:[z.armorClass&&`AC ${z.armorClass}`,z.armorType&&`  ${z.armorType}`,z.stealthDisadvantage&&i.jsx("span",{className:"text-red-600",children:"  Stealth Disadvantage"})]}),z.notes&&i.jsx("div",{className:"text-xs text-muted-foreground mt-1",children:z.notes})]}),i.jsxs("div",{className:"text-right text-sm",children:[i.jsxs("div",{children:[z.weight," lb"]}),i.jsxs("div",{className:"text-muted-foreground",children:[z.value," gp"]}),z.equipped&&i.jsx(ue,{variant:"secondary",className:"mt-1",children:"Equipped"})]})]})},se))})]}),((A=s.parsedEquipment)==null?void 0:A.currency)&&Object.values(s.parsedEquipment.currency).some(z=>z>0)&&i.jsxs("div",{className:"mb-4",children:[i.jsx("h4",{className:"font-medium mb-2",children:"Currency"}),i.jsx("div",{className:"flex gap-4 text-sm",children:Object.entries(s.parsedEquipment.currency).map(([z,se])=>se>0&&i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("span",{className:"font-medium",children:se}),i.jsx("span",{className:"text-muted-foreground uppercase",children:z})]},z))})]}),["gear","tools","ammunition","potions","books","valuables"].map(z=>{var de;const se=(de=s.parsedEquipment)==null?void 0:de[z];return!se||!Array.isArray(se)||se.length===0?null:i.jsxs("div",{className:"mb-4",children:[i.jsx("h4",{className:"font-medium mb-2 capitalize",children:z}),i.jsxs("div",{className:"space-y-2",children:[se.slice(0,5).map((ne,H)=>i.jsxs("div",{className:"flex justify-between items-center p-2 border rounded text-sm",children:[i.jsxs("div",{children:[i.jsx("span",{className:"font-medium",children:ne.name}),ne.description&&i.jsxs("span",{className:"text-muted-foreground ml-2",children:["- ",ne.description]})]}),i.jsxs("div",{className:"text-right text-sm",children:[i.jsxs("div",{children:[ne.weight," lb"]}),i.jsxs("div",{className:"text-muted-foreground",children:[ne.value," gp"]})]})]},H)),se.length>5&&i.jsxs("div",{className:"text-center p-2 border border-dashed rounded text-muted-foreground",children:["+",se.length-5," more ",z]})]})]},z)}),i.jsx(On,{})]}),s.parsedActions&&i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Parsed Actions & Combat"}),((_=(k=s.parsedActions)==null?void 0:k.weaponAttacks)==null?void 0:_.length)>0&&i.jsxs("div",{className:"mb-4",children:[i.jsx("h4",{className:"font-medium mb-2",children:"Weapon Attacks"}),i.jsx("div",{className:"space-y-2",children:(D=(L=s.parsedActions)==null?void 0:L.weaponAttacks)==null?void 0:D.map((z,se)=>i.jsx("div",{className:"p-3 border rounded-lg",children:i.jsx("div",{className:"flex justify-between items-start",children:i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"font-medium",children:z.name}),i.jsxs("div",{className:"text-sm text-muted-foreground",children:["+",z.attackBonus," to hit  ",z.damage," ",z.damageType,z.range&&`  ${z.range}`]}),z.properties&&Object.keys(z.properties).length>0&&i.jsx("div",{className:"flex gap-1 mt-1",children:Object.entries(z.properties).map(([de,ne])=>ne&&i.jsx(ue,{variant:"outline",className:"text-xs capitalize",children:de},de))})]})})},se))})]}),((T=(P=s.parsedActions)==null?void 0:P.spellAttacks)==null?void 0:T.length)>0&&i.jsxs("div",{className:"mb-4",children:[i.jsx("h4",{className:"font-medium mb-2",children:"Spell Attacks"}),i.jsx("div",{className:"space-y-2",children:(R=(B=s.parsedActions)==null?void 0:B.spellAttacks)==null?void 0:R.map((z,se)=>i.jsx("div",{className:"p-3 border rounded-lg",children:i.jsx("div",{className:"flex justify-between items-start",children:i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"font-medium",children:z.name}),i.jsxs("div",{className:"text-sm text-muted-foreground",children:["+",z.attackBonus," to hit  ",z.damage," ",z.damageType,z.range&&`  ${z.range}`,z.saveDC&&`  DC ${z.saveDC}`]})]})})},se))})]}),((I=(O=s.parsedActions)==null?void 0:O.featureActions)==null?void 0:I.length)>0&&i.jsxs("div",{className:"mb-4",children:[i.jsx("h4",{className:"font-medium mb-2",children:"Feature Actions"}),i.jsx("div",{className:"space-y-2",children:(M=(U=s.parsedActions)==null?void 0:U.featureActions)==null?void 0:M.map((z,se)=>i.jsx("div",{className:"p-3 border rounded-lg",children:i.jsx("div",{className:"flex justify-between items-start",children:i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"font-medium",children:z.name}),i.jsxs("div",{className:"text-sm text-muted-foreground",children:[z.description,z.damage&&`  ${z.damage} ${z.damageType}`,z.range&&`  ${z.range}`,z.saveDC&&`  DC ${z.saveDC}`]}),z.uses&&i.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Uses: ",z.uses.current,"/",z.uses.max,z.uses.resetOn&&` (resets on ${z.uses.resetOn})`]})]})})},se))})]}),["bonusActions","reactions","legendaryActions","lairActions"].map(z=>{var de;const se=(de=s.parsedActions)==null?void 0:de[z];return!se||!Array.isArray(se)||se.length===0?null:i.jsxs("div",{className:"mb-4",children:[i.jsx("h4",{className:"font-medium mb-2 capitalize",children:z.replace(/([A-Z])/g," $1").trim()}),i.jsxs("div",{className:"space-y-2",children:[se.slice(0,3).map((ne,H)=>i.jsxs("div",{className:"p-2 border rounded text-sm",children:[i.jsx("div",{className:"font-medium",children:ne.name||ne}),ne.description&&i.jsx("div",{className:"text-muted-foreground mt-1",children:ne.description})]},H)),se.length>3&&i.jsxs("div",{className:"text-center p-2 border border-dashed rounded text-muted-foreground",children:["+",se.length-3," more ",z.replace(/([A-Z])/g," $1").toLowerCase()]})]})]},z)}),i.jsx(On,{})]}),s.actions&&s.actions.length>0&&i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Actions & Combat"}),i.jsxs("div",{className:"space-y-2",children:[s.actions.slice(0,8).map((z,se)=>i.jsx("div",{className:"p-2 border rounded text-sm",children:i.jsx("div",{className:"font-medium",children:z})},se)),s.actions.length>8&&i.jsxs("div",{className:"text-center p-2 border border-dashed rounded text-muted-foreground",children:["+",s.actions.length-8," more actions"]})]})]}),(s.features&&s.features.length>0||s.racialTraits&&s.racialTraits.length>0||s.feats&&s.feats.length>0)&&i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Features & Traits"}),i.jsxs("div",{className:"space-y-3",children:[($=s.racialTraits)==null?void 0:$.map((z,se)=>i.jsxs("div",{className:"p-3 border rounded-lg",children:[i.jsxs("div",{className:"font-medium text-sm",children:[z.name," ",i.jsx(ue,{variant:"secondary",className:"ml-2",children:"Racial"})]}),i.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:z.description})]},`racial-${se}`)),(W=s.features)==null?void 0:W.slice(0,5).map((z,se)=>i.jsxs("div",{className:"p-3 border rounded-lg",children:[i.jsxs("div",{className:"font-medium text-sm",children:[z.name,i.jsx(ue,{variant:"secondary",className:"ml-2 capitalize",children:z.source}),z.uses&&i.jsxs("span",{className:"text-xs text-muted-foreground ml-2",children:["(",z.uses.current,"/",z.uses.max," uses)"]})]}),i.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:z.description})]},`feature-${se}`)),(ee=s.feats)==null?void 0:ee.map((z,se)=>i.jsxs("div",{className:"p-3 border rounded-lg",children:[i.jsxs("div",{className:"font-medium text-sm",children:[z.name," ",i.jsx(ue,{variant:"secondary",className:"ml-2",children:"Feat"})]}),i.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:z.description})]},`feat-${se}`)),s.features&&s.features.length>5&&i.jsxs("div",{className:"text-center p-3 border border-dashed rounded-lg text-muted-foreground",children:["+",s.features.length-5," more features"]})]})]}),n&&m.length>0&&i.jsxs(i.Fragment,{children:[i.jsx(On,{}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Parsing Details"}),i.jsx("div",{className:"bg-muted/50 p-3 rounded-lg",children:i.jsx(go,{className:"h-[150px]",children:i.jsx("div",{className:"space-y-1 text-sm font-mono",children:m.map((z,se)=>i.jsx("div",{className:"text-muted-foreground",children:z},se))})})})]})]}),o.importSource&&i.jsxs(i.Fragment,{children:[i.jsx(On,{}),i.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:["Imported from: ",i.jsx(ue,{variant:"outline",className:"ml-1 capitalize",children:o.importSource}),((Z=o.originalData)==null?void 0:Z.importedAt)&&i.jsxs("span",{className:"ml-2",children:["on ",new Date(o.originalData.importedAt).toLocaleDateString()]})]})]})]})})})]})}typeof window<"u"&&"Worker"in window&&(dr.workerPort=new Worker(new URL("/assets/pdf.worker-BypuSDWn.js",import.meta.url),{type:"module"}));async function Khe(s){return console.warn("Server proxy upload not implemented - files are processed client-side"),{success:!0,url:URL.createObjectURL(s),filename:s.name,size:s.size,message:"File processed client-side (no server upload)"}}dr.workerSrc="/workers/pdf.worker.mjs";dr.workerPort=null;const UV=["name","race","background","class","classes[0].name","classes[0].level","classes[1].name","classes[1].level","subrace","alignment","abilityScores.strength","abilityScores.dexterity","abilityScores.constitution","abilityScores.intelligence","abilityScores.wisdom","abilityScores.charisma","proficiencyBonus","armorClass","maxHitPoints","currentHitPoints","speed","passivePerception","passiveInvestigation","passiveInsight","initiative","skills","traits","racialTraits","languages","spellsKnown","cantripsKnown","features","equipment","weaponProficiencies","armorProficiencies","toolProficiencies","savingThrows","hitDice","experiencePoints","inspiration","deathSaves.successes","deathSaves.failures"];function Xhe({sectionText:s,sectionId:e,onMappingCreate:t,existingMappings:n,onMappingRemove:r}){const[a,o]=C.useState(""),[l,c]=C.useState(""),[d,h]=C.useState(!1),[f,m]=C.useState(null),p=()=>{const y=window.getSelection();if(y&&y.toString().trim()){const w=y.toString().trim();o(w),h(!1)}},x=()=>{if(!a||!l)return;const y=s.indexOf(a);if(y===-1)return;const w={id:f||`${e}_${Date.now()}`,field:l,selectedText:a,startIndex:y,endIndex:y+a.length,sectionId:e,confidence:.9};f?(t(w),m(null)):t(w),o(""),c("")},g=y=>{o(y.selectedText),c(y.field),m(y.id),h(!1)};C.useEffect(()=>{const y=w=>{const S=w.detail;g(S)};return window.addEventListener("editMapping",y),()=>{window.removeEventListener("editMapping",y)}},[]);const b=y=>{r(y)},v=C.useMemo(()=>{if(!s)return"";let y=s;const S=[...n.filter(j=>j.sectionId===e)].sort((j,A)=>A.startIndex-j.startIndex);for(const j of S){const A=y.substring(0,j.startIndex),k=y.substring(j.endIndex),_=`<mark class="bg-yellow-200 px-1 rounded border border-yellow-400 cursor-help" title="${j.field}: ${j.selectedText}" style="display: inline-block; margin: 0 1px;">${j.selectedText}</mark>`;y=A+_+k}return y},[s,n,e]);return i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(rM,{className:"w-4 h-4"}),i.jsx(st,{className:"text-sm font-medium",children:"Text Selection & Mapping"})]}),i.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:i.jsxs("div",{className:"text-sm text-blue-800",children:[i.jsx("strong",{children:"How to use:"}),i.jsxs("ol",{className:"list-decimal list-inside mt-2 space-y-1 text-xs",children:[i.jsx("li",{children:'Click "Enable Text Selection" below'}),i.jsx("li",{children:"Click and drag to select text in the section"}),i.jsx("li",{children:"Choose a character field from the dropdown"}),i.jsx("li",{children:'Click "Create Mapping" to save'}),i.jsx("li",{children:"Repeat for all the data you want to extract"})]})]})}),i.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:i.jsxs("div",{className:"text-sm text-green-800",children:[i.jsx("strong",{children:"Common mapping patterns:"}),i.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2 text-xs",children:[i.jsxs("div",{children:[i.jsx("strong",{children:"Basic Info:"})," name, race, class, background, level"]}),i.jsxs("div",{children:[i.jsx("strong",{children:"Ability Scores:"})," strength, dexterity, constitution, intelligence, wisdom, charisma"]}),i.jsxs("div",{children:[i.jsx("strong",{children:"Combat:"})," armorClass, hitPoints, speed, initiative"]}),i.jsxs("div",{children:[i.jsx("strong",{children:"Skills:"})," skills, savingThrows, proficiencies"]})]})]})}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx(st,{className:"text-sm",children:"Select Text"}),i.jsxs("div",{className:"mt-2 p-3 border rounded-lg bg-muted/50",children:[i.jsx("div",{className:"text-sm text-muted-foreground mb-2",children:d?i.jsx("span",{className:"text-blue-600",children:"Click and drag to select text below, then choose a field to map to..."}):i.jsx("span",{children:"Click the button below to enable text selection, then select text in the section"})}),i.jsx(q,{variant:d?"destructive":"outline",size:"sm",onClick:()=>h(!d),className:"mb-2",children:d?"Cancel Selection":"Enable Text Selection"}),d&&i.jsxs("div",{className:"text-xs text-muted-foreground",children:[i.jsx("p",{children:"1. Click and drag to select text in the section below"}),i.jsx("p",{children:"2. Choose a character field from the dropdown"}),i.jsx("p",{children:'3. Click "Create Mapping" to save'})]})]})]}),i.jsxs("div",{children:[i.jsx(st,{className:"text-sm",children:"Map to Field"}),i.jsxs("div",{className:"mt-2 space-y-2",children:[i.jsxs(wt,{onValueChange:c,value:l,children:[i.jsx(gt,{children:i.jsx(Ct,{placeholder:"Choose a character field"})}),i.jsx(xt,{children:UV.map(y=>i.jsx(Ie,{value:y,children:y},y))})]}),a&&l&&i.jsxs("div",{className:"p-2 border rounded bg-green-50",children:[i.jsxs("div",{className:"text-xs text-green-800",children:[i.jsx("strong",{children:"Selected:"}),' "',a,'"']}),i.jsxs("div",{className:"text-xs text-green-800",children:[i.jsx("strong",{children:"Field:"})," ",l]}),i.jsxs(q,{onClick:x,size:"sm",className:"mt-2 w-full",children:[i.jsx(Mn,{className:"w-4 h-4 mr-2"}),f?"Update Mapping":"Create Mapping"]}),f&&i.jsx(q,{onClick:()=>{m(null),o(""),c("")},size:"sm",variant:"outline",className:"mt-2 w-full",children:"Cancel Edit"})]})]})]})]}),i.jsxs("div",{children:[i.jsx(st,{className:"text-sm",children:"Section Text with Mappings"}),i.jsxs("div",{className:Ee("mt-2 p-3 border rounded-lg max-h-64 overflow-y-auto transition-colors",d?"bg-blue-50 border-blue-300 ring-2 ring-blue-200":"bg-background"),onMouseUp:d?p:void 0,style:{userSelect:d?"text":"none"},children:[d&&i.jsxs("div",{className:"mb-2 p-2 bg-blue-100 border border-blue-300 rounded text-xs text-blue-800",children:[i.jsx("strong",{children:"Text Selection Active:"})," Click and drag to select text, then choose a field to map to."]}),i.jsx("div",{className:"text-sm leading-relaxed",dangerouslySetInnerHTML:{__html:v}})]})]}),i.jsxs("div",{children:[i.jsx(st,{className:"text-sm",children:"Current Mappings"}),i.jsxs("div",{className:"mt-2 space-y-2",children:[n.filter(y=>y.sectionId===e).map(y=>i.jsxs("div",{className:"flex items-center justify-between p-2 border rounded bg-blue-50",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"text-xs font-medium text-blue-800",children:y.field}),i.jsxs("div",{className:"text-xs text-blue-600",children:['"',y.selectedText,'"']})]}),i.jsxs("div",{className:"flex gap-1",children:[i.jsx(q,{onClick:()=>g(y),size:"sm",variant:"outline",children:"Edit"}),i.jsx(q,{onClick:()=>b(y.id),size:"sm",variant:"outline",children:i.jsx(Mr,{className:"w-4 h-4"})})]})]},y.id)),n.filter(y=>y.sectionId===e).length===0&&i.jsx("div",{className:"text-sm text-muted-foreground text-center py-4",children:"No mappings created for this section yet"})]})]})]})}function Qhe({onImportSuccess:s,onImportError:e,disabled:t=!1,enableServerImport:n=!1}){const[r,a]=C.useState(null),[o,l]=C.useState(null),[c,d]=C.useState(""),[h,f]=C.useState([]),[m,p]=C.useState([]),[x,g]=C.useState(null),[b,v]=C.useState(""),[y,w]=C.useState({}),[S,j]=C.useState([]),[A,k]=C.useState(""),[_,L]=C.useState(""),[D,P]=C.useState(!1),[T,B]=C.useState(!1),[R,O]=C.useState(null),[I,U]=C.useState([]),[M,$]=C.useState(!1),W=C.useRef(null);async function ee(te){const J=te.target.files&&te.target.files[0];if(!J)return;a(J),O(null),U([]),w({}),j([]),k(""),L(""),P(!1);const K=URL.createObjectURL(J);l(K),U(Me=>[...Me,`Selected file ${J.name} (${J.size} bytes)`]),$(!0);const be=setTimeout(()=>{$(!1),U(Me=>[...Me,"Error: PDF processing timed out after 30 seconds. The file may be too large or corrupted."]),e("PDF processing timed out. The file may be too large, corrupted, or the PDF format is not supported.")},3e4);try{const Me=await J.arrayBuffer();U(G=>[...G,"Converting file to ArrayBuffer..."]);const{text:De,perPage:_t}=await Zhe(Me);if(clearTimeout(be),d(De),f(_t),U(G=>[...G,`Extracted text from ${_t.length} page(s)`]),U(G=>[...G,`Total text length: ${De.length} characters`]),De.trim().length===0){U(G=>[...G,"Warning: No text extracted from PDF. This might be an image-based PDF."]),e("No text could be extracted from this PDF. It may be an image-based PDF that requires OCR.");return}const et=Jhe(De,_t);if(p(et),U(G=>[...G,`Detected ${et.length} sections`]),et.length>0)g(et[0].id),v(et[0].fullText),U(G=>[...G,`Selected first section: ${et[0].title}`]);else{const G={id:"entire",title:"Entire document",pageIndices:_t.map((Q,ie)=>ie),snippet:De.slice(0,300),fullText:De};p([G]),g(G.id),v(G.fullText),U(Q=>[...Q,"No sections detected, using entire document as fallback"])}}catch(Me){clearTimeout(be),console.error("PDF processing error:",Me),U(De=>[...De,`Error extracting text: ${String((Me==null?void 0:Me.message)??Me)}`]),U(De=>[...De,`Stack trace: ${(Me==null?void 0:Me.stack)||"No stack trace available"}`]),e(`Failed to extract text from PDF: ${(Me==null?void 0:Me.message)||Me}`)}finally{$(!1)}}C.useEffect(()=>{if(!x)return;const te=m.find(J=>J.id===x);te&&v(te.fullText)},[x,m]);const Z=te=>{j(J=>[...J,te]),U(J=>[...J,`Created mapping: ${te.field} = "${te.selectedText}"`])},z=te=>{j(J=>J.filter(K=>K.id!==te)),U(J=>[...J,`Removed mapping: ${te}`])},se=()=>{w({}),j([]),k(""),L(""),P(!1),U(te=>[...te,"Cleared all mappings"])},de=()=>{const te=window.getSelection();if(te&&te.toString().trim()){const J=te.toString().trim();L(J),P(!1)}},ne=()=>{!A||!_||(w(te=>({...te,[A]:_})),U(te=>[...te,`Created field mapping: ${A} = "${_}"`]),k(""),L(""),P(!1))},H=te=>{const J={name:"Unknown Character",race:"Unknown Race",background:"Unknown Background",classes:[{name:"Unknown Class",level:1}],level:1,experiencePoints:0,abilityScores:{strength:10,dexterity:10,constitution:10,intelligence:10,wisdom:10,charisma:10},hitPoints:10,armorClass:10,skills:[],savingThrows:[],proficiencies:[],traits:[],languages:[],speed:"30 ft",passivePerception:10,actions:[]};for(const K of te){const be=K.selectedText.trim();if(K.field.includes(".")){const Me=K.field.split(".");let De=J;for(let G=0;G<Me.length-1;G++){const Q=Me[G],ie=Q.match(/^([^\[]+)\[(\d+)\]$/);if(ie){const ve=ie[1],we=parseInt(ie[2],10);De[ve]||(De[ve]=[]),De[ve][we]||(De[ve][we]={}),De=De[ve][we]}else De[Q]||(De[Q]={}),De=De[Q]}const _t=Me[Me.length-1],et=_t.match(/^([^\[]+)\[(\d+)\]$/);if(et){const G=et[1],Q=parseInt(et[2],10);De[G]||(De[G]=[]),De[G][Q]||(De[G][Q]={}),De[G][Q]=be}else De[_t]=be}else if(K.field==="level"||K.field.includes("level")){const Me=parseInt(be,10);isNaN(Me)||(J[K.field]=Me)}else if(K.field.includes("abilityScores")||K.field.includes("armorClass")||K.field.includes("hitPoints")){const Me=parseInt(be,10);isNaN(Me)||(J[K.field]=Me)}else K.field==="skills"||K.field==="traits"||K.field==="languages"?J[K.field]=be.split(",").map(Me=>Me.trim()).filter(Me=>Me):J[K.field]=be}if(J.name==="Unknown Character"&&te.some(K=>K.field==="name")){const K=te.find(be=>be.field==="name");K&&(J.name=K.selectedText.trim())}return J.classes&&J.classes.length>0&&(J.classes=J.classes.map(K=>({name:K.name||"Unknown Class",level:typeof K.level=="number"?K.level:1,hitDie:K.hitDie||"d8",features:K.features||[],subclass:K.subclass||void 0}))),J.classes&&J.classes.length>1&&(J.level=J.classes.reduce((K,be)=>K+(be.level||1),0)),J};async function Y(){if(r){B(!0),O(null);try{const te=await Khe(r);if(te.success)O(te),U(J=>[...J,`Uploaded file successfully: ${te.message}`]);else throw new Error(te.error||"Upload failed")}catch(te){console.error(te),U(J=>[...J,`Upload error: ${String((te==null?void 0:te.message)??te)}`]),e(`Upload failed: ${(te==null?void 0:te.message)||te}`)}finally{B(!1)}}}function ae(te){w(J=>{const K={...J};return delete K[te],K})}const ce=C.useMemo(()=>{const te={};for(const[J,K]of Object.entries(y))tfe(te,J,typeof K=="string"?K.trim():K);return te},[y]),Ue=()=>{try{let te;if(S.length>0?(te=H(S),U(J=>[...J,`Importing character using ${S.length} text mappings`])):(te=sfe(ce),U(J=>[...J,"Importing character using legacy mapping system"])),n)s("",te);else{const J=qy(te);s("",{...te,formData:J})}}catch(te){e(`Import failed: ${(te==null?void 0:te.message)||te}`)}};return i.jsxs(oe,{className:"w-full",children:[i.jsx(ke,{children:i.jsxs(Ne,{className:"flex items-center gap-2",children:[i.jsx($v,{className:"w-5 h-5"}),"PDF Character Import"]})}),i.jsxs(he,{className:"space-y-6",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(_e,{ref:W,type:"file",accept:"application/pdf",onChange:ee,disabled:t,className:"flex-1"}),i.jsx(q,{onClick:Y,disabled:!r||T||t,variant:"outline",children:T?i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current mr-2"}),"Uploading..."]}):i.jsxs(i.Fragment,{children:[i.jsx(oM,{className:"w-4 h-4 mr-2"}),"Upload"]})})]}),r&&i.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[i.jsx(Yi,{className:"w-4 h-4 text-green-600"}),"Selected: ",r.name," (",(r.size/1024).toFixed(1)," KB)"]})]}),R&&i.jsxs(ur,{children:[i.jsx(Yi,{className:"h-4 w-4"}),i.jsxs(hr,{children:["File uploaded successfully! ",R.message]})]}),(Object.keys(y).length>0||S.length>0)&&i.jsxs(ur,{className:"border-blue-200 bg-blue-50",children:[i.jsx(Mn,{className:"h-4 w-4 text-blue-600"}),i.jsx(hr,{className:"text-blue-800",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("span",{children:[i.jsx("strong",{children:"Mapping Progress:"})," ",S.length," text selections + ",Object.keys(y).length," legacy mappings"]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(q,{onClick:se,size:"sm",variant:"outline",children:"Clear All"}),i.jsxs(q,{onClick:Ue,size:"sm",children:[i.jsx(F1,{className:"w-4 h-4 mr-2"}),"Import Character"]})]})]})})]}),!1,r&&i.jsxs(Qn,{defaultValue:"preview",className:"w-full",children:[i.jsxs(In,{className:"grid w-full grid-cols-4",children:[i.jsx(Be,{value:"preview",children:"PDF Preview"}),i.jsx(Be,{value:"sections",children:"Text Sections"}),i.jsx(Be,{value:"mapping",children:"Field Mapping"}),i.jsx(Be,{value:"textSelection",children:"Text Selection"})]}),i.jsx($e,{value:"preview",className:"space-y-4",children:i.jsx("div",{className:"border rounded-lg overflow-hidden",style:{height:"500px"},children:o?i.jsx("iframe",{title:"pdf-preview",src:o,style:{width:"100%",height:"100%",border:"none"}}):i.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:"No PDF selected"})})}),i.jsx($e,{value:"sections",className:"space-y-4",children:i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx(st,{children:"Detected Sections"}),i.jsx(go,{className:"h-64 border rounded-md p-2",children:M?i.jsxs("div",{className:"text-center py-8",children:[i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-current mx-auto mb-4"}),i.jsx("div",{className:"text-muted-foreground text-sm",children:"Processing PDF..."}),i.jsx("div",{className:"text-xs text-muted-foreground mt-2",children:"This may take a few moments"})]}):m.length===0?i.jsxs("div",{className:"text-center py-8",children:[i.jsx("div",{className:"text-muted-foreground text-sm mb-4",children:"No sections detected"}),i.jsxs("div",{className:"text-xs text-muted-foreground mb-4",children:["This could mean:",i.jsxs("ul",{className:"mt-2 text-left",children:[i.jsx("li",{children:" PDF has no extractable text"}),i.jsx("li",{children:" PDF is image-based (requires OCR)"}),i.jsx("li",{children:" PDF format is not supported"})]})]}),i.jsx(q,{variant:"outline",size:"sm",onClick:()=>{r&&ee({target:{files:[r]}})},children:"Retry Processing"})]}):i.jsx("div",{className:"space-y-2",children:m.map(te=>i.jsx("div",{className:"p-2 border rounded cursor-pointer hover:bg-muted",children:i.jsxs("label",{className:"flex items-start gap-2 cursor-pointer",children:[i.jsx("input",{type:"radio",name:"detected",checked:x===te.id,onChange:()=>g(te.id),className:"mt-1"}),i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"font-medium",children:te.title}),i.jsxs("div",{className:"text-xs text-muted-foreground",children:["Pages: ",te.pageIndices.join(", ")]}),i.jsx("div",{className:"text-sm mt-1",children:te.snippet})]})]})},te.id))})})]}),i.jsxs("div",{children:[i.jsx(st,{children:"Selected Section Text"}),i.jsx(ps,{value:b,onChange:te=>v(te.target.value),className:"h-64 font-mono text-sm",placeholder:"Select a section to view its text content..."})]})]})}),i.jsxs($e,{value:"mapping",className:"space-y-6",children:[i.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"text-sm text-blue-800",children:[i.jsx("strong",{children:"Field Mapping Process:"}),i.jsxs("ol",{className:"list-decimal list-inside mt-2 space-y-1 text-xs",children:[i.jsx("li",{children:"Select a character field from the dropdown below"}),i.jsx("li",{children:"Choose a section from the detected sections"}),i.jsx("li",{children:"Select specific text within that section"}),i.jsx("li",{children:'Click "Create Mapping" to save the field-to-text mapping'})]})]}),i.jsx(q,{onClick:()=>{k(""),L(""),P(!1)},size:"sm",variant:"outline",children:"Reset Process"})]})}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[i.jsxs("div",{children:[i.jsx(st,{className:"text-sm font-medium",children:"Step 1: Select Character Field"}),i.jsx("div",{className:"mt-2",children:i.jsxs(wt,{onValueChange:te=>{k(te)},children:[i.jsx(gt,{children:i.jsx(Ct,{placeholder:"Choose a character field"})}),i.jsx(xt,{children:UV.map(te=>i.jsx(Ie,{value:te,children:te},te))})]})})]}),i.jsxs("div",{children:[i.jsx(st,{className:"text-sm font-medium",children:"Step 2: Select Section"}),i.jsx("div",{className:"mt-2",children:i.jsxs(wt,{onValueChange:te=>{g(te);const J=m.find(K=>K.id===te);J&&v(J.fullText)},children:[i.jsx(gt,{children:i.jsx(Ct,{placeholder:"Choose a section"})}),i.jsx(xt,{children:m.map(te=>i.jsx(Ie,{value:te.id,children:te.title},te.id))})]})})]}),i.jsxs("div",{children:[i.jsx(st,{className:"text-sm font-medium",children:"Step 3: Select Text"}),i.jsx("div",{className:"mt-2",children:i.jsxs(q,{variant:"outline",size:"sm",onClick:()=>{A&&x&&P(!0)},disabled:!A||!x,className:"w-full",children:[i.jsx(rM,{className:"w-4 h-4 mr-2"}),"Enable Text Selection"]})})]})]}),A&&x&&b&&i.jsxs("div",{className:"border-t pt-6",children:[i.jsx(st,{className:"text-sm font-medium",children:"Text Selection Area"}),i.jsxs("div",{className:"mt-2 p-3 border rounded-lg bg-muted/50",children:[i.jsx("div",{className:"text-sm text-muted-foreground mb-2",children:D?i.jsx("span",{className:"text-blue-600",children:'Click and drag to select text below, then click "Create Mapping"'}):i.jsx("span",{children:'Click "Enable Text Selection" above to start selecting text'})}),i.jsxs("div",{className:Ee("p-3 border rounded-lg max-h-64 overflow-y-auto transition-colors",D?"bg-blue-50 border-blue-300 ring-2 ring-blue-200":"bg-background"),onMouseUp:D?de:void 0,style:{userSelect:D?"text":"none"},children:[D&&i.jsxs("div",{className:"mb-2 p-2 bg-blue-100 border border-blue-300 rounded text-xs text-blue-800",children:[i.jsx("strong",{children:"Text Selection Active:"}),' Click and drag to select text, then click "Create Mapping"']}),i.jsx("div",{className:"text-sm leading-relaxed",children:b})]}),_&&i.jsxs("div",{className:"mt-3 p-2 border rounded bg-green-50",children:[i.jsxs("div",{className:"text-xs text-green-800",children:[i.jsx("strong",{children:"Selected Text:"}),' "',_,'"']}),i.jsxs("div",{className:"text-xs text-green-800",children:[i.jsx("strong",{children:"Field:"})," ",A]}),i.jsxs("div",{className:"flex gap-2 mt-2",children:[i.jsxs(q,{onClick:ne,size:"sm",className:"flex-1",children:[i.jsx(Mn,{className:"w-4 h-4 mr-2"}),"Create Mapping"]}),i.jsx(q,{onClick:()=>{L(""),P(!1)},size:"sm",variant:"outline",children:"Reset Selection"})]})]})]})]}),i.jsxs("div",{className:"border-t pt-6",children:[i.jsx(st,{className:"text-sm font-medium",children:"Current Field Mappings"}),i.jsx("div",{className:"mt-2 space-y-2",children:Object.keys(y).length===0?i.jsx("div",{className:"text-muted-foreground text-sm text-center py-4",children:"No field mappings created yet"}):i.jsx("div",{className:"grid gap-2",children:Object.entries(y).map(([te,J])=>i.jsxs("div",{className:"flex items-center justify-between p-3 border rounded bg-blue-50",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"flex items-center gap-2 mb-1",children:i.jsx(ue,{variant:"secondary",className:"text-xs",children:te})}),i.jsxs("div",{className:"text-sm font-medium",children:['"',J,'"']})]}),i.jsx(q,{onClick:()=>ae(te),size:"sm",variant:"outline",children:i.jsx(Mr,{className:"w-4 h-4"})})]},te))})})]}),Object.keys(y).length>0&&i.jsxs("div",{className:"border-t pt-6",children:[i.jsx(st,{className:"text-sm font-medium",children:"Character Data Preview"}),i.jsx("div",{className:"mt-2 p-3 border rounded-lg bg-muted/50",children:i.jsx(go,{className:"h-48",children:i.jsx("pre",{className:"text-xs",children:JSON.stringify(ce,null,2)})})})]}),Object.keys(y).length>0&&i.jsx("div",{className:"border-t pt-6",children:i.jsx("div",{className:"flex justify-end",children:i.jsxs(q,{onClick:Ue,className:"w-full sm:w-auto",children:[i.jsx(F1,{className:"w-4 h-4 mr-2"}),"Import Character from Field Mappings"]})})})]}),i.jsxs($e,{value:"textSelection",className:"space-y-6",children:[x?i.jsx(Xhe,{sectionText:b,sectionId:x,onMappingCreate:Z,existingMappings:S,onMappingRemove:z}):i.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[i.jsx($v,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),i.jsx("p",{children:'Please select a section from the "Text Sections" tab first'})]}),i.jsxs("div",{className:"border-t pt-6",children:[i.jsx(st,{className:"text-sm font-medium",children:"All Text Mappings Summary"}),i.jsx("div",{className:"mt-2 space-y-2",children:S.length===0?i.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"No text mappings created yet"}):i.jsx("div",{className:"grid gap-2",children:S.map(te=>{const J=m.find(K=>K.id===te.sectionId);return i.jsxs("div",{className:"flex items-center justify-between p-3 border rounded bg-green-50",children:[i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[i.jsx(ue,{variant:"secondary",className:"text-xs",children:te.field}),i.jsxs("span",{className:"text-xs text-muted-foreground",children:["from ",(J==null?void 0:J.title)||"Unknown Section"]})]}),i.jsxs("div",{className:"text-sm font-medium",children:['"',te.selectedText,'"']})]}),i.jsxs("div",{className:"flex gap-1",children:[i.jsx(q,{onClick:()=>{const K=document.querySelector('[value="textSelection"]');K&&(K.click(),g(te.sectionId),setTimeout(()=>{const be=m.find(Me=>Me.id===te.sectionId);if(be){v(be.fullText);const Me=new CustomEvent("editMapping",{detail:te});window.dispatchEvent(Me)}},100))},size:"sm",variant:"outline",children:"Edit"}),i.jsx(q,{onClick:()=>z(te.id),size:"sm",variant:"outline",children:i.jsx(Mr,{className:"w-4 h-4"})})]})]},te.id)})})}),S.length>0&&i.jsx("div",{className:"flex justify-end pt-4",children:i.jsxs(q,{onClick:Ue,className:"w-full sm:w-auto",children:[i.jsx(F1,{className:"w-4 h-4 mr-2"}),"Import Character from Text Mappings"]})}),S.length>0&&i.jsxs("div",{className:"border-t pt-6",children:[i.jsx(st,{className:"text-sm font-medium",children:"Character Data Preview"}),i.jsx("div",{className:"mt-2 p-3 border rounded-lg bg-muted/50",children:i.jsx(go,{className:"h-48",children:i.jsx("pre",{className:"text-xs",children:JSON.stringify(H(S),null,2)})})})]})]})]})]}),!1,I.length>0&&i.jsxs("div",{className:"space-y-2",children:[i.jsx(st,{children:"Parse Log"}),i.jsx(go,{className:"h-32 border rounded-md p-2",children:I.map((te,J)=>i.jsxs("div",{className:"text-xs text-muted-foreground",children:[" ",te]},J))})]})]})]})}async function Zhe(s){try{console.log("Starting PDF text extraction...");const e=LH({data:s,verbosity:0,disableWorker:!1});console.log("Loading PDF document...");const t=await e.promise;console.log(`PDF loaded successfully. Pages: ${t.numPages}`);const n=t.numPages,r=[];for(let o=1;o<=n;o++)try{console.log(`Processing page ${o}/${n}...`);const c=await(await t.getPage(o)).getTextContent();if(!c||!c.items){console.warn(`Page ${o} has no content items`),r.push("");continue}const d=c.items.map(h=>typeof h=="string"?h:h&&typeof h=="object"&&h.str!==void 0?h.str:h&&typeof h=="object"&&h.text!==void 0?h.text:"").filter(h=>h&&h.trim().length>0).join(" ");console.log(`Page ${o} extracted ${d.length} characters`),r.push(d)}catch(l){console.error(`Error processing page ${o}:`,l),r.push(`[Error processing page ${o}: ${l.message}]`)}const a=r.join(`
---PAGE---
`);return console.log(`Text extraction complete. Total characters: ${a.length}`),{text:a,perPage:r}}catch(e){throw console.error("PDF text extraction failed:",e),e.name==="PasswordException"?new Error("PDF is password protected. Please remove the password and try again."):e.name==="InvalidPDFException"?new Error("Invalid PDF file. Please check if the file is corrupted."):e.name==="MissingPDFException"?new Error("PDF file is missing or empty."):e.name==="UnexpectedResponseException"?new Error("PDF file format is not supported or corrupted."):new Error(`PDF processing failed: ${e.message||e}`)}}function Jhe(s,e){const t=[],n=[{regex:/===\s*ACTIONS\s*===/gi,canonical:"ACTIONS"},{regex:/FEATURES\s*&\s*TRAITS/gi,canonical:"FEATURES & TRAITS"},{regex:/ADDITIONAL\s+FEATURES\s*&\s*TRAITS/gi,canonical:"ADDITIONAL FEATURES & TRAITS"},{regex:/EQUIPMENT/gi,canonical:"EQUIPMENT"},{regex:/ADDITIONAL\s+EQUIPMENT/gi,canonical:"ADDITIONAL EQUIPMENT"},{regex:/===\s*SPELLCASTING\s*===/gi,canonical:"SPELLCASTING"},{regex:/CANTRIPS/gi,canonical:"CANTRIPS"},{regex:/\b[0-9]{1,2}(?:st|nd|rd|th)\s+LEVEL\b/gi,canonical:"SPELL LEVEL"},{regex:/LANGUAGES/gi,canonical:"LANGUAGES"},{regex:/SENSES|DARKVISION|BLINDSIGHT/gi,canonical:"SENSES"}],r=s.toLowerCase();for(const l of n){let c;const d=new Set;for(;(c=l.regex.exec(r))!==null;){const h=c.index;if(d.has(h))continue;d.add(h);const f=efe(r,l.regex,h),m=f!==-1?f:Math.min(r.length,h+2e3),p=r.slice(h,m).trim(),x=[];e.forEach((g,b)=>{g.toLowerCase().includes(c[0].toLowerCase().replace(/\s+/g," "))&&x.push(b+1)}),t.push({id:`${l.canonical}_${h}`,title:l.canonical,pageIndices:x.length>0?x:[1],snippet:p.slice(0,400)+(p.length>400?"":""),fullText:p})}}const a={};for(const l of t)a[l.title+l.pageIndices.join(",")]||(a[l.title+l.pageIndices.join(",")]=l);const o=Object.values(a).sort((l,c)=>l.pageIndices[0]-c.pageIndices[0]||l.title.localeCompare(c.title));if(!o.find(l=>l.title==="ACTIONS")){const l=r.search(/\b(Breath Weapon|Attack|Unarmed Strike|Flurry of Blows|Scimitar|Shortsword|Eldritch Blast)\b/i);if(l!==-1){const c=r.slice(Math.max(0,l-80),Math.min(r.length,l+1200));o.unshift({id:`ACTIONS_fallback_${l}`,title:"ACTIONS (fallback)",pageIndices:[1],snippet:c.slice(0,300),fullText:c})}}return o}function efe(s,e,t){const n=/===\s*[A-Z0-9 &()'\/-]+?\s*===/g;n.lastIndex=t+1;const r=n.exec(s);return r?r.index:-1}function tfe(s,e,t){const n=e.split(".");let r=s;for(let a=0;a<n.length;a++){const o=n[a],l=o.match(/^([^\[]+)\[(\d+)\]$/);if(l){const c=l[1],d=parseInt(l[2],10);r[c]||(r[c]=[]),r[c][d]||(r[c][d]={}),a===n.length-1?r[c][d]=t:r=r[c][d]}else a===n.length-1?r[o]=t:(r[o]||(r[o]={}),r=r[o])}}function sfe(s){var t,n,r,a,o,l;return{name:s.name||"Unknown Character",race:s.race||"Unknown Race",background:s.background||"Unknown Background",classes:s.classes||[{name:"Unknown Class",level:1}],level:s.level||1,experiencePoints:0,abilityScores:{strength:((t=s.abilityScores)==null?void 0:t.strength)||10,dexterity:((n=s.abilityScores)==null?void 0:n.dexterity)||10,constitution:((r=s.abilityScores)==null?void 0:r.constitution)||10,intelligence:((a=s.abilityScores)==null?void 0:a.intelligence)||10,wisdom:((o=s.abilityScores)==null?void 0:o.wisdom)||10,charisma:((l=s.abilityScores)==null?void 0:l.charisma)||10},hitPoints:s.maxHitPoints||s.currentHitPoints||10,armorClass:s.armorClass||10,skills:s.skills?s.skills.split(",").map(c=>c.trim()):[],savingThrows:[],proficiencies:[],traits:s.traits?s.traits.split(",").map(c=>c.trim()):[],languages:s.languages?s.languages.split(",").map(c=>c.trim()):[],speed:s.speed||"30 ft",passivePerception:s.passivePerception||10,actions:s.actions?s.actions.split(",").map(c=>c.trim()):[]}}function zV({item:s,quantity:e=1,onView:t,onEdit:n,onQuantityChange:r,canEdit:a=!1,showQuantityControls:o=!1,isEquipped:l=!1,equipmentSlot:c}){const d=p=>{switch(p){case"Common":return"bg-gray-500";case"Uncommon":return"bg-green-500";case"Rare":return"bg-blue-500";case"Very Rare":return"bg-purple-500";case"Legendary":return"bg-orange-500";case"Artifact":return"bg-red-500";case"Unique":return"bg-pink-500";default:return"bg-gray-500"}},f=(p=>{switch(p){case"Weapon":return En;case"Armor":return Dr;case"Potion":case"Scroll":case"Wondrous Item":case"Ring":case"Rod":case"Staff":case"Wand":return Co;default:return Da}})(s.type),m=(s.weight||0)*e;return i.jsxs(oe,{className:"hover:shadow-md transition-shadow cursor-pointer",onClick:()=>t==null?void 0:t(s._id),children:[i.jsx(ke,{className:"pb-3",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx(Ne,{className:"text-lg line-clamp-1 mb-1",children:s.name}),i.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[i.jsxs(ue,{variant:"outline",className:"text-xs",children:[i.jsx(f,{className:"h-3 w-3 mr-1"}),s.type]}),i.jsx(ue,{className:`text-white text-xs ${d(s.rarity)}`,children:s.rarity}),s.attunement&&i.jsx(ue,{variant:"secondary",className:"text-xs",children:"Attunement"}),l&&i.jsxs(ue,{variant:"default",className:"text-xs bg-purple-600 hover:bg-purple-700",children:["Equipped",c?` (${c})`:""]})]})]}),o&&i.jsxs("div",{className:"flex items-center gap-2 ml-2",children:[i.jsx(q,{type:"button",size:"sm",variant:"outline",className:"h-6 w-6 p-0",onClick:p=>{p.stopPropagation(),r==null||r(s._id,Math.max(0,e-1))},children:"-"}),i.jsx("span",{className:"text-sm font-medium w-8 text-center",children:e}),i.jsx(q,{type:"button",size:"sm",variant:"outline",className:"h-6 w-6 p-0",onClick:p=>{p.stopPropagation(),r==null||r(s._id,e+1)},children:"+"})]})]})}),i.jsxs(he,{className:"space-y-3",children:[i.jsx("p",{className:"text-sm text-muted-foreground line-clamp-3",children:s.description}),s.effects&&i.jsxs("div",{className:"bg-muted/50 p-2 rounded border text-xs",children:[i.jsx("span",{className:"font-medium text-muted-foreground",children:"Effects: "}),i.jsx("span",{className:"text-foreground",children:s.effects})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[m>0&&i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(sT,{className:"h-4 w-4 text-gray-500"}),i.jsx("span",{className:"font-medium",children:m}),i.jsx("span",{className:"text-muted-foreground",children:"lbs"})]}),s.cost&&i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(b$,{className:"h-4 w-4 text-yellow-500"}),i.jsx("span",{className:"font-medium",children:s.cost}),i.jsx("span",{className:"text-muted-foreground",children:"gp"})]}),s.armorClass&&i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(Dr,{className:"h-4 w-4 text-blue-500"}),i.jsxs("span",{className:"font-medium",children:["AC ",s.armorClass]}),s.typeOfArmor&&i.jsxs("span",{className:"text-muted-foreground",children:["(",s.typeOfArmor,")"]})]}),s.damageRolls&&s.damageRolls.length>0&&i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(En,{className:"h-4 w-4 text-red-500"}),i.jsxs("span",{className:"font-medium",children:[s.damageRolls[0].dice.count,"d",s.damageRolls[0].dice.type.slice(1),s.damageRolls[0].modifier>0&&`+${s.damageRolls[0].modifier}`]}),i.jsx("span",{className:"text-muted-foreground capitalize text-xs",children:s.damageRolls[0].damageType.toLowerCase()})]})]}),s.abilityModifiers&&Object.values(s.abilityModifiers).some(p=>p!==void 0&&p!==0)&&i.jsxs("div",{className:"bg-muted/50 p-2 rounded border",children:[i.jsx("div",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Ability Modifiers:"}),i.jsx("div",{className:"flex flex-wrap gap-1",children:Object.entries(s.abilityModifiers).map(([p,x])=>!x||x===0?null:i.jsxs(ue,{variant:"secondary",className:"text-xs",children:[p.slice(0,3).toUpperCase()," ",x>0?"+":"",x]},p))})]}),i.jsxs("div",{className:"flex gap-2 pt-2",children:[i.jsx(q,{type:"button",variant:"outline",size:"sm",className:"flex-1",onClick:p=>{p.stopPropagation(),t==null||t(s._id)},children:"View Details"}),a&&i.jsx(q,{type:"button",size:"sm",className:"flex-1",onClick:p=>{p.stopPropagation(),n==null||n(s._id)},children:"Edit"})]})]})]})}function nfe({items:s,capacity:e,onQuantityChange:t,onRemoveItem:n,onAddItem:r,onViewItem:a,canEdit:o=!1,title:l="Inventory",equipment:c}){const[d,h]=C.useState(""),[f,m]=C.useState(new Set),p=_=>{var L;return c?c.headgear===_?"Head":c.armwear===_?"Arms":c.chestwear===_?"Chest":c.legwear===_?"Legs":c.footwear===_?"Feet":c.mainHand===_?"Main Hand":c.offHand===_?"Off Hand":(L=c.accessories)!=null&&L.includes(_)?"Accessory":null:null},x=s.reduce((_,L)=>_+(L.item.weight||0)*L.quantity,0),g=s.reduce((_,L)=>_+(L.item.cost||0)*L.quantity,0),b=s.reduce((_,L)=>_+L.quantity,0),v=Math.min(x/e*100,100),y=x>e,w=C.useMemo(()=>{const _=new Set;return s.forEach(L=>{_.add(L.item.type)}),Array.from(_).sort()},[s]),S=C.useMemo(()=>s.filter(_=>{var P;const L=d===""||_.item.name.toLowerCase().includes(d.toLowerCase())||_.item.type.toLowerCase().includes(d.toLowerCase())||((P=_.item.description)==null?void 0:P.toLowerCase().includes(d.toLowerCase())),D=f.size===0||f.has(_.item.type);return L&&D}),[s,d,f]),j=(_,L)=>{L<=0?n==null||n(_):t==null||t(_,L)},A=_=>{m(L=>{const D=new Set(L);return D.has(_)?D.delete(_):D.add(_),D})},k=()=>{m(new Set),h("")};return i.jsxs(oe,{className:"w-full",children:[i.jsxs(ke,{children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs(Ne,{className:"flex items-center gap-2",children:[i.jsx(hl,{className:"h-5 w-5"}),l]}),o&&i.jsxs(q,{type:"button",size:"sm",onClick:r,children:[i.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Add Item"]})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 mt-4",children:[i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl font-bold",children:b}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Items"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:g}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"GP Value"})]}),i.jsxs("div",{className:"text-center",children:[i.jsxs("div",{className:`text-2xl font-bold ${y?"text-red-600":"text-gray-600"}`,children:[x.toFixed(1)," / ",e]}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Weight (lbs)"})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(sT,{className:"h-4 w-4"}),i.jsx("span",{className:"text-sm font-medium",children:"Carrying Capacity"}),y&&i.jsx(ue,{variant:"destructive",className:"text-xs",children:"Overloaded"})]}),i.jsx(rk,{value:v,className:`h-2 ${y?"bg-red-100":""}`}),i.jsxs("div",{className:"text-xs text-muted-foreground text-right",children:[v.toFixed(1),"% capacity used"]})]})]}),i.jsxs(he,{className:"space-y-4",children:[i.jsxs("div",{className:"relative",children:[i.jsx(wm,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),i.jsx(_e,{type:"text",placeholder:"Search items by name, type, or description...",value:d,onChange:_=>h(_.target.value),className:"pl-10"})]}),w.length>0&&i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Filter by Type:"}),(f.size>0||d)&&i.jsx(q,{type:"button",variant:"ghost",size:"sm",onClick:k,className:"h-7 text-xs",children:"Clear All"})]}),i.jsx("div",{className:"flex flex-wrap gap-2",children:w.map(_=>i.jsxs(q,{type:"button",variant:f.has(_)?"default":"outline",size:"sm",onClick:()=>A(_),className:"h-8",children:[_,f.has(_)&&i.jsx(ue,{variant:"secondary",className:"ml-2 h-4 px-1.5 text-xs",children:S.filter(L=>L.item.type===_).length})]},_))})]}),s.length===0?i.jsxs("div",{className:"text-center py-8",children:[i.jsx(hl,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),i.jsx("p",{className:"text-muted-foreground",children:"Inventory is empty"}),o&&i.jsxs(q,{type:"button",variant:"outline",className:"mt-2",onClick:r,children:[i.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Add First Item"]})]}):S.length===0?i.jsxs("div",{className:"text-center py-8",children:[i.jsx(hl,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),i.jsx("p",{className:"text-muted-foreground",children:"No items match your filters"}),i.jsx(q,{type:"button",variant:"outline",className:"mt-2",onClick:k,children:"Clear Filters"})]}):i.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:S.map(_=>{const L=p(_.item._id);return i.jsx(zV,{item:_.item,quantity:_.quantity,onQuantityChange:j,onView:a,canEdit:o,showQuantityControls:o,isEquipped:!!L,equipmentSlot:L||void 0},_.item._id)})}),y&&i.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[i.jsxs("div",{className:"flex items-center gap-2 text-red-800",children:[i.jsx(sT,{className:"h-4 w-4"}),i.jsx("span",{className:"font-medium",children:"Carrying Capacity Exceeded"})]}),i.jsxs("p",{className:"text-red-700 text-sm mt-1",children:["You are carrying ",(x-e).toFixed(1)," lbs over your limit. This may result in movement penalties or other restrictions."]})]})]})]})}function HV({open:s,onOpenChange:e,mode:t,item:n,onSuccess:r}){var v,y,w,S,j,A,k;const a=Re(re.items.createItem),{generate:o,isGenerating:l}=lw(),c=kl({resolver:Nl(Uie),defaultValues:{name:(n==null?void 0:n.name)||"",type:(n==null?void 0:n.type)||"Other",rarity:(n==null?void 0:n.rarity)||"Common",description:(n==null?void 0:n.description)||"",effects:(n==null?void 0:n.effects)||"",weight:(n==null?void 0:n.weight)||void 0,cost:(n==null?void 0:n.cost)||void 0,attunement:(n==null?void 0:n.attunement)||!1,typeOfArmor:(n==null?void 0:n.typeOfArmor)||void 0,armorClass:(n==null?void 0:n.armorClass)||void 0,abilityModifiers:{strength:((v=n==null?void 0:n.abilityModifiers)==null?void 0:v.strength)||void 0,dexterity:((y=n==null?void 0:n.abilityModifiers)==null?void 0:y.dexterity)||void 0,constitution:((w=n==null?void 0:n.abilityModifiers)==null?void 0:w.constitution)||void 0,intelligence:((S=n==null?void 0:n.abilityModifiers)==null?void 0:S.intelligence)||void 0,wisdom:((j=n==null?void 0:n.abilityModifiers)==null?void 0:j.wisdom)||void 0,charisma:((A=n==null?void 0:n.abilityModifiers)==null?void 0:A.charisma)||void 0,initiative:((k=n==null?void 0:n.abilityModifiers)==null?void 0:k.initiative)||void 0}}}),d=L$({control:c.control,name:"type"});V.useEffect(()=>{var _,L,D,P,T,B;n&&(t==="edit"||t==="view")?c.reset({name:n.name,type:n.type,rarity:n.rarity,description:n.description,effects:n.effects||"",weight:n.weight||void 0,cost:n.cost||void 0,attunement:n.attunement||!1,typeOfArmor:n.typeOfArmor||void 0,armorClass:n.armorClass||void 0,abilityModifiers:{strength:((_=n.abilityModifiers)==null?void 0:_.strength)||void 0,dexterity:((L=n.abilityModifiers)==null?void 0:L.dexterity)||void 0,constitution:((D=n.abilityModifiers)==null?void 0:D.constitution)||void 0,intelligence:((P=n.abilityModifiers)==null?void 0:P.intelligence)||void 0,wisdom:((T=n.abilityModifiers)==null?void 0:T.wisdom)||void 0,charisma:((B=n.abilityModifiers)==null?void 0:B.charisma)||void 0}}):t==="create"&&c.reset({name:"",type:"Other",rarity:"Common",description:"",effects:"",weight:void 0,cost:void 0,attunement:!1,typeOfArmor:void 0,armorClass:void 0,abilityModifiers:{strength:void 0,dexterity:void 0,constitution:void 0,intelligence:void 0,wisdom:void 0,charisma:void 0}})},[n,t,c]);const h=async _=>{try{const L={..._,effects:_.effects||void 0,weight:_.weight||void 0,cost:_.cost||void 0,typeOfArmor:_.typeOfArmor||void 0,armorClass:_.armorClass||void 0,abilityModifiers:Object.keys(_.abilityModifiers||{}).length>0?Object.fromEntries(Object.entries(_.abilityModifiers||{}).filter(([,D])=>D!=null)):void 0};t==="create"&&await a(L),r==null||r(),e(!1),c.reset()}catch(L){console.error("Failed to save item:",L)}},f=()=>{switch(t){case"create":return"Create Item";case"edit":return"Edit Item";case"view":return"Item Details";default:return"Item"}},m=()=>{switch(t){case"create":return"Create a new magical or mundane item for your D&D campaign.";case"edit":return"Edit item properties and effects.";case"view":return"View item details and properties.";default:return""}},p=t==="view",x=c.formState.isSubmitting,g=d==="Armor",b=async()=>{try{rt.info("Generating item with GPT...",{duration:2e3});const _=await o("item");_.success&&_.data?(c.reset({name:_.data.name||"",type:_.data.type||"Other",rarity:_.data.rarity||"Common",description:_.data.description||"",effects:_.data.effects||"",weight:_.data.weight,cost:_.data.cost,attunement:_.data.attunement||!1,typeOfArmor:_.data.typeOfArmor,armorClass:_.data.armorClass,abilityModifiers:_.data.abilityModifiers||{strength:void 0,dexterity:void 0,constitution:void 0,intelligence:void 0,wisdom:void 0,charisma:void 0}}),rt.success("Item generated successfully! Review and adjust as needed.",{duration:3e3})):rt.error(_.error||"Failed to generate item")}catch(_){rt.error(_.message||"Failed to generate item")}};return i.jsx(cs,{open:s,onOpenChange:e,children:i.jsxs(is,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[i.jsx(Rs,{children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx(Ds,{children:f()}),i.jsx(Lr,{children:m()})]}),t==="create"&&i.jsx(q,{type:"button",variant:"outline",size:"sm",onClick:b,disabled:l||x,className:"ml-4",children:l?i.jsxs(i.Fragment,{children:[i.jsx(Ss,{className:"mr-2 h-4 w-4 animate-spin"}),"Generating..."]}):i.jsxs(i.Fragment,{children:[i.jsx(Aa,{className:"mr-2 h-4 w-4"}),"Generate with GPT"]})})]})}),i.jsx(Al,{...c,children:i.jsxs("form",{onSubmit:c.handleSubmit(h),className:"space-y-6",children:[i.jsxs("div",{className:"grid gap-6",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsx("h4",{className:"text-sm font-medium",children:"Basic Information"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsx(pe,{control:c.control,name:"name",render:({field:_})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Item Name *"}),i.jsx(ge,{children:i.jsx(_e,{placeholder:"Enter item name...",..._,disabled:p})}),i.jsx(nt,{children:"The name of the item (2-100 characters)"}),i.jsx(ye,{})]})}),i.jsx(pe,{control:c.control,name:"type",render:({field:_})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Item Type *"}),i.jsxs(wt,{onValueChange:_.onChange,defaultValue:_.value,disabled:p,children:[i.jsx(ge,{children:i.jsx(gt,{children:i.jsx(Ct,{placeholder:"Select item type..."})})}),i.jsx(xt,{children:Zie.map(L=>i.jsx(Ie,{value:L,children:L},L))})]}),i.jsx(nt,{children:"The category of this item"}),i.jsx(ye,{})]})})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsx(pe,{control:c.control,name:"rarity",render:({field:_})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Rarity *"}),i.jsxs(wt,{onValueChange:_.onChange,defaultValue:_.value,disabled:p,children:[i.jsx(ge,{children:i.jsx(gt,{children:i.jsx(Ct,{placeholder:"Select rarity..."})})}),i.jsx(xt,{children:Jie.map(L=>i.jsx(Ie,{value:L,children:L},L))})]}),i.jsx(nt,{children:"How rare and valuable this item is"}),i.jsx(ye,{})]})}),i.jsx(pe,{control:c.control,name:"attunement",render:({field:_})=>i.jsxs(fe,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4",children:[i.jsx(ge,{children:i.jsx("input",{type:"checkbox",checked:_.value,onChange:_.onChange,disabled:p,className:"mt-1"})}),i.jsxs("div",{className:"space-y-1 leading-none",children:[i.jsx(me,{children:"Requires Attunement"}),i.jsx(nt,{children:"Whether this item requires attunement to use"})]})]})})]}),i.jsx(pe,{control:c.control,name:"description",render:({field:_})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Description *"}),i.jsx(ge,{children:i.jsx(ps,{placeholder:"Describe the item's appearance, history, and basic properties...",className:"min-h-[100px]",..._,disabled:p})}),i.jsx(nt,{children:"Physical description and lore (max 1000 characters)"}),i.jsx(ye,{})]})})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("h4",{className:"text-sm font-medium",children:"Properties"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsx(pe,{control:c.control,name:"weight",render:({field:_})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Weight (lbs)"}),i.jsx(ge,{children:i.jsx(_e,{type:"number",step:"0.1",placeholder:"Item weight in pounds...",..._,onChange:L=>_.onChange(L.target.value?parseFloat(L.target.value):void 0),value:_.value||"",disabled:p})}),i.jsx(nt,{children:"Weight of the item in pounds"}),i.jsx(ye,{})]})}),i.jsx(pe,{control:c.control,name:"cost",render:({field:_})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Cost (gp)"}),i.jsx(ge,{children:i.jsx(_e,{type:"number",placeholder:"Cost in gold pieces...",..._,onChange:L=>_.onChange(L.target.value?parseInt(L.target.value):void 0),value:_.value||"",disabled:p})}),i.jsx(nt,{children:"Market value in gold pieces"}),i.jsx(ye,{})]})})]}),i.jsx(pe,{control:c.control,name:"effects",render:({field:_})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Magical Effects"}),i.jsx(ge,{children:i.jsx(ps,{placeholder:"Describe any magical effects, abilities, or special properties...",className:"min-h-[80px]",..._,disabled:p})}),i.jsx(nt,{children:"Mechanical effects and special abilities (max 500 characters)"}),i.jsx(ye,{})]})})]}),g&&i.jsxs("div",{className:"space-y-4",children:[i.jsx("h4",{className:"text-sm font-medium",children:"Armor Properties"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsx(pe,{control:c.control,name:"typeOfArmor",render:({field:_})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Armor Type"}),i.jsxs(wt,{onValueChange:_.onChange,defaultValue:_.value,disabled:p,children:[i.jsx(ge,{children:i.jsx(gt,{children:i.jsx(Ct,{placeholder:"Select armor type..."})})}),i.jsx(xt,{children:eae.map(L=>i.jsx(Ie,{value:L,children:L},L))})]}),i.jsx(nt,{children:"The category of armor"}),i.jsx(ye,{})]})}),i.jsx(pe,{control:c.control,name:"armorClass",render:({field:_})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Armor Class"}),i.jsx(ge,{children:i.jsx(_e,{type:"number",placeholder:"Base AC value...",..._,onChange:L=>_.onChange(L.target.value?parseInt(L.target.value):void 0),value:_.value||"",disabled:p})}),i.jsx(nt,{children:"Base armor class value (1-30)"}),i.jsx(ye,{})]})})]})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("h4",{className:"text-sm font-medium",children:"Ability Score Modifiers"}),i.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[{name:"strength",label:"Strength"},{name:"dexterity",label:"Dexterity"},{name:"constitution",label:"Constitution"},{name:"intelligence",label:"Intelligence"},{name:"wisdom",label:"Wisdom"},{name:"charisma",label:"Charisma"}].map(({name:_,label:L})=>{const D=c.getValues(`abilityModifiers.${_}`);return i.jsx(pe,{control:c.control,name:`abilityModifiers.${_}`,render:({field:P})=>i.jsxs(fe,{children:[i.jsx(me,{children:L}),i.jsx(ge,{children:p?i.jsx("div",{className:"flex h-10 w-full rounded-md border border-input bg-muted px-3 py-2 text-sm items-center",children:D?D>0?`+${D}`:`${D}`:""}):i.jsx(_e,{type:"number",placeholder:"+/-",...P,onChange:T=>P.onChange(T.target.value?parseInt(T.target.value):void 0),value:P.value||""})}),i.jsx(ye,{})]})},_)})}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Bonuses or penalties this item applies to ability scores (-5 to +10)"})]})]}),!p&&i.jsxs(Xn,{children:[i.jsx(q,{type:"button",variant:"outline",onClick:()=>e(!1),disabled:x,children:"Cancel"}),i.jsxs(q,{type:"submit",disabled:x,children:[x&&i.jsx(Ss,{className:"mr-2 h-4 w-4 animate-spin"}),t==="create"?"Create Item":"Save Changes"]})]}),p&&i.jsx(Xn,{children:i.jsx(q,{type:"button",variant:"outline",onClick:()=>e(!1),children:"Close"})})]})})]})})}function VV({inventory:s,equipment:e,equipmentBonuses:t,onInventoryChange:n,onEquipmentChange:r,onBonusesChange:a,canEdit:o=!0,isReadOnly:l=!1}){var U;const[c,d]=C.useState(s),[h,f]=C.useState(e),[m,p]=C.useState(t),[x,g]=C.useState(!1),[b,v]=C.useState(null),[y,w]=C.useState(!1),S=Fe(re.items.getMyItems)||[],j=b?S.find(M=>M._id===b):null;C.useEffect(()=>{d(s)},[s]),C.useEffect(()=>{f(e)},[e]),C.useEffect(()=>{p(t)},[t]);const A=M=>{d(M),n(M)},k=M=>{f(M),r(M)},_=M=>{p(M),a(M)},L=c.items.map(M=>{const $=S.find(W=>W._id===M.itemId);return $?{item:{_id:$._id,name:$.name,type:$.type,rarity:$.rarity,description:$.description,effects:$.effects,weight:$.weight,cost:$.cost,attunement:$.attunement,typeOfArmor:$.typeOfArmor,armorClass:$.armorClass,abilityModifiers:$.abilityModifiers,damageRolls:$.damageRolls},quantity:M.quantity}:null}).filter(M=>M!==null),D=(M,$)=>{const W=[...c.items],ee=W.findIndex(z=>z.itemId===M);ee>=0?$<=0?W.splice(ee,1):W[ee].quantity=$:$>0&&W.push({itemId:M,quantity:$});const Z={...c,items:W};A(Z)},P=M=>{const $=c.items.filter(ee=>ee.itemId!==M),W={...c,items:$};A(W)},T=()=>{g(!0)},B=M=>{v(M),w(!0)},R=M=>{const $={...c,capacity:M};A($)},O=L.reduce((M,$)=>M+($.item.weight||0)*$.quantity,0),I=L.reduce((M,$)=>M+($.item.cost||0)*$.quantity,0);return i.jsxs("div",{className:"space-y-6",children:[i.jsxs(Qn,{defaultValue:"inventory",className:"w-full",children:[i.jsxs(In,{className:"grid w-full grid-cols-2",children:[i.jsxs(Be,{value:"inventory",className:"flex items-center gap-2",children:[i.jsx(hl,{className:"h-4 w-4"}),"Inventory"]}),i.jsxs(Be,{value:"equipment",className:"flex items-center gap-2",children:[i.jsx(Dr,{className:"h-4 w-4"}),"Equipment"]})]}),i.jsxs($e,{value:"inventory",className:"space-y-6",children:[i.jsxs(oe,{children:[i.jsx(ke,{children:i.jsxs(Ne,{className:"flex items-center gap-2",children:[i.jsx(dk,{className:"h-5 w-5"}),"Inventory Settings"]})}),i.jsx(he,{children:i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx(st,{htmlFor:"capacity",children:"Carrying Capacity (lbs)"}),i.jsx(_e,{id:"capacity",type:"number",min:"0",value:c.capacity,onChange:M=>R(parseInt(M.target.value)||0),disabled:l,placeholder:"Enter capacity..."}),i.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Base carrying capacity is typically 15  Strength modifier"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{className:"text-sm font-medium",children:"Current Weight:"}),i.jsxs(ue,{variant:O>c.capacity?"destructive":"secondary",children:[O.toFixed(1)," / ",c.capacity," lbs"]})]}),i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{className:"text-sm font-medium",children:"Total Value:"}),i.jsxs(ue,{variant:"outline",children:[I," GP"]})]})]})]})})]}),i.jsx(nfe,{items:L,capacity:c.capacity,onQuantityChange:D,onRemoveItem:P,onAddItem:T,onViewItem:B,canEdit:o&&!l,title:"Character Inventory",equipment:h})]}),i.jsxs($e,{value:"equipment",className:"space-y-6",children:[i.jsxs(oe,{children:[i.jsx(ke,{children:i.jsxs(Ne,{className:"flex items-center gap-2",children:[i.jsx(Dr,{className:"h-5 w-5"}),"Equipment Management"]})}),i.jsx(he,{children:i.jsxs("div",{className:"space-y-4",children:[i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Object.entries(h).map(([M,$])=>{if(M==="accessories")return null;const W=S.find(Z=>Z._id===$),ee=M.replace(/([A-Z])/g," $1").replace(/^./,Z=>Z.toUpperCase());return i.jsxs("div",{className:"border rounded-lg p-3",children:[i.jsx("div",{className:"text-sm font-medium mb-2",children:ee}),W?i.jsxs("div",{className:"space-y-2",children:[i.jsx("div",{className:"text-sm font-semibold",children:W.name}),i.jsx("div",{className:"text-xs text-muted-foreground",children:W.type}),o&&!l&&i.jsx(q,{type:"button",size:"sm",variant:"outline",onClick:()=>{const Z={...h,[M]:void 0};k(Z)},children:"Unequip"})]}):i.jsx("div",{className:"text-sm text-muted-foreground",children:o&&!l?i.jsxs(q,{type:"button",size:"sm",variant:"outline",onClick:()=>g(!0),children:[i.jsx(Mt,{className:"h-4 w-4 mr-1"}),"Equip"]}):"Empty"})]},M)})}),i.jsxs("div",{className:"border rounded-lg p-4",children:[i.jsx("div",{className:"text-sm font-medium mb-3",children:"Accessories"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:[(U=h.accessories)==null?void 0:U.map((M,$)=>{const W=S.find(ee=>ee._id===M);return W?i.jsxs("div",{className:"border rounded p-2",children:[i.jsx("div",{className:"text-sm font-semibold",children:W.name}),i.jsx("div",{className:"text-xs text-muted-foreground",children:W.type}),o&&!l&&i.jsx(q,{type:"button",size:"sm",variant:"outline",onClick:()=>{var Z;const ee=((Z=h.accessories)==null?void 0:Z.filter((z,se)=>se!==$))||[];k({...h,accessories:ee})},children:"Remove"})]},M):null}),o&&!l&&i.jsxs(q,{type:"button",size:"sm",variant:"outline",onClick:()=>g(!0),className:"h-20 border-dashed",children:[i.jsx(Mt,{className:"h-4 w-4 mr-1"}),"Add Accessory"]})]})]})]})})]}),i.jsxs(oe,{children:[i.jsx(ke,{children:i.jsx(Ne,{children:"Equipment Bonuses"})}),i.jsx(he,{children:i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[i.jsxs("div",{children:[i.jsx(st,{htmlFor:"acBonus",children:"Armor Class Bonus"}),i.jsx(_e,{id:"acBonus",type:"number",min:"-10",max:"20",value:m.armorClass,onChange:M=>{const $={...m,armorClass:parseInt(M.target.value)||0};_($)},disabled:l})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsx(st,{children:"Ability Score Bonuses"}),Object.entries(m.abilityScores).map(([M,$])=>i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("span",{className:"text-sm font-medium capitalize",children:M}),i.jsx(_e,{type:"number",min:"-10",max:"10",value:$,onChange:W=>{const ee={...m,abilityScores:{...m.abilityScores,[M]:parseInt(W.target.value)||0}};_(ee)},disabled:l,className:"w-20"})]},M))]})]})})]})]})]}),j&&i.jsx(HV,{open:y,onOpenChange:w,mode:"view",item:j}),x&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-background p-6 rounded-lg max-w-2xl w-full max-h-[80vh] overflow-y-auto",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsx("h3",{className:"text-lg font-semibold",children:"Select Item"}),i.jsx(q,{type:"button",variant:"outline",onClick:()=>g(!1),children:"Close"})]}),i.jsx("div",{className:"space-y-2",children:S.map(M=>i.jsxs("div",{className:"flex items-center justify-between p-3 border rounded",children:[i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",children:M.name}),i.jsxs("div",{className:"text-sm text-muted-foreground",children:[M.type,"  ",M.rarity]})]}),i.jsx(q,{type:"button",size:"sm",onClick:()=>{const $=[...c.items],W=$.findIndex(ee=>ee.itemId===M._id);W>=0?$[W].quantity+=1:$.push({itemId:M._id,quantity:1}),A({...c,items:$}),g(!1)},children:"Add to Inventory"})]},M._id))})]})})]})}function Om(){const s=Array.from({length:4},()=>Math.floor(Math.random()*6)+1);return s.sort((e,t)=>t-e),s.slice(0,3).reduce((e,t)=>e+t,0)}function rfe(){return{strength:Om(),dexterity:Om(),constitution:Om(),intelligence:Om(),wisdom:Om(),charisma:Om()}}function Fm(s){return Math.floor((s-10)/2)}function ife({initialValues:s,onChange:e,disabled:t=!1}){const n={strength:10,dexterity:10,constitution:10,intelligence:10,wisdom:10,charisma:10},r={strength:8,dexterity:8,constitution:8,intelligence:8,wisdom:8,charisma:8},a=s??n,[o,l]=C.useState([]),[c,d]=C.useState(s??r),h=Fe(re.gameConstants.getAbilityScores)||[],f=Fe(re.gameConstants.getPointBuyCosts)||[],m=[{key:"strength",abbreviation:"STR",name:"Strength",sortOrder:1},{key:"dexterity",abbreviation:"DEX",name:"Dexterity",sortOrder:2},{key:"constitution",abbreviation:"CON",name:"Constitution",sortOrder:3},{key:"intelligence",abbreviation:"INT",name:"Intelligence",sortOrder:4},{key:"wisdom",abbreviation:"WIS",name:"Wisdom",sortOrder:5},{key:"charisma",abbreviation:"CHA",name:"Charisma",sortOrder:6}],p=[{score:8,cost:0},{score:9,cost:1},{score:10,cost:2},{score:11,cost:3},{score:12,cost:4},{score:13,cost:5},{score:14,cost:7},{score:15,cost:9}],x=h.length>0?h:m,g=f.length>0?f:p;if(!h&&h!==void 0)return i.jsx("div",{children:"Loading ability score data..."});if(!x||x.length===0)return console.warn("AbilityScoreGenerator: No ability scores available, using fallback"),i.jsx("div",{children:"Loading ability score data..."});if(!g||g.length===0)return console.warn("AbilityScoreGenerator: No point buy costs available, using fallback"),i.jsx("div",{children:"Loading ability score data..."});const b=Math.max(...g.map(B=>B.score)),v=Math.min(...g.map(B=>B.score)),y=27,w=x.sort((B,R)=>B.sortOrder-R.sortOrder),S=C.useCallback(()=>{const B=Array.from({length:3},()=>rfe());l(B)},[]),j=C.useCallback(B=>{e(B)},[e]),A=C.useCallback((B,R)=>{const O={...c,[B]:R};d(O),e(O)},[c,e]),k=C.useCallback((B,R)=>{const O={...a,[B]:R};e(O)},[a,e]);C.useEffect(()=>{d(s??r)},[s]);const _=B=>{var R;return((R=g.find(O=>O.score===B))==null?void 0:R.cost)??0},L=Object.values(c??r).reduce((B,R)=>{const O=_(R)-_(8);return B+Math.max(0,O)},0),D=y-L,P=B=>{const R=c[B];if(R>=b)return!1;const O=g.find(U=>U.score===R+1),I=g.find(U=>U.score===R);return!O||!I?!1:D>=O.cost-I.cost},T=B=>c[B]>v;return i.jsx("div",{className:"space-y-4",children:i.jsxs(Qn,{defaultValue:"manual",className:"w-full",children:[i.jsxs(In,{className:"grid w-full grid-cols-3",children:[i.jsx(Be,{value:"manual",children:"Manual"}),i.jsx(Be,{value:"roll",children:"Roll (4d6 drop lowest)"}),i.jsx(Be,{value:"pointbuy",children:"Point Buy (27 points)"})]}),i.jsx($e,{value:"manual",className:"space-y-4",children:i.jsxs(oe,{children:[i.jsxs(ke,{children:[i.jsx(Ne,{children:"Manual Entry"}),i.jsx(At,{children:"Enter ability scores manually (1-30)"})]}),i.jsx(he,{children:i.jsx("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4",children:w.map(({key:B,label:R,name:O,abbreviation:I})=>i.jsxs("div",{className:"space-y-2",children:[i.jsx(st,{htmlFor:`manual-${B}`,children:R??O??I}),i.jsx(_e,{id:`manual-${B}`,type:"number",min:v,max:30,value:a[B],onChange:U=>k(B,parseInt(U.target.value)||0),disabled:t}),i.jsxs("div",{className:"text-xs text-muted-foreground text-center",children:[Fm(a[B])>=0?"+":"",Fm(a[B])]})]},B))})})]})}),i.jsx($e,{value:"roll",className:"space-y-4",children:i.jsxs(oe,{children:[i.jsxs(ke,{children:[i.jsxs(Ne,{className:"flex items-center gap-2",children:[i.jsx(rL,{className:"h-5 w-5"}),"Roll for Stats"]}),i.jsx(At,{children:"Roll 4d6 and drop the lowest die for each ability score. Choose from 3 sets of rolls."})]}),i.jsx(he,{children:i.jsxs("div",{className:"space-y-4",children:[i.jsxs(q,{onClick:S,disabled:t,className:"w-full",children:[i.jsx(rL,{className:"mr-2 h-4 w-4"}),"Roll 3 Sets of Ability Scores"]}),o.length>0&&i.jsxs("div",{className:"space-y-3",children:[i.jsx("h4",{className:"text-sm font-medium",children:"Choose a set:"}),o.map((B,R)=>i.jsx(oe,{className:"cursor-pointer hover:bg-accent transition-colors",children:i.jsx(he,{className:"p-4",onClick:()=>j(B),children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("div",{className:"grid grid-cols-6 gap-2 flex-1",children:w.map(({key:O,abbreviation:I})=>i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-xs text-muted-foreground",children:I}),i.jsx("div",{className:"font-semibold",children:B[O]}),i.jsxs("div",{className:"text-xs text-muted-foreground",children:["(",Fm(B[O])>=0?"+":"",Fm(B[O]),")"]})]},O))}),i.jsx("div",{className:"ml-4",children:i.jsxs(ue,{variant:"secondary",children:["Total: ",Object.values(B).reduce((O,I)=>O+I,0)]})})]})})},R))]})]})})]})}),i.jsx($e,{value:"pointbuy",className:"space-y-4",children:i.jsxs(oe,{children:[i.jsxs(ke,{children:[i.jsx(Ne,{children:"Point Buy System"}),i.jsx(At,{children:"Distribute 27 points among your abilities. All abilities start at 8. Max score is 15."})]}),i.jsx(he,{children:i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted rounded-lg",children:[i.jsx("span",{className:"font-medium",children:"Points Remaining:"}),i.jsx(ue,{variant:D<0?"destructive":"default",children:D})]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:w.map(({key:B,label:R,name:O,abbreviation:I})=>{var U;return i.jsxs("div",{className:"space-y-2",children:[i.jsxs(st,{children:[R??O??I," (",I,")"]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(q,{size:"sm",variant:"outline",onClick:()=>A(B,c[B]-1),disabled:!T(B),children:"-"}),i.jsxs("div",{className:"flex-1 text-center",children:[i.jsx("div",{className:"font-semibold",children:c[B]}),i.jsxs("div",{className:"text-xs text-muted-foreground",children:["(",Fm(c[B])>=0?"+":"",Fm(c[B]),")"]}),i.jsxs("div",{className:"text-xs text-muted-foreground",children:["Cost: ",((U=g.find(M=>M.score===c[B]))==null?void 0:U.cost)||0]})]}),i.jsx(q,{size:"sm",variant:"outline",onClick:()=>A(B,c[B]+1),disabled:!P(B),children:"+"})]})]},B)})}),D!==0&&i.jsx("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:i.jsx("p",{className:"text-sm text-yellow-800",children:D>0?`You have ${D} unspent points.`:`You are ${Math.abs(D)} points over the limit.`})})]})})]})})]})})}function Zm({mode:s,selectedActionIds:e=[],inlineActions:t=[],onActionIdsChange:n,onInlineActionsChange:r,disabled:a=!1}){const[o,l]=C.useState({name:"",description:"",actionCost:"Action",type:"OTHER",requiresConcentration:!1,sourceBook:"Homebrew"}),[c,d]=C.useState({name:"",description:""}),[h,f]=C.useState(!1),m=xu(re.actions.getAllActions)||[],p=hz(re.actions.createAction),x=xu(re.gameConstants.getActionCosts)||[],g=[{value:"Action",icon:"Sword",color:"bg-red-100 text-red-800",description:"Standard action"},{value:"Bonus Action",icon:"Zap",color:"bg-yellow-100 text-yellow-800",description:"Bonus action"},{value:"Reaction",icon:"Shield",color:"bg-blue-100 text-blue-800",description:"Reaction"},{value:"No Action",icon:null,color:"bg-gray-100 text-gray-800",description:"No action required"},{value:"Special",icon:null,color:"bg-purple-100 text-purple-800",description:"Special action"}],b=x.length>0?x:g;if(!x&&x!==void 0)return i.jsx("div",{children:"Loading action costs..."});if(!b||b.length===0)return console.warn("ActionManager: No action costs available, using fallback"),i.jsx("div",{children:"Loading action costs..."});if(!Array.isArray(m))return console.warn("ActionManager: Actions is not an array:",m),i.jsx("div",{children:"Loading actions..."});const v=m.filter(D=>e.includes(D._id)),y=m.filter(D=>!e.includes(D._id)),w=(D,P)=>{if(!n)return;const T=P?[...e,D]:e.filter(B=>B!==D);n(T)},S=async()=>{if(!(!o.name||!o.description))try{await p(o),l({name:"",description:"",actionCost:"Action",type:"OTHER",requiresConcentration:!1,sourceBook:"Homebrew"})}catch(D){console.error("Failed to create action:",D)}},j=()=>{!c.name||!c.description||!r||(r([...t,c]),d({name:"",description:""}))},A=D=>{r&&r(t.filter((P,T)=>T!==D))},k=D=>b.find(P=>P.value===D),_=D=>{const P=k(D);if(!(P!=null&&P.icon))return null;switch(P.icon){case"Sword":return i.jsx(En,{className:"h-4 w-4"});case"Zap":return i.jsx(Da,{className:"h-4 w-4"});case"Shield":return i.jsx(Dr,{className:"h-4 w-4"});default:return null}},L=D=>{const P=k(D);return(P==null?void 0:P.color)||"bg-gray-100 text-gray-800"};return s==="character"?i.jsx("div",{className:"space-y-4",children:i.jsxs(Qn,{defaultValue:"current",className:"w-full",children:[i.jsxs(In,{className:"grid w-full grid-cols-3",children:[i.jsx(Be,{value:"current",children:"Current Actions"}),i.jsx(Be,{value:"available",children:"Add Actions"}),i.jsx(Be,{value:"homebrew",children:"Create Homebrew"})]}),i.jsxs($e,{value:"current",className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("h4",{className:"text-sm font-medium",children:["Character Actions (",v.length,")"]}),v.length===0&&i.jsx("p",{className:"text-sm text-muted-foreground",children:"No actions assigned yet"})]}),v.length>0?i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-h-96 overflow-y-auto p-4",children:v.map(D=>i.jsx(oe,{className:"cursor-pointer transition-colors ring-2 ring-primary",children:i.jsx(he,{className:"p-4",children:i.jsxs("div",{className:"flex flex-col h-full",children:[i.jsxs("div",{className:"flex items-start justify-between mb-2",children:[i.jsx("div",{className:"flex-1",children:i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx("h4",{className:"font-medium",children:D.name}),i.jsxs(ue,{variant:"secondary",className:L(D.actionCost),children:[_(D.actionCost),i.jsx("span",{className:"ml-1",children:D.actionCost})]})]})}),i.jsx(q,{onClick:()=>w(D._id,!1),size:"sm",variant:"ghost",disabled:a,className:"text-destructive hover:text-destructive flex-shrink-0",children:i.jsx(kx,{className:"h-4 w-4"})})]}),i.jsx("p",{className:"text-sm text-muted-foreground mb-2 flex-grow",children:D.description}),D.damageRolls&&D.damageRolls.length>0&&i.jsxs("div",{className:"mb-2",children:[i.jsx("div",{className:"text-xs font-medium text-foreground mb-1",children:"Damage:"}),i.jsx("div",{className:"text-sm text-muted-foreground",children:D.damageRolls.map((P,T)=>i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsxs("span",{children:[P.dice.count,P.dice.type.toLowerCase(),P.modifier!==0&&i.jsxs("span",{children:[P.modifier>0?"+":"",P.modifier]})]}),i.jsx(ue,{variant:"outline",className:"text-xs",children:P.damageType})]},T))})]}),i.jsxs("div",{className:"flex gap-2 text-xs text-muted-foreground flex-wrap",children:[i.jsxs("span",{children:["Type: ",D.type]}),i.jsx("span",{children:""}),i.jsxs("span",{children:["Source: ",D.sourceBook]}),D.requiresConcentration&&i.jsxs(i.Fragment,{children:[i.jsx("span",{children:""}),i.jsx("span",{children:"Concentration"})]})]})]})})},D._id))}):i.jsxs(oe,{className:"p-6 text-center",children:[i.jsx("p",{className:"text-muted-foreground mb-4",children:"This character doesn't have any actions yet."}),i.jsxs(q,{onClick:()=>f(!0),variant:"outline",disabled:a,children:[i.jsx(Mt,{className:"mr-2 h-4 w-4"}),"Add Actions"]})]})]}),i.jsxs($e,{value:"available",className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("h4",{className:"text-sm font-medium",children:["Available Actions (",y.length,")"]}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Select actions to add to this character"})]}),y.length>0?i.jsx("div",{className:"grid gap-3 max-h-96 overflow-y-auto p-4",children:y.map(D=>i.jsx(oe,{className:"cursor-pointer transition-colors hover:ring-2 hover:ring-primary",children:i.jsx(he,{className:"p-4",children:i.jsx("div",{className:"flex items-start justify-between",children:i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx(ii,{checked:!1,onCheckedChange:P=>w(D._id,P),disabled:a}),i.jsx("h4",{className:"font-medium",children:D.name}),i.jsxs(ue,{variant:"secondary",className:L(D.actionCost),children:[_(D.actionCost),i.jsx("span",{className:"ml-1",children:D.actionCost})]})]}),i.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:D.description}),i.jsxs("div",{className:"flex gap-2 text-xs text-muted-foreground",children:[i.jsxs("span",{children:["Type: ",D.type]}),i.jsx("span",{children:""}),i.jsxs("span",{children:["Source: ",D.sourceBook]}),D.requiresConcentration&&i.jsxs(i.Fragment,{children:[i.jsx("span",{children:""}),i.jsx("span",{children:"Concentration"})]})]})]})})})},D._id))}):i.jsx(oe,{className:"p-6 text-center",children:i.jsx("p",{className:"text-muted-foreground",children:"All available actions have been added to this character."})})]}),i.jsx($e,{value:"homebrew",className:"space-y-4",children:i.jsxs(oe,{children:[i.jsxs(ke,{children:[i.jsx(Ne,{children:"Create Homebrew Action"}),i.jsx(At,{children:"Create a custom action for this character"})]}),i.jsxs(he,{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(st,{htmlFor:"action-name",children:"Action Name"}),i.jsx(_e,{id:"action-name",value:o.name,onChange:D=>l({...o,name:D.target.value}),placeholder:"Enter action name...",disabled:a})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(st,{children:"Action Cost"}),i.jsx("div",{className:"flex flex-wrap gap-2",children:b.map(({value:D,icon:P,color:T,description:B})=>i.jsxs(ue,{variant:"secondary",className:`cursor-pointer ${T}`,onClick:()=>l(R=>({...R,actionCost:D})),children:[_(D),i.jsx("span",{className:"ml-1",children:D})]},D))})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(st,{htmlFor:"action-description",children:"Description"}),i.jsx(ps,{id:"action-description",value:o.description,onChange:D=>l({...o,description:D.target.value}),placeholder:"Describe what this action does...",disabled:a})]}),i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(ii,{id:"concentration",checked:o.requiresConcentration,onCheckedChange:D=>l({...o,requiresConcentration:D}),disabled:a}),i.jsx(st,{htmlFor:"concentration",children:"Requires Concentration"})]}),i.jsxs(q,{onClick:S,disabled:a||!o.name||!o.description,className:"w-full",children:[i.jsx(Mt,{className:"mr-2 h-4 w-4"}),"Create Homebrew Action"]})]})]})})]})}):i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx("h4",{className:"text-sm font-medium",children:"Monster Actions"}),i.jsxs(q,{onClick:()=>d({name:"",description:""}),size:"sm",variant:"outline",disabled:a,children:[i.jsx(Mt,{className:"mr-2 h-4 w-4"}),"Add Action"]})]}),i.jsxs("div",{className:"space-y-3",children:[t.map((D,P)=>i.jsx(oe,{children:i.jsx(he,{className:"p-4",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("h4",{className:"font-medium mb-1",children:D.name}),i.jsx("p",{className:"text-sm text-muted-foreground",children:D.description})]}),i.jsx(q,{onClick:()=>A(P),size:"sm",variant:"ghost",disabled:a,children:i.jsx(kx,{className:"h-4 w-4"})})]})})},P)),i.jsx(oe,{children:i.jsxs(he,{className:"p-4 space-y-3",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx(st,{htmlFor:"inline-action-name",children:"Action Name"}),i.jsx(_e,{id:"inline-action-name",value:c.name,onChange:D=>d({...c,name:D.target.value}),placeholder:"Enter action name...",disabled:a})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(st,{htmlFor:"inline-action-description",children:"Description"}),i.jsx(ps,{id:"inline-action-description",value:c.description,onChange:D=>d({...c,description:D.target.value}),placeholder:"Describe what this action does...",disabled:a})]}),i.jsxs(q,{onClick:j,disabled:a||!c.name||!c.description,size:"sm",children:[i.jsx(Mt,{className:"mr-2 h-4 w-4"}),"Add Action"]})]})})]})]})}function TA(s){return Math.floor((s-10)/2)}function VM(s){var f,m,p,x,g,b,v,y,w,S,j,A;const e=[];let t=0;if(((f=s.abilityModifiers)==null?void 0:f.dexterity)!==void 0?t=s.abilityModifiers.dexterity:((m=s.abilityScores)==null?void 0:m.dexterity)!==void 0?t=TA(s.abilityScores.dexterity):s.dexterity!==void 0&&(t=TA(s.dexterity)),(x=(p=s.equipmentBonuses)==null?void 0:p.abilityScores)!=null&&x.dexterity){const k=s.equipmentBonuses.abilityScores.dexterity;if(((g=s.abilityScores)==null?void 0:g.dexterity)!==void 0){const _=s.abilityScores.dexterity+k,L=TA(_),D=L-t;D!==0&&e.push({source:"item",sourceName:"Equipment",bonus:D,type:"bonus",description:"Equipment bonus to Dexterity"}),t=L}}e.push({source:"dexterity",sourceName:"Dexterity Modifier",bonus:t,type:"bonus"});let n=!1,r=!1,a;if((((b=s.feats)==null?void 0:b.some(k=>k.name.toLowerCase().includes("alert")))||!1)&&e.push({source:"feat",sourceName:"Alert",bonus:5,type:"bonus",description:"You gain a +5 bonus to initiative"}),((v=s.classes)==null?void 0:v.find(k=>k.name==="Rogue"&&k.subclass==="Swashbuckler"&&k.level>=3))&&((y=s.abilityModifiers)==null?void 0:y.charisma)!==void 0){const k=s.abilityModifiers.charisma;e.push({source:"class_feature",sourceName:"Swashbuckler (Rakish Audacity)",bonus:k,type:"bonus",description:"Add your Charisma modifier to initiative rolls"})}if((((w=s.features)==null?void 0:w.some(k=>k.name.toLowerCase().includes("feral instinct")||k.source==="class"&&k.name.toLowerCase().includes("barbarian")))||((S=s.classes)==null?void 0:S.some(k=>k.name==="Barbarian"&&k.level>=7)))&&(n=!0,e.push({source:"class_feature",sourceName:"Feral Instinct (Barbarian)",bonus:0,type:"advantage",description:"You have advantage on initiative rolls"})),((j=s.features)==null?void 0:j.some(k=>k.name.toLowerCase().includes("hare-trigger")||k.name.toLowerCase().includes("harengon")))&&s.classes&&s.classes.length>0){const k=s.classes.reduce((L,D)=>L+D.level,0),_=Math.ceil(k/4)+1;e.push({source:"racial",sourceName:"Hare-Trigger (Harengon)",bonus:_,type:"bonus",description:"Add your proficiency bonus to initiative rolls"})}s.conditions&&s.conditions.find(_=>_.toLowerCase().includes("exhaustion"))&&(r=!0,e.push({source:"condition",sourceName:"Exhaustion",bonus:0,type:"disadvantage",description:"Exhaustion can impose disadvantage on ability checks"})),(A=s.equipmentBonuses)!=null&&A.initiative&&e.push({source:"item",sourceName:"Equipment (Initiative)",bonus:s.equipmentBonuses.initiative,type:"bonus",description:"Direct initiative bonus from equipped items"});const h=e.reduce((k,_)=>_.type==="bonus"||_.type==="dice"?k+_.bonus:k,0);return{baseModifier:t,totalModifier:h,sources:e,hasAdvantage:n,hasDisadvantage:r,diceBonus:a}}function afe(s,e,t,n,r){const a=s.hasAdvantage,o=s.hasDisadvantage;let l=Math.floor(Math.random()*20)+1;if(a&&!o){const h=Math.floor(Math.random()*20)+1;l=Math.max(l,h)}else if(o&&!a){const h=Math.floor(Math.random()*20)+1;l=Math.min(l,h)}let c=0;r&&(c=Math.floor(Math.random()*r)+1);const d=l+s.totalModifier+c;return{roll:l,modifier:s.totalModifier,total:d,dexterityScore:e,breakdown:{...s,diceBonus:r}}}function WV(s){const e=[];e.push(`Dex ${s.baseModifier>=0?"+":""}${s.baseModifier}`),s.sources.forEach(r=>{r.source!=="dexterity"&&r.bonus!==0&&(r.type==="bonus"?e.push(`${r.sourceName} ${r.bonus>=0?"+":""}${r.bonus}`):r.type==="advantage"?e.push(`${r.sourceName} (advantage)`):r.type==="disadvantage"&&e.push(`${r.sourceName} (disadvantage)`))});let n=`Modifier: ${s.totalModifier>=0?`+${s.totalModifier}`:`${s.totalModifier}`}`;return e.length>1&&(n+=` (${e.join(", ")})`),s.hasAdvantage&&(n+=" [Advantage]"),s.hasDisadvantage&&(n+=" [Disadvantage]"),n}const ofe=["Acrobatics","Animal Handling","Arcana","Athletics","Deception","History","Insight","Intimidation","Investigation","Medicine","Nature","Perception","Performance","Persuasion","Religion","Sleight of Hand","Stealth","Survival"],lfe=["Strength","Dexterity","Constitution","Intelligence","Wisdom","Charisma"];function qV({open:s,onOpenChange:e,mode:t,character:n,characterType:r,onSuccess:a}){var ee,Z,z,se,de,ne;const o=Re(re.characters.createPlayerCharacter),l=Re(re.characters.createNPC),c=xu(re.actions.getAllActions)||[],d=hz(re.actions.createAction),{generate:h,isGenerating:f}=lw(),[m,p]=C.useState(null),[x,g]=C.useState(null),b=kl({resolver:Nl(t==="create"?Vie:N6),defaultValues:{name:(n==null?void 0:n.name)||"",race:(n==null?void 0:n.race)||"",class:(n==null?void 0:n.class)||"",background:(n==null?void 0:n.background)||"",alignment:(n==null?void 0:n.alignment)||"",level:(n==null?void 0:n.level)||1,abilityScores:{strength:((ee=n==null?void 0:n.abilityScores)==null?void 0:ee.strength)||10,dexterity:((Z=n==null?void 0:n.abilityScores)==null?void 0:Z.dexterity)||10,constitution:((z=n==null?void 0:n.abilityScores)==null?void 0:z.constitution)||10,intelligence:((se=n==null?void 0:n.abilityScores)==null?void 0:se.intelligence)||10,wisdom:((de=n==null?void 0:n.abilityScores)==null?void 0:de.wisdom)||10,charisma:((ne=n==null?void 0:n.abilityScores)==null?void 0:ne.charisma)||10},hitPoints:(n==null?void 0:n.hitPoints)||1,armorClass:(n==null?void 0:n.armorClass)||10,speed:(n==null?void 0:n.speed)||"",skills:(n==null?void 0:n.skills)||[],savingThrows:(n==null?void 0:n.savingThrows)||[],proficiencies:(n==null?void 0:n.proficiencies)||[]}}),[v,y]=V.useState((n==null?void 0:n.actions)||[]),[w,S]=C.useState(!1),[j,A]=C.useState({capacity:150,items:[]}),[k,_]=C.useState({headgear:void 0,armwear:void 0,chestwear:void 0,legwear:void 0,footwear:void 0,mainHand:void 0,offHand:void 0,accessories:[]}),[L,D]=C.useState({armorClass:0,abilityScores:{strength:0,dexterity:0,constitution:0,intelligence:0,wisdom:0,charisma:0}});V.useEffect(()=>{n&&(t==="edit"||t==="view")?(b.reset({name:n.name,race:n.race,class:n.class,background:n.background,alignment:n.alignment||"",level:n.level,abilityScores:n.abilityScores,hitPoints:n.hitPoints,armorClass:n.armorClass,speed:n.speed||"",skills:n.skills,savingThrows:n.savingThrows,proficiencies:n.proficiencies}),n.inventory&&A(n.inventory),n.equipment&&_(n.equipment),n.equipmentBonuses&&D(n.equipmentBonuses),n.actions&&y(n.actions)):t==="create"&&(b.reset({name:"",race:"",class:"",background:"",alignment:"",level:1,abilityScores:{strength:10,dexterity:10,constitution:10,intelligence:10,wisdom:10,charisma:10},hitPoints:1,armorClass:10,speed:"30 ft.",skills:[],savingThrows:[],proficiencies:[]}),A({capacity:150,items:[]}),_({headgear:void 0,armwear:void 0,chestwear:void 0,legwear:void 0,footwear:void 0,mainHand:void 0,offHand:void 0,accessories:[]}),D({armorClass:0,abilityScores:{strength:0,dexterity:0,constitution:0,intelligence:0,wisdom:0,charisma:0}}),y([]))},[n,t,b]);const P=(H,Y)=>{var ce,Ue;if(p(Y),g(null),H){console.log("Character successfully imported to server:",H),a==null||a(),e(!1);return}const ae={name:Y.name,race:Y.race,subrace:Y.subrace,class:((ce=Y.classes[0])==null?void 0:ce.name)||"Fighter",classes:Y.classes.map(te=>{const K=["d6","d8","d10","d12"].includes(te.hitDie)?te.hitDie:"d8";return{name:te.name,level:te.level,hitDie:K,features:te.features,subclass:te.subclass}}),background:Y.background,alignment:Y.alignment,level:Y.level,abilityScores:Y.abilityScores,baseAbilityScores:Y.baseAbilityScores,racialAbilityScoreImprovements:Y.racialAbilityScoreImprovements,hitPoints:Y.hitPoints,maxHitPoints:Y.maxHitPoints,currentHitPoints:Y.currentHitPoints,tempHitPoints:Y.tempHitPoints,hitDice:(Ue=Y.hitDice)==null?void 0:Ue.map(te=>({die:["d6","d8","d10","d12"].includes(te.die)?te.die:"d8",current:te.current,max:te.max})),armorClass:Y.armorClass,baseArmorClass:Y.baseArmorClass,speed:Y.speed,speeds:Y.speeds,skills:Y.skills,skillProficiencies:Y.skillProficiencies,savingThrows:Y.savingThrows,savingThrowProficiencies:Y.savingThrowProficiencies,proficiencies:Y.proficiencies,weaponProficiencies:Y.weaponProficiencies,armorProficiencies:Y.armorProficiencies,toolProficiencies:Y.toolProficiencies,traits:Y.traits,racialTraits:Y.racialTraits,languages:Y.languages,initiative:Y.initiative,passivePerception:Y.passivePerception,passiveInvestigation:Y.passiveInvestigation,passiveInsight:Y.passiveInsight,spellcastingAbility:["Intelligence","Wisdom","Charisma"].includes(Y.spellcastingAbility)?Y.spellcastingAbility:void 0,spellSaveDC:Y.spellSaveDC,spellAttackBonus:Y.spellAttackBonus,spellSlots:Y.spellSlots,spellsKnown:Y.spellsKnown,cantripsKnown:Y.cantripsKnown,features:Y.features,feats:Y.feats,inspiration:Y.inspiration,deathSaves:Y.deathSaves,importedFrom:Y.importedFrom??Y.importSource,importData:Y.importData??Y.originalData,equipmentBonuses:{armorClass:0,abilityScores:{strength:0,dexterity:0,constitution:0,intelligence:0,wisdom:0,charisma:0}}};b.reset(ae),Y.classes.length>1&&S(!0);try{const te=$V(Y.parsedEquipment||Y.equipment||{});te!=null&&te.inventory&&A(te.inventory),te!=null&&te.equipment&&_(te.equipment)}catch{}Y.equipment&&_({headgear:Y.equipment.headgear,armwear:Y.equipment.armwear,chestwear:Y.equipment.chestwear,legwear:Y.equipment.legwear,footwear:Y.equipment.footwear,mainHand:Y.equipment.mainHand,offHand:Y.equipment.offHand,accessories:Y.equipment.accessories||[]}),(async()=>{var be;const te=Y.actions||((be=Y.parsedActions)==null?void 0:be.allNames)||[];if(!te||te.length===0)return;const J=Array.isArray(c)?c:[],K=[];for(const Me of te){const De=J.find(_t=>{var et;return((et=_t.name)==null?void 0:et.toLowerCase())===String(Me).toLowerCase()});if(De!=null&&De._id){K.push(De._id);continue}try{const _t=await d({name:String(Me),description:`Imported action: ${Me}`,actionCost:"Action",type:"OTHER",requiresConcentration:!1,sourceBook:"Imported"});_t&&K.push(_t)}catch{}}K.length>0&&y(K)})(),setTimeout(()=>{const te=document.querySelector('[value="basic"]');te&&te.click()},100)},T=H=>{g(H),p(null)},B=async H=>{try{const Y={...H,inventory:{capacity:j.capacity,items:j.items},equipment:k,equipmentBonuses:L,abilityScores:{strength:H.abilityScores.strength+L.abilityScores.strength,dexterity:H.abilityScores.dexterity+L.abilityScores.dexterity,constitution:H.abilityScores.constitution+L.abilityScores.constitution,intelligence:H.abilityScores.intelligence+L.abilityScores.intelligence,wisdom:H.abilityScores.wisdom+L.abilityScores.wisdom,charisma:H.abilityScores.charisma+L.abilityScores.charisma},armorClass:H.armorClass+L.armorClass,actions:v};t==="create"&&(r==="player"?await o(Y):await l(Y)),a==null||a(),e(!1),b.reset(),y([]),p(null),g(null),S(!1),A({capacity:150,items:[]}),_({headgear:void 0,armwear:void 0,chestwear:void 0,legwear:void 0,footwear:void 0,mainHand:void 0,offHand:void 0,accessories:[]}),D({armorClass:0,abilityScores:{strength:0,dexterity:0,constitution:0,intelligence:0,wisdom:0,charisma:0}})}catch(Y){console.error("Failed to save character:",Y)}},R=()=>{const H=r==="player"?"Character":"NPC";switch(t){case"create":return`Create ${H}`;case"edit":return`Edit ${H}`;case"view":return`${H} Details`;default:return H}},O=()=>{const H=r==="player"?"player character":"NPC";switch(t){case"create":return`Create a new ${H} for your D&D campaign.`;case"edit":return`Edit ${H} details and stats.`;case"view":return`View ${H} character sheet.`;default:return""}},I=t==="view",U=b.formState.isSubmitting,M=H=>{const Y=b.getValues("skills"),ae=Y.includes(H)?Y.filter(ce=>ce!==H):[...Y,H];b.setValue("skills",ae)},$=H=>{const Y=b.getValues("savingThrows"),ae=Y.includes(H)?Y.filter(ce=>ce!==H):[...Y,H];b.setValue("savingThrows",ae)},W=async()=>{try{rt.info("Generating character with GPT...",{duration:2e3});const H=await h("character");H.success&&H.data?(b.reset({name:H.data.name||"",race:H.data.race||"",class:H.data.class||"",background:H.data.background||"",alignment:H.data.alignment||"",level:H.data.level||1,abilityScores:H.data.abilityScores||{strength:10,dexterity:10,constitution:10,intelligence:10,wisdom:10,charisma:10},hitPoints:H.data.hitPoints||1,armorClass:H.data.armorClass||10,speed:H.data.speed||"30 ft.",proficiencyBonus:H.data.proficiencyBonus||2,skills:H.data.skills||[],savingThrows:H.data.savingThrows||[],proficiencies:H.data.proficiencies||[],languages:H.data.languages||[],traits:H.data.traits||[]}),rt.success("Character generated successfully! Review and adjust as needed.",{duration:3e3})):rt.error(H.error||"Failed to generate character")}catch(H){rt.error(H.message||"Failed to generate character")}};return i.jsx(cs,{open:s,onOpenChange:e,children:i.jsxs(is,{className:"max-w-7xl w-[95vw] max-h-[95vh] flex flex-col p-0",children:[i.jsx("div",{className:"flex-shrink-0 px-6 pt-6 pb-4",children:i.jsx(Rs,{children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx(Ds,{children:R()}),i.jsx(Lr,{children:O()})]}),t==="create"&&!m&&i.jsx(q,{type:"button",variant:"outline",size:"sm",onClick:W,disabled:f||U,className:"ml-4",children:f?i.jsxs(i.Fragment,{children:[i.jsx(Ss,{className:"mr-2 h-4 w-4 animate-spin"}),"Generating..."]}):i.jsxs(i.Fragment,{children:[i.jsx(Aa,{className:"mr-2 h-4 w-4"}),"Generate with GPT"]})})]})})}),i.jsx(Al,{...b,children:i.jsxs("form",{onSubmit:b.handleSubmit(B),className:"flex flex-col flex-1 min-h-0",children:[i.jsx("div",{className:"flex-1 overflow-y-auto px-6 pb-4 space-y-6",children:i.jsxs(Qn,{defaultValue:t==="create"&&!m?"import":"basic",className:"w-full",children:[i.jsxs(In,{className:"grid w-full grid-cols-6",children:[t==="create"&&i.jsx(Be,{value:"import",children:"Import"}),i.jsx(Be,{value:"basic",children:"Basic Info"}),i.jsx(Be,{value:"classes",children:"Classes"}),i.jsx(Be,{value:"stats",children:"Stats & Scores"}),i.jsx(Be,{value:"inventory",children:"Inventory"}),i.jsx(Be,{value:"actions",children:"Actions"})]}),t==="create"&&i.jsx($e,{value:"import",className:"space-y-6",children:m?i.jsxs("div",{className:"space-y-6",children:[i.jsxs(ur,{className:"border-green-200 bg-green-50",children:[i.jsx(Yi,{className:"h-4 w-4 text-green-600"}),i.jsxs(hr,{className:"text-green-800",children:[i.jsx("strong",{children:"Import Successful!"})," Character data has been imported and populated into the form tabs. You can now review and edit the information in the other tabs before saving."]})]}),i.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsx("h4",{className:"font-medium",children:"Quick Summary"}),i.jsx("div",{className:"p-4 border rounded-lg bg-background",children:i.jsxs("div",{className:"space-y-2 text-sm",children:[i.jsxs("div",{children:[i.jsx("strong",{children:"Name:"})," ",m.name]}),i.jsxs("div",{children:[i.jsx("strong",{children:"Race:"})," ",m.race]}),i.jsxs("div",{children:[i.jsx("strong",{children:"Classes:"})," ",m.classes.map(H=>`${H.name} ${H.level}`).join(", ")]}),i.jsxs("div",{children:[i.jsx("strong",{children:"Total Level:"})," ",m.level]}),i.jsxs("div",{children:[i.jsx("strong",{children:"Background:"})," ",m.background]})]})}),i.jsx(q,{variant:"outline",size:"sm",onClick:()=>{p(null),g(null)},children:"Import Different Character"})]}),i.jsx(Yhe,{characterData:m,className:"h-fit",showConfidenceFlags:!0,onCharacterDataChange:H=>{p(H),P("",H)}})]})]}):i.jsxs("div",{className:"space-y-6",children:[i.jsxs(Qn,{defaultValue:"json",className:"w-full",children:[i.jsxs(In,{className:"grid w-full grid-cols-2",children:[i.jsx(Be,{value:"json",children:"JSON Import"}),i.jsx(Be,{value:"pdf",children:"PDF Import"})]}),i.jsx($e,{value:"json",className:"space-y-4",children:i.jsx(Ghe,{onImportSuccess:P,onImportError:T,disabled:U})}),i.jsx($e,{value:"pdf",className:"space-y-4",children:i.jsx(Qhe,{onImportSuccess:P,onImportError:T,disabled:U})})]}),x&&i.jsxs(ur,{className:"border-red-200 bg-red-50",children:[i.jsx(Na,{className:"h-4 w-4 text-red-600"}),i.jsx(hr,{className:"text-red-800",children:x})]})]})}),i.jsx($e,{value:"basic",className:"space-y-6",children:i.jsxs("div",{className:"grid gap-6",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsx("h4",{className:"text-sm font-medium",children:"Basic Information"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsx(pe,{control:b.control,name:"name",render:({field:H})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Character Name *"}),i.jsx(ge,{children:i.jsx(_e,{placeholder:"Enter character name...",...H,disabled:I})}),i.jsx(nt,{children:"The character's name (2-100 characters)"}),i.jsx(ye,{})]})}),i.jsx(pe,{control:b.control,name:"level",render:({field:H})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Level *"}),i.jsx(ge,{children:i.jsx(_e,{type:"number",min:"1",max:"20",...H,onChange:Y=>H.onChange(parseInt(Y.target.value)),disabled:I})}),i.jsx(nt,{children:"Character level (1-20)"}),i.jsx(ye,{})]})})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[i.jsx(pe,{control:b.control,name:"race",render:({field:H})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Race *"}),i.jsx(ge,{children:i.jsx(_e,{placeholder:"e.g., Human, Elf, Dwarf...",...H,disabled:I})}),i.jsx(ye,{})]})}),i.jsx(pe,{control:b.control,name:"class",render:({field:H})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Class *"}),i.jsx(ge,{children:i.jsx(_e,{placeholder:"e.g., Fighter, Wizard, Rogue...",...H,disabled:I})}),i.jsx(ye,{})]})}),i.jsx(pe,{control:b.control,name:"background",render:({field:H})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Background *"}),i.jsx(ge,{children:i.jsx(_e,{placeholder:"e.g., Soldier, Noble, Criminal...",...H,disabled:I})}),i.jsx(ye,{})]})})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsx(pe,{control:b.control,name:"alignment",render:({field:H})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Alignment"}),i.jsx(ge,{children:i.jsx(_e,{placeholder:"e.g., Lawful Good, Chaotic Neutral...",...H,disabled:I})}),i.jsx(nt,{children:"Character's moral and ethical outlook"}),i.jsx(ye,{})]})}),i.jsx(pe,{control:b.control,name:"speed",render:({field:H})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Speed"}),i.jsx(ge,{children:i.jsx(_e,{placeholder:"e.g., 30 ft., 25 ft., 35 ft...",...H,disabled:I})}),i.jsx(nt,{children:"Movement speed"}),i.jsx(ye,{})]})})]})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("h4",{className:"text-sm font-medium",children:"Combat Statistics"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsx(pe,{control:b.control,name:"hitPoints",render:({field:H})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Hit Points *"}),i.jsx(ge,{children:i.jsx(_e,{type:"number",min:"1",...H,onChange:Y=>H.onChange(parseInt(Y.target.value)),disabled:I})}),i.jsx(nt,{children:"Maximum hit points (1-1000)"}),i.jsx(ye,{})]})}),i.jsx(pe,{control:b.control,name:"armorClass",render:({field:H})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Armor Class *"}),i.jsx(ge,{children:i.jsx(_e,{type:"number",min:"1",max:"30",...H,onChange:Y=>H.onChange(parseInt(Y.target.value)),disabled:I})}),i.jsx(nt,{children:"Armor class (1-30)"}),i.jsx(ye,{})]})})]}),i.jsxs("div",{className:"space-y-2 pt-2",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(ci,{className:"h-4 w-4 text-purple-500"}),i.jsx("h4",{className:"text-sm font-medium",children:"Initiative Modifier"})]}),i.jsx("div",{className:"pl-6 space-y-1",children:(()=>{var De,_t,et,G;const H=b.watch("abilityScores")||(n==null?void 0:n.abilityScores)||{strength:10,dexterity:10,constitution:10,intelligence:10,wisdom:10,charisma:10},Y=b.watch("classes"),ae=n==null?void 0:n.classes,ce=Y||ae||(b.watch("class")||n!=null&&n.class?[{name:b.watch("class")||(n==null?void 0:n.class)||"",level:b.watch("level")||(n==null?void 0:n.level)||1,subclass:(_t=(De=n==null?void 0:n.classes)==null?void 0:De[0])==null?void 0:_t.subclass}]:[]),Ue=b.watch("feats")||(n==null?void 0:n.feats)||[],te=b.watch("features")||(n==null?void 0:n.features)||[],J=b.watch("equipmentBonuses")||L||(n==null?void 0:n.equipmentBonuses)||{armorClass:0,abilityScores:{strength:0,dexterity:0,constitution:0,intelligence:0,wisdom:0,charisma:0}},K={abilityScores:H,abilityModifiers:{dexterity:Math.floor((((H==null?void 0:H.dexterity)||10)+(((et=J==null?void 0:J.abilityScores)==null?void 0:et.dexterity)||0)-10)/2),charisma:Math.floor((((H==null?void 0:H.charisma)||10)+(((G=J==null?void 0:J.abilityScores)==null?void 0:G.charisma)||0)-10)/2)},classes:ce.map(Q=>({name:typeof Q=="string"?Q:Q.name,level:typeof Q=="string"?1:Q.level||1,subclass:typeof Q=="string"?void 0:Q.subclass})),feats:Ue,features:te.map(Q=>typeof Q=="string"?{name:Q,source:"class"}:Q),equipmentBonuses:J},be=VM(K),Me=be.totalModifier>=0?`+${be.totalModifier}`:`${be.totalModifier}`;return i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"text-2xl font-bold text-purple-600",children:Me}),i.jsx("div",{className:"text-xs text-muted-foreground",children:WV(be)}),be.hasAdvantage&&i.jsx("div",{className:"text-xs text-green-600 font-medium",children:"Has Advantage"}),be.hasDisadvantage&&i.jsx("div",{className:"text-xs text-red-600 font-medium",children:"Has Disadvantage"})]})})()})]})]})]})}),i.jsx($e,{value:"classes",className:"space-y-6",children:i.jsxs("div",{className:"grid gap-6",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("h4",{className:"text-sm font-medium",children:"Class Configuration"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Configure single class or multiclass character"})]}),i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("input",{type:"checkbox",id:"multiclass-toggle",checked:w,onChange:H=>S(H.target.checked),disabled:I}),i.jsx("label",{htmlFor:"multiclass-toggle",className:"text-sm",children:"Multiclass Character"})]})]}),w?i.jsxs("div",{className:"space-y-4",children:[i.jsx("div",{className:"text-sm text-muted-foreground",children:"Configure each class and its level. The total levels will be calculated automatically."}),m&&m.classes.length>1?i.jsxs("div",{className:"space-y-3",children:[i.jsx("h5",{className:"font-medium",children:"Imported Classes:"}),m.classes.map((H,Y)=>i.jsxs("div",{className:"p-3 border rounded-lg",children:[i.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium",children:"Class"}),i.jsx("div",{className:"text-lg",children:H.name})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium",children:"Level"}),i.jsx("div",{className:"text-lg",children:H.level})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium",children:"Hit Die"}),i.jsx("div",{className:"text-lg",children:H.hitDie})]})]}),H.subclass&&i.jsxs("div",{className:"mt-2",children:[i.jsx("label",{className:"text-sm font-medium",children:"Subclass"}),i.jsx("div",{children:H.subclass})]}),H.features&&H.features.length>0&&i.jsxs("div",{className:"mt-2",children:[i.jsx("label",{className:"text-sm font-medium",children:"Features"}),i.jsx("div",{className:"text-sm text-muted-foreground",children:H.features.join(", ")})]})]},Y)),i.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:i.jsxs("div",{className:"text-sm text-blue-800",children:[i.jsx("strong",{children:"Total Character Level:"})," ",m.classes.reduce((H,Y)=>H+Y.level,0)]})})]}):i.jsxs("div",{className:"p-4 border border-dashed rounded-lg text-center text-muted-foreground",children:[i.jsx("p",{children:"Multiclass configuration UI"}),i.jsx("p",{className:"text-xs",children:"This feature will allow adding/removing classes and setting individual levels"})]})]}):i.jsx("div",{className:"space-y-4",children:i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsx(pe,{control:b.control,name:"class",render:({field:H})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Class *"}),i.jsx(ge,{children:i.jsx(_e,{placeholder:"e.g., Fighter, Wizard, Rogue...",...H,disabled:I})}),i.jsx(ye,{})]})}),i.jsx(pe,{control:b.control,name:"subrace",render:({field:H})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Subclass"}),i.jsx(ge,{children:i.jsx(_e,{placeholder:"e.g., Champion, Evocation, Thief...",...H,disabled:I})}),i.jsx(nt,{children:"Subclass or archetype (optional)"}),i.jsx(ye,{})]})})]})}),w&&i.jsx("div",{className:"p-3 bg-muted rounded-lg",children:i.jsxs("div",{className:"text-sm font-medium",children:["Total Character Level: ",b.watch("level")||1]})})]})}),i.jsx($e,{value:"stats",className:"space-y-6",children:i.jsxs("div",{className:"grid gap-6",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsx("h4",{className:"text-sm font-medium",children:"Ability Scores"}),i.jsx(ife,{initialValues:b.watch("abilityScores")??{strength:10,dexterity:10,constitution:10,intelligence:10,wisdom:10,charisma:10},onChange:H=>{b.setValue("abilityScores",H)},disabled:I})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("h4",{className:"text-sm font-medium",children:"Skills & Proficiencies"}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium",children:"Skills"}),i.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 mt-2",children:ofe.map(H=>i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("input",{type:"checkbox",id:`skill-${H}`,checked:b.watch("skills").includes(H),onChange:()=>M(H),disabled:I}),i.jsx("label",{htmlFor:`skill-${H}`,className:"text-sm",children:H})]},H))})]}),i.jsxs("div",{children:[i.jsx("label",{className:"text-sm font-medium",children:"Saving Throw Proficiencies"}),i.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 mt-2",children:lfe.map(H=>i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("input",{type:"checkbox",id:`save-${H}`,checked:b.watch("savingThrows").includes(H),onChange:()=>$(H),disabled:I}),i.jsx("label",{htmlFor:`save-${H}`,className:"text-sm",children:H})]},H))})]}),i.jsx(pe,{control:b.control,name:"proficiencies",render:({field:H})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Other Proficiencies"}),i.jsx(ge,{children:i.jsx(ps,{placeholder:"Enter other proficiencies (weapons, tools, languages) separated by commas...",...H,value:Array.isArray(H.value)?H.value.join(", "):H.value,onChange:Y=>H.onChange(Y.target.value.split(",").map(ae=>ae.trim()).filter(ae=>ae)),disabled:I})}),i.jsx(nt,{children:"Weapons, tools, languages, etc. (comma-separated)"}),i.jsx(ye,{})]})})]})]})]})}),i.jsx($e,{value:"inventory",className:"space-y-6",children:i.jsx(VV,{inventory:j,equipment:k,equipmentBonuses:L,abilityScores:b.watch("abilityScores"),onInventoryChange:A,onEquipmentChange:_,onBonusesChange:D,canEdit:!I,isReadOnly:I})}),i.jsx($e,{value:"actions",className:"space-y-6",children:i.jsx(Zm,{mode:"character",selectedActionIds:v,onActionIdsChange:y,disabled:I})})]})}),!I&&i.jsx("div",{className:"flex-shrink-0 border-t px-6 py-4",children:i.jsxs(Xn,{children:[i.jsx(q,{type:"button",variant:"outline",onClick:()=>e(!1),disabled:U,children:"Cancel"}),i.jsxs(q,{type:"submit",disabled:U,children:[U&&i.jsx(Ss,{className:"mr-2 h-4 w-4 animate-spin"}),t==="create"?`Create ${r==="player"?"Character":"NPC"}`:"Save Changes"]})]})}),I&&i.jsx("div",{className:"flex-shrink-0 border-t px-6 py-4",children:i.jsx(Xn,{children:i.jsx(q,{type:"button",variant:"outline",onClick:()=>e(!1),children:"Close"})})})]})})]})})}function cfe(){const s=xu(re.characters.getPlayerCharacters),e=xu(re.characters.getNPCs),t=xu(re.characters.getMyCharacters),n=xu(re.characters.getAllCharacters),[r,a]=C.useState(""),[o,l]=C.useState("all"),[c,d]=C.useState(!1),[h,f]=C.useState("create"),[m,p]=C.useState(null),[x,g]=C.useState("player"),b=T=>T==null?void 0:T.filter(B=>B.name.toLowerCase().includes(r.toLowerCase())||B.race.toLowerCase().includes(r.toLowerCase())||B.class.toLowerCase().includes(r.toLowerCase())),v=b(t||[]),y=b(s||[]),w=b(e||[]),S=b(n||[]),j=T=>{const B=[...n||[]].find(R=>R._id===T);B&&(p(B),g(B.characterType||"player"),f("view"),d(!0))},A=T=>{const B=t==null?void 0:t.find(R=>R._id===T);B&&(p(B),g(B.characterType||"player"),f("edit"),d(!0))},k=()=>{p(null),g("player"),f("create"),d(!0)},_=()=>{p(null),g("npc"),f("create"),d(!0)},L=()=>{},D=()=>{},P=(T,B=!1)=>T?T.length===0?i.jsx(oe,{children:i.jsxs(he,{className:"flex flex-col items-center justify-center py-12",children:[i.jsx("p",{className:"text-muted-foreground mb-4",children:r?"No characters match your search criteria.":"No characters found."}),!r&&(o==="my"||o==="all")&&i.jsxs(q,{onClick:k,children:[i.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Create Character"]})]})}):i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:T.map(R=>i.jsx(kde,{character:R,onView:j,onEdit:A,onClone:D,canEdit:B,canClone:!0},R._id))}):i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[...Array(8)].map((R,O)=>i.jsx("div",{className:"h-64 bg-muted animate-pulse rounded-lg"},O))});return i.jsxs("div",{className:"container mx-auto py-6",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-3xl font-bold",children:"Characters"}),i.jsx("p",{className:"text-muted-foreground",children:"Manage player characters and NPCs for your campaigns"})]}),i.jsx(Rr,{children:i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(q,{variant:"outline",onClick:_,children:[i.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Create NPC"]}),i.jsxs(q,{onClick:k,children:[i.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Create Character"]})]})})]}),i.jsx(Yu,{children:i.jsxs(oe,{children:[i.jsx(ke,{children:i.jsx(Ne,{children:"Sign in to manage characters"})}),i.jsx(he,{children:i.jsx("p",{className:"text-muted-foreground",children:"Please sign in to create and manage characters for your D&D campaigns."})})]})}),i.jsxs(Rr,{children:[i.jsx(Zu,{entityType:"characters",onDataLoaded:()=>{}}),i.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[i.jsxs("div",{className:"flex gap-1 bg-muted p-1 rounded-lg",children:[i.jsxs(q,{variant:o==="all"?"default":"ghost",size:"sm",onClick:()=>l("all"),className:"gap-2",children:[i.jsx(Cs,{className:"h-4 w-4"}),"All Characters",n&&i.jsx(ue,{variant:"secondary",className:"ml-1",children:n.length})]}),i.jsxs(q,{variant:o==="my"?"default":"ghost",size:"sm",onClick:()=>l("my"),className:"gap-2",children:[i.jsx(cM,{className:"h-4 w-4"}),"My Characters",t&&i.jsx(ue,{variant:"secondary",className:"ml-1",children:t.length})]}),i.jsxs(q,{variant:o==="pcs"?"default":"ghost",size:"sm",onClick:()=>l("pcs"),className:"gap-2",children:[i.jsx(Cs,{className:"h-4 w-4"}),"All PCs",s&&i.jsx(ue,{variant:"secondary",className:"ml-1",children:s.length})]}),i.jsxs(q,{variant:o==="npcs"?"default":"ghost",size:"sm",onClick:()=>l("npcs"),className:"gap-2",children:[i.jsx(Cs,{className:"h-4 w-4"}),"NPCs",e&&i.jsx(ue,{variant:"secondary",className:"ml-1",children:e.length})]})]}),i.jsxs("div",{className:"relative flex-1 max-w-md",children:[i.jsx(wm,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),i.jsx(_e,{placeholder:"Search characters...",className:"pl-10",value:r,onChange:T=>a(T.target.value)})]})]}),i.jsxs("div",{className:"space-y-6",children:[o==="all"&&i.jsxs("div",{children:[i.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"All Characters"}),P(S,!1)]}),o==="my"&&i.jsxs("div",{children:[i.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"My Characters"}),P(v,!0)]}),o==="pcs"&&i.jsxs("div",{children:[i.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"All Player Characters"}),P(y,!1)]}),o==="npcs"&&i.jsxs("div",{children:[i.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Non-Player Characters"}),P(w,!1)]})]})]}),i.jsx(qV,{open:c,onOpenChange:d,mode:h,character:m,characterType:x,onSuccess:L})]})}function dfe({monster:s,onView:e,onEdit:t,onClone:n,canEdit:r=!1,canClone:a=!1}){const o=Re(re.monsters.cloneMonster),l=async()=>{try{await o({monsterId:s._id}),rt.success(`${s.name} cloned successfully!`),n==null||n()}catch(d){console.error("Failed to clone monster:",d),rt.error("Failed to clone monster")}},c=s.speed.walk||s.speed.fly||s.speed.swim||"30 ft.";return i.jsxs(oe,{className:"hover:shadow-md transition-shadow cursor-pointer",children:[i.jsx(ke,{className:"pb-3",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{children:[i.jsx(Ne,{className:"text-lg line-clamp-1",children:s.name}),i.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.size," ",s.type]})]}),i.jsxs(ue,{variant:"cr",className:"shrink-0",children:["CR ",s.challengeRating]})]})}),i.jsxs(he,{className:"space-y-3",children:[i.jsxs("div",{className:"grid grid-cols-3 gap-3 text-sm",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(nM,{className:"h-4 w-4 text-red-500"}),i.jsx("span",{className:"font-medium",children:s.hitPoints}),i.jsx("span",{className:"text-muted-foreground",children:"HP"})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(Dr,{className:"h-4 w-4 text-blue-500"}),i.jsx("span",{className:"font-medium",children:s.armorClass}),i.jsx("span",{className:"text-muted-foreground",children:"AC"})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(Da,{className:"h-4 w-4 text-yellow-500"}),i.jsx("span",{className:"font-medium",children:c})]})]}),s.abilityModifiers&&i.jsxs("div",{className:"grid grid-cols-6 gap-1 text-xs",children:[i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-muted-foreground",children:"STR"}),i.jsx("div",{className:"font-medium",children:lr(s.abilityModifiers.strength)})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-muted-foreground",children:"DEX"}),i.jsx("div",{className:"font-medium",children:lr(s.abilityModifiers.dexterity)})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-muted-foreground",children:"CON"}),i.jsx("div",{className:"font-medium",children:lr(s.abilityModifiers.constitution)})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-muted-foreground",children:"INT"}),i.jsx("div",{className:"font-medium",children:lr(s.abilityModifiers.intelligence)})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-muted-foreground",children:"WIS"}),i.jsx("div",{className:"font-medium",children:lr(s.abilityModifiers.wisdom)})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-muted-foreground",children:"CHA"}),i.jsx("div",{className:"font-medium",children:lr(s.abilityModifiers.charisma)})]})]}),(s.traits||s.reactions||s.legendaryActions||s.lairActions)&&i.jsxs("div",{className:"flex gap-2 flex-wrap",children:[s.traits&&s.traits.length>0&&i.jsxs(ue,{variant:"secondary",className:"text-xs",children:[s.traits.length," Traits"]}),s.reactions&&s.reactions.length>0&&i.jsxs(ue,{variant:"secondary",className:"text-xs",children:[s.reactions.length," Reactions"]}),s.legendaryActions&&s.legendaryActions.length>0&&i.jsxs(ue,{variant:"secondary",className:"text-xs",children:[s.legendaryActions.length," Legendary"]}),s.lairActions&&s.lairActions.length>0&&i.jsxs(ue,{variant:"secondary",className:"text-xs",children:[s.lairActions.length," Lair"]})]}),i.jsxs("div",{className:"flex gap-2 pt-2",children:[i.jsx(q,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>e==null?void 0:e(s._id),children:"View"}),r&&i.jsx(q,{size:"sm",className:"flex-1",onClick:()=>t==null?void 0:t(s._id),children:"Edit"}),a&&i.jsx(q,{variant:"outline",size:"sm",onClick:l,className:"px-3",children:i.jsx(w$,{className:"h-4 w-4"})})]})]})]})}function GV({open:s,onOpenChange:e,mode:t,monster:n,onSuccess:r}){var I,U,M,$,W,ee,Z,z,se,de,ne,H,Y,ae,ce,Ue,te,J;const a=Re(re.monsters.createMonster),o=Re(re.monsters.updateMonster);xu(re.actions.getAllActions);const{generate:l,isGenerating:c}=lw(),[d,h]=V.useState((n==null?void 0:n.actions)||[]),[f,m]=V.useState((n==null?void 0:n.traits)||[]),[p,x]=V.useState((n==null?void 0:n.reactions)||[]),[g,b]=V.useState((n==null?void 0:n.legendaryActions)||[]),[v,y]=V.useState((n==null?void 0:n.lairActions)||[]),[w,S]=V.useState((n==null?void 0:n.inventory)||{capacity:150,items:[]}),[j,A]=V.useState((n==null?void 0:n.equipment)||{headgear:void 0,armwear:void 0,chestwear:void 0,legwear:void 0,footwear:void 0,mainHand:void 0,offHand:void 0,accessories:[]}),[k,_]=V.useState((n==null?void 0:n.equipmentBonuses)||{armorClass:0,abilityScores:{strength:0,dexterity:0,constitution:0,intelligence:0,wisdom:0,charisma:0}}),L=kl({resolver:Nl(zie),defaultValues:{name:(n==null?void 0:n.name)||"",source:(n==null?void 0:n.source)||"",size:(n==null?void 0:n.size)||"Medium",type:(n==null?void 0:n.type)||"",alignment:(n==null?void 0:n.alignment)||"",armorClass:(n==null?void 0:n.armorClass)||10,hitPoints:(n==null?void 0:n.hitPoints)||1,hitDice:{count:((I=n==null?void 0:n.hitDice)==null?void 0:I.count)||1,die:((U=n==null?void 0:n.hitDice)==null?void 0:U.die)||"d8"},speed:{walk:((M=n==null?void 0:n.speed)==null?void 0:M.walk)||"",swim:(($=n==null?void 0:n.speed)==null?void 0:$.swim)||"",fly:((W=n==null?void 0:n.speed)==null?void 0:W.fly)||"",burrow:((ee=n==null?void 0:n.speed)==null?void 0:ee.burrow)||"",climb:((Z=n==null?void 0:n.speed)==null?void 0:Z.climb)||""},abilityScores:{strength:((z=n==null?void 0:n.abilityScores)==null?void 0:z.strength)||10,dexterity:((se=n==null?void 0:n.abilityScores)==null?void 0:se.dexterity)||10,constitution:((de=n==null?void 0:n.abilityScores)==null?void 0:de.constitution)||10,intelligence:((ne=n==null?void 0:n.abilityScores)==null?void 0:ne.intelligence)||10,wisdom:((H=n==null?void 0:n.abilityScores)==null?void 0:H.wisdom)||10,charisma:((Y=n==null?void 0:n.abilityScores)==null?void 0:Y.charisma)||10},challengeRating:(n==null?void 0:n.challengeRating)||"0",proficiencyBonus:(n==null?void 0:n.proficiencyBonus)||2,senses:{passivePerception:((ae=n==null?void 0:n.senses)==null?void 0:ae.passivePerception)||10,darkvision:((ce=n==null?void 0:n.senses)==null?void 0:ce.darkvision)||"",blindsight:((Ue=n==null?void 0:n.senses)==null?void 0:Ue.blindsight)||"",tremorsense:((te=n==null?void 0:n.senses)==null?void 0:te.tremorsense)||"",truesight:((J=n==null?void 0:n.senses)==null?void 0:J.truesight)||""},challengeRatingValue:(n==null?void 0:n.challengeRatingValue)||void 0,legendaryActionCount:(n==null?void 0:n.legendaryActionCount)||void 0,lairActionCount:(n==null?void 0:n.lairActionCount)||void 0,actions:(n==null?void 0:n.actions)||[]}});V.useEffect(()=>{n&&(t==="edit"||t==="view")?(L.reset({name:n.name,source:n.source||"",size:n.size,type:n.type,alignment:n.alignment,armorClass:n.armorClass,hitPoints:n.hitPoints,hitDice:{count:n.hitDice.count,die:n.hitDice.die},speed:{walk:n.speed.walk||"",swim:n.speed.swim||"",fly:n.speed.fly||"",burrow:n.speed.burrow||"",climb:n.speed.climb||""},abilityScores:n.abilityScores,challengeRating:n.challengeRating,proficiencyBonus:n.proficiencyBonus,senses:{passivePerception:n.senses.passivePerception,darkvision:n.senses.darkvision||"",blindsight:n.senses.blindsight||"",tremorsense:n.senses.tremorsense||"",truesight:n.senses.truesight||""},challengeRatingValue:n.challengeRatingValue||void 0,legendaryActionCount:n.legendaryActionCount||void 0,lairActionCount:n.lairActionCount||void 0,actions:n.actions||[]}),h((n==null?void 0:n.actions)||[]),m(n.traits||[]),x((n==null?void 0:n.reactions)||[]),b((n==null?void 0:n.legendaryActions)||[]),y((n==null?void 0:n.lairActions)||[]),S(n.inventory||{capacity:150,items:[]}),A(n.equipment||{headgear:void 0,armwear:void 0,chestwear:void 0,legwear:void 0,footwear:void 0,mainHand:void 0,offHand:void 0,accessories:[]}),_(n.equipmentBonuses||{armorClass:0,abilityScores:{strength:0,dexterity:0,constitution:0,intelligence:0,wisdom:0,charisma:0}})):t==="create"&&(L.reset({name:"",source:"",size:"Medium",type:"",alignment:"",armorClass:10,hitPoints:1,hitDice:{count:1,die:"d8"},speed:{walk:"30 ft.",swim:"",fly:"",burrow:"",climb:""},abilityScores:{strength:10,dexterity:10,constitution:10,intelligence:10,wisdom:10,charisma:10},challengeRating:"0",proficiencyBonus:2,senses:{passivePerception:10,darkvision:"",blindsight:"",tremorsense:"",truesight:""},challengeRatingValue:void 0,legendaryActionCount:void 0,lairActionCount:void 0,actions:[]}),h([]),m([]),x([]),b([]),y([]),S({capacity:150,items:[]}),A({headgear:void 0,armwear:void 0,chestwear:void 0,legwear:void 0,footwear:void 0,mainHand:void 0,offHand:void 0,accessories:[]}),_({armorClass:0,abilityScores:{strength:0,dexterity:0,constitution:0,intelligence:0,wisdom:0,charisma:0}}))},[n,t,L]);const D=async K=>{try{const be={...K,source:K.source||void 0,speed:{walk:K.speed.walk||void 0,swim:K.speed.swim||void 0,fly:K.speed.fly||void 0,burrow:K.speed.burrow||void 0,climb:K.speed.climb||void 0},senses:{...K.senses,darkvision:K.senses.darkvision||void 0,blindsight:K.senses.blindsight||void 0,tremorsense:K.senses.tremorsense||void 0,truesight:K.senses.truesight||void 0},challengeRatingValue:K.challengeRatingValue||void 0,legendaryActionCount:K.legendaryActionCount||void 0,lairActionCount:K.lairActionCount||void 0,actions:d.length>0?d:[],traits:f.length>0?f:void 0,reactions:p.length>0?p:[],legendaryActions:g.length>0?g:[],lairActions:v.length>0?v:[],inventory:w,equipment:j,equipmentBonuses:k};t==="create"?await a(be):t==="edit"&&n&&await o({monsterId:n._id,...be}),r==null||r(),e(!1),L.reset()}catch(be){console.error("Failed to save monster:",be)}},P=()=>{switch(t){case"create":return"Create Monster";case"edit":return"Edit Monster";case"view":return"Monster Details";default:return"Monster"}},T=()=>{switch(t){case"create":return"Create a new monster or NPC for your D&D campaign.";case"edit":return"Edit monster stats and abilities.";case"view":return"View monster stat block and abilities.";default:return""}},B=t==="view",R=L.formState.isSubmitting,O=async()=>{try{rt.info("Generating monster with GPT...",{duration:2e3});const K=await l("monster");K.success&&K.data?(L.reset({name:K.data.name||"",source:K.data.source||"Custom Creation",size:K.data.size||"Medium",type:K.data.type||"",alignment:K.data.alignment||"",armorClass:K.data.armorClass||10,hitPoints:K.data.hitPoints||1,hitDice:K.data.hitDice||{count:1,die:"d8"},speed:K.data.speed||{walk:"30 ft."},abilityScores:K.data.abilityScores||{strength:10,dexterity:10,constitution:10,intelligence:10,wisdom:10,charisma:10},challengeRating:K.data.challengeRating||"0",proficiencyBonus:K.data.proficiencyBonus||2,senses:K.data.senses||{passivePerception:10},challengeRatingValue:K.data.challengeRatingValue,legendaryActionCount:K.data.legendaryActionCount,lairActionCount:K.data.lairActionCount,actions:K.data.actions||[]}),setInlineActions(K.data.actions||[]),m(K.data.traits||[]),setInlineReactions(K.data.reactions||[]),setInlineLegendaryActions(K.data.legendaryActions||[]),setInlineLairActions(K.data.lairActions||[]),rt.success("Monster generated successfully! Review and adjust as needed.",{duration:3e3})):rt.error(K.error||"Failed to generate monster")}catch(K){rt.error(K.message||"Failed to generate monster")}};return i.jsx(cs,{open:s,onOpenChange:e,children:i.jsxs(is,{className:"max-w-7xl w-[95vw] max-h-[95vh] flex flex-col p-0",children:[i.jsx("div",{className:"flex-shrink-0 px-6 pt-6 pb-4",children:i.jsx(Rs,{children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx(Ds,{children:P()}),i.jsx(Lr,{children:T()})]}),t==="create"&&i.jsx(q,{type:"button",variant:"outline",size:"sm",onClick:O,disabled:c||R,className:"ml-4",children:c?i.jsxs(i.Fragment,{children:[i.jsx(Ss,{className:"mr-2 h-4 w-4 animate-spin"}),"Generating..."]}):i.jsxs(i.Fragment,{children:[i.jsx(Aa,{className:"mr-2 h-4 w-4"}),"Generate with GPT"]})})]})})}),i.jsx(Al,{...L,children:i.jsxs("form",{onSubmit:L.handleSubmit(D),className:"flex flex-col flex-1 min-h-0",children:[i.jsx("div",{className:"flex-1 overflow-y-auto px-6 pb-4 space-y-6",children:i.jsxs(Qn,{defaultValue:"basic",className:"w-full",children:[i.jsxs(In,{className:"grid w-full grid-cols-7",children:[i.jsx(Be,{value:"basic",children:"Basic Info"}),i.jsx(Be,{value:"stats",children:"Stats"}),i.jsx(Be,{value:"traits",children:"Traits"}),i.jsx(Be,{value:"actions",children:"Actions"}),i.jsx(Be,{value:"reactions",children:"Reactions"}),i.jsx(Be,{value:"legendary",children:"Legendary"}),i.jsx(Be,{value:"inventory",children:"Inventory"})]}),i.jsx($e,{value:"basic",className:"space-y-6",children:i.jsxs("div",{className:"space-y-4",children:[i.jsx("h4",{className:"text-sm font-medium",children:"Basic Information"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsx(pe,{control:L.control,name:"name",render:({field:K})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Monster Name *"}),i.jsx(ge,{children:i.jsx(_e,{placeholder:"Enter monster name...",...K,disabled:B})}),i.jsx(nt,{children:"The name of the monster (2-100 characters)"}),i.jsx(ye,{})]})}),i.jsx(pe,{control:L.control,name:"source",render:({field:K})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Source"}),i.jsx(ge,{children:i.jsx(_e,{placeholder:"e.g., Monster Manual, Homebrew...",...K,disabled:B})}),i.jsx(nt,{children:"Where this monster comes from"}),i.jsx(ye,{})]})})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[i.jsx(pe,{control:L.control,name:"size",render:({field:K})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Size *"}),i.jsxs(wt,{onValueChange:K.onChange,defaultValue:K.value,disabled:B,children:[i.jsx(ge,{children:i.jsx(gt,{children:i.jsx(Ct,{placeholder:"Select size..."})})}),i.jsx(xt,{children:Kie.map(be=>i.jsx(Ie,{value:be,children:be},be))})]}),i.jsx(ye,{})]})}),i.jsx(pe,{control:L.control,name:"type",render:({field:K})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Type *"}),i.jsx(ge,{children:i.jsx(_e,{placeholder:"e.g., humanoid, beast, dragon...",...K,disabled:B})}),i.jsx(ye,{})]})}),i.jsx(pe,{control:L.control,name:"alignment",render:({field:K})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Alignment *"}),i.jsx(ge,{children:i.jsx(_e,{placeholder:"e.g., chaotic evil, neutral...",...K,disabled:B})}),i.jsx(ye,{})]})})]})]})}),i.jsxs($e,{value:"stats",className:"space-y-6",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsx("h4",{className:"text-sm font-medium",children:"Combat Statistics"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[i.jsx(pe,{control:L.control,name:"armorClass",render:({field:K})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Armor Class *"}),i.jsx(ge,{children:i.jsx(_e,{type:"number",...K,onChange:be=>K.onChange(parseInt(be.target.value)),disabled:B})}),i.jsx(nt,{children:"AC (1-30)"}),i.jsx(ye,{})]})}),i.jsx(pe,{control:L.control,name:"hitPoints",render:({field:K})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Hit Points *"}),i.jsx(ge,{children:i.jsx(_e,{type:"number",...K,onChange:be=>K.onChange(parseInt(be.target.value)),disabled:B})}),i.jsx(nt,{children:"Max HP (1-1000)"}),i.jsx(ye,{})]})}),i.jsx(pe,{control:L.control,name:"proficiencyBonus",render:({field:K})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Proficiency Bonus *"}),i.jsx(ge,{children:i.jsx(_e,{type:"number",...K,onChange:be=>K.onChange(parseInt(be.target.value)),disabled:B})}),i.jsx(nt,{children:"Prof. bonus (2-9)"}),i.jsx(ye,{})]})})]}),i.jsxs("div",{className:"space-y-2 pt-2",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(ci,{className:"h-4 w-4 text-purple-500"}),i.jsx("h4",{className:"text-sm font-medium",children:"Initiative Modifier"})]}),i.jsx("div",{className:"pl-6 space-y-1",children:(()=>{var Q;const K=L.watch("abilityScores")||(n==null?void 0:n.abilityScores)||{strength:10,dexterity:10,constitution:10,intelligence:10,wisdom:10,charisma:10},be=k||(n==null?void 0:n.equipmentBonuses)||{armorClass:0,abilityScores:{strength:0,dexterity:0,constitution:0,intelligence:0,wisdom:0,charisma:0}},Me=((K==null?void 0:K.dexterity)||10)+(((Q=be==null?void 0:be.abilityScores)==null?void 0:Q.dexterity)||0),De={dexterity:Math.floor((Me-10)/2)},_t={abilityScores:K,abilityModifiers:De,dexterity:K==null?void 0:K.dexterity,equipmentBonuses:be},et=VM(_t),G=et.totalModifier>=0?`+${et.totalModifier}`:`${et.totalModifier}`;return i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"text-2xl font-bold text-purple-600",children:G}),i.jsx("div",{className:"text-xs text-muted-foreground",children:WV(et)}),et.hasAdvantage&&i.jsx("div",{className:"text-xs text-green-600 font-medium",children:"Has Advantage"}),et.hasDisadvantage&&i.jsx("div",{className:"text-xs text-red-600 font-medium",children:"Has Disadvantage"})]})})()})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsx(pe,{control:L.control,name:"hitDice.count",render:({field:K})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Hit Dice Count *"}),i.jsx(ge,{children:i.jsx(_e,{type:"number",...K,onChange:be=>K.onChange(parseInt(be.target.value)),disabled:B})}),i.jsx(nt,{children:"Number of hit dice (1-100)"}),i.jsx(ye,{})]})}),i.jsx(pe,{control:L.control,name:"hitDice.die",render:({field:K})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Hit Die Type *"}),i.jsxs(wt,{onValueChange:K.onChange,defaultValue:K.value,disabled:B,children:[i.jsx(ge,{children:i.jsx(gt,{children:i.jsx(Ct,{placeholder:"Select die..."})})}),i.jsx(xt,{children:Qie.map(be=>i.jsx(Ie,{value:be,children:be},be))})]}),i.jsx(ye,{})]})})]})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("h4",{className:"text-sm font-medium",children:"Speed"}),i.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[{name:"walk",label:"Walk",placeholder:"30 ft."},{name:"swim",label:"Swim",placeholder:"30 ft."},{name:"fly",label:"Fly",placeholder:"60 ft."},{name:"burrow",label:"Burrow",placeholder:"20 ft."},{name:"climb",label:"Climb",placeholder:"30 ft."}].map(({name:K,label:be,placeholder:Me})=>i.jsx(pe,{control:L.control,name:`speed.${K}`,render:({field:De})=>i.jsxs(fe,{children:[i.jsx(me,{children:be}),i.jsx(ge,{children:i.jsx(_e,{placeholder:Me,...De,disabled:B})}),i.jsx(ye,{})]})},K))})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("h4",{className:"text-sm font-medium",children:"Ability Scores"}),i.jsx("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4",children:[{name:"strength",label:"STR"},{name:"dexterity",label:"DEX"},{name:"constitution",label:"CON"},{name:"intelligence",label:"INT"},{name:"wisdom",label:"WIS"},{name:"charisma",label:"CHA"}].map(({name:K,label:be})=>i.jsx(pe,{control:L.control,name:`abilityScores.${K}`,render:({field:Me})=>i.jsxs(fe,{children:[i.jsx(me,{children:be}),i.jsx(ge,{children:i.jsx(_e,{type:"number",...Me,onChange:De=>Me.onChange(parseInt(De.target.value)),disabled:B})}),i.jsx(nt,{children:Me.value?`(${BL(Me.value)>=0?"+":""}${BL(Me.value)})`:""}),i.jsx(ye,{})]})},K))})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("h4",{className:"text-sm font-medium",children:"Senses"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[i.jsx(pe,{control:L.control,name:"senses.passivePerception",render:({field:K})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Passive Perception *"}),i.jsx(ge,{children:i.jsx(_e,{type:"number",...K,onChange:be=>K.onChange(parseInt(be.target.value)),disabled:B})}),i.jsx(nt,{children:"Passive Perception (1-30)"}),i.jsx(ye,{})]})}),i.jsx(pe,{control:L.control,name:"senses.darkvision",render:({field:K})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Darkvision"}),i.jsx(ge,{children:i.jsx(_e,{placeholder:"e.g., 60 ft.",...K,disabled:B})}),i.jsx(ye,{})]})}),i.jsx(pe,{control:L.control,name:"senses.blindsight",render:({field:K})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Blindsight"}),i.jsx(ge,{children:i.jsx(_e,{placeholder:"e.g., 30 ft.",...K,disabled:B})}),i.jsx(ye,{})]})})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsx(pe,{control:L.control,name:"senses.tremorsense",render:({field:K})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Tremorsense"}),i.jsx(ge,{children:i.jsx(_e,{placeholder:"e.g., 60 ft.",...K,disabled:B})}),i.jsx(ye,{})]})}),i.jsx(pe,{control:L.control,name:"senses.truesight",render:({field:K})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Truesight"}),i.jsx(ge,{children:i.jsx(_e,{placeholder:"e.g., 120 ft.",...K,disabled:B})}),i.jsx(ye,{})]})})]})]})]}),i.jsxs($e,{value:"traits",className:"space-y-6",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsx("h4",{className:"text-sm font-medium",children:"Traits"}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[i.jsx(pe,{control:L.control,name:"challengeRating",render:({field:K})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Challenge Rating *"}),i.jsxs(wt,{onValueChange:K.onChange,defaultValue:K.value,disabled:B,children:[i.jsx(ge,{children:i.jsx(gt,{children:i.jsx(Ct,{placeholder:"Select CR..."})})}),i.jsx(xt,{children:Xie.map(be=>i.jsx(Ie,{value:be,children:be},be))})]}),i.jsx(ye,{})]})}),i.jsx(pe,{control:L.control,name:"legendaryActionCount",render:({field:K})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Legendary Actions"}),i.jsx(ge,{children:i.jsx(_e,{type:"number",placeholder:"0",...K,onChange:be=>K.onChange(be.target.value?parseInt(be.target.value):void 0),value:K.value||"",disabled:B})}),i.jsx(nt,{children:"0-5"}),i.jsx(ye,{})]})}),i.jsx(pe,{control:L.control,name:"lairActionCount",render:({field:K})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Lair Actions"}),i.jsx(ge,{children:i.jsx(_e,{type:"number",placeholder:"0",...K,onChange:be=>K.onChange(be.target.value?parseInt(be.target.value):void 0),value:K.value||"",disabled:B})}),i.jsx(nt,{children:"0-5"}),i.jsx(ye,{})]})})]})]}),i.jsx(Zm,{mode:"monster",inlineActions:f,onInlineActionsChange:m,disabled:B})]}),i.jsx($e,{value:"actions",className:"space-y-6",children:i.jsx(Zm,{mode:"character",selectedActionIds:d,onActionIdsChange:h,disabled:B})}),i.jsx($e,{value:"reactions",className:"space-y-6",children:i.jsx(Zm,{mode:"character",selectedActionIds:p,onActionIdsChange:x,disabled:B})}),i.jsx($e,{value:"legendary",className:"space-y-6",children:i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsx("h4",{className:"text-sm font-medium",children:"Legendary Actions"}),i.jsx(Zm,{mode:"character",selectedActionIds:g,onActionIdsChange:b,disabled:B})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsx("h4",{className:"text-sm font-medium",children:"Lair Actions"}),i.jsx(Zm,{mode:"character",selectedActionIds:v,onActionIdsChange:y,disabled:B})]})]})}),i.jsx($e,{value:"inventory",className:"space-y-6",children:i.jsx(VV,{inventory:w,equipment:j,equipmentBonuses:k,abilityScores:L.watch("abilityScores"),onInventoryChange:S,onEquipmentChange:A,onBonusesChange:_,canEdit:!B,isReadOnly:B})})]})}),!B&&i.jsx("div",{className:"flex-shrink-0 border-t px-6 py-4",children:i.jsxs(Xn,{children:[i.jsx(q,{type:"button",variant:"outline",onClick:()=>e(!1),disabled:R,children:"Cancel"}),i.jsxs(q,{type:"submit",disabled:R,children:[R&&i.jsx(Ss,{className:"mr-2 h-4 w-4 animate-spin"}),t==="create"?"Create Monster":"Save Changes"]})]})}),B&&i.jsx("div",{className:"flex-shrink-0 border-t px-6 py-4",children:i.jsx(Xn,{children:i.jsx(q,{type:"button",variant:"outline",onClick:()=>e(!1),children:"Close"})})})]})})]})})}function ufe(){const s=Fe(re.monsters.getMonsters),[e,t]=C.useState(""),[n,r]=C.useState(""),[a,o]=C.useState(!1),[l,c]=C.useState("create"),[d,h]=C.useState(null),f=s==null?void 0:s.filter(y=>{const w=y.name.toLowerCase().includes(e.toLowerCase())||y.type.toLowerCase().includes(e.toLowerCase()),S=!n||y.challengeRating===n;return w&&S}),m=["0","1/8","1/4","1/2","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30"],p=y=>{const w=s==null?void 0:s.find(S=>S._id===y);w&&(h(w),c("view"),o(!0))},x=y=>{const w=s==null?void 0:s.find(S=>S._id===y);w&&(h(w),c("edit"),o(!0))},g=()=>{h(null),c("create"),o(!0)},b=()=>{},v=()=>{};return i.jsxs("div",{className:"container mx-auto py-6",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-3xl font-bold",children:"Monster Manual"}),i.jsx("p",{className:"text-muted-foreground",children:"Browse and manage monsters for your D&D campaigns"})]}),i.jsx(Rr,{children:i.jsxs(q,{onClick:g,children:[i.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Create Monster"]})})]}),i.jsx(Yu,{children:i.jsxs(oe,{children:[i.jsx(ke,{children:i.jsx(Ne,{children:"Sign in to manage monsters"})}),i.jsx(he,{children:i.jsx("p",{className:"text-muted-foreground",children:"Please sign in to create and manage monsters for your campaigns."})})]})}),i.jsxs(Rr,{children:[i.jsx(Zu,{entityType:"monsters",onDataLoaded:()=>{}}),i.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[i.jsxs("div",{className:"relative flex-1",children:[i.jsx(wm,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),i.jsx(_e,{placeholder:"Search monsters by name or type...",className:"pl-10",value:e,onChange:y=>t(y.target.value)})]}),i.jsxs("div",{className:"flex gap-2 flex-wrap",children:[i.jsx(q,{variant:n===""?"default":"outline",size:"sm",onClick:()=>r(""),children:"All CR"}),m.slice(0,10).map(y=>i.jsxs(q,{variant:n===y?"default":"outline",size:"sm",onClick:()=>r(y),children:["CR ",y]},y))]})]}),f&&f.length>0&&i.jsxs("div",{className:"mb-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[i.jsx(oe,{children:i.jsxs(he,{className:"p-4 text-center",children:[i.jsx("div",{className:"text-2xl font-bold",children:f.length}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Monsters"})]})}),i.jsx(oe,{children:i.jsxs(he,{className:"p-4 text-center",children:[i.jsx("div",{className:"text-2xl font-bold",children:Math.min(...f.map(y=>parseFloat(y.challengeRating.replace("/","."))))}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Lowest CR"})]})}),i.jsx(oe,{children:i.jsxs(he,{className:"p-4 text-center",children:[i.jsx("div",{className:"text-2xl font-bold",children:Math.max(...f.map(y=>parseFloat(y.challengeRating.replace("/","."))))}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Highest CR"})]})}),i.jsx(oe,{children:i.jsxs(he,{className:"p-4 text-center",children:[i.jsx("div",{className:"text-2xl font-bold",children:f.filter(y=>y.legendaryActions||y.lairActions).length}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Boss Monsters"})]})})]}),s===void 0?i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[...Array(8)].map((y,w)=>i.jsx("div",{className:"h-64 bg-muted animate-pulse rounded-lg"},w))}):(f==null?void 0:f.length)===0?i.jsx(oe,{children:i.jsxs(he,{className:"flex flex-col items-center justify-center py-12",children:[i.jsx("p",{className:"text-muted-foreground mb-4",children:e||n?"No monsters match your search criteria.":"No monsters available. Create your first monster!"}),!e&&!n&&i.jsxs(q,{onClick:g,children:[i.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Create Monster"]})]})}):i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:f==null?void 0:f.map(y=>i.jsx(dfe,{monster:y,onView:p,onEdit:x,onClone:v,canEdit:!0,canClone:!0},y._id))})]}),i.jsx(GV,{open:a,onOpenChange:o,mode:l,monster:d,onSuccess:b})]})}function hfe({quest:s,taskCount:e=0,completedTaskCount:t=0,onView:n,onEdit:r,onUpdateStatus:a,canEdit:o=!1}){var p,x,g;const l=s.status==="NotStarted"?"idle":s.status==="InProgress"?"in_progress":s.status==="Failed"?"failed":s.status,d=(b=>{switch(b){case"idle":return{label:"Not Started",color:"secondary",icon:Ra,bgColor:"bg-gray-100"};case"in_progress":return{label:"In Progress",color:"status",icon:_u,bgColor:"bg-blue-100"};case"completed":return{label:"Completed",color:"status",icon:Yi,bgColor:"bg-green-100"};case"failed":return{label:"Failed",color:"destructive",icon:Mr,bgColor:"bg-red-100"};default:return{label:"Unknown",color:"secondary",icon:Ra,bgColor:"bg-gray-100"}}})(l),h=d.icon,f=e>0?t/e*100:0,m=(s.completionXP||0)+(((p=s.rewards)==null?void 0:p.xp)||0);return i.jsxs(oe,{className:"hover:shadow-md transition-shadow cursor-pointer",children:[i.jsx(ke,{className:"pb-3",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx(Ne,{className:"text-lg line-clamp-1 mb-1",children:s.name}),s.description&&i.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:s.description})]}),i.jsxs(ue,{variant:d.color,className:"shrink-0 ml-2",children:[i.jsx(h,{className:"h-3 w-3 mr-1"}),d.label]})]})}),i.jsxs(he,{className:"space-y-3",children:[e>0&&i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex justify-between text-sm",children:[i.jsx("span",{className:"text-muted-foreground",children:"Tasks Progress"}),i.jsxs("span",{className:"font-medium",children:[t,"/",e]})]}),i.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:i.jsx("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${f}%`}})})]}),i.jsxs("div",{className:"flex items-center justify-between text-sm",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[m>0&&i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(T$,{className:"h-4 w-4 text-yellow-500"}),i.jsx("span",{className:"font-medium",children:m}),i.jsx("span",{className:"text-muted-foreground",children:"XP"})]}),((x=s.rewards)==null?void 0:x.gold)&&i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("span",{className:"text-yellow-600 font-bold",children:"$"}),i.jsx("span",{className:"font-medium",children:s.rewards.gold}),i.jsx("span",{className:"text-muted-foreground",children:"GP"})]})]}),((g=s.rewards)==null?void 0:g.itemIds)&&s.rewards.itemIds.length>0&&i.jsxs(ue,{variant:"outline",className:"text-xs",children:[s.rewards.itemIds.length," Items"]})]}),o&&l!=="completed"&&i.jsxs("div",{className:"flex flex-wrap gap-1",children:[l==="idle"&&i.jsx(q,{size:"sm",variant:"outline",className:"text-xs",onClick:()=>a==null?void 0:a(s._id,"in_progress"),children:"Start Quest"}),l==="in_progress"&&i.jsxs(i.Fragment,{children:[i.jsx(q,{size:"sm",variant:"outline",className:"text-xs",onClick:()=>a==null?void 0:a(s._id,"completed"),children:"Complete"}),i.jsx(q,{size:"sm",variant:"outline",className:"text-xs",onClick:()=>a==null?void 0:a(s._id,"Failed"),children:"Fail"})]})]}),i.jsxs("div",{className:"flex gap-2 pt-2",children:[i.jsx(q,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>n==null?void 0:n(s._id),children:"View Details"}),o&&i.jsx(q,{size:"sm",className:"flex-1",onClick:()=>r==null?void 0:r(s._id),children:"Edit"})]})]})]})}class ffe extends C.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("ErrorBoundary caught an error:",e,t)}render(){if(this.state.hasError&&this.state.error){if(this.props.fallback){const e=this.props.fallback;return i.jsx(e,{error:this.state.error})}return i.jsxs("div",{className:"p-4 border border-red-300 bg-red-50 dark:bg-red-900/20 dark:border-red-700 rounded-lg",children:[i.jsxs("div",{className:"flex items-center mb-2",children:[i.jsx("svg",{className:"h-5 w-5 text-red-400 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 18.5c-.77.833.192 2.5 1.732 2.5z"})}),i.jsx("h3",{className:"text-sm font-medium text-red-800 dark:text-red-200",children:"Something went wrong"})]}),i.jsx("p",{className:"text-sm text-red-700 dark:text-red-300 mb-2",children:this.state.error.message}),i.jsx("button",{onClick:()=>this.setState({hasError:!1,error:void 0}),className:"text-sm bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded transition-colors",children:"Try Again"})]})}return this.props.children}}const mfe=({error:s})=>i.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:i.jsxs("div",{className:"max-w-md w-full bg-white dark:bg-gray-800 shadow-lg rounded-lg p-6",children:[i.jsxs("div",{className:"flex items-center mb-4",children:[i.jsx("div",{className:"flex-shrink-0",children:i.jsx("svg",{className:"h-8 w-8 text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:i.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 18.5c-.77.833.192 2.5 1.732 2.5z"})})}),i.jsx("div",{className:"ml-3",children:i.jsx("h3",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",children:"Something went wrong"})})]}),i.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:[i.jsx("p",{className:"mb-2",children:"An error occurred while loading this page:"}),i.jsx("pre",{className:"bg-gray-100 dark:bg-gray-700 p-2 rounded text-xs overflow-auto",children:s.message})]}),i.jsx("div",{className:"mt-4",children:i.jsx("button",{onClick:()=>window.location.reload(),className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors",children:"Reload Page"})})]})});function pfe(){const{isSignedIn:s,isLoaded:e}=Ji(),{isAuthenticated:t,isLoading:n}=sw(),r=Fe(re.quests.getQuests,t?{}:"skip"),a=Fe(re.quests.getMyQuests,t?{}:"skip"),[o,l]=C.useState(""),[c,d]=C.useState(""),[h,f]=C.useState("my"),[m,p]=C.useState(!1),[x,g]=C.useState("create"),[b,v]=C.useState(null),y=Re(re.quests.updateQuestStatus);if(!e||n)return i.jsx("div",{className:"container mx-auto py-6",children:i.jsx("div",{className:"flex items-center justify-center h-64",children:i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(Ss,{className:"h-6 w-6 animate-spin"}),i.jsx("span",{children:"Loading..."})]})})});if(!s||!t)return i.jsx("div",{className:"container mx-auto py-6",children:i.jsxs(oe,{children:[i.jsx(ke,{children:i.jsx(Ne,{children:"Authentication Required"})}),i.jsx(he,{children:i.jsx("p",{className:"text-muted-foreground",children:"Please sign in to access the quest management system."})})]})});const w=async(I,U)=>{try{await y({questId:I,status:U})}catch(M){console.error("Failed to update quest status:",M)}},S=I=>I==null?void 0:I.filter(U=>{const M=U.name.toLowerCase().includes(o.toLowerCase())||U.description&&U.description.toLowerCase().includes(o.toLowerCase()),$=!c||U.status===c;return M&&$}),j=S(a||[]),A=S(r||[]),k=I=>{const U=[...a||[],...r||[]].find(M=>M._id===I);U&&(v(U),g("read"),p(!0))},_=I=>{const U=a==null?void 0:a.find(M=>M._id===I);U&&(v(U),g("edit"),p(!0))},L=()=>{v(null),g("create"),p(!0)},D=()=>{},P=[{value:"",label:"All Statuses",icon:wo},{value:"idle",label:"Not Started",icon:Ra},{value:"in_progress",label:"In Progress",icon:_u},{value:"completed",label:"Completed",icon:Yi}],T=I=>I?{total:I.length,completed:I.filter(U=>U.status==="completed").length,inProgress:I.filter(U=>U.status==="in_progress"||U.status==="InProgress").length,notStarted:I.filter(U=>U.status==="idle"||U.status==="NotStarted").length}:{total:0,completed:0,inProgress:0,notStarted:0},B=(I,U=!1)=>I?I.length===0?i.jsx(oe,{children:i.jsxs(he,{className:"flex flex-col items-center justify-center py-12",children:[i.jsx("p",{className:"text-muted-foreground mb-4",children:o||c?"No quests match your search criteria.":"No quests found."}),!o&&!c&&h==="my"&&i.jsxs(q,{onClick:L,children:[i.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Create Quest"]})]})}):i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:I.map(M=>{var $;return i.jsx(hfe,{quest:M,taskCount:(($=M.taskIds)==null?void 0:$.length)||0,completedTaskCount:0,onView:k,onEdit:_,onUpdateStatus:w,canEdit:U},M._id)})}):i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(6)].map((M,$)=>i.jsx("div",{className:"h-64 bg-muted animate-pulse rounded-lg"},$))}),R=h==="my"?j:A,O=T(h==="my"?a||[]:r||[]);return i.jsx(ffe,{children:i.jsxs("div",{className:"container mx-auto py-6",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-3xl font-bold",children:"Quest Journal"}),i.jsx("p",{className:"text-muted-foreground",children:"Track and manage quests for your D&D campaigns"})]}),i.jsx(Rr,{children:i.jsxs(q,{onClick:L,children:[i.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Create Quest"]})})]}),i.jsx(Yu,{children:i.jsxs(oe,{children:[i.jsx(ke,{children:i.jsx(Ne,{children:"Sign in to manage quests"})}),i.jsx(he,{children:i.jsx("p",{className:"text-muted-foreground",children:"Please sign in to create and manage quests for your campaigns."})})]})}),i.jsxs(Rr,{children:[i.jsx(Zu,{entityType:"quests",onDataLoaded:()=>{}}),i.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[i.jsxs("div",{className:"flex gap-1 bg-muted p-1 rounded-lg",children:[i.jsxs(q,{variant:h==="my"?"default":"ghost",size:"sm",onClick:()=>f("my"),className:"gap-2",children:[i.jsx(wo,{className:"h-4 w-4"}),"My Quests",a&&i.jsx(ue,{variant:"secondary",className:"ml-1",children:a.length})]}),i.jsxs(q,{variant:h==="all"?"default":"ghost",size:"sm",onClick:()=>f("all"),className:"gap-2",children:[i.jsx(wo,{className:"h-4 w-4"}),"All Quests",r&&i.jsx(ue,{variant:"secondary",className:"ml-1",children:r.length})]})]}),i.jsxs("div",{className:"flex flex-1 gap-2",children:[i.jsxs("div",{className:"relative flex-1",children:[i.jsx(wm,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),i.jsx(_e,{placeholder:"Search quests...",className:"pl-10",value:o,onChange:I=>l(I.target.value)})]}),i.jsx("div",{className:"flex gap-1",children:P.map(I=>{const U=I.icon;return i.jsxs(q,{variant:c===I.value?"default":"outline",size:"sm",onClick:()=>d(I.value),className:"gap-1",children:[i.jsx(U,{className:"h-3 w-3"}),I.label]},I.value)})})]})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[i.jsx(oe,{children:i.jsxs(he,{className:"p-4 text-center",children:[i.jsx("div",{className:"text-2xl font-bold",children:O.total}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Quests"})]})}),i.jsx(oe,{children:i.jsxs(he,{className:"p-4 text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-green-600",children:O.completed}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Completed"})]})}),i.jsx(oe,{children:i.jsxs(he,{className:"p-4 text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-blue-600",children:O.inProgress}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"In Progress"})]})}),i.jsx(oe,{children:i.jsxs(he,{className:"p-4 text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-gray-600",children:O.notStarted}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Not Started"})]})})]}),i.jsxs("div",{children:[i.jsx("h2",{className:"text-2xl font-semibold mb-4",children:h==="my"?"My Quests":"All Quests"}),B(R,h==="my")]})]}),i.jsx(HU,{open:m,onOpenChange:p,mode:x,quest:b,onSuccess:D})]})})}function gfe(){const{databaseUser:s,isLoading:e,isSignedIn:t}=Sk(),n=Fe(re.items.getItems,t?{}:"skip"),r=Fe(re.items.getMyItems,t?{}:"skip"),[a,o]=C.useState(""),[l,c]=C.useState(""),[d,h]=C.useState(""),[f,m]=C.useState("my"),[p,x]=C.useState(!1),[g,b]=C.useState("create"),[v,y]=C.useState(null);if(e)return i.jsx("div",{className:"container mx-auto py-6",children:i.jsx("div",{className:"flex items-center justify-center h-64",children:i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900"}),i.jsx("span",{children:"Loading..."})]})})});if(!t)return i.jsx("div",{className:"container mx-auto py-6",children:i.jsxs(oe,{children:[i.jsx(ke,{children:i.jsx(Ne,{children:"Authentication Required"})}),i.jsx(he,{children:i.jsx("p",{className:"text-muted-foreground",children:"Please sign in to access the item management system."})})]})});const w=I=>I==null?void 0:I.filter(U=>{const M=U.name.toLowerCase().includes(a.toLowerCase())||U.description.toLowerCase().includes(a.toLowerCase())||U.effects&&U.effects.toLowerCase().includes(a.toLowerCase()),$=!l||U.type===l,W=!d||U.rarity===d;return M&&$&&W}),S=w(r||[]),j=w(n||[]),A=I=>{const U=[...r||[],...n||[]].find(M=>M._id===I);if(U){y(U);const M=s&&U.userId===s._id;b(M?"edit":"view"),x(!0)}},k=I=>{const U=r==null?void 0:r.find(M=>M._id===I);U&&(y(U),b("edit"),x(!0))},_=()=>{y(null),b("create"),x(!0)},L=()=>{},D=[{value:"",label:"All Types",icon:hl},{value:"Weapon",label:"Weapons",icon:En},{value:"Armor",label:"Armor",icon:Dr},{value:"Potion",label:"Potions",icon:Co},{value:"Scroll",label:"Scrolls",icon:Co},{value:"Wondrous Item",label:"Wondrous",icon:Co},{value:"Adventuring Gear",label:"Gear",icon:hl}],P=[{value:"",label:"All Rarities",color:"bg-gray-500"},{value:"Common",label:"Common",color:"bg-gray-500"},{value:"Uncommon",label:"Uncommon",color:"bg-green-500"},{value:"Rare",label:"Rare",color:"bg-blue-500"},{value:"Very Rare",label:"Very Rare",color:"bg-purple-500"},{value:"Legendary",label:"Legendary",color:"bg-orange-500"}],T=I=>{if(!I)return{total:0,weapons:0,armor:0,magical:0,totalWeight:0,totalValue:0};const U=I.reduce((M,$)=>M+($.weight||0),0);return{total:I.length,weapons:I.filter(M=>M.type==="Weapon").length,armor:I.filter(M=>M.type==="Armor").length,magical:I.filter(M=>["Uncommon","Rare","Very Rare","Legendary","Artifact"].includes(M.rarity)).length,totalWeight:Math.round(U*100)/100,totalValue:I.reduce((M,$)=>M+($.cost||0),0)}},B=(I,U=!1)=>I?I.length===0?i.jsx(oe,{children:i.jsxs(he,{className:"flex flex-col items-center justify-center py-12",children:[i.jsx("p",{className:"text-muted-foreground mb-4",children:a||l||d?"No items match your search criteria.":"No items found."}),!a&&!l&&!d&&f==="my"&&i.jsxs(q,{onClick:_,children:[i.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Create Item"]})]})}):i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:I.map(M=>{const $=s&&M.userId===s._id;return i.jsx(zV,{item:M,onView:A,onEdit:k,canEdit:$},M._id)})}):i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:[...Array(8)].map((M,$)=>i.jsx("div",{className:"h-64 bg-muted animate-pulse rounded-lg"},$))}),R=f==="my"?S:j,O=T(f==="my"?r||[]:n||[]);return i.jsxs("div",{className:"container mx-auto py-6",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-3xl font-bold",children:"Item Compendium"}),i.jsx("p",{className:"text-muted-foreground",children:"Manage magical items, equipment, and treasure for your campaigns"})]}),i.jsx(Rr,{children:i.jsxs(q,{onClick:_,children:[i.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Create Item"]})})]}),i.jsx(Yu,{children:i.jsxs(oe,{children:[i.jsx(ke,{children:i.jsx(Ne,{children:"Sign in to manage items"})}),i.jsx(he,{children:i.jsx("p",{className:"text-muted-foreground",children:"Please sign in to create and manage items for your D&D campaigns."})})]})}),i.jsxs(Rr,{children:[i.jsx(Zu,{entityType:"items",onDataLoaded:()=>{}}),i.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 mb-6",children:[i.jsxs("div",{className:"flex gap-1 bg-muted p-1 rounded-lg",children:[i.jsxs(q,{variant:f==="my"?"default":"ghost",size:"sm",onClick:()=>m("my"),className:"gap-2",children:[i.jsx(hl,{className:"h-4 w-4"}),"My Items",r&&i.jsx(ue,{variant:"secondary",className:"ml-1",children:r.length})]}),i.jsxs(q,{variant:f==="all"?"default":"ghost",size:"sm",onClick:()=>m("all"),className:"gap-2",children:[i.jsx(hl,{className:"h-4 w-4"}),"All Items",n&&i.jsx(ue,{variant:"secondary",className:"ml-1",children:n.length})]})]}),i.jsxs("div",{className:"relative flex-1",children:[i.jsx(wm,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),i.jsx(_e,{placeholder:"Search items by name, description, or effects...",className:"pl-10",value:a,onChange:I=>o(I.target.value)})]})]}),i.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[i.jsx("div",{className:"flex gap-1 flex-wrap",children:D.map(I=>{const U=I.icon;return i.jsxs(q,{variant:l===I.value?"default":"outline",size:"sm",onClick:()=>c(I.value),className:"gap-1",children:[i.jsx(U,{className:"h-3 w-3"}),I.label]},I.value)})}),i.jsx("div",{className:"flex gap-1 flex-wrap",children:P.map(I=>i.jsxs(q,{variant:d===I.value?"default":"outline",size:"sm",onClick:()=>h(I.value),className:"gap-1",children:[i.jsx("div",{className:`w-2 h-2 rounded-full ${I.color}`}),I.label]},I.value))})]}),i.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-6 gap-4 mb-6",children:[i.jsx(oe,{children:i.jsxs(he,{className:"p-4 text-center",children:[i.jsx("div",{className:"text-2xl font-bold",children:O.total}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Items"})]})}),i.jsx(oe,{children:i.jsxs(he,{className:"p-4 text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-red-600",children:O.weapons}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Weapons"})]})}),i.jsx(oe,{children:i.jsxs(he,{className:"p-4 text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-blue-600",children:O.armor}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Armor"})]})}),i.jsx(oe,{children:i.jsxs(he,{className:"p-4 text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-purple-600",children:O.magical}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Magical"})]})}),i.jsx(oe,{children:i.jsxs(he,{className:"p-4 text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-gray-600",children:O.totalWeight}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Total lbs"})]})}),i.jsx(oe,{children:i.jsxs(he,{className:"p-4 text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:O.totalValue}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Total GP"})]})})]}),i.jsxs("div",{children:[i.jsx("h2",{className:"text-2xl font-semibold mb-4",children:f==="my"?"My Items":"All Items"}),B(R,f==="my")]})]}),i.jsx(HV,{open:p,onOpenChange:x,mode:g,item:v,onSuccess:L})]})}const WM=({map:s,cellSize:e=20,interactive:t=!1,onCellClick:n,onCellHover:r,onCellLeave:a,className:o="",showTerrainInfo:l=!1,onBulkColorChange:c,showBulkColorControls:d=!1})=>{if(!s||!s.width||!s.height||!s.cells)return i.jsx("div",{className:`map-preview-outer-wrapper w-full max-w-full overflow-auto flex justify-center ${o}`,children:i.jsx("div",{className:"flex items-center justify-center p-8 text-muted-foreground",children:i.jsx("p",{children:"No map data available"})})});const h=m=>{switch(m){case"inbounds":return"bg-gray-200 dark:bg-gray-600";case"outbounds":return"bg-gray-100 dark:bg-gray-700";case"occupied":return"bg-gray-300 dark:bg-gray-500";default:return"bg-gray-200 dark:bg-gray-600"}},f=m=>{c&&c(m)};return i.jsxs("div",{className:`map-preview-outer-wrapper w-full max-w-full ${o}`,children:[d&&i.jsx("div",{className:"mb-4 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:i.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[i.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Change all cells to:"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("button",{onClick:()=>f("#e5e7eb"),className:"w-8 h-8 rounded border-2 border-gray-300 hover:border-gray-400 transition-colors",style:{backgroundColor:"#e5e7eb"},title:"Light Grey"}),i.jsx("button",{onClick:()=>f("#9ca3af"),className:"w-8 h-8 rounded border-2 border-gray-300 hover:border-gray-400 transition-colors",style:{backgroundColor:"#9ca3af"},title:"Medium Grey"}),i.jsx("button",{onClick:()=>f("#6b7280"),className:"w-8 h-8 rounded border-2 border-gray-300 hover:border-gray-400 transition-colors",style:{backgroundColor:"#6b7280"},title:"Dark Grey"}),i.jsx("button",{onClick:()=>f("#22c55e"),className:"w-8 h-8 rounded border-2 border-gray-300 hover:border-gray-400 transition-colors",style:{backgroundColor:"#22c55e"},title:"Green"}),i.jsx("button",{onClick:()=>f("#3b82f6"),className:"w-8 h-8 rounded border-2 border-gray-300 hover:border-gray-400 transition-colors",style:{backgroundColor:"#3b82f6"},title:"Blue"}),i.jsx("button",{onClick:()=>f("#ef4444"),className:"w-8 h-8 rounded border-2 border-gray-300 hover:border-gray-400 transition-colors",style:{backgroundColor:"#ef4444"},title:"Red"}),i.jsx("button",{onClick:()=>f("reset"),className:"px-3 py-1 text-xs bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors border border-gray-300 dark:border-gray-600",title:"Reset to Default",children:"Reset"})]})]})}),i.jsx("div",{className:"overflow-auto flex justify-center",style:{maxHeight:"60vh",minWidth:0},children:i.jsx("div",{className:"map-preview-grid grid border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-900",style:{gridTemplateColumns:`repeat(${s.width}, minmax(0, ${e}px))`,width:"fit-content",maxWidth:"100%",gap:"1px"},children:s.cells.map(m=>{let p="",x={width:e,height:e,minWidth:0,minHeight:0};return m.occupant?x.backgroundColor=m.occupant.color:m.customColor?x.backgroundColor=m.customColor:p=h(m.state),i.jsxs("div",{className:`map-preview-cell ${p} ${t?"cursor-pointer hover:opacity-80 transition-colors duration-150":""} border border-gray-300 dark:border-gray-600 relative`,style:x,onClick:()=>t&&n&&n(m.x,m.y),onMouseEnter:()=>t&&r&&r(m.x,m.y),onMouseLeave:()=>t&&a&&a(),title:l&&m.terrain?`${m.terrain} terrain (${m.terrainModifier||0} modifier)`:m.occupant?`${m.occupant.name} (${m.occupant.type})`:`Cell (${m.x}, ${m.y})`,children:[m.occupant&&e>25&&i.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-xs font-bold text-white drop-shadow-lg",children:m.occupant.name.charAt(0).toUpperCase()}),l&&m.terrain&&m.terrain!=="normal"&&e>30&&i.jsx("div",{className:"absolute bottom-0 right-0 text-xs bg-black bg-opacity-70 text-white px-1 rounded-tl",children:m.terrainModifier||0})]},`${m.x}-${m.y}`)})})})]})},xfe=({map:s,isSelected:e=!1,onSelect:t,compact:n=!1,className:r})=>{const a=()=>{t&&t(s._id)},o=l=>new Date(l).toLocaleDateString();return i.jsx(oe,{className:Ee("transition-all duration-200 cursor-pointer border-2",e?"border-primary bg-primary/5 shadow-md":"border-border hover:border-primary/50 hover:shadow-sm",n?"p-3":"p-4",r),onClick:a,role:"button",tabIndex:0,onKeyDown:l=>{(l.key==="Enter"||l.key===" ")&&(l.preventDefault(),a())},"aria-pressed":e,"aria-label":`Select map: ${s.name}`,children:i.jsxs(he,{className:Ee("p-0",n?"space-y-2":"space-y-3"),children:[i.jsx("div",{className:Ee("flex justify-center items-center overflow-hidden rounded-md",n?"h-24":"h-32"),children:i.jsx("div",{className:"bg-white dark:bg-gray-800 rounded p-2 w-full max-w-full",children:i.jsx(WM,{map:s,cellSize:n?8:12})})}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("h3",{className:Ee("font-semibold text-foreground truncate",n?"text-sm":"text-base"),children:s.name}),i.jsxs("div",{className:Ee("flex items-center gap-2 text-muted-foreground",n?"text-xs":"text-sm"),children:[i.jsx(iM,{className:"h-3 w-3"}),i.jsxs("span",{children:[s.width,"  ",s.height]})]}),i.jsxs("div",{className:Ee("flex items-center gap-2 text-muted-foreground",n?"text-xs":"text-sm"),children:[i.jsx(Ac,{className:"h-3 w-3"}),i.jsxs("span",{children:["Created ",o(s.createdAt)]})]})]}),e&&i.jsx("div",{className:"flex justify-center",children:i.jsx(ue,{variant:"default",className:"text-xs",children:"Selected"})})]})})},DO={light:{normal:"rgba(232, 211, 231, 0.3)",difficult:"rgba(183, 9, 76, 0.25)",hazardous:"rgba(160, 26, 88, 0.35)",magical:"rgba(137, 43, 100, 0.4)",water:"rgba(23, 128, 161, 0.5)",ice:"rgba(0, 145, 173, 0.4)",fire:"rgba(183, 9, 76, 0.5)",acid:"rgba(0, 201, 241, 0.4)",poison:"rgba(114, 60, 112, 0.4)",unstable:"rgba(92, 77, 125, 0.5)"},dark:{normal:"rgba(30, 25, 35, 0.5)",difficult:"rgba(244, 13, 102, 0.3)",hazardous:"rgba(214, 35, 118, 0.4)",magical:"rgba(186, 59, 135, 0.45)",water:"rgba(31, 174, 218, 0.5)",ice:"rgba(0, 201, 241, 0.45)",fire:"rgba(244, 13, 102, 0.55)",acid:"rgba(53, 221, 255, 0.4)",poison:"rgba(158, 83, 155, 0.45)",unstable:"rgba(122, 103, 162, 0.5)"}};function YV(s){return s?DO.dark:DO.light}const LO={light:{playerCharacter:"#2e6f95",npc:"#5c4d7d",monster:"#b7094c",default:"#455e89",selected:"#0091ad",currentTurn:"#892b64"},dark:{playerCharacter:"#3d92c4",npc:"#7a67a2",monster:"#f40d66",default:"#5c7aad",selected:"#00c9f1",currentTurn:"#ba3b87"}};function yfe(s){return s?LO.dark:LO.light}const OO={light:{healthy:"#0091ad",wounded:"#a01a58",critical:"#b7094c"},dark:{healthy:"#00c9f1",wounded:"#d62376",critical:"#f40d66"}};function vfe(s,e){const t=e?OO.dark:OO.light;return s>50?t.healthy:s>25?t.wounded:t.critical}const FO={light:{movement:"rgba(183, 9, 76, 0.6)",attack:"rgba(160, 26, 88, 0.6)",target:"rgba(137, 43, 100, 0.6)",selected:"rgba(0, 145, 173, 0.6)",hover:"rgba(92, 77, 125, 0.4)"},dark:{movement:"rgba(244, 13, 102, 0.6)",attack:"rgba(214, 35, 118, 0.6)",target:"rgba(186, 59, 135, 0.6)",selected:"rgba(0, 201, 241, 0.6)",hover:"rgba(122, 103, 162, 0.4)"}};function bfe(s){return s?FO.dark:FO.light}const BO={light:{movementRange:"rgba(0, 145, 173, 0.25)",movementHover:"rgba(0, 145, 173, 0.45)",attackRange:"rgba(183, 9, 76, 0.25)",attackHover:"rgba(183, 9, 76, 0.45)",aoe:"rgba(160, 26, 88, 0.35)",measurePoint:"rgba(46, 111, 149, 0.5)",multiSelect:"rgba(0, 145, 173, 0.35)"},dark:{movementRange:"rgba(0, 201, 241, 0.25)",movementHover:"rgba(0, 201, 241, 0.45)",attackRange:"rgba(244, 13, 102, 0.25)",attackHover:"rgba(244, 13, 102, 0.45)",aoe:"rgba(214, 35, 118, 0.35)",measurePoint:"rgba(61, 146, 196, 0.5)",multiSelect:"rgba(0, 201, 241, 0.35)"}};function wfe(s){return s?BO.dark:BO.light}const Cfe={normal:{description:"Standard terrain",movementCost:"1",icon:"",effects:["No special effects"]},difficult:{description:"Harder to move through",movementCost:"2",icon:"",effects:["Double movement cost","Difficult terrain"]},hazardous:{description:"Dangerous terrain",movementCost:"2",icon:"",effects:["Double movement cost","Risk of injury","May require saves"]},magical:{description:"Magical effects",movementCost:"1",icon:"",effects:["Magical properties","May enhance abilities","Unpredictable effects"]},water:{description:"Water terrain",movementCost:"2",icon:"",effects:["Double movement cost","Swimming required","May cause drowning"]},ice:{description:"Slippery surface",movementCost:"2",icon:"",effects:["Double movement cost","Risk of falling","Dexterity saves required"]},fire:{description:"Burning terrain",movementCost:"2",icon:"",effects:["Double movement cost","Fire damage","Constitution saves vs burning"]},acid:{description:"Corrosive surface",movementCost:"2",icon:"",effects:["Double movement cost","Acid damage","Equipment damage risk"]},poison:{description:"Toxic environment",movementCost:"2",icon:"",effects:["Double movement cost","Poison damage","Constitution saves vs poisoning"]},unstable:{description:"Shifting ground",movementCost:"2",icon:"",effects:["Double movement cost","Risk of falling","Unstable footing"]}},KV=V.memo(({entity:s,isSelected:e,cellSize:t})=>{const{actualTheme:n}=Ox(),r=n==="dark",a=yfe(r),o=Math.max(20,t*.8),l=Math.max(12,o*.6),c=()=>{switch(s.entityType){case"playerCharacter":return i.jsx(cM,{size:l});case"npc":return i.jsx(Cs,{size:l});case"monster":return i.jsx(Oc,{size:l});default:return i.jsx(ci,{size:l})}},d=()=>{if(s.color)return s.color;switch(s.entityType){case"playerCharacter":return a.playerCharacter;case"npc":return a.npc;case"monster":return a.monster;default:return a.default}},h=()=>e?a.selected:"transparent",f=()=>{switch(s.entityType){case"playerCharacter":return i.jsx("div",{className:`absolute -top-1 -right-1 w-3 h-3 rounded-full border border-white ${r?"bg-rich-cerulean-300":"bg-rich-cerulean-500"}`});case"npc":return i.jsx("div",{className:`absolute -top-1 -right-1 w-3 h-3 rounded-full border border-white ${r?"bg-dusty-grape-300":"bg-dusty-grape-500"}`});case"monster":return i.jsx("div",{className:`absolute -top-1 -right-1 w-3 h-3 rounded-full border border-white ${r?"bg-cherry-rose-300":"bg-cherry-rose-500"}`});default:return null}},m=d(),p=h();return i.jsxs("div",{className:"absolute inset-0 flex items-center justify-center",children:[e&&i.jsx("div",{className:"absolute inset-0 rounded-full border-2 animate-pulse",style:{borderColor:p,boxShadow:`0 0 8px ${p}40`}}),i.jsxs("div",{className:Ee("relative rounded-full flex items-center justify-center","shadow-md border-2 border-white","transition-all duration-200",e&&"scale-110"),style:{width:o,height:o,backgroundColor:m,boxShadow:e?`0 0 12px ${p}60`:"0 2px 4px rgba(0, 0, 0, 0.1)"},children:[i.jsx("div",{className:"text-white drop-shadow-sm",children:c()}),f(),i.jsx("div",{className:"absolute -bottom-1 -left-1 w-2 h-2 bg-white rounded-full border border-gray-300"})]}),i.jsxs("div",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 bg-black text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-10",children:[s.name,i.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-black"})]})]})});KV.displayName="MapToken";const XV=V.memo(({x:s,y:e,cell:t,entity:n,isSelected:r,isInMovementRange:a,isInAOE:o,isMeasurePoint:l,isHovered:c,isInPath:d,onClick:h,onHover:f,cellSize:m})=>{const{actualTheme:p}=Ox(),x=p==="dark",g=()=>{if(!t)return{backgroundColor:x?"#251f33":"#f3f4f6",borderColor:x?"#382f4c":"#d1d5db",opacity:.5};if(t.state==="outbounds")return{backgroundColor:x?"#131019":"#374151",borderColor:x?"#251f33":"#1f2937",opacity:.8};let w=x?"#251f33":"#ffffff",S=x?"#382f4c":"#ded9e8",j=1;if(t.customColor)w=t.customColor;else if(t.terrainType)switch(t.terrainType){case"normal":w=x?"#251f33":"#f9fafb";break;case"difficult":w=x?"rgba(244, 13, 102, 0.2)":"rgba(183, 9, 76, 0.15)",S=x?"#f40d66":"#b7094c";break;case"hazardous":w=x?"rgba(214, 35, 118, 0.2)":"rgba(160, 26, 88, 0.15)",S=x?"#d62376":"#a01a58";break;case"water":w=x?"rgba(31, 174, 218, 0.2)":"rgba(23, 128, 161, 0.15)",S=x?"#1faeda":"#1780a1";break;case"magical":w=x?"rgba(186, 59, 135, 0.2)":"rgba(137, 43, 100, 0.15)",S=x?"#ba3b87":"#892b64";break;case"ice":w=x?"rgba(0, 201, 241, 0.2)":"rgba(0, 145, 173, 0.15)",S=x?"#00c9f1":"#0091ad";break;case"fire":w=x?"rgba(244, 13, 102, 0.3)":"rgba(183, 9, 76, 0.25)",S=x?"#f40d66":"#b7094c";break;case"acid":w=x?"rgba(53, 221, 255, 0.2)":"rgba(0, 201, 241, 0.15)",S=x?"#35ddff":"#00c9f1";break;case"poison":w=x?"rgba(158, 83, 155, 0.2)":"rgba(114, 60, 112, 0.15)",S=x?"#9e539b":"#723c70";break;case"unstable":w=x?"rgba(122, 103, 162, 0.2)":"rgba(92, 77, 125, 0.15)",S=x?"#7a67a2":"#5c4d7d";break}return{backgroundColor:w,borderColor:S,opacity:j}},b=()=>{const w=[];return r&&w.push("ring-2 ring-pacific-cyan-500 ring-offset-2"),a&&w.push(x?"bg-pacific-cyan-300/30":"bg-pacific-cyan-400/30"),o&&w.push(x?"bg-dark-raspberry-300/30":"bg-cherry-rose-400/30"),l&&w.push("ring-2 ring-rich-cerulean-500 ring-offset-1"),c&&w.push("ring-1 ring-dusty-grape-400"),d&&w.push(x?"bg-cerulean-300/40":"bg-cerulean-400/40"),w},v=g(),y=b();return i.jsxs("div",{className:Ee("relative border cursor-pointer transition-all duration-150","hover:shadow-md",y),style:{backgroundColor:v.backgroundColor,borderColor:v.borderColor,opacity:v.opacity,width:m,height:m,minWidth:m,minHeight:m},onClick:h,onMouseEnter:f,title:`${s}, ${e}${n?` - ${n.name}`:""}${t!=null&&t.terrainType?` - ${t.terrainType}`:""}`,children:[(t==null?void 0:t.terrainType)&&t.terrainType!=="normal"&&i.jsx("div",{className:"absolute top-0 left-0 w-2 h-2 bg-current opacity-60"}),n&&i.jsx(KV,{entity:n,isSelected:r,cellSize:m}),a&&!n&&i.jsx("div",{className:`absolute inset-0 rounded-sm ${x?"bg-pacific-cyan-300/30":"bg-pacific-cyan-400/20"}`}),o&&!n&&i.jsx("div",{className:`absolute inset-0 rounded-sm ${x?"bg-dark-raspberry-300/30":"bg-cherry-rose-400/20"}`}),l&&i.jsx("div",{className:`absolute inset-0 rounded-sm flex items-center justify-center ${x?"bg-rich-cerulean-300/40":"bg-rich-cerulean-400/30"}`,children:i.jsx("div",{className:`w-1 h-1 rounded-full ${x?"bg-rich-cerulean-300":"bg-rich-cerulean-600"}`})}),d&&!n&&i.jsx("div",{className:`absolute inset-0 rounded-sm ${x?"bg-cerulean-300/40":"bg-cerulean-400/30"}`}),(t==null?void 0:t.portalLink)&&i.jsxs("div",{className:`absolute inset-0 rounded-sm border-2 flex items-center justify-center ${x?"bg-royal-plum-300/30 border-royal-plum-400":"bg-royal-plum-50/50 border-royal-plum-500"}`,children:[i.jsx("div",{className:`text-xs font-bold ${x?"text-royal-plum-300":"text-royal-plum-600"}`,children:""}),t.portalLink.label&&i.jsx("div",{className:`absolute -top-6 left-0 right-0 text-[10px] text-center whitespace-nowrap pointer-events-none ${x?"text-royal-plum-300":"text-royal-plum-600"}`,children:t.portalLink.label})]}),!1]})});XV.displayName="MapCell";const QV=({map:s,mapInstance:e,selectedTokenId:t,hoveredCell:n,movementPreview:r,measurePoints:a,aoeTemplate:o,onCellClick:l,onCellHover:c,isDM:d,cellSize:h=40})=>{const[f,m]=C.useState({x:0,y:0}),[p,x]=C.useState(1),[g,b]=C.useState(!1),[v,y]=C.useState({x:0,y:0}),w=C.useMemo(()=>{const T=[];for(let B=0;B<s.height;B++){T[B]=[];for(let R=0;R<s.width;R++)T[B][R]=null}return s.cells.forEach(B=>{B.y<s.height&&B.x<s.width&&(T[B.y][B.x]=B)}),T},[s.cells,s.width,s.height]),S=C.useMemo(()=>{const T=new Map;return e.currentPositions.forEach(B=>{T.set(`${B.x},${B.y}`,B)}),T},[e.currentPositions]),j=C.useMemo(()=>{if(!r||!t)return new Set;const T=r.cost,B=new Set,R=e.currentPositions.find(O=>O.entityId===t);if(!R)return B;for(let O=Math.max(0,R.y-T);O<=Math.min(s.height-1,R.y+T);O++)for(let I=Math.max(0,R.x-T);I<=Math.min(s.width-1,R.x+T);I++)Math.abs(I-R.x)+Math.abs(O-R.y)<=T&&B.add(`${I},${O}`);return B},[r,t,e.currentPositions,s.height,s.width]),A=C.useMemo(()=>{if(!o)return new Set;const T=new Set,{type:B,size:R,center:O}=o;switch(B){case"sphere":for(let I=Math.max(0,O.y-R);I<=Math.min(s.height-1,O.y+R);I++)for(let U=Math.max(0,O.x-R);U<=Math.min(s.width-1,O.x+R);U++)Math.sqrt((U-O.x)**2+(I-O.y)**2)<=R&&T.add(`${U},${I}`);break;case"cube":for(let I=Math.max(0,O.y-R);I<=Math.min(s.height-1,O.y+R);I++)for(let U=Math.max(0,O.x-R);U<=Math.min(s.width-1,O.x+R);U++)T.add(`${U},${I}`);break;case"cone":if(o.direction!==void 0){const I=o.direction;for(let U=Math.max(0,O.y-R);U<=Math.min(s.height-1,O.y+R);U++)for(let M=Math.max(0,O.x-R);M<=Math.min(s.width-1,O.x+R);M++)if(Math.sqrt((M-O.x)**2+(U-O.y)**2)<=R){const W=Math.atan2(U-O.y,M-O.x);Math.abs(W-I)<=Math.PI/4&&T.add(`${M},${U}`)}}break;case"line":if(o.direction!==void 0){const I=o.direction;for(let U=0;U<R;U++){const M=Math.round(O.x+Math.cos(I)*U),$=Math.round(O.y+Math.sin(I)*U);M>=0&&M<s.width&&$>=0&&$<s.height&&T.add(`${M},${$}`)}}break}return T},[o,s.width,s.height]),k=C.useCallback(T=>{(T.button===1||T.button===0&&T.ctrlKey)&&(b(!0),y({x:T.clientX-f.x,y:T.clientY-f.y}),T.preventDefault())},[f]),_=C.useCallback(T=>{g&&m({x:T.clientX-v.x,y:T.clientY-v.y})},[g,v]),L=C.useCallback(()=>{b(!1)},[]),D=C.useCallback(T=>{T.preventDefault();const B=T.deltaY>0?.9:1.1;x(R=>Math.max(.5,Math.min(3,R*B)))},[]),P={transform:`translate(${f.x}px, ${f.y}px) scale(${p})`,transformOrigin:"0 0",width:s.width*h,height:s.height*h,display:"grid",gridTemplateColumns:`repeat(${s.width}, ${h}px)`,gridTemplateRows:`repeat(${s.height}, ${h}px)`};return i.jsxs("div",{className:"relative w-full h-full overflow-hidden",onMouseDown:k,onMouseMove:_,onMouseUp:L,onMouseLeave:L,onWheel:D,children:[i.jsx("div",{className:"absolute",style:P,children:w.map((T,B)=>T.map((R,O)=>{const I=S.get(`${O},${B}`),U=j.has(`${O},${B}`),M=A.has(`${O},${B}`),$=a==null?void 0:a.some(ee=>ee.x===O&&ee.y===B),W=(n==null?void 0:n.x)===O&&(n==null?void 0:n.y)===B;return i.jsx(XV,{x:O,y:B,cell:R?{...R,portalLink:R.portalLink?{targetMapId:R.portalLink.targetMapId,targetX:R.portalLink.targetX,targetY:R.portalLink.targetY,label:R.portalLink.label}:void 0}:null,entity:I,isSelected:(I==null?void 0:I.entityId)===t,isInMovementRange:U,isInAOE:M,isMeasurePoint:$,isHovered:W,isInPath:r==null?void 0:r.path.some(ee=>ee.x===O&&ee.y===B),onClick:()=>l(O,B),onHover:()=>c(O,B),cellSize:h},`${O},${B}`)}))}),i.jsxs("div",{className:"absolute bottom-4 right-4 flex flex-col gap-2",children:[i.jsx("button",{onClick:()=>x(T=>Math.min(3,T*1.2)),className:"w-8 h-8 bg-white border border-gray-300 rounded shadow-sm hover:bg-gray-50 flex items-center justify-center",children:"+"}),i.jsx("button",{onClick:()=>x(T=>Math.max(.5,T*.8)),className:"w-8 h-8 bg-white border border-gray-300 rounded shadow-sm hover:bg-gray-50 flex items-center justify-center",children:""}),i.jsx("button",{onClick:()=>{x(1),m({x:0,y:0})},className:"w-8 h-8 bg-white border border-gray-300 rounded shadow-sm hover:bg-gray-50 flex items-center justify-center text-xs",children:""})]}),i.jsxs("div",{className:"absolute top-4 left-4 bg-black/70 text-white px-3 py-2 rounded text-sm",children:[i.jsx("div",{children:"Left click: Select/Move"}),i.jsx("div",{children:"Ctrl+Left drag: Pan"}),i.jsx("div",{children:"Scroll: Zoom"})]})]})},ZV=({activeTool:s,onToolChange:e,isDM:t,isNonCombat:n=!1,onClearMeasurements:r,onClearAOE:a,className:o=""})=>{var f,m;const[l,c]=C.useState(!1),d=[{id:"select",name:"Select",icon:rM,description:"Select tokens and view information",available:!0},{id:"move",name:"Move",icon:_ne,description:"Move selected tokens",available:!0},{id:"measure",name:"Measure",icon:iM,description:"Measure distances between points",available:!0},{id:"aoe",name:"Area of Effect",icon:Da,description:"Place AoE spell templates",available:!n},{id:"terrain",name:"Terrain",icon:Tne,description:"Paint terrain types (DM only)",available:t},{id:"info",name:"Info",icon:Ku,description:"View detailed information",available:!0}],h=p=>i.jsxs(q,{variant:s===p.id?"default":"outline",size:"sm",onClick:()=>e(p.id),disabled:!p.available,className:Ee("flex flex-col items-center gap-1 h-auto p-3 min-w-[60px]",s===p.id&&"bg-blue-600 text-white",!p.available&&"opacity-50 cursor-not-allowed"),title:p.description,children:[i.jsx(p.icon,{size:16}),i.jsx("span",{className:"text-xs",children:p.name}),!p.available&&i.jsx(ue,{variant:"secondary",className:"text-xs px-1 py-0",children:"DM"})]},p.id);return i.jsxs("div",{className:Ee("bg-white border border-gray-200 rounded-lg shadow-sm p-4",o),children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Tactical Tools"}),i.jsx(ue,{variant:"outline",className:"text-xs",children:t?"DM Mode":"Player Mode"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs(q,{variant:"ghost",size:"sm",onClick:r,className:"text-xs",children:[i.jsx(ck,{size:12,className:"mr-1"}),"Clear"]}),i.jsxs(q,{variant:"ghost",size:"sm",onClick:()=>c(!l),className:"text-xs",children:[i.jsx(vne,{size:12,className:"mr-1"}),"Help"]})]})]}),i.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:d.map(h)}),l&&i.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600",children:[i.jsxs("div",{children:[i.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"Mouse Controls"}),i.jsxs("ul",{className:"space-y-1",children:[i.jsxs("li",{children:[" ",i.jsx("strong",{children:"Left Click:"})," Select tokens or confirm actions"]}),i.jsxs("li",{children:[" ",i.jsx("strong",{children:"Ctrl + Left Drag:"})," Pan the map"]}),i.jsxs("li",{children:[" ",i.jsx("strong",{children:"Scroll Wheel:"})," Zoom in/out"]}),i.jsxs("li",{children:[" ",i.jsx("strong",{children:"Hover:"})," Preview movement and effects"]})]})]}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-medium text-gray-800 mb-2",children:"Keyboard Shortcuts"}),i.jsxs("ul",{className:"space-y-1",children:[i.jsxs("li",{children:[" ",i.jsx("strong",{children:"1-6:"})," Switch tools"]}),i.jsxs("li",{children:[" ",i.jsx("strong",{children:"Space:"})," Clear current tool"]}),i.jsxs("li",{children:[" ",i.jsx("strong",{children:"Escape:"})," Cancel current action"]}),i.jsxs("li",{children:[" ",i.jsx("strong",{children:"Home:"})," Reset view"]})]})]})]})}),i.jsx("div",{className:"mt-3 pt-3 border-t border-gray-200",children:i.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[i.jsxs("span",{children:["Active: ",i.jsx("strong",{className:"text-gray-700",children:(f=d.find(p=>p.id===s))==null?void 0:f.name})]}),i.jsx("span",{children:(m=d.find(p=>p.id===s))==null?void 0:m.description})]})})]})},Sfe=({instanceId:s,className:e=""})=>{const t=cw(),n=(t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="dm",[r,a]=C.useState("select"),[o,l]=C.useState({selectedTokenId:null,hoveredCell:null,movementPreview:null,measurePoints:null,aoeTemplate:null,terrainBrush:{type:"difficult",active:!1}}),c=Fe(re.maps.getMapInstance,{instanceId:s}),d=Fe(re.maps.getMap,{mapId:c==null?void 0:c.mapId}),h=Re(re.maps.moveEntity),f=Re(re.maps.updateMapCells),m=Re(re.maps.navigateToLinkedMap),p=C.useMemo(()=>{if(!o.selectedTokenId||!c||!d)return null;const b=c.currentPositions.find(y=>y.entityId===o.selectedTokenId);if(!b)return null;const v=b.speed/5;return Math.floor(v)},[o.selectedTokenId,c,d]),x=C.useCallback(async(b,v)=>{var w,S;const y=(w=d==null?void 0:d.cells)==null?void 0:w.find(j=>j.x===b&&j.y===v);if(y!=null&&y.portalLink&&r==="select"&&o.selectedTokenId&&c){try{await m({instanceId:s,targetMapId:y.portalLink.targetMapId,targetX:y.portalLink.targetX,targetY:y.portalLink.targetY,entityId:o.selectedTokenId}),l(j=>({...j,selectedTokenId:null,movementPreview:null}))}catch(j){console.error("Failed to navigate to linked map:",j)}return}switch(r){case"select":const j=c==null?void 0:c.currentPositions.find(A=>A.x===b&&A.y===v);l(A=>({...A,selectedTokenId:(j==null?void 0:j.entityId)||null}));break;case"move":o.selectedTokenId&&((S=o.movementPreview)!=null&&S.valid)&&(h({instanceId:s,entityId:o.selectedTokenId,toX:b,toY:v}),l(A=>({...A,selectedTokenId:null,movementPreview:null})));break;case"measure":l(A=>({...A,measurePoints:A.measurePoints?[...A.measurePoints,{x:b,y:v}]:[{x:b,y:v}]}));break;case"aoe":o.aoeTemplate&&l(A=>({...A,aoeTemplate:{...A.aoeTemplate,center:{x:b,y:v}}}));break;case"terrain":n&&o.terrainBrush.active&&f({mapId:d._id,updates:[{x:b,y:v,terrainType:o.terrainBrush.type}]});break}},[r,o,c,d,h,f,s,n,m]),g=C.useCallback((b,v)=>{if(r==="move"&&o.selectedTokenId&&p){const y=c==null?void 0:c.currentPositions.find(j=>j.entityId===o.selectedTokenId);if(!y)return;const w=Math.abs(b-y.x)+Math.abs(v-y.y),S=w<=p;l(j=>({...j,hoveredCell:{x:b,y:v},movementPreview:{path:[{x:y.x,y:y.y},{x:b,y:v}],cost:w,valid:S}}))}else l(y=>({...y,hoveredCell:{x:b,y:v}}))},[r,o.selectedTokenId,p,c]);return C.useEffect(()=>{l(b=>({...b,movementPreview:null,measurePoints:null,aoeTemplate:null}))},[r]),!c||!d?i.jsx("div",{className:"flex items-center justify-center h-64",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto mb-2"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading tactical map..."})]})}):i.jsxs("div",{className:`flex flex-col h-full ${e}`,children:[i.jsx(ZV,{activeTool:r,onToolChange:a,isDM:n,onClearMeasurements:()=>l(b=>({...b,measurePoints:null})),onClearAOE:()=>l(b=>({...b,aoeTemplate:null}))}),i.jsx("div",{className:"flex-1 relative overflow-hidden bg-gray-100 rounded-lg",children:i.jsx(QV,{map:d,mapInstance:c,selectedTokenId:o.selectedTokenId,hoveredCell:o.hoveredCell,movementPreview:o.movementPreview,measurePoints:o.measurePoints,aoeTemplate:o.aoeTemplate,onCellClick:x,onCellHover:g,isDM:n})}),i.jsx("div",{className:"mt-4",children:i.jsx(oe,{children:i.jsx(he,{className:"p-4",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(ue,{variant:"outline",children:c.name}),i.jsxs(ue,{variant:"secondary",children:[d.width,"  ",d.height]}),o.selectedTokenId&&i.jsx(ue,{variant:"default",children:"Token Selected"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[o.measurePoints&&o.measurePoints.length>=2&&i.jsxs(ue,{variant:"outline",children:["Distance: ",jfe(o.measurePoints[0],o.measurePoints[1]),"ft"]}),o.movementPreview&&i.jsxs(ue,{variant:"outline",children:["Move Cost: ",o.movementPreview.cost*5,"ft"]})]})]})})})})]})};function jfe(s,e){const t=Math.abs(e.x-s.x),n=Math.abs(e.y-s.y),r=Math.min(t,n),a=Math.max(t,n)-r;return r*7.5+a*5}const kfe=({instanceId:s,className:e="",onMapChange:t})=>{const n=cw(),r=(n==null?void 0:n.role)==="admin"||(n==null?void 0:n.role)==="dm",[a,o]=C.useState("select"),[l,c]=C.useState({selectedTokenId:null,hoveredCell:null,movementPreview:null,measurePoints:null,terrainBrush:{type:"difficult",active:!1}}),d=Fe(re.maps.getMapInstance,{instanceId:s}),h=Fe(re.maps.getMap,{mapId:d==null?void 0:d.mapId}),f=Re(re.maps.moveEntity),m=Re(re.maps.updateMapCells),p=Re(re.maps.navigateToLinkedMap),x=C.useMemo(()=>{if(!l.selectedTokenId||!d||!h)return null;const y=d.currentPositions.find(S=>S.entityId===l.selectedTokenId);if(!y)return null;const w=y.speed/5;return Math.floor(w)},[l.selectedTokenId,d,h]),g=C.useCallback(async(y,w)=>{var j,A;const S=(j=h==null?void 0:h.cells)==null?void 0:j.find(k=>k.x===y&&k.y===w);if(S!=null&&S.portalLink){if(l.selectedTokenId&&d)try{const k=await p({instanceId:s,targetMapId:S.portalLink.targetMapId,targetX:S.portalLink.targetX,targetY:S.portalLink.targetY,entityId:l.selectedTokenId});t&&t(k),c(_=>({..._,selectedTokenId:null,movementPreview:null}))}catch(k){console.error("Failed to navigate to linked map:",k)}return}switch(a){case"select":const k=d==null?void 0:d.currentPositions.find(_=>_.x===y&&_.y===w);c(_=>({..._,selectedTokenId:(k==null?void 0:k.entityId)||null}));break;case"move":l.selectedTokenId&&((A=l.movementPreview)!=null&&A.valid)&&(f({instanceId:s,entityId:l.selectedTokenId,toX:y,toY:w}),c(_=>({..._,selectedTokenId:null,movementPreview:null})));break;case"measure":c(_=>({..._,measurePoints:_.measurePoints?[..._.measurePoints,{x:y,y:w}]:[{x:y,y:w}]}));break;case"terrain":r&&l.terrainBrush.active&&m({mapId:h._id,updates:[{x:y,y:w,terrainType:l.terrainBrush.type}]});break}},[a,l,d,h,f,m,s,r,p,t]),b=C.useCallback((y,w)=>{if(a==="move"&&l.selectedTokenId&&x){const S=d==null?void 0:d.currentPositions.find(k=>k.entityId===l.selectedTokenId);if(!S)return;const j=Math.abs(y-S.x)+Math.abs(w-S.y),A=j<=x;c(k=>({...k,hoveredCell:{x:y,y:w},movementPreview:{path:[{x:S.x,y:S.y},{x:y,y:w}],cost:j,valid:A}}))}else c(S=>({...S,hoveredCell:{x:y,y:w}}))},[a,l.selectedTokenId,x,d]);if(C.useEffect(()=>{c(y=>({...y,movementPreview:null,measurePoints:null}))},[a]),!d||!h)return i.jsx("div",{className:"flex items-center justify-center h-64",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto mb-2"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading map..."})]})});const v=h.mapType==="nonCombat";return i.jsxs("div",{className:`flex flex-col h-full ${e}`,children:[i.jsx(ZV,{activeTool:a,onToolChange:o,isDM:r,isNonCombat:v,onClearMeasurements:()=>c(y=>({...y,measurePoints:null})),onClearAOE:()=>{}}),i.jsx("div",{className:"flex-1 relative overflow-hidden bg-gray-100 rounded-lg",children:i.jsx(QV,{map:h,mapInstance:d,selectedTokenId:l.selectedTokenId,hoveredCell:l.hoveredCell,movementPreview:l.movementPreview,measurePoints:l.measurePoints,aoeTemplate:null,onCellClick:g,onCellHover:b,isDM:r})}),i.jsx("div",{className:"mt-4",children:i.jsx(oe,{children:i.jsx(he,{className:"p-4",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(ue,{variant:"outline",children:d.name}),i.jsxs(ue,{variant:"secondary",children:[h.width,"  ",h.height]}),v&&i.jsx(ue,{variant:"default",children:"Non-Combat"}),l.selectedTokenId&&i.jsx(ue,{variant:"default",children:"Token Selected"})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[l.measurePoints&&l.measurePoints.length>=2&&i.jsxs(ue,{variant:"outline",children:["Distance: ",Nfe(l.measurePoints[0],l.measurePoints[1]),"ft"]}),l.movementPreview&&i.jsxs(ue,{variant:"outline",children:["Move Cost: ",l.movementPreview.cost*5,"ft"]})]})]})})})})]})};function Nfe(s,e){const t=Math.abs(e.x-s.x),n=Math.abs(e.y-s.y),r=Math.min(t,n),a=Math.max(t,n)-r;return r*7.5+a*5}const JV=({isOpen:s,onClose:e,mapId:t,mode:n,campaignId:r,interactionId:a,onOpenInteractive:o})=>{const l=cw(),{userId:c}=Ji(),d=(l==null?void 0:l.role)==="admin"||(l==null?void 0:l.role)==="dm",[h,f]=C.useState(null),[m,p]=C.useState(!1),x=Fe(re.maps.getMap,{mapId:t}),g=Re(re.maps.createMapInstance),b=Fe(re.maps.getMapInstanceByInteraction,a?{interactionId:a,mapId:t}:"skip");C.useEffect(()=>{b&&f(b._id)},[b]);const v=C.useCallback(async()=>{if(!(!x||!a||!r||!c)){p(!0);try{const S=await g({mapId:t,name:`${x.name} - Session`,campaignId:r,interactionId:a,clerkId:c});f(S)}catch(S){console.error("Failed to create map instance:",S)}finally{p(!1)}}},[x,a,r,c,g]);if(C.useEffect(()=>{n==="interactive"&&!h&&!b&&x&&a&&r&&v()},[n,h,b,x,a,r,v]),!x)return i.jsx(cs,{open:s,onOpenChange:e,children:i.jsxs(is,{className:"max-w-[95vw] max-h-[95vh] overflow-hidden flex flex-col",children:[i.jsxs(Rs,{className:"flex-shrink-0 flex flex-row items-center justify-between",children:[i.jsx(Ds,{className:"text-xl font-bold",children:"Loading Map..."}),i.jsx(q,{variant:"ghost",size:"sm",onClick:e,className:"h-8 w-8 p-0 hover:bg-gray-100 dark:hover:bg-gray-800",children:i.jsx(Mr,{className:"h-4 w-4"})})]}),i.jsx("div",{className:"flex-1 flex items-center justify-center",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto mb-2"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading map data..."})]})})]})});if(n==="interactive"&&!h&&m)return i.jsx(cs,{open:s,onOpenChange:e,children:i.jsxs(is,{className:"max-w-[95vw] max-h-[95vh] overflow-hidden flex flex-col",children:[i.jsxs(Rs,{className:"flex-shrink-0 flex flex-row items-center justify-between",children:[i.jsx(Ds,{className:"text-xl font-bold",children:"Preparing Tactical View..."}),i.jsx(q,{variant:"ghost",size:"sm",onClick:e,className:"h-8 w-8 p-0 hover:bg-gray-100 dark:hover:bg-gray-800",children:i.jsx(Mr,{className:"h-4 w-4"})})]}),i.jsx("div",{className:"flex-1 flex items-center justify-center",children:i.jsxs("div",{className:"text-center",children:[i.jsx(Ss,{className:"animate-spin h-8 w-8 mx-auto mb-2"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Setting up tactical session..."})]})})]})});const y=S=>new Date(S).toLocaleDateString(),w=()=>{o&&o(t)};return i.jsx(cs,{open:s,onOpenChange:e,children:i.jsxs(is,{className:"max-w-[95vw] max-h-[95vh] overflow-hidden flex flex-col",children:[i.jsxs(Rs,{className:"flex-shrink-0 flex flex-row items-center justify-between",children:[i.jsxs(Ds,{className:"text-xl font-bold flex items-center gap-2",children:[i.jsx(jo,{className:"h-5 w-5"}),x.name,i.jsx(ue,{variant:"outline",className:"ml-2",children:n==="detail"?"Detail View":"Tactical Mode"})]}),i.jsx(q,{variant:"ghost",size:"sm",onClick:e,className:"h-8 w-8 p-0 hover:bg-gray-100 dark:hover:bg-gray-800",children:i.jsx(Mr,{className:"h-4 w-4"})})]}),i.jsx("div",{className:"flex-1 overflow-auto",children:n==="detail"?i.jsxs("div",{className:"space-y-6",children:[i.jsxs(oe,{children:[i.jsx(ke,{children:i.jsxs(Ne,{className:"flex items-center gap-2",children:[i.jsx(Ku,{className:"h-4 w-4"}),"Map Preview"]})}),i.jsx(he,{children:i.jsx("div",{className:"flex justify-center",children:i.jsx(WM,{map:x,cellSize:30,showGrid:!0,className:"border-2 border-muted rounded-lg"})})})]}),i.jsxs(oe,{children:[i.jsx(ke,{children:i.jsxs(Ne,{className:"flex items-center gap-2",children:[i.jsx(dk,{className:"h-4 w-4"}),"Map Information"]})}),i.jsx(he,{children:i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(iM,{className:"h-4 w-4 text-muted-foreground"}),i.jsx("span",{className:"font-medium",children:"Dimensions:"}),i.jsxs("span",{children:[x.width,"  ",x.height]})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(jo,{className:"h-4 w-4 text-muted-foreground"}),i.jsx("span",{className:"font-medium",children:"Total Cells:"}),i.jsx("span",{children:x.cells.length})]})]}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Ac,{className:"h-4 w-4 text-muted-foreground"}),i.jsx("span",{className:"font-medium",children:"Created:"}),i.jsx("span",{children:y(x.createdAt)})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Ac,{className:"h-4 w-4 text-muted-foreground"}),i.jsx("span",{className:"font-medium",children:"Updated:"}),i.jsx("span",{children:y(x.updatedAt)})]})]})]})})]}),d&&r&&a&&o&&i.jsx(oe,{children:i.jsx(he,{className:"pt-6",children:i.jsxs("div",{className:"text-center",children:[i.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Ready to run this map in a live session?"}),i.jsxs(q,{onClick:w,className:"flex items-center gap-2",size:"lg",children:[i.jsx(_u,{className:"h-4 w-4"}),"Open in Tactical Mode"]})]})})})]}):i.jsx("div",{className:"h-full",children:h?x.mapType==="nonCombat"?i.jsx(kfe,{instanceId:h,className:"h-full",onMapChange:S=>{f(S)}}):i.jsx(Sfe,{instanceId:h,className:"h-full"}):i.jsx("div",{className:"flex items-center justify-center h-64",children:i.jsxs("div",{className:"text-center",children:[i.jsx(Ss,{className:"animate-spin h-8 w-8 mx-auto mb-2"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading tactical view..."})]})})})})]})})},$O=40,Afe=20,_fe=100,qM=({mapId:s,onMapCreated:e,showHeader:t=!0})=>{const[n,r]=C.useState("inbounds"),[a,o]=C.useState("normal"),[l,c]=C.useState([]),[d,h]=C.useState("#000000"),[f,m]=C.useState(!s),[p,x]=C.useState(""),[g,b]=C.useState(10),[v,y]=C.useState(10),[w,S]=C.useState($O),[j,A]=C.useState("battle"),[k,_]=C.useState(!1),[L,D]=C.useState(null),{user:P,isSignedIn:T}=Wc(),B=Re(re.maps.createMap),R=Re(re.maps.updateMapCells),O=Re(re.maps.deleteMap),I=Fe(re.maps.getMap,s?{mapId:s}:"skip"),U=()=>{const z=[];for(let se=0;se<v;se++)for(let de=0;de<g;de++)z.push({x:de,y:se,state:"inbounds"});return z};C.useEffect(()=>{I&&(x(I.name),b(I.width),y(I.height),m(!1))},[I]);const M=async()=>{if(D(null),!T||!P){D("Please sign in to create a map");return}if(!p.trim()){D("Please enter a map name");return}if(g<=0||v<=0){D("Width and height must be greater than 0");return}if(g>30||v>30){D("Width and height cannot exceed 30");return}_(!0);try{await B({name:p.trim(),width:g,height:v,mapType:j,cells:U(),clerkId:P.id}),m(!1),e&&e()}catch(z){console.error("Failed to create map:",z),D("Failed to create map. Please try again.")}finally{_(!1)}},$=async(z,se)=>{if(!I)return;const de=I.cells.map(ne=>ne.x===z&&ne.y===se?{...ne,state:n,terrain:a,terrainModifier:a==="normal"?0:a==="soft"?-1:a==="rough"?-3:a==="intense"?-5:a==="brutal"?-7:-9,affectedAbilityScores:l,customColor:d!=="#000000"?d:void 0}:ne);try{await R({mapId:I._id,cells:de,clerkId:P==null?void 0:P.id})}catch(ne){console.error("Failed to update cell:",ne)}},W=z=>{S(parseInt(z.target.value))},ee=()=>{S($O)},Z=async z=>{if(!I)return;const se=I.cells.map(de=>z==="reset"?{...de,customColor:void 0}:de.occupant?de:{...de,customColor:z});try{await R({mapId:I._id,cells:se,clerkId:P==null?void 0:P.id})}catch(de){console.error("Failed to update cell colors:",de)}};return f?i.jsxs("div",{className:"p-4",children:[t&&i.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Create New Map"}),L&&i.jsx(ur,{className:"mb-4 border-red-200 bg-red-50 text-red-800",children:i.jsx(hr,{children:L})}),i.jsxs("div",{className:"space-y-4 max-w-md",children:[i.jsxs("div",{children:[i.jsx(st,{htmlFor:"map-name",className:"text-sm font-medium",children:"Map Name *"}),i.jsx(_e,{id:"map-name",type:"text",value:p,onChange:z=>x(z.target.value),placeholder:"Enter map name...",className:"mt-1",required:!0})]}),i.jsxs("div",{children:[i.jsx(st,{htmlFor:"map-type",className:"text-sm font-medium",children:"Map Type *"}),i.jsxs(wt,{value:j,onValueChange:z=>A(z),children:[i.jsx(gt,{id:"map-type",className:"mt-1",children:i.jsx(Ct,{})}),i.jsxs(xt,{children:[i.jsx(Ie,{value:"battle",children:"Battle Map"}),i.jsx(Ie,{value:"nonCombat",children:"Non-Combat Map (Village/Shop/POI)"})]})]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx(st,{htmlFor:"map-width",className:"text-sm font-medium",children:"Width"}),i.jsx(_e,{id:"map-width",type:"number",min:"1",max:"30",value:g,onChange:z=>b(Math.min(30,Math.max(1,parseInt(z.target.value)||1))),className:"mt-1"})]}),i.jsxs("div",{children:[i.jsx(st,{htmlFor:"map-height",className:"text-sm font-medium",children:"Height"}),i.jsx(_e,{id:"map-height",type:"number",min:"1",max:"30",value:v,onChange:z=>y(Math.min(30,Math.max(1,parseInt(z.target.value)||1))),className:"mt-1"})]})]}),i.jsx(q,{onClick:M,disabled:k||!p.trim(),className:"w-full",children:k?"Creating Map...":"Create Map"})]})]}):I?i.jsxs("div",{className:"p-4",children:[i.jsxs("div",{className:"flex justify-between items-center mb-4",children:[i.jsx("h2",{className:"text-2xl font-bold",children:I.name}),i.jsx("div",{className:"space-x-2",children:i.jsx("button",{onClick:()=>O({mapId:I._id,clerkId:P==null?void 0:P.id}),className:"bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600",children:"Delete Map"})})]}),i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-4 mb-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"block text-sm font-medium",children:"Cell State"}),i.jsxs("select",{value:n,onChange:z=>r(z.target.value),className:"form-select w-full",children:[i.jsx("option",{value:"inbounds",children:"Inbounds"}),i.jsx("option",{value:"outbounds",children:"Outbounds"}),i.jsx("option",{value:"occupied",children:"Occupied"})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"block text-sm font-medium",children:"Terrain Type"}),i.jsxs("select",{value:a,onChange:z=>o(z.target.value),className:"form-select w-full",children:[i.jsx("option",{value:"normal",children:"Normal (0)"}),i.jsx("option",{value:"soft",children:"Soft (-1)"}),i.jsx("option",{value:"rough",children:"Rough (-3)"}),i.jsx("option",{value:"intense",children:"Intense (-5)"}),i.jsx("option",{value:"brutal",children:"Brutal (-7)"}),i.jsx("option",{value:"deadly",children:"Deadly (-9)"})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"block text-sm font-medium",children:"Custom Color"}),i.jsx("input",{type:"color",value:d,onChange:z=>h(z.target.value),className:"w-full h-10 rounded border"})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"block text-sm font-medium",children:"Affected Ability Scores"}),i.jsx("div",{className:"grid grid-cols-2 gap-1 text-xs",children:["strength","dexterity","constitution","intelligence","wisdom","charisma"].map(z=>i.jsxs("label",{className:"flex items-center gap-1",children:[i.jsx("input",{type:"checkbox",checked:l.includes(z),onChange:se=>{se.target.checked?c([...l,z]):c(l.filter(de=>de!==z))}}),i.jsx("span",{className:"capitalize",children:z})]},z))})]})]}),i.jsxs("div",{className:"mb-4 flex items-center gap-4",children:[i.jsx("label",{className:"text-sm font-medium",children:"Zoom:"}),i.jsx("input",{type:"range",min:Afe,max:_fe,value:w,onChange:W,className:"w-48"}),i.jsxs("span",{className:"text-sm text-gray-600",children:[w,"px"]}),i.jsx("button",{onClick:ee,className:"text-sm text-blue-500 hover:text-blue-600",children:"Reset"})]}),i.jsx("div",{className:"overflow-auto border rounded-lg bg-white dark:bg-gray-800",children:i.jsx("div",{className:"p-4",children:i.jsx(WM,{map:I,cellSize:w,interactive:!0,onCellClick:$,showTerrainInfo:!0,onBulkColorChange:Z,showBulkColorControls:!0})})})]}):i.jsx("div",{children:"Loading..."})},Tfe=({onMapSelect:s,isSelectMode:e=!1,campaignId:t,interactionId:n,onOpenInteractive:r})=>{const[a,o]=C.useState(null),[l,c]=C.useState(!1),[d,h]=C.useState(!1),f=cw(),m=Fe(re.maps.getUserMaps,f?{}:"skip");if(!f)return i.jsx("div",{className:"flex items-center justify-center py-8",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto mb-2"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading user data..."})]})});if(m===void 0)return i.jsx("div",{className:"flex items-center justify-center py-8",children:i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto mb-2"}),i.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading maps..."})]})});const p=g=>{e&&s?s(g):(o(g),c(!0))},x=()=>{h(!1)};return i.jsxs("div",{className:"p-4",children:[i.jsxs("div",{className:"flex justify-between items-center mb-4",children:[i.jsx("h2",{className:"text-2xl font-bold",children:"Your Maps"}),i.jsx("div",{className:"flex gap-2",children:i.jsxs(q,{onClick:()=>h(!0),className:"flex items-center gap-2",size:"sm",children:[i.jsx(Mt,{className:"w-4 h-4"}),"Create Map"]})})]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:m.map(g=>i.jsx(xfe,{map:g,isSelected:a===g._id,onSelect:p,compact:!1},g._id))}),m.length===0&&i.jsxs("div",{className:"text-center py-8 text-gray-500",children:[i.jsx(jo,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),i.jsx("p",{className:"text-lg font-medium mb-2",children:"No maps created yet"}),i.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Create your first map to get started with tactical gameplay!"}),i.jsxs(q,{onClick:()=>h(!0),className:"flex items-center gap-2",children:[i.jsx(Mt,{className:"w-4 h-4"}),"Create New Map"]})]}),d&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[i.jsxs("div",{className:"flex justify-between items-center mb-4",children:[i.jsx("h2",{className:"text-2xl font-bold",children:"Create New Map"}),i.jsx(q,{variant:"ghost",onClick:()=>h(!1),className:"h-8 w-8 p-0",children:""})]}),i.jsx(qM,{onMapCreated:x,showHeader:!1})]})}),a&&i.jsx(JV,{isOpen:l,onClose:()=>{c(!1),o(null)},mapId:a,mode:"detail",campaignId:t,interactionId:n,onOpenInteractive:r})]})};function Efe(){const{user:s}=Wc(),[e,t]=C.useState(!1),[n,r]=C.useState(null),a=Fe(re.mapMigration.getMigrationStatus),o=Fe(re.mapMigration.getLegacyMaps),l=Re(re.mapMigration.migrateAllMaps),c=Re(re.mapMigration.migrateSingleMap),d=async()=>{if(!s){alert("Please sign in to migrate maps");return}if(confirm(`Migrate ${(a==null?void 0:a.legacyMaps)||0} legacy maps to the new Battle Map system?`)){t(!0),r(null);try{const f=await l({clerkId:s.id});r(f)}catch(f){console.error("Migration failed:",f),alert(`Migration failed: ${f}`)}finally{t(!1)}}},h=async f=>{if(!s){alert("Please sign in to migrate maps");return}t(!0);try{const m=await c({legacyMapId:f,clerkId:s.id});alert(m.message),window.location.reload()}catch(m){console.error("Migration failed:",m),alert(`Migration failed: ${m}`)}finally{t(!1)}};return a?i.jsxs("div",{className:"space-y-6",children:[i.jsxs(oe,{children:[i.jsxs(ke,{children:[i.jsxs(Ne,{className:"flex items-center gap-2",children:[i.jsx(Lu,{className:"w-5 h-5"}),"Map Migration Status"]}),i.jsx(At,{children:"Migrate your legacy maps to the new Battle Map system"})]}),i.jsxs(he,{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[i.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[i.jsx("div",{className:"text-2xl font-bold text-gray-900",children:a.legacyMaps}),i.jsx("div",{className:"text-sm text-gray-600",children:"Legacy Maps"})]}),i.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[i.jsx("div",{className:"text-2xl font-bold text-blue-900",children:a.battleMaps}),i.jsx("div",{className:"text-sm text-blue-600",children:"Battle Maps"})]}),i.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[i.jsx("div",{className:"text-2xl font-bold text-gray-900",children:a.legacyInstances}),i.jsx("div",{className:"text-sm text-gray-600",children:"Legacy Instances"})]}),i.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[i.jsx("div",{className:"text-2xl font-bold text-blue-900",children:a.battleInstances}),i.jsx("div",{className:"text-sm text-blue-600",children:"Battle Instances"})]})]}),a.migrationRecommended&&i.jsxs(ur,{children:[i.jsx(lm,{className:"h-4 w-4"}),i.jsxs(hr,{children:["You have ",a.legacyMaps," legacy map(s) that can be migrated to the new system. Migration preserves all terrain data and tokens."]})]}),!a.migrationRecommended&&i.jsxs(ur,{className:"bg-green-50 border-green-200",children:[i.jsx(sL,{className:"h-4 w-4 text-green-600"}),i.jsx(hr,{className:"text-green-800",children:"All maps have been migrated or you're starting fresh! "})]})]})]}),a.migrationRecommended&&i.jsxs(oe,{children:[i.jsxs(ke,{children:[i.jsx(Ne,{children:"Migration Actions"}),i.jsx(At,{children:"Migrate all maps at once or select individual maps to migrate"})]}),i.jsxs(he,{className:"space-y-4",children:[i.jsxs("div",{className:"flex items-center justify-between p-4 bg-blue-50 rounded-lg",children:[i.jsxs("div",{children:[i.jsx("div",{className:"font-semibold text-blue-900",children:"Migrate All Maps"}),i.jsxs("div",{className:"text-sm text-blue-700",children:["Convert all ",a.legacyMaps," legacy maps to Battle Maps"]})]}),i.jsx(q,{onClick:d,disabled:e,className:"gap-2",children:e?i.jsxs(i.Fragment,{children:[i.jsx(Lu,{className:"w-4 h-4 animate-spin"}),"Migrating..."]}):i.jsxs(i.Fragment,{children:[i.jsx(ik,{className:"w-4 h-4"}),"Migrate All"]})})]}),o&&o.length>0&&i.jsxs("div",{className:"space-y-2",children:[i.jsx("h3",{className:"font-semibold text-sm text-gray-700",children:"Individual Maps"}),o.map(f=>i.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"font-medium",children:f.name}),i.jsxs("div",{className:"text-xs text-gray-600",children:[f.width,"",f.height," (",f.cellCount," cells)"]})]}),i.jsx(q,{variant:"outline",size:"sm",onClick:()=>h(f._id),disabled:e,children:"Migrate"})]},f._id))]})]})]}),n&&i.jsxs(oe,{children:[i.jsx(ke,{children:i.jsx(Ne,{children:"Migration Results"})}),i.jsxs(he,{className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[i.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[i.jsx("div",{className:"text-2xl font-bold",children:n.total}),i.jsx("div",{className:"text-sm text-gray-600",children:"Total"})]}),i.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[i.jsx("div",{className:"text-2xl font-bold text-green-600",children:n.successful}),i.jsx("div",{className:"text-sm text-green-700",children:"Successful"})]}),i.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-lg",children:[i.jsx("div",{className:"text-2xl font-bold text-red-600",children:n.failed}),i.jsx("div",{className:"text-sm text-red-700",children:"Failed"})]})]}),i.jsx("div",{className:"space-y-2",children:n.results.map((f,m)=>{var p,x;return i.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg ${f.success?"bg-green-50":"bg-red-50"}`,children:[f.success?i.jsx(sL,{className:"w-5 h-5 text-green-600 flex-shrink-0"}):i.jsx(E$,{className:"w-5 h-5 text-red-600 flex-shrink-0"}),i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"font-medium",children:f.name}),f.success&&i.jsx("div",{className:"text-sm text-green-700",children:(p=f.result)==null?void 0:p.message}),!f.success&&i.jsxs("div",{className:"text-sm text-red-700",children:["Error: ",f.error]})]}),f.success&&i.jsxs(ue,{variant:"secondary",children:[((x=f.result)==null?void 0:x.migratedInstances)||0," instances"]})]},m)})}),i.jsx(q,{variant:"outline",className:"w-full",onClick:()=>window.location.reload(),children:"Refresh Page"})]})]}),i.jsxs(oe,{children:[i.jsx(ke,{children:i.jsx(Ne,{className:"text-sm",children:"Migration Information"})}),i.jsxs(he,{className:"text-sm text-gray-600 space-y-2",children:[i.jsx("p",{children:i.jsx("strong",{children:"What gets migrated:"})}),i.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-2",children:[i.jsx("li",{children:"Map dimensions and cell data"}),i.jsx("li",{children:"Terrain types and colors"}),i.jsx("li",{children:"Map instances and their positions"}),i.jsx("li",{children:"Entity/token data"}),i.jsx("li",{children:"Ownership and permissions"})]}),i.jsx("p",{className:"mt-4",children:i.jsx("strong",{children:"What changes:"})}),i.jsxs("ul",{className:"list-disc list-inside space-y-1 ml-2",children:[i.jsx("li",{children:'Maps are renamed with "(Migrated)" suffix'}),i.jsx("li",{children:"Entity positions become battle tokens"}),i.jsx("li",{children:"Cell size is auto-calculated for optimal display"})]}),i.jsxs("p",{className:"mt-4 text-yellow-700",children:[i.jsx("strong",{children:"Note:"})," Legacy maps are not deleted during migration. They remain accessible until you manually remove them."]})]})]})]}):i.jsx("div",{children:"Loading migration status..."})}const Pfe=()=>{const{user:s}=Wc(),e=Wj(),[t,n]=C.useState(!1),[r,a]=C.useState("battle");if(!s)return i.jsxs("div",{className:"container mx-auto py-6",children:[i.jsx("h1",{className:"text-3xl font-bold mb-4",children:"Maps"}),i.jsx("p",{children:"Please sign in to access maps."})]});const o=()=>{n(!1)};return i.jsxs("div",{className:"container mx-auto py-6",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[i.jsx(jo,{className:"w-8 h-8"}),"Maps"]}),i.jsx("div",{className:"flex gap-2",children:i.jsxs(q,{onClick:()=>e({to:"/battle-map"}),className:"flex items-center gap-2",variant:"default",children:[i.jsx(En,{className:"w-4 h-4"}),"Go to Battle Map"]})})]}),i.jsx(oe,{className:"mb-6 bg-blue-50 border-blue-200",children:i.jsx(he,{className:"pt-6",children:i.jsxs("div",{className:"flex items-start gap-4",children:[i.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:i.jsx(En,{className:"w-6 h-6 text-blue-600"})}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h3",{className:"font-semibold text-blue-900 mb-1",children:"Battle Map System Now Available!"}),i.jsx("p",{className:"text-sm text-blue-700 mb-3",children:"The new Battle Map system includes enhanced token management, HP tracking, measurement tools, AoE templates, and movement preview. Perfect for tactical combat!"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(q,{size:"sm",onClick:()=>e({to:"/battle-map"}),className:"gap-2",children:[i.jsx(ik,{className:"w-4 h-4"}),"Try Battle Map"]}),i.jsxs(q,{size:"sm",variant:"outline",onClick:()=>a("migrate"),className:"gap-2",children:[i.jsx(Lu,{className:"w-4 h-4"}),"Migrate Legacy Maps"]})]})]})]})})}),i.jsxs(Qn,{value:r,onValueChange:a,children:[i.jsxs(In,{className:"grid w-full grid-cols-3 mb-6",children:[i.jsxs(Be,{value:"battle",className:"gap-2",children:[i.jsx(En,{className:"w-4 h-4"}),"Battle Maps",i.jsx(ue,{variant:"secondary",className:"ml-2",children:"New!"})]}),i.jsxs(Be,{value:"legacy",className:"gap-2",children:[i.jsx(jo,{className:"w-4 h-4"}),"Legacy Maps"]}),i.jsxs(Be,{value:"migrate",className:"gap-2",children:[i.jsx(Lu,{className:"w-4 h-4"}),"Migration"]})]}),i.jsx($e,{value:"battle",children:i.jsxs(oe,{children:[i.jsxs(ke,{children:[i.jsx(Ne,{children:"Battle Maps"}),i.jsx(At,{children:"Enhanced tactical maps with tokens, HP tracking, and advanced features"})]}),i.jsx(he,{children:i.jsxs("div",{className:"text-center py-8",children:[i.jsx(En,{className:"w-16 h-16 mx-auto text-gray-400 mb-4"}),i.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Battle Maps are in their own page!"}),i.jsx("p",{className:"text-gray-600 mb-4",children:"Navigate to the Battle Map page to create and manage your tactical maps."}),i.jsx(q,{onClick:()=>e({to:"/battle-map"}),children:"Go to Battle Map"})]})})]})}),i.jsx($e,{value:"legacy",children:i.jsxs(oe,{children:[i.jsxs(ke,{children:[i.jsxs(Ne,{className:"flex items-center justify-between",children:["Legacy Maps",i.jsxs(q,{onClick:()=>n(!0),size:"sm",variant:"outline",className:"gap-2",children:[i.jsx(Mt,{className:"w-4 h-4"}),"Create Legacy Map"]})]}),i.jsx(At,{children:"Original map system - consider migrating to Battle Maps for enhanced features"})]}),i.jsx(he,{children:i.jsx(Tfe,{isSelectMode:!1})})]})}),i.jsx($e,{value:"migrate",children:i.jsx(Efe,{})})]}),t&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[i.jsxs("div",{className:"flex justify-between items-center mb-4",children:[i.jsx("h2",{className:"text-2xl font-bold",children:"Create New Legacy Map"}),i.jsx(q,{variant:"ghost",onClick:()=>n(!1),className:"h-8 w-8 p-0",children:""})]}),i.jsx(qM,{onMapCreated:o,showHeader:!1})]})})]})};function Mfe({interactionId:s,onError:e,onConnectionChange:t}){const{user:n}=Wc(),{getToken:r}=Ji(),[a,o]=C.useState(null),[l,c]=C.useState("connecting"),[d,h]=C.useState(!1),[f,m]=C.useState(null),[p,x]=C.useState(90),[g,b]=C.useState(new Map),v=C.useRef(null),y=Fe(re.liveSystemAPI.getCompleteRoomState,{interactionId:s}),w=Re(re.liveSystemAPI.quickJoinRoom),S=Re(re.liveSystemAPI.leaveLiveRoom),j=Re(re.liveSystemAPI.submitTurnAction),A=Re(re.liveSystemAPI.skipTurn),k=Re(re.liveSystemAPI.sendChatMessage),_=Re(re.liveSystemAPI.pauseLiveRoom),L=Re(re.liveSystemAPI.resumeLiveRoom),D=Re(re.liveSystemAPI.rollInitiative);C.useEffect(()=>{var ne,H;if(y!=null&&y.room){const Y={interactionId:s,status:y.room.status,initiativeOrder:y.room.gameState.initiativeOrder,currentTurnIndex:y.room.gameState.currentTurnIndex,roundNumber:y.room.gameState.roundNumber,participants:y.room.participants.reduce((ae,ce)=>(ae[ce.entityId]={entityId:ce.entityId,entityType:ce.entityType,userId:ce.userId,currentHP:ce.currentHP||100,maxHP:ce.maxHP||100,position:ce.position||{x:0,y:0},conditions:ce.conditions||[],inventory:ce.inventory||{items:[],equippedItems:{},capacity:20},availableActions:ce.availableActions||[],turnStatus:ce.turnStatus},ae),{}),mapState:y.map||{width:20,height:20,entities:{},obstacles:[],terrain:[]},turnHistory:y.room.gameState.turnHistory||[],chatLog:((H=(ne=y.chat)==null?void 0:ne.messages)==null?void 0:H.map(ae=>({id:ae.messageId,userId:ae.userId,entityId:ae.entityId,content:ae.content,type:ae.channel,recipients:ae.recipients,timestamp:ae.timestamp})))||[],timestamp:new Date(y.timestamp)};o(Y),c("connected"),t==null||t("connected"),m(null)}else y===null&&(c("disconnected"),t==null||t("disconnected"))},[y,s,t]);const P=a!=null&&a.participants?Object.values(a.participants).find(ne=>ne.userId===(n==null?void 0:n.id)):null,T=(a==null?void 0:a.initiativeOrder[a.currentTurnIndex])||null,B=(T==null?void 0:T.userId)===(n==null?void 0:n.id);C.useEffect(()=>{y===void 0&&(c("connecting"),t==null||t("connecting"))},[y,t]);const R=C.useCallback(ne=>{console.error("Live interaction error:",ne),m(ne),e==null||e(ne)},[e]);C.useEffect(()=>{if(!B||(a==null?void 0:a.status)!=="active"){v.current&&(clearTimeout(v.current),v.current=null);return}return x(90),(()=>{v.current=setInterval(()=>{x(H=>H<=1?(W(),90):H-1)},1e3)})(),()=>{v.current&&(clearInterval(v.current),v.current=null)}},[B,a==null?void 0:a.status]);const O=C.useCallback((ne,H)=>{b(Y=>new Map(Y.set(ne,H))),o(Y=>Y?H(Y):null)},[]),I=C.useCallback((ne,H)=>{b(Y=>{const ae=new Map(Y);return ae.delete(ne),ae}),H&&o(H)},[]),U=C.useCallback(async()=>{if(!(n!=null&&n.id))throw new Error("User not authenticated");h(!0);try{const ne=`char_${n.id}`;(await w({interactionId:s,entityId:ne,entityType:"playerCharacter"})).success&&(c("connected"),t==null||t("connected"))}catch(ne){const H=ne instanceof Error?ne:new Error("Failed to join room");R(H)}finally{h(!1)}},[n==null?void 0:n.id,s,w,t,R]),M=C.useCallback(async()=>{if(n!=null&&n.id){h(!0);try{await S({interactionId:s,entityId:`char_${n.id}`}),c("disconnected"),t==null||t("disconnected")}catch(ne){const H=ne instanceof Error?ne:new Error("Failed to leave room");R(H)}finally{h(!1)}}},[s,S,n==null?void 0:n.id,t,R]),$=C.useCallback(async ne=>{if(!P||!B)return;const H=`turn_${Date.now()}`;h(!0);try{if(O(H,ae=>({...ae,currentTurnIndex:(ae.currentTurnIndex+1)%ae.initiativeOrder.length,turnHistory:[...ae.turnHistory,{entityId:ne.entityId,turnNumber:ae.turnHistory.length+1,roundNumber:ae.roundNumber,actions:[ne],startTime:new Date,endTime:new Date,status:"completed"}]})),(await j({interactionId:s,actionType:ne.type,actionData:{target:ne.target,position:ne.position,itemId:ne.itemId,spellId:ne.spellId,actionId:ne.actionId,parameters:ne.parameters}})).success)I(H),x(90);else throw I(H),new Error("Turn action failed")}catch(Y){I(H);const ae=Y instanceof Error?Y:new Error("Failed to take turn");R(ae)}finally{h(!1)}},[P,B,s,j,O,I,R]),W=C.useCallback(async()=>{if(!B)return;const ne=`skip_${Date.now()}`;h(!0);try{if(O(ne,Y=>({...Y,currentTurnIndex:(Y.currentTurnIndex+1)%Y.initiativeOrder.length})),(await A({interactionId:s,reason:"Manual skip"})).success)I(ne),x(90);else throw I(ne),new Error("Failed to skip turn")}catch(H){I(ne);const Y=H instanceof Error?H:new Error("Failed to skip turn");R(Y)}finally{h(!1)}},[B,s,A,O,I,R]),ee=C.useCallback(async ne=>{if(!(n!=null&&n.id))return;const H=`chat_${Date.now()}`;h(!0);try{const Y={...ne,id:`temp-${Date.now()}`,timestamp:Date.now()};if(O(H,ce=>({...ce,chatLog:[...ce.chatLog,Y]})),(await k({interactionId:s,content:ne.content,channel:ne.type,recipients:ne.recipients,entityId:ne.entityId})).success)I(H);else throw I(H),new Error("Failed to send message")}catch(Y){I(H);const ae=Y instanceof Error?Y:new Error("Failed to send message");R(ae)}finally{h(!1)}},[s,n==null?void 0:n.id,k,O,I,R]),Z=C.useCallback(async()=>{const ne=`pause_${Date.now()}`;h(!0);try{if(O(ne,Y=>({...Y,status:"paused"})),(await _({interactionId:s,reason:"Manual pause"})).success)I(ne);else throw I(ne),new Error("Failed to pause interaction")}catch(H){I(ne);const Y=H instanceof Error?H:new Error("Failed to pause interaction");R(Y)}finally{h(!1)}},[s,_,O,I,R]),z=C.useCallback(async()=>{const ne=`resume_${Date.now()}`;h(!0);try{if(O(ne,Y=>({...Y,status:"active"})),(await L({interactionId:s})).success)I(ne);else throw I(ne),new Error("Failed to resume interaction")}catch(H){I(ne);const Y=H instanceof Error?H:new Error("Failed to resume interaction");R(Y)}finally{h(!1)}},[s,L,O,I,R]),se=C.useCallback(async(ne,H)=>{h(!0);try{throw console.log("Rollback requested but not yet implemented in Convex system:",{targetTurn:ne,targetRound:H}),new Error("Rollback feature not yet implemented")}catch(Y){const ae=Y instanceof Error?Y:new Error("Failed to rollback turn");R(ae)}finally{h(!1)}},[R]),de=C.useCallback(async ne=>{const H=`initiative_${Date.now()}`;h(!0);try{if(O(H,ae=>({...ae,initiativeOrder:ne,currentTurnIndex:0})),(await D({interactionId:s,initiativeData:ne.map(ae=>({entityId:ae.entityId,initiative:ae.initiative}))})).success)I(H);else throw I(H),new Error("Failed to update initiative")}catch(Y){I(H);const ae=Y instanceof Error?Y:new Error("Failed to update initiative");R(ae)}finally{h(!1)}},[s,D,O,I,R]);return C.useEffect(()=>()=>{v.current&&(clearInterval(v.current),v.current=null)},[]),{gameState:a,connectionStatus:l,isLoading:d,error:f,currentParticipant:P,currentTurnParticipant:T,isMyTurn:B,turnTimeRemaining:p,joinRoom:U,leaveRoom:M,takeTurn:$,skipTurn:W,sendChatMessage:ee,pauseInteraction:Z,resumeInteraction:z,rollbackTurn:se,updateInitiative:de}}function e8({open:s,onOpenChange:e,interactionId:t,currentUserId:n,isDM:r}){const[a,o]=C.useState(null),[l,c]=C.useState(null),[d,h]=C.useState(null),[f,m]=C.useState(""),[p,x]=C.useState("party"),[g,b]=C.useState([]),[v,y]=C.useState("1d20"),[w,S]=C.useState(0),[j,A]=C.useState(!1),[k,_]=C.useState(!1),[L,D]=C.useState(null),{gameState:P,connectionStatus:T,isLoading:B,currentParticipant:R,currentTurnParticipant:O,isMyTurn:I,turnTimeRemaining:U,joinRoom:M,takeTurn:$,skipTurn:W,sendChatMessage:ee,pauseInteraction:Z,resumeInteraction:z,rollbackTurn:se}=Mfe({interactionId:t,onError:J=>{console.error("Live interaction error:",J),b([J.message])},onConnectionChange:J=>{console.log("Connection status changed:",J)}});V.useEffect(()=>{s&&T==="connecting"&&M()},[s,T,M]);const de=C.useCallback(J=>{o(J),c(null),b([])},[]),ne=C.useCallback(async()=>{if(!(!a||!R)){b([]);try{const J={type:a.type,entityId:R.entityId,target:l||void 0,actionId:a.id};if(a.type==="attack"&&!l){b(["Please select a target for your attack"]);return}await $(J),o(null),c(null)}catch{b(["Failed to submit action. Please try again."])}}},[a,R,l,$]),H=C.useCallback(async()=>{try{await W(),o(null),c(null)}catch{b(["Failed to skip turn. Please try again."])}},[W]),Y=C.useCallback(async()=>{if(f.trim())try{await ee({userId:n,content:f,type:p}),m("")}catch{b(["Failed to send message. Please try again."])}},[f,p,n,ee]),ae=C.useCallback((J,K=1,be=0)=>{const Me=Array.from({length:K},()=>Math.floor(Math.random()*J)+1),De=Me.reduce((et,G)=>et+G,0)+be,_t=`${K}d${J}${be>0?`+${be}`:be<0?be:""}`;return{rolls:Me,total:De,formula:_t}},[]),ce=C.useCallback(async()=>{try{const J=/^(\d+)d(\d+)([+-]\d+)?$/i,K=v.match(J);if(!K){b(['Invalid dice notation. Use format like "1d20", "2d6+3", etc.']);return}const be=parseInt(K[1]),Me=parseInt(K[2]),De=K[3]?parseInt(K[3]):w,_t=ae(Me,be,De),et=` **Dice Roll:** ${_t.formula} = [${_t.rolls.join(", ")}]${De!==0?` ${De>0?"+":""}${De}`:""} = **${_t.total}**`;await ee({userId:n,content:et,type:p}),A(!1),y("1d20"),S(0)}catch{b(["Failed to roll dice. Please try again."])}},[v,w,p,n,ee,ae]),Ue=()=>i.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[i.jsx("div",{className:Ee("w-2 h-2 rounded-full",T==="connected"?"bg-green-500":T==="connecting"?"bg-yellow-500":"bg-red-500")}),i.jsx("span",{className:"text-sm text-muted-foreground",children:T==="connected"?"Connected":T==="connecting"?"Connecting...":"Disconnected"})]}),te=()=>i.jsxs(oe,{children:[i.jsx(ke,{children:i.jsxs(Ne,{className:"flex items-center gap-2",children:[i.jsx(Cs,{className:"w-4 h-4","aria-hidden":"true"}),"Initiative Order - Round ",P==null?void 0:P.roundNumber]})}),i.jsx(he,{children:i.jsx("div",{className:"space-y-2",role:"list","aria-label":`Initiative order for round ${P==null?void 0:P.roundNumber}`,children:P==null?void 0:P.initiativeOrder.map((J,K)=>{const be=P.participants[J.entityId],Me=K===P.currentTurnIndex,De=J.userId===n;return i.jsxs("div",{role:"listitem",className:Ee("flex items-center justify-between p-3 rounded-lg border",Me&&"bg-primary/10 border-primary",De&&"ring-2 ring-blue-500/20"),"aria-current":Me?"true":void 0,"aria-label":`${J.entityId}${De?" (you)":""}, initiative ${J.initiative}${Me?", current turn":""}`,children:[i.jsxs("div",{className:"flex items-center gap-3",children:[Me&&i.jsx(_u,{className:"w-4 h-4 text-primary","aria-hidden":"true",title:"Current turn"}),i.jsxs("div",{children:[i.jsxs("div",{className:"font-medium",children:[J.entityId," ",De&&"(You)"]}),i.jsxs("div",{className:"text-sm text-muted-foreground",children:["Initiative: ",J.initiative]})]})]}),be&&i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(nM,{className:"w-4 h-4 text-red-500"}),i.jsxs("span",{className:"text-sm",children:[be.currentHP,"/",be.maxHP]})]}),be.conditions.length>0&&i.jsx("div",{className:"flex gap-1",children:be.conditions.map(_t=>i.jsx(ue,{variant:"secondary",className:"text-xs",children:_t.name},_t.id))}),i.jsx(ue,{variant:be.turnStatus==="active"?"default":be.turnStatus==="completed"?"secondary":be.turnStatus==="skipped"?"destructive":"outline",children:be.turnStatus})]})]},J.entityId)})})})]});return s?i.jsxs(cs,{open:s,onOpenChange:e,children:[i.jsxs(is,{className:"max-w-7xl max-h-[95vh] overflow-hidden flex flex-col","aria-describedby":"live-interaction-description",children:[i.jsxs(Rs,{children:[i.jsxs(Ds,{className:"flex items-center justify-between",children:[i.jsx("span",{children:"Live Interaction"}),Ue()]}),i.jsx("div",{id:"live-interaction-description",className:"sr-only",children:"Real-time D&D interaction interface with turn-based gameplay, chat, and map view"})]}),T==="connecting"&&i.jsx("div",{className:"flex items-center justify-center py-12",role:"status","aria-live":"polite",children:i.jsxs("div",{className:"text-center",children:[i.jsx(Ss,{className:"w-8 h-8 animate-spin mx-auto mb-4","aria-hidden":"true"}),i.jsx("p",{children:"Connecting to live session..."})]})}),T==="connected"&&P&&i.jsx("div",{className:"flex-1 overflow-hidden",children:i.jsxs(Qn,{defaultValue:"game",className:"h-full flex flex-col",children:[i.jsxs(In,{className:"grid w-full grid-cols-4",role:"tablist","aria-label":"Live interaction sections",children:[i.jsx(Be,{value:"game",role:"tab","aria-controls":"game-panel",children:"Game"}),i.jsx(Be,{value:"inventory",role:"tab","aria-controls":"inventory-panel",children:"Inventory"}),i.jsx(Be,{value:"chat",role:"tab","aria-controls":"chat-panel",children:"Chat"}),r&&i.jsx(Be,{value:"dm",role:"tab","aria-controls":"dm-panel",children:"DM Controls"})]}),i.jsx($e,{value:"game",className:"flex-1 overflow-hidden",role:"tabpanel",id:"game-panel","aria-labelledby":"game-tab",children:i.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 h-full",children:[i.jsxs("div",{className:"lg:col-span-2 space-y-4",children:[te(),I&&R&&i.jsxs(oe,{children:[i.jsx(ke,{children:i.jsxs(Ne,{className:"flex items-center justify-between",children:[i.jsxs("span",{className:"flex items-center gap-2",children:[i.jsx(Ra,{className:"w-4 h-4","aria-hidden":"true"}),"Your Turn"]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(rk,{value:U/90*100,className:"w-24","aria-label":`Turn timer: ${Math.floor(U/60)} minutes ${U%60} seconds remaining`}),i.jsxs("span",{className:"text-sm font-mono","aria-live":"polite","aria-label":`${Math.floor(U/60)} minutes ${U%60} seconds remaining`,children:[Math.floor(U/60),":",(U%60).toString().padStart(2,"0")]})]})]})}),i.jsxs(he,{children:[g.length>0&&i.jsxs("div",{className:"mb-4 p-3 bg-destructive/10 border border-destructive/20 rounded-lg",role:"alert","aria-live":"assertive",children:[i.jsxs("div",{className:"flex items-center gap-2 text-destructive",children:[i.jsx(lm,{className:"w-4 h-4","aria-hidden":"true"}),i.jsx("span",{className:"font-medium",children:"Validation Errors:"})]}),i.jsx("ul",{className:"mt-2 text-sm text-destructive",role:"list",children:g.map((J,K)=>i.jsxs("li",{role:"listitem",children:[" ",J]},K))})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("h4",{className:"font-medium mb-2",children:"Available Actions"}),i.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",role:"group","aria-label":"Available actions for your turn",children:R.availableActions.map(J=>i.jsxs(q,{variant:(a==null?void 0:a.id)===J.id?"default":"outline",disabled:!J.available,onClick:()=>de(J),className:"flex items-center gap-2","aria-pressed":(a==null?void 0:a.id)===J.id,"aria-describedby":`action-${J.id}-desc`,children:[J.type==="attack"&&i.jsx(En,{className:"w-4 h-4","aria-hidden":"true"}),J.type==="move"&&i.jsx(oL,{className:"w-4 h-4","aria-hidden":"true"}),J.type==="useItem"&&i.jsx(Dr,{className:"w-4 h-4","aria-hidden":"true"}),J.name,i.jsxs("span",{id:`action-${J.id}-desc`,className:"sr-only",children:[J.type," action",J.available?"":", currently unavailable"]})]},J.id))})]}),a&&a.type==="attack"&&i.jsxs("div",{children:[i.jsx("h4",{className:"font-medium mb-2",children:"Select Target"}),i.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.values(P.participants).filter(J=>J.entityId!==R.entityId&&J.currentHP>0).map(J=>i.jsxs(q,{variant:l===J.entityId?"default":"outline",onClick:()=>c(J.entityId),children:[J.entityId," (",J.currentHP,"/",J.maxHP," HP)"]},J.entityId))})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsxs(q,{onClick:ne,disabled:!a||B,className:"flex items-center gap-2",children:[B?i.jsx(Ss,{className:"w-4 h-4 animate-spin"}):i.jsx(Yi,{className:"w-4 h-4"}),"Submit Action"]}),i.jsxs(q,{variant:"outline",onClick:H,className:"flex items-center gap-2",children:[i.jsx(oL,{className:"w-4 h-4"}),"Skip Turn"]})]})]})]})]}),!I&&i.jsx(oe,{children:i.jsx(he,{className:"py-6",children:i.jsxs("div",{className:"text-center text-muted-foreground",children:[i.jsx(Ra,{className:"w-8 h-8 mx-auto mb-2"}),i.jsxs("p",{children:["Waiting for ",O==null?void 0:O.entityId,"'s turn..."]})]})})})]}),i.jsx("div",{children:i.jsxs(oe,{className:"h-full",children:[i.jsx(ke,{children:i.jsxs(Ne,{className:"flex items-center justify-between",children:[i.jsx("span",{children:"Battle Map"}),i.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[i.jsxs("span",{children:["Round ",P==null?void 0:P.roundNumber]}),(P==null?void 0:P.status)==="active"&&i.jsx(ue,{variant:"default",className:"animate-pulse",children:"Live"}),r&&i.jsxs(q,{variant:"outline",size:"sm",onClick:()=>{D("placeholder-map-id"),_(!0)},className:"flex items-center gap-2",children:[i.jsx(jo,{className:"h-4 w-4"}),"Open Tactical View"]})]})]})}),i.jsx(he,{children:P!=null&&P.mapState?i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"aspect-square bg-muted rounded-lg border-2 border-dashed border-muted-foreground/20 flex items-center justify-center relative overflow-hidden",children:[i.jsx("div",{className:"grid gap-0 w-full h-full",style:{gridTemplateColumns:`repeat(${Math.min(P.mapState.width,10)}, 1fr)`,gridTemplateRows:`repeat(${Math.min(P.mapState.height,10)}, 1fr)`},children:Array.from({length:Math.min(P.mapState.width*P.mapState.height,100)}).map((J,K)=>{const be=K%Math.min(P.mapState.width,10),Me=Math.floor(K/Math.min(P.mapState.width,10)),De=Object.values(P.mapState.entities).find(et=>et.position.x===be&&et.position.y===Me),_t=P.mapState.obstacles.some(et=>et.x===be&&et.y===Me);return i.jsxs("div",{className:Ee("border border-muted-foreground/10 flex items-center justify-center text-xs font-bold relative",_t&&"bg-stone-600",De&&"bg-blue-500 text-white"),title:De?`${De.entityId} at (${be}, ${Me})`:`(${be}, ${Me})`,children:[De&&De.entityId.charAt(0).toUpperCase(),_t&&""]},K)})}),i.jsxs("div",{className:"absolute bottom-2 left-2 bg-background/90 rounded p-2 text-xs",children:[i.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[i.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded"}),i.jsx("span",{children:"Entities"})]}),i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx("div",{className:"w-3 h-3 bg-stone-600 rounded"}),i.jsx("span",{children:"Obstacles"})]})]})]}),i.jsxs("div",{className:"text-sm",children:[i.jsx("h5",{className:"font-medium mb-2",children:"Entity Positions"}),i.jsx("div",{className:"space-y-1 max-h-24 overflow-y-auto",children:Object.values(P.mapState.entities).map(J=>i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsx("span",{className:"truncate",children:J.entityId}),i.jsxs("span",{className:"text-muted-foreground",children:["(",J.position.x,", ",J.position.y,")"]})]},J.entityId))})]})]}):i.jsx("div",{className:"aspect-square bg-muted rounded-lg flex items-center justify-center",children:i.jsx("p",{className:"text-muted-foreground",children:"No map data available"})})})]})})]})}),i.jsx($e,{value:"inventory",className:"flex-1 overflow-auto",children:R&&i.jsxs(oe,{children:[i.jsx(ke,{children:i.jsx(Ne,{children:"Inventory"})}),i.jsx(he,{children:i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("h4",{className:"font-medium mb-2",children:"Items"}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:R.inventory.items.map(J=>i.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",children:J.itemId}),i.jsxs("div",{className:"text-sm text-muted-foreground",children:["Qty: ",J.quantity]})]}),i.jsx(q,{size:"sm",variant:"outline",children:"Use"})]},J.id))})]}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-medium mb-2",children:"Equipped Items"}),i.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(R.inventory.equippedItems).map(([J,K])=>i.jsxs("div",{className:"p-3 border rounded-lg",children:[i.jsx("div",{className:"text-sm text-muted-foreground capitalize",children:J}),i.jsx("div",{className:"font-medium",children:K})]},J))})]})]})})]})}),i.jsx($e,{value:"chat",className:"flex-1 overflow-hidden",role:"tabpanel",id:"chat-panel","aria-labelledby":"chat-tab",children:i.jsxs(oe,{className:"h-full flex flex-col",children:[i.jsx(ke,{children:i.jsxs(Ne,{className:"flex items-center gap-2",children:[i.jsx(kne,{className:"w-4 h-4","aria-hidden":"true"}),"Chat"]})}),i.jsxs(he,{className:"flex-1 flex flex-col",children:[i.jsx("div",{className:"flex-1 overflow-auto mb-4 space-y-2",role:"log","aria-live":"polite","aria-label":"Chat messages",children:P.chatLog.map(J=>i.jsxs("div",{className:Ee("p-2 rounded-lg",J.type==="system"&&"bg-muted text-muted-foreground text-center",J.userId===n&&"bg-primary/10 ml-8",J.userId!==n&&J.type!=="system"&&"bg-muted mr-8"),role:J.type==="system"?"status":"article","aria-label":J.type==="system"?`System message: ${J.content}`:`Message from ${J.userId} at ${new Date(J.timestamp).toLocaleTimeString()}: ${J.content}`,children:[J.type!=="system"&&i.jsxs("div",{className:"text-xs text-muted-foreground mb-1",children:[J.userId,"  ",new Date(J.timestamp).toLocaleTimeString()]}),i.jsx("div",{children:J.content})]},J.id))}),i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex gap-2",role:"radiogroup","aria-label":"Chat channel selection",children:[i.jsxs(q,{size:"sm",variant:p==="party"?"default":"outline",onClick:()=>x("party"),role:"radio","aria-checked":p==="party","aria-describedby":"party-channel-desc",children:["Party",i.jsx("span",{id:"party-channel-desc",className:"sr-only",children:"Send message to all party members"})]}),i.jsxs(q,{size:"sm",variant:p==="dm"?"default":"outline",onClick:()=>x("dm"),role:"radio","aria-checked":p==="dm","aria-describedby":"dm-channel-desc",children:["DM",i.jsx("span",{id:"dm-channel-desc",className:"sr-only",children:"Send private message to Dungeon Master"})]}),i.jsxs(q,{size:"sm",variant:p==="private"?"default":"outline",onClick:()=>x("private"),role:"radio","aria-checked":p==="private","aria-describedby":"private-channel-desc",children:["Private",i.jsx("span",{id:"private-channel-desc",className:"sr-only",children:"Send private message to selected player"})]})]}),j&&i.jsxs("div",{className:"p-3 border rounded-lg bg-muted/50",children:[i.jsx("h4",{className:"font-medium mb-2",children:" Roll Dice"}),i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex gap-2",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("label",{htmlFor:"dice-notation",className:"block text-sm font-medium mb-1",children:"Dice Notation"}),i.jsx("input",{id:"dice-notation",type:"text",value:v,onChange:J=>y(J.target.value),placeholder:"1d20, 2d6+3, etc.",className:"w-full px-3 py-2 border rounded-md"})]}),i.jsxs("div",{className:"w-24",children:[i.jsx("label",{htmlFor:"dice-modifier",className:"block text-sm font-medium mb-1",children:"Modifier"}),i.jsx("input",{id:"dice-modifier",type:"number",value:w,onChange:J=>S(parseInt(J.target.value)||0),className:"w-full px-3 py-2 border rounded-md"})]})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(q,{size:"sm",onClick:ce,className:"flex items-center gap-2",children:" Roll"}),i.jsx(q,{size:"sm",variant:"outline",onClick:()=>A(!1),children:"Cancel"})]}),i.jsx("div",{className:"flex gap-1 flex-wrap",children:["1d4","1d6","1d8","1d10","1d12","1d20","2d6","3d6"].map(J=>i.jsx(q,{size:"sm",variant:"outline",onClick:()=>y(J),className:"text-xs",children:J},J))})]})]}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx("label",{htmlFor:"chat-input",className:"sr-only",children:"Chat message"}),i.jsx("input",{id:"chat-input",type:"text",value:f,onChange:J=>m(J.target.value),onKeyPress:J=>{J.key==="Enter"&&!J.shiftKey&&(J.preventDefault(),Y())},placeholder:`Message ${p}...`,className:"flex-1 px-3 py-2 border rounded-md","aria-describedby":"chat-input-help"}),i.jsx("span",{id:"chat-input-help",className:"sr-only",children:"Press Enter to send message, Shift+Enter for new line"}),i.jsx(q,{size:"sm",variant:"outline",onClick:()=>A(!j),className:"flex items-center gap-1",title:"Roll dice",children:""}),i.jsxs(q,{onClick:Y,disabled:!f.trim(),"aria-describedby":"send-button-desc",children:["Send",i.jsxs("span",{id:"send-button-desc",className:"sr-only",children:["Send message to ",p," channel"]})]})]})]})]})]})}),r&&i.jsx($e,{value:"dm",className:"flex-1 overflow-auto",children:i.jsxs(oe,{children:[i.jsx(ke,{children:i.jsxs(Ne,{className:"flex items-center gap-2",children:[i.jsx(dk,{className:"w-4 h-4"}),"DM Controls"]})}),i.jsx(he,{children:i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("h4",{className:"font-medium mb-2",children:"Session Controls"}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(q,{variant:"outline",onClick:()=>(P==null?void 0:P.status)==="active"?Z():z(),disabled:B,children:(P==null?void 0:P.status)==="active"?i.jsxs(i.Fragment,{children:[i.jsx(eT,{className:"w-4 h-4 mr-2"}),"Pause Session"]}):i.jsxs(i.Fragment,{children:[i.jsx(_u,{className:"w-4 h-4 mr-2"}),"Resume Session"]})}),i.jsxs(q,{variant:"outline",onClick:()=>se(1,(P==null?void 0:P.roundNumber)||1),disabled:B,children:[i.jsx(ck,{className:"w-4 h-4 mr-2"}),"Rollback Turn"]})]})]}),i.jsxs("div",{children:[i.jsx("h4",{className:"font-medium mb-2",children:"Initiative Management"}),i.jsx("div",{className:"space-y-2",children:P.initiativeOrder.map((J,K)=>i.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[i.jsxs("span",{children:[J.entityId," (Init: ",J.initiative,")"]}),i.jsxs("div",{className:"flex gap-1",children:[i.jsx(q,{size:"sm",variant:"outline",children:"Skip"}),i.jsx(q,{size:"sm",variant:"outline",children:"Edit"})]})]},J.entityId))})]})]})})]})})]})})]}),L&&i.jsx(JV,{isOpen:k,onClose:()=>{_(!1),D(null)},mapId:L,mode:"interactive",campaignId:void 0,interactionId:t})]}):null}function Ife(){var P,T,B;const{userId:s,isLoaded:e}=Ji(),{isAuthenticated:t,isLoading:n}=sw(),[r,a]=C.useState(null),[o,l]=C.useState(!1),[c]=C.useState(),[d,h]=C.useState(!1),[f,m]=C.useState(null);C.useEffect(()=>{const R=I=>{var U,M;console.error("InteractionsPage Error:",I.error),I.error&&!((U=I.error.message)!=null&&U.includes("authentication"))&&!((M=I.error.message)!=null&&M.includes("Not authenticated"))&&m(I.error)},O=I=>{var U,M;console.error("InteractionsPage Promise Rejection:",I.reason),!(I.reason&&((U=I.reason.message)!=null&&U.includes("Not authenticated")||(M=I.reason.message)!=null&&M.includes("Unauthenticated")||I.reason.code==="Unauthenticated"))&&m(I.reason)};return window.addEventListener("error",R),window.addEventListener("unhandledrejection",O),()=>{window.removeEventListener("error",R),window.removeEventListener("unhandledrejection",O)}},[]);const p=Fe(re.interactions.getAllInteractionsWithLiveStatus,t&&e?{campaignId:c}:"skip"),x=Re(re.interactions.updateInteractionStatus),g=Re(re.liveSystemAPI.quickJoinRoom),b=Re(re.liveSystemAPI.pauseLiveRoom),v=Re(re.liveSystemAPI.resumeLiveRoom),y=Fe(re.liveSystemAPI.getComprehensiveSystemHealth,t&&e?{}:"skip"),w=y===null?new Error("System health unavailable"):null;C.useEffect(()=>{const R=setInterval(()=>{h(!0),setTimeout(()=>h(!1),1e3)},3e4);return()=>clearInterval(R)},[]);const S=async R=>{try{(await g({interactionId:R,entityId:`character-${s}`,entityType:"playerCharacter"})).success&&(a(R),l(!0))}catch(O){console.error("Failed to join interaction:",O)}},j=async(R,O)=>{try{O==="live"?await x({interactionId:R,status:O}):O==="paused"?(await b({interactionId:R,reason:"DM paused interaction"}),await x({interactionId:R,status:O})):O==="completed"?await x({interactionId:R,status:O}):(await v({interactionId:R}),await x({interactionId:R,status:"live"}))}catch(I){console.error("Failed to update interaction status:",I)}},A=R=>R.dmUserId===s,k=()=>{h(!0),setTimeout(()=>h(!1),1e3)},_=R=>{switch(R){case"live":return"default";case"paused":return"secondary";case"completed":return"outline";default:return"secondary"}},L=R=>{switch(R){case"live":return i.jsx(_u,{className:"w-3 h-3"});case"paused":return i.jsx(eT,{className:"w-3 h-3"});case"completed":return i.jsx(Yi,{className:"w-3 h-3"});default:return i.jsx(Na,{className:"w-3 h-3"})}},D=R=>{const I=new Date().getTime()-R.getTime(),U=Math.floor(I/(1e3*60)),M=Math.floor(U/60),$=Math.floor(M/24);return U<1?"Just now":U<60?`${U}m ago`:M<24?`${M}h ago`:`${$}d ago`};return f?i.jsx("div",{className:"container mx-auto py-6",children:i.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px]",children:[i.jsx(Na,{className:"w-12 h-12 text-destructive mb-4"}),i.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Something went wrong"}),i.jsx("p",{className:"text-muted-foreground text-center mb-4",children:"There was an error loading the interactions page. Please refresh the page or try again later."}),i.jsxs(q,{onClick:()=>window.location.reload(),variant:"outline",className:"flex items-center gap-2",children:[i.jsx(Lu,{className:"w-4 h-4"}),"Refresh Page"]})]})}):!e||n||!t?i.jsx("div",{className:"container mx-auto py-6",children:i.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:i.jsxs("div",{className:"text-center",children:[i.jsx(Ss,{className:"w-8 h-8 animate-spin mx-auto mb-4","data-testid":"loading-spinner"}),i.jsx("p",{className:"text-muted-foreground",children:e?t?"Loading interactions...":"Authenticating...":"Loading authentication..."})]})})}):p?i.jsxs("div",{className:"container mx-auto py-6",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-3xl font-bold",children:"Live Interactions"}),i.jsx("p",{className:"text-muted-foreground",children:"Manage and join live D&D interactions"}),w&&i.jsxs("div",{className:"flex items-center gap-2 mt-2 text-sm text-destructive",role:"alert","aria-live":"polite",children:[i.jsx(Na,{className:"w-4 h-4","aria-hidden":"true"}),"Live server unavailable - some features may not work"]}),y&&i.jsxs("div",{className:"flex items-center gap-2 mt-2 text-sm text-muted-foreground",role:"status","aria-live":"polite",children:[i.jsx(Yi,{className:"w-4 h-4 text-green-500","aria-hidden":"true"}),"Live system connected (",((T=(P=y==null?void 0:y.detailedStatus)==null?void 0:P.liveRooms)==null?void 0:T.active)||0," active rooms)"]})]}),i.jsxs(q,{variant:"outline",size:"sm",onClick:k,disabled:d,"aria-label":d?"Refreshing interactions...":"Refresh interactions list",children:[i.jsx(Lu,{className:`w-4 h-4 mr-2 ${d?"animate-spin":""}`,"aria-hidden":"true"}),"Refresh"]})]}),p.length===0?i.jsx(oe,{children:i.jsxs(he,{className:"flex flex-col items-center justify-center py-12",children:[i.jsx(Na,{className:"w-12 h-12 text-muted-foreground mb-4","aria-hidden":"true"}),i.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Interactions Found"}),i.jsx("p",{className:"text-muted-foreground text-center",children:"Create interactions in your campaigns to see them here."})]})}):i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",role:"list","aria-label":"Available interactions",children:p.map(R=>i.jsxs(oe,{className:"hover:shadow-md transition-shadow",role:"listitem",children:[i.jsx(ke,{children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx(Ne,{className:"text-lg",children:R.name}),R.description&&i.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:R.description})]}),i.jsxs(ue,{variant:_(R.liveStatus.status),className:"flex items-center gap-1",children:[L(R.liveStatus.status),R.liveStatus.status]})]})}),i.jsx(he,{children:i.jsxs("div",{className:"space-y-3",children:[i.jsxs("div",{className:"flex items-center justify-between text-sm",children:[i.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[i.jsx(Cs,{className:"w-4 h-4"}),i.jsxs("span",{children:[R.liveStatus.participantCount," connected"]})]}),i.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[i.jsx(Ra,{className:"w-4 h-4"}),i.jsx("span",{children:D(R.liveStatus.lastActivity)})]})]}),R.liveStatus.currentTurn&&i.jsxs("div",{className:"text-xs text-muted-foreground",children:["Current turn: ",R.liveStatus.currentTurn]}),i.jsxs("div",{className:"flex gap-2 pt-2",children:[(R.liveStatus.status==="live"||R.liveStatus.status==="paused")&&i.jsx(q,{size:"sm",onClick:()=>S(R._id),className:"flex-1",disabled:w!==void 0,children:R.liveStatus.status==="live"?"Join":"Rejoin"}),A(R)&&i.jsxs("div",{className:"flex gap-1",children:[R.liveStatus.status==="idle"&&i.jsx(q,{size:"sm",variant:"outline",onClick:()=>j(R._id,"live"),disabled:w!==void 0,title:"Start Live Session",children:i.jsx(_u,{className:"w-3 h-3"})}),R.liveStatus.status==="live"&&i.jsx(q,{size:"sm",variant:"outline",onClick:()=>j(R._id,"paused"),disabled:w!==void 0,title:"Pause Session",children:i.jsx(eT,{className:"w-3 h-3"})}),R.liveStatus.status==="paused"&&i.jsx(q,{size:"sm",variant:"outline",onClick:()=>j(R._id,"live"),disabled:w!==void 0,title:"Resume Session",children:i.jsx(_u,{className:"w-3 h-3"})}),(R.liveStatus.status==="live"||R.liveStatus.status==="paused")&&i.jsx(q,{size:"sm",variant:"outline",onClick:()=>j(R._id,"completed"),title:"Complete Session",children:i.jsx(_$,{className:"w-3 h-3"})})]}),!A(R)&&R.liveStatus.status==="idle"&&i.jsx("div",{className:"flex-1 text-center text-sm text-muted-foreground py-2",children:"Waiting for DM to start session"})]})]})})]},R._id))}),r&&i.jsx(e8,{interactionId:r,open:o,onOpenChange:R=>{l(R),R||a(null)},currentUserId:s||"",isDM:((B=p==null?void 0:p.find(R=>R._id===r))==null?void 0:B.dmUserId)===s})]}):i.jsx("div",{className:"container mx-auto py-6",children:i.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:i.jsx(Ss,{className:"w-8 h-8 animate-spin","data-testid":"loading-spinner"})})})}function Rfe(){const[s,e]=C.useState(!1);return i.jsxs("div",{className:"p-6",children:[i.jsxs(oe,{className:"max-w-md mx-auto",children:[i.jsx(ke,{children:i.jsx(Ne,{children:"Live Interaction Demo"})}),i.jsxs(he,{children:[i.jsx("p",{className:"text-muted-foreground mb-4",children:"Click the button below to open the Live Interaction Modal and test its functionality."}),i.jsx(q,{onClick:()=>e(!0),className:"w-full",children:"Open Live Interaction"})]})]}),i.jsx(e8,{open:s,onOpenChange:e,interactionId:"demo-interaction-123",currentUserId:"demo-user-456",isDM:!0})]})}function Dfe(){const s=Cy.campaigns[0],e=oh.playerCharacters.slice(0,3),t=Sy.monsters.slice(0,4),n=jy.quests.slice(0,3),r=lh.items.slice(0,3);return i.jsxs(i.Fragment,{children:[i.jsx(Yu,{children:i.jsxs("div",{className:"flex flex-col",children:[i.jsx("div",{className:"bg-gradient-to-r from-cherry-rose-50 via-royal-plum-50 to-pacific-cyan-50 dark:from-cherry-rose-900/20 dark:via-royal-plum-900/20 dark:to-pacific-cyan-900/20 border-b border-royal-plum-200 dark:border-royal-plum-800",children:i.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:i.jsxs("div",{className:"flex items-center justify-center gap-3",children:[i.jsx("div",{className:"p-2 rounded-lg bg-royal-plum-100 dark:bg-royal-plum-900/50",children:i.jsx(Aa,{className:"w-5 h-5 text-royal-plum-600 dark:text-royal-plum-300"})}),i.jsxs("div",{className:"text-center",children:[i.jsx("h3",{className:"font-semibold text-royal-plum-900 dark:text-royal-plum-100",children:"Demo Mode"}),i.jsx("p",{className:"text-sm text-royal-plum-700 dark:text-royal-plum-300",children:"The data you see below is for demonstration purposes only. Sign in to create your own campaigns and content!"})]})]})})}),i.jsxs("div",{className:"relative overflow-hidden bg-gradient-to-br from-primary/10 via-background to-secondary/10 border-b",children:[i.jsx("div",{className:"absolute inset-0 bg-grid-white/5 [mask-image:radial-gradient(white,transparent_70%)]"}),i.jsx("div",{className:"relative max-w-7xl mx-auto px-4 py-16 sm:py-24",children:i.jsxs("div",{className:"text-center space-y-8",children:[i.jsx("div",{className:"flex justify-center",children:i.jsxs(ue,{variant:"secondary",className:"px-4 py-2 text-sm",children:[i.jsx(Aa,{className:"w-4 h-4 mr-2 inline"}),"The Ultimate D&D 5e Campaign Manager"]})}),i.jsxs("h1",{className:"text-4xl sm:text-5xl md:text-6xl font-bold tracking-tight",children:["Welcome to ",i.jsx("span",{className:"text-primary",children:"Campaignion"})]}),i.jsx("p",{className:"text-xl text-muted-foreground max-w-2xl mx-auto",children:"Create epic adventures, manage characters, track quests, and run legendary campaigns with the most comprehensive D&D 5e management tool."}),i.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[i.jsx(R_,{mode:"modal",children:i.jsxs(q,{size:"lg",className:"text-lg",children:[i.jsx(lA,{className:"w-5 h-5 mr-2"}),"Get Started Free"]})}),i.jsx(q,{size:"lg",variant:"outline",className:"text-lg",asChild:!0,children:i.jsxs("a",{href:"#features",children:[i.jsx(wo,{className:"w-5 h-5 mr-2"}),"Explore Features"]})})]})]})})]}),i.jsx("div",{className:"py-12 bg-muted/30 border-b",children:i.jsx("div",{className:"max-w-7xl mx-auto px-4",children:i.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-8",children:[i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-4xl font-bold text-primary mb-2",children:"500+"}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Monsters"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-4xl font-bold text-primary mb-2",children:"100+"}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Spells & Actions"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-4xl font-bold text-primary mb-2",children:""}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Campaigns"})]}),i.jsxs("div",{className:"text-center",children:[i.jsx("div",{className:"text-4xl font-bold text-primary mb-2",children:"Real-time"}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Collaboration"})]})]})})}),i.jsx("div",{id:"features",className:"py-16 px-4",children:i.jsxs("div",{className:"max-w-7xl mx-auto",children:[i.jsxs("div",{className:"text-center mb-12",children:[i.jsx("h2",{className:"text-3xl font-bold mb-4",children:"Powerful Features for Every DM"}),i.jsx("p",{className:"text-muted-foreground text-lg",children:"Everything you need to run amazing D&D 5e campaigns"})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[i.jsx(oe,{className:"border-2 hover:border-primary/50 transition-colors",children:i.jsxs(ke,{children:[i.jsx(jo,{className:"w-10 h-10 text-primary mb-2"}),i.jsx(Ne,{children:"Campaign Management"}),i.jsx(At,{children:"Organize entire campaigns with world settings, locations, and storylines"})]})}),i.jsx(oe,{className:"border-2 hover:border-primary/50 transition-colors",children:i.jsxs(ke,{children:[i.jsx(Cs,{className:"w-10 h-10 text-primary mb-2"}),i.jsx(Ne,{children:"Character Sheets"}),i.jsx(At,{children:"Complete D&D 5e character sheets with automatic calculations and stat tracking"})]})}),i.jsx(oe,{className:"border-2 hover:border-primary/50 transition-colors",children:i.jsxs(ke,{children:[i.jsx(En,{className:"w-10 h-10 text-primary mb-2"}),i.jsx(Ne,{children:"Monster Database"}),i.jsx(At,{children:"Extensive monster library with CR, legendary actions, and combat stats"})]})}),i.jsx(oe,{className:"border-2 hover:border-primary/50 transition-colors",children:i.jsxs(ke,{children:[i.jsx(uv,{className:"w-10 h-10 text-primary mb-2"}),i.jsx(Ne,{children:"Quest Tracking"}),i.jsx(At,{children:"Manage quests, tasks, and objectives with reward tracking and dependencies"})]})}),i.jsx(oe,{className:"border-2 hover:border-primary/50 transition-colors",children:i.jsxs(ke,{children:[i.jsx(ci,{className:"w-10 h-10 text-primary mb-2"}),i.jsx(Ne,{children:"Battle Maps"}),i.jsx(At,{children:"Interactive tactical maps with token management and terrain features"})]})}),i.jsx(oe,{className:"border-2 hover:border-primary/50 transition-colors",children:i.jsxs(ke,{children:[i.jsx(Da,{className:"w-10 h-10 text-primary mb-2"}),i.jsx(Ne,{children:"Live Sessions"}),i.jsx(At,{children:"Real-time combat tracking, initiative management, and collaborative play"})]})})]})]})}),i.jsx("div",{className:"py-16 px-4 bg-muted/30",children:i.jsxs("div",{className:"max-w-7xl mx-auto",children:[i.jsxs("div",{className:"text-center mb-12",children:[i.jsx("h2",{className:"text-3xl font-bold mb-4",children:"See It In Action"}),i.jsx("p",{className:"text-muted-foreground text-lg",children:"Explore sample campaigns, characters, and content"})]}),i.jsx(oe,{className:"mb-8 border-2 border-primary/20 overflow-hidden",children:i.jsx("div",{className:"bg-gradient-to-r from-primary/10 to-secondary/10 p-6",children:i.jsx("div",{className:"flex items-start justify-between",children:i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[i.jsx(Ru,{className:"w-6 h-6 text-primary"}),i.jsx(ue,{children:"Featured Campaign"})]}),i.jsx("h3",{className:"text-2xl font-bold mb-2",children:s.name}),i.jsx("p",{className:"text-muted-foreground mb-4",children:s.description}),i.jsxs("div",{className:"flex gap-2",children:[i.jsx(ue,{variant:"secondary",children:s.worldSetting}),i.jsx(ue,{variant:"outline",children:"Level 1-5"})]})]})})})}),i.jsxs("div",{className:"mb-8",children:[i.jsxs("h3",{className:"text-2xl font-bold mb-4 flex items-center",children:[i.jsx(Cs,{className:"w-6 h-6 mr-2 text-primary"}),"Party Members"]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:e.map((a,o)=>i.jsx(oe,{className:"hover:shadow-lg transition-shadow",children:i.jsxs(ke,{children:[i.jsxs("div",{className:"flex justify-between items-start mb-2",children:[i.jsx(Ne,{className:"text-lg",children:a.name}),i.jsxs(ue,{variant:"outline",children:["Lvl ",a.level]})]}),i.jsx(At,{children:i.jsxs("div",{className:"space-y-1",children:[i.jsxs("div",{children:[a.race," ",a.class]}),i.jsxs("div",{className:"flex gap-4 text-sm mt-2",children:[i.jsxs("span",{className:"flex items-center gap-1",children:[i.jsx(Dr,{className:"w-4 h-4"})," AC ",a.armorClass]}),i.jsxs("span",{className:"flex items-center gap-1",children:[" ",a.hitPoints," HP"]})]})]})})]})},o))})]}),i.jsxs("div",{className:"mb-8",children:[i.jsxs("h3",{className:"text-2xl font-bold mb-4 flex items-center",children:[i.jsx(En,{className:"w-6 h-6 mr-2 text-primary"}),"Fearsome Foes"]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:t.map((a,o)=>i.jsx(oe,{className:"hover:shadow-lg transition-shadow",children:i.jsxs(ke,{children:[i.jsxs(Ne,{className:"text-md flex items-center gap-2",children:[a.name,a.challengeRating&&parseFloat(a.challengeRating)>=5&&i.jsx(pne,{className:"w-4 h-4 text-destructive"})]}),i.jsx(At,{children:i.jsxs("div",{className:"space-y-1 text-xs",children:[i.jsxs("div",{children:[a.size," ",a.type]}),i.jsxs("div",{className:"flex gap-2 mt-2",children:[i.jsxs(ue,{variant:"destructive",className:"text-xs",children:["CR ",a.challengeRating]}),i.jsxs(ue,{variant:"secondary",className:"text-xs",children:["AC ",a.armorClass]})]})]})})]})},o))})]}),i.jsxs("div",{className:"mb-8",children:[i.jsxs("h3",{className:"text-2xl font-bold mb-4 flex items-center",children:[i.jsx(uv,{className:"w-6 h-6 mr-2 text-primary"}),"Epic Quests"]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:n.map((a,o)=>i.jsx(oe,{className:"hover:shadow-lg transition-shadow",children:i.jsxs(ke,{children:[i.jsx(Ne,{className:"text-lg",children:a.name}),i.jsxs(At,{children:[i.jsxs("div",{className:"text-sm mb-3",children:[a.description.slice(0,100),"..."]}),i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsxs(ue,{variant:"secondary",children:[a.rewards.xp," XP"]}),i.jsxs("span",{className:"text-xs text-muted-foreground",children:[" ",a.rewards.gold,"g"]})]})]})]})},o))})]}),i.jsxs("div",{children:[i.jsxs("h3",{className:"text-2xl font-bold mb-4 flex items-center",children:[i.jsx(Aa,{className:"w-6 h-6 mr-2 text-primary"}),"Legendary Loot"]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:r.map((a,o)=>i.jsx(oe,{className:"hover:shadow-lg transition-shadow",children:i.jsxs(ke,{children:[i.jsxs("div",{className:"flex justify-between items-start mb-2",children:[i.jsx(Ne,{className:"text-md",children:a.name}),i.jsx(ue,{variant:a.rarity==="Legendary"?"default":a.rarity==="Rare"?"secondary":"outline",className:"text-xs",children:a.rarity})]}),i.jsxs(At,{children:[i.jsxs("div",{className:"text-xs mb-2",children:[a.description.slice(0,80),"..."]}),i.jsxs("div",{className:"text-xs text-muted-foreground",children:[" ",a.cost," gp"]})]})]})},o))})]})]})}),i.jsx("div",{className:"py-16 px-4",children:i.jsx("div",{className:"max-w-4xl mx-auto text-center",children:i.jsx(oe,{className:"border-2 border-primary/20 bg-gradient-to-br from-primary/5 to-secondary/5",children:i.jsxs(ke,{className:"space-y-6",children:[i.jsxs("div",{children:[i.jsx(Ne,{className:"text-3xl mb-4",children:"Ready to Begin Your Adventure?"}),i.jsx(At,{className:"text-lg",children:"Join thousands of Dungeon Masters and create unforgettable D&D experiences. Sign in to start building your campaign today."})]}),i.jsx("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:i.jsx(R_,{mode:"modal",children:i.jsxs(q,{size:"lg",className:"text-lg",children:[i.jsx(lA,{className:"w-5 h-5 mr-2"}),"Start Your Campaign"]})})})]})})})})]})}),i.jsx(Rr,{children:i.jsxs("div",{className:"px-4 py-6 sm:px-0",children:[i.jsxs("div",{className:"mb-8 animate-fade-in",children:[i.jsx("h1",{className:"text-4xl font-bold mb-2 text-gradient",children:"Welcome back, Adventurer!"}),i.jsx("p",{className:"text-muted-foreground text-lg",children:"Choose where to continue your journey"})]}),i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[i.jsx(ba,{to:"/campaigns",children:i.jsxs(oe,{className:"hover-lift cursor-pointer border-2 hover:border-primary/50 group",children:[i.jsx(ke,{children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"p-2 rounded-lg bg-primary/10 group-hover:bg-primary/20 transition-colors",children:i.jsx(jo,{className:"w-6 h-6 text-primary"})}),i.jsx(Ne,{children:"Campaigns"})]})}),i.jsxs(he,{children:[i.jsx("p",{className:"text-muted-foreground mb-4",children:"Manage your D&D campaigns and adventures."}),i.jsx(q,{variant:"gradient",className:"w-full",children:"View Campaigns"})]})]})}),i.jsx(ba,{to:"/characters",children:i.jsxs(oe,{className:"hover-lift cursor-pointer border-2 hover:border-primary/50 group",children:[i.jsx(ke,{children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"p-2 rounded-lg bg-primary/10 group-hover:bg-primary/20 transition-colors",children:i.jsx(Cs,{className:"w-6 h-6 text-primary"})}),i.jsx(Ne,{children:"Characters"})]})}),i.jsxs(he,{children:[i.jsx("p",{className:"text-muted-foreground mb-4",children:"Create and manage player characters and NPCs."}),i.jsx(q,{variant:"gradient",className:"w-full",children:"View Characters"})]})]})}),i.jsx(ba,{to:"/monsters",children:i.jsxs(oe,{className:"hover-lift cursor-pointer border-2 hover:border-primary/50 group",children:[i.jsx(ke,{children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"p-2 rounded-lg bg-primary/10 group-hover:bg-primary/20 transition-colors",children:i.jsx(En,{className:"w-6 h-6 text-primary"})}),i.jsx(Ne,{children:"Monsters"})]})}),i.jsxs(he,{children:[i.jsx("p",{className:"text-muted-foreground mb-4",children:"Browse and create monsters for your encounters."}),i.jsx(q,{variant:"gradient",className:"w-full",children:"View Monsters"})]})]})}),i.jsx(ba,{to:"/quests",children:i.jsxs(oe,{className:"hover-lift cursor-pointer border-2 hover:border-primary/50 group",children:[i.jsx(ke,{children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"p-2 rounded-lg bg-primary/10 group-hover:bg-primary/20 transition-colors",children:i.jsx(uv,{className:"w-6 h-6 text-primary"})}),i.jsx(Ne,{children:"Quests"})]})}),i.jsxs(he,{children:[i.jsx("p",{className:"text-muted-foreground mb-4",children:"Track your party's adventures and objectives."}),i.jsx(q,{variant:"gradient",className:"w-full",children:"View Quests"})]})]})}),i.jsx(ba,{to:"/items",children:i.jsxs(oe,{className:"hover-lift cursor-pointer border-2 hover:border-primary/50 group",children:[i.jsx(ke,{children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"p-2 rounded-lg bg-primary/10 group-hover:bg-primary/20 transition-colors",children:i.jsx(Aa,{className:"w-6 h-6 text-primary"})}),i.jsx(Ne,{children:"Items"})]})}),i.jsxs(he,{children:[i.jsx("p",{className:"text-muted-foreground mb-4",children:"Manage weapons, armor, and magical items."}),i.jsx(q,{variant:"gradient",className:"w-full",children:"View Items"})]})]})}),i.jsx(ba,{to:"/maps",children:i.jsxs(oe,{className:"hover-lift cursor-pointer border-2 hover:border-primary/50 group",children:[i.jsx(ke,{children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"p-2 rounded-lg bg-primary/10 group-hover:bg-primary/20 transition-colors",children:i.jsx(ci,{className:"w-6 h-6 text-primary"})}),i.jsx(Ne,{children:"Battle Maps"})]})}),i.jsxs(he,{children:[i.jsx("p",{className:"text-muted-foreground mb-4",children:"Create and edit battle maps and world maps."}),i.jsx(q,{variant:"gradient",className:"w-full",children:"View Maps"})]})]})}),i.jsx(ba,{to:"/interactions",children:i.jsxs(oe,{className:"hover-lift cursor-pointer border-2 hover:border-primary/50 group",children:[i.jsx(ke,{children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"p-2 rounded-lg bg-primary/10 group-hover:bg-primary/20 transition-colors",children:i.jsx(Da,{className:"w-6 h-6 text-primary"})}),i.jsx(Ne,{children:"Interactions"})]})}),i.jsxs(he,{children:[i.jsx("p",{className:"text-muted-foreground mb-4",children:"Manage live gameplay interactions and encounters."}),i.jsx(q,{variant:"gradient",className:"w-full",children:"View Interactions"})]})]})}),i.jsx(ba,{to:"/live-demo",children:i.jsxs(oe,{className:"hover-lift cursor-pointer border-2 hover:border-primary/50 group",children:[i.jsx(ke,{children:i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsx("div",{className:"p-2 rounded-lg bg-primary/10 group-hover:bg-primary/20 transition-colors",children:i.jsx(lA,{className:"w-6 h-6 text-primary"})}),i.jsx(Ne,{children:"Live Demo"})]})}),i.jsxs(he,{children:[i.jsx("p",{className:"text-muted-foreground mb-4",children:"Try out the live interaction system."}),i.jsx(q,{variant:"gradient",className:"w-full",children:"Try Demo"})]})]})})]})]})})]})}function Lfe(){const[s,e]=C.useState(""),[t,n]=C.useState(""),[r,a]=C.useState(!1),[o,l]=C.useState("");async function c(d){var h,f,m,p;n(""),e(""),l(d.name),a(!0);try{const x=await Az(d),g={name:x.name,raw:x,parsedEquipment:x.parsedEquipment||((h=x.originalData)==null?void 0:h.parsedEquipment),parsedActions:x.parsedActions||((f=x.originalData)==null?void 0:f.parsedActions),confidence:(m=x.originalData)==null?void 0:m.confidence,parseLog:(p=x.originalData)==null?void 0:p.parseLog};e(JSON.stringify(g,null,2))}catch(x){n(x instanceof ul?x.message:(x==null?void 0:x.message)||"Unknown error")}finally{a(!1)}}return i.jsx("div",{className:"p-4 max-w-6xl mx-auto",children:i.jsxs(oe,{children:[i.jsxs(ke,{children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx($v,{className:"w-6 h-6 text-primary"}),i.jsx(Ne,{children:"Character Import Debug Tool"})]}),i.jsx(At,{children:"Upload a D&D 5e character sheet PDF to view the parsed JSON data. This tool helps debug the character import functionality."})]}),i.jsxs(he,{className:"space-y-4",children:[i.jsxs("div",{className:"border-2 border-dashed border-muted-foreground/25 rounded-lg p-8 text-center hover:border-primary/50 transition-colors",children:[i.jsx(oM,{className:"w-12 h-12 mx-auto mb-4 text-muted-foreground"}),i.jsx(st,{htmlFor:"file",className:"cursor-pointer inline-block",children:i.jsxs("div",{className:"space-y-2",children:[i.jsx("div",{className:"text-lg font-medium",children:r?"Parsing PDF...":"Choose a character sheet PDF"}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Click to browse or drag and drop"})]})}),i.jsx(_e,{id:"file",type:"file",accept:".pdf",disabled:r,className:"hidden",onChange:async d=>{var f;const h=(f=d.target.files)==null?void 0:f[0];h&&await c(h)}})]}),o&&!t&&i.jsx("div",{className:"flex items-center gap-2",children:i.jsxs(ue,{variant:"secondary",className:"text-sm",children:[i.jsx($v,{className:"w-3 h-3 mr-1"}),o]})}),t&&i.jsx(ur,{variant:"destructive",children:i.jsx(hr,{children:t})}),s&&i.jsxs("div",{className:"space-y-2",children:[i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsx(st,{className:"text-lg",children:"Parsed JSON Output"}),i.jsx(ue,{variant:"outline",children:"Ready to import"})]}),i.jsx("pre",{className:"mt-2 p-4 bg-muted rounded-lg overflow-auto max-h-[70vh] text-xs font-mono",children:s})]}),!s&&!t&&!r&&i.jsxs("div",{className:"text-center text-muted-foreground py-8",children:[i.jsx("p",{className:"mb-2",children:"No file uploaded yet"}),i.jsx("p",{className:"text-sm",children:"Upload a D&D 5e character sheet PDF to see the parsed data"})]})]})]})})}const Ofe={Town:{icon:Du,color:"bg-blue-100 text-blue-700",label:"Town"},City:{icon:Cx,color:"bg-purple-100 text-purple-700",label:"City"},Village:{icon:Du,color:"bg-green-100 text-green-700",label:"Village"},Dungeon:{icon:Oc,color:"bg-red-100 text-red-700",label:"Dungeon"},Castle:{icon:ak,color:"bg-gray-100 text-gray-700",label:"Castle"},Forest:{icon:fk,color:"bg-emerald-100 text-emerald-700",label:"Forest"},Mountain:{icon:lk,color:"bg-stone-100 text-stone-700",label:"Mountain"},Temple:{icon:tw,color:"bg-yellow-100 text-yellow-700",label:"Temple"},Ruins:{icon:Oc,color:"bg-orange-100 text-orange-700",label:"Ruins"},Camp:{icon:hk,color:"bg-amber-100 text-amber-700",label:"Camp"},Other:{icon:Mn,color:"bg-gray-100 text-gray-700",label:"Other"}};function Ffe({location:s,characterCount:e=0,connectionCount:t=0,interactionCount:n=0,onView:r,onEdit:a,canEdit:o=!1,showSecrets:l=!1}){var b,v,y,w,S;const c=Ofe[s.type],d=c.icon,h=j=>j>=1e6?`${(j/1e6).toFixed(1)}M`:j>=1e3?`${(j/1e3).toFixed(1)}K`:j.toString(),f=!!(s.secrets||s.dmNotes),m=(((b=s.linkedLocations)==null?void 0:b.length)||0)>0,p=(((v=s.notableCharacterIds)==null?void 0:v.length)||0)>0,x=(((y=s.interactionsAtLocation)==null?void 0:y.length)||0)>0,g=(((w=s.imageUrls)==null?void 0:w.length)||0)>0;return i.jsxs(oe,{className:"hover:shadow-md transition-shadow cursor-pointer",children:[i.jsx(ke,{className:"pb-3",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[i.jsx(d,{className:"h-5 w-5 text-muted-foreground"}),i.jsx(Ne,{className:"text-lg line-clamp-1",children:s.name})]}),s.description&&i.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:s.description})]}),i.jsxs("div",{className:"flex flex-col items-end gap-1 ml-2",children:[i.jsx(ue,{variant:"outline",className:`shrink-0 ${c.color}`,children:c.label}),s.population&&i.jsxs(ue,{variant:"secondary",className:"text-xs",children:["Pop: ",h(s.population)]}),s.campaignId&&i.jsx(ue,{variant:"default",className:"text-xs",children:"Campaign"})]})]})}),i.jsxs(he,{className:"space-y-3",children:[(s.government||s.defenses)&&i.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[s.government&&i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(Ru,{className:"h-3 w-3 text-amber-500"}),i.jsx("span",{className:"font-medium",children:s.government})]}),s.defenses&&i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(Dr,{className:"h-3 w-3 text-blue-500"}),i.jsx("span",{className:"font-medium",children:s.defenses})]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Cs,{className:"h-4 w-4 text-muted-foreground"}),i.jsx("span",{className:"text-muted-foreground",children:"Characters:"}),i.jsx("span",{className:"font-medium",children:e})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(jx,{className:"h-4 w-4 text-muted-foreground"}),i.jsx("span",{className:"text-muted-foreground",children:"Connections:"}),i.jsx("span",{className:"font-medium",children:t})]}),i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(Uv,{className:"h-4 w-4 text-muted-foreground"}),i.jsx("span",{className:"text-muted-foreground",children:"Interactions:"}),i.jsx("span",{className:"font-medium",children:n})]}),g&&i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(k$,{className:"h-4 w-4 text-muted-foreground"}),i.jsx("span",{className:"text-muted-foreground",children:"Images:"}),i.jsx("span",{className:"font-medium",children:(S=s.imageUrls)==null?void 0:S.length})]})]}),i.jsxs("div",{className:"flex flex-wrap gap-1",children:[m&&i.jsxs(ue,{variant:"outline",className:"text-xs",children:[i.jsx(jx,{className:"h-3 w-3 mr-1"}),"Connected"]}),p&&i.jsxs(ue,{variant:"outline",className:"text-xs",children:[i.jsx(Cs,{className:"h-3 w-3 mr-1"}),"NPCs"]}),x&&i.jsxs(ue,{variant:"outline",className:"text-xs",children:[i.jsx(Uv,{className:"h-3 w-3 mr-1"}),"Events"]}),s.mapId&&i.jsxs(ue,{variant:"outline",className:"text-xs",children:[i.jsx(Mn,{className:"h-3 w-3 mr-1"}),"Mapped"]}),l&&f&&i.jsxs(ue,{variant:"secondary",className:"text-xs",children:[i.jsx(Sx,{className:"h-3 w-3 mr-1"}),"Secrets"]}),s.publicInformation&&i.jsxs(ue,{variant:"outline",className:"text-xs",children:[i.jsx(Ku,{className:"h-3 w-3 mr-1"}),"Public Info"]})]}),s.publicInformation&&i.jsx("div",{className:"bg-muted/50 p-2 rounded text-xs",children:i.jsx("p",{className:"text-muted-foreground line-clamp-2",children:s.publicInformation})}),l&&f&&i.jsxs("div",{className:"bg-red-50 p-2 rounded text-xs border border-red-200",children:[i.jsxs("div",{className:"flex items-center gap-1 mb-1",children:[i.jsx(Sx,{className:"h-3 w-3 text-red-600"}),i.jsx("span",{className:"font-medium text-red-800",children:"DM Only"})]}),i.jsx("p",{className:"text-red-700 line-clamp-2",children:s.secrets||s.dmNotes||"Secret information available"})]}),i.jsxs("div",{className:"flex gap-2 pt-2",children:[i.jsx(q,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>r==null?void 0:r(s._id),children:"View Details"}),o&&i.jsx(q,{size:"sm",className:"flex-1",onClick:()=>a==null?void 0:a(s._id),children:"Edit"})]})]})]})}function Bfe(){const s=Fe(re.locations.getLocations),e=Fe(re.locations.getMyLocations),t=Fe(re.locations.getGlobalLocations),[n,r]=C.useState(""),[a,o]=C.useState(""),[l,c]=C.useState("my"),[d,h]=C.useState(!1),[f,m]=C.useState("create"),[p,x]=C.useState(null),{databaseUser:g}=Sk(),b=I=>I==null?void 0:I.filter(U=>{const M=U.name.toLowerCase().includes(n.toLowerCase())||U.description&&U.description.toLowerCase().includes(n.toLowerCase())||U.government&&U.government.toLowerCase().includes(n.toLowerCase()),$=!a||U.type===a;return M&&$}),v=b(e||[]),y=b(t||[]),w=b(s||[]),S=I=>{const M=[...e||[],...t||[],...s||[]].find($=>$._id===I);M&&(x(M),m("read"),h(!0))},j=I=>{const U=e==null?void 0:e.find(M=>M._id===I);U&&(x(U),m("edit"),h(!0))},A=()=>{x(null),m("create"),h(!0)},k=()=>{},_=[{value:"",label:"All Types",icon:S$},{value:"City",label:"Cities",icon:Cx},{value:"Town",label:"Towns",icon:Du},{value:"Village",label:"Villages",icon:Du},{value:"Castle",label:"Castles",icon:ak},{value:"Dungeon",label:"Dungeons",icon:Oc},{value:"Forest",label:"Forests",icon:fk},{value:"Mountain",label:"Mountains",icon:lk},{value:"Temple",label:"Temples",icon:tw},{value:"Ruins",label:"Ruins",icon:Oc},{value:"Camp",label:"Camps",icon:hk},{value:"Other",label:"Other",icon:Mn}],L=I=>{if(!I)return{total:0,settlements:0,wilderness:0,structures:0,connected:0,withSecrets:0};const U=["City","Town","Village"],M=["Forest","Mountain"],$=["Castle","Dungeon","Temple","Ruins","Camp"];return{total:I.length,settlements:I.filter(W=>U.includes(W.type)).length,wilderness:I.filter(W=>M.includes(W.type)).length,structures:I.filter(W=>$.includes(W.type)).length,connected:I.filter(W=>{var ee;return(((ee=W.linkedLocations)==null?void 0:ee.length)||0)>0}).length,withSecrets:I.filter(W=>W.secrets||W.dmNotes).length}},D=(I,U=!1,M=!1)=>I?I.length===0?i.jsx(oe,{children:i.jsxs(he,{className:"flex flex-col items-center justify-center py-12",children:[i.jsx(Mn,{className:"h-12 w-12 text-muted-foreground mb-4"}),i.jsx("p",{className:"text-muted-foreground mb-4",children:n||a?"No locations match your search criteria.":"No locations found."}),!n&&!a&&l==="my"&&i.jsxs(q,{onClick:A,children:[i.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Create Location"]})]})}):i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:I.map($=>{var W,ee,Z;return i.jsx(Ffe,{location:$,characterCount:((W=$.notableCharacterIds)==null?void 0:W.length)||0,connectionCount:((ee=$.linkedLocations)==null?void 0:ee.length)||0,interactionCount:((Z=$.interactionsAtLocation)==null?void 0:Z.length)||0,onView:S,onEdit:j,canEdit:U,showSecrets:M},$._id)})}):i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(6)].map(($,W)=>i.jsx("div",{className:"h-64 bg-muted animate-pulse rounded-lg"},W))}),P=()=>{switch(l){case"my":return v;case"global":return y;case"all":return w;default:return v}},T=()=>{switch(l){case"my":return e||[];case"global":return t||[];case"all":return s||[];default:return e||[]}},B=P(),R=L(T()),O=(g==null?void 0:g.role)==="admin";return i.jsxs("div",{className:"container mx-auto py-6",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-3xl font-bold",children:"Realm Atlas"}),i.jsx("p",{className:"text-muted-foreground",children:"Explore and manage locations across your D&D campaigns"})]}),i.jsx(Rr,{children:i.jsxs(q,{onClick:A,children:[i.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Create Location"]})})]}),i.jsx(Yu,{children:i.jsxs(oe,{children:[i.jsx(ke,{children:i.jsx(Ne,{children:"Sign in to manage locations"})}),i.jsx(he,{children:i.jsx("p",{className:"text-muted-foreground",children:"Please sign in to create and manage locations for your campaigns."})})]})}),i.jsxs(Rr,{children:[i.jsx(Zu,{entityType:"locations",onDataLoaded:()=>{}}),i.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[i.jsxs("div",{className:"flex gap-1 bg-muted p-1 rounded-lg",children:[i.jsxs(q,{variant:l==="my"?"default":"ghost",size:"sm",onClick:()=>c("my"),className:"gap-2",children:[i.jsx(Mn,{className:"h-4 w-4"}),"My Locations",e&&i.jsx(ue,{variant:"secondary",className:"ml-1",children:e.length})]}),i.jsxs(q,{variant:l==="global"?"default":"ghost",size:"sm",onClick:()=>c("global"),className:"gap-2",children:[i.jsx(gne,{className:"h-4 w-4"}),"Global",t&&i.jsx(ue,{variant:"secondary",className:"ml-1",children:t.length})]}),i.jsxs(q,{variant:l==="all"?"default":"ghost",size:"sm",onClick:()=>c("all"),className:"gap-2",children:[i.jsx(Cx,{className:"h-4 w-4"}),"All Locations",s&&i.jsx(ue,{variant:"secondary",className:"ml-1",children:s.length})]})]}),i.jsxs("div",{className:"flex flex-1 gap-2",children:[i.jsxs("div",{className:"relative flex-1",children:[i.jsx(wm,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),i.jsx(_e,{placeholder:"Search locations...",className:"pl-10",value:n,onChange:I=>r(I.target.value)})]}),i.jsx("div",{className:"flex gap-1 flex-wrap",children:_.slice(0,5).map(I=>{const U=I.icon;return i.jsxs(q,{variant:a===I.value?"default":"outline",size:"sm",onClick:()=>o(I.value),className:"gap-1",children:[i.jsx(U,{className:"h-3 w-3"}),I.label]},I.value)})})]})]}),i.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4 mb-6",children:[i.jsx(oe,{children:i.jsxs(he,{className:"p-4 text-center",children:[i.jsx("div",{className:"text-2xl font-bold",children:R.total}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Locations"})]})}),i.jsx(oe,{children:i.jsxs(he,{className:"p-4 text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-blue-600",children:R.settlements}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Settlements"})]})}),i.jsx(oe,{children:i.jsxs(he,{className:"p-4 text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-green-600",children:R.wilderness}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Wilderness"})]})}),i.jsx(oe,{children:i.jsxs(he,{className:"p-4 text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-purple-600",children:R.structures}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Structures"})]})}),i.jsx(oe,{children:i.jsxs(he,{className:"p-4 text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-orange-600",children:R.connected}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"Connected"})]})}),O&&i.jsx(oe,{children:i.jsxs(he,{className:"p-4 text-center",children:[i.jsx("div",{className:"text-2xl font-bold text-red-600",children:R.withSecrets}),i.jsx("div",{className:"text-sm text-muted-foreground",children:"With Secrets"})]})})]}),i.jsxs("div",{children:[i.jsx("h2",{className:"text-2xl font-semibold mb-4",children:l==="my"?"My Locations":l==="global"?"Global Locations":"All Locations"}),D(B,l==="my",O&&(l==="my"||l==="all"))]})]}),i.jsx(uz,{open:d,onOpenChange:h,mode:f,location:p,onSuccess:k})]})}const UO=s=>{let e;const t=new Set,n=(d,h)=>{const f=typeof d=="function"?d(e):d;if(!Object.is(f,e)){const m=e;e=h??(typeof f!="object"||f===null)?f:Object.assign({},e,f),t.forEach(p=>p(e,m))}},r=()=>e,l={setState:n,getState:r,getInitialState:()=>c,subscribe:d=>(t.add(d),()=>t.delete(d))},c=e=s(n,r,l);return l},$fe=s=>s?UO(s):UO,Ufe=s=>s;function zfe(s,e=Ufe){const t=V.useSyncExternalStore(s.subscribe,V.useCallback(()=>e(s.getState()),[s,e]),V.useCallback(()=>e(s.getInitialState()),[s,e]));return V.useDebugValue(t),t}const Hfe=s=>{const e=$fe(s),t=n=>zfe(e,n);return Object.assign(t,e),t},t8=s=>Hfe;var s8=Symbol.for("immer-nothing"),zO=Symbol.for("immer-draftable"),Xi=Symbol.for("immer-state");function fo(s,...e){throw new Error(`[Immer] minified error nr: ${s}. Full error at: https://bit.ly/3cXEKWf`)}var Qv=Object.getPrototypeOf;function Mx(s){return!!s&&!!s[Xi]}function xm(s){var e;return s?n8(s)||Array.isArray(s)||!!s[zO]||!!((e=s.constructor)!=null&&e[zO])||xw(s)||zk(s):!1}var Vfe=Object.prototype.constructor.toString(),HO=new WeakMap;function n8(s){if(!s||typeof s!="object")return!1;const e=Object.getPrototypeOf(s);if(e===null||e===Object.prototype)return!0;const t=Object.hasOwnProperty.call(e,"constructor")&&e.constructor;if(t===Object)return!0;if(typeof t!="function")return!1;let n=HO.get(t);return n===void 0&&(n=Function.toString.call(t),HO.set(t,n)),n===Vfe}function zS(s,e,t=!0){Uk(s)===0?(t?Reflect.ownKeys(s):Object.keys(s)).forEach(r=>{e(r,s[r],s)}):s.forEach((n,r)=>e(r,n,s))}function Uk(s){const e=s[Xi];return e?e.type_:Array.isArray(s)?1:xw(s)?2:zk(s)?3:0}function rE(s,e){return Uk(s)===2?s.has(e):Object.prototype.hasOwnProperty.call(s,e)}function r8(s,e,t){const n=Uk(s);n===2?s.set(e,t):n===3?s.add(t):s[e]=t}function Wfe(s,e){return s===e?s!==0||1/s===1/e:s!==s&&e!==e}function xw(s){return s instanceof Map}function zk(s){return s instanceof Set}function hh(s){return s.copy_||s.base_}function iE(s,e){if(xw(s))return new Map(s);if(zk(s))return new Set(s);if(Array.isArray(s))return Array.prototype.slice.call(s);const t=n8(s);if(e===!0||e==="class_only"&&!t){const n=Object.getOwnPropertyDescriptors(s);delete n[Xi];let r=Reflect.ownKeys(n);for(let a=0;a<r.length;a++){const o=r[a],l=n[o];l.writable===!1&&(l.writable=!0,l.configurable=!0),(l.get||l.set)&&(n[o]={configurable:!0,writable:!0,enumerable:l.enumerable,value:s[o]})}return Object.create(Qv(s),n)}else{const n=Qv(s);if(n!==null&&t)return{...s};const r=Object.create(n);return Object.assign(r,s)}}function GM(s,e=!1){return Hk(s)||Mx(s)||!xm(s)||(Uk(s)>1&&Object.defineProperties(s,{set:m1,add:m1,clear:m1,delete:m1}),Object.freeze(s),e&&Object.values(s).forEach(t=>GM(t,!0))),s}function qfe(){fo(2)}var m1={value:qfe};function Hk(s){return s===null||typeof s!="object"?!0:Object.isFrozen(s)}var Gfe={};function ym(s){const e=Gfe[s];return e||fo(0,s),e}var Zv;function i8(){return Zv}function Yfe(s,e){return{drafts_:[],parent_:s,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function VO(s,e){e&&(ym("Patches"),s.patches_=[],s.inversePatches_=[],s.patchListener_=e)}function aE(s){oE(s),s.drafts_.forEach(Kfe),s.drafts_=null}function oE(s){s===Zv&&(Zv=s.parent_)}function WO(s){return Zv=Yfe(Zv,s)}function Kfe(s){const e=s[Xi];e.type_===0||e.type_===1?e.revoke_():e.revoked_=!0}function qO(s,e){e.unfinalizedDrafts_=e.drafts_.length;const t=e.drafts_[0];return s!==void 0&&s!==t?(t[Xi].modified_&&(aE(e),fo(4)),xm(s)&&(s=HS(e,s),e.parent_||VS(e,s)),e.patches_&&ym("Patches").generateReplacementPatches_(t[Xi].base_,s,e.patches_,e.inversePatches_)):s=HS(e,t,[]),aE(e),e.patches_&&e.patchListener_(e.patches_,e.inversePatches_),s!==s8?s:void 0}function HS(s,e,t){if(Hk(e))return e;const n=s.immer_.shouldUseStrictIteration(),r=e[Xi];if(!r)return zS(e,(a,o)=>GO(s,r,e,a,o,t),n),e;if(r.scope_!==s)return e;if(!r.modified_)return VS(s,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;const a=r.copy_;let o=a,l=!1;r.type_===3&&(o=new Set(a),a.clear(),l=!0),zS(o,(c,d)=>GO(s,r,a,c,d,t,l),n),VS(s,a,!1),t&&s.patches_&&ym("Patches").generatePatches_(r,t,s.patches_,s.inversePatches_)}return r.copy_}function GO(s,e,t,n,r,a,o){if(r==null||typeof r!="object"&&!o)return;const l=Hk(r);if(!(l&&!o)){if(Mx(r)){const c=a&&e&&e.type_!==3&&!rE(e.assigned_,n)?a.concat(n):void 0,d=HS(s,r,c);if(r8(t,n,d),Mx(d))s.canAutoFreeze_=!1;else return}else o&&t.add(r);if(xm(r)&&!l){if(!s.immer_.autoFreeze_&&s.unfinalizedDrafts_<1||e&&e.base_&&e.base_[n]===r&&l)return;HS(s,r),(!e||!e.scope_.parent_)&&typeof n!="symbol"&&(xw(t)?t.has(n):Object.prototype.propertyIsEnumerable.call(t,n))&&VS(s,r)}}}function VS(s,e,t=!1){!s.parent_&&s.immer_.autoFreeze_&&s.canAutoFreeze_&&GM(e,t)}function Xfe(s,e){const t=Array.isArray(s),n={type_:t?1:0,scope_:e?e.scope_:i8(),modified_:!1,finalized_:!1,assigned_:{},parent_:e,base_:s,draft_:null,copy_:null,revoke_:null,isManual_:!1};let r=n,a=YM;t&&(r=[n],a=Jv);const{revoke:o,proxy:l}=Proxy.revocable(r,a);return n.draft_=l,n.revoke_=o,l}var YM={get(s,e){if(e===Xi)return s;const t=hh(s);if(!rE(t,e))return Qfe(s,t,e);const n=t[e];return s.finalized_||!xm(n)?n:n===EA(s.base_,e)?(PA(s),s.copy_[e]=cE(n,s)):n},has(s,e){return e in hh(s)},ownKeys(s){return Reflect.ownKeys(hh(s))},set(s,e,t){const n=a8(hh(s),e);if(n!=null&&n.set)return n.set.call(s.draft_,t),!0;if(!s.modified_){const r=EA(hh(s),e),a=r==null?void 0:r[Xi];if(a&&a.base_===t)return s.copy_[e]=t,s.assigned_[e]=!1,!0;if(Wfe(t,r)&&(t!==void 0||rE(s.base_,e)))return!0;PA(s),lE(s)}return s.copy_[e]===t&&(t!==void 0||e in s.copy_)||Number.isNaN(t)&&Number.isNaN(s.copy_[e])||(s.copy_[e]=t,s.assigned_[e]=!0),!0},deleteProperty(s,e){return EA(s.base_,e)!==void 0||e in s.base_?(s.assigned_[e]=!1,PA(s),lE(s)):delete s.assigned_[e],s.copy_&&delete s.copy_[e],!0},getOwnPropertyDescriptor(s,e){const t=hh(s),n=Reflect.getOwnPropertyDescriptor(t,e);return n&&{writable:!0,configurable:s.type_!==1||e!=="length",enumerable:n.enumerable,value:t[e]}},defineProperty(){fo(11)},getPrototypeOf(s){return Qv(s.base_)},setPrototypeOf(){fo(12)}},Jv={};zS(YM,(s,e)=>{Jv[s]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}});Jv.deleteProperty=function(s,e){return Jv.set.call(this,s,e,void 0)};Jv.set=function(s,e,t){return YM.set.call(this,s[0],e,t,s[0])};function EA(s,e){const t=s[Xi];return(t?hh(t):s)[e]}function Qfe(s,e,t){var r;const n=a8(e,t);return n?"value"in n?n.value:(r=n.get)==null?void 0:r.call(s.draft_):void 0}function a8(s,e){if(!(e in s))return;let t=Qv(s);for(;t;){const n=Object.getOwnPropertyDescriptor(t,e);if(n)return n;t=Qv(t)}}function lE(s){s.modified_||(s.modified_=!0,s.parent_&&lE(s.parent_))}function PA(s){s.copy_||(s.copy_=iE(s.base_,s.scope_.immer_.useStrictShallowCopy_))}var Zfe=class{constructor(s){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!0,this.produce=(e,t,n)=>{if(typeof e=="function"&&typeof t!="function"){const a=t;t=e;const o=this;return function(c=a,...d){return o.produce(c,h=>t.call(this,h,...d))}}typeof t!="function"&&fo(6),n!==void 0&&typeof n!="function"&&fo(7);let r;if(xm(e)){const a=WO(this),o=cE(e,void 0);let l=!0;try{r=t(o),l=!1}finally{l?aE(a):oE(a)}return VO(a,n),qO(r,a)}else if(!e||typeof e!="object"){if(r=t(e),r===void 0&&(r=e),r===s8&&(r=void 0),this.autoFreeze_&&GM(r,!0),n){const a=[],o=[];ym("Patches").generateReplacementPatches_(e,r,a,o),n(a,o)}return r}else fo(1,e)},this.produceWithPatches=(e,t)=>{if(typeof e=="function")return(o,...l)=>this.produceWithPatches(o,c=>e(c,...l));let n,r;return[this.produce(e,t,(o,l)=>{n=o,r=l}),n,r]},typeof(s==null?void 0:s.autoFreeze)=="boolean"&&this.setAutoFreeze(s.autoFreeze),typeof(s==null?void 0:s.useStrictShallowCopy)=="boolean"&&this.setUseStrictShallowCopy(s.useStrictShallowCopy),typeof(s==null?void 0:s.useStrictIteration)=="boolean"&&this.setUseStrictIteration(s.useStrictIteration)}createDraft(s){xm(s)||fo(8),Mx(s)&&(s=Jfe(s));const e=WO(this),t=cE(s,void 0);return t[Xi].isManual_=!0,oE(e),t}finishDraft(s,e){const t=s&&s[Xi];(!t||!t.isManual_)&&fo(9);const{scope_:n}=t;return VO(n,e),qO(void 0,n)}setAutoFreeze(s){this.autoFreeze_=s}setUseStrictShallowCopy(s){this.useStrictShallowCopy_=s}setUseStrictIteration(s){this.useStrictIteration_=s}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(s,e){let t;for(t=e.length-1;t>=0;t--){const r=e[t];if(r.path.length===0&&r.op==="replace"){s=r.value;break}}t>-1&&(e=e.slice(t+1));const n=ym("Patches").applyPatches_;return Mx(s)?n(s,e):this.produce(s,r=>n(r,e))}};function cE(s,e){const t=xw(s)?ym("MapSet").proxyMap_(s,e):zk(s)?ym("MapSet").proxySet_(s,e):Xfe(s,e);return(e?e.scope_:i8()).drafts_.push(t),t}function Jfe(s){return Mx(s)||fo(10,s),o8(s)}function o8(s){if(!xm(s)||Hk(s))return s;const e=s[Xi];let t,n=!0;if(e){if(!e.modified_)return e.base_;e.finalized_=!0,t=iE(s,e.scope_.immer_.useStrictShallowCopy_),n=e.scope_.immer_.shouldUseStrictIteration()}else t=iE(s,!0);return zS(t,(r,a)=>{r8(t,r,o8(a))},n),e&&(e.finalized_=!1),t}var eme=new Zfe,tme=eme.produce;const sme=s=>(e,t,n)=>(n.setState=(r,a,...o)=>{const l=typeof r=="function"?tme(r):r;return e(l,a,...o)},s(n.setState,t,n)),nme=sme,Ju=t8()(nme(s=>({selectedMapId:null,setSelectedMapId:e=>s(t=>{const n=t.selectedMapId;t.selectedMapId=e,n!==e&&(t.initiativeState={initiativeOrder:[],currentTurnIndex:null,isInCombat:!1,roundNumber:1},t.combatState.attackerTokenId=null,t.combatState.targetTokenId=null,t.combatState.availableActions=[],t.combatState.selectedAction=null,t.combatState.isCombatMode=!1,t.currentInstanceId=null)}),showNewMap:!1,setShowNewMap:e=>s(t=>void(t.showNewMap=e)),editingTokenId:null,setEditingTokenId:e=>s(t=>void(t.editingTokenId=e)),enforceSingleOccupancy:!1,setEnforceSingleOccupancy:e=>s(t=>void(t.enforceSingleOccupancy=e)),editingMode:null,setEditingMode:e=>s(t=>void(t.editingMode=e)),selectedTerrain:"normal",setSelectedTerrain:e=>s(t=>void(t.selectedTerrain=e)),measurePoints:[],setMeasurePoints:e=>s(t=>void(t.measurePoints=e)),clearMeasurePoints:()=>s(e=>void(e.measurePoints=[])),aoeTemplate:null,setAoeTemplate:e=>s(t=>void(t.aoeTemplate=e)),selectedTokenForMovement:null,setSelectedTokenForMovement:e=>s(t=>void(t.selectedTokenForMovement=e)),selectedCells:new Set,setSelectedCells:e=>s(t=>void(t.selectedCells=e)),addSelectedCell:(e,t)=>s(n=>void n.selectedCells.add(`${e},${t}`)),removeSelectedCell:(e,t)=>s(n=>void n.selectedCells.delete(`${e},${t}`)),clearSelectedCells:()=>s(e=>void e.selectedCells.clear()),isMultiSelectMode:!1,setIsMultiSelectMode:e=>s(t=>void(t.isMultiSelectMode=e)),combatState:{attackerTokenId:null,targetTokenId:null,availableActions:[],selectedAction:null,isCombatMode:!1},setAttackerToken:e=>s(t=>void(t.combatState.attackerTokenId=e)),setTargetToken:e=>s(t=>void(t.combatState.targetTokenId=e)),setAvailableActions:e=>s(t=>void(t.combatState.availableActions=e)),setSelectedAction:e=>s(t=>void(t.combatState.selectedAction=e)),setIsCombatMode:e=>s(t=>void(t.combatState.isCombatMode=e)),clearCombatState:()=>s(e=>{e.combatState.attackerTokenId=null,e.combatState.targetTokenId=null,e.combatState.availableActions=[],e.combatState.selectedAction=null,e.combatState.isCombatMode=!1}),initiativeState:{initiativeOrder:[],currentTurnIndex:null,isInCombat:!1,roundNumber:1},setInitiativeOrder:e=>s(t=>{t.initiativeState.initiativeOrder=e,e.length>0&&t.initiativeState.currentTurnIndex===null&&(t.initiativeState.currentTurnIndex=0)}),setCurrentTurnIndex:e=>s(t=>void(t.initiativeState.currentTurnIndex=e)),nextTurn:()=>s(e=>{if(e.initiativeState.initiativeOrder.length===0)return;const n=((e.initiativeState.currentTurnIndex??0)+1)%e.initiativeState.initiativeOrder.length;e.initiativeState.currentTurnIndex=n,n===0&&(e.initiativeState.roundNumber+=1)}),previousTurn:()=>s(e=>{if(e.initiativeState.initiativeOrder.length===0)return;const t=e.initiativeState.currentTurnIndex??0,n=t===0?e.initiativeState.initiativeOrder.length-1:t-1;e.initiativeState.currentTurnIndex=n,n===e.initiativeState.initiativeOrder.length-1&&(e.initiativeState.roundNumber=Math.max(1,e.initiativeState.roundNumber-1))}),startCombat:()=>s(e=>{e.initiativeState.isInCombat=!0,e.initiativeState.roundNumber=1,e.initiativeState.initiativeOrder.length>0&&(e.initiativeState.currentTurnIndex=0)}),endCombat:()=>s(e=>{e.initiativeState.isInCombat=!1,e.initiativeState.currentTurnIndex=null,e.initiativeState.roundNumber=1}),currentInstanceId:null,setCurrentInstanceId:e=>s(t=>void(t.currentInstanceId=e)),resetView:!1,triggerResetView:()=>s(e=>void(e.resetView=!e.resetView))}))),rme={Tiny:.5,Small:1,Medium:1,Large:2,Huge:3,Gargantuan:4};function l8({open:s,onOpenChange:e,tokenType:t,onSelectNPC:n,onSelectMonster:r,onCreateGeneric:a}){const[o,l]=C.useState(""),[c,d]=C.useState(t==="pc"?"pcs":"npcs"),h=Fe(re.characters.getCharacters),f=(h==null?void 0:h.filter(j=>j.characterType==="player"))??[],m=(h==null?void 0:h.filter(j=>j.characterType==="npc"))??[],p=Fe(re.monsters.getMonsters)??[],x=f.filter(j=>j.name.toLowerCase().includes(o.toLowerCase())),g=m.filter(j=>j.name.toLowerCase().includes(o.toLowerCase())),b=p.filter(j=>j.name.toLowerCase().includes(o.toLowerCase())),v=j=>{var D,P,T;const A=((D=j.abilityModifiers)==null?void 0:D.constitution)??Math.floor((j.abilityScores.constitution-10)/2),k=((T=(P=j.classes)==null?void 0:P[0])==null?void 0:T.level)??j.level??1,_=Math.floor(k*(6+A));n({label:j.name,characterId:j._id,hp:_,maxHp:_,speed:30,size:1}),e(!1)},y=j=>{var D,P,T;const A=((D=j.abilityModifiers)==null?void 0:D.constitution)??Math.floor((j.abilityScores.constitution-10)/2),k=((T=(P=j.classes)==null?void 0:P[0])==null?void 0:T.level)??j.level??1,_=Math.floor(k*(6+A));n({label:j.name,characterId:j._id,hp:_,maxHp:_,speed:30,size:1}),e(!1)},w=j=>{const A=j.speed.walk?parseInt(j.speed.walk.replace(/\D/g,"")):30;r({label:j.name,monsterId:j._id,hp:j.hitPoints,maxHp:j.hitPoints,speed:A,size:rme[j.size]??1}),e(!1)},S=()=>{a(),e(!1)};return i.jsx(cs,{open:s,onOpenChange:e,children:i.jsxs(is,{className:"max-w-2xl max-h-[80vh]",children:[i.jsxs(Rs,{children:[i.jsxs(Ds,{children:["Add ",t==="pc"?"PC":t==="npc_friendly"?"Ally":"Enemy"," Token"]}),i.jsx(Lr,{children:"Select an existing character or monster, or create a generic token"})]}),i.jsxs("div",{className:"flex flex-col gap-4",children:[i.jsx(_e,{placeholder:"Search by name...",value:o,onChange:j=>l(j.target.value),className:"w-full"}),i.jsxs(Qn,{value:c,onValueChange:d,children:[i.jsxs(In,{className:`grid w-full ${t==="pc"?"grid-cols-4":"grid-cols-3"}`,children:[t==="pc"&&i.jsxs(Be,{value:"pcs",children:["PCs (",x.length,")"]}),i.jsxs(Be,{value:"npcs",children:["NPCs (",g.length,")"]}),i.jsxs(Be,{value:"monsters",children:["Monsters (",b.length,")"]}),i.jsx(Be,{value:"generic",children:"Generic"})]}),t==="pc"&&i.jsx($e,{value:"pcs",className:"mt-4",children:i.jsx(go,{className:"h-[400px] pr-4",children:x.length===0?i.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:["No PCs found. ",o&&"Try adjusting your search."]}):i.jsx("div",{className:"space-y-2",children:x.map(j=>i.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-accent cursor-pointer transition-colors",onClick:()=>v(j),children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"font-medium",children:j.name}),i.jsxs("div",{className:"text-sm text-muted-foreground",children:[j.race," ",j.class,j.level&&`  Level ${Math.floor(j.level)}`]})]}),i.jsx(q,{size:"sm",variant:"outline",onClick:A=>{A.stopPropagation(),v(j)},children:"Add"})]},j._id))})})}),i.jsx($e,{value:"npcs",className:"mt-4",children:i.jsx(go,{className:"h-[400px] pr-4",children:g.length===0?i.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:["No NPCs found. ",o&&"Try adjusting your search."]}):i.jsx("div",{className:"space-y-2",children:g.map(j=>i.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-accent cursor-pointer transition-colors",onClick:()=>y(j),children:[i.jsxs("div",{className:"flex-1",children:[i.jsx("div",{className:"font-medium",children:j.name}),i.jsxs("div",{className:"text-sm text-muted-foreground",children:[j.race," ",j.class,j.level&&`  Level ${Math.floor(j.level)}`]})]}),i.jsx(q,{size:"sm",variant:"outline",onClick:A=>{A.stopPropagation(),y(j)},children:"Add"})]},j._id))})})}),i.jsx($e,{value:"monsters",className:"mt-4",children:i.jsx(go,{className:"h-[400px] pr-4",children:b.length===0?i.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:["No monsters found. ",o&&"Try adjusting your search."]}):i.jsx("div",{className:"space-y-2",children:b.map(j=>i.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-accent cursor-pointer transition-colors",onClick:()=>w(j),children:[i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx("span",{className:"font-medium",children:j.name}),i.jsxs(ue,{variant:"secondary",className:"text-xs",children:["CR ",j.challengeRating]})]}),i.jsxs("div",{className:"text-sm text-muted-foreground",children:[j.size," ",j.type,"  ",j.hitPoints," HP","  ","AC ",j.armorClass]})]}),i.jsx(q,{size:"sm",variant:"outline",onClick:A=>{A.stopPropagation(),w(j)},children:"Add"})]},j._id))})})}),i.jsx($e,{value:"generic",className:"mt-4",children:i.jsxs("div",{className:"flex flex-col items-center justify-center py-12 gap-4",children:[i.jsxs("p",{className:"text-muted-foreground text-center",children:["Create a generic ",t==="pc"?"PC":t==="npc_friendly"?"ally":"enemy"," token",i.jsx("br",{}),"without linking to an existing character or monster."]}),i.jsx(q,{onClick:S,size:"lg",children:"Create Generic Token"})]})})]})]})]})})}function ime(s,e){let t;try{t=s()}catch{return}return{getItem:r=>{var a;const o=c=>c===null?null:JSON.parse(c,void 0),l=(a=t.getItem(r))!=null?a:null;return l instanceof Promise?l.then(o):o(l)},setItem:(r,a)=>t.setItem(r,JSON.stringify(a,void 0)),removeItem:r=>t.removeItem(r)}}const dE=s=>e=>{try{const t=s(e);return t instanceof Promise?t:{then(n){return dE(n)(t)},catch(n){return this}}}catch(t){return{then(n){return this},catch(n){return dE(n)(t)}}}},ame=(s,e)=>(t,n,r)=>{let a={storage:ime(()=>localStorage),partialize:g=>g,version:0,merge:(g,b)=>({...b,...g}),...e},o=!1;const l=new Set,c=new Set;let d=a.storage;if(!d)return s((...g)=>{console.warn(`[zustand persist middleware] Unable to update item '${a.name}', the given storage is currently unavailable.`),t(...g)},n,r);const h=()=>{const g=a.partialize({...n()});return d.setItem(a.name,{state:g,version:a.version})},f=r.setState;r.setState=(g,b)=>(f(g,b),h());const m=s((...g)=>(t(...g),h()),n,r);r.getInitialState=()=>m;let p;const x=()=>{var g,b;if(!d)return;o=!1,l.forEach(y=>{var w;return y((w=n())!=null?w:m)});const v=((b=a.onRehydrateStorage)==null?void 0:b.call(a,(g=n())!=null?g:m))||void 0;return dE(d.getItem.bind(d))(a.name).then(y=>{if(y)if(typeof y.version=="number"&&y.version!==a.version){if(a.migrate){const w=a.migrate(y.state,y.version);return w instanceof Promise?w.then(S=>[!0,S]):[!0,w]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,y.state];return[!1,void 0]}).then(y=>{var w;const[S,j]=y;if(p=a.merge(j,(w=n())!=null?w:m),t(p,!0),S)return h()}).then(()=>{v==null||v(p,void 0),p=n(),o=!0,c.forEach(y=>y(p))}).catch(y=>{v==null||v(void 0,y)})};return r.persist={setOptions:g=>{a={...a,...g},g.storage&&(d=g.storage)},clearStorage:()=>{d==null||d.removeItem(a.name)},getOptions:()=>a,rehydrate:()=>x(),hasHydrated:()=>o,onHydrate:g=>(l.add(g),()=>{l.delete(g)}),onFinishHydration:g=>(c.add(g),()=>{c.delete(g)})},a.skipHydration||x(),p||m},ome=ame,YO={controls:{id:"controls",position:{x:-16,y:16},isVisible:!0,isMinimized:!1,zIndex:10},terrain:{id:"terrain",position:{x:-16,y:280},isVisible:!0,isMinimized:!1,zIndex:10},initiative:{id:"initiative",position:{x:16,y:16},isVisible:!0,isMinimized:!1,zIndex:20},combat:{id:"combat",position:{x:360,y:16},isVisible:!0,isMinimized:!1,zIndex:20},zoom:{id:"zoom",position:{x:-16,y:-16},isVisible:!0,isMinimized:!1,zIndex:10}},Vk=t8()(ome(s=>({panels:{...YO},maxZIndex:20,updatePanelPosition:(e,t)=>s(n=>({panels:{...n.panels,[e]:{...n.panels[e],position:t}}})),togglePanelVisibility:e=>s(t=>({panels:{...t.panels,[e]:{...t.panels[e],isVisible:!t.panels[e].isVisible}}})),togglePanelMinimized:e=>s(t=>({panels:{...t.panels,[e]:{...t.panels[e],isMinimized:!t.panels[e].isMinimized}}})),showPanel:e=>s(t=>({panels:{...t.panels,[e]:{...t.panels[e],isVisible:!0,isMinimized:!1}}})),hidePanel:e=>s(t=>({panels:{...t.panels,[e]:{...t.panels[e],isVisible:!1}}})),bringToFront:e=>s(t=>{const n=t.maxZIndex+1;return{maxZIndex:n,panels:{...t.panels,[e]:{...t.panels[e],zIndex:n}}}}),resetLayout:()=>s(()=>({panels:{...YO},maxZIndex:20})),setAllPanelsVisible:e=>s(t=>{const n={...t.panels};return Object.keys(n).forEach(r=>{n[r]={...n[r],isVisible:e}}),{panels:n}})}),{name:"campaignion-panel-layout",version:1}));function lme(s){const e=cme(s),t=C.forwardRef((n,r)=>{const{children:a,...o}=n,l=C.Children.toArray(a),c=l.find(ume);if(c){const d=c.props.children,h=l.map(f=>f===c?C.Children.count(d)>1?C.Children.only(null):C.isValidElement(d)?d.props.children:null:f);return i.jsx(e,{...o,ref:r,children:C.isValidElement(d)?C.cloneElement(d,void 0,h):null})}return i.jsx(e,{...o,ref:r,children:a})});return t.displayName=`${s}.Slot`,t}function cme(s){const e=C.forwardRef((t,n)=>{const{children:r,...a}=t;if(C.isValidElement(r)){const o=fme(r),l=hme(a,r.props);return r.type!==C.Fragment&&(l.ref=n?qc(n,o):o),C.cloneElement(r,l)}return C.Children.count(r)>1?C.Children.only(null):null});return e.displayName=`${s}.SlotClone`,e}var dme=Symbol("radix.slottable");function ume(s){return C.isValidElement(s)&&typeof s.type=="function"&&"__radixId"in s.type&&s.type.__radixId===dme}function hme(s,e){const t={...e};for(const n in e){const r=s[n],a=e[n];/^on[A-Z]/.test(n)?r&&a?t[n]=(...l)=>{const c=a(...l);return r(...l),c}:r&&(t[n]=r):n==="style"?t[n]={...r,...a}:n==="className"&&(t[n]=[r,a].filter(Boolean).join(" "))}return{...s,...t}}function fme(s){var n,r;let e=(n=Object.getOwnPropertyDescriptor(s.props,"ref"))==null?void 0:n.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?s.ref:(e=(r=Object.getOwnPropertyDescriptor(s,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?s.props.ref:s.props.ref||s.ref)}var uE=["Enter"," "],mme=["ArrowDown","PageUp","Home"],c8=["ArrowUp","PageDown","End"],pme=[...mme,...c8],gme={ltr:[...uE,"ArrowRight"],rtl:[...uE,"ArrowLeft"]},xme={ltr:["ArrowLeft"],rtl:["ArrowRight"]},yw="Menu",[eb,yme,vme]=bk(yw),[km,d8]=Oa(yw,[vme,_k,wk]),Wk=_k(),u8=wk(),[bme,Nm]=km(yw),[wme,vw]=km(yw),h8=s=>{const{__scopeMenu:e,open:t=!1,children:n,dir:r,onOpenChange:a,modal:o=!0}=s,l=Wk(e),[c,d]=C.useState(null),h=C.useRef(!1),f=bl(a),m=rw(r);return C.useEffect(()=>{const p=()=>{h.current=!0,document.addEventListener("pointerdown",x,{capture:!0,once:!0}),document.addEventListener("pointermove",x,{capture:!0,once:!0})},x=()=>h.current=!1;return document.addEventListener("keydown",p,{capture:!0}),()=>{document.removeEventListener("keydown",p,{capture:!0}),document.removeEventListener("pointerdown",x,{capture:!0}),document.removeEventListener("pointermove",x,{capture:!0})}},[]),i.jsx(Y6,{...l,children:i.jsx(bme,{scope:e,open:t,onOpenChange:f,content:c,onContentChange:d,children:i.jsx(wme,{scope:e,onClose:C.useCallback(()=>f(!1),[f]),isUsingKeyboardRef:h,dir:m,modal:o,children:n})})})};h8.displayName=yw;var Cme="MenuAnchor",KM=C.forwardRef((s,e)=>{const{__scopeMenu:t,...n}=s,r=Wk(t);return i.jsx(K6,{...r,...n,ref:e})});KM.displayName=Cme;var XM="MenuPortal",[Sme,f8]=km(XM,{forceMount:void 0}),m8=s=>{const{__scopeMenu:e,forceMount:t,children:n,container:r}=s,a=Nm(XM,e);return i.jsx(Sme,{scope:e,forceMount:t,children:i.jsx(jl,{present:t||a.open,children:i.jsx(Jj,{asChild:!0,container:r,children:n})})})};m8.displayName=XM;var Ea="MenuContent",[jme,QM]=km(Ea),p8=C.forwardRef((s,e)=>{const t=f8(Ea,s.__scopeMenu),{forceMount:n=t.forceMount,...r}=s,a=Nm(Ea,s.__scopeMenu),o=vw(Ea,s.__scopeMenu);return i.jsx(eb.Provider,{scope:s.__scopeMenu,children:i.jsx(jl,{present:n||a.open,children:i.jsx(eb.Slot,{scope:s.__scopeMenu,children:o.modal?i.jsx(kme,{...r,ref:e}):i.jsx(Nme,{...r,ref:e})})})})}),kme=C.forwardRef((s,e)=>{const t=Nm(Ea,s.__scopeMenu),n=C.useRef(null),r=Tt(e,n);return C.useEffect(()=>{const a=n.current;if(a)return DP(a)},[]),i.jsx(ZM,{...s,ref:r,trapFocus:t.open,disableOutsidePointerEvents:t.open,disableOutsideScroll:!0,onFocusOutside:He(s.onFocusOutside,a=>a.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>t.onOpenChange(!1)})}),Nme=C.forwardRef((s,e)=>{const t=Nm(Ea,s.__scopeMenu);return i.jsx(ZM,{...s,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>t.onOpenChange(!1)})}),Ame=lme("MenuContent.ScrollLock"),ZM=C.forwardRef((s,e)=>{const{__scopeMenu:t,loop:n=!1,trapFocus:r,onOpenAutoFocus:a,onCloseAutoFocus:o,disableOutsidePointerEvents:l,onEntryFocus:c,onEscapeKeyDown:d,onPointerDownOutside:h,onFocusOutside:f,onInteractOutside:m,onDismiss:p,disableOutsideScroll:x,...g}=s,b=Nm(Ea,t),v=vw(Ea,t),y=Wk(t),w=u8(t),S=yme(t),[j,A]=C.useState(null),k=C.useRef(null),_=Tt(e,k,b.onContentChange),L=C.useRef(0),D=C.useRef(""),P=C.useRef(0),T=C.useRef(null),B=C.useRef("right"),R=C.useRef(0),O=x?tk:C.Fragment,I=x?{as:Ame,allowPinchZoom:!0}:void 0,U=$=>{var H,Y;const W=D.current+$,ee=S().filter(ae=>!ae.disabled),Z=document.activeElement,z=(H=ee.find(ae=>ae.ref.current===Z))==null?void 0:H.textValue,se=ee.map(ae=>ae.textValue),de=Bme(se,W,z),ne=(Y=ee.find(ae=>ae.textValue===de))==null?void 0:Y.ref.current;(function ae(ce){D.current=ce,window.clearTimeout(L.current),ce!==""&&(L.current=window.setTimeout(()=>ae(""),1e3))})(W),ne&&setTimeout(()=>ne.focus())};C.useEffect(()=>()=>window.clearTimeout(L.current),[]),RP();const M=C.useCallback($=>{var ee,Z;return B.current===((ee=T.current)==null?void 0:ee.side)&&Ume($,(Z=T.current)==null?void 0:Z.area)},[]);return i.jsx(jme,{scope:t,searchRef:D,onItemEnter:C.useCallback($=>{M($)&&$.preventDefault()},[M]),onItemLeave:C.useCallback($=>{var W;M($)||((W=k.current)==null||W.focus(),A(null))},[M]),onTriggerLeave:C.useCallback($=>{M($)&&$.preventDefault()},[M]),pointerGraceTimerRef:P,onPointerGraceIntentChange:C.useCallback($=>{T.current=$},[]),children:i.jsx(O,{...I,children:i.jsx(Zj,{asChild:!0,trapped:r,onMountAutoFocus:He(a,$=>{var W;$.preventDefault(),(W=k.current)==null||W.focus({preventScroll:!0})}),onUnmountAutoFocus:o,children:i.jsx(Qj,{asChild:!0,disableOutsidePointerEvents:l,onEscapeKeyDown:d,onPointerDownOutside:h,onFocusOutside:f,onInteractOutside:m,onDismiss:p,children:i.jsx(o6,{asChild:!0,...w,dir:v.dir,orientation:"vertical",loop:n,currentTabStopId:j,onCurrentTabStopIdChange:A,onEntryFocus:He(c,$=>{v.isUsingKeyboardRef.current||$.preventDefault()}),preventScrollOnEntryFocus:!0,children:i.jsx(X6,{role:"menu","aria-orientation":"vertical","data-state":P8(b.open),"data-radix-menu-content":"",dir:v.dir,...y,...g,ref:_,style:{outline:"none",...g.style},onKeyDown:He(g.onKeyDown,$=>{const ee=$.target.closest("[data-radix-menu-content]")===$.currentTarget,Z=$.ctrlKey||$.altKey||$.metaKey,z=$.key.length===1;ee&&($.key==="Tab"&&$.preventDefault(),!Z&&z&&U($.key));const se=k.current;if($.target!==se||!pme.includes($.key))return;$.preventDefault();const ne=S().filter(H=>!H.disabled).map(H=>H.ref.current);c8.includes($.key)&&ne.reverse(),Ome(ne)}),onBlur:He(s.onBlur,$=>{$.currentTarget.contains($.target)||(window.clearTimeout(L.current),D.current="")}),onPointerMove:He(s.onPointerMove,tb($=>{const W=$.target,ee=R.current!==$.clientX;if($.currentTarget.contains(W)&&ee){const Z=$.clientX>R.current?"right":"left";B.current=Z,R.current=$.clientX}}))})})})})})})});p8.displayName=Ea;var _me="MenuGroup",JM=C.forwardRef((s,e)=>{const{__scopeMenu:t,...n}=s;return i.jsx(ot.div,{role:"group",...n,ref:e})});JM.displayName=_me;var Tme="MenuLabel",g8=C.forwardRef((s,e)=>{const{__scopeMenu:t,...n}=s;return i.jsx(ot.div,{...n,ref:e})});g8.displayName=Tme;var WS="MenuItem",KO="menu.itemSelect",qk=C.forwardRef((s,e)=>{const{disabled:t=!1,onSelect:n,...r}=s,a=C.useRef(null),o=vw(WS,s.__scopeMenu),l=QM(WS,s.__scopeMenu),c=Tt(e,a),d=C.useRef(!1),h=()=>{const f=a.current;if(!t&&f){const m=new CustomEvent(KO,{bubbles:!0,cancelable:!0});f.addEventListener(KO,p=>n==null?void 0:n(p),{once:!0}),d5(f,m),m.defaultPrevented?d.current=!1:o.onClose()}};return i.jsx(x8,{...r,ref:c,disabled:t,onClick:He(s.onClick,h),onPointerDown:f=>{var m;(m=s.onPointerDown)==null||m.call(s,f),d.current=!0},onPointerUp:He(s.onPointerUp,f=>{var m;d.current||(m=f.currentTarget)==null||m.click()}),onKeyDown:He(s.onKeyDown,f=>{const m=l.searchRef.current!=="";t||m&&f.key===" "||uE.includes(f.key)&&(f.currentTarget.click(),f.preventDefault())})})});qk.displayName=WS;var x8=C.forwardRef((s,e)=>{const{__scopeMenu:t,disabled:n=!1,textValue:r,...a}=s,o=QM(WS,t),l=u8(t),c=C.useRef(null),d=Tt(e,c),[h,f]=C.useState(!1),[m,p]=C.useState("");return C.useEffect(()=>{const x=c.current;x&&p((x.textContent??"").trim())},[a.children]),i.jsx(eb.ItemSlot,{scope:t,disabled:n,textValue:r??m,children:i.jsx(l6,{asChild:!0,...l,focusable:!n,children:i.jsx(ot.div,{role:"menuitem","data-highlighted":h?"":void 0,"aria-disabled":n||void 0,"data-disabled":n?"":void 0,...a,ref:d,onPointerMove:He(s.onPointerMove,tb(x=>{n?o.onItemLeave(x):(o.onItemEnter(x),x.defaultPrevented||x.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:He(s.onPointerLeave,tb(x=>o.onItemLeave(x))),onFocus:He(s.onFocus,()=>f(!0)),onBlur:He(s.onBlur,()=>f(!1))})})})}),Eme="MenuCheckboxItem",y8=C.forwardRef((s,e)=>{const{checked:t=!1,onCheckedChange:n,...r}=s;return i.jsx(S8,{scope:s.__scopeMenu,checked:t,children:i.jsx(qk,{role:"menuitemcheckbox","aria-checked":qS(t)?"mixed":t,...r,ref:e,"data-state":tI(t),onSelect:He(r.onSelect,()=>n==null?void 0:n(qS(t)?!0:!t),{checkForDefaultPrevented:!1})})})});y8.displayName=Eme;var v8="MenuRadioGroup",[Pme,Mme]=km(v8,{value:void 0,onValueChange:()=>{}}),b8=C.forwardRef((s,e)=>{const{value:t,onValueChange:n,...r}=s,a=bl(n);return i.jsx(Pme,{scope:s.__scopeMenu,value:t,onValueChange:a,children:i.jsx(JM,{...r,ref:e})})});b8.displayName=v8;var w8="MenuRadioItem",C8=C.forwardRef((s,e)=>{const{value:t,...n}=s,r=Mme(w8,s.__scopeMenu),a=t===r.value;return i.jsx(S8,{scope:s.__scopeMenu,checked:a,children:i.jsx(qk,{role:"menuitemradio","aria-checked":a,...n,ref:e,"data-state":tI(a),onSelect:He(n.onSelect,()=>{var o;return(o=r.onValueChange)==null?void 0:o.call(r,t)},{checkForDefaultPrevented:!1})})})});C8.displayName=w8;var eI="MenuItemIndicator",[S8,Ime]=km(eI,{checked:!1}),j8=C.forwardRef((s,e)=>{const{__scopeMenu:t,forceMount:n,...r}=s,a=Ime(eI,t);return i.jsx(jl,{present:n||qS(a.checked)||a.checked===!0,children:i.jsx(ot.span,{...r,ref:e,"data-state":tI(a.checked)})})});j8.displayName=eI;var Rme="MenuSeparator",k8=C.forwardRef((s,e)=>{const{__scopeMenu:t,...n}=s;return i.jsx(ot.div,{role:"separator","aria-orientation":"horizontal",...n,ref:e})});k8.displayName=Rme;var Dme="MenuArrow",N8=C.forwardRef((s,e)=>{const{__scopeMenu:t,...n}=s,r=Wk(t);return i.jsx(Q6,{...r,...n,ref:e})});N8.displayName=Dme;var Lme="MenuSub",[kge,A8]=km(Lme),Gy="MenuSubTrigger",_8=C.forwardRef((s,e)=>{const t=Nm(Gy,s.__scopeMenu),n=vw(Gy,s.__scopeMenu),r=A8(Gy,s.__scopeMenu),a=QM(Gy,s.__scopeMenu),o=C.useRef(null),{pointerGraceTimerRef:l,onPointerGraceIntentChange:c}=a,d={__scopeMenu:s.__scopeMenu},h=C.useCallback(()=>{o.current&&window.clearTimeout(o.current),o.current=null},[]);return C.useEffect(()=>h,[h]),C.useEffect(()=>{const f=l.current;return()=>{window.clearTimeout(f),c(null)}},[l,c]),i.jsx(KM,{asChild:!0,...d,children:i.jsx(x8,{id:r.triggerId,"aria-haspopup":"menu","aria-expanded":t.open,"aria-controls":r.contentId,"data-state":P8(t.open),...s,ref:qc(e,r.onTriggerChange),onClick:f=>{var m;(m=s.onClick)==null||m.call(s,f),!(s.disabled||f.defaultPrevented)&&(f.currentTarget.focus(),t.open||t.onOpenChange(!0))},onPointerMove:He(s.onPointerMove,tb(f=>{a.onItemEnter(f),!f.defaultPrevented&&!s.disabled&&!t.open&&!o.current&&(a.onPointerGraceIntentChange(null),o.current=window.setTimeout(()=>{t.onOpenChange(!0),h()},100))})),onPointerLeave:He(s.onPointerLeave,tb(f=>{var p,x;h();const m=(p=t.content)==null?void 0:p.getBoundingClientRect();if(m){const g=(x=t.content)==null?void 0:x.dataset.side,b=g==="right",v=b?-5:5,y=m[b?"left":"right"],w=m[b?"right":"left"];a.onPointerGraceIntentChange({area:[{x:f.clientX+v,y:f.clientY},{x:y,y:m.top},{x:w,y:m.top},{x:w,y:m.bottom},{x:y,y:m.bottom}],side:g}),window.clearTimeout(l.current),l.current=window.setTimeout(()=>a.onPointerGraceIntentChange(null),300)}else{if(a.onTriggerLeave(f),f.defaultPrevented)return;a.onPointerGraceIntentChange(null)}})),onKeyDown:He(s.onKeyDown,f=>{var p;const m=a.searchRef.current!=="";s.disabled||m&&f.key===" "||gme[n.dir].includes(f.key)&&(t.onOpenChange(!0),(p=t.content)==null||p.focus(),f.preventDefault())})})})});_8.displayName=Gy;var T8="MenuSubContent",E8=C.forwardRef((s,e)=>{const t=f8(Ea,s.__scopeMenu),{forceMount:n=t.forceMount,...r}=s,a=Nm(Ea,s.__scopeMenu),o=vw(Ea,s.__scopeMenu),l=A8(T8,s.__scopeMenu),c=C.useRef(null),d=Tt(e,c);return i.jsx(eb.Provider,{scope:s.__scopeMenu,children:i.jsx(jl,{present:n||a.open,children:i.jsx(eb.Slot,{scope:s.__scopeMenu,children:i.jsx(ZM,{id:l.contentId,"aria-labelledby":l.triggerId,...r,ref:d,align:"start",side:o.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:h=>{var f;o.isUsingKeyboardRef.current&&((f=c.current)==null||f.focus()),h.preventDefault()},onCloseAutoFocus:h=>h.preventDefault(),onFocusOutside:He(s.onFocusOutside,h=>{h.target!==l.trigger&&a.onOpenChange(!1)}),onEscapeKeyDown:He(s.onEscapeKeyDown,h=>{o.onClose(),h.preventDefault()}),onKeyDown:He(s.onKeyDown,h=>{var p;const f=h.currentTarget.contains(h.target),m=xme[o.dir].includes(h.key);f&&m&&(a.onOpenChange(!1),(p=l.trigger)==null||p.focus(),h.preventDefault())})})})})})});E8.displayName=T8;function P8(s){return s?"open":"closed"}function qS(s){return s==="indeterminate"}function tI(s){return qS(s)?"indeterminate":s?"checked":"unchecked"}function Ome(s){const e=document.activeElement;for(const t of s)if(t===e||(t.focus(),document.activeElement!==e))return}function Fme(s,e){return s.map((t,n)=>s[(e+n)%s.length])}function Bme(s,e,t){const r=e.length>1&&Array.from(e).every(d=>d===e[0])?e[0]:e,a=t?s.indexOf(t):-1;let o=Fme(s,Math.max(a,0));r.length===1&&(o=o.filter(d=>d!==t));const c=o.find(d=>d.toLowerCase().startsWith(r.toLowerCase()));return c!==t?c:void 0}function $me(s,e){const{x:t,y:n}=s;let r=!1;for(let a=0,o=e.length-1;a<e.length;o=a++){const l=e[a],c=e[o],d=l.x,h=l.y,f=c.x,m=c.y;h>n!=m>n&&t<(f-d)*(n-h)/(m-h)+d&&(r=!r)}return r}function Ume(s,e){if(!e)return!1;const t={x:s.clientX,y:s.clientY};return $me(t,e)}function tb(s){return e=>e.pointerType==="mouse"?s(e):void 0}var zme=h8,Hme=KM,Vme=m8,Wme=p8,qme=JM,Gme=g8,Yme=qk,Kme=y8,Xme=b8,Qme=C8,Zme=j8,Jme=k8,epe=N8,tpe=_8,spe=E8,Gk="DropdownMenu",[npe]=Oa(Gk,[d8]),$r=d8(),[rpe,M8]=npe(Gk),I8=s=>{const{__scopeDropdownMenu:e,children:t,dir:n,open:r,defaultOpen:a,onOpenChange:o,modal:l=!0}=s,c=$r(e),d=C.useRef(null),[h,f]=Lc({prop:r,defaultProp:a??!1,onChange:o,caller:Gk});return i.jsx(rpe,{scope:e,triggerId:gl(),triggerRef:d,contentId:gl(),open:h,onOpenChange:f,onOpenToggle:C.useCallback(()=>f(m=>!m),[f]),modal:l,children:i.jsx(zme,{...c,open:h,onOpenChange:f,dir:n,modal:l,children:t})})};I8.displayName=Gk;var R8="DropdownMenuTrigger",D8=C.forwardRef((s,e)=>{const{__scopeDropdownMenu:t,disabled:n=!1,...r}=s,a=M8(R8,t),o=$r(t);return i.jsx(Hme,{asChild:!0,...o,children:i.jsx(ot.button,{type:"button",id:a.triggerId,"aria-haspopup":"menu","aria-expanded":a.open,"aria-controls":a.open?a.contentId:void 0,"data-state":a.open?"open":"closed","data-disabled":n?"":void 0,disabled:n,...r,ref:qc(e,a.triggerRef),onPointerDown:He(s.onPointerDown,l=>{!n&&l.button===0&&l.ctrlKey===!1&&(a.onOpenToggle(),a.open||l.preventDefault())}),onKeyDown:He(s.onKeyDown,l=>{n||(["Enter"," "].includes(l.key)&&a.onOpenToggle(),l.key==="ArrowDown"&&a.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(l.key)&&l.preventDefault())})})})});D8.displayName=R8;var ipe="DropdownMenuPortal",L8=s=>{const{__scopeDropdownMenu:e,...t}=s,n=$r(e);return i.jsx(Vme,{...n,...t})};L8.displayName=ipe;var O8="DropdownMenuContent",F8=C.forwardRef((s,e)=>{const{__scopeDropdownMenu:t,...n}=s,r=M8(O8,t),a=$r(t),o=C.useRef(!1);return i.jsx(Wme,{id:r.contentId,"aria-labelledby":r.triggerId,...a,...n,ref:e,onCloseAutoFocus:He(s.onCloseAutoFocus,l=>{var c;o.current||(c=r.triggerRef.current)==null||c.focus(),o.current=!1,l.preventDefault()}),onInteractOutside:He(s.onInteractOutside,l=>{const c=l.detail.originalEvent,d=c.button===0&&c.ctrlKey===!0,h=c.button===2||d;(!r.modal||h)&&(o.current=!0)}),style:{...s.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});F8.displayName=O8;var ape="DropdownMenuGroup",ope=C.forwardRef((s,e)=>{const{__scopeDropdownMenu:t,...n}=s,r=$r(t);return i.jsx(qme,{...r,...n,ref:e})});ope.displayName=ape;var lpe="DropdownMenuLabel",B8=C.forwardRef((s,e)=>{const{__scopeDropdownMenu:t,...n}=s,r=$r(t);return i.jsx(Gme,{...r,...n,ref:e})});B8.displayName=lpe;var cpe="DropdownMenuItem",$8=C.forwardRef((s,e)=>{const{__scopeDropdownMenu:t,...n}=s,r=$r(t);return i.jsx(Yme,{...r,...n,ref:e})});$8.displayName=cpe;var dpe="DropdownMenuCheckboxItem",U8=C.forwardRef((s,e)=>{const{__scopeDropdownMenu:t,...n}=s,r=$r(t);return i.jsx(Kme,{...r,...n,ref:e})});U8.displayName=dpe;var upe="DropdownMenuRadioGroup",hpe=C.forwardRef((s,e)=>{const{__scopeDropdownMenu:t,...n}=s,r=$r(t);return i.jsx(Xme,{...r,...n,ref:e})});hpe.displayName=upe;var fpe="DropdownMenuRadioItem",z8=C.forwardRef((s,e)=>{const{__scopeDropdownMenu:t,...n}=s,r=$r(t);return i.jsx(Qme,{...r,...n,ref:e})});z8.displayName=fpe;var mpe="DropdownMenuItemIndicator",H8=C.forwardRef((s,e)=>{const{__scopeDropdownMenu:t,...n}=s,r=$r(t);return i.jsx(Zme,{...r,...n,ref:e})});H8.displayName=mpe;var ppe="DropdownMenuSeparator",V8=C.forwardRef((s,e)=>{const{__scopeDropdownMenu:t,...n}=s,r=$r(t);return i.jsx(Jme,{...r,...n,ref:e})});V8.displayName=ppe;var gpe="DropdownMenuArrow",xpe=C.forwardRef((s,e)=>{const{__scopeDropdownMenu:t,...n}=s,r=$r(t);return i.jsx(epe,{...r,...n,ref:e})});xpe.displayName=gpe;var ype="DropdownMenuSubTrigger",W8=C.forwardRef((s,e)=>{const{__scopeDropdownMenu:t,...n}=s,r=$r(t);return i.jsx(tpe,{...r,...n,ref:e})});W8.displayName=ype;var vpe="DropdownMenuSubContent",q8=C.forwardRef((s,e)=>{const{__scopeDropdownMenu:t,...n}=s,r=$r(t);return i.jsx(spe,{...r,...n,ref:e,style:{...s.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});q8.displayName=vpe;var bpe=I8,wpe=D8,Cpe=L8,G8=F8,Y8=B8,K8=$8,X8=U8,Q8=z8,Z8=H8,J8=V8,eW=W8,tW=q8;const sW=bpe,nW=wpe,Spe=C.forwardRef(({className:s,inset:e,children:t,...n},r)=>i.jsxs(eW,{ref:r,className:Ee("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",e&&"pl-8",s),...n,children:[t,i.jsx(y$,{className:"ml-auto h-4 w-4"})]}));Spe.displayName=eW.displayName;const jpe=C.forwardRef(({className:s,...e},t)=>i.jsx(tW,{ref:t,className:Ee("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...e}));jpe.displayName=tW.displayName;const sI=C.forwardRef(({className:s,sideOffset:e=4,...t},n)=>i.jsx(Cpe,{children:i.jsx(G8,{ref:n,sideOffset:e,className:Ee("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...t})}));sI.displayName=G8.displayName;const mv=C.forwardRef(({className:s,inset:e,...t},n)=>i.jsx(K8,{ref:n,className:Ee("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e&&"pl-8",s),...t}));mv.displayName=K8.displayName;const rW=C.forwardRef(({className:s,children:e,checked:t,...n},r)=>i.jsxs(X8,{ref:r,className:Ee("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:t,...n,children:[i.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:i.jsx(Z8,{children:i.jsx(eM,{className:"h-4 w-4"})})}),e]}));rW.displayName=X8.displayName;const kpe=C.forwardRef(({className:s,children:e,...t},n)=>i.jsxs(Q8,{ref:n,className:Ee("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...t,children:[i.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:i.jsx(Z8,{children:i.jsx(sM,{className:"h-2 w-2 fill-current"})})}),e]}));kpe.displayName=Q8.displayName;const iW=C.forwardRef(({className:s,inset:e,...t},n)=>i.jsx(Y8,{ref:n,className:Ee("px-2 py-1.5 text-sm font-semibold",e&&"pl-8",s),...t}));iW.displayName=Y8.displayName;const bC=C.forwardRef(({className:s,...e},t)=>i.jsx(J8,{ref:t,className:Ee("-mx-1 my-1 h-px bg-muted",s),...e}));bC.displayName=J8.displayName;const wC=[{id:"controls",label:"Controls",icon:i.jsx(ok,{className:"h-4 w-4"}),description:"Pan, zoom, and navigation help"},{id:"terrain",label:"Terrain Types",icon:i.jsx(N$,{className:"h-4 w-4"}),description:"Terrain legend and effects"},{id:"initiative",label:"Initiative Tracker",icon:i.jsx(uk,{className:"h-4 w-4"}),description:"Combat turn order"},{id:"combat",label:"Combat Actions",icon:i.jsx(jo,{className:"h-4 w-4"}),description:"Attack and ability selector"},{id:"zoom",label:"Zoom Controls",icon:i.jsx(Dne,{className:"h-4 w-4"}),description:"Map zoom in/out"}];function Npe(){const{panels:s,showPanel:e,hidePanel:t,resetLayout:n,setAllPanelsVisible:r}=Vk(),a=wC.filter(d=>!s[d.id].isVisible),o=wC.filter(d=>s[d.id].isVisible),l=a.length===0,c=o.length===0;return i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs(sW,{children:[i.jsx(nW,{asChild:!0,children:i.jsxs(q,{variant:"outline",size:"sm",className:Ee("gap-2",a.length>0&&"ring-2 ring-primary/30"),children:[i.jsx(iL,{className:"h-4 w-4"}),"Panels",a.length>0&&i.jsx("span",{className:"bg-primary text-primary-foreground text-xs rounded-full px-1.5 py-0.5 min-w-[1.25rem] text-center",children:a.length})]})}),i.jsxs(sI,{align:"end",className:"w-64",children:[i.jsxs(iW,{className:"flex items-center gap-2",children:[i.jsx(iL,{className:"h-4 w-4"}),"Panel Visibility"]}),i.jsx(bC,{}),i.jsxs("div",{className:"px-2 py-1.5 flex gap-1",children:[i.jsxs(q,{variant:"ghost",size:"sm",className:"flex-1 h-7 text-xs",onClick:()=>r(!0),disabled:l,children:[i.jsx(Ku,{className:"h-3 w-3 mr-1"}),"Show All"]}),i.jsxs(q,{variant:"ghost",size:"sm",className:"flex-1 h-7 text-xs",onClick:()=>r(!1),disabled:c,children:[i.jsx(Sx,{className:"h-3 w-3 mr-1"}),"Hide All"]})]}),i.jsx(bC,{}),wC.map(d=>{const h=s[d.id];return i.jsx(rW,{checked:h.isVisible,onCheckedChange:f=>f?e(d.id):t(d.id),className:"gap-2",children:i.jsxs("span",{className:"flex items-center gap-2 flex-1",children:[d.icon,i.jsx("span",{className:"flex-1",children:d.label})]})},d.id)}),i.jsx(bC,{}),i.jsxs(mv,{onClick:n,className:"gap-2 text-muted-foreground",children:[i.jsx(ck,{className:"h-4 w-4"}),"Reset All Panels"]})]})]}),a.length>0&&a.length<=3&&i.jsx("div",{className:"flex items-center gap-1 border-l pl-2 ml-1",children:a.map(d=>i.jsx(q,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0",onClick:()=>e(d.id),title:`Show ${d.label}`,children:d.icon},d.id))})]})}function Ape(){const{panels:s,showPanel:e,resetLayout:t}=Vk(),n=wC.filter(r=>!s[r.id].isVisible);return n.length===0?null:i.jsxs("div",{className:Ee("fixed bottom-4 left-1/2 -translate-x-1/2 z-50","bg-card/95 backdrop-blur-md border rounded-full shadow-xl","flex items-center gap-2 px-4 py-2","animate-in slide-in-from-bottom-4 duration-300"),children:[i.jsxs("span",{className:"text-xs text-muted-foreground mr-2",children:[n.length," hidden panel",n.length!==1?"s":""]}),n.map(r=>i.jsxs(q,{variant:"ghost",size:"sm",className:"h-8 gap-2",onClick:()=>e(r.id),title:r.description,children:[r.icon,i.jsx("span",{className:"text-xs",children:r.label})]},r.id)),i.jsx("div",{className:"border-l pl-2 ml-1",children:i.jsx(q,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:t,title:"Reset all panels",children:i.jsx(ck,{className:"h-4 w-4"})})})]})}function _pe(){const{selectedMapId:s,enforceSingleOccupancy:e,setEnforceSingleOccupancy:t,editingMode:n,setEditingMode:r,selectedTerrain:a,setSelectedTerrain:o,measurePoints:l,clearMeasurePoints:c,aoeTemplate:d,setAoeTemplate:h,selectedCells:f,clearSelectedCells:m,isMultiSelectMode:p,setIsMultiSelectMode:x,currentInstanceId:g,setCurrentInstanceId:b,triggerResetView:v}=Ju(),[y,w]=C.useState(!1),[S,j]=C.useState("npc_friendly"),[A,k]=C.useState(!1),[_,L]=C.useState(!1),[D,P]=C.useState(""),T=Fe(re.battleTokens.listByMap,s?{mapId:s}:"skip"),B=Re(re.battleTokens.create),R=Re(re.battleMaps.updateCell),O=Re(re.battleMaps.getOrCreateInstance),I=Re(re.battleMaps.saveStateSnapshot),U=Re(re.battleMaps.restoreStateSnapshot),M=Re(re.battleMaps.clearBattleMap),$=Fe(re.battleMaps.getStateSnapshots,g?{instanceId:g}:"skip"),{user:W}=Wc(),ee=async ae=>{s&&(j(ae),w(!0))},Z=async ae=>{s&&await B({mapId:s,x:0,y:0,label:ae.label,type:S,color:S==="npc_friendly"?"#059669":"#dc2626",size:ae.size??1,characterId:ae.characterId,monsterId:ae.monsterId,hp:ae.hp,maxHp:ae.maxHp,speed:ae.speed})},z=async()=>{s&&await B({mapId:s,x:0,y:0,label:S==="pc"?"PC":S==="npc_friendly"?"Ally":"Foe",type:S,color:S==="pc"?"#2563eb":S==="npc_friendly"?"#059669":"#dc2626",size:1})},se=(ae,ce)=>{const Ue=Math.abs(ce.x-ae.x),te=Math.abs(ce.y-ae.y),J=Math.min(Ue,te),K=Math.max(Ue,te)-J;return J*7.5+K*5},de=async()=>{if(!s||!W)return null;if(g)return g;const ae=await O({mapId:s,name:`Instance ${new Date().toLocaleString()}`,clerkId:W.id});return b(ae),ae},ne=async()=>{if(!s||!W)return;const ae=await de();ae&&(await I({instanceId:ae,description:D||`Snapshot ${new Date().toLocaleString()}`,includeMapCells:!0,clerkId:W.id}),P(""),k(!1))},H=async ae=>{if(!s||!W)return;const ce=await de();ce&&(await U({instanceId:ce,snapshotId:ae,clerkId:W.id}),L(!1))},Y=async()=>{!g||!W||confirm("Are you sure you want to clear all tokens from the battle map? This action cannot be undone.")&&await M({instanceId:g,clerkId:W.id})};return i.jsxs("div",{className:"ml-auto flex items-center gap-2 flex-wrap",children:[i.jsxs("div",{className:"flex items-center gap-2 border-r pr-2",children:[i.jsx(q,{variant:n==="token"||n===null?"default":"outline",size:"sm",onClick:()=>r(n==="token"?null:"token"),children:"Token Mode"}),(n==="token"||n===null)&&i.jsxs(i.Fragment,{children:[i.jsx(q,{variant:"outline",size:"sm",onClick:()=>ee("pc"),children:"Add PC"}),i.jsx(q,{variant:"outline",size:"sm",onClick:()=>ee("npc_friendly"),children:"Add Ally"}),i.jsx(q,{variant:"outline",size:"sm",onClick:()=>ee("npc_foe"),children:"Add Foe"})]})]}),i.jsxs("div",{className:"flex items-center gap-2 border-r pr-2",children:[i.jsx(q,{variant:n==="multiselect"?"default":"outline",size:"sm",onClick:()=>{n==="multiselect"?(r(null),m()):(r("multiselect"),m())},children:" Multi-Select"}),n==="multiselect"&&f.size>0&&i.jsxs(i.Fragment,{children:[i.jsxs(q,{variant:"outline",size:"sm",onClick:async()=>{if(!s||!W)return;const ae=Array.from(f).map(ce=>{const[Ue,te]=ce.split(",").map(Number);return R({mapId:s,x:Ue,y:te,terrainType:a,clerkId:W.id})});try{await Promise.all(ae),m()}catch(ce){console.error("Failed to update cells:",ce)}},children:["Paint Terrain (",f.size,")"]}),i.jsx(q,{variant:"outline",size:"sm",onClick:m,children:"Clear Selection"})]})]}),i.jsxs("div",{className:"flex items-center gap-2 border-r pr-2",children:[i.jsx(q,{variant:n==="measure"?"default":"outline",size:"sm",onClick:()=>{n==="measure"?(r(null),c()):(r("measure"),c())},children:" Measure"}),l.length>0&&i.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded",children:l.length===1?"Click end point":`${se(l[0],l[1])}ft`}),l.length>=2&&i.jsx(q,{variant:"ghost",size:"sm",onClick:c,children:"Clear"}),i.jsx(q,{variant:n==="aoe"?"default":"outline",size:"sm",onClick:()=>{n==="aoe"?(r(null),h(null)):(r("aoe"),h({type:"sphere",size:3}))},children:" AoE"}),n==="aoe"&&d&&i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsxs(wt,{value:d.type,onValueChange:ae=>h({...d,type:ae}),children:[i.jsx(gt,{className:"w-24 h-8",children:i.jsx(Ct,{})}),i.jsxs(xt,{children:[i.jsx(Ie,{value:"sphere",children:"Sphere"}),i.jsx(Ie,{value:"cube",children:"Cube"}),i.jsx(Ie,{value:"cone",children:"Cone"}),i.jsx(Ie,{value:"line",children:"Line"})]})]}),i.jsxs(wt,{value:d.size.toString(),onValueChange:ae=>h({...d,size:parseInt(ae)}),children:[i.jsx(gt,{className:"w-20 h-8",children:i.jsx(Ct,{})}),i.jsxs(xt,{children:[i.jsx(Ie,{value:"1",children:"5ft"}),i.jsx(Ie,{value:"2",children:"10ft"}),i.jsx(Ie,{value:"3",children:"15ft"}),i.jsx(Ie,{value:"4",children:"20ft"}),i.jsx(Ie,{value:"6",children:"30ft"}),i.jsx(Ie,{value:"8",children:"40ft"}),i.jsx(Ie,{value:"12",children:"60ft"})]})]})]})]}),i.jsxs("div",{className:"flex items-center gap-2 border-r pr-2",children:[i.jsxs(cs,{open:A,onOpenChange:k,children:[i.jsx(oT,{asChild:!0,children:i.jsxs(q,{variant:"outline",size:"sm",disabled:!s,children:[i.jsx(A$,{className:"w-4 h-4 mr-1"}),"Save State"]})}),i.jsxs(is,{children:[i.jsx(Rs,{children:i.jsx(Ds,{children:"Save Battle Map State"})}),i.jsxs("div",{className:"space-y-4",children:[i.jsx(_e,{placeholder:"Enter description (optional)",value:D,onChange:ae=>P(ae.target.value)}),i.jsx(q,{onClick:ne,className:"w-full",children:"Save Snapshot"})]})]})]}),i.jsxs(cs,{open:_,onOpenChange:L,children:[i.jsx(oT,{asChild:!0,children:i.jsxs(q,{variant:"outline",size:"sm",disabled:!g||!($!=null&&$.length),children:[i.jsx(Uv,{className:"w-4 h-4 mr-1"}),"Restore"]})}),i.jsxs(is,{children:[i.jsx(Rs,{children:i.jsx(Ds,{children:"Restore Previous State"})}),i.jsxs("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:[$==null?void 0:$.map(ae=>i.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[i.jsxs("div",{children:[i.jsx("div",{className:"font-medium",children:ae.description}),i.jsx("div",{className:"text-sm text-gray-500",children:new Date(ae.timestamp).toLocaleString()})]}),i.jsx(q,{size:"sm",onClick:()=>H(ae.id),children:"Restore"})]},ae.id)),!($!=null&&$.length)&&i.jsx("div",{className:"text-center text-gray-500 py-4",children:"No snapshots available"})]})]})]}),i.jsxs(q,{variant:"outline",size:"sm",onClick:v,children:[i.jsx(fne,{className:"w-4 h-4 mr-1"}),"Reset View"]}),i.jsxs(q,{variant:"outline",size:"sm",onClick:Y,disabled:!g||!(T!=null&&T.length),children:[i.jsx(kx,{className:"w-4 h-4 mr-1"}),"Clear Map"]})]}),i.jsxs("div",{className:"flex items-center gap-3",children:[i.jsxs("label",{className:"flex items-center gap-2 text-sm text-neutral-600",children:[i.jsx("input",{type:"checkbox",checked:e,onChange:ae=>t(ae.target.checked),className:"rounded"}),"Single occupancy"]}),i.jsxs("span",{className:"text-xs text-neutral-500",children:["Tokens: ",(T==null?void 0:T.length)??0]})]}),i.jsx("div",{className:"border-l pl-2",children:i.jsx(Npe,{})}),i.jsx(l8,{open:y,onOpenChange:w,tokenType:S,onSelectNPC:Z,onSelectMonster:Z,onCreateGeneric:z})]})}function Tpe({maps:s,value:e,onChange:t}){const{setShowNewMap:n}=Ju();return i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsxs(wt,{value:e??"",onValueChange:r=>t(r||null),children:[i.jsx(gt,{className:"w-64",children:i.jsx(Ct,{placeholder:"Select a map"})}),i.jsx(xt,{children:s.map(r=>i.jsx(Ie,{value:r._id,children:r.name},r._id))})]}),i.jsx(q,{onClick:()=>n(!0),children:"New Map"})]})}const hE={TOKEN:"TOKEN"};function Epe(s,e){const t=Math.abs(e.x-s.x),n=Math.abs(e.y-s.y),r=Math.min(t,n),a=Math.max(t,n)-r;return r*7.5+a*5}function Ppe(s,e,t){const n=Epe(s,e);if(!t.range)switch(t.type){case"MELEE_ATTACK":return n<=5;case"RANGED_ATTACK":return n<=150;case"SPELL":return n<=60;default:return n<=5}const r=t.range.toLowerCase();if(r.includes("touch")||r.includes("self"))return n<=5;const a=r.match(/(\d+)/);if(a){const o=parseInt(a[1]);return n<=o}return!1}function Mpe(s,e){return s.type==="pc"&&e.type==="npc_foe"||s.type==="npc_foe"&&e.type==="pc"||s.type==="npc_foe"&&e.type==="npc_foe"||s.type==="pc"&&e.type==="pc"}function fE(s){return Math.floor(Math.random()*s)+1}function Ipe(s,e){return Array.from({length:s},()=>fE(e))}function Rpe(s,e=!1,t=!1){let n=fE(20),r=fE(20),a=n,o=!1,l=!1;return e&&!t?(a=Math.max(n,r),o=!0):t&&!e&&(a=Math.min(n,r),l=!0),{roll:a,total:a+s,advantage:o,disadvantage:l}}function Dpe(s){if(!s.damageRolls||s.damageRolls.length===0)return{damageRolls:[],totalDamage:0};const e=s.damageRolls.map(n=>{const r=Ipe(n.dice.count,parseInt(n.dice.type.substring(1))),a=r.reduce((o,l)=>o+l,0)+n.modifier;return{rolls:r,total:a,type:n.damageType}}),t=e.reduce((n,r)=>n+r.total,0);return{damageRolls:e,totalDamage:t}}function XO(s,e){let t=0;const n=e.attackBonusAbilityScore;if(n&&"abilityScores"in s){const r=s.abilityScores[n];t+=Math.floor((r-10)/2)}if(e.isProficient)if("level"in s&&s.level){const r=Math.ceil(s.level/4)+1;t+=r}else t+=2;return t}function QO(s,e){if(e.type==="SPELL"&&e.spellLevel&&e.spellLevel>0&&"spellSlots"in s&&s.spellSlots){const t=s.spellSlots.find(n=>n.level===e.spellLevel);if(!t||t.used>=slot.total)return!1}return!0}function Jm(s,e,t){const n=t*Math.sqrt(3),r=t*2,a=s*n+(e%2===1?n/2:0),o=e*(r*.75);return{x:a,y:o}}function MA(s,e,t){const n=t*Math.sqrt(3),r=t*2,a=Math.round(e/(r*.75));let o=Math.round(s/n);a%2===1&&(o=Math.round((s-n/2)/n));let l={x:o,y:a},c=1/0;for(let d=-1;d<=1;d++)for(let h=-1;h<=1;h++){const f={x:o+h,y:a+d},m=Jm(f.x,f.y,t),p=Math.sqrt((s-m.x)**2+(e-m.y)**2);p<c&&(c=p,l=f)}return l}function CC(s,e,t,n){const r=ZO(s,e),a=ZO(t,n);return Lpe(r,a)}function ZO(s,e){const t=s,n=e-(s-s%2)/2,r=-t-n;return{q:t,r:n,s:r}}function Lpe(s,e){return(Math.abs(s.q-e.q)+Math.abs(s.r-e.r)+Math.abs(s.s-e.s))/2}function uy(s,e,t,n,r){const a=[];for(let o=Math.max(0,e-t);o<=Math.min(r-1,e+t);o++)for(let l=Math.max(0,s-t);l<=Math.min(n-1,s+t);l++)CC(s,e,l,o)<=t&&a.push({x:l,y:o});return a}function Ope(s){const e=[];for(let t=0;t<6;t++){const n=Math.PI/3*t-Math.PI/6;e.push({x:s*Math.cos(n),y:s*Math.sin(n)})}return`M ${e.map(t=>`${t.x},${t.y}`).join(" L ")} Z`}function aW(s){const e=[];for(let t=0;t<6;t++){const n=Math.PI/3*t-Math.PI/6,r=50+50*Math.cos(n),a=50+50*Math.sin(n);e.push({x:r,y:a})}return`polygon(${e.map(t=>`${t.x}% ${t.y}%`).join(", ")})`}function Fpe(s,e,t){const n=t*Math.sqrt(3),r=t*2,a=s*n+(e>0&&e%2===1?n/2:0),o=e*(r*.75)+t*.25;return{width:a,height:o}}function Bpe(s,e){const t=Math.max(4,Math.floor(e/8));if(s.length<=t)return s;if(!s.includes(" "))return s.substring(0,t-1)+"";const n=s.split(" ")[0];return n.length<=t?n:n.substring(0,t-1)+""}function $pe({token:s,cellSize:e,allTokens:t=[]}){const n=s.size*e,{actualTheme:r}=Ox(),a=r==="dark",o=bfe(a),[{isDragging:l},c]=JJ(()=>({type:hE.TOKEN,item:()=>({id:s._id,type:hE.TOKEN,offsetX:n/2,offsetY:n/2}),collect:I=>({isDragging:I.isDragging()})}),[s._id,n]),{setEditingTokenId:d,selectedTokenForMovement:h,setSelectedTokenForMovement:f,editingMode:m,combatState:p,setAttackerToken:x,setTargetToken:g,setAvailableActions:b,setIsCombatMode:v,clearCombatState:y,initiativeState:w}=Ju();Re(re.battleTokens.update);const S=Fe(re.characters.getCharacterWithActions,s.characterId?{characterId:s.characterId}:"skip"),j=Fe(re.monsters.getMonsterById,s.monsterId?{monsterId:s.monsterId}:"skip"),A=S||j,k=s.hp!==void 0&&s.maxHp!==void 0,_=k?s.hp/s.maxHp*100:100,L=h===s._id,D=I=>{var U;if(I.stopPropagation(),m==="token"||m===null)if(p.isCombatMode&&p.attackerTokenId){const M=t.find($=>$._id===p.attackerTokenId);if(M&&Mpe(M,s)&&(g(s._id),A&&A.resolvedActions)){const $=A.resolvedActions.filter(W=>Ppe(M,s,W));b($)}}else{if(w.isInCombat&&w.currentTurnIndex!==null){const M=w.initiativeOrder[w.currentTurnIndex];if(M&&M.tokenId!==s._id){const $=((U=t.find(W=>W._id===M.tokenId))==null?void 0:U.label)||M.label;rt.error(`It's ${$}'s turn. Only the current turn's token can be selected for movement during combat.`);return}}f(L?null:s._id)}},P=I=>{I.preventDefault(),I.stopPropagation(),(m==="token"||m===null)&&(x(s._id),v(!0),A&&A.resolvedActions&&b(A.resolvedActions))},T=p.attackerTokenId===s._id,B=p.targetTokenId===s._id,R=p.isCombatMode,O=aW();return i.jsxs("div",{ref:c,onClick:D,onDoubleClick:I=>{I.stopPropagation(),d(s._id)},onContextMenu:P,className:Ee("absolute flex flex-col items-center justify-center text-white font-medium select-none cursor-move transition-all overflow-hidden",l&&"opacity-50",L&&"ring-4 ring-pacific-cyan-400 ring-opacity-80 scale-110",T&&"ring-4 ring-rich-cerulean-400 ring-opacity-80 scale-110",B&&"ring-4 ring-cherry-rose-400 ring-opacity-80 scale-110"),style:{width:n,height:n,backgroundColor:s.color,clipPath:O,WebkitClipPath:O,boxShadow:L?`0 0 20px ${o.selected}`:T?`0 0 20px ${o.movement}`:B?`0 0 20px ${o.attack}`:"0 0 0 2px rgba(0,0,0,0.3) inset",transform:"translate(-50%, -50%)"},title:`${s.label} (${s.type})${k?` - ${s.hp}/${s.maxHp} HP`:""}${s.speed?` - ${s.speed}ft speed`:""}${R?" - Right-click to attack":""}`,children:[i.jsx("span",{className:"text-xs md:text-sm px-1 text-center z-10",children:Bpe(s.label,n)}),k&&i.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-black bg-opacity-30",children:i.jsx("div",{className:"h-full transition-all",style:{width:`${Math.max(0,Math.min(100,_))}%`,backgroundColor:vfe(_,a)}})}),k&&e>=40&&i.jsxs("span",{className:"text-[10px] absolute bottom-1 z-10 text-white drop-shadow-md",children:[s.hp,"/",s.maxHp]})]})}function Upe({className:s=""}){const{actualTheme:e}=Ox(),n=YV(e==="dark"),r=["normal","difficult","hazardous","magical","water","ice","fire","acid","poison","unstable"],a=s.includes("border-0")||s.includes("shadow-none"),o=i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"space-y-2",children:r.map(l=>{const c=Cfe[l],d=n[l];return i.jsxs("div",{className:"border-b border-border/50 pb-2 last:border-b-0",children:[i.jsxs("div",{className:"flex items-center gap-2 text-xs mb-1",children:[i.jsx("div",{className:"w-4 h-4 rounded border border-gray-300 flex-shrink-0",style:{backgroundColor:d},title:`${c.description}`}),i.jsx("span",{className:"text-muted-foreground",children:c.icon}),i.jsx("span",{className:"text-foreground font-medium capitalize",children:l}),i.jsxs("span",{className:"text-muted-foreground ml-auto",children:["",c.movementCost]})]}),i.jsx("div",{className:"text-xs text-muted-foreground ml-6",children:c.effects.map((h,f)=>i.jsxs("div",{className:"text-xs",children:[" ",h]},f))})]},l)})}),i.jsx("div",{className:"mt-3 pt-2 border-t border-border",children:i.jsxs("div",{className:"text-xs text-muted-foreground",children:[i.jsx("div",{className:"font-medium mb-1",children:"Movement Cost Guide:"}),i.jsx("div",{children:" 1 = Normal movement (5ft)"}),i.jsx("div",{children:" 2 = Difficult terrain (10ft)"}),i.jsx("div",{className:"mt-1 font-medium",children:"Effects may require:"}),i.jsx("div",{children:" Dexterity saves (falling)"}),i.jsx("div",{children:" Constitution saves (damage)"}),i.jsx("div",{children:" Swimming checks (water)"})]})})]});return a?i.jsx("div",{className:Ee("px-3 pb-3",s),children:o}):i.jsx("div",{className:Ee("bg-card/95 border backdrop-blur-sm rounded-lg shadow-lg pointer-events-auto max-w-xs",s),children:i.jsx("div",{className:"px-3 py-3",children:o})})}function zpe({attacker:s,target:e,attackerEntity:t,availableActions:n,onActionSelected:r,onCancel:a}){const{combatState:o,setSelectedAction:l}=Ju(),c=Re(re.battleTokens.update),d=Fe(re.characters.getCharacterWithActions,s.characterId?{characterId:s.characterId}:"skip"),h=Fe(re.monsters.getMonsterWithActions,s.monsterId?{monsterId:s.monsterId}:"skip"),f=d||h,m=async g=>{if(!f||!QO(f,g))return;l(g);const b=XO(f,g),v=Rpe(b);if(v.total>=10){const w=Dpe(g);if(e.hp!==void 0){const S=Math.max(0,e.hp-w.totalDamage);await c({id:e._id,hp:S})}alert(`${s.label} attacks ${e.label} with ${g.name}!
Attack Roll: ${v.roll} + ${b} = ${v.total}
Damage: ${w.totalDamage}`)}else alert(`${s.label} attacks ${e.label} with ${g.name}!
Attack Roll: ${v.roll} + ${b} = ${v.total}
Miss!`);r(g)},p=g=>{switch(g){case"MELEE_ATTACK":return"bg-red-100 text-red-800";case"RANGED_ATTACK":return"bg-blue-100 text-blue-800";case"SPELL":return"bg-purple-100 text-purple-800";case"BONUS_ACTION":return"bg-green-100 text-green-800";case"REACTION":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},x=g=>{switch(g){case"Action":return"bg-red-100 text-red-800";case"Bonus Action":return"bg-green-100 text-green-800";case"Reaction":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}};return i.jsxs(oe,{className:"w-96 max-h-[80vh]",children:[i.jsxs(ke,{children:[i.jsxs(Ne,{className:"flex items-center justify-between",children:[i.jsx("span",{children:"Combat Action"}),i.jsx(q,{variant:"ghost",size:"sm",onClick:a,children:""})]}),i.jsxs(At,{children:[s.label,"  ",e.label]})]}),i.jsx(he,{children:i.jsx(go,{className:"h-[60vh]",children:i.jsx("div",{className:"space-y-3",children:n.length===0?i.jsx("div",{className:"text-center text-gray-500 py-8",children:"No available actions"}):n.map(g=>{const b=f?QO(f,g):!1,v=f?XO(f,g):0;return i.jsx(oe,{className:`cursor-pointer transition-colors ${b?"hover:bg-gray-50":"opacity-50 cursor-not-allowed"}`,children:i.jsxs(he,{className:"p-4",children:[i.jsxs("div",{className:"flex items-start justify-between mb-2",children:[i.jsx("h3",{className:"font-semibold text-sm",children:g.name}),i.jsxs("div",{className:"flex gap-1",children:[i.jsx(ue,{className:p(g.type),children:g.type.replace("_"," ")}),i.jsx(ue,{className:x(g.actionCost),children:g.actionCost})]})]}),i.jsx("p",{className:"text-xs text-gray-600 mb-3 line-clamp-2",children:g.description}),g.damageRolls&&g.damageRolls.length>0&&i.jsxs("div",{className:"mb-2",children:[i.jsx("div",{className:"text-xs font-medium text-gray-700 mb-1",children:"Damage:"}),i.jsx("div",{className:"text-xs text-gray-600",children:g.damageRolls.map((y,w)=>i.jsxs("span",{children:[y.dice.count,"d",y.dice.type.substring(1),y.modifier>=0?"+":"",y.modifier," ",y.damageType,w<g.damageRolls.length-1?" + ":""]},w))})]}),g.range&&i.jsxs("div",{className:"mb-2",children:[i.jsx("div",{className:"text-xs font-medium text-gray-700",children:"Range:"}),i.jsx("div",{className:"text-xs text-gray-600",children:g.range})]}),g.type==="MELEE_ATTACK"||g.type==="RANGED_ATTACK"?i.jsxs("div",{className:"mb-2",children:[i.jsx("div",{className:"text-xs font-medium text-gray-700",children:"Attack Bonus:"}),i.jsxs("div",{className:"text-xs text-gray-600",children:["+",v]})]}):null,g.spellLevel!==void 0&&i.jsxs("div",{className:"mb-2",children:[i.jsx("div",{className:"text-xs font-medium text-gray-700",children:"Spell Level:"}),i.jsx("div",{className:"text-xs text-gray-600",children:g.spellLevel===0?"Cantrip":`Level ${g.spellLevel}`})]}),i.jsx(q,{size:"sm",className:"w-full",onClick:()=>m(g),disabled:!b,children:b?"Use Action":"Cannot Use"})]})},g._id)})})})})]})}function Hpe({mapId:s}){const{initiativeState:e,setInitiativeOrder:t,setCurrentTurnIndex:n,nextTurn:r,previousTurn:a,startCombat:o,endCombat:l}=Ju(),c=Fe(re.battleTokens.listByMap,{mapId:s}),[d,h]=C.useState(null),f=Fe(re.battleMaps.getTokenEntities,c&&c.length>0?{tokenIds:c.map(p=>p._id)}:"skip"),m=()=>{var x,g,b;if(!f||f.length===0)return;const p=[];for(const v of f){if(!v.character&&!v.monster)continue;let y=null,w=10;if(v.character){const A=v.character;y={abilityScores:A.abilityScores,abilityModifiers:A.abilityModifiers,classes:A.classes,feats:A.feats,features:A.features,equipmentBonuses:A.equipmentBonuses,conditions:v.token.conditions},w=((x=A.abilityScores)==null?void 0:x.dexterity)||10}else if(v.monster){const A=v.monster;y={abilityScores:A.abilityScores,abilityModifiers:A.abilityModifiers,dexterity:(g=A.abilityScores)==null?void 0:g.dexterity},w=((b=A.abilityScores)==null?void 0:b.dexterity)||10}if(!y)continue;const S=VM(y),j=afe(S,w,void 0,void 0,S.diceBonus);p.push({tokenId:v.tokenId,label:v.token.label,roll:j.roll,modifier:j.modifier,total:j.total,dexterityScore:w,type:v.token.type,characterId:v.token.characterId,monsterId:v.token.monsterId})}p.sort((v,y)=>y.total!==v.total?y.total-v.total:y.dexterityScore!==v.dexterityScore?y.dexterityScore-v.dexterityScore:0),t(p),e.isInCombat||o()};return e.currentTurnIndex!==null&&e.initiativeOrder[e.currentTurnIndex],!c||c.length===0?i.jsx("div",{className:"p-3",children:i.jsx("p",{className:"text-sm text-muted-foreground",children:"Add tokens to the map to roll initiative"})}):i.jsxs("div",{className:"w-full",children:[i.jsx("div",{className:"px-3 pt-2 pb-3",children:i.jsxs("div",{className:"flex items-center justify-between gap-2 flex-wrap",children:[e.isInCombat&&i.jsxs(ue,{variant:"destructive",className:"text-xs",children:["Round ",e.roundNumber]}),e.initiativeOrder.length>0?i.jsxs("div",{className:"flex items-center gap-1",children:[i.jsx(q,{variant:"outline",size:"sm",className:"h-7 w-7 p-0",onClick:a,disabled:!e.isInCombat,children:i.jsx(hne,{className:"w-4 h-4"})}),i.jsx(q,{variant:"outline",size:"sm",className:"h-7 w-7 p-0",onClick:r,disabled:!e.isInCombat,children:i.jsx(y$,{className:"w-4 h-4"})}),i.jsx(q,{variant:"outline",size:"sm",className:"h-7 w-7 p-0",onClick:l,children:i.jsx(_$,{className:"w-4 h-4"})})]}):i.jsxs(q,{variant:"default",size:"sm",className:"h-7",onClick:m,disabled:!f||f.length===0,children:[i.jsx(mne,{className:"w-4 h-4 mr-1"}),"Roll"]})]})}),i.jsx("div",{className:"px-3 pb-3 space-y-2",children:e.initiativeOrder.length===0?i.jsx("p",{className:"text-sm text-muted-foreground",children:'Click "Roll Initiative" to determine turn order'}):i.jsx("div",{className:"space-y-1",children:e.initiativeOrder.map((p,x)=>{const g=e.currentTurnIndex===x&&e.isInCombat,b={pc:"bg-blue-500",npc_friendly:"bg-green-500",npc_foe:"bg-red-500"};return i.jsxs("div",{className:`flex items-center justify-between p-2 rounded border transition-colors ${g?"bg-primary/10 border-primary":"bg-muted/50 border-border"}`,children:[i.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[i.jsx("div",{className:`w-2 h-2 rounded-full flex-shrink-0 ${b[p.type]}`}),i.jsx("span",{className:`text-sm font-medium truncate ${g?"font-bold":""}`,children:p.label}),g&&i.jsx(ue,{variant:"default",className:"text-xs",children:"Current"})]}),i.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[i.jsx(q,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>h(d===p.tokenId?null:p.tokenId),title:`Roll: ${p.roll} + Mod: ${p.modifier>=0?"+":""}${p.modifier}
Total: ${p.total}
Dex: ${p.dexterityScore}`,children:i.jsx(ok,{className:"w-3 h-3"})}),i.jsx("span",{className:"text-sm font-semibold w-8 text-right",children:p.total})]}),d===p.tokenId&&i.jsxs("div",{className:"text-xs text-muted-foreground mt-1 p-2 bg-muted rounded",children:[i.jsxs("div",{children:["Roll: ",p.roll]}),i.jsxs("div",{children:["Modifier: ",p.modifier>=0?"+":"",p.modifier]}),i.jsxs("div",{children:["Total: ",p.total]}),i.jsxs("div",{children:["Dex Score: ",p.dexterityScore]})]})]},p.tokenId)})})})]})}function hy({id:s,title:e,children:t,className:n,defaultWidth:r=280,minWidth:a=200,maxWidth:o=600,anchor:l="free",showMinimize:c=!0,closable:d=!0,icon:h,minimizedContent:f}){const{panels:m,updatePanelPosition:p,togglePanelMinimized:x,hidePanel:g,bringToFront:b}=Vk(),v=m[s],y=C.useRef(null),[w,S]=C.useState(!1),[j,A]=C.useState({x:0,y:0}),[k,_]=C.useState(!1),[L,D]=C.useState(r),[P,T]=C.useState(!1),B=C.useCallback(()=>{const W=v.position,ee={zIndex:v.zIndex};switch(l){case"top-left":ee.left=W.x,ee.top=W.y;break;case"top-right":ee.right=Math.abs(W.x),ee.top=W.y;break;case"bottom-left":ee.left=W.x,ee.bottom=Math.abs(W.y);break;case"bottom-right":ee.right=Math.abs(W.x),ee.bottom=Math.abs(W.y);break;case"free":default:ee.left=W.x,ee.top=W.y;break}return ee},[l,v.position,v.zIndex]),R=C.useCallback(W=>{if(k)return;W.preventDefault(),W.stopPropagation(),b(s),S(!0);const ee="touches"in W?W.touches[0].clientX:W.clientX,Z="touches"in W?W.touches[0].clientY:W.clientY;if(y.current){const z=y.current.getBoundingClientRect();A({x:ee-z.left,y:Z-z.top})}},[k,b,s]),O=C.useCallback(W=>{if(!w||!y.current)return;const ee="touches"in W?W.touches[0].clientX:W.clientX,Z="touches"in W?W.touches[0].clientY:W.clientY,z=y.current.parentElement;if(!z)return;const se=z.getBoundingClientRect(),de=y.current.getBoundingClientRect();let ne=ee-se.left-j.x,H=Z-se.top-j.y;switch(ne=Math.max(0,Math.min(ne,se.width-de.width)),H=Math.max(0,Math.min(H,se.height-de.height)),l){case"top-right":ne=-(se.width-ne-de.width);break;case"bottom-left":H=-(se.height-H-de.height);break;case"bottom-right":ne=-(se.width-ne-de.width),H=-(se.height-H-de.height);break}p(s,{x:ne,y:H})},[w,j,l,s,p]),I=C.useCallback(()=>{S(!1)},[]),U=C.useCallback(W=>{W.preventDefault(),W.stopPropagation(),T(!0)},[]),M=C.useCallback(W=>{if(!P||!y.current)return;const ee=y.current.getBoundingClientRect(),Z=W.clientX-ee.left;D(Math.max(a,Math.min(o,Z)))},[P,a,o]),$=C.useCallback(()=>{T(!1)},[]);return C.useEffect(()=>(w&&(window.addEventListener("mousemove",O),window.addEventListener("mouseup",I),window.addEventListener("touchmove",O),window.addEventListener("touchend",I)),()=>{window.removeEventListener("mousemove",O),window.removeEventListener("mouseup",I),window.removeEventListener("touchmove",O),window.removeEventListener("touchend",I)}),[w,O,I]),C.useEffect(()=>(P&&(window.addEventListener("mousemove",M),window.addEventListener("mouseup",$)),()=>{window.removeEventListener("mousemove",M),window.removeEventListener("mouseup",$)}),[P,M,$]),v.isVisible?i.jsxs("div",{ref:y,className:Ee("absolute bg-card/95 backdrop-blur-sm border rounded-lg shadow-xl pointer-events-auto","transition-shadow duration-200",w&&"shadow-2xl ring-2 ring-primary/30 cursor-grabbing",P&&"select-none",n),style:{...B(),width:v.isMinimized?"auto":L},onClick:()=>b(s),children:[i.jsxs("div",{className:Ee("flex items-center gap-2 px-3 py-2 border-b rounded-t-lg","bg-gradient-to-r from-muted/50 to-transparent",!k&&"cursor-grab hover:bg-muted/70",w&&"cursor-grabbing"),onMouseDown:R,onTouchStart:R,children:[i.jsx(yne,{className:Ee("h-4 w-4 text-muted-foreground/60 flex-shrink-0",k&&"opacity-30")}),h&&i.jsx("span",{className:"flex-shrink-0",children:h}),i.jsx("span",{className:"font-semibold text-sm text-foreground flex-1 truncate select-none",children:e}),i.jsxs("div",{className:"flex items-center gap-1",onClick:W=>W.stopPropagation(),children:[i.jsx("button",{className:Ee("p-1 rounded hover:bg-muted transition-colors",k&&"text-primary"),onClick:()=>_(!k),title:k?"Unpin panel":"Pin panel in place",children:k?i.jsx(Mne,{className:"h-3 w-3"}):i.jsx(Pne,{className:"h-3 w-3"})}),c&&i.jsx("button",{className:"p-1 rounded hover:bg-muted transition-colors",onClick:()=>x(s),title:v.isMinimized?"Expand panel":"Minimize panel",children:v.isMinimized?i.jsx(Sne,{className:"h-3 w-3"}):i.jsx(Nne,{className:"h-3 w-3"})}),d&&i.jsx("button",{className:"p-1 rounded hover:bg-destructive/20 hover:text-destructive transition-colors",onClick:()=>g(s),title:"Hide panel",children:i.jsx(Mr,{className:"h-3 w-3"})})]})]}),v.isMinimized?f&&i.jsx("div",{className:"px-3 py-2 text-sm text-muted-foreground",children:f}):i.jsxs("div",{className:"relative",children:[t,i.jsx("div",{className:Ee("absolute bottom-0 right-0 w-3 h-3 cursor-se-resize","hover:bg-primary/20 rounded-br-lg transition-colors"),onMouseDown:U,style:{borderRight:"2px solid var(--border)",borderBottom:"2px solid var(--border)"}})]})]}):null}function Vpe({mapId:s}){var Ur,zr;const e=Fe(re.battleMaps.get,{id:s}),t=Fe(re.battleTokens.listByMap,{mapId:s}),n=Re(re.battleTokens.move),r=Re(re.battleMaps.updateCell),{enforceSingleOccupancy:a,editingMode:o,selectedTerrain:l,measurePoints:c,setMeasurePoints:d,aoeTemplate:h,selectedTokenForMovement:f,setSelectedTokenForMovement:m,selectedCells:p,addSelectedCell:x,removeSelectedCell:g,combatState:b,clearCombatState:v,initiativeState:y,resetView:w}=Ju(),{panels:S}=Vk(),{user:j}=Wc(),{actualTheme:A}=Ox(),k=A==="dark",_=YV(k),L=wfe(k),D=C.useRef(null),P=C.useRef(null),[T,B]=C.useState(null),[R,O]=C.useState(null),[I,U]=C.useState({x:0,y:0}),[M,$]=C.useState(1),[W,ee]=C.useState(!1),[Z,z]=C.useState({x:0,y:0}),[se,de]=C.useState(0),[,ne]=C.useState({x:0,y:0}),[{isOver:H},Y]=oee(()=>({accept:hE.TOKEN,drop:async(xe,Ke)=>{if(!e)return;if(y.isInCombat&&y.currentTurnIndex!==null){const Zn=y.initiativeOrder[y.currentTurnIndex];if(Zn&&Zn.tokenId!==xe.id){rt.error(`It's ${Zn.label}'s turn. Only the current turn's token can move during combat.`);return}}const tt=Ke.getClientOffset();if(!tt||!D.current)return;const lt=D.current.getBoundingClientRect(),St=(tt.x-lt.left-xe.offsetX)/M-I.x,gs=(tt.y-lt.top-xe.offsetY)/M-I.y,Dt=e.cellSize/2,{x:it,y:Ys}=MA(St,gs,Dt);try{await n({id:xe.id,x:it,y:Ys,enforceSingleOccupancy:a})}catch(Zn){console.error(Zn);const Yc=(Zn==null?void 0:Zn.message)||"Failed to move token";rt.error(Yc)}},collect:xe=>({isOver:xe.isOver()})}),[e,n,a,M,I,y]),ae=C.useCallback(xe=>{xe&&(D.current=xe),Y(xe)},[Y]),ce=C.useCallback(xe=>{(xe.button===1||xe.button===0&&xe.shiftKey)&&(ee(!0),z({x:xe.clientX-I.x,y:xe.clientY-I.y}),de(Date.now()),ne({x:0,y:0}),xe.preventDefault(),xe.stopPropagation())},[I]),Ue=C.useCallback(xe=>{if(W){const Ke=Date.now(),tt=Ke-se;if(tt>0){const lt={x:xe.clientX-Z.x,y:xe.clientY-Z.y},St={x:(lt.x-I.x)/tt,y:(lt.y-I.y)/tt};U(lt),ne(St),de(Ke)}xe.preventDefault(),xe.stopPropagation()}else if(D.current&&e){const Ke=D.current.getBoundingClientRect(),tt=(xe.clientX-Ke.left)/M-I.x,lt=(xe.clientY-Ke.top)/M-I.y,St=e.cellSize/2,{x:gs,y:Dt}=MA(tt,lt,St);gs>=0&&gs<e.cols&&Dt>=0&&Dt<e.rows?((R==null?void 0:R.x)!==gs||(R==null?void 0:R.y)!==Dt)&&O({x:gs,y:Dt}):O(null)}},[W,Z,I,se,D,e,M,R]),te=C.useCallback(xe=>{W&&(ee(!1),xe.preventDefault(),xe.stopPropagation())},[W]),J=C.useCallback(xe=>{W&&xe.preventDefault()},[W]),K=C.useCallback(xe=>{if(xe.ctrlKey||xe.metaKey){xe.preventDefault();const Ke=xe.deltaY>0?.9:1.1;$(tt=>Math.max(.25,Math.min(4,tt*Ke)))}else if(!W){xe.preventDefault();const Ke=50;U(tt=>({x:tt.x-xe.deltaX*Ke,y:tt.y-xe.deltaY*Ke}))}},[W]),be=C.useCallback(()=>{$(1),U({x:0,y:0}),ne({x:0,y:0})},[]);C.useEffect(()=>{w!==void 0&&be()},[w,be]);const Me=C.useCallback(xe=>{if(xe.touches.length===1){const Ke=xe.touches[0];ee(!0),z({x:Ke.clientX-I.x,y:Ke.clientY-I.y}),de(Date.now()),ne({x:0,y:0}),xe.preventDefault()}},[I]),De=C.useCallback(xe=>{if(W&&xe.touches.length===1){const Ke=xe.touches[0],tt=Date.now(),lt=tt-se;if(lt>0){const St={x:Ke.clientX-Z.x,y:Ke.clientY-Z.y},gs={x:(St.x-I.x)/lt,y:(St.y-I.y)/lt};U(St),ne(gs),de(tt)}xe.preventDefault()}},[W,Z,I,se]),_t=C.useCallback(xe=>{W&&(ee(!1),xe.preventDefault())},[W]),et=C.useCallback(()=>{if(!f||!t||!e)return{range:0,cells:new Set,token:null};const xe=t.find(St=>St._id===f);if(!xe||!xe.speed)return{range:0,cells:new Set,token:null};const Ke=Math.floor(xe.speed/5),tt=new Set;return uy(xe.x,xe.y,Ke,e.cols,e.rows).forEach(St=>{tt.add(`${St.x},${St.y}`)}),{range:Ke,cells:tt,token:xe}},[f,t,e]),G=C.useCallback(()=>{if(!h||!T||!e)return new Set;const xe=new Set,{type:Ke,size:tt}=h;switch(Ke){case"sphere":uy(T.x,T.y,tt,e.cols,e.rows).forEach(it=>{xe.add(`${it.x},${it.y}`)});break;case"cube":uy(T.x,T.y,tt,e.cols,e.rows).forEach(it=>{xe.add(`${it.x},${it.y}`)});break;case"cone":uy(T.x,T.y,tt,e.cols,e.rows).forEach(it=>{if(it.x>=T.x){const Ys=Math.atan2(it.y-T.y,it.x-T.x);Math.abs(Ys)<=Math.PI/3&&xe.add(`${it.x},${it.y}`)}});break;case"line":uy(T.x,T.y,tt,e.cols,e.rows).forEach(it=>{Math.abs(it.y-T.y)<=1&&it.x>=T.x&&it.x<=T.x+tt&&xe.add(`${it.x},${it.y}`)});break}return xe},[h,T,e]),Q=C.useMemo(()=>((e==null?void 0:e.cellSize)??40)/2,[e==null?void 0:e.cellSize]),ie=C.useMemo(()=>e?Fpe(e.cols,e.rows,Q):{width:0,height:0},[e==null?void 0:e.cols,e==null?void 0:e.rows,Q]),ve=C.useMemo(()=>Ope(Q),[Q]),we=C.useMemo(()=>aW(),[Q]),je=C.useMemo(()=>{if(!e)return[];const xe=[],Ke=Q*2,tt=Ke;for(let lt=0;lt<e.rows;lt++)for(let St=0;St<e.cols;St++){const gs=Jm(St,lt,Q);xe.push(i.jsx("svg",{className:"absolute pointer-events-none",style:{left:gs.x-Q,top:gs.y-Q,width:Ke,height:Ke},viewBox:`${-Q} ${-Q} ${tt} ${tt}`,preserveAspectRatio:"xMidYMid meet",children:i.jsx("path",{d:ve,fill:"none",stroke:"rgba(0,0,0,0.4)",strokeWidth:"1.5",strokeLinejoin:"round",strokeLinecap:"round"})},`grid-${St}-${lt}`))}return xe},[e==null?void 0:e.rows,e==null?void 0:e.cols,Q,ve]);if(!e)return i.jsx("div",{className:"p-4",children:"Loading map"});const Ye=async(xe,Ke)=>{var tt;if(!W){if(f&&t&&e){const lt=t.find(St=>St._id===f);if(lt&&lt.speed){if(y.isInCombat&&y.currentTurnIndex!==null){const it=y.initiativeOrder[y.currentTurnIndex];if(it&&it.tokenId!==lt._id){const Ys=((tt=t.find(Zn=>Zn._id===it.tokenId))==null?void 0:tt.label)||it.label;rt.error(`It's ${Ys}'s turn. Only the current turn's token can move during combat.`);return}}const St=et(),gs=`${xe},${Ke}`,Dt=CC(lt.x,lt.y,xe,Ke);if(St.cells.has(gs)&&Dt<=St.range){if(a&&t.some(Ys=>Ys._id!==lt._id&&Ys.x===xe&&Ys.y===Ke)){console.log("Cannot move to occupied cell");return}try{await n({id:lt._id,x:xe,y:Ke}),m(null)}catch(it){console.error("Failed to move token:",it);const Ys=(it==null?void 0:it.message)||"Failed to move token";rt.error(Ys)}}return}}switch(o){case"terrain":if(l&&j)try{await r({mapId:e._id,x:xe,y:Ke,terrainType:l,clerkId:j.id})}catch(St){console.error("Failed to update cell:",St)}break;case"measure":c.length===0?d([{x:xe,y:Ke}]):c.length===1?d([...c,{x:xe,y:Ke}]):d([{x:xe,y:Ke}]);break;case"aoe":B({x:xe,y:Ke});break;case"multiselect":const lt=`${xe},${Ke}`;p.has(lt)?g(xe,Ke):x(xe,Ke);break}}},Ft=(xe,Ke)=>{var lt;const tt=(lt=e.cells)==null?void 0:lt.find(St=>St.x===xe&&St.y===Ke);return tt!=null&&tt.customColor?tt.customColor:tt!=null&&tt.terrainType&&_[tt.terrainType]||_.normal},Wt={width:ie.width,height:ie.height},vn=()=>{var St,gs;if(!e)return[];const xe=[],Ke=G(),tt=et(),lt=tt.cells;for(let Dt=0;Dt<e.rows;Dt++)for(let it=0;it<e.cols;it++){const Ys=Ft(it,Dt),Zn=Ke.has(`${it},${Dt}`),Yc=c.some(cn=>cn.x===it&&cn.y===Dt),eh=lt.has(`${it},${Dt}`),ct=(R==null?void 0:R.x)===it&&(R==null?void 0:R.y)===Dt,Ks=p.has(`${it},${Dt}`);if(Ys!==_.normal||o==="terrain"||o==="measure"||o==="aoe"||o==="multiselect"||Zn||Yc||eh||ct||Ks){const cn=Jm(it,Dt,Q);let dn={left:cn.x-Q,top:cn.y-Q,width:Q*2,height:Q*2,clipPath:we,WebkitClipPath:we},ks="absolute pointer-events-auto cursor-pointer transition-all";Ks?(dn.backgroundColor=L.multiSelect,dn.border=`2px solid ${k?"rgba(0, 201, 241, 0.8)":"rgba(0, 145, 173, 0.8)"}`,ks+=" ring-2 ring-pacific-cyan-400"):Zn?(dn.backgroundColor=L.aoe,dn.border=`2px solid ${k?"rgba(214, 35, 118, 0.7)":"rgba(160, 26, 88, 0.7)"}`,ks+=" animate-pulse"):Yc?(dn.backgroundColor=L.measurePoint,dn.border=`2px solid ${k?"rgba(61, 146, 196, 0.9)":"rgba(46, 111, 149, 0.9)"}`):eh&&!ct?(Ys!==_.normal?dn.backgroundColor=Ys:dn.backgroundColor=L.movementRange,dn.border=`2px solid ${k?"rgba(0, 201, 241, 0.6)":"rgba(0, 145, 173, 0.6)"}`):eh&&ct?(Ys!==_.normal?dn.backgroundColor=Ys:dn.backgroundColor=L.movementHover,dn.border=`3px solid ${k?"rgba(0, 201, 241, 0.9)":"rgba(0, 145, 173, 0.9)"}`,ks+=" ring-2 ring-pacific-cyan-400"):Ys!==_.normal?(dn.backgroundColor=Ys,ks+=" hover:brightness-110"):(o==="terrain"||o==="measure"||o==="aoe"||o==="multiselect")&&(ks+=" hover:bg-neutral-200 hover:bg-opacity-30");const Hr=tt.token?CC(tt.token.x,tt.token.y,it,Dt):0;xe.push(i.jsx("div",{className:ks,style:dn,onClick:()=>Ye(it,Dt),onMouseEnter:()=>O({x:it,y:Dt}),onMouseLeave:()=>O(null),title:Zn?"AoE Target":Yc?"Measurement Point":eh?`Move here (${Hr} hexes)`:((gs=(St=e.cells)==null?void 0:St.find(th=>th.x===it&&th.y===Dt))==null?void 0:gs.terrainType)||"normal"},`${it}-${Dt}`))}}return xe};return i.jsxs("div",{ref:P,className:"w-full h-full overflow-hidden relative select-none",onMouseDown:ce,onMouseMove:Ue,onMouseUp:te,onMouseLeave:te,onContextMenu:J,onWheel:K,onTouchStart:Me,onTouchMove:De,onTouchEnd:_t,style:{cursor:W?"grabbing":o==="terrain"||o==="multiselect"||o==="measure"||o==="aoe"?"crosshair":"grab"},children:[i.jsx("div",{className:"absolute",style:{transform:`translate(${I.x}px, ${I.y}px) scale(${M})`,transformOrigin:"0 0"},children:i.jsxs("div",{ref:ae,className:"relative bg-gray-100 dark:bg-gray-300 shadow-inner",style:Wt,onClick:xe=>{if(!W&&D.current&&e){const Ke=D.current.getBoundingClientRect(),tt=(xe.clientX-Ke.left)/M-I.x,lt=(xe.clientY-Ke.top)/M-I.y,St=e.cellSize/2,{x:gs,y:Dt}=MA(tt,lt,St);gs>=0&&gs<e.cols&&Dt>=0&&Dt<e.rows&&Ye(gs,Dt)}},children:[je,vn(),c&&c.length===2&&(()=>{const xe=Jm(c[0].x,c[0].y,Q),Ke=Jm(c[1].x,c[1].y,Q),tt=CC(c[0].x,c[0].y,c[1].x,c[1].y),lt=k?"#3d92c4":"#2e6f95";return i.jsxs("svg",{className:"absolute inset-0 pointer-events-none",style:{width:ie.width,height:ie.height},children:[i.jsx("line",{x1:xe.x,y1:xe.y,x2:Ke.x,y2:Ke.y,stroke:lt,strokeWidth:"3",strokeDasharray:"5,5"}),i.jsx("circle",{cx:xe.x,cy:xe.y,r:"6",fill:lt}),i.jsx("circle",{cx:Ke.x,cy:Ke.y,r:"6",fill:lt}),i.jsxs("text",{x:(xe.x+Ke.x)/2,y:(xe.y+Ke.y)/2-10,fill:lt,fontSize:"12",fontWeight:"bold",textAnchor:"middle",children:[tt," hexes (",(tt*5).toFixed(0),"ft)"]})]})})(),t==null?void 0:t.map(xe=>{const Ke=Jm(xe.x,xe.y,Q);return i.jsx("div",{style:{position:"absolute",left:Ke.x,top:Ke.y},children:i.jsx($pe,{token:xe,cellSize:Q*2,allTokens:t})},xe._id)}),H&&i.jsx("div",{className:"absolute inset-0 pointer-events-none ring-2 ring-blue-400"})]})}),i.jsxs("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:[S.zoom.isVisible&&i.jsx(hy,{id:"zoom",title:"Zoom",anchor:"bottom-right",defaultWidth:80,minWidth:70,maxWidth:100,showMinimize:!1,icon:i.jsx("span",{className:"text-sm",children:""}),children:i.jsxs("div",{className:"flex flex-col gap-1 p-2",children:[i.jsx(q,{size:"sm",variant:"outline",onClick:()=>$(xe=>Math.min(3,xe*1.2)),title:"Zoom In",className:"h-8 w-8 p-0 mx-auto",children:"+"}),i.jsx(q,{size:"sm",variant:"outline",onClick:()=>$(xe=>Math.max(.5,xe*.8)),title:"Zoom Out",className:"h-8 w-8 p-0 mx-auto",children:""}),i.jsx(q,{size:"sm",variant:"outline",onClick:be,title:"Reset View",className:"h-8 w-8 p-0 text-xs mx-auto",children:""}),i.jsxs("div",{className:"text-xs text-center text-muted-foreground px-1 py-1",children:[Math.round(M*100),"%"]})]})}),i.jsx(hy,{id:"controls",title:"Controls",anchor:"top-right",defaultWidth:280,icon:i.jsx(ok,{className:"h-4 w-4"}),minimizedContent:i.jsx("span",{className:"text-xs",children:f?"Token selected":"Drag to interact"}),children:i.jsxs("div",{className:"px-3 pb-3 text-sm",children:[i.jsx("div",{className:"text-muted-foreground mb-2",children:" Click token to show range"}),i.jsx("div",{className:"text-muted-foreground mb-2",children:" Drag tokens to move"}),i.jsx("div",{className:"text-muted-foreground mb-2",children:" Shift+Click or Middle mouse: Pan"}),i.jsx("div",{className:"text-muted-foreground mb-2",children:" Scroll wheel: Pan"}),i.jsx("div",{className:"text-muted-foreground mb-2",children:" Ctrl+Scroll: Zoom"}),f&&i.jsxs("div",{className:"font-bold mt-2 text-pacific-cyan-600 dark:text-pacific-cyan-300",children:[" Token selected - movement range shown",((Ur=t==null?void 0:t.find(xe=>xe._id===f))==null?void 0:Ur.speed)&&i.jsxs("div",{className:"text-xs",children:["Speed: ",(zr=t==null?void 0:t.find(xe=>xe._id===f))==null?void 0:zr.speed,"ft"]})]}),o==="terrain"&&i.jsx("div",{className:"font-bold mt-2 text-dusty-grape-600 dark:text-dusty-grape-300",children:" Click cells to paint terrain"}),o==="measure"&&i.jsxs("div",{className:"font-bold mt-2 text-rich-cerulean-600 dark:text-rich-cerulean-300",children:[" Click two points to measure",c.length===1&&i.jsx("div",{className:"text-xs",children:"Click end point"})]}),o==="aoe"&&i.jsxs("div",{className:"font-bold mt-2 text-dark-raspberry-600 dark:text-dark-raspberry-300",children:[" Click to place ",h==null?void 0:h.type," AoE",i.jsxs("div",{className:"text-xs",children:["Size: ",((h==null?void 0:h.size)||0)*5,"ft"]})]}),o==="multiselect"&&i.jsxs("div",{className:"font-bold mt-2 text-pacific-cyan-600 dark:text-pacific-cyan-300",children:[" Multi-Select Mode",i.jsxs("div",{className:"text-xs",children:["Click cells to select (",p.size," selected)"]}),i.jsx("div",{className:"text-xs",children:"Use toolbar to apply terrain or AoE"})]})]})}),i.jsx(hy,{id:"terrain",title:"Terrain Types & Effects",anchor:"top-right",defaultWidth:280,icon:i.jsx(N$,{className:"h-4 w-4"}),minimizedContent:i.jsx("span",{className:"text-xs",children:"10 terrain types"}),children:i.jsx("div",{className:"max-h-[50vh] overflow-y-auto",children:i.jsx(Upe,{className:"border-0 shadow-none bg-transparent backdrop-blur-none"})})}),i.jsx(hy,{id:"initiative",title:"Initiative Tracker",anchor:"top-left",defaultWidth:320,icon:i.jsx(uk,{className:"h-4 w-4"}),minimizedContent:y.isInCombat?i.jsxs("span",{className:"text-xs",children:["Round ",y.roundNumber]}):i.jsx("span",{className:"text-xs",children:"Not in combat"}),children:i.jsx("div",{className:"max-h-[50vh] overflow-y-auto",children:i.jsx(Hpe,{mapId:s})})}),b.isCombatMode&&b.attackerTokenId&&b.targetTokenId&&t&&i.jsx(hy,{id:"combat",title:"Combat Actions",anchor:"free",defaultWidth:400,icon:i.jsx(jo,{className:"h-4 w-4"}),closable:!1,children:i.jsx(zpe,{attacker:t.find(xe=>xe._id===b.attackerTokenId),target:t.find(xe=>xe._id===b.targetTokenId),attackerEntity:null,availableActions:b.availableActions,onActionSelected:()=>{v()},onCancel:()=>{v()}})})]}),i.jsx(Ape,{})]})}function Wpe(){const{editingTokenId:s,setEditingTokenId:e}=Ju(),t=Fe(re.battleTokens.get,s?{id:s}:"skip"),n=Re(re.battleTokens.update),r=Re(re.battleTokens.remove),[a,o]=C.useState(!1),[l,c]=C.useState(!1),[d,h]=C.useState(!1),f=Fe(re.characters.getCharacterWithActions,t!=null&&t.characterId?{characterId:t.characterId}:"skip"),m=Fe(re.monsters.getMonsterById,t!=null&&t.monsterId?{monsterId:t.monsterId}:"skip"),p=async g=>{t&&(await n({id:t._id,label:g.label,characterId:g.characterId,monsterId:g.monsterId,hp:g.hp,maxHp:g.maxHp,speed:g.speed,size:g.size}),h(!1))},x=async()=>{t&&await n({id:t._id,characterId:void 0,monsterId:void 0})};return s?i.jsxs(cs,{open:!0,onOpenChange:g=>!g&&e(null),children:[i.jsxs(is,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[i.jsxs(Rs,{children:[i.jsx(Ds,{children:"Edit Token"}),i.jsx(Lr,{children:"Customize the token's appearance and combat statistics."})]}),t?i.jsxs("div",{className:"grid gap-4",children:[i.jsxs("div",{className:"space-y-3",children:[i.jsx("h3",{className:"font-semibold text-sm",children:"Basic Information"}),i.jsxs("div",{className:"grid grid-cols-4 items-center gap-2",children:[i.jsx(st,{className:"col-span-1",children:"Label"}),i.jsx(_e,{className:"col-span-3",value:t.label,onChange:g=>n({id:t._id,label:g.target.value})})]}),i.jsxs("div",{className:"grid grid-cols-4 items-center gap-2",children:[i.jsx(st,{className:"col-span-1",children:"Type"}),i.jsxs(wt,{value:t.type,onValueChange:g=>n({id:t._id,type:g}),children:[i.jsx(gt,{className:"col-span-3",children:i.jsx(Ct,{})}),i.jsxs(xt,{children:[i.jsx(Ie,{value:"pc",children:"PC"}),i.jsx(Ie,{value:"npc_friendly",children:"NPC (Friendly)"}),i.jsx(Ie,{value:"npc_foe",children:"NPC (Foe)"})]})]})]}),i.jsxs("div",{className:"grid grid-cols-4 items-center gap-2",children:[i.jsx(st,{className:"col-span-1",children:"Color"}),i.jsx(_e,{type:"color",className:"col-span-3 h-10",value:t.color,onChange:g=>n({id:t._id,color:g.target.value})})]}),i.jsxs("div",{className:"grid grid-cols-4 items-center gap-2",children:[i.jsx(st,{className:"col-span-1",children:"Size (tiles)"}),i.jsx(_e,{type:"number",min:1,max:4,className:"col-span-3",value:t.size,onChange:g=>n({id:t._id,size:parseInt(g.target.value||"1")})})]})]}),i.jsxs("div",{className:"space-y-3 border-t pt-3",children:[i.jsx("h3",{className:"font-semibold text-sm",children:"Combat Stats"}),i.jsxs("div",{className:"grid grid-cols-4 items-center gap-2",children:[i.jsx(st,{className:"col-span-1",children:"Speed (ft)"}),i.jsx(_e,{type:"number",min:0,className:"col-span-3",value:t.speed??"",placeholder:"30",onChange:g=>n({id:t._id,speed:g.target.value?parseInt(g.target.value):void 0})})]}),i.jsxs("div",{className:"grid grid-cols-4 items-center gap-2",children:[i.jsx(st,{className:"col-span-1",children:"Current HP"}),i.jsx(_e,{type:"number",min:0,className:"col-span-3",value:t.hp??"",placeholder:"Current HP",onChange:g=>n({id:t._id,hp:g.target.value?parseInt(g.target.value):void 0})})]}),i.jsxs("div",{className:"grid grid-cols-4 items-center gap-2",children:[i.jsx(st,{className:"col-span-1",children:"Max HP"}),i.jsx(_e,{type:"number",min:0,className:"col-span-3",value:t.maxHp??"",placeholder:"Max HP",onChange:g=>n({id:t._id,maxHp:g.target.value?parseInt(g.target.value):void 0})})]}),t.hp!==void 0&&t.maxHp!==void 0&&i.jsxs("div",{className:"col-span-4",children:[i.jsx("div",{className:"w-full bg-gray-200 rounded-full h-4 overflow-hidden",children:i.jsx("div",{className:"h-full bg-green-500 transition-all",style:{width:`${Math.min(100,t.hp/t.maxHp*100)}%`,backgroundColor:t.hp/t.maxHp>.5?"#22c55e":t.hp/t.maxHp>.25?"#f59e0b":"#ef4444"}})}),i.jsxs("p",{className:"text-xs text-center mt-1 text-gray-600",children:[t.hp," / ",t.maxHp," HP (",Math.round(t.hp/t.maxHp*100),"%)"]})]})]}),i.jsxs("div",{className:"space-y-3 border-t pt-3",children:[i.jsx("h3",{className:"font-semibold text-sm",children:"Affiliated Entity"}),i.jsxs("div",{className:"flex justify-end gap-2 mb-3",children:[i.jsx(q,{size:"sm",variant:"outline",onClick:()=>h(!0),children:t.characterId||t.monsterId?"Change Entity":"Link Entity"}),(t.characterId||t.monsterId)&&i.jsx(q,{size:"sm",variant:"destructive",onClick:x,children:"Remove Link"})]}),t.characterId&&f&&i.jsx("div",{className:"p-3 border rounded-lg bg-blue-950/50 border-blue-800",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("div",{className:"font-medium text-blue-100",children:f.name}),i.jsxs("div",{className:"text-sm text-blue-300",children:[f.race," ",f.class,f.level&&`  Level ${f.level}`]})]}),i.jsx(q,{size:"sm",variant:"outline",onClick:()=>o(!0),children:"View Details"})]})}),t.monsterId&&m&&i.jsx("div",{className:"p-3 border rounded-lg bg-red-950/50 border-red-800",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("div",{className:"font-medium text-red-100",children:m.name}),i.jsxs("div",{className:"text-sm text-red-300",children:[m.size," ",m.type,"  ","CR ",m.challengeRating,"  ",m.hitPoints," HP"]})]}),i.jsx(q,{size:"sm",variant:"outline",onClick:()=>c(!0),children:"View Details"})]})}),!t.characterId&&!t.monsterId&&i.jsx("div",{className:"p-3 border rounded-lg bg-gray-950/50 border-gray-800 text-center text-gray-400",children:"No entity linked to this token"})]}),(f||m)&&i.jsxs("div",{className:"space-y-3 border-t pt-3",children:[i.jsx("h3",{className:"font-semibold text-sm",children:"Available Actions"}),i.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:f!=null&&f.resolvedActions&&f.resolvedActions.length>0?f.resolvedActions.map((g,b)=>i.jsxs("div",{className:"p-2 border rounded bg-blue-950/50 border-blue-800",children:[i.jsx("div",{className:"font-medium text-blue-100",children:g.name}),i.jsxs("div",{className:"text-sm text-blue-300",children:[g.type&&i.jsx("span",{className:"font-medium",children:g.type}),g.range&&i.jsxs("span",{children:["  Range: ",g.range]}),g.damageRolls&&g.damageRolls.length>0&&i.jsxs("span",{children:["  Damage: ",g.damageRolls.map(v=>`${v.dice.count}${v.dice.type.toLowerCase()}+${v.modifier}`).join(", ")]}),g.description&&i.jsx("div",{className:"mt-1 text-xs text-blue-200",children:g.description})]})]},b)):m!=null&&m.actions&&m.actions.length>0?m.actions.map((g,b)=>i.jsxs("div",{className:"p-2 border rounded bg-red-950/50 border-red-800",children:[i.jsx("div",{className:"font-medium text-red-100",children:g.name}),i.jsxs("div",{className:"text-sm text-red-300",children:[g.type&&i.jsx("span",{className:"font-medium",children:g.type}),g.range&&i.jsxs("span",{children:["  Range: ",g.range]}),g.damage&&i.jsxs("span",{children:["  Damage: ",g.damage]}),g.description&&i.jsx("div",{className:"mt-1 text-xs text-red-200",children:g.description})]})]},b)):i.jsx("div",{className:"p-3 border rounded bg-gray-950/50 border-gray-800 text-center text-gray-400",children:"No actions available for this entity"})})]}),i.jsxs("div",{className:"flex justify-between mt-4 border-t pt-4",children:[i.jsx(q,{variant:"destructive",onClick:async()=>{await r({id:t._id}),e(null)},children:"Delete"}),i.jsx(q,{variant:"outline",onClick:()=>e(null),children:"Close"})]})]}):i.jsx("div",{children:"Loading"})]}),f&&i.jsx(qV,{open:a,onOpenChange:o,mode:"view",character:f,characterType:f.characterType||"npc",onSuccess:()=>o(!1)}),m&&i.jsx(GV,{open:l,onOpenChange:c,mode:"view",monster:m,onSuccess:()=>c(!1)}),i.jsx(l8,{open:d,onOpenChange:h,tokenType:(t==null?void 0:t.type)||"pc",onSelectNPC:p,onSelectMonster:p,onCreateGeneric:()=>{t&&n({id:t._id,label:t.type==="pc"?"PC":t.type==="npc_friendly"?"Ally":"Foe",characterId:void 0,monsterId:void 0}),h(!1)}})]}):null}function qpe(){const s=Fe(re.battleMaps.list)??[],{selectedMapId:e,setSelectedMapId:t,showNewMap:n,setShowNewMap:r}=Ju(),[a,o]=C.useState(s.length===0);return i.jsxs("div",{className:"h-full flex flex-col",children:[a&&s.length===0&&i.jsxs(ur,{className:"m-4 bg-gradient-to-r from-blue-50 to-purple-50 border-blue-200",children:[i.jsx(Aa,{className:"h-5 w-5 text-blue-600"}),i.jsxs(hr,{className:"flex items-center justify-between",children:[i.jsxs("div",{children:[i.jsx("strong",{className:"text-blue-900",children:"Welcome to the Enhanced Battle Map System!"}),i.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Create tactical maps with tokens, HP tracking, terrain editing, measurement tools, AoE templates, and movement preview. Perfect for D&D 5e combat!"})]}),i.jsx(q,{size:"sm",variant:"outline",onClick:()=>o(!1),className:"ml-4",children:"Got it"})]})]}),i.jsx("div",{className:"border-b",children:i.jsxs("div",{className:"container mx-auto px-4 py-2 flex items-center gap-4",children:[i.jsx(Tpe,{maps:s,value:e,onChange:t}),i.jsx(_pe,{})]})}),i.jsx("div",{className:"container mx-auto px-4 py-2",children:i.jsx(Zu,{entityType:"maps",onDataLoaded:()=>{}})}),i.jsx("div",{className:"flex-1",children:e?i.jsx(Vpe,{mapId:e}):i.jsx("div",{className:"h-full grid place-items-center",children:i.jsxs("div",{className:"text-center max-w-md",children:[i.jsx("div",{className:"text-6xl mb-4",children:""}),i.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"No Map Selected"}),i.jsx("p",{className:"text-gray-600 mb-6",children:"Create a new battle map or select an existing one from the dropdown above to begin your tactical combat session."}),i.jsxs("div",{className:"space-y-2 text-sm text-gray-500",children:[i.jsx("p",{children:i.jsx("strong",{children:"Features:"})}),i.jsxs("div",{className:"grid grid-cols-2 gap-2 text-left",children:[i.jsx("div",{children:" Token drag & drop"}),i.jsx("div",{children:" HP tracking"}),i.jsx("div",{children:" 10 terrain types"}),i.jsx("div",{children:" Pan & zoom"}),i.jsx("div",{children:" Measurement tool"}),i.jsx("div",{children:" AoE templates"}),i.jsx("div",{children:" Movement preview"}),i.jsx("div",{children:" Real-time sync"})]})]})]})})}),n&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:i.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[i.jsxs("div",{className:"flex justify-between items-center mb-4",children:[i.jsx("h2",{className:"text-2xl font-bold",children:"Create New Battle Map"}),i.jsx("button",{onClick:()=>r(!1),className:"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 text-2xl font-bold",children:""})]}),i.jsx(qM,{onMapCreated:()=>{r(!1)},showHeader:!1})]})}),i.jsx(Wpe,{})]})}function Gpe(){return i.jsx("div",{className:"h-screen",children:i.jsx(qpe,{})})}const Ype=["Action","Bonus Action","Reaction","No Action","Special"],Kpe=["MELEE_ATTACK","RANGED_ATTACK","SPELL","COMMONLY_AVAILABLE_UTILITY","CLASS_FEATURE","BONUS_ACTION","REACTION","OTHER"],Xpe=["general","class_specific","race_specific","feat_specific"];function Qpe({open:s,onOpenChange:e,mode:t,action:n,onSuccess:r}){const a=Re(re.actions.createAction),{generate:o,isGenerating:l}=lw(),c=kl({resolver:Nl(Gie),defaultValues:{name:(n==null?void 0:n.name)||"",description:(n==null?void 0:n.description)||"",actionCost:(n==null?void 0:n.actionCost)||"Action",type:(n==null?void 0:n.type)||"OTHER",requiresConcentration:(n==null?void 0:n.requiresConcentration)||!1,sourceBook:(n==null?void 0:n.sourceBook)||"Homebrew",category:(n==null?void 0:n.category)||"general",attackBonusAbilityScore:(n==null?void 0:n.attackBonusAbilityScore)||"",isProficient:(n==null?void 0:n.isProficient)||!1,damageRolls:(n==null?void 0:n.damageRolls)||[],spellLevel:n==null?void 0:n.spellLevel,castingTime:(n==null?void 0:n.castingTime)||"",range:(n==null?void 0:n.range)||"",components:(n==null?void 0:n.components)||{verbal:!1,somatic:!1,material:""},duration:(n==null?void 0:n.duration)||"",savingThrow:n==null?void 0:n.savingThrow,spellEffectDescription:(n==null?void 0:n.spellEffectDescription)||"",requiredClass:(n==null?void 0:n.requiredClass)||"",targetClass:(n==null?void 0:n.targetClass)||"",requiredLevel:n==null?void 0:n.requiredLevel,requiredSubclass:(n==null?void 0:n.requiredSubclass)||"",usesPer:n==null?void 0:n.usesPer,maxUses:n==null?void 0:n.maxUses,isBaseAction:(n==null?void 0:n.isBaseAction)||!1,tags:(n==null?void 0:n.tags)||[],prerequisites:(n==null?void 0:n.prerequisites)||[]}});V.useEffect(()=>{n&&(t==="edit"||t==="view")?c.reset({name:n.name,description:n.description,actionCost:n.actionCost,type:n.type,requiresConcentration:n.requiresConcentration,sourceBook:n.sourceBook,category:n.category,attackBonusAbilityScore:n.attackBonusAbilityScore||"",isProficient:n.isProficient||!1,damageRolls:n.damageRolls||[],spellLevel:n.spellLevel,castingTime:n.castingTime||"",range:n.range||"",components:n.components||{verbal:!1,somatic:!1,material:""},duration:n.duration||"",savingThrow:n.savingThrow,spellEffectDescription:n.spellEffectDescription||"",requiredClass:n.requiredClass||"",targetClass:n.targetClass||"",requiredLevel:n.requiredLevel,requiredSubclass:n.requiredSubclass||"",usesPer:n.usesPer,maxUses:n.maxUses,isBaseAction:n.isBaseAction||!1,tags:n.tags||[],prerequisites:n.prerequisites||[]}):t==="create"&&c.reset({name:"",description:"",actionCost:"Action",type:"OTHER",requiresConcentration:!1,sourceBook:"Homebrew",category:"general",attackBonusAbilityScore:"",isProficient:!1,damageRolls:[],spellLevel:void 0,castingTime:"",range:"",components:{verbal:!1,somatic:!1,material:""},duration:"",savingThrow:void 0,spellEffectDescription:"",requiredClass:"",targetClass:"",requiredLevel:void 0,requiredSubclass:"",usesPer:void 0,maxUses:void 0,isBaseAction:!1,tags:[],prerequisites:[]})},[n,t,c]);const d=async b=>{try{await a({...b,attackBonusAbilityScore:b.attackBonusAbilityScore||void 0,castingTime:b.castingTime||void 0,range:b.range||void 0,duration:b.duration||void 0,spellEffectDescription:b.spellEffectDescription||void 0,requiredClass:b.requiredClass||void 0,targetClass:b.targetClass||void 0,requiredSubclass:b.requiredSubclass||void 0,components:b.components&&(b.components.verbal||b.components.somatic||b.components.material)?{verbal:b.components.verbal,somatic:b.components.somatic,material:b.components.material||void 0}:void 0}),rt.success(t==="create"?"Action created successfully!":"Action updated successfully!"),r==null||r(),e(!1)}catch(v){rt.error(v.message||"Failed to save action")}},h=()=>{switch(t){case"create":return"Create New Action";case"edit":return"Edit Action";case"view":return(n==null?void 0:n.name)||"View Action";default:return"Action"}},f=()=>{switch(t){case"create":return"Add a new action, spell, or ability to your library";case"edit":return"Modify the action details";case"view":return"View action information";default:return""}},m=async()=>{try{rt.info("Generating action with GPT...",{duration:2e3});const b=await o("action");b.success&&b.data?(c.reset({name:b.data.name||"",description:b.data.description||"",actionCost:b.data.actionCost||"Action",type:b.data.type||"OTHER",requiresConcentration:b.data.requiresConcentration||!1,sourceBook:b.data.sourceBook||"Homebrew",category:b.data.category||"general",attackBonusAbilityScore:b.data.attackBonusAbilityScore||"",isProficient:b.data.isProficient||!1,damageRolls:b.data.damageRolls||[],spellLevel:b.data.spellLevel,castingTime:b.data.castingTime||"",range:b.data.range||"",components:b.data.components||{verbal:!1,somatic:!1,material:""},duration:b.data.duration||"",savingThrow:b.data.savingThrow,spellEffectDescription:b.data.spellEffectDescription||"",requiredClass:b.data.requiredClass||"",targetClass:b.data.targetClass||"",requiredLevel:b.data.requiredLevel,requiredSubclass:b.data.requiredSubclass||"",usesPer:b.data.usesPer,maxUses:b.data.maxUses,isBaseAction:b.data.isBaseAction||!1,tags:b.data.tags||[],prerequisites:b.data.prerequisites||[]}),rt.success("Action generated successfully! Review and adjust as needed.",{duration:3e3})):rt.error(b.error||"Failed to generate action")}catch(b){rt.error(b.message||"Failed to generate action")}},p=t==="view",x=c.formState.isSubmitting,g=c.watch("type");return i.jsx(cs,{open:s,onOpenChange:e,children:i.jsxs(is,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[i.jsx(Rs,{children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsx(Ds,{children:h()}),i.jsx(Lr,{children:f()})]}),t==="create"&&i.jsx(q,{type:"button",variant:"outline",size:"sm",onClick:m,disabled:l||x,className:"ml-4",children:l?i.jsxs(i.Fragment,{children:[i.jsx(Ss,{className:"mr-2 h-4 w-4 animate-spin"}),"Generating..."]}):i.jsxs(i.Fragment,{children:[i.jsx(Aa,{className:"mr-2 h-4 w-4"}),"Generate with GPT"]})})]})}),i.jsx(Al,{...c,children:i.jsxs("form",{onSubmit:c.handleSubmit(d),className:"space-y-6",children:[i.jsxs(Qn,{defaultValue:"basic",className:"w-full",children:[i.jsxs(In,{className:"grid w-full grid-cols-3",children:[i.jsxs(Be,{value:"basic",children:[i.jsx(En,{className:"h-4 w-4 mr-2"}),"Basic Info"]}),i.jsxs(Be,{value:"mechanics",children:[i.jsx(Da,{className:"h-4 w-4 mr-2"}),"Mechanics"]}),i.jsxs(Be,{value:"requirements",children:[i.jsx(Dr,{className:"h-4 w-4 mr-2"}),"Requirements"]})]}),i.jsx($e,{value:"basic",className:"space-y-4",children:i.jsxs("div",{className:"grid gap-4",children:[i.jsx(pe,{control:c.control,name:"name",render:({field:b})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Action Name*"}),i.jsx(ge,{children:i.jsx(_e,{...b,disabled:p,placeholder:"e.g., Fireball, Sword Strike, Hide"})}),i.jsx(ye,{})]})}),i.jsx(pe,{control:c.control,name:"description",render:({field:b})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Description*"}),i.jsx(ge,{children:i.jsx(ps,{...b,disabled:p,rows:4,placeholder:"Describe what this action does, including mechanics and effects..."})}),i.jsx(nt,{children:"Include mechanical details, effects, and how the action works"}),i.jsx(ye,{})]})}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsx(pe,{control:c.control,name:"actionCost",render:({field:b})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Action Cost*"}),i.jsxs(wt,{onValueChange:b.onChange,defaultValue:b.value,disabled:p,children:[i.jsx(ge,{children:i.jsx(gt,{children:i.jsx(Ct,{placeholder:"Select action cost"})})}),i.jsx(xt,{children:Ype.map(v=>i.jsx(Ie,{value:v,children:v},v))})]}),i.jsx(ye,{})]})}),i.jsx(pe,{control:c.control,name:"type",render:({field:b})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Action Type*"}),i.jsxs(wt,{onValueChange:b.onChange,defaultValue:b.value,disabled:p,children:[i.jsx(ge,{children:i.jsx(gt,{children:i.jsx(Ct,{placeholder:"Select type"})})}),i.jsx(xt,{children:Kpe.map(v=>i.jsx(Ie,{value:v,children:v.replace(/_/g," ")},v))})]}),i.jsx(ye,{})]})})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsx(pe,{control:c.control,name:"sourceBook",render:({field:b})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Source Book*"}),i.jsx(ge,{children:i.jsx(_e,{...b,disabled:p,placeholder:"e.g., PHB, Homebrew"})}),i.jsx(ye,{})]})}),i.jsx(pe,{control:c.control,name:"category",render:({field:b})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Category*"}),i.jsxs(wt,{onValueChange:b.onChange,defaultValue:b.value,disabled:p,children:[i.jsx(ge,{children:i.jsx(gt,{children:i.jsx(Ct,{placeholder:"Select category"})})}),i.jsx(xt,{children:Xpe.map(v=>i.jsx(Ie,{value:v,children:v.replace(/_/g," ")},v))})]}),i.jsx(ye,{})]})})]}),i.jsx("div",{className:"flex items-center space-x-2",children:i.jsx(pe,{control:c.control,name:"requiresConcentration",render:({field:b})=>i.jsxs(fe,{className:"flex flex-row items-start space-x-3 space-y-0",children:[i.jsx(ge,{children:i.jsx(ii,{checked:b.value,onCheckedChange:b.onChange,disabled:p})}),i.jsxs("div",{className:"space-y-1 leading-none",children:[i.jsx(me,{children:"Requires Concentration"}),i.jsx(nt,{children:"Check if this action requires concentration (typically for spells)"})]})]})})})]})}),i.jsx($e,{value:"mechanics",className:"space-y-4",children:i.jsxs("div",{className:"grid gap-4",children:[(g==="SPELL"||g==="CLASS_FEATURE")&&i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[i.jsx(pe,{control:c.control,name:"spellLevel",render:({field:b})=>{var v;return i.jsxs(fe,{children:[i.jsx(me,{children:"Spell Level"}),i.jsxs(wt,{onValueChange:y=>b.onChange(parseInt(y)),value:(v=b.value)==null?void 0:v.toString(),disabled:p,children:[i.jsx(ge,{children:i.jsx(gt,{children:i.jsx(Ct,{placeholder:"Level"})})}),i.jsx(xt,{children:[0,1,2,3,4,5,6,7,8,9].map(y=>i.jsx(Ie,{value:y.toString(),children:y===0?"Cantrip":`Level ${y}`},y))})]}),i.jsx(ye,{})]})}}),i.jsx(pe,{control:c.control,name:"castingTime",render:({field:b})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Casting Time"}),i.jsx(ge,{children:i.jsx(_e,{...b,disabled:p,placeholder:"1 action"})}),i.jsx(ye,{})]})}),i.jsx(pe,{control:c.control,name:"range",render:({field:b})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Range"}),i.jsx(ge,{children:i.jsx(_e,{...b,disabled:p,placeholder:"60 feet"})}),i.jsx(ye,{})]})})]}),i.jsx(pe,{control:c.control,name:"duration",render:({field:b})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Duration"}),i.jsx(ge,{children:i.jsx(_e,{...b,disabled:p,placeholder:"Instantaneous"})}),i.jsx(ye,{})]})}),i.jsxs("div",{className:"space-y-2",children:[i.jsx(me,{children:"Components"}),i.jsxs("div",{className:"flex items-center space-x-4",children:[i.jsx(pe,{control:c.control,name:"components.verbal",render:({field:b})=>i.jsxs(fe,{className:"flex items-center space-x-2",children:[i.jsx(ge,{children:i.jsx(ii,{checked:b.value,onCheckedChange:b.onChange,disabled:p})}),i.jsx(me,{className:"!mt-0",children:"Verbal"})]})}),i.jsx(pe,{control:c.control,name:"components.somatic",render:({field:b})=>i.jsxs(fe,{className:"flex items-center space-x-2",children:[i.jsx(ge,{children:i.jsx(ii,{checked:b.value,onCheckedChange:b.onChange,disabled:p})}),i.jsx(me,{className:"!mt-0",children:"Somatic"})]})})]}),i.jsx(pe,{control:c.control,name:"components.material",render:({field:b})=>i.jsxs(fe,{children:[i.jsx(ge,{children:i.jsx(_e,{...b,disabled:p,placeholder:"Material components (if any)"})}),i.jsx(ye,{})]})})]}),i.jsx(pe,{control:c.control,name:"spellEffectDescription",render:({field:b})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Spell Effect Description"}),i.jsx(ge,{children:i.jsx(ps,{...b,disabled:p,rows:3,placeholder:"Describe the magical effects..."})}),i.jsx(ye,{})]})})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsx(pe,{control:c.control,name:"usesPer",render:({field:b})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Uses Per"}),i.jsxs(wt,{onValueChange:b.onChange,value:b.value,disabled:p,children:[i.jsx(ge,{children:i.jsx(gt,{children:i.jsx(Ct,{placeholder:"Select..."})})}),i.jsxs(xt,{children:[i.jsx(Ie,{value:"Short Rest",children:"Short Rest"}),i.jsx(Ie,{value:"Long Rest",children:"Long Rest"}),i.jsx(Ie,{value:"Day",children:"Per Day"}),i.jsx(Ie,{value:"Special",children:"Special"})]})]}),i.jsx(ye,{})]})}),i.jsx(pe,{control:c.control,name:"maxUses",render:({field:b})=>{var v;return i.jsxs(fe,{children:[i.jsx(me,{children:"Max Uses"}),i.jsx(ge,{children:i.jsx(_e,{...b,disabled:p,placeholder:"e.g., 3",value:((v=b.value)==null?void 0:v.toString())||"",onChange:y=>{const w=y.target.value;b.onChange(w===""?void 0:isNaN(Number(w))?w:Number(w))}})}),i.jsx(ye,{})]})}})]})]})}),i.jsx($e,{value:"requirements",className:"space-y-4",children:i.jsxs("div",{className:"grid gap-4",children:[i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsx(pe,{control:c.control,name:"requiredClass",render:({field:b})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Required Class"}),i.jsx(ge,{children:i.jsx(_e,{...b,disabled:p,placeholder:"e.g., Wizard, Fighter"})}),i.jsx(nt,{children:"Leave empty for general actions"}),i.jsx(ye,{})]})}),i.jsx(pe,{control:c.control,name:"targetClass",render:({field:b})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Target Class"}),i.jsx(ge,{children:i.jsx(_e,{...b,disabled:p,placeholder:"e.g., Wizard, Fighter"})}),i.jsx(nt,{children:"The class this action is specifically for"}),i.jsx(ye,{})]})})]}),i.jsx(pe,{control:c.control,name:"requiredSubclass",render:({field:b})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Required Subclass"}),i.jsx(ge,{children:i.jsx(_e,{...b,disabled:p,placeholder:"e.g., Evocation, Champion"})}),i.jsx(ye,{})]})}),i.jsx(pe,{control:c.control,name:"requiredLevel",render:({field:b})=>i.jsxs(fe,{children:[i.jsx(me,{children:"Required Level"}),i.jsx(ge,{children:i.jsx(_e,{type:"number",...b,disabled:p,placeholder:"1-20",value:b.value||"",onChange:v=>b.onChange(v.target.value?parseInt(v.target.value):void 0)})}),i.jsx(ye,{})]})}),i.jsx("div",{className:"flex items-center space-x-2",children:i.jsx(pe,{control:c.control,name:"isBaseAction",render:({field:b})=>i.jsxs(fe,{className:"flex flex-row items-start space-x-3 space-y-0",children:[i.jsx(ge,{children:i.jsx(ii,{checked:b.value,onCheckedChange:b.onChange,disabled:p})}),i.jsxs("div",{className:"space-y-1 leading-none",children:[i.jsx(me,{children:"Core D&D Action"}),i.jsx(nt,{children:"Check if this is a base D&D action (Attack, Dodge, Hide, etc.)"})]})]})})})]})})]}),!p&&i.jsxs(Xn,{children:[i.jsx(q,{type:"button",variant:"outline",onClick:()=>e(!1),disabled:x,children:"Cancel"}),i.jsxs(q,{type:"submit",disabled:x,children:[x&&i.jsx(Ss,{className:"mr-2 h-4 w-4 animate-spin"}),t==="create"?"Create Action":"Save Changes"]})]}),p&&i.jsx(Xn,{children:i.jsx(q,{type:"button",variant:"outline",onClick:()=>e(!1),children:"Close"})})]})})]})})}function Zpe({action:s,onView:e,onEdit:t,onDelete:n,showActions:r=!0}){const a=c=>{switch(c){case"Action":return i.jsx(En,{className:"h-4 w-4"});case"Bonus Action":return i.jsx(Da,{className:"h-4 w-4"});case"Reaction":return i.jsx(Dr,{className:"h-4 w-4"});default:return i.jsx(wo,{className:"h-4 w-4"})}},o=c=>{switch(c){case"Action":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-100";case"Bonus Action":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-100";case"Reaction":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-100";case"No Action":return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-100";case"Special":return"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-100"}},l=c=>!c||c.length===0?null:c.map((d,h)=>i.jsxs("span",{className:"text-sm text-muted-foreground",children:[d.dice.count,"d",d.dice.type.replace("D",""),d.modifier>0?`+${d.modifier}`:d.modifier<0?`${d.modifier}`:""," ",d.damageType.toLowerCase(),h<c.length-1?", ":""]},h));return i.jsx(oe,{className:"hover:shadow-md transition-shadow",children:i.jsx(he,{className:"p-6",children:i.jsxs("div",{className:"flex items-start justify-between",children:[i.jsxs("div",{className:"flex-1",children:[i.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[i.jsx("h3",{className:"text-lg font-semibold",children:s.name}),i.jsx(ue,{className:o(s.actionCost),children:i.jsxs("div",{className:"flex items-center gap-1",children:[a(s.actionCost),s.actionCost]})}),i.jsx(ue,{variant:"outline",children:s.type.replace(/_/g," ")}),s.requiresConcentration&&i.jsxs(ue,{variant:"secondary",children:[i.jsx(Aa,{className:"h-3 w-3 mr-1"}),"Concentration"]})]}),i.jsx("p",{className:"text-muted-foreground mb-3 line-clamp-2",children:s.description}),i.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-2",children:[i.jsxs("span",{children:["Source: ",s.sourceBook]}),i.jsxs("span",{children:["Category: ",s.category.replace(/_/g," ")]}),s.targetClass&&i.jsxs("span",{children:["Class: ",s.targetClass]}),s.spellLevel!==void 0&&i.jsxs("span",{children:["Level: ",s.spellLevel===0?"Cantrip":s.spellLevel]}),s.range&&i.jsxs("span",{children:["Range: ",s.range]})]}),s.damageRolls&&s.damageRolls.length>0&&i.jsxs("div",{className:"text-sm text-muted-foreground mb-2",children:[i.jsx("span",{className:"font-medium",children:"Damage: "}),l(s.damageRolls)]}),s.components&&(s.components.verbal||s.components.somatic||s.components.material)&&i.jsxs("div",{className:"text-sm text-muted-foreground mb-2",children:[i.jsx("span",{className:"font-medium",children:"Components: "}),s.components.verbal&&i.jsx("span",{children:"V"}),s.components.somatic&&i.jsxs("span",{children:[s.components.verbal?", ":"","S"]}),s.components.material&&i.jsxs("span",{children:[s.components.verbal||s.components.somatic?", ":"","M"]})]}),s.usesPer&&s.maxUses&&i.jsxs("div",{className:"text-sm text-muted-foreground",children:[i.jsx("span",{className:"font-medium",children:"Uses: "}),s.maxUses," per ",s.usesPer.toLowerCase()]})]}),r&&i.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[i.jsx(q,{variant:"ghost",size:"sm",onClick:()=>e(s),title:"View action details",children:i.jsx(Ku,{className:"h-4 w-4"})}),i.jsx(q,{variant:"ghost",size:"sm",onClick:()=>t(s),title:"Edit action",children:i.jsx(hS,{className:"h-4 w-4"})}),n&&i.jsx(q,{variant:"ghost",size:"sm",onClick:()=>n(s),title:"Delete action",className:"text-destructive hover:text-destructive",children:i.jsx(kx,{className:"h-4 w-4"})})]})]})})})}const Jpe=["Artificer","Barbarian","Bard","Cleric","Druid","Fighter","Monk","Paladin","Ranger","Rogue","Sorcerer","Warlock","Wizard"];function ege(){const{isSignedIn:s,isLoaded:e}=Ji(),{isAuthenticated:t,isLoading:n}=sw(),[r,a]=C.useState(""),[o,l]=C.useState("all"),[c,d]=C.useState("all"),[h,f]=C.useState("all"),[m,p]=C.useState("all"),[x,g]=C.useState("all"),[b,v]=C.useState(!1),[y,w]=C.useState("create"),[S,j]=C.useState(null),A=Fe(re.actions.getAllActions,t?{}:"skip");if(!e||n)return i.jsx("div",{className:"container mx-auto py-6",children:i.jsx("div",{className:"flex items-center justify-center h-64",children:i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(Ss,{className:"h-6 w-6 animate-spin"}),i.jsx("span",{children:"Loading..."})]})})});if(!s||!t)return i.jsx("div",{className:"container mx-auto py-6",children:i.jsxs(oe,{children:[i.jsx(ke,{children:i.jsx(Ne,{children:"Authentication Required"})}),i.jsx(he,{children:i.jsx("p",{className:"text-muted-foreground",children:"Please sign in to access the actions management system."})})]})});const k=()=>{j(null),w("create"),v(!0)},_=T=>{j(T),w("edit"),v(!0)},L=T=>{j(T),w("view"),v(!0)},D=()=>{v(!1),j(null)},P=(A==null?void 0:A.filter(T=>{const B=T.name.toLowerCase().includes(r.toLowerCase())||T.description.toLowerCase().includes(r.toLowerCase())||T.sourceBook.toLowerCase().includes(r.toLowerCase()),R=o==="all"||T.actionCost===o,O=c==="all"||T.type===c,I=h==="all"||T.category===h,U=m==="all"||h==="class_specific"&&T.targetClass===m||h!=="class_specific";return B&&R&&O&&I&&U}))||[];return i.jsxs("div",{className:"container mx-auto py-6",children:[i.jsxs("div",{className:"flex items-center justify-between mb-6",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-3xl font-bold",children:"Actions"}),i.jsx("p",{className:"text-muted-foreground",children:"Manage spells, abilities, and combat actions for your campaigns"})]}),i.jsxs(q,{onClick:k,className:"flex items-center gap-2",children:[i.jsx(Mt,{className:"h-4 w-4"}),"Create Action"]})]}),i.jsxs(Qn,{value:x,onValueChange:T=>g(T),className:"space-y-6",children:[i.jsxs(In,{children:[i.jsx(Be,{value:"all",children:"All Actions"}),i.jsx(Be,{value:"my",children:"My Actions"})]}),i.jsxs($e,{value:"all",className:"space-y-6",children:[i.jsx(Zu,{entityType:"actions",onDataLoaded:()=>{}}),i.jsxs(oe,{children:[i.jsx(ke,{children:i.jsxs(Ne,{className:"flex items-center gap-2",children:[i.jsx(S$,{className:"h-5 w-5"}),"Filters"]})}),i.jsxs(he,{children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-sm font-medium",children:"Search"}),i.jsxs("div",{className:"relative",children:[i.jsx(wm,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),i.jsx(_e,{placeholder:"Search actions...",value:r,onChange:T=>a(T.target.value),className:"pl-10"})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-sm font-medium",children:"Action Cost"}),i.jsxs(wt,{value:o,onValueChange:T=>l(T),children:[i.jsx(gt,{children:i.jsx(Ct,{placeholder:"All costs"})}),i.jsxs(xt,{children:[i.jsx(Ie,{value:"all",children:"All costs"}),i.jsx(Ie,{value:"Action",children:"Action"}),i.jsx(Ie,{value:"Bonus Action",children:"Bonus Action"}),i.jsx(Ie,{value:"Reaction",children:"Reaction"}),i.jsx(Ie,{value:"No Action",children:"No Action"}),i.jsx(Ie,{value:"Special",children:"Special"})]})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-sm font-medium",children:"Action Type"}),i.jsxs(wt,{value:c,onValueChange:T=>d(T),children:[i.jsx(gt,{children:i.jsx(Ct,{placeholder:"All types"})}),i.jsxs(xt,{children:[i.jsx(Ie,{value:"all",children:"All types"}),i.jsx(Ie,{value:"MELEE_ATTACK",children:"Melee Attack"}),i.jsx(Ie,{value:"RANGED_ATTACK",children:"Ranged Attack"}),i.jsx(Ie,{value:"SPELL",children:"Spell"}),i.jsx(Ie,{value:"COMMONLY_AVAILABLE_UTILITY",children:"Utility"}),i.jsx(Ie,{value:"CLASS_FEATURE",children:"Class Feature"}),i.jsx(Ie,{value:"BONUS_ACTION",children:"Bonus Action"}),i.jsx(Ie,{value:"REACTION",children:"Reaction"}),i.jsx(Ie,{value:"OTHER",children:"Other"})]})]})]}),i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-sm font-medium",children:"Category"}),i.jsxs(wt,{value:h,onValueChange:T=>{f(T),T!=="class_specific"&&p("all")},children:[i.jsx(gt,{children:i.jsx(Ct,{placeholder:"All categories"})}),i.jsxs(xt,{children:[i.jsx(Ie,{value:"all",children:"All categories"}),i.jsx(Ie,{value:"general",children:"General"}),i.jsx(Ie,{value:"class_specific",children:"Class Specific"}),i.jsx(Ie,{value:"race_specific",children:"Race Specific"}),i.jsx(Ie,{value:"feat_specific",children:"Feat Specific"})]})]})]})]}),h==="class_specific"&&i.jsx("div",{className:"mt-4 pt-4 border-t",children:i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:i.jsxs("div",{className:"space-y-2",children:[i.jsx("label",{className:"text-sm font-medium",children:"Class"}),i.jsxs(wt,{value:m,onValueChange:T=>p(T),children:[i.jsx(gt,{children:i.jsx(Ct,{placeholder:"All classes"})}),i.jsxs(xt,{children:[i.jsx(Ie,{value:"all",children:"All classes"}),Jpe.map(T=>i.jsx(Ie,{value:T,children:T},T))]})]})]})})})]})]}),i.jsx("div",{className:"grid gap-4",children:P.length===0?i.jsx(oe,{children:i.jsxs(he,{className:"flex flex-col items-center justify-center py-12",children:[i.jsx(En,{className:"h-12 w-12 text-muted-foreground mb-4"}),i.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No actions found"}),i.jsx("p",{className:"text-muted-foreground text-center mb-4",children:r||o!=="all"||c!=="all"||h!=="all"||m!=="all"?"Try adjusting your filters or search terms.":"Create your first action to get started."}),i.jsxs(q,{onClick:k,variant:"outline",children:[i.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Create Action"]})]})}):P.map(T=>i.jsx(Zpe,{action:T,onView:L,onEdit:_,showActions:!0},T._id))})]}),i.jsx($e,{value:"my",className:"space-y-6",children:i.jsxs(oe,{children:[i.jsxs(ke,{children:[i.jsx(Ne,{children:"My Actions"}),i.jsx(At,{children:"Actions you've created or have access to"})]}),i.jsx(he,{children:i.jsx("div",{className:"flex items-center justify-center py-12",children:i.jsxs("div",{className:"text-center",children:[i.jsx(En,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),i.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Coming Soon"}),i.jsx("p",{className:"text-muted-foreground mb-4",children:"Personal action management features are in development."}),i.jsxs(q,{onClick:k,variant:"outline",children:[i.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Create Action"]})]})})})]})})]}),i.jsx(Qpe,{open:b,onOpenChange:v,mode:y,action:S||void 0,onSuccess:D})]})}function tge(){const{theme:s,setTheme:e,actualTheme:t}=Ox();return i.jsxs(sW,{children:[i.jsx(nW,{asChild:!0,children:i.jsxs(q,{variant:"outline",size:"sm",className:"w-9 h-9 p-0","aria-label":`Current theme: ${s}. Click to change theme`,children:[t==="light"?i.jsx(lL,{className:"h-4 w-4","aria-hidden":"true"}):i.jsx(aL,{className:"h-4 w-4","aria-hidden":"true"}),i.jsx("span",{className:"sr-only",children:"Toggle theme"})]})}),i.jsxs(sI,{align:"end",role:"menu","aria-label":"Theme selection",children:[i.jsxs(mv,{onClick:()=>e("light"),className:"flex items-center gap-2",role:"menuitem","aria-selected":s==="light",children:[i.jsx(lL,{className:"h-4 w-4","aria-hidden":"true"}),i.jsx("span",{children:"Light"}),s==="light"&&i.jsx("span",{className:"ml-auto text-xs text-muted-foreground","aria-label":"Currently selected",children:""})]}),i.jsxs(mv,{onClick:()=>e("dark"),className:"flex items-center gap-2",role:"menuitem","aria-selected":s==="dark",children:[i.jsx(aL,{className:"h-4 w-4","aria-hidden":"true"}),i.jsx("span",{children:"Dark"}),s==="dark"&&i.jsx("span",{className:"ml-auto text-xs text-muted-foreground","aria-label":"Currently selected",children:""})]}),i.jsxs(mv,{onClick:()=>e("system"),className:"flex items-center gap-2",role:"menuitem","aria-selected":s==="system",children:[i.jsx(Ane,{className:"h-4 w-4","aria-hidden":"true"}),i.jsx("span",{children:"System"}),s==="system"&&i.jsx("span",{className:"ml-auto text-xs text-muted-foreground","aria-label":"Currently selected",children:""})]})]})]})}const sge=[{path:"/campaigns",label:"Campaigns",icon:uv},{path:"/characters",label:"Characters",icon:Cs},{path:"/monsters",label:"Monsters",icon:uk},{path:"/quests",label:"Quests",icon:wo},{path:"/items",label:"Items",icon:hl},{path:"/actions",label:"Actions",icon:Da},{path:"/battle-map",label:"Battle Map",icon:jo,badge:"Enhanced"},{path:"/interactions",label:"Interactions",icon:Aa}];function nge({isCollapsed:s,setIsCollapsed:e}){const n=Pr().location.pathname,r=()=>{window.innerWidth<1024&&e(!0)};return i.jsxs(i.Fragment,{children:[i.jsx(q,{variant:"glass",size:"icon",className:Ee("fixed top-4 z-50 transition-all duration-300 hover:shadow-glow",s?"left-4":"left-[260px] lg:left-[260px]"),onClick:()=>e(!s),children:s?i.jsx(jne,{className:"h-5 w-5"}):i.jsx(Mr,{className:"h-5 w-5"})}),i.jsxs("aside",{className:Ee("fixed left-0 top-0 h-screen glass border-r transition-all duration-300 z-40 flex flex-col",s?"w-0 -translate-x-full":"w-64"),children:[i.jsxs("div",{className:"flex-1 overflow-y-auto",children:[i.jsx("div",{className:"p-6 border-b border-border/50",children:i.jsxs(ba,{to:"/",className:"block hover:opacity-80 transition-all duration-300 hover:scale-105",children:[i.jsx("h1",{className:"text-xl font-bold mb-1 text-gradient",children:"Campaignion"}),i.jsx("p",{className:"text-xs text-muted-foreground",children:"D&D 5e Campaign Manager"})]})}),i.jsx(Rr,{children:i.jsx("nav",{className:"p-4 space-y-1",children:sge.map(a=>{const o=a.icon,l=n===a.path;return i.jsx(ba,{to:a.path,onClick:r,children:i.jsxs(q,{variant:l?"gradient":"ghost",className:Ee("w-full justify-start gap-3 transition-all duration-300",l&&"shadow-glow"),children:[i.jsx(o,{className:"h-4 w-4 flex-shrink-0"}),i.jsx("span",{className:"flex-1 text-left",children:a.label}),a.badge==="Enhanced"&&i.jsx(ue,{variant:"secondary",className:"text-xs bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100 animate-pulse",children:"New"}),a.badge==="Legacy"&&i.jsx(ue,{variant:"outline",className:"text-xs",children:"Old"})]})},a.path)})})}),i.jsx(Yu,{children:i.jsx("div",{className:"p-4",children:i.jsx(R_,{mode:"modal",children:i.jsx(q,{variant:"gradient",className:"w-full",children:"Sign in"})})})})]}),i.jsx(Rr,{children:i.jsx("div",{className:"border-t border-border/50 p-4",children:i.jsxs("div",{className:"flex items-center justify-between gap-2",children:[i.jsx(tge,{}),i.jsx(OG,{appearance:{elements:{avatarBox:"h-8 w-8 rounded-lg"}}})]})})})]}),!s&&i.jsx("div",{className:"fixed inset-0 bg-black/50 z-30 lg:hidden",onClick:()=>e(!0)})]})}function rge(){Cde();const[s,e]=C.useState(()=>typeof window<"u"?window.innerWidth<1024:!1);return i.jsxs("div",{className:"min-h-screen bg-background relative overflow-hidden",children:[i.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-[#2e6f95]/20 via-[#723c70]/15 to-[#b7094c]/18 pointer-events-none"}),i.jsx("div",{className:"absolute inset-0 bg-gradient-to-tl from-[#0091ad]/12 via-transparent to-[#a01a58]/14 pointer-events-none"}),i.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_top_right,rgba(23,128,161,0.18),transparent_55%)] pointer-events-none"}),i.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(ellipse_at_bottom_left,rgba(160,26,88,0.16),transparent_50%)] pointer-events-none"}),i.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_30%_70%,rgba(69,94,137,0.12),transparent_45%)] pointer-events-none"}),i.jsx("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_70%_30%,rgba(137,43,100,0.10),transparent_40%)] pointer-events-none"}),i.jsx(nge,{isCollapsed:s,setIsCollapsed:e}),i.jsx("main",{className:Ee("min-h-screen transition-all duration-300 py-6 px-4 sm:px-6 lg:px-8 relative z-10",s?"lg:ml-0":"lg:ml-64"),children:i.jsx("div",{className:"max-w-7xl mx-auto",children:i.jsx(VB,{})})}),!1]})}const hi=eZ({component:rge,errorComponent:mfe}),ige=ui({getParentRoute:()=>hi,path:"/",component:Dfe}),age=ui({getParentRoute:()=>hi,path:"/campaigns",component:jde}),oge=ui({getParentRoute:()=>hi,path:"/characters",component:cfe}),lge=ui({getParentRoute:()=>hi,path:"/monsters",component:ufe}),cge=ui({getParentRoute:()=>hi,path:"/quests",component:pfe}),dge=ui({getParentRoute:()=>hi,path:"/items",component:gfe}),uge=ui({getParentRoute:()=>hi,path:"/maps",component:Pfe}),hge=ui({getParentRoute:()=>hi,path:"/interactions",component:Ife}),fge=ui({getParentRoute:()=>hi,path:"/live-demo",component:Rfe}),mge=ui({getParentRoute:()=>hi,path:"/import-debug",component:Lfe}),pge=ui({getParentRoute:()=>hi,path:"/locations",component:Bfe}),gge=ui({getParentRoute:()=>hi,path:"/battle-map",component:Gpe}),xge=ui({getParentRoute:()=>hi,path:"/actions",component:ege}),yge=hi.addChildren([ige,age,oge,lge,cge,dge,uge,hge,fge,mge,pge,gge,xge]),vge=cZ({routeTree:yge}),bge="pk_test_ZGFzaGluZy1maW5jaC0yMS5jbGVyay5hY2NvdW50cy5kZXYk",wge=new kX({defaultOptions:{queries:{staleTime:5*60*1e3}}});IA.createRoot(document.getElementById("root")).render(i.jsx(V.StrictMode,{children:i.jsx(nB,{publishableKey:bge,children:i.jsx(ZK,{client:Cee,useAuth:Ji,children:i.jsx(One,{children:i.jsx(AX,{client:wge,children:i.jsx(TJ,{backend:wee,children:i.jsxs(jee,{defaultTheme:"system",storageKey:"campaignion-ui-theme",children:[i.jsx(hZ,{router:vge}),i.jsx(Dre,{})]})})})})})})}));
